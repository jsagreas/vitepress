---
title: 11ã€åŠ¨æ€SQLå®‰å…¨ä¸æ³¨å…¥é˜²æŠ¤
---
## ğŸ“š ç›®å½•

1. [SQLæ³¨å…¥æ”»å‡»åŸç†](#1-SQLæ³¨å…¥æ”»å‡»åŸç†)
2. [å‚æ•°åŒ–æŸ¥è¯¢é˜²æŠ¤æœºåˆ¶](#2-å‚æ•°åŒ–æŸ¥è¯¢é˜²æŠ¤æœºåˆ¶)
3. [è¾“å…¥éªŒè¯ä¸è¿‡æ»¤ç­–ç•¥](#3-è¾“å…¥éªŒè¯ä¸è¿‡æ»¤ç­–ç•¥)
4. [ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†](#4-ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†)
5. [ç™½åå•éªŒè¯æœºåˆ¶](#5-ç™½åå•éªŒè¯æœºåˆ¶)
6. [åŠ¨æ€SQLå®‰å…¨ç¼–ç å®è·µ](#6-åŠ¨æ€SQLå®‰å…¨ç¼–ç å®è·µ)
7. [å®‰å…¨å®¡è®¡ä¸ç›‘æ§](#7-å®‰å…¨å®¡è®¡ä¸ç›‘æ§)
8. [SQLæ³¨å…¥æ£€æµ‹å·¥å…·](#8-SQLæ³¨å…¥æ£€æµ‹å·¥å…·)
9. [åŠ¨æ€æƒé™æ£€æŸ¥](#9-åŠ¨æ€æƒé™æ£€æŸ¥)
10. [å®‰å…¨è¾¹ç•Œæ§åˆ¶](#10-å®‰å…¨è¾¹ç•Œæ§åˆ¶)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ SQLæ³¨å…¥æ”»å‡»åŸç†


### 1.1 ä»€ä¹ˆæ˜¯SQLæ³¨å…¥æ”»å‡»


**ç®€å•ç†è§£**ï¼šSQLæ³¨å…¥å°±åƒåœ¨å¯¹è¯ä¸­æ’å…¥æ¶æ„æŒ‡ä»¤ï¼Œè®©æ•°æ®åº“è¯¯ä»¥ä¸ºæ˜¯æ­£å¸¸å‘½ä»¤å¹¶æ‰§è¡Œã€‚

```
æ­£å¸¸æŸ¥è¯¢æ„å›¾ï¼šæŸ¥æ‰¾ç”¨æˆ·"å¼ ä¸‰"çš„ä¿¡æ¯
æ¶æ„è¾“å…¥ï¼šå¼ ä¸‰'; DROP TABLE users; --

æœ€ç»ˆæ‰§è¡Œçš„SQLï¼š
SELECT * FROM users WHERE name = 'å¼ ä¸‰'; DROP TABLE users; --'
ç»“æœï¼šä¸ä»…æŸ¥è¯¢äº†å¼ ä¸‰ï¼Œè¿˜åˆ é™¤äº†æ•´ä¸ªç”¨æˆ·è¡¨ï¼
```

### 1.2 SQLæ³¨å…¥æ”»å‡»çš„åŸºæœ¬åŸç†


**æ ¸å¿ƒé—®é¢˜**ï¼šå°†ç”¨æˆ·è¾“å…¥ç›´æ¥æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­ï¼Œæ²¡æœ‰åŒºåˆ†æ•°æ®å’Œä»£ç ã€‚

```java
// å±é™©çš„åšæ³• - ç›´æ¥å­—ç¬¦ä¸²æ‹¼æ¥
public User getUserByName(String username) {
    String sql = "SELECT * FROM users WHERE username = '" + username + "'";
    // å¦‚æœusernameæ˜¯ï¼šadmin'; DROP TABLE users; --
    // å®é™…æ‰§è¡Œï¼šSELECT * FROM users WHERE username = 'admin'; DROP TABLE users; --'
    return executeQuery(sql);
}
```

### 1.3 å¸¸è§çš„SQLæ³¨å…¥ç±»å‹


```
ç»å…¸å‹æ³¨å…¥ï¼š
è¾“å…¥ï¼š' OR '1'='1
ç»“æœï¼šWHERE username = '' OR '1'='1'  (æ°¸è¿œä¸ºçœŸ)

è”åˆæŸ¥è¯¢æ³¨å…¥ï¼š
è¾“å…¥ï¼š' UNION SELECT password FROM admin_users --
ç»“æœï¼šè·å–ç®¡ç†å‘˜å¯†ç 

ç›²æ³¨å…¥ï¼š
è¾“å…¥ï¼š' AND (SELECT COUNT(*) FROM users) > 10 --
ç»“æœï¼šé€šè¿‡çœŸå‡åˆ¤æ–­è·å–ä¿¡æ¯

æ—¶é—´å‹ç›²æ³¨ï¼š
è¾“å…¥ï¼š'; WAITFOR DELAY '00:00:05' --
ç»“æœï¼šé€šè¿‡å»¶æ—¶åˆ¤æ–­SQLæ˜¯å¦æ‰§è¡Œ
```

**æ”»å‡»æµç¨‹å›¾ç¤º**ï¼š
```
ç”¨æˆ·è¾“å…¥ â†’ Webåº”ç”¨ â†’ SQLæ‹¼æ¥ â†’ æ•°æ®åº“æ‰§è¡Œ
    â†“           â†“         â†“          â†“
  æ¶æ„ä»£ç  â†’ æœªè¿‡æ»¤ â†’ æ¶æ„SQL â†’ æ•°æ®æ³„éœ²/ç ´å

æ­£ç¡®æµç¨‹ï¼š
ç”¨æˆ·è¾“å…¥ â†’ å‚æ•°åŒ–æŸ¥è¯¢ â†’ å®‰å…¨æ‰§è¡Œ â†’ è¿”å›ç»“æœ
    â†“           â†“            â†“         â†“
  ä»»ä½•è¾“å…¥ â†’ è‡ªåŠ¨è½¬ä¹‰ â†’ åªä½œä¸ºæ•°æ® â†’ å®‰å…¨å¯é 
```

---

## 2. ğŸ›¡ï¸ å‚æ•°åŒ–æŸ¥è¯¢é˜²æŠ¤æœºåˆ¶


### 2.1 å‚æ•°åŒ–æŸ¥è¯¢çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šå°†SQLè¯­å¥çš„ç»“æ„å’Œæ•°æ®åˆ†ç¦»ï¼Œè®©æ•°æ®åº“æ˜ç¡®çŸ¥é“å“ªäº›æ˜¯ä»£ç ï¼Œå“ªäº›æ˜¯æ•°æ®ã€‚

```java
// å®‰å…¨çš„å‚æ•°åŒ–æŸ¥è¯¢
public User getUserByName(String username) {
    String sql = "SELECT * FROM users WHERE username = ?";
    PreparedStatement stmt = connection.prepareStatement(sql);
    stmt.setString(1, username);  // æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½åªä¼šè¢«å½“ä½œæ•°æ®
    return stmt.executeQuery();
}
```

### 2.2 ä¸åŒè¯­è¨€çš„å‚æ•°åŒ–æŸ¥è¯¢å®ç°


**Java JDBCç¤ºä¾‹**ï¼š
```java
// æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
public List<User> searchUsers(String name, int age) {
    String sql = "SELECT id, username, email FROM users WHERE name LIKE ? AND age > ?";
    
    try (PreparedStatement stmt = connection.prepareStatement(sql)) {
        stmt.setString(1, "%" + name + "%");
        stmt.setInt(2, age);
        
        ResultSet rs = stmt.executeQuery();
        return mapToUserList(rs);
    }
}
```

**PHP PDOç¤ºä¾‹**ï¼š
```php
// ç”¨æˆ·ç™»å½•éªŒè¯
function loginUser($username, $password) {
    $sql = "SELECT id, role FROM users WHERE username = ? AND password = ?";
    $stmt = $pdo->prepare($sql);
    $stmt->execute([$username, hash('sha256', $password)]);
    return $stmt->fetch();
}
```

**Pythonç¤ºä¾‹**ï¼š
```python
# æ’å…¥æ–°ç”¨æˆ·
def create_user(cursor, username, email, age):
    sql = "INSERT INTO users (username, email, age) VALUES (%s, %s, %s)"
    cursor.execute(sql, (username, email, age))
    return cursor.lastrowid
```

### 2.3 å‚æ•°åŒ–æŸ¥è¯¢çš„ä¼˜åŠ¿


```
ğŸ”¸ å®‰å…¨æ€§ï¼šå®Œå…¨æœç»SQLæ³¨å…¥æ”»å‡»
ğŸ”¸ æ€§èƒ½ï¼šSQLè¯­å¥å¯ä»¥è¢«é¢„ç¼–è¯‘å’Œç¼“å­˜
ğŸ”¸ å¯è¯»æ€§ï¼šSQLç»“æ„æ¸…æ™°ï¼Œå‚æ•°æ˜ç¡®
ğŸ”¸ ç»´æŠ¤æ€§ï¼šä»£ç æ›´å®¹æ˜“ç†è§£å’Œä¿®æ”¹
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**ï¼šå‚æ•°åŒ–æŸ¥è¯¢å°±åƒå¡«ç©ºé¢˜ï¼Œé¢˜ç›®ç»“æ„å›ºå®šï¼Œåªæœ‰ç©ºæ ¼é‡Œçš„ç­”æ¡ˆå¯ä»¥å˜åŒ–ï¼Œæ— è®ºå¡«ä»€ä¹ˆéƒ½ä¸ä¼šæ”¹å˜é¢˜ç›®æœ¬èº«ã€‚

---

## 3. ğŸ” è¾“å…¥éªŒè¯ä¸è¿‡æ»¤ç­–ç•¥


### 3.1 è¾“å…¥éªŒè¯çš„åŸºæœ¬åŸåˆ™


**é˜²å¾¡å±‚æ¬¡**ï¼šæ°¸è¿œä¸è¦åªä¾èµ–å•ä¸€é˜²æŠ¤æ‰‹æ®µï¼Œè¦å»ºç«‹å¤šå±‚é˜²æŠ¤ä½“ç³»ã€‚

```
ç”¨æˆ·è¾“å…¥ â†’ å‰ç«¯éªŒè¯ â†’ åç«¯éªŒè¯ â†’ å‚æ•°åŒ–æŸ¥è¯¢ â†’ æ•°æ®åº“æ‰§è¡Œ
    â†“         â†“         â†“           â†“            â†“
  ä½“éªŒä¼˜åŒ–   å®‰å…¨æ£€æŸ¥   æ ¸å¿ƒé˜²æŠ¤    æœ€ç»ˆä¿éšœ     å®‰å…¨æ‰§è¡Œ
```

### 3.2 æ•°æ®ç±»å‹éªŒè¯


```java
public class InputValidator {
    
    // éªŒè¯ç”¨æˆ·IDï¼ˆåªèƒ½æ˜¯æ­£æ•´æ•°ï¼‰
    public boolean isValidUserId(String input) {
        return input.matches("^[1-9]\\d*$");
    }
    
    // éªŒè¯é‚®ç®±æ ¼å¼
    public boolean isValidEmail(String email) {
        String emailRegex = "^[A-Za-z0-9+_.-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$";
        return email.matches(emailRegex);
    }
    
    // éªŒè¯ç”¨æˆ·åï¼ˆå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼Œ3-20ä½ï¼‰
    public boolean isValidUsername(String username) {
        return username.matches("^[a-zA-Z0-9_]{3,20}$");
    }
}
```

### 3.3 è¾“å…¥é•¿åº¦æ§åˆ¶


```java
public class LengthValidator {
    
    public String validateUserInput(String input, int maxLength) {
        if (input == null) return "";
        
        // ç§»é™¤é¦–å°¾ç©ºæ ¼
        input = input.trim();
        
        // é•¿åº¦æ£€æŸ¥
        if (input.length() > maxLength) {
            throw new IllegalArgumentException("è¾“å…¥é•¿åº¦è¶…è¿‡é™åˆ¶ï¼š" + maxLength);
        }
        
        return input;
    }
}
```

### 3.4 å±é™©å­—ç¬¦è¿‡æ»¤


```java
public class DangerousCharFilter {
    
    // SQLæ³¨å…¥å¸¸è§å±é™©å­—ç¬¦
    private static final String[] SQL_KEYWORDS = {
        "select", "insert", "update", "delete", "drop", "create", 
        "alter", "exec", "execute", "sp_", "xp_", "union", "script"
    };
    
    public boolean containsSQLKeywords(String input) {
        String lowerInput = input.toLowerCase();
        for (String keyword : SQL_KEYWORDS) {
            if (lowerInput.contains(keyword)) {
                return true;
            }
        }
        return false;
    }
    
    // ç§»é™¤å±é™©å­—ç¬¦
    public String sanitizeInput(String input) {
        return input.replaceAll("[';\"\\-\\-/\\*\\*/]", "");
    }
}
```

---

## 4. ğŸ”’ ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰å¤„ç†


### 4.1 MySQLç‰¹æ®Šå­—ç¬¦è½¬ä¹‰è§„åˆ™


**éœ€è¦è½¬ä¹‰çš„å­—ç¬¦**ï¼š
```
å­—ç¬¦     è½¬ä¹‰å      è¯´æ˜
'    â†’   \'        å•å¼•å·
"    â†’   \"        åŒå¼•å·  
\    â†’   \\        åæ–œæ 
%    â†’   \%        é€šé…ç¬¦
_    â†’   \_        é€šé…ç¬¦
```

### 4.2 æ‰‹åŠ¨è½¬ä¹‰å®ç°ï¼ˆä»…ç”¨äºç†è§£åŸç†ï¼‰


```java
// æ³¨æ„ï¼šå®é™…å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œè¿™é‡Œä»…ç”¨äºç†è§£è½¬ä¹‰åŸç†
public class MySQLEscaper {
    
    public static String escapeString(String input) {
        if (input == null) return null;
        
        return input
            .replace("\\", "\\\\")  // åæ–œæ å¿…é¡»é¦–å…ˆè½¬ä¹‰
            .replace("'", "\\'")    // å•å¼•å·è½¬ä¹‰
            .replace("\"", "\\\"")  // åŒå¼•å·è½¬ä¹‰
            .replace("\n", "\\n")   // æ¢è¡Œç¬¦è½¬ä¹‰
            .replace("\r", "\\r")   // å›è½¦ç¬¦è½¬ä¹‰
            .replace("\t", "\\t");  // åˆ¶è¡¨ç¬¦è½¬ä¹‰
    }
}
```

### 4.3 ä½¿ç”¨æ•°æ®åº“æä¾›çš„è½¬ä¹‰å‡½æ•°


```java
// MySQLæä¾›çš„è½¬ä¹‰å‡½æ•°
public String safeQuery(String userInput) {
    // ä½¿ç”¨MySQLçš„è½¬ä¹‰å‡½æ•°
    String escapedInput = "SELECT QUOTE('" + userInput + "')";
    // ä½†ä»ç„¶æ¨èä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
    String sql = "SELECT * FROM users WHERE name = ?";
    return sql;
}
```

> **âš ï¸ é‡è¦æé†’**ï¼šè½¬ä¹‰åªæ˜¯åº”æ€¥æ‰‹æ®µï¼Œå‚æ•°åŒ–æŸ¥è¯¢æ‰æ˜¯æœ€ä½³å®è·µï¼

---

## 5. âœ… ç™½åå•éªŒè¯æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯ç™½åå•éªŒè¯


**æ ¸å¿ƒæ€æƒ³**ï¼šåªå…è®¸æ˜ç¡®å®‰å…¨çš„è¾“å…¥é€šè¿‡ï¼Œè€Œä¸æ˜¯è¯•å›¾é˜»æ­¢æ‰€æœ‰å±é™©è¾“å…¥ã€‚

```java
public class WhitelistValidator {
    
    // å…è®¸çš„æ’åºå­—æ®µç™½åå•
    private static final Set<String> ALLOWED_SORT_FIELDS = Set.of(
        "id", "username", "email", "created_time", "updated_time"
    );
    
    // å…è®¸çš„æ’åºæ–¹å‘
    private static final Set<String> ALLOWED_SORT_DIRECTIONS = Set.of("ASC", "DESC");
    
    public String buildSortClause(String field, String direction) {
        // éªŒè¯æ’åºå­—æ®µ
        if (!ALLOWED_SORT_FIELDS.contains(field)) {
            throw new IllegalArgumentException("ä¸å…è®¸çš„æ’åºå­—æ®µ: " + field);
        }
        
        // éªŒè¯æ’åºæ–¹å‘
        if (!ALLOWED_SORT_DIRECTIONS.contains(direction.toUpperCase())) {
            throw new IllegalArgumentException("ä¸å…è®¸çš„æ’åºæ–¹å‘: " + direction);
        }
        
        return "ORDER BY " + field + " " + direction;
    }
}
```

### 5.2 è¡¨åå’Œåˆ—åç™½åå•


```java
public class DatabaseWhitelist {
    
    // å…è®¸æŸ¥è¯¢çš„è¡¨å
    private static final Map<String, Set<String>> TABLE_COLUMNS = Map.of(
        "users", Set.of("id", "username", "email", "status"),
        "orders", Set.of("id", "user_id", "amount", "status", "created_time"),
        "products", Set.of("id", "name", "price", "category")
    );
    
    public String buildSelectQuery(String tableName, List<String> columns) {
        // éªŒè¯è¡¨å
        if (!TABLE_COLUMNS.containsKey(tableName)) {
            throw new IllegalArgumentException("ä¸å…è®¸è®¿é—®çš„è¡¨: " + tableName);
        }
        
        Set<String> allowedColumns = TABLE_COLUMNS.get(tableName);
        
        // éªŒè¯åˆ—å
        for (String column : columns) {
            if (!allowedColumns.contains(column)) {
                throw new IllegalArgumentException("è¡¨ " + tableName + " ä¸å…è®¸è®¿é—®åˆ—: " + column);
            }
        }
        
        return "SELECT " + String.join(", ", columns) + " FROM " + tableName;
    }
}
```

### 5.3 ä¸šåŠ¡è§„åˆ™ç™½åå•


```java
public class BusinessRuleValidator {
    
    // ç”¨æˆ·çŠ¶æ€ç™½åå•
    private static final Set<String> VALID_USER_STATUS = Set.of(
        "active", "inactive", "pending", "suspended"
    );
    
    // è®¢å•çŠ¶æ€æµè½¬è§„åˆ™
    private static final Map<String, Set<String>> STATUS_TRANSITIONS = Map.of(
        "pending", Set.of("confirmed", "cancelled"),
        "confirmed", Set.of("shipped", "cancelled"),
        "shipped", Set.of("delivered", "returned")
    );
    
    public boolean isValidStatusTransition(String currentStatus, String newStatus) {
        Set<String> allowedTransitions = STATUS_TRANSITIONS.get(currentStatus);
        return allowedTransitions != null && allowedTransitions.contains(newStatus);
    }
}
```

---

## 6. ğŸ” åŠ¨æ€SQLå®‰å…¨ç¼–ç å®è·µ


### 6.1 å®‰å…¨çš„åŠ¨æ€SQLæ„å»ºæ¨¡å¼


```java
public class SafeDynamicSQL {
    
    // å®‰å…¨çš„æ¡ä»¶æŸ¥è¯¢æ„å»º
    public List<User> searchUsersWithConditions(UserSearchCriteria criteria) {
        StringBuilder sql = new StringBuilder("SELECT id, username, email FROM users WHERE 1=1");
        List<Object> params = new ArrayList<>();
        
        // åŠ¨æ€æ·»åŠ æ¡ä»¶
        if (criteria.getUsername() != null) {
            sql.append(" AND username LIKE ?");
            params.add("%" + criteria.getUsername() + "%");
        }
        
        if (criteria.getMinAge() != null) {
            sql.append(" AND age >= ?");
            params.add(criteria.getMinAge());
        }
        
        if (criteria.getStatus() != null) {
            sql.append(" AND status = ?");
            params.add(criteria.getStatus());
        }
        
        // å®‰å…¨çš„æ’åºï¼ˆä½¿ç”¨ç™½åå•ï¼‰
        if (criteria.getSortField() != null) {
            String sortClause = validateAndBuildSort(criteria.getSortField(), criteria.getSortDirection());
            sql.append(" ").append(sortClause);
        }
        
        return executeQuery(sql.toString(), params);
    }
}
```

### 6.2 æ‰¹é‡æ“ä½œçš„å®‰å…¨å®ç°


```java
public class SafeBatchOperations {
    
    // å®‰å…¨çš„æ‰¹é‡æ’å…¥
    public void batchInsertUsers(List<User> users) {
        String sql = "INSERT INTO users (username, email, age) VALUES (?, ?, ?)";
        
        try (PreparedStatement stmt = connection.prepareStatement(sql)) {
            for (User user : users) {
                // éªŒè¯æ¯ä¸ªç”¨æˆ·æ•°æ®
                validateUser(user);
                
                stmt.setString(1, user.getUsername());
                stmt.setString(2, user.getEmail());
                stmt.setInt(3, user.getAge());
                stmt.addBatch();
            }
            
            stmt.executeBatch();
        }
    }
    
    private void validateUser(User user) {
        if (user.getUsername() == null || user.getUsername().trim().isEmpty()) {
            throw new IllegalArgumentException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
        }
        if (!isValidEmail(user.getEmail())) {
            throw new IllegalArgumentException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®");
        }
        if (user.getAge() < 0 || user.getAge() > 150) {
            throw new IllegalArgumentException("å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´");
        }
    }
}
```

### 6.3 å­˜å‚¨è¿‡ç¨‹è°ƒç”¨çš„å®‰å…¨å®è·µ


```java
public class SafeStoredProcedure {
    
    // å®‰å…¨è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
    public UserStatistics getUserStatistics(int userId, String dateRange) {
        // éªŒè¯è¾“å…¥å‚æ•°
        if (userId <= 0) {
            throw new IllegalArgumentException("ç”¨æˆ·IDå¿…é¡»å¤§äº0");
        }
        
        // ç™½åå•éªŒè¯æ—¥æœŸèŒƒå›´
        if (!isValidDateRange(dateRange)) {
            throw new IllegalArgumentException("ä¸æ”¯æŒçš„æ—¥æœŸèŒƒå›´");
        }
        
        String sql = "{CALL sp_get_user_statistics(?, ?)}";
        
        try (CallableStatement stmt = connection.prepareCall(sql)) {
            stmt.setInt(1, userId);
            stmt.setString(2, dateRange);
            
            ResultSet rs = stmt.executeQuery();
            return mapToUserStatistics(rs);
        }
    }
    
    private boolean isValidDateRange(String dateRange) {
        Set<String> validRanges = Set.of("7days", "30days", "90days", "1year");
        return validRanges.contains(dateRange);
    }
}
```

---

## 7. ğŸ“Š å®‰å…¨å®¡è®¡ä¸ç›‘æ§


### 7.1 SQLæ‰§è¡Œæ—¥å¿—è®°å½•


```java
public class SQLAuditLogger {
    
    private static final Logger securityLogger = LoggerFactory.getLogger("SECURITY");
    
    public void logSQLExecution(String sql, Object[] params, String userId, long executionTime) {
        SecurityEvent event = SecurityEvent.builder()
            .timestamp(Instant.now())
            .userId(userId)
            .sqlStatement(sql)
            .parameters(Arrays.toString(params))
            .executionTime(executionTime)
            .build();
            
        securityLogger.info("SQLæ‰§è¡Œè®°å½•: {}", event);
        
        // æ£€æµ‹å¯ç–‘æ´»åŠ¨
        if (isSuspiciousActivity(sql, executionTime)) {
            securityLogger.warn("æ£€æµ‹åˆ°å¯ç–‘SQLæ´»åŠ¨: {}", event);
            alertSecurityTeam(event);
        }
    }
    
    private boolean isSuspiciousActivity(String sql, long executionTime) {
        // æ‰§è¡Œæ—¶é—´è¿‡é•¿
        if (executionTime > 10000) return true;
        
        // åŒ…å«æ•æ„Ÿæ“ä½œ
        String lowerSql = sql.toLowerCase();
        return lowerSql.contains("drop table") || 
               lowerSql.contains("truncate") ||
               lowerSql.contains("delete from") && !lowerSql.contains("where");
    }
}
```

### 7.2 å¼‚å¸¸è¡Œä¸ºç›‘æ§


```java
public class SQLInjectionDetector {
    
    private final Map<String, AttemptCounter> userAttempts = new ConcurrentHashMap<>();
    
    public void checkForInjectionAttempt(String userId, String input) {
        if (containsPotentialInjection(input)) {
            recordAttempt(userId);
            
            AttemptCounter counter = userAttempts.get(userId);
            if (counter.getCount() > 5) {
                // è¶…è¿‡é˜ˆå€¼ï¼Œé‡‡å–ä¿æŠ¤æªæ–½
                blockUser(userId);
                alertSecurityTeam(userId, input);
            }
        }
    }
    
    private boolean containsPotentialInjection(String input) {
        String[] injectionPatterns = {
            "' or ", "' union ", "'; drop ", "' and 1=1",
            "admin'--", "' having ", "' group by "
        };
        
        String lowerInput = input.toLowerCase();
        return Arrays.stream(injectionPatterns)
                    .anyMatch(lowerInput::contains);
    }
    
    private void recordAttempt(String userId) {
        userAttempts.computeIfAbsent(userId, k -> new AttemptCounter())
                   .increment();
    }
}
```

---

## 8. ğŸ”§ SQLæ³¨å…¥æ£€æµ‹å·¥å…·


### 8.1 è‡ªåŠ¨åŒ–æ£€æµ‹å·¥å…·


**å¸¸ç”¨å·¥å…·å¯¹æ¯”**ï¼š

| å·¥å…·åç§° | **ç±»å‹** | **ä¼˜åŠ¿** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **SQLMap** | `æ¸—é€æµ‹è¯•` | `åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤šç§æ•°æ®åº“` | `å®‰å…¨æµ‹è¯•ï¼Œæ¼æ´å‘ç°` |
| **Burp Suite** | `Webå®‰å…¨` | `ç•Œé¢å‹å¥½ï¼Œé›†æˆåº¦é«˜` | `Webåº”ç”¨å®‰å…¨æµ‹è¯•` |
| **OWASP ZAP** | `å¼€æºæ‰«æ` | `å…è´¹ï¼Œç¤¾åŒºæ”¯æŒå¥½` | `æŒç»­å®‰å…¨æµ‹è¯•` |
| **Nessus** | `æ¼æ´æ‰«æ` | `ä¼ä¸šçº§ï¼ŒæŠ¥å‘Šè¯¦ç»†` | `å¤§å‹ä¼ä¸šå®‰å…¨å®¡è®¡` |

### 8.2 ä»£ç é™æ€åˆ†æ


```java
// ä½¿ç”¨SpotBugsæˆ–SonarQubeæ£€æµ‹çš„ä¸å®‰å…¨ä»£ç æ¨¡å¼
public class UnsafePatterns {
    
    // BAD: ä¼šè¢«é™æ€åˆ†æå·¥å…·æ ‡è®°
    public void vulnerableMethod(String userInput) {
        String sql = "SELECT * FROM users WHERE name = '" + userInput + "'";
        // SpotBugsä¼šæŠ¥å‘Š: SQL_PREPARED_STATEMENT_GENERATED_FROM_NONCONSTANT_STRING
    }
    
    // GOOD: å®‰å…¨çš„å®ç°
    public void safeMethod(String userInput) {
        String sql = "SELECT * FROM users WHERE name = ?";
        // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå·¥å…·ä¸ä¼šæŠ¥è­¦
    }
}
```

### 8.3 è¿è¡Œæ—¶æ£€æµ‹æœºåˆ¶


```java
public class RuntimeSQLDetector {
    
    // SQLæ³¨å…¥è¿è¡Œæ—¶æ£€æµ‹
    public boolean detectInjectionAtRuntime(String originalSQL, String finalSQL) {
        // æ£€æµ‹SQLç»“æ„æ˜¯å¦å‘ç”Ÿå˜åŒ–
        String normalizedOriginal = normalizeSQL(originalSQL);
        String normalizedFinal = normalizeSQL(finalSQL);
        
        // å¦‚æœç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å­˜åœ¨æ³¨å…¥
        if (!normalizedOriginal.equals(normalizedFinal)) {
            logSecurityIncident("SQLç»“æ„å‘ç”Ÿå¼‚å¸¸å˜åŒ–", originalSQL, finalSQL);
            return true;
        }
        
        return false;
    }
    
    private String normalizeSQL(String sql) {
        // ç§»é™¤å­—ç¬¦ä¸²å­—é¢é‡ï¼Œåªä¿ç•™SQLç»“æ„
        return sql.replaceAll("'[^']*'", "'?'")
                 .replaceAll("\\d+", "?")
                 .toLowerCase()
                 .replaceAll("\\s+", " ");
    }
}
```

---

## 9. ğŸ”‘ åŠ¨æ€æƒé™æ£€æŸ¥


### 9.1 åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶


```java
public class DynamicPermissionChecker {
    
    // æƒé™æ£€æŸ¥æšä¸¾
    public enum Permission {
        READ_USER, WRITE_USER, DELETE_USER,
        READ_ORDER, WRITE_ORDER, READ_ADMIN_DATA
    }
    
    public boolean hasPermission(String userId, Permission permission, String resourceId) {
        User user = getUserById(userId);
        
        // æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™
        if (!user.getRoles().stream()
                .anyMatch(role -> role.hasPermission(permission))) {
            return false;
        }
        
        // æ£€æŸ¥èµ„æºçº§æƒé™
        return checkResourcePermission(user, permission, resourceId);
    }
    
    private boolean checkResourcePermission(User user, Permission permission, String resourceId) {
        switch (permission) {
            case READ_USER:
            case WRITE_USER:
                // ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ï¼Œæˆ–è€…ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰æ•°æ®
                return user.getId().equals(resourceId) || user.hasRole("ADMIN");
                
            case READ_ORDER:
                // æ£€æŸ¥è®¢å•æ˜¯å¦å±äºè¯¥ç”¨æˆ·
                return isOrderOwnedByUser(resourceId, user.getId());
                
            default:
                return false;
        }
    }
}
```

### 9.2 åŠ¨æ€SQLæƒé™è¿‡æ»¤


```java
public class PermissionBasedQueryBuilder {
    
    public String buildUserQueryWithPermission(String currentUserId, String targetUserId) {
        StringBuilder sql = new StringBuilder("SELECT ");
        
        // æ ¹æ®æƒé™å†³å®šå¯æŸ¥è¯¢çš„å­—æ®µ
        if (hasAdminPermission(currentUserId)) {
            sql.append("id, username, email, phone, status, created_time");
        } else if (currentUserId.equals(targetUserId)) {
            sql.append("id, username, email, created_time");
        } else {
            sql.append("id, username");  // å…¶ä»–ç”¨æˆ·åªèƒ½çœ‹åˆ°åŸºæœ¬ä¿¡æ¯
        }
        
        sql.append(" FROM users WHERE id = ?");
        
        // éç®¡ç†å‘˜åªèƒ½æŸ¥è¯¢æ¿€æ´»ç”¨æˆ·
        if (!hasAdminPermission(currentUserId)) {
            sql.append(" AND status = 'active'");
        }
        
        return sql.toString();
    }
}
```

### 9.3 æ•°æ®è„±æ•ä¸æƒé™


```java
public class DataMaskingService {
    
    public UserInfo getMaskedUserInfo(String requesterId, String targetUserId) {
        UserInfo userInfo = getUserInfo(targetUserId);
        
        // æ ¹æ®æƒé™å†³å®šè„±æ•çº§åˆ«
        if (!hasPermissionToViewSensitiveData(requesterId, targetUserId)) {
            userInfo = maskSensitiveData(userInfo);
        }
        
        return userInfo;
    }
    
    private UserInfo maskSensitiveData(UserInfo userInfo) {
        return UserInfo.builder()
            .id(userInfo.getId())
            .username(userInfo.getUsername())
            .email(maskEmail(userInfo.getEmail()))          // è„±æ•é‚®ç®±
            .phone(maskPhone(userInfo.getPhone()))          // è„±æ•ç”µè¯
            .address(null)                                  // éšè—åœ°å€
            .build();
    }
    
    private String maskEmail(String email) {
        if (email == null) return null;
        int atIndex = email.indexOf('@');
        if (atIndex <= 1) return email;
        
        return email.charAt(0) + "***" + email.substring(atIndex);
    }
}
```

---

## 10. ğŸ¯ å®‰å…¨è¾¹ç•Œæ§åˆ¶


### 10.1 æ•°æ®åº“è¿æ¥å®‰å…¨


```java
public class SecureConnectionManager {
    
    public DataSource createSecureDataSource() {
        HikariConfig config = new HikariConfig();
        
        // åŸºæœ¬è¿æ¥é…ç½®
        config.setJdbcUrl("jdbc:mysql://localhost:3306/mydb");
        config.setUsername("app_user");  // ä½¿ç”¨ä¸“é—¨çš„åº”ç”¨ç”¨æˆ·ï¼Œä¸ç”¨root
        config.setPassword(getEncryptedPassword());
        
        // å®‰å…¨é…ç½®
        config.addDataSourceProperty("useSSL", "true");              // å¯ç”¨SSL
        config.addDataSourceProperty("requireSSL", "true");          // å¼ºåˆ¶SSL
        config.addDataSourceProperty("allowPublicKeyRetrieval", "false");
        config.addDataSourceProperty("autoReconnect", "false");      // ç¦æ­¢è‡ªåŠ¨é‡è¿
        
        // è¿æ¥æ± å®‰å…¨é…ç½®
        config.setMaximumPoolSize(20);                               // é™åˆ¶è¿æ¥æ•°
        config.setConnectionTimeout(30000);                         // 30ç§’è¶…æ—¶
        config.setIdleTimeout(600000);                              // 10åˆ†é’Ÿç©ºé—²è¶…æ—¶
        config.setMaxLifetime(1800000);                             // 30åˆ†é’Ÿæœ€å¤§ç”Ÿå‘½å‘¨æœŸ
        
        return new HikariDataSource(config);
    }
}
```

### 10.2 æœ€å°æƒé™åŸåˆ™


```sql
-- ä¸ºåº”ç”¨åˆ›å»ºä¸“é—¨çš„æ•°æ®åº“ç”¨æˆ·
CREATE USER 'app_user'@'%' IDENTIFIED BY 'strong_random_password';

-- åªæˆäºˆå¿…è¦çš„æƒé™
GRANT SELECT, INSERT, UPDATE ON myapp.users TO 'app_user'@'%';
GRANT SELECT, INSERT, UPDATE ON myapp.orders TO 'app_user'@'%';
GRANT SELECT ON myapp.products TO 'app_user'@'%';

-- ç¦æ­¢åˆ é™¤å’Œç»“æ„ä¿®æ”¹æƒé™
-- ä¸æˆäºˆ DELETE, DROP, CREATE, ALTER ç­‰å±é™©æƒé™

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

### 10.3 ç½‘ç»œå±‚å®‰å…¨æ§åˆ¶


```java
public class NetworkSecurityConfig {
    
    // æ•°æ®åº“è®¿é—®IPç™½åå•
    private static final Set<String> ALLOWED_IPS = Set.of(
        "192.168.1.10",    // åº”ç”¨æœåŠ¡å™¨1
        "192.168.1.11",    // åº”ç”¨æœåŠ¡å™¨2
        "192.168.1.100"    // ç®¡ç†æœåŠ¡å™¨
    );
    
    public boolean isAllowedToConnect(String clientIP) {
        // æ£€æŸ¥IPç™½åå•
        if (!ALLOWED_IPS.contains(clientIP)) {
            logSecurityEvent("æœªæˆæƒIPå°è¯•è¿æ¥æ•°æ®åº“", clientIP);
            return false;
        }
        
        // æ£€æŸ¥è¿æ¥é¢‘ç‡é™åˆ¶
        return checkConnectionRate(clientIP);
    }
    
    private boolean checkConnectionRate(String clientIP) {
        // å®ç°è¿æ¥é¢‘ç‡é™åˆ¶é€»è¾‘
        // ä¾‹å¦‚ï¼šæ¯åˆ†é’Ÿæœ€å¤š100æ¬¡è¿æ¥
        return true;
    }
}
```

### 10.4 æ•°æ®ä¼ è¾“å®‰å…¨


```java
public class DataTransmissionSecurity {
    
    // æ•æ„Ÿæ•°æ®åŠ å¯†ä¼ è¾“
    public String encryptSensitiveData(String data) {
        try {
            Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
            cipher.init(Cipher.ENCRYPT_MODE, getSecretKey());
            
            byte[] encrypted = cipher.doFinal(data.getBytes());
            return Base64.getEncoder().encodeToString(encrypted);
        } catch (Exception e) {
            throw new SecurityException("æ•°æ®åŠ å¯†å¤±è´¥", e);
        }
    }
    
    // SSL/TLSé…ç½®æ£€æŸ¥
    public void validateSSLConnection(Connection connection) {
        try {
            DatabaseMetaData metaData = connection.getMetaData();
            String url = metaData.getURL();
            
            if (!url.contains("useSSL=true")) {
                throw new SecurityException("æ•°æ®åº“è¿æ¥å¿…é¡»ä½¿ç”¨SSL");
            }
            
        } catch (SQLException e) {
            throw new SecurityException("SSLè¿æ¥éªŒè¯å¤±è´¥", e);
        }
    }
}
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŸåˆ™


```
ğŸ”¸ å‚æ•°åŒ–æŸ¥è¯¢ï¼šæœ€é‡è¦çš„é˜²æŠ¤æ‰‹æ®µï¼Œæ°¸è¿œä¸è¦æ‹¼æ¥SQL
ğŸ”¸ è¾“å…¥éªŒè¯ï¼šå¤šå±‚é˜²æŠ¤ï¼Œå‰ç«¯åç«¯éƒ½è¦éªŒè¯
ğŸ”¸ æœ€å°æƒé™ï¼šæ•°æ®åº“ç”¨æˆ·åªç»™å¿…è¦çš„æƒé™
ğŸ”¸ ç™½åå•æœºåˆ¶ï¼šå…è®¸å®‰å…¨çš„ï¼Œè€Œä¸æ˜¯é˜»æ­¢å±é™©çš„
ğŸ”¸ å®‰å…¨å®¡è®¡ï¼šè®°å½•æ‰€æœ‰SQLæ‰§è¡Œï¼Œç›‘æ§å¼‚å¸¸è¡Œä¸º
```

### 11.2 å…³é”®å®‰å…¨å®è·µ


**ğŸ”¹ å¼€å‘é˜¶æ®µ**ï¼š
```
âœ… ä½¿ç”¨ORMæ¡†æ¶æˆ–å‚æ•°åŒ–æŸ¥è¯¢
âœ… ä»£ç reviewé‡ç‚¹æ£€æŸ¥SQLæ‹¼æ¥
âœ… é™æ€ä»£ç åˆ†æå·¥å…·æ£€æµ‹
âœ… å•å…ƒæµ‹è¯•è¦†ç›–SQLæ³¨å…¥åœºæ™¯
```

**ğŸ”¹ éƒ¨ç½²é˜¶æ®µ**ï¼š
```
âœ… æ•°æ®åº“ç”¨æˆ·æƒé™æœ€å°åŒ–
âœ… ç½‘ç»œè®¿é—®æ§åˆ¶ï¼ˆé˜²ç«å¢™ã€VPNï¼‰
âœ… SSL/TLSåŠ å¯†ä¼ è¾“
âœ… å®šæœŸå®‰å…¨æ‰«æ
```

**ğŸ”¹ è¿è¡Œé˜¶æ®µ**ï¼š
```
âœ… å®æ—¶ç›‘æ§SQLæ‰§è¡Œ
âœ… å¼‚å¸¸è¡Œä¸ºè‡ªåŠ¨å‘Šè­¦
âœ… å®šæœŸå®‰å…¨å®¡è®¡
âœ… åº”æ€¥å“åº”é¢„æ¡ˆ
```

### 11.3 å¸¸è§é”™è¯¯ä¸è§£å†³æ–¹æ¡ˆ


| **å¸¸è§é”™è¯¯** | **å±é™©ç­‰çº§** | **æ­£ç¡®åšæ³•** |
|-------------|-------------|-------------|
| `ç›´æ¥æ‹¼æ¥SQL` | `ğŸ”´ æé«˜` | `ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢` |
| `åªåœ¨å‰ç«¯éªŒè¯` | `ğŸ”´ é«˜` | `å‰åç«¯éƒ½è¦éªŒè¯` |
| `ä½¿ç”¨rootç”¨æˆ·` | `ğŸŸ¡ ä¸­` | `åˆ›å»ºä¸“é—¨åº”ç”¨ç”¨æˆ·` |
| `æ˜æ–‡ä¼ è¾“å¯†ç ` | `ğŸ”´ é«˜` | `SSLåŠ å¯†+å¯†ç å“ˆå¸Œ` |
| `ä¸è®°å½•å®‰å…¨æ—¥å¿—` | `ğŸŸ¡ ä¸­` | `å®Œæ•´çš„å®¡è®¡æ—¥å¿—` |

### 11.4 å®‰å…¨æ£€æŸ¥æ¸…å•


**ğŸ“‹ SQLæ³¨å…¥é˜²æŠ¤æ£€æŸ¥**ï¼š
- [ ] æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
- [ ] åŠ¨æ€SQLæ„å»ºä½¿ç”¨ç™½åå•éªŒè¯
- [ ] è¾“å…¥éªŒè¯åŒ…å«ç±»å‹ã€é•¿åº¦ã€æ ¼å¼æ£€æŸ¥
- [ ] æ•°æ®åº“ç”¨æˆ·æƒé™éµå¾ªæœ€å°æƒé™åŸåˆ™
- [ ] å¯ç”¨SSL/TLSåŠ å¯†ä¼ è¾“
- [ ] å®æ–½å®æ—¶ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- [ ] å®šæœŸè¿›è¡Œå®‰å…¨æµ‹è¯•å’Œæ¼æ´æ‰«æ

**ğŸ”§ åº”æ€¥å“åº”å‡†å¤‡**ï¼š
- [ ] SQLæ³¨å…¥æ”»å‡»æ£€æµ‹æœºåˆ¶
- [ ] è‡ªåŠ¨å°ç¦å¯ç–‘IPåŠŸèƒ½
- [ ] æ•°æ®åº“è®¿é—®æ—¥å¿—å®Œæ•´æ€§
- [ ] äº‹ä»¶å“åº”å›¢é˜Ÿè”ç³»æ–¹å¼
- [ ] æ•°æ®å¤‡ä»½å’Œæ¢å¤æµç¨‹

> **ğŸ’¡ ä¸€å¥è¯æ€»ç»“**ï¼šSQLæ³¨å…¥é˜²æŠ¤çš„æ ¸å¿ƒæ˜¯"æ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·è¾“å…¥ï¼Œæ°¸è¿œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢"ã€‚

> **ğŸ”‘ è®°å¿†å£è¯€**ï¼š
> - å‚æ•°åŒ–æŸ¥è¯¢æ˜¯æ ¹æœ¬ï¼Œè¾“å…¥éªŒè¯åšé˜²çº¿
> - æœ€å°æƒé™æ§è¿æ¥ï¼Œç™½åå•æœºåˆ¶ä¿å®‰å…¨  
> - ç›‘æ§å®¡è®¡å¸¸è¿è¡Œï¼Œå¤šå±‚é˜²æŠ¤æ— æ­»è§’

**æ ¸å¿ƒç†å¿µ**ï¼šå®‰å…¨ä¸æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œè€Œæ˜¯è´¯ç©¿æ•´ä¸ªè½¯ä»¶ç”Ÿå‘½å‘¨æœŸçš„æŒç»­è¿‡ç¨‹ã€‚åœ¨ä¾¿åˆ©æ€§å’Œå®‰å…¨æ€§ä¹‹é—´ï¼Œæ°¸è¿œä¼˜å…ˆé€‰æ‹©å®‰å…¨æ€§ã€‚