---
title: 8ã€åŠ¨æ€SQLæ€§èƒ½ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [åŠ¨æ€SQLæ€§èƒ½ç›‘æ§åŸºç¡€](#1-åŠ¨æ€SQLæ€§èƒ½ç›‘æ§åŸºç¡€)
2. [æ‰§è¡Œæ—¶é—´ç›‘æ§](#2-æ‰§è¡Œæ—¶é—´ç›‘æ§)
3. [ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡](#3-ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡)
4. [å†…å­˜ä½¿ç”¨ç›‘æ§](#4-å†…å­˜ä½¿ç”¨ç›‘æ§)
5. [è¯­å¥æ‰§è¡Œé¢‘æ¬¡åˆ†æ](#5-è¯­å¥æ‰§è¡Œé¢‘æ¬¡åˆ†æ)
6. [Performance Schemaæ·±å…¥åº”ç”¨](#6-Performance-Schemaæ·±å…¥åº”ç”¨)
7. [æ…¢æŸ¥è¯¢è¯†åˆ«ä¸ä¼˜åŒ–](#7-æ…¢æŸ¥è¯¢è¯†åˆ«ä¸ä¼˜åŒ–)
8. [æ€§èƒ½ç“¶é¢ˆåˆ†æ](#8-æ€§èƒ½ç“¶é¢ˆåˆ†æ)
9. [æ‰§è¡Œè®¡åˆ’åˆ†æå·¥å…·](#9-æ‰§è¡Œè®¡åˆ’åˆ†æå·¥å…·)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“Š åŠ¨æ€SQLæ€§èƒ½ç›‘æ§åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯åŠ¨æ€SQLæ€§èƒ½ç›‘æ§


åŠ¨æ€SQLæ€§èƒ½ç›‘æ§å°±æ˜¯**å®æ—¶è·Ÿè¸ªå’Œåˆ†æ**MySQLä¸­åŠ¨æ€ç”Ÿæˆçš„SQLè¯­å¥çš„æ‰§è¡Œæƒ…å†µã€‚

**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
ç®€å•ç†è§£ï¼š
å°±åƒç»™æ±½è½¦è£…ä¸ªä»ªè¡¨ç›˜ï¼Œéšæ—¶çœ‹åˆ°æ²¹è€—ã€é€Ÿåº¦ã€å‘åŠ¨æœºçŠ¶æ€
åŠ¨æ€SQLç›‘æ§ = ç»™æ•°æ®åº“è£…"ä»ªè¡¨ç›˜"ï¼Œéšæ—¶çœ‹SQLæ‰§è¡Œæƒ…å†µ

ç›‘æ§ä»€ä¹ˆï¼š
â€¢ è¿™æ¡SQLè·‘äº†å¤šä¹…ï¼Ÿ
â€¢ ç”¨äº†å¤šå°‘å†…å­˜ï¼Ÿ
â€¢ ç¼“å­˜æœ‰æ²¡æœ‰å‘½ä¸­ï¼Ÿ
â€¢ å“ªäº›SQLæ‰§è¡Œæœ€é¢‘ç¹ï¼Ÿ
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§åŠ¨æ€SQL**
```
é—®é¢˜åœºæ™¯ï¼š
ç”¨æˆ·åé¦ˆï¼š"ç³»ç»Ÿçªç„¶å˜æ…¢äº†ï¼"
å¼€å‘è¯´ï¼š"æˆ‘æ²¡æ”¹ä»£ç å•Šï¼"
DBAè¯´ï¼š"æ•°æ®åº“å‹åŠ›å¾ˆå¤§ï¼"

ç›‘æ§çš„ä»·å€¼ï¼š
âœ… å¿«é€Ÿå®šä½æ€§èƒ½é—®é¢˜
âœ… é¢„é˜²æ€§èƒ½æ¶åŒ–
âœ… ä¼˜åŒ–èµ„æºä½¿ç”¨
âœ… æå‡ç”¨æˆ·ä½“éªŒ
```

### 1.2 ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡


```
æ€§èƒ½ç›‘æ§å››å¤§ç»´åº¦ï¼š

ğŸ•’ æ—¶é—´ç»´åº¦
â€¢ æ‰§è¡Œæ—¶é—´ï¼ˆå“åº”æ—¶é—´ï¼‰
â€¢ ç­‰å¾…æ—¶é—´
â€¢ é”ç­‰å¾…æ—¶é—´

ğŸ’¾ èµ„æºç»´åº¦  
â€¢ å†…å­˜ä½¿ç”¨é‡
â€¢ CPUæ¶ˆè€—
â€¢ ç£ç›˜IOæ¬¡æ•°

ğŸ“ˆ é¢‘ç‡ç»´åº¦
â€¢ æ‰§è¡Œæ¬¡æ•°
â€¢ å¹¶å‘åº¦
â€¢ é”™è¯¯ç‡

ğŸ¯ è´¨é‡ç»´åº¦
â€¢ ç¼“å­˜å‘½ä¸­ç‡
â€¢ ç´¢å¼•ä½¿ç”¨ç‡
â€¢ è¡¨æ‰«ææ¬¡æ•°
```

---

## 2. â±ï¸ æ‰§è¡Œæ—¶é—´ç›‘æ§


### 2.1 åŸºæœ¬æ‰§è¡Œæ—¶é—´ç›‘æ§


**ğŸ”¸ å¼€å¯æŸ¥è¯¢æ—¶é—´è®°å½•**
```sql
-- å¼€å¯æŸ¥è¯¢æ—¥å¿—å’Œæ—¶é—´æ˜¾ç¤º
SET profiling = 1;
SET long_query_time = 0.1;  -- è®°å½•è¶…è¿‡0.1ç§’çš„æŸ¥è¯¢

-- æŸ¥çœ‹æœ€è¿‘æ‰§è¡Œçš„æŸ¥è¯¢
SHOW PROFILES;
```

**ğŸ“Š å®æ—¶æŸ¥è¯¢æ—¶é—´ç›‘æ§**
```sql
-- æŸ¥çœ‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŸ¥è¯¢
SELECT 
    id,
    user,
    host,
    db,
    command,
    time,                    -- æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰
    state,
    info                     -- SQLè¯­å¥
FROM information_schema.PROCESSLIST 
WHERE command != 'Sleep'
ORDER BY time DESC;
```

### 2.2 è¯¦ç»†æ‰§è¡Œæ—¶é—´åˆ†æ


**ğŸ”§ ä½¿ç”¨SHOW PROFILEåˆ†æå…·ä½“è€—æ—¶**
```sql
-- æ‰§è¡Œä¸€ä¸ªåŠ¨æ€SQL
SET @sql = 'SELECT * FROM orders WHERE user_id = 12345';
PREPARE stmt FROM @sql;
EXECUTE stmt;

-- æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¶é—´åˆ†è§£
SHOW PROFILE FOR QUERY 1;

-- æŸ¥çœ‹CPUå’ŒIOæ—¶é—´
SHOW PROFILE CPU, BLOCK IO FOR QUERY 1;
```

**ğŸ“ˆ åˆ›å»ºæ‰§è¡Œæ—¶é—´ç›‘æ§è§†å›¾**
```sql
-- åˆ›å»ºç®€åŒ–çš„æ‰§è¡Œæ—¶é—´ç›‘æ§è§†å›¾
CREATE VIEW sql_timing_monitor AS
SELECT 
    QUERY_ID,
    ROUND(SUM(DURATION), 6) as total_time,
    ROUND(SUM(CASE WHEN STATE = 'executing' THEN DURATION END), 6) as exec_time,
    ROUND(SUM(CASE WHEN STATE = 'Sending data' THEN DURATION END), 6) as send_time
FROM information_schema.PROFILING 
GROUP BY QUERY_ID;
```

---

## 3. ğŸ¯ ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡


### 3.1 æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼“å­˜å‘½ä¸­ç‡**
```
é€šä¿—ç†è§£ï¼š
ç¼“å­˜ = æ•°æ®åº“çš„"è®°äº‹æœ¬"
ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šä»ç£ç›˜è¯»å–ï¼ˆæ…¢ï¼‰
ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šä»ç¼“å­˜è¯»å–ï¼ˆå¿«ï¼‰
å‘½ä¸­ç‡ = ä»ç¼“å­˜è¯»å–çš„æ¯”ä¾‹
```

**ğŸ“Š åŸºæœ¬ç¼“å­˜çŠ¶æ€æŸ¥è¯¢**
```sql
-- æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„åŸºæœ¬çŠ¶æ€
SHOW STATUS LIKE 'Qcache%';

-- è®¡ç®—æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡
SELECT 
    ROUND(
        Qcache_hits / (Qcache_hits + Qcache_inserts) * 100, 2
    ) AS cache_hit_rate
FROM (
    SELECT 
        VARIABLE_VALUE AS Qcache_hits
    FROM information_schema.SESSION_STATUS 
    WHERE VARIABLE_NAME = 'Qcache_hits'
) hits,
(
    SELECT 
        VARIABLE_VALUE AS Qcache_inserts  
    FROM information_schema.SESSION_STATUS
    WHERE VARIABLE_NAME = 'Qcache_inserts'
) inserts;
```

### 3.2 InnoDBç¼“å†²æ± å‘½ä¸­ç‡


**ğŸ’¾ InnoDBç¼“å†²æ± ç›‘æ§**
```sql
-- æŸ¥çœ‹InnoDBç¼“å†²æ± çŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- è®¡ç®—ç¼“å†²æ± å‘½ä¸­ç‡
SELECT 
    ROUND(
        (1 - (reads / read_requests)) * 100, 2
    ) AS buffer_pool_hit_rate
FROM (
    SELECT 
        SUM(CASE WHEN VARIABLE_NAME = 'Innodb_buffer_pool_reads' 
            THEN VARIABLE_VALUE END) AS reads,
        SUM(CASE WHEN VARIABLE_NAME = 'Innodb_buffer_pool_read_requests' 
            THEN VARIABLE_VALUE END) AS read_requests
    FROM information_schema.SESSION_STATUS
    WHERE VARIABLE_NAME IN (
        'Innodb_buffer_pool_reads',
        'Innodb_buffer_pool_read_requests'
    )
) stats;
```

**ğŸ¯ ç¼“å­˜å‘½ä¸­ç‡å¥åº·æ ‡å‡†**
```
ç†æƒ³çš„å‘½ä¸­ç‡èŒƒå›´ï¼š

æŸ¥è¯¢ç¼“å­˜ï¼š
âœ… > 80%ï¼šå¾ˆå¥½
âš ï¸ 60-80%ï¼šä¸€èˆ¬  
âŒ < 60%ï¼šéœ€è¦ä¼˜åŒ–

InnoDBç¼“å†²æ± ï¼š
âœ… > 95%ï¼šå¾ˆå¥½
âš ï¸ 90-95%ï¼šå¯æ¥å—
âŒ < 90%ï¼šéœ€è¦å¢åŠ ç¼“å†²æ± å¤§å°
```

---

## 4. ğŸ’¾ å†…å­˜ä½¿ç”¨ç›‘æ§


### 4.1 è¿æ¥å†…å­˜ç›‘æ§


**ğŸ”¸ ç›‘æ§æ¯ä¸ªè¿æ¥çš„å†…å­˜ä½¿ç”¨**
```sql
-- æŸ¥çœ‹è¿æ¥çš„å†…å­˜ä½¿ç”¨æƒ…å†µ
SELECT 
    t.processlist_id,
    t.processlist_user,
    t.processlist_host,
    t.processlist_db,
    m.current_allocated,              -- å½“å‰åˆ†é…å†…å­˜
    m.current_max_allocated          -- æœ€å¤§åˆ†é…å†…å­˜
FROM performance_schema.threads t
JOIN performance_schema.memory_summary_by_thread_by_event_name m
  ON t.thread_id = m.thread_id
WHERE m.event_name = 'memory/sql/thd::main_mem_root'
  AND t.processlist_id IS NOT NULL
ORDER BY m.current_allocated DESC;
```

### 4.2 å…¨å±€å†…å­˜ä½¿ç”¨ç›‘æ§


**ğŸ“Š ç›‘æ§MySQLå…¨å±€å†…å­˜åˆ†é…**
```sql
-- æŸ¥çœ‹å…¨å±€å†…å­˜ä½¿ç”¨ç»Ÿè®¡
SELECT 
    event_name,
    ROUND(SUM(current_allocated)/1024/1024, 2) AS allocated_mb,
    ROUND(SUM(high_allocated)/1024/1024, 2) AS high_mb
FROM performance_schema.memory_summary_global_by_event_name
WHERE current_allocated > 0
ORDER BY SUM(current_allocated) DESC
LIMIT 10;
```

**âš ï¸ å†…å­˜ç›‘æ§å‘Šè­¦è®¾ç½®**
```sql
-- åˆ›å»ºå†…å­˜ä½¿ç”¨å‘Šè­¦è§†å›¾
CREATE VIEW memory_alert AS
SELECT 
    'HIGH_MEMORY_USAGE' as alert_type,
    CONCAT(
        'Thread ', processlist_id, 
        ' using ', ROUND(current_allocated/1024/1024, 2), 'MB'
    ) as alert_message
FROM performance_schema.threads t
JOIN performance_schema.memory_summary_by_thread_by_event_name m
  ON t.thread_id = m.thread_id
WHERE m.event_name = 'memory/sql/thd::main_mem_root'
  AND current_allocated > 100*1024*1024  -- è¶…è¿‡100MBå‘Šè­¦
  AND t.processlist_id IS NOT NULL;
```

---

## 5. ğŸ“ˆ è¯­å¥æ‰§è¡Œé¢‘æ¬¡åˆ†æ


### 5.1 SQLè¯­å¥æ‰§è¡Œç»Ÿè®¡


**ğŸ”¸ ç›‘æ§æœ€é¢‘ç¹æ‰§è¡Œçš„SQL**
```sql
-- æŸ¥çœ‹æ‰§è¡Œæœ€é¢‘ç¹çš„SQLè¯­å¥
SELECT 
    digest_text,                     -- SQLè¯­å¥æ¨¡æ¿
    count_star AS exec_count,        -- æ‰§è¡Œæ¬¡æ•°
    ROUND(avg_timer_wait/1000000000, 3) AS avg_time_sec,  -- å¹³å‡æ‰§è¡Œæ—¶é—´
    ROUND(sum_timer_wait/1000000000, 3) AS total_time_sec -- æ€»æ‰§è¡Œæ—¶é—´
FROM performance_schema.events_statements_summary_by_digest
WHERE digest_text IS NOT NULL
ORDER BY count_star DESC
LIMIT 10;
```

**ğŸ“Š æŒ‰ç”¨æˆ·ç»Ÿè®¡æ‰§è¡Œé¢‘æ¬¡**
```sql
-- æŒ‰ç”¨æˆ·ç»Ÿè®¡SQLæ‰§è¡Œæƒ…å†µ
SELECT 
    user,
    SUM(count_star) as total_statements,
    ROUND(SUM(sum_timer_wait)/1000000000, 2) as total_time_sec,
    ROUND(AVG(avg_timer_wait)/1000000000, 3) as avg_time_sec
FROM performance_schema.events_statements_summary_by_user_by_event_name
WHERE event_name = 'statement/sql/select'
GROUP BY user
ORDER BY total_statements DESC;
```

### 5.2 åŠ¨æ€SQLæ¨¡å¼åˆ†æ


**ğŸ¯ è¯†åˆ«åŠ¨æ€SQLæ¨¡å¼**
```sql
-- æŸ¥æ‰¾å¯èƒ½çš„åŠ¨æ€SQLæ¨¡å¼
SELECT 
    LEFT(digest_text, 100) as sql_pattern,
    count_star,
    first_seen,
    last_seen,
    CASE 
        WHEN digest_text LIKE '%?%' THEN 'Prepared Statement'
        WHEN digest_text REGEXP 'WHERE.*=' THEN 'Dynamic WHERE'
        ELSE 'Static SQL'
    END as sql_type
FROM performance_schema.events_statements_summary_by_digest
WHERE count_star > 100  -- æ‰§è¡Œè¶…è¿‡100æ¬¡çš„
ORDER BY count_star DESC;
```

---

## 6. ğŸ” Performance Schemaæ·±å…¥åº”ç”¨


### 6.1 å¯ç”¨Performance Schemaç›‘æ§


**ğŸ”§ é…ç½®Performance Schema**
```sql
-- æŸ¥çœ‹Performance Schemaæ˜¯å¦å¯ç”¨
SHOW VARIABLES LIKE 'performance_schema';

-- å¯ç”¨è¯­å¥ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET enabled = 'YES' 
WHERE name LIKE 'statement/%';

-- å¯ç”¨å†…å­˜ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET enabled = 'YES' 
WHERE name LIKE 'memory/%';
```

### 6.2 å®æ—¶ç›‘æ§å½“å‰æ‰§è¡Œ


**ğŸ“Š ç›‘æ§å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯­å¥**
```sql
-- æŸ¥çœ‹å½“å‰æ‰§è¡Œçš„è¯­å¥è¯¦æƒ…
SELECT 
    t.processlist_id,
    t.processlist_user,
    t.processlist_host,
    s.sql_text,
    s.timer_start,
    ROUND((TIMER_WAIT)/1000000000, 3) as duration_sec,
    s.lock_time,
    s.rows_examined,
    s.rows_sent
FROM performance_schema.events_statements_current s
JOIN performance_schema.threads t ON s.thread_id = t.thread_id
WHERE s.sql_text IS NOT NULL
  AND t.processlist_id IS NOT NULL;
```

### 6.3 å†å²æ‰§è¡Œè®°å½•åˆ†æ


**ğŸ“‹ åˆ†æå†å²æ‰§è¡Œè®°å½•**
```sql
-- æŸ¥çœ‹æœ€è¿‘çš„SQLæ‰§è¡Œå†å²
SELECT 
    event_id,
    sql_text,
    ROUND(timer_wait/1000000000, 3) as duration_sec,
    rows_examined,
    rows_sent,
    created_tmp_tables,
    CASE 
        WHEN timer_wait > 5000000000 THEN 'æ…¢æŸ¥è¯¢'
        WHEN created_tmp_tables > 0 THEN 'ä½¿ç”¨ä¸´æ—¶è¡¨'
        ELSE 'æ­£å¸¸'
    END as query_status
FROM performance_schema.events_statements_history
ORDER BY timer_start DESC
LIMIT 20;
```

---

## 7. ğŸŒ æ…¢æŸ¥è¯¢è¯†åˆ«ä¸ä¼˜åŒ–


### 7.1 æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®


**ğŸ”¸ å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—**
```sql
-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;      -- è¶…è¿‡2ç§’è®°å½•
SET GLOBAL log_queries_not_using_indexes = 'ON';  -- è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
```

**ğŸ“ æ…¢æŸ¥è¯¢æ—¥å¿—ä½ç½®**
```sql
-- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä½ç½®
SHOW VARIABLES LIKE 'slow_query_log_file';
```

### 7.2 æ…¢æŸ¥è¯¢åˆ†æ


**ğŸ” ä»Performance Schemaåˆ†ææ…¢æŸ¥è¯¢**
```sql
-- æŸ¥æ‰¾æ‰§è¡Œæ—¶é—´æœ€é•¿çš„æŸ¥è¯¢
SELECT 
    digest_text,
    count_star as exec_count,
    ROUND(avg_timer_wait/1000000000, 3) as avg_sec,
    ROUND(max_timer_wait/1000000000, 3) as max_sec,
    ROUND(sum_timer_wait/1000000000, 3) as total_sec
FROM performance_schema.events_statements_summary_by_digest
WHERE avg_timer_wait > 1000000000  -- å¹³å‡è¶…è¿‡1ç§’
ORDER BY avg_timer_wait DESC
LIMIT 10;
```

**âš ï¸ æ…¢æŸ¥è¯¢é¢„è­¦ç³»ç»Ÿ**
```sql
-- åˆ›å»ºæ…¢æŸ¥è¯¢é¢„è­¦è§†å›¾
CREATE VIEW slow_query_alerts AS
SELECT 
    'SLOW_QUERY' as alert_type,
    digest_text as sql_pattern,
    count_star as exec_count,
    ROUND(avg_timer_wait/1000000000, 3) as avg_seconds,
    CASE 
        WHEN avg_timer_wait > 10000000000 THEN 'ä¸¥é‡'
        WHEN avg_timer_wait > 5000000000 THEN 'è­¦å‘Š'
        ELSE 'æ³¨æ„'
    END as severity_level
FROM performance_schema.events_statements_summary_by_digest
WHERE avg_timer_wait > 2000000000  -- å¹³å‡è¶…è¿‡2ç§’
ORDER BY avg_timer_wait DESC;
```

---

## 8. ğŸ¯ æ€§èƒ½ç“¶é¢ˆåˆ†æ


### 8.1 ç³»ç»Ÿç­‰å¾…äº‹ä»¶åˆ†æ


**ğŸ”¸ åˆ†æç­‰å¾…äº‹ä»¶**
```sql
-- æŸ¥çœ‹ä¸»è¦çš„ç­‰å¾…äº‹ä»¶
SELECT 
    event_name,
    count_star as wait_count,
    ROUND(sum_timer_wait/1000000000, 3) as total_wait_sec,
    ROUND(avg_timer_wait/1000000000, 6) as avg_wait_sec
FROM performance_schema.events_waits_summary_global_by_event_name
WHERE count_star > 0
ORDER BY sum_timer_wait DESC
LIMIT 10;
```

### 8.2 é”ç­‰å¾…åˆ†æ


**ğŸ”’ ç›‘æ§é”ç­‰å¾…æƒ…å†µ**
```sql
-- æŸ¥çœ‹å½“å‰çš„é”ç­‰å¾…
SELECT 
    r.trx_id as requesting_trx,
    r.trx_mysql_thread_id as requesting_thread,
    b.trx_id as blocking_trx,
    b.trx_mysql_thread_id as blocking_thread,
    l.lock_table,
    l.lock_mode,
    l.lock_type
FROM information_schema.INNODB_LOCK_WAITS w
JOIN information_schema.INNODB_TRX b ON w.blocking_trx_id = b.trx_id
JOIN information_schema.INNODB_TRX r ON w.requesting_trx_id = r.trx_id
JOIN information_schema.INNODB_LOCKS l ON w.blocking_lock_id = l.lock_id;
```

### 8.3 è¡¨çº§æ€§èƒ½åˆ†æ


**ğŸ“Š è¡¨è®¿é—®çƒ­åº¦åˆ†æ**
```sql
-- åˆ†æè¡¨çš„è®¿é—®çƒ­åº¦
SELECT 
    object_schema,
    object_name,
    count_read,
    count_write,
    count_read + count_write as total_access,
    ROUND(sum_timer_wait/1000000000, 3) as total_time_sec
FROM performance_schema.table_io_waits_summary_by_table
WHERE object_schema NOT IN ('mysql', 'performance_schema', 'information_schema')
ORDER BY total_access DESC
LIMIT 10;
```

---

## 9. ğŸ› ï¸ æ‰§è¡Œè®¡åˆ’åˆ†æå·¥å…·


### 9.1 EXPLAINåˆ†æåŠ¨æ€SQL


**ğŸ”¸ åŸºæœ¬æ‰§è¡Œè®¡åˆ’åˆ†æ**
```sql
-- åˆ†æåŠ¨æ€SQLçš„æ‰§è¡Œè®¡åˆ’
SET @sql = 'SELECT * FROM orders WHERE user_id = ? AND status = ?';
PREPARE stmt FROM @sql;

-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼ˆMySQL 8.0+ï¼‰
EXPLAIN FORMAT=JSON EXECUTE stmt USING 12345, 'completed';

-- ä¼ ç»Ÿæ ¼å¼æ‰§è¡Œè®¡åˆ’
EXPLAIN EXECUTE stmt USING 12345, 'completed';
```

### 9.2 æ‰§è¡Œè®¡åˆ’å…³é”®æŒ‡æ ‡è§£è¯»


**ğŸ“‹ æ‰§è¡Œè®¡åˆ’è§£è¯»è¡¨æ ¼**

| å­—æ®µ | å«ä¹‰ | å¥½ååˆ¤æ–­ | ä¼˜åŒ–å»ºè®® |
|------|------|----------|----------|
| **type** | è®¿é—®ç±»å‹ | `const/eq_ref` ğŸ‘<br>`range` ğŸ˜<br>`ALL` ğŸ‘ | æ·»åŠ ç´¢å¼•é¿å…å…¨è¡¨æ‰«æ |
| **rows** | é¢„ä¼°æ‰«æè¡Œæ•° | è¶Šå°‘è¶Šå¥½ | ä¼˜åŒ–WHEREæ¡ä»¶å’Œç´¢å¼• |
| **Extra** | é™„åŠ ä¿¡æ¯ | `Using index` ğŸ‘<br>`Using filesort` ğŸ‘ | ä¼˜åŒ–ORDER BYå’Œç´¢å¼•è¦†ç›– |

**ğŸ¯ å¿«é€Ÿè¯Šæ–­SQLé—®é¢˜**
```sql
-- åˆ›å»ºæ‰§è¡Œè®¡åˆ’åˆ†æå‡½æ•°
DELIMITER //
CREATE PROCEDURE analyze_dynamic_sql(IN sql_text TEXT)
BEGIN
    SET @sql = sql_text;
    PREPARE stmt FROM @sql;
    
    -- æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’
    SELECT '=== æ‰§è¡Œè®¡åˆ’åˆ†æ ===' as info;
    EXPLAIN EXECUTE stmt;
    
    -- æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚æœæ”¯æŒï¼‰
    SELECT '=== è¯¦ç»†æ‰§è¡Œä¿¡æ¯ ===' as info;
    EXPLAIN FORMAT=JSON EXECUTE stmt;
    
    DEALLOCATE PREPARE stmt;
END //
DELIMITER ;
```

### 9.3 Visual Explain (MySQL Workbench)


**ğŸ–¥ï¸ å›¾å½¢åŒ–æ‰§è¡Œè®¡åˆ’åˆ†æ**
```
ä½¿ç”¨MySQL Workbenchçš„Visual ExplainåŠŸèƒ½ï¼š

1. åœ¨Queryçª—å£è¾“å…¥SQL
2. ç‚¹å‡»"Visual Explain"æŒ‰é’®
3. æŸ¥çœ‹å›¾å½¢åŒ–æ‰§è¡Œè®¡åˆ’

ä¼˜åŠ¿ï¼š
âœ… ç›´è§‚æ˜¾ç¤ºè¡¨è¿æ¥æ–¹å¼
âœ… æ¸…æ™°æ ‡æ³¨æˆæœ¬ä¿¡æ¯
âœ… é«˜äº®æ˜¾ç¤ºæ€§èƒ½ç“¶é¢ˆ
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 ç›‘æ§è¦ç‚¹å›é¡¾


**ğŸ”¸ å¿…é¡»ç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡**
```
ğŸ•’ æ‰§è¡Œæ—¶é—´æŒ‡æ ‡ï¼š
â€¢ å¹³å‡æ‰§è¡Œæ—¶é—´
â€¢ æœ€å¤§æ‰§è¡Œæ—¶é—´  
â€¢ æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ

ğŸ’¾ èµ„æºä½¿ç”¨æŒ‡æ ‡ï¼š
â€¢ å†…å­˜åˆ†é…å¤§å°
â€¢ ç¼“å­˜å‘½ä¸­ç‡
â€¢ é”ç­‰å¾…æ—¶é—´

ğŸ“ˆ é¢‘ç‡ç»Ÿè®¡æŒ‡æ ‡ï¼š
â€¢ SQLæ‰§è¡Œæ¬¡æ•°
â€¢ é”™è¯¯å‘ç”Ÿé¢‘ç‡
â€¢ å¹¶å‘è¿æ¥æ•°
```

### 10.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**âš¡ åŸºäºç›‘æ§ç»“æœçš„ä¼˜åŒ–ç­–ç•¥**
```
æ—¶é—´ä¼˜åŒ–ï¼š
â€¢ æ‰§è¡Œæ—¶é—´ > 5ç§’ â†’ ä¼˜å…ˆä¼˜åŒ–
â€¢ å¹³å‡æ—¶é—´ > 1ç§’ â†’ æ·»åŠ ç´¢å¼•
â€¢ é¢‘ç¹æ‰§è¡Œ + è€—æ—¶ â†’ ä½¿ç”¨ç¼“å­˜

èµ„æºä¼˜åŒ–ï¼š
â€¢ å†…å­˜ä½¿ç”¨ > 100MB â†’ æ£€æŸ¥æ•°æ®é‡
â€¢ ç¼“å­˜å‘½ä¸­ç‡ < 80% â†’ è°ƒæ•´ç¼“å­˜é…ç½®
â€¢ é”ç­‰å¾…ä¸¥é‡ â†’ ä¼˜åŒ–äº‹åŠ¡é€»è¾‘

SQLä¼˜åŒ–ï¼š
â€¢ å…¨è¡¨æ‰«æ â†’ æ·»åŠ åˆé€‚ç´¢å¼•
â€¢ ä¸´æ—¶è¡¨è¿‡å¤š â†’ ä¼˜åŒ–ORDER BY
â€¢ æ’åºè€—æ—¶ â†’ å»ºç«‹è¦†ç›–ç´¢å¼•
```

### 10.3 ç›‘æ§æœ€ä½³å®è·µ


**ğŸ¯ å»ºç«‹ç›‘æ§ä½“ç³»**
```
æ—¥å¸¸ç›‘æ§ï¼š
âœ… è®¾ç½®è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬
âœ… å»ºç«‹æ€§èƒ½åŸºçº¿æ ‡å‡†
âœ… é…ç½®å‘Šè­¦é˜ˆå€¼
âœ… å®šæœŸç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

é—®é¢˜å¤„ç†ï¼š
âœ… å¿«é€Ÿå®šä½æ…¢æŸ¥è¯¢
âœ… åˆ†ææ‰§è¡Œè®¡åˆ’
âœ… ä¼˜åŒ–ç´¢å¼•ç­–ç•¥
âœ… éªŒè¯ä¼˜åŒ–æ•ˆæœ
```

**ğŸ’¡ è®°å¿†è¦è¯€**
```
ç›‘æ§åŠ¨æ€SQLä¸‰æ­¥èµ°ï¼š
1. çœ‹æ—¶é—´ - æ‰¾å‡ºæ…¢æŸ¥è¯¢
2. çœ‹èµ„æº - æ‰¾å‡ºå¤§å†…å­˜æ¶ˆè€—
3. çœ‹é¢‘æ¬¡ - æ‰¾å‡ºçƒ­ç‚¹SQL

ä¼˜åŒ–åŠ¨æ€SQLä¸‰åŸåˆ™ï¼š
1. ç´¢å¼•ä¼˜å…ˆ - è§£å†³è®¿é—®æ•ˆç‡
2. ç¼“å­˜å…¶æ¬¡ - å‡å°‘é‡å¤è®¡ç®—  
3. é‡æ„æœ€å - æ”¹å˜ä¸šåŠ¡é€»è¾‘
```

**æ ¸å¿ƒç†è§£**ï¼š
- ç›‘æ§æ˜¯ä¸ºäº†å‘ç°é—®é¢˜ï¼Œä¸æ˜¯ä¸ºäº†ç›‘æ§è€Œç›‘æ§
- é‡ç‚¹å…³æ³¨ç”¨æˆ·ä½“éªŒç›¸å…³çš„æ ¸å¿ƒæŒ‡æ ‡
- å»ºç«‹ä»ç›‘æ§åˆ°ä¼˜åŒ–çš„å®Œæ•´é—­ç¯
- æŒç»­ç›‘æ§æ¯”ä¸€æ¬¡æ€§ä¼˜åŒ–æ›´é‡è¦