---
title: 3ã€å®æ—¶è®¡ç®—ä¸æµå¼å¤„ç†é›†æˆ
---
## ğŸ“š ç›®å½•

1. [æµå¼è®¡ç®—åŸºç¡€æ¦‚å¿µ](#1-æµå¼è®¡ç®—åŸºç¡€æ¦‚å¿µ)
2. [MySQLæµå¼æ•°æ®ç®¡é“æ„å»º](#2-MySQLæµå¼æ•°æ®ç®¡é“æ„å»º)
3. [å®æ—¶çª—å£å‡½æ•°å¤„ç†](#3-å®æ—¶çª—å£å‡½æ•°å¤„ç†)
4. [çŠ¶æ€ç®¡ç†ä¸å®¹é”™æœºåˆ¶](#4-çŠ¶æ€ç®¡ç†ä¸å®¹é”™æœºåˆ¶)
5. [å»¶è¿Ÿæ§åˆ¶ä¸åå‹å¤„ç†](#5-å»¶è¿Ÿæ§åˆ¶ä¸åå‹å¤„ç†)
6. [Exactly-Onceè¯­ä¹‰ä¿è¯](#6-Exactly-Onceè¯­ä¹‰ä¿è¯)
7. [æ°´å°æœºåˆ¶å¤„ç†ä¹±åºæ•°æ®](#7-æ°´å°æœºåˆ¶å¤„ç†ä¹±åºæ•°æ®)
8. [æµæ‰¹ä¸€ä½“å¤„ç†æ¶æ„](#8-æµæ‰¹ä¸€ä½“å¤„ç†æ¶æ„)
9. [æ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§](#9-æ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŠ æµå¼è®¡ç®—åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æµå¼è®¡ç®—


**é€šä¿—ç†è§£**ï¼š
```
ä¼ ç»Ÿæ‰¹å¤„ç†ï¼šåƒå·¥å‚æµæ°´çº¿ï¼Œæ”’å¤Ÿä¸€æ‰¹è´§å†ç»Ÿä¸€å¤„ç†
æµå¼è®¡ç®—ï¼šåƒå¿«é¤åº—ï¼Œæ¥ä¸€ä¸ªå®¢æˆ·ç«‹å³å¤„ç†ä¸€ä¸ª

æ—¥å¸¸ä¾‹å­ï¼š
æ‰¹å¤„ç† = é“¶è¡Œæ¯å¤©æ™šä¸Šç»Ÿä¸€ç»“ç®—æ‰€æœ‰äº¤æ˜“
æµå¼è®¡ç®— = æ”¯ä»˜å®æ¯ç¬”äº¤æ˜“å®æ—¶æ‰£æ¬¾åˆ°è´¦
```

**æ ¸å¿ƒç‰¹å¾**ï¼š
- ğŸ”„ **å®æ—¶æ€§**ï¼šæ•°æ®æ¥äº†ç«‹å³å¤„ç†ï¼Œä¸ç­‰å¾…
- ğŸ“Š **è¿ç»­æ€§**ï¼šæ•°æ®æµæºæºä¸æ–­ï¼Œæ°¸ä¸åœæ­¢
- âš¡ **ä½å»¶è¿Ÿ**ï¼šä»æ•°æ®äº§ç”Ÿåˆ°ç»“æœè¾“å‡ºï¼Œå»¶è¿Ÿæä½
- ğŸ”’ **çŠ¶æ€åŒ–**ï¼šè®°ä½ä¹‹å‰çš„è®¡ç®—çŠ¶æ€

### 1.2 MySQLåœ¨æµå¼è®¡ç®—ä¸­çš„è§’è‰²


```
æ•°æ®æµå‘ï¼š
MySQLæ•°æ®åº“ â†’ Binlogæ—¥å¿— â†’ æµè®¡ç®—æ¡†æ¶ â†’ å®æ—¶ç»“æœ

å…·ä½“åœºæ™¯ï¼š
ç”¨æˆ·ä¸‹å•(å†™å…¥MySQL) â†’ å®æ—¶è®¡ç®—åº“å­˜ â†’ ç«‹å³æ›´æ–°æ¨èç³»ç»Ÿ
```

**MySQLä½œä¸ºæ•°æ®æº**ï¼š
- ğŸ“ **å˜æ›´æ•è·**ï¼šé€šè¿‡Binlogæ•è·æ•°æ®å˜åŒ–
- ğŸ”„ **å®æ—¶åŒæ­¥**ï¼šå°†æ•°æ®åº“å˜æ›´æ¨é€åˆ°æµè®¡ç®—ç³»ç»Ÿ
- ğŸ“Š **çŠ¶æ€å­˜å‚¨**ï¼šä¸ºæµè®¡ç®—æä¾›æŒä¹…åŒ–çŠ¶æ€å­˜å‚¨

### 1.3 æµå¼è®¡ç®—æ¡†æ¶é€‰æ‹©


| æ¡†æ¶ | **ç‰¹ç‚¹** | **é€‚ç”¨åœºæ™¯** | **ä¸MySQLé›†æˆ** |
|------|---------|-------------|----------------|
| ğŸš€ **Apache Kafka Streams** | `è½»é‡çº§ï¼Œä¸Kafkaæ·±åº¦é›†æˆ` | `ç®€å•æµå¤„ç†ï¼Œå®æ—¶èšåˆ` | `é€šè¿‡Kafka Connectè¿æ¥` |
| âš¡ **Apache Flink** | `ä½å»¶è¿Ÿï¼Œç²¾ç¡®ä¸€æ¬¡å¤„ç†` | `å¤æ‚äº‹ä»¶å¤„ç†ï¼ŒçŠ¶æ€è®¡ç®—` | `CDCè¿æ¥å™¨ç›´è¿MySQL` |
| ğŸŒŠ **Apache Storm** | `å®æ—¶æ€§å¼ºï¼Œå®¹é”™å¥½` | `å®æ—¶å‘Šè­¦ï¼Œç®€å•è½¬æ¢` | `é€šè¿‡Spoutè¿æ¥å™¨` |
| ğŸ“Š **Apache Spark Streaming** | `æ‰¹æµç»Ÿä¸€ï¼Œç”Ÿæ€ä¸°å¯Œ` | `å‡†å®æ—¶å¤„ç†ï¼Œæœºå™¨å­¦ä¹ ` | `ç»“æ„åŒ–æµè¿æ¥` |

---

## 2. ğŸ”— MySQLæµå¼æ•°æ®ç®¡é“æ„å»º


### 2.1 å®æ—¶æ•°æ®ç®¡é“æ¶æ„


```
å®Œæ•´æ•°æ®ç®¡é“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL     â”‚â”€â”€â”€â–¶â”‚   Binlog     â”‚â”€â”€â”€â–¶â”‚   Kafka     â”‚â”€â”€â”€â–¶â”‚  æµè®¡ç®—æ¡†æ¶   â”‚
â”‚   æ•°æ®åº“    â”‚    â”‚   è§£æå™¨     â”‚    â”‚   æ¶ˆæ¯é˜Ÿåˆ—  â”‚    â”‚  (Flinkç­‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                    â”‚                   â”‚                   â”‚
   å®æ—¶å†™å…¥            æ•è·å˜æ›´           ç¼“å†²æ¶ˆæ¯            å®æ—¶è®¡ç®—
       â†“                    â†“                   â†“                   â†“
   ä¸šåŠ¡æ“ä½œ            æ•°æ®å˜æ›´äº‹ä»¶        æ¶ˆæ¯åˆ†å‘            ç»“æœè¾“å‡º
```

### 2.2 MySQL Binlogå®æ—¶è§£æ


**Binlogæ˜¯ä»€ä¹ˆ**ï¼š
```
ç®€å•ç†è§£ï¼šMySQLçš„"å°æœ¬æœ¬"ï¼Œè®°å½•æ‰€æœ‰æ•°æ®å˜åŒ–
ä½œç”¨ï¼šè®°å½•è°ã€åœ¨ä»€ä¹ˆæ—¶å€™ã€åšäº†ä»€ä¹ˆæ“ä½œ

ç¤ºä¾‹ï¼š
ç”¨æˆ·Aåœ¨12:30:15æ›´æ–°äº†è®¢å•çŠ¶æ€ä»"å¾…æ”¯ä»˜"æ”¹ä¸º"å·²æ”¯ä»˜"
Binlogå°±ä¼šè¯¦ç»†è®°å½•è¿™ä¸ªå˜åŒ–è¿‡ç¨‹
```

**å®æ—¶è§£æé…ç½®**ï¼š
```sql
-- 1. å¼€å¯MySQL Binlog
SET GLOBAL log_bin = ON;
SET GLOBAL binlog_format = 'ROW';  -- è¡Œçº§åˆ«è®°å½•ï¼Œä¿¡æ¯æœ€è¯¦ç»†
SET GLOBAL binlog_row_image = 'FULL';  -- è®°å½•å®Œæ•´è¡Œæ•°æ®

-- 2. åˆ›å»ºCDCç”¨æˆ·
CREATE USER 'cdc_user'@'%' IDENTIFIED BY 'password';
GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'cdc_user'@'%';
```

**Debeziumè¿æ¥å™¨é…ç½®**ï¼š
```json
{
  "name": "mysql-source-connector",
  "config": {
    "connector.class": "io.debezium.connector.mysql.MySqlConnector",
    "database.hostname": "localhost",
    "database.port": "3306",
    "database.user": "cdc_user",
    "database.password": "password",
    "database.server.name": "mysql-server",
    "table.whitelist": "ecommerce.orders,ecommerce.users",
    "database.history.kafka.bootstrap.servers": "kafka:9092"
  }
}
```

### 2.3 å®æ—¶æ•°æ®ç®¡é“ç›‘æ§


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ“Š æ•°æ®æµé‡ç›‘æ§ï¼š
â€¢ Binlogè¯»å–é€Ÿç‡ï¼š1000 events/sec
â€¢ æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯ï¼š< 1000æ¡
â€¢ ç«¯åˆ°ç«¯å»¶è¿Ÿï¼š< 100ms

âš ï¸ å¼‚å¸¸å‘Šè­¦ï¼š
â€¢ Binlogè§£æå¤±è´¥
â€¢ æ¶ˆæ¯é˜Ÿåˆ—æ»¡è½½
â€¢ ä¸‹æ¸¸å¤„ç†è¶…æ—¶
```

---

## 3. ğŸªŸ å®æ—¶çª—å£å‡½æ•°å¤„ç†


### 3.1 çª—å£å‡½æ•°æ¦‚å¿µ


**ç”Ÿæ´»ä¸­çš„çª—å£**ï¼š
```
æƒ³è±¡ä½ åœ¨è§‚å¯Ÿè·¯å£è½¦æµï¼š
æ»‘åŠ¨çª—å£ = æ¯åˆ†é’Ÿç»Ÿè®¡è¿‡å»5åˆ†é’Ÿçš„è½¦æµé‡
ä¼šè¯çª—å£ = ç»Ÿè®¡æ¯æ¬¡çº¢ç»¿ç¯å‘¨æœŸå†…çš„è½¦æµ
å…¨å±€çª—å£ = ç»Ÿè®¡ä»Šå¤©å¼€å§‹åˆ°ç°åœ¨çš„æ€»è½¦æµ
```

### 3.2 æ—¶é—´çª—å£ç±»å‹è¯¦è§£


**æ»šåŠ¨çª—å£(Tumbling Window)**ï¼š
```
ç‰¹ç‚¹ï¼šå›ºå®šå¤§å°ï¼Œä¸é‡å ï¼Œå®Œå…¨è¦†ç›–
åº”ç”¨ï¼šæ¯å°æ—¶é”€å”®é¢ç»Ÿè®¡

æ—¶é—´çº¿ï¼š
[00:00-01:00] [01:00-02:00] [02:00-03:00]
     çª—å£1        çª—å£2        çª—å£3

å®ç°ç¤ºä¾‹ï¼š
```sql
SELECT 
    TUMBLE_START(order_time, INTERVAL '1' HOUR) as window_start,
    COUNT(*) as order_count,
    SUM(amount) as total_amount
FROM orders
GROUP BY TUMBLE(order_time, INTERVAL '1' HOUR);
```

**æ»‘åŠ¨çª—å£(Sliding Window)**ï¼š
```
ç‰¹ç‚¹ï¼šå›ºå®šå¤§å°ï¼Œæœ‰é‡å ï¼ŒæŒç»­æ»‘åŠ¨
åº”ç”¨ï¼šæœ€è¿‘5åˆ†é’Ÿå¹³å‡å“åº”æ—¶é—´

æ—¶é—´çº¿ï¼š
[00:00-00:05] 
   [00:01-00:06]
      [00:02-00:07]  â† æ¯åˆ†é’Ÿæ»‘åŠ¨ä¸€æ¬¡

å®ç°ç¤ºä¾‹ï¼š
SELECT 
    HOP_START(process_time, INTERVAL '1' MINUTE, INTERVAL '5' MINUTE) as window_start,
    AVG(response_time) as avg_response
FROM api_logs
GROUP BY HOP(process_time, INTERVAL '1' MINUTE, INTERVAL '5' MINUTE);
```

**ä¼šè¯çª—å£(Session Window)**ï¼š
```
ç‰¹ç‚¹ï¼šåŠ¨æ€å¤§å°ï¼ŒåŸºäºæ´»åŠ¨é—´éš”
åº”ç”¨ï¼šç”¨æˆ·ä¼šè¯åˆ†æ

é€»è¾‘ï¼š
ç”¨æˆ·A: ç™»å½• -> æµè§ˆ(5åˆ†é’Ÿ) -> ä¸‹å• -> ç©ºé—²15åˆ†é’Ÿ -> ä¼šè¯ç»“æŸ
ç”¨æˆ·B: ç™»å½• -> æµè§ˆ(2åˆ†é’Ÿ) -> ç©ºé—²10åˆ†é’Ÿ -> ä¼šè¯ç»“æŸ
```

### 3.3 çª—å£å‡½æ•°å®æˆ˜åº”ç”¨


**å®æ—¶é”€å”®ç»Ÿè®¡**ï¼š
```java
// Flink SQLç¤ºä¾‹ï¼šå®æ—¶è®¡ç®—æ¯åˆ†é’Ÿè®¢å•ç»Ÿè®¡
DataStream<Order> orderStream = env.fromSource(mysqlSource);

Table result = tableEnv.sqlQuery(
    "SELECT " +
    "  TUMBLE_START(order_time, INTERVAL '1' MINUTE) as window_start, " +
    "  product_category, " +
    "  COUNT(*) as order_count, " +
    "  SUM(amount) as total_sales " +
    "FROM order_table " +
    "GROUP BY TUMBLE(order_time, INTERVAL '1' MINUTE), product_category"
);
```

**å®æ—¶ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼š
```java
// è®¡ç®—ç”¨æˆ·æ´»è·ƒä¼šè¯
Table sessionAnalysis = tableEnv.sqlQuery(
    "SELECT " +
    "  user_id, " +
    "  SESSION_START(event_time, INTERVAL '30' MINUTE) as session_start, " +
    "  COUNT(*) as event_count, " +
    "  COLLECT(event_type) as event_sequence " +
    "FROM user_events " +
    "GROUP BY user_id, SESSION(event_time, INTERVAL '30' MINUTE)"
);
```

---

## 4. ğŸ”„ çŠ¶æ€ç®¡ç†ä¸å®¹é”™æœºåˆ¶


### 4.1 çŠ¶æ€ç®¡ç†åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯çŠ¶æ€**ï¼š
```
ç®€å•ç†è§£ï¼šå°±æ˜¯ç¨‹åºçš„"è®°å¿†"

ä¾‹å­ï¼šç»Ÿè®¡æ¯ä¸ªç”¨æˆ·çš„ç´¯è®¡æ¶ˆè´¹
çŠ¶æ€ = {ç”¨æˆ·A: 1500å…ƒ, ç”¨æˆ·B: 800å…ƒ, ç”¨æˆ·C: 2300å…ƒ}

å½“æ–°è®¢å•æ¥äº†ï¼Œéœ€è¦æ›´æ–°å¯¹åº”ç”¨æˆ·çš„ç´¯è®¡é‡‘é¢
è¿™ä¸ªç´¯è®¡é‡‘é¢å°±æ˜¯"çŠ¶æ€"
```

**çŠ¶æ€ç±»å‹**ï¼š
- ğŸ”¢ **å€¼çŠ¶æ€(ValueState)**ï¼šå­˜å‚¨å•ä¸ªå€¼
- ğŸ“‹ **åˆ—è¡¨çŠ¶æ€(ListState)**ï¼šå­˜å‚¨å€¼çš„åˆ—è¡¨
- ğŸ—ºï¸ **æ˜ å°„çŠ¶æ€(MapState)**ï¼šå­˜å‚¨é”®å€¼å¯¹æ˜ å°„

### 4.2 çŠ¶æ€æŒä¹…åŒ–ç­–ç•¥


**æ£€æŸ¥ç‚¹æœºåˆ¶(Checkpoint)**ï¼š
```
å·¥ä½œåŸç†ï¼š
1. å®šæœŸä¿å­˜æ‰€æœ‰ç®—å­çš„çŠ¶æ€å¿«ç…§
2. å°†å¿«ç…§å­˜å‚¨åˆ°å¯é å­˜å‚¨(å¦‚HDFS)
3. æ•…éšœæ—¶ä»æœ€è¿‘æ£€æŸ¥ç‚¹æ¢å¤

ç±»æ¯”ï¼šç©æ¸¸æˆæ—¶çš„å­˜æ¡£
å®šæœŸå­˜æ¡£ â†’ æ¸¸æˆå´©æºƒ â†’ ä»å­˜æ¡£ç‚¹ç»§ç»­
```

**é…ç½®ç¤ºä¾‹**ï¼š
```java
// å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œæ¯60ç§’ä¸€æ¬¡
env.enableCheckpointing(60000);

// é…ç½®æ£€æŸ¥ç‚¹å­˜å‚¨
env.getCheckpointConfig().setCheckpointStorage("hdfs://namenode/checkpoints");

// è®¾ç½®é‡å¯ç­–ç•¥
env.setRestartStrategy(RestartStrategies.fixedDelayRestart(
    3, // æœ€å¤§é‡è¯•æ¬¡æ•°
    Time.seconds(10) // é‡è¯•é—´éš”
));
```

### 4.3 å®¹é”™æœºåˆ¶å®ç°


**ç²¾ç¡®ä¸€æ¬¡å¤„ç†ä¿è¯**ï¼š
```
é—®é¢˜ï¼šå¦‚ä½•ç¡®ä¿æ¯æ¡æ¶ˆæ¯è¢«å¤„ç†ä¸”ä»…è¢«å¤„ç†ä¸€æ¬¡ï¼Ÿ

è§£å†³æ–¹æ¡ˆï¼š
1. å¹‚ç­‰æ“ä½œï¼šé‡å¤æ‰§è¡Œç»“æœç›¸åŒ
2. äº‹åŠ¡ä¿è¯ï¼šè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
3. é‡å¤æ•°æ®åˆ é™¤ï¼šè¯†åˆ«å¹¶è¿‡æ»¤é‡å¤æ¶ˆæ¯
```

**å®æˆ˜ç¤ºä¾‹**ï¼š
```java
public class OrderProcessFunction extends KeyedProcessFunction<String, Order, OrderResult> {
    // çŠ¶æ€å­˜å‚¨ï¼šè®°å½•å·²å¤„ç†è®¢å•
    private ValueState<Boolean> processedState;
    
    @Override
    public void processElement(Order order, Context ctx, Collector<OrderResult> out) {
        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†
        Boolean processed = processedState.value();
        if (processed != null && processed) {
            return; // é‡å¤æ¶ˆæ¯ï¼Œç›´æ¥å¿½ç•¥
        }
        
        // å¤„ç†è®¢å•é€»è¾‘
        OrderResult result = processOrder(order);
        out.collect(result);
        
        // æ ‡è®°ä¸ºå·²å¤„ç†
        processedState.update(true);
    }
}
```

---

## 5. âš¡ å»¶è¿Ÿæ§åˆ¶ä¸åå‹å¤„ç†


### 5.1 å»¶è¿Ÿäº§ç”ŸåŸå› 


**å¸¸è§å»¶è¿Ÿæº**ï¼š
```
ğŸ” æ•°æ®æºå»¶è¿Ÿï¼š
â€¢ MySQLä¸»ä»åŒæ­¥å»¶è¿Ÿ
â€¢ Binlogè§£æè€—æ—¶
â€¢ ç½‘ç»œä¼ è¾“å»¶è¿Ÿ

âš™ï¸ è®¡ç®—å»¶è¿Ÿï¼š
â€¢ å¤æ‚è®¡ç®—é€»è¾‘è€—æ—¶
â€¢ çŠ¶æ€è®¿é—®å»¶è¿Ÿ
â€¢ åºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€

ğŸ“¤ è¾“å‡ºå»¶è¿Ÿï¼š
â€¢ å¤–éƒ¨ç³»ç»Ÿå†™å…¥æ…¢
â€¢ æ‰¹é‡è¾“å‡ºç¼“å†²
â€¢ ä¸‹æ¸¸ç³»ç»ŸèƒŒå‹
```

### 5.2 å»¶è¿Ÿæ§åˆ¶ç­–ç•¥


**æ•°æ®æºä¼˜åŒ–**ï¼š
```java
// MySQLè¿æ¥æ± ä¼˜åŒ–
HikariConfig config = new HikariConfig();
config.setMaximumPoolSize(20);        // è¿æ¥æ± å¤§å°
config.setConnectionTimeout(5000);    // è¿æ¥è¶…æ—¶5ç§’
config.setLeakDetectionThreshold(60000); // è¿æ¥æ³„æ¼æ£€æµ‹

// Kafkaæ¶ˆè´¹è€…ä¼˜åŒ–
Properties props = new Properties();
props.put("fetch.min.bytes", "50000");     // æ‰¹é‡æ‹‰å–ä¼˜åŒ–
props.put("fetch.max.wait.ms", "100");     // æœ€å¤§ç­‰å¾…æ—¶é—´100ms
props.put("max.poll.records", "1000");     // æ¯æ¬¡æ‹‰å–æœ€å¤§è®°å½•æ•°
```

**ç®—å­å¹¶è¡Œåº¦è°ƒä¼˜**ï¼š
```java
DataStream<Order> orders = env.fromSource(mysqlSource)
    .setParallelism(4);  // è®¾ç½®Sourceå¹¶è¡Œåº¦

orders.keyBy(Order::getUserId)
    .process(new OrderProcessFunction())
    .setParallelism(8);  // å¢åŠ å¤„ç†å¹¶è¡Œåº¦
```

### 5.3 åå‹å¤„ç†æœºåˆ¶


**ä»€ä¹ˆæ˜¯åå‹**ï¼š
```
ç”Ÿæ´»ä¾‹å­ï¼š
æƒ³è±¡é«˜é€Ÿå…¬è·¯æ”¶è´¹ç«™ï¼Œè½¦æµé‡ > æ”¶è´¹èƒ½åŠ›
ç»“æœï¼šåé¢å¼€å§‹å µè½¦ï¼Œè¶Šæ¥è¶Šé•¿

æµè®¡ç®—ä¸­ï¼š
æ•°æ®ç”Ÿäº§é€Ÿåº¦ > å¤„ç†é€Ÿåº¦ = åå‹
è¡¨ç°ï¼šå†…å­˜å ç”¨å¢é«˜ï¼Œå»¶è¿Ÿå¢å¤§
```

**åå‹æ£€æµ‹ä¸å¤„ç†**ï¼š
```java
// é…ç½®åå‹é˜ˆå€¼
env.getConfig().setLatencyTrackingInterval(1000);

// è‡ªé€‚åº”æ‰¹å¤§å°
public class AdaptiveBatchProcessor extends ProcessFunction<Event, Result> {
    private int currentBatchSize = 100;
    private long lastProcessTime = 0;
    
    @Override
    public void processElement(Event event, Context ctx, Collector<Result> out) {
        long currentTime = System.currentTimeMillis();
        
        // æ ¹æ®å¤„ç†æ—¶é—´åŠ¨æ€è°ƒæ•´æ‰¹å¤§å°
        if (currentTime - lastProcessTime > 1000) {  // å¤„ç†æ…¢äº†
            currentBatchSize = Math.max(10, currentBatchSize / 2);
        } else if (currentTime - lastProcessTime < 100) {  // å¤„ç†å¿«äº†
            currentBatchSize = Math.min(1000, currentBatchSize * 2);
        }
        
        lastProcessTime = currentTime;
    }
}
```

---

## 6. âœ… Exactly-Onceè¯­ä¹‰ä¿è¯


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦ç²¾ç¡®ä¸€æ¬¡å¤„ç†


**é—®é¢˜åœºæ™¯**ï¼š
```
ç”µå•†è®¢å•å¤„ç†ï¼š
ç”¨æˆ·ä¸‹å•100å…ƒ â†’ æ‰£æ¬¾ â†’ å‡åº“å­˜ â†’ å‘è´§

å¦‚æœå¤„ç†å¤±è´¥é‡è¯•ï¼š
æƒ…å†µ1ï¼šæ‰£æ¬¾2æ¬¡ï¼Œç”¨æˆ·æŸå¤±
æƒ…å†µ2ï¼šå‡åº“å­˜2æ¬¡ï¼Œæ•°æ®é”™è¯¯
æƒ…å†µ3ï¼šå‘è´§2æ¬¡ï¼Œæˆæœ¬å¢åŠ 

è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æ¯ä¸ªæ­¥éª¤ç²¾ç¡®æ‰§è¡Œä¸€æ¬¡
```

### 6.2 å®ç°æœºåˆ¶è¯¦è§£


**ä¸¤é˜¶æ®µæäº¤(Two-Phase Commit)**ï¼š
```
é˜¶æ®µ1ï¼šå‡†å¤‡é˜¶æ®µ(Prepare)
â€¢ æ‰€æœ‰å‚ä¸è€…å‡†å¤‡äº‹åŠ¡
â€¢ è®°å½•æ“ä½œæ—¥å¿—ä½†ä¸æäº¤
â€¢ å‘åè°ƒå™¨æŠ¥å‘Šå‡†å¤‡çŠ¶æ€

é˜¶æ®µ2ï¼šæäº¤é˜¶æ®µ(Commit)
â€¢ åè°ƒå™¨æ”¶åˆ°æ‰€æœ‰å‡†å¤‡æˆåŠŸ
â€¢ å‘é€æäº¤æŒ‡ä»¤
â€¢ æ‰€æœ‰å‚ä¸è€…æ‰§è¡ŒçœŸæ­£æäº¤
```

**å®æˆ˜å®ç°**ï¼š
```java
// Flinkçš„ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡å¤„ç†
public class ExactlyOnceOrderSink extends TwoPhaseCommitSinkFunction<Order, Transaction, Void> {
    
    @Override
    protected Transaction beginTransaction() {
        // å¼€å¯äº‹åŠ¡ï¼Œè¿”å›äº‹åŠ¡å¯¹è±¡
        return new Transaction(UUID.randomUUID().toString());
    }
    
    @Override
    protected void invoke(Transaction transaction, Order order, Context context) {
        // åœ¨äº‹åŠ¡ä¸­å†™å…¥æ•°æ®ï¼Œä½†ä¸æäº¤
        writeToDatabase(transaction, order);
    }
    
    @Override
    protected void preCommit(Transaction transaction) {
        // é¢„æäº¤ï¼šå‡†å¤‡é˜¶æ®µ
        prepareTransaction(transaction);
    }
    
    @Override
    protected void commit(Transaction transaction) {
        // çœŸæ­£æäº¤äº‹åŠ¡
        commitTransaction(transaction);
    }
    
    @Override
    protected void abort(Transaction transaction) {
        // å›æ»šäº‹åŠ¡
        rollbackTransaction(transaction);
    }
}
```

### 6.3 ç«¯åˆ°ç«¯ä¸€è‡´æ€§ä¿è¯


**å®Œæ•´é“¾è·¯è®¾è®¡**ï¼š
```
MySQL â†’ Kafka â†’ Flink â†’ MySQL/ES
  â†“       â†“       â†“        â†“
Binlog  At-least Exactly  Idempotent
è¯»å–     Once    Once     Write
```

**å¹‚ç­‰å†™å…¥å®ç°**ï¼š
```java
public class IdempotentMySQLSink extends RichSinkFunction<OrderResult> {
    
    @Override
    public void invoke(OrderResult result, Context context) {
        // ä½¿ç”¨REPLACE INTOæˆ–ON DUPLICATE KEY UPDATEä¿è¯å¹‚ç­‰
        String sql = "REPLACE INTO order_summary (order_id, user_id, amount, update_time) " +
                    "VALUES (?, ?, ?, ?)";
        
        try (PreparedStatement stmt = connection.prepareStatement(sql)) {
            stmt.setString(1, result.getOrderId());
            stmt.setString(2, result.getUserId());
            stmt.setBigDecimal(3, result.getAmount());
            stmt.setTimestamp(4, new Timestamp(System.currentTimeMillis()));
            stmt.executeUpdate();
        }
    }
}
```

---

## 7. ğŸŒŠ æ°´å°æœºåˆ¶å¤„ç†ä¹±åºæ•°æ®


### 7.1 ä¸ºä»€ä¹ˆä¼šæœ‰ä¹±åºæ•°æ®


**ç°å®åœºæ™¯**ï¼š
```
ç”¨æˆ·åœ¨åœ°é“é‡Œä¸‹å•ï¼š
12:00:10 - ç”¨æˆ·ç‚¹å‡»ä¸‹å•(äº‹ä»¶æ—¶é—´)
12:00:15 - åˆ°è¾¾åœ°é¢ï¼Œç½‘ç»œæ¢å¤
12:00:15 - æ•°æ®åˆ°è¾¾æœåŠ¡å™¨(å¤„ç†æ—¶é—´)

ç»“æœï¼šäº‹ä»¶æ—¶é—´ < å¤„ç†æ—¶é—´ = ä¹±åº
```

**ä¹±åºé—®é¢˜**ï¼š
```
æ­£å¸¸é¡ºåºï¼šA(12:00) â†’ B(12:01) â†’ C(12:02)
ä¹±åºåˆ°è¾¾ï¼šA(12:00) â†’ C(12:02) â†’ B(12:01)

å¦‚æœæŒ‰åˆ°è¾¾é¡ºåºè®¡ç®—çª—å£ï¼ŒBäº‹ä»¶å¯èƒ½è¢«åˆ†åˆ°é”™è¯¯çª—å£
```

### 7.2 æ°´å°æœºåˆ¶åŸç†


**æ°´å°æ¦‚å¿µ**ï¼š
```
æ°´å° = "æ—¶é—´è¿›åº¦æŒ‡ç¤ºå™¨"

ç®€å•ç†è§£ï¼š
æ°´å° = å½“å‰å¤„ç†æ—¶é—´ - æœ€å¤§å…è®¸å»¶è¿Ÿ

ä¾‹å¦‚ï¼š
å½“å‰æ—¶é—´12:05ï¼Œæœ€å¤§å»¶è¿Ÿ2åˆ†é’Ÿ
æ°´å° = 12:05 - 2åˆ†é’Ÿ = 12:03

å«ä¹‰ï¼š12:03ä¹‹å‰çš„äº‹ä»¶åº”è¯¥éƒ½åˆ°é½äº†
```

**æ°´å°ç”Ÿæˆç­–ç•¥**ï¼š
```java
// å›ºå®šå»¶è¿Ÿæ°´å°
public class BoundedOutOfOrdernessGenerator implements WatermarkStrategy<Order> {
    
    @Override
    public WatermarkGenerator<Order> createWatermarkGenerator(WatermarkGeneratorSupplier.Context context) {
        return new WatermarkGenerator<Order>() {
            private final long maxOutOfOrderness = 5000; // 5ç§’å»¶è¿Ÿ
            private long maxTimestamp = 0;
            
            @Override
            public void onEvent(Order event, long eventTimestamp, WatermarkOutput output) {
                maxTimestamp = Math.max(maxTimestamp, eventTimestamp);
            }
            
            @Override
            public void onPeriodicEmit(WatermarkOutput output) {
                // å‘å‡ºæ°´å°ï¼šæœ€å¤§æ—¶é—´æˆ³ - æœ€å¤§ä¹±åºæ—¶é—´
                output.emitWatermark(new Watermark(maxTimestamp - maxOutOfOrderness - 1));
            }
        };
    }
    
    @Override
    public TimestampAssigner<Order> createTimestampAssigner(TimestampAssignerSupplier.Context context) {
        return (event, timestamp) -> event.getOrderTime().getTime();
    }
}
```

### 7.3 è¿Ÿåˆ°æ•°æ®å¤„ç†


**å¤„ç†ç­–ç•¥**ï¼š
```java
SingleOutputStreamOperator<OrderSummary> result = orders
    .assignTimestampsAndWatermarks(
        WatermarkStrategy.<Order>forBoundedOutOfOrderness(Duration.ofMinutes(2))
    )
    .keyBy(Order::getUserId)
    .window(TumblingEventTimeWindows.of(Time.minutes(5)))
    .allowedLateness(Time.minutes(1))  // å…è®¸1åˆ†é’Ÿè¿Ÿåˆ°
    .sideOutputLateData(lateOrdersTag) // è¶…æ—¶æ•°æ®è¾“å‡ºåˆ°ä¾§æµ
    .aggregate(new OrderAggregator());

// å¤„ç†è¿Ÿåˆ°æ•°æ®
DataStream<Order> lateOrders = result.getSideOutput(lateOrdersTag);
lateOrders.addSink(new LateDataHandler()); // å•ç‹¬å¤„ç†è¶…æ—¶æ•°æ®
```

---

## 8. ğŸ”„ æµæ‰¹ä¸€ä½“å¤„ç†æ¶æ„


### 8.1 æµæ‰¹ç»Ÿä¸€æ¦‚å¿µ


**ä¼ ç»Ÿé—®é¢˜**ï¼š
```
æ‰¹å¤„ç†ï¼šé€‚åˆå†å²æ•°æ®åˆ†æï¼Œå»¶è¿Ÿé«˜
æµå¤„ç†ï¼šé€‚åˆå®æ—¶è®¡ç®—ï¼Œä½†å¤„ç†èƒ½åŠ›æœ‰é™

é—®é¢˜ï¼š
â€¢ éœ€è¦ç»´æŠ¤ä¸¤å¥—ä»£ç 
â€¢ æ•°æ®ä¸€è‡´æ€§éš¾ä¿è¯
â€¢ å¼€å‘ç»´æŠ¤æˆæœ¬é«˜
```

**æµæ‰¹ä¸€ä½“è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç»Ÿä¸€APIï¼šåŒä¸€å¥—ä»£ç åŒæ—¶æ”¯æŒæµå’Œæ‰¹
ç»Ÿä¸€å¼•æ“ï¼šåº•å±‚ä½¿ç”¨ç›¸åŒè®¡ç®—å¼•æ“
ç»Ÿä¸€è¯­ä¹‰ï¼šæµæ‰¹å¤„ç†ç»“æœä¸€è‡´
```

### 8.2 Flinkæµæ‰¹ä¸€ä½“å®ç°


**ç»Ÿä¸€Table API**ï¼š
```java
// åŒä¸€ä»½ä»£ç ï¼Œæ—¢æ”¯æŒæµå¤„ç†ä¹Ÿæ”¯æŒæ‰¹å¤„ç†
EnvironmentSettings settings = EnvironmentSettings
    .newInstance()
    .inStreamingMode()  // æˆ– inBatchMode()
    .build();

TableEnvironment tableEnv = TableEnvironment.create(settings);

// æ³¨å†ŒMySQLè¡¨
tableEnv.executeSql(
    "CREATE TABLE orders (" +
    "  order_id STRING," +
    "  user_id STRING," +
    "  amount DECIMAL(10,2)," +
    "  order_time TIMESTAMP(3)" +
    ") WITH (" +
    "  'connector' = 'mysql-cdc'," +
    "  'hostname' = 'localhost'," +
    "  'port' = '3306'," +
    "  'username' = 'root'," +
    "  'password' = 'password'," +
    "  'database-name' = 'ecommerce'," +
    "  'table-name' = 'orders'" +
    ")"
);

// ç»Ÿä¸€SQLæŸ¥è¯¢
Table result = tableEnv.sqlQuery(
    "SELECT " +
    "  user_id, " +
    "  COUNT(*) as order_count, " +
    "  SUM(amount) as total_amount " +
    "FROM orders " +
    "GROUP BY user_id"
);
```

### 8.3 Lambdaæ¶æ„ vs Kappaæ¶æ„


**Lambdaæ¶æ„**ï¼š
```
æ¶æ„ç»„æˆï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰¹å¤„ç†å±‚   â”‚    â”‚   æµå¤„ç†å±‚   â”‚
â”‚ (Spark/Hive)â”‚    â”‚   (Flink)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              åˆå¹¶å±‚
```

**Kappaæ¶æ„**ï¼š
```
ç»Ÿä¸€æµå¤„ç†ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç»Ÿä¸€æµå¤„ç†å¹³å°           â”‚
â”‚      (Flink/Kafka Streams)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
å®æ—¶ç»“æœ        å†å²é‡ç®—
```

---

## 9. ğŸ“Š æ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§


### 9.1 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**èµ„æºé…ç½®ä¼˜åŒ–**ï¼š
```yaml
# Flinkä½œä¸šé…ç½®
jobmanager.memory.process.size: 2gb
taskmanager.memory.process.size: 4gb
taskmanager.numberOfTaskSlots: 4
parallelism.default: 8

# JVMè°ƒä¼˜
env.java.opts: "-XX:+UseG1GC -XX:MaxGCPauseMillis=100"
```

**ç®—å­çº§åˆ«ä¼˜åŒ–**ï¼š
```java
// åˆç†ä½¿ç”¨KeyedState
public class OptimizedAggregateFunction 
    extends KeyedProcessFunction<String, Order, OrderSummary> {
    
    // ä½¿ç”¨MapStateæ›¿ä»£ValueStateï¼Œå‡å°‘åºåˆ—åŒ–å¼€é”€
    private MapState<String, BigDecimal> userAmountState;
    
    @Override
    public void processElement(Order order, Context ctx, Collector<OrderSummary> out) {
        String userId = order.getUserId();
        BigDecimal currentAmount = userAmountState.get(userId);
        
        if (currentAmount == null) {
            currentAmount = BigDecimal.ZERO;
        }
        
        BigDecimal newAmount = currentAmount.add(order.getAmount());
        userAmountState.put(userId, newAmount);
        
        out.collect(new OrderSummary(userId, newAmount));
    }
}
```

### 9.2 æµå¤„ç†ç›‘æ§ä½“ç³»


**å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸš€ ååé‡ç›‘æ§ï¼š
â€¢ records-consumed-rate: æ¯ç§’æ¶ˆè´¹è®°å½•æ•°
â€¢ records-produced-rate: æ¯ç§’ç”Ÿäº§è®°å½•æ•°
â€¢ bytes-consumed-rate: æ¯ç§’æ¶ˆè´¹å­—èŠ‚æ•°

â±ï¸ å»¶è¿Ÿç›‘æ§ï¼š
â€¢ end-to-end-latency: ç«¯åˆ°ç«¯å»¶è¿Ÿ
â€¢ processing-time-lag: å¤„ç†æ—¶é—´æ»å
â€¢ event-time-lag: äº‹ä»¶æ—¶é—´æ»å

ğŸ’¾ èµ„æºç›‘æ§ï¼š
â€¢ memory-utilization: å†…å­˜ä½¿ç”¨ç‡
â€¢ cpu-utilization: CPUä½¿ç”¨ç‡
â€¢ gc-time-percentage: GCæ—¶é—´å æ¯”
```

**ç›‘æ§å®ç°**ï¼š
```java
// è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§
public class OrderProcessFunction extends KeyedProcessFunction<String, Order, OrderResult> {
    
    private transient Counter processedCounter;
    private transient Histogram processingTimeHistogram;
    
    @Override
    public void open(Configuration parameters) {
        // æ³¨å†Œè®¡æ•°å™¨
        processedCounter = getRuntimeContext()
            .getMetricGroup()
            .counter("orders_processed");
            
        // æ³¨å†Œç›´æ–¹å›¾
        processingTimeHistogram = getRuntimeContext()
            .getMetricGroup()
            .histogram("processing_time", new DescriptiveStatisticsHistogram(1000));
    }
    
    @Override
    public void processElement(Order order, Context ctx, Collector<OrderResult> out) {
        long startTime = System.currentTimeMillis();
        
        // å¤„ç†é€»è¾‘
        OrderResult result = processOrder(order);
        out.collect(result);
        
        // æ›´æ–°æŒ‡æ ‡
        processedCounter.inc();
        processingTimeHistogram.update(System.currentTimeMillis() - startTime);
    }
}
```

### 9.3 è‡ªåŠ¨è°ƒåº¦ä¸æ‰©ç¼©å®¹


**åŠ¨æ€èµ„æºè°ƒåº¦**ï¼š
```java
// åŸºäºèƒŒå‹çš„è‡ªåŠ¨æ‰©å®¹
public class AutoScalingJobManager {
    
    public void checkAndScale(JobID jobId) {
        JobMetrics metrics = getJobMetrics(jobId);
        
        // æ£€æŸ¥èƒŒå‹æƒ…å†µ
        if (metrics.getBackpressureRatio() > 0.8) {
            // èƒŒå‹ä¸¥é‡ï¼Œå¢åŠ å¹¶è¡Œåº¦
            int currentParallelism = getCurrentParallelism(jobId);
            int newParallelism = Math.min(currentParallelism * 2, MAX_PARALLELISM);
            
            rescaleJob(jobId, newParallelism);
            
        } else if (metrics.getBackpressureRatio() < 0.1 && metrics.getCpuUtilization() < 0.3) {
            // èµ„æºå……è¶³ï¼Œå‡å°‘å¹¶è¡Œåº¦
            int currentParallelism = getCurrentParallelism(jobId);
            int newParallelism = Math.max(currentParallelism / 2, MIN_PARALLELISM);
            
            rescaleJob(jobId, newParallelism);
        }
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æµå¼è®¡ç®—æœ¬è´¨ï¼šå®æ—¶å¤„ç†è¿ç»­æ•°æ®æµï¼Œä½å»¶è¿Ÿå“åº”
ğŸ”¸ MySQLé›†æˆæ–¹å¼ï¼šé€šè¿‡Binlog CDCå®ç°å®æ—¶æ•°æ®æ•è·
ğŸ”¸ çª—å£å‡½æ•°ç±»å‹ï¼šæ»šåŠ¨ã€æ»‘åŠ¨ã€ä¼šè¯çª—å£çš„åŒºåˆ«å’Œåº”ç”¨
ğŸ”¸ çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼šæ£€æŸ¥ç‚¹ã€å®¹é”™ã€çŠ¶æ€æŒä¹…åŒ–
ğŸ”¸ ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ï¼šä¸¤é˜¶æ®µæäº¤ã€å¹‚ç­‰æ“ä½œã€ç«¯åˆ°ç«¯ä¸€è‡´æ€§
ğŸ”¸ æ°´å°æœºåˆ¶ä½œç”¨ï¼šå¤„ç†ä¹±åºæ•°æ®ï¼Œæ§åˆ¶çª—å£è§¦å‘æ—¶æœº
ğŸ”¸ æµæ‰¹ä¸€ä½“ä¼˜åŠ¿ï¼šç»Ÿä¸€APIã€é™ä½ç»´æŠ¤æˆæœ¬ã€ä¿è¯æ•°æ®ä¸€è‡´æ€§
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æµå¼è®¡ç®—vsæ‰¹å¤„ç†çš„æœ¬è´¨åŒºåˆ«**ï¼š
```
æ‰¹å¤„ç†æ€ç»´ï¼šæ”’å¤Ÿä¸€æ‰¹æ•°æ®å†å¤„ç†ï¼Œè¿½æ±‚ååé‡
æµå¼è®¡ç®—æ€ç»´ï¼šæ¥ä¸€æ¡å¤„ç†ä¸€æ¡ï¼Œè¿½æ±‚ä½å»¶è¿Ÿ

é€‰æ‹©åŸåˆ™ï¼š
â€¢ å®æ—¶æ€§è¦æ±‚é«˜ â†’ æµå¼è®¡ç®—
â€¢ æ•°æ®é‡å¤§ï¼Œè®¡ç®—å¤æ‚ â†’ æ‰¹å¤„ç†
â€¢ ä¸¤è€…å…¼é¡¾ â†’ æµæ‰¹ä¸€ä½“æ¶æ„
```

**ğŸ”¹ çŠ¶æ€ç®¡ç†çš„é‡è¦æ€§**ï¼š
```
æ— çŠ¶æ€è®¡ç®—ï¼šæ¯æ¡æ•°æ®ç‹¬ç«‹å¤„ç†ï¼Œç®€å•ä½†åŠŸèƒ½æœ‰é™
æœ‰çŠ¶æ€è®¡ç®—ï¼šéœ€è¦è®°ä½å†å²ä¿¡æ¯ï¼Œå¤æ‚ä½†åŠŸèƒ½å¼ºå¤§

å…¸å‹åº”ç”¨ï¼š
â€¢ ç´¯è®¡ç»Ÿè®¡ï¼šéœ€è¦è®°ä½ä¹‹å‰çš„ç´¯è®¡å€¼
â€¢ å»é‡å¤„ç†ï¼šéœ€è¦è®°ä½å·²å¤„ç†è¿‡çš„æ•°æ®
â€¢ å¤æ‚äº‹ä»¶å¤„ç†ï¼šéœ€è¦è®°ä½äº‹ä»¶åºåˆ—
```

**ğŸ”¹ å®¹é”™æœºåˆ¶çš„å¿…è¦æ€§**ï¼š
```
åˆ†å¸ƒå¼ç¯å¢ƒç‰¹ç‚¹ï¼šæœºå™¨æ•…éšœæ˜¯å¸¸æ€ï¼Œä¸æ˜¯ä¾‹å¤–

å®¹é”™ç­–ç•¥ï¼š
â€¢ æ£€æŸ¥ç‚¹æœºåˆ¶ï¼šå®šæœŸä¿å­˜çŠ¶æ€å¿«ç…§
â€¢ é‡å¯ç­–ç•¥ï¼šæ•…éšœåè‡ªåŠ¨æ¢å¤
â€¢ ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ï¼šé¿å…æ•°æ®é‡å¤æˆ–ä¸¢å¤±
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**ï¼š
- **å®æ—¶å¤§å±**ï¼šç”µå•†åŒ11å®æ—¶äº¤æ˜“é¢ç»Ÿè®¡
- **é£æ§ç³»ç»Ÿ**ï¼šä¿¡ç”¨å¡å®æ—¶åæ¬ºè¯ˆæ£€æµ‹  
- **æ¨èç³»ç»Ÿ**ï¼šç”¨æˆ·è¡Œä¸ºå®æ—¶ç‰¹å¾æ›´æ–°
- **ç›‘æ§å‘Šè­¦**ï¼šç³»ç»Ÿå¼‚å¸¸å®æ—¶æ£€æµ‹å’Œå‘Šè­¦
- **æ•°æ®åŒæ­¥**ï¼šMySQLåˆ°æ•°æ®ä»“åº“çš„å®æ—¶ETL

**ğŸ’¡ æ¶æ„è®¾è®¡å»ºè®®**ï¼š
```
å°è§„æ¨¡åº”ç”¨ï¼š
MySQL â†’ Kafka â†’ Flink â†’ MySQL/Redis

å¤§è§„æ¨¡åº”ç”¨ï¼š  
MySQL â†’ Canal â†’ Kafka â†’ Flink â†’ Elasticsearch/HBase
              â†“
            ç¦»çº¿æ•°ä»“(HDFS/Hive)

å…³é”®è€ƒé‡ï¼š
â€¢ æ•°æ®é‡çº§ï¼šå†³å®šæŠ€æœ¯é€‰å‹å’Œæ¶æ„å¤æ‚åº¦
â€¢ å»¶è¿Ÿè¦æ±‚ï¼šå†³å®šä¼˜åŒ–é‡ç‚¹å’Œèµ„æºæŠ•å…¥
â€¢ ä¸€è‡´æ€§è¦æ±‚ï¼šå†³å®šå®¹é”™çº§åˆ«å’Œå¤æ‚åº¦
â€¢ è¿ç»´èƒ½åŠ›ï¼šå†³å®šç³»ç»Ÿå¤æ‚åº¦å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦
```

**ğŸ”§ è¿ç»´æœ€ä½³å®è·µ**ï¼š
```
å¼€å‘é˜¶æ®µï¼š
â€¢ å……åˆ†æµ‹è¯•å„ç§å¼‚å¸¸åœºæ™¯
â€¢ è®¾è®¡åˆç†çš„ç›‘æ§æŒ‡æ ‡
â€¢ é¢„ç•™è¶³å¤Ÿçš„èµ„æºbuffer

éƒ¨ç½²é˜¶æ®µï¼š
â€¢ ç°åº¦å‘å¸ƒï¼Œé€æ­¥æ¨å…¨
â€¢ å®Œå–„çš„å›æ»šæœºåˆ¶
â€¢ è¯¦ç»†çš„æ“ä½œæ–‡æ¡£

è¿ç»´é˜¶æ®µï¼š
â€¢ 7Ã—24å°æ—¶ç›‘æ§å‘Šè­¦
â€¢ å®šæœŸå¤‡ä»½æ£€æŸ¥ç‚¹æ•°æ®
â€¢ æ€§èƒ½è°ƒä¼˜å’Œå®¹é‡è§„åˆ’
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æµå¼è®¡ç®—è¿½æ±‚å®æ—¶æ€§ï¼ŒçŠ¶æ€ç®¡ç†æ˜¯æ ¸å¿ƒ
- MySQLé€šè¿‡Binlog CDCæ— ç¼é›†æˆæµè®¡ç®—
- æ°´å°æœºåˆ¶è§£å†³ä¹±åºï¼Œçª—å£å‡½æ•°å®ç°èšåˆ
- ç²¾ç¡®ä¸€æ¬¡è¯­ä¹‰ä¿è¯æ•°æ®å‡†ç¡®æ€§
- æµæ‰¹ä¸€ä½“é™ä½å¼€å‘ç»´æŠ¤æˆæœ¬
- ç›‘æ§å’Œå®¹é”™æ˜¯ç”Ÿäº§ç¯å¢ƒå¿…å¤‡