---
title: 2ã€åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ä¿è¯
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸºç¡€ç†è®º](#1-åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸºç¡€ç†è®º)
2. [ä¸€è‡´æ€§æ¨¡å‹æ·±åº¦è§£æ](#2-ä¸€è‡´æ€§æ¨¡å‹æ·±åº¦è§£æ)
3. [æ•°æ®åŒæ­¥æœºåˆ¶å®ç°](#3-æ•°æ®åŒæ­¥æœºåˆ¶å®ç°)
4. [å†²çªæ£€æµ‹ä¸è§£å†³ç­–ç•¥](#4-å†²çªæ£€æµ‹ä¸è§£å†³ç­–ç•¥)
5. [åˆ†å¸ƒå¼é”ä¸åè°ƒæœºåˆ¶](#5-åˆ†å¸ƒå¼é”ä¸åè°ƒæœºåˆ¶)
6. [ä¸€è‡´æ€§ç›‘æ§ä¸è¿ç»´](#6-ä¸€è‡´æ€§ç›‘æ§ä¸è¿ç»´)
7. [æ€§èƒ½ä¼˜åŒ–ä¸å®è·µç­–ç•¥](#7-æ€§èƒ½ä¼˜åŒ–ä¸å®è·µç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸºç¡€ç†è®º


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> æƒ³è±¡ä¸€ä¸ªè¿é”é“¶è¡Œï¼Œä½ åœ¨åŒ—äº¬å­˜äº†1000å…ƒï¼ŒåŒæ—¶åœ¨ä¸Šæµ·ä¹Ÿæƒ³æŸ¥è¯¢ä½™é¢ã€‚å¦‚ä½•ä¿è¯ä¸¤ä¸ªåœ°æ–¹çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Ÿè¿™å°±æ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚

**æ ¸å¿ƒå®šä¹‰**
```
åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¸Šçš„æ•°æ®å‰¯æœ¬
ä¿æŒåŒæ­¥å’Œä¸€è‡´çš„çŠ¶æ€ï¼Œç¡®ä¿ç”¨æˆ·æ— è®ºè®¿é—®å“ªä¸ªèŠ‚ç‚¹ï¼Œ
éƒ½èƒ½è·å¾—ç›¸åŒçš„æ•°æ®è§†å›¾ã€‚
```

**ğŸ“Š ä¸€è‡´æ€§çš„é‡è¦æ€§**
- **ç”¨æˆ·ä½“éªŒ**ï¼šé¿å…ç”¨æˆ·çœ‹åˆ°è¿‡æœŸæˆ–é”™è¯¯æ•°æ®
- **ä¸šåŠ¡æ­£ç¡®æ€§**ï¼šä¿è¯äº¤æ˜“ã€è®¢å•ç­‰å…³é”®ä¸šåŠ¡æ•°æ®å‡†ç¡®
- **ç³»ç»Ÿå¯é æ€§**ï¼šé˜²æ­¢æ•°æ®ä¸ä¸€è‡´å¯¼è‡´çš„ç³»ç»Ÿæ•…éšœ
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³é‡‘èã€åŒ»ç–—ç­‰è¡Œä¸šçš„æ•°æ®ä¸€è‡´æ€§è¦æ±‚

### 1.2 CAPå®šç†ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„é“ä¸‰è§’


**ğŸ” CAPå®šç†æ·±åº¦ç†è§£**
```
C - Consistencyï¼ˆä¸€è‡´æ€§ï¼‰
æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°ç›¸åŒçš„æ•°æ®

A - Availabilityï¼ˆå¯ç”¨æ€§ï¼‰  
ç³»ç»ŸæŒç»­æä¾›æœåŠ¡ï¼Œå³ä½¿éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆ

P - Partition Toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰
ç³»ç»Ÿåœ¨ç½‘ç»œåˆ†åŒºæ—¶ä»èƒ½ç»§ç»­å·¥ä½œ

æ ¸å¿ƒè§‚ç‚¹ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶ä¿è¯å…¶ä¸­ä¸¤ä¸ªç‰¹æ€§
```

**ğŸ¨ CAPæƒè¡¡ç­–ç•¥**

```
é“¶è¡Œç³»ç»Ÿæ¶æ„é€‰æ‹©ï¼š

CPç³»ç»Ÿï¼ˆä¸€è‡´æ€§+åˆ†åŒºå®¹é”™ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“   â”‚ â”€â”€â”€â”‚   å¤‡æ•°æ®åº“   â”‚
â”‚ å¼ºä¸€è‡´ä¿è¯   â”‚    â”‚  åŒæ­¥ç­‰å¾…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜ç‚¹ï¼šæ•°æ®ç»å¯¹å‡†ç¡®
ç¼ºç‚¹ï¼šå¯ç”¨æ€§é™ä½ï¼Œå“åº”è¾ƒæ…¢

APç³»ç»Ÿï¼ˆå¯ç”¨æ€§+åˆ†åŒºå®¹é”™ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   èŠ‚ç‚¹1     â”‚    â”‚    èŠ‚ç‚¹2    â”‚
â”‚ å¿«é€Ÿå“åº”    â”‚ ~~~â”‚  å¼‚æ­¥åŒæ­¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ï¼Œå“åº”å¿«é€Ÿ
ç¼ºç‚¹ï¼šçŸ­æœŸå†…æ•°æ®å¯èƒ½ä¸ä¸€è‡´
```

**ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯**
- **CPåœºæ™¯**ï¼šé“¶è¡Œè½¬è´¦ã€åº“å­˜æ‰£å‡ã€è®¢å•æ”¯ä»˜
- **APåœºæ™¯**ï¼šç¤¾äº¤åª’ä½“ã€å†…å®¹æ¨èã€ç”¨æˆ·æµè§ˆè®°å½•
- **CAåœºæ™¯**ï¼šå•æœºç³»ç»Ÿæˆ–å°è§„æ¨¡é›†ç¾¤ï¼ˆç½‘ç»œåˆ†åŒºæ¦‚ç‡ä½ï¼‰

### 1.3 BASEç†è®ºï¼šæœ€ç»ˆä¸€è‡´æ€§çš„å®ç”¨æŒ‡å¯¼


**ğŸ¯ BASEç†è®ºæ ¸å¿ƒæ¦‚å¿µ**
```
BA - Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰
ç³»ç»ŸåŸºæœ¬åŠŸèƒ½å¯ç”¨ï¼Œä½†å¯èƒ½æœ‰æ€§èƒ½æˆ–åŠŸèƒ½é™çº§

S - Soft Stateï¼ˆè½¯çŠ¶æ€ï¼‰
æ•°æ®å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…å¤„äºä¸ä¸€è‡´çŠ¶æ€

E - Eventually Consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰
ç³»ç»Ÿä¿è¯åœ¨æ²¡æœ‰æ–°æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œæœ€ç»ˆæ‰€æœ‰å‰¯æœ¬ä¼šä¸€è‡´
```

**ğŸ”„ æœ€ç»ˆä¸€è‡´æ€§å®ç°æ¨¡å¼**

```
å…¸å‹åœºæ™¯ï¼šç”¨æˆ·æ³¨å†Œç³»ç»Ÿ

ç¬¬ä¸€æ­¥ï¼šä¸»åº“å†™å…¥æˆåŠŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“   â”‚ â† ç”¨æˆ·æ³¨å†Œä¿¡æ¯å†™å…¥æˆåŠŸ
â”‚  UserID:123 â”‚
â”‚ Status: å†™å…¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒæ­¥ï¼šå¼‚æ­¥åŒæ­¥åˆ°ä»åº“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å¼‚æ­¥å¤åˆ¶    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚   ä»æ•°æ®åº“   â”‚
â”‚  UserID:123 â”‚              â”‚   åŒæ­¥ä¸­...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰æ­¥ï¼šæœ€ç»ˆè¾¾åˆ°ä¸€è‡´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“   â”‚              â”‚   ä»æ•°æ®åº“   â”‚
â”‚  UserID:123 â”‚ ============ â”‚  UserID:123 â”‚
â”‚ Status: å®Œæˆ â”‚              â”‚ Status: å®Œæˆ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ“‹ ä¸€è‡´æ€§æ¨¡å‹æ·±åº¦è§£æ


### 2.1 å¼ºä¸€è‡´æ€§æ¨¡å‹


**ğŸ”’ å¼ºä¸€è‡´æ€§ç‰¹ç‚¹**
```
å®šä¹‰ï¼šä»»ä½•è¯»æ“ä½œéƒ½èƒ½è¯»åˆ°æœ€æ–°å†™å…¥çš„æ•°æ®
ä¿è¯ï¼šçº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizabilityï¼‰
ä»£ä»·ï¼šæ€§èƒ½å’Œå¯ç”¨æ€§çš„æ˜¾è‘—ä¸‹é™
```

**ğŸ’» MySQLå¼ºä¸€è‡´æ€§å®ç°**
```sql
-- 1. åŒæ­¥å¤åˆ¶æ¨¡å¼
SET GLOBAL rpl_semi_sync_master_enabled = 1;
SET GLOBAL rpl_semi_sync_master_timeout = 1000;

-- 2. å¼ºåˆ¶ä»ä¸»åº“è¯»å–
SELECT * FROM users WHERE id = 123 
-- ç¡®ä¿è¯»å–æœ€æ–°æ•°æ®

-- 3. åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰
START TRANSACTION;
-- è·¨å¤šä¸ªæ•°æ®åº“çš„æ“ä½œ
INSERT INTO db1.orders VALUES (...);
INSERT INTO db2.inventory VALUES (...);
COMMIT; -- è¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
```

### 2.2 æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹è¯¦è§£


**ğŸŒŠ æœ€ç»ˆä¸€è‡´æ€§çš„ç°å®æ„ä¹‰**

> **ğŸ  ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒä½ å‘çš„å¾®ä¿¡æœ‹å‹åœˆï¼Œä¸æ˜¯æ‰€æœ‰å¥½å‹éƒ½ä¼šåŒæ—¶çœ‹åˆ°ï¼Œä½†æœ€ç»ˆå¤§å®¶éƒ½ä¼šæ”¶åˆ°è¿™æ¡æ¶ˆæ¯ã€‚

**â° ä¸€è‡´æ€§æ—¶é—´çª—å£**
```
ä¸€è‡´æ€§æ”¶æ•›è¿‡ç¨‹ï¼š

T0: æ•°æ®æ›´æ–°
â”Œâ”€â”€â”€â”€â”€â”
â”‚ ä¸»åº“ â”‚ â† å†™å…¥æ–°æ•°æ®
â””â”€â”€â”€â”€â”€â”˜

T1: å¼‚æ­¥å¤åˆ¶å¼€å§‹ï¼ˆä¸ä¸€è‡´çª—å£ï¼‰
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚ ä¸»åº“ â”‚ ~~> â”‚ä»åº“1â”‚ ~~> â”‚ä»åº“2â”‚
â”‚ æ–°å€¼ â”‚     â”‚ æ—§å€¼â”‚     â”‚ æ—§å€¼â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜

T2: æœ€ç»ˆä¸€è‡´æ€§è¾¾æˆ
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”
â”‚ ä¸»åº“ â”‚ === â”‚ä»åº“1â”‚ === â”‚ä»åº“2â”‚
â”‚ æ–°å€¼ â”‚     â”‚ æ–°å€¼â”‚     â”‚ æ–°å€¼â”‚
â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”˜

ä¸ä¸€è‡´çª—å£ï¼šT1 - T0 (é€šå¸¸å‡ æ¯«ç§’åˆ°å‡ ç§’)
```

### 2.3 ä¼šè¯ä¸€è‡´æ€§ä¸å› æœä¸€è‡´æ€§


**ğŸ‘¤ ä¼šè¯ä¸€è‡´æ€§ï¼šç”¨æˆ·è§†è§’çš„ä¸€è‡´æ€§**
```
æ ¸å¿ƒæ€æƒ³ï¼šåŒä¸€ä¸ªç”¨æˆ·ä¼šè¯ä¸­çœ‹åˆ°æ•°æ®çš„ä¸€è‡´æ€§é€’å¢

å®ç°æ–¹å¼ï¼š
1. è¯»å†™åˆ†ç¦»æ—¶ï¼Œå†™æ“ä½œåçš„è¯»æ“ä½œè·¯ç”±åˆ°ä¸»åº“
2. ä½¿ç”¨session stickyç¡®ä¿ç”¨æˆ·è¯·æ±‚åˆ°åŒä¸€èŠ‚ç‚¹
3. è®°å½•ç”¨æˆ·æœ€åå†™å…¥æ—¶é—´ï¼Œç¡®ä¿è¯»å–æ•°æ®ä¸æ—©äºå†™å…¥
```

```java
// ä¼šè¯ä¸€è‡´æ€§å®ç°ç¤ºä¾‹
public class SessionConsistentClient {
    private long lastWriteTimestamp = 0;
    
    public void write(String key, String value) {
        // å†™å…¥ä¸»åº“
        masterDB.write(key, value);
        lastWriteTimestamp = System.currentTimeMillis();
    }
    
    public String read(String key) {
        // å¦‚æœåˆšå†™å…¥ï¼Œä»ä¸»åº“è¯»å–
        if (System.currentTimeMillis() - lastWriteTimestamp < 1000) {
            return masterDB.read(key);
        }
        // å¦åˆ™å¯ä»¥ä»ä»åº“è¯»å–
        return slaveDB.read(key);
    }
}
```

**ğŸ”— å› æœä¸€è‡´æ€§ï¼šäº‹ä»¶ä¾èµ–å…³ç³»çš„ä¿è¯**
```
åœºæ™¯ï¼šç”¨æˆ·Aå‘è¡¨æ–‡ç« ï¼Œç”¨æˆ·Bè¯„è®ºè¯¥æ–‡ç« 

å› æœå…³ç³»ï¼šBçš„è¯„è®ºä¾èµ–äºAçš„æ–‡ç« 
ä¿è¯ï¼šå¦‚æœBèƒ½çœ‹åˆ°Açš„æ–‡ç« ï¼Œé‚£ä¹ˆAä¹Ÿèƒ½çœ‹åˆ°Bçš„è¯„è®º
```

### 2.4 å‘é‡æ—¶é’Ÿï¼šåˆ†å¸ƒå¼å› æœå…³ç³»è¿½è¸ª


**ğŸ• å‘é‡æ—¶é’Ÿå·¥ä½œåŸç†**

> **ğŸ  ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒå®¶åº­ç¾¤èŠè®°å½•ï¼Œæ¯ä¸ªäººå‘æ¶ˆæ¯æ—¶ä¼šæ ‡æ³¨æ—¶é—´ï¼Œè¿™æ ·å°±èƒ½çŸ¥é“æ¶ˆæ¯çš„å…ˆåé¡ºåºå’Œå› æœå…³ç³»ã€‚

**ğŸ“Š å‘é‡æ—¶é’Ÿæ•°æ®ç»“æ„**
```
èŠ‚ç‚¹Açš„å‘é‡æ—¶é’Ÿï¼š[A:3, B:1, C:2]
å«ä¹‰ï¼š
- Aæ‰§è¡Œäº†3æ¬¡æ“ä½œ
- AçŸ¥é“Bæ‰§è¡Œäº†1æ¬¡æ“ä½œ  
- AçŸ¥é“Cæ‰§è¡Œäº†2æ¬¡æ“ä½œ
```

**ğŸ”„ å‘é‡æ—¶é’Ÿæ›´æ–°è§„åˆ™**
```
åœºæ™¯ï¼šä¸‰ä¸ªèŠ‚ç‚¹çš„æ•°æ®åº“é›†ç¾¤

åˆå§‹çŠ¶æ€ï¼š
Node A: [A:0, B:0, C:0]
Node B: [A:0, B:0, C:0]  
Node C: [A:0, B:0, C:0]

æ“ä½œ1ï¼šAå†™å…¥æ•°æ®
Node A: [A:1, B:0, C:0] â† Aè‡ªå¢
Node B: [A:0, B:0, C:0]
Node C: [A:0, B:0, C:0]

æ“ä½œ2ï¼šBæ¥æ”¶Açš„æ›´æ–°
Node A: [A:1, B:0, C:0]
Node B: [A:1, B:1, C:0] â† åˆå¹¶Açš„æ—¶é’Ÿï¼ŒBè‡ªå¢
Node C: [A:0, B:0, C:0]

å†²çªæ£€æµ‹ï¼šå¦‚æœä¸¤ä¸ªå‘é‡æ—¶é’Ÿæ— æ³•æ¯”è¾ƒå¤§å°ï¼Œè¯´æ˜å­˜åœ¨å¹¶å‘å†²çª
```

---

## 3. âš™ï¸ æ•°æ®åŒæ­¥æœºåˆ¶å®ç°


### 3.1 MySQLä¸»ä»å¤åˆ¶æœºåˆ¶æ·±åº¦å‰–æ


**ğŸ”„ MySQLå¤åˆ¶çš„ä¸‰ç§æ¨¡å¼**

**1. å¼‚æ­¥å¤åˆ¶ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰**
```
å·¥ä½œæµç¨‹ï¼š
å®¢æˆ·ç«¯å†™å…¥ â†’ ä¸»åº“ç¡®è®¤ â†’ å®¢æˆ·ç«¯æ”¶åˆ°å“åº”
     â†“ï¼ˆå¼‚æ­¥ï¼‰
   ä»åº“åŒæ­¥

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å†™å…¥    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  ä¸»æ•°æ®åº“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                      â”‚
     â”‚ ç«‹å³å“åº”               â”‚ å¼‚æ­¥å¤åˆ¶
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â†“
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ ä»æ•°æ®åº“ â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šæ€§èƒ½æœ€å¥½ï¼Œå»¶è¿Ÿæœ€ä½
ç¼ºç‚¹ï¼šä¸»åº“æ•…éšœå¯èƒ½ä¸¢å¤±æ•°æ®
```

**2. åŠåŒæ­¥å¤åˆ¶ï¼ˆç”Ÿäº§æ¨èï¼‰**
```sql
-- ä¸»åº“é…ç½®
SET GLOBAL rpl_semi_sync_master_enabled = 1;
SET GLOBAL rpl_semi_sync_master_timeout = 1000; -- 1ç§’è¶…æ—¶

-- ä»åº“é…ç½®  
SET GLOBAL rpl_semi_sync_slave_enabled = 1;
```

```
å·¥ä½œæµç¨‹ï¼š
å®¢æˆ·ç«¯å†™å…¥ â†’ ä¸»åº“å†™å…¥ â†’ è‡³å°‘ä¸€ä¸ªä»åº“ç¡®è®¤ â†’ å®¢æˆ·ç«¯æ”¶åˆ°å“åº”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  ä¸»æ•°æ®åº“ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                      â”‚
     â”‚ ç­‰å¾…ç¡®è®¤               â”‚ åŒæ­¥å¤åˆ¶
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â†“
               â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â””â”€â”€â”€â”€â”€â”€ â”‚ ä»æ•°æ®åº“ â”‚ â”€â”€ å‘é€ACK
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜ç‚¹ï¼šæ•°æ®å®‰å…¨æ€§é«˜ï¼Œå‡ ä¹ä¸ä¸¢æ•°æ®
ç¼ºç‚¹ï¼šæ€§èƒ½ç•¥æœ‰ä¸‹é™
```

### 3.2 Gossipåè®®ï¼šå»ä¸­å¿ƒåŒ–åŒæ­¥


**ğŸ—£ï¸ Gossipåè®®æ ¸å¿ƒæ€æƒ³**

> **ğŸ  ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒç—…æ¯’ä¼ æ’­æˆ–è°£è¨€ä¼ æ’­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éšæœºé€‰æ‹©å…¶ä»–èŠ‚ç‚¹åˆ†äº«ä¿¡æ¯ï¼Œæœ€ç»ˆä¿¡æ¯ä¼šä¼ æ’­åˆ°æ•´ä¸ªç½‘ç»œã€‚

**ğŸ“Š Gossipåè®®å·¥ä½œæµç¨‹**
```
æ­¥éª¤1ï¼šèŠ‚ç‚¹Aæœ‰æ–°æ•°æ®
â”Œâ”€â”€â”€â”
â”‚ A â”‚ â† æ–°æ•°æ®äº§ç”Ÿ
â””â”€â”€â”€â”˜

æ­¥éª¤2ï¼šAéšæœºé€‰æ‹©é‚»å±…èŠ‚ç‚¹ä¼ æ’­
â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”
â”‚ A â”‚ â”€â”€> â”‚ B â”‚
â””â”€â”€â”€â”˜     â””â”€â”€â”€â”˜
  â”‚         
  â””â”€â”€â”€â”€â”€> â”Œâ”€â”€â”€â”
          â”‚ C â”‚
          â””â”€â”€â”€â”˜

æ­¥éª¤3ï¼šBå’ŒCç»§ç»­ä¼ æ’­
â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”     â”Œâ”€â”€â”€â”
â”‚ A â”‚     â”‚ B â”‚ â”€â”€> â”‚ D â”‚
â””â”€â”€â”€â”˜     â””â”€â”€â”€â”˜     â””â”€â”€â”€â”˜
            â”‚
            â””â”€â”€â”€â”€â”€> â”Œâ”€â”€â”€â”
                    â”‚ E â”‚
                    â””â”€â”€â”€â”˜

æœ€ç»ˆï¼šä¿¡æ¯ä¼ æ’­åˆ°æ•´ä¸ªç½‘ç»œ
```

**ğŸ’» Gossipåè®®MySQLåº”ç”¨**
```python
class GossipSync:
    def __init__(self, node_id, neighbors):
        self.node_id = node_id
        self.neighbors = neighbors
        self.version_vector = {}
        
    def sync_data(self):
        # éšæœºé€‰æ‹©é‚»å±…èŠ‚ç‚¹
        target = random.choice(self.neighbors)
        
        # äº¤æ¢ç‰ˆæœ¬ä¿¡æ¯
        my_versions = self.get_local_versions()
        remote_versions = target.get_versions()
        
        # è¯†åˆ«éœ€è¦åŒæ­¥çš„æ•°æ®
        missing_data = self.find_missing_data(remote_versions)
        
        # å‘é€ç¼ºå¤±çš„æ•°æ®
        target.update_data(missing_data)
```

### 3.3 ä¸€è‡´æ€§å“ˆå¸Œï¼šæ•°æ®åˆ†å¸ƒä¸åŒæ­¥


**ğŸ¯ ä¸€è‡´æ€§å“ˆå¸Œè§£å†³çš„é—®é¢˜**
- èŠ‚ç‚¹å¢å‡æ—¶ï¼Œæœ€å°åŒ–æ•°æ®è¿ç§»
- è´Ÿè½½å‡è¡¡
- æ•…éšœå®¹é”™

**ğŸ”„ ä¸€è‡´æ€§å“ˆå¸Œç¯ç»“æ„**
```
å“ˆå¸Œç¯ç¤ºä¾‹ï¼ˆ0-2^32ï¼‰ï¼š

        èŠ‚ç‚¹B(1000)
           â­¡
    èŠ‚ç‚¹A(500) â—‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—‹ èŠ‚ç‚¹C(1500)
           â­£
        èŠ‚ç‚¹D(2000)

æ•°æ®åˆ†é…è§„åˆ™ï¼š
- key1(hash=800) â†’ é¡ºæ—¶é’ˆæ‰¾åˆ°èŠ‚ç‚¹B
- key2(hash=1200) â†’ é¡ºæ—¶é’ˆæ‰¾åˆ°èŠ‚ç‚¹C
- key3(hash=300) â†’ é¡ºæ—¶é’ˆæ‰¾åˆ°èŠ‚ç‚¹A
```

**ğŸ’» ä¸€è‡´æ€§å“ˆå¸ŒMySQLåˆ†ç‰‡**
```java
public class ConsistentHashSharding {
    private TreeMap<Long, String> ring = new TreeMap<>();
    
    public void addNode(String node) {
        // ä¸ºæ¯ä¸ªç‰©ç†èŠ‚ç‚¹åˆ›å»ºå¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹
        for (int i = 0; i < 150; i++) {
            String virtualNode = node + "#" + i;
            long hash = md5Hash(virtualNode);
            ring.put(hash, node);
        }
    }
    
    public String getNode(String key) {
        long hash = md5Hash(key);
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äºhashå€¼çš„èŠ‚ç‚¹
        Map.Entry<Long, String> entry = ring.ceilingEntry(hash);
        return entry != null ? entry.getValue() : ring.firstEntry().getValue();
    }
}
```

---

## 4. ğŸ” å†²çªæ£€æµ‹ä¸è§£å†³ç­–ç•¥


### 4.1 æ•°æ®å†²çªçš„äº§ç”ŸåŸå› 


**âš¡ å¹¶å‘å†™å…¥åœºæ™¯**
```
å…¸å‹å†²çªåœºæ™¯ï¼š
æ—¶é—´    èŠ‚ç‚¹A        èŠ‚ç‚¹B        æ•°æ®å€¼
T1:    è¯»å– X=10     è¯»å– X=10     10
T2:    X = X + 5     X = X * 2     ?
T3:    å†™å…¥ X=15     å†™å…¥ X=20     å†²çªï¼

é—®é¢˜ï¼šä¸¤ä¸ªèŠ‚ç‚¹åŸºäºç›¸åŒçš„åˆå§‹å€¼è¿›è¡Œäº†ä¸åŒçš„æ“ä½œ
```

**ğŸ¯ å†²çªç±»å‹åˆ†æ**
- **å†™-å†™å†²çª**ï¼šå¤šä¸ªèŠ‚ç‚¹åŒæ—¶æ›´æ–°åŒä¸€æ•°æ®
- **è¯»-å†™å†²çª**ï¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®
- **å› æœå†²çª**ï¼šè¿åæ“ä½œçš„å› æœé¡ºåº

### 4.2 åŸºäºæ—¶é—´æˆ³çš„å†²çªè§£å†³


**â° Last Writer Winsï¼ˆLWWï¼‰ç­–ç•¥**
```sql
-- MySQLå®ç°æ—¶é—´æˆ³å†²çªè§£å†³
CREATE TABLE user_profiles (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100),
    updated_at TIMESTAMP(6) DEFAULT CURRENT_TIMESTAMP(6),
    node_id VARCHAR(50),
    INDEX idx_updated_at (updated_at)
);

-- å†²çªè§£å†³å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE resolve_conflict(
    IN p_id INT,
    IN p_name VARCHAR(100),
    IN p_email VARCHAR(100),
    IN p_timestamp TIMESTAMP(6),
    IN p_node_id VARCHAR(50)
)
BEGIN
    DECLARE current_timestamp TIMESTAMP(6);
    
    SELECT updated_at INTO current_timestamp 
    FROM user_profiles WHERE id = p_id;
    
    -- åªæœ‰æ–°æ—¶é—´æˆ³æ‰æ›´æ–°
    IF p_timestamp > current_timestamp THEN
        UPDATE user_profiles 
        SET name = p_name, 
            email = p_email,
            updated_at = p_timestamp,
            node_id = p_node_id
        WHERE id = p_id;
    END IF;
END //
DELIMITER ;
```

### 4.3 å‘é‡æ—¶é’Ÿå†²çªæ£€æµ‹


**ğŸ” ä½¿ç”¨å‘é‡æ—¶é’Ÿæ£€æµ‹å†²çª**
```java
public class VectorClockConflictDetector {
    
    // æ¯”è¾ƒä¸¤ä¸ªå‘é‡æ—¶é’Ÿ
    public ConflictResult compare(Map<String, Integer> clock1, 
                                 Map<String, Integer> clock2) {
        boolean clock1Greater = false;
        boolean clock2Greater = false;
        
        Set<String> allNodes = new HashSet<>();
        allNodes.addAll(clock1.keySet());
        allNodes.addAll(clock2.keySet());
        
        for (String node : allNodes) {
            int val1 = clock1.getOrDefault(node, 0);
            int val2 = clock2.getOrDefault(node, 0);
            
            if (val1 > val2) clock1Greater = true;
            if (val2 > val1) clock2Greater = true;
        }
        
        if (clock1Greater && clock2Greater) {
            return ConflictResult.CONFLICT; // å¹¶å‘å†²çª
        } else if (clock1Greater) {
            return ConflictResult.CLOCK1_NEWER;
        } else if (clock2Greater) {
            return ConflictResult.CLOCK2_NEWER;
        } else {
            return ConflictResult.EQUAL;
        }
    }
}
```

### 4.4 æ™ºèƒ½å†²çªè§£å†³ç­–ç•¥


**ğŸ§  å¤šç­–ç•¥å†²çªè§£å†³æ¡†æ¶**
```java
public class SmartConflictResolver {
    
    public Object resolveConflict(String field, Object value1, Object value2, 
                                 ConflictContext context) {
        // æ ¹æ®å­—æ®µç±»å‹é€‰æ‹©ç­–ç•¥
        switch (context.getFieldType()) {
            case COUNTER:
                return resolveCounterConflict(value1, value2);
            case SET:
                return resolveSetConflict(value1, value2);
            case PROFILE:
                return resolveProfileConflict(field, value1, value2, context);
            default:
                return resolveByTimestamp(value1, value2, context);
        }
    }
    
    // è®¡æ•°å™¨å†²çªï¼šå–æœ€å¤§å€¼æˆ–æ±‚å’Œ
    private Object resolveCounterConflict(Object v1, Object v2) {
        return Math.max((Integer)v1, (Integer)v2);
    }
    
    // é›†åˆå†²çªï¼šå–å¹¶é›†
    private Object resolveSetConflict(Object v1, Object v2) {
        Set<?> set1 = (Set<?>)v1;
        Set<?> set2 = (Set<?>)v2;
        Set<Object> result = new HashSet<>();
        result.addAll(set1);
        result.addAll(set2);
        return result;
    }
    
    // ç”¨æˆ·èµ„æ–™å†²çªï¼šæ™ºèƒ½åˆå¹¶
    private Object resolveProfileConflict(String field, Object v1, Object v2, 
                                        ConflictContext context) {
        if ("email".equals(field)) {
            // é‚®ç®±å˜æ›´ä¼˜å…ˆé€‰æ‹©æ›´æ–°çš„
            return context.isValue1Newer() ? v1 : v2;
        } else if ("login_count".equals(field)) {
            // ç™»å½•æ¬¡æ•°å–æœ€å¤§å€¼
            return Math.max((Integer)v1, (Integer)v2);
        }
        return v1; // é»˜è®¤ä¿ç•™ç¬¬ä¸€ä¸ªå€¼
    }
}
```

**ğŸ“Š å†²çªè§£å†³æ•ˆæœç›‘æ§**
```sql
-- å†²çªç»Ÿè®¡è¡¨
CREATE TABLE conflict_stats (
    id INT AUTO_INCREMENT PRIMARY KEY,
    table_name VARCHAR(100),
    conflict_type ENUM('timestamp', 'vector_clock', 'custom'),
    resolution_strategy VARCHAR(100),
    conflict_count INT,
    resolution_success_rate DECIMAL(5,2),
    avg_resolution_time_ms INT,
    created_date DATE,
    UNIQUE KEY uk_table_date (table_name, created_date)
);

-- å†²çªè§£å†³ç›‘æ§æŸ¥è¯¢
SELECT 
    table_name,
    conflict_type,
    SUM(conflict_count) as total_conflicts,
    AVG(resolution_success_rate) as avg_success_rate,
    AVG(avg_resolution_time_ms) as avg_time_ms
FROM conflict_stats 
WHERE created_date >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY table_name, conflict_type;
```

---

## 5. ğŸ” åˆ†å¸ƒå¼é”ä¸åè°ƒæœºåˆ¶


### 5.1 åˆ†å¸ƒå¼é”çš„å¿…è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”**

> **ğŸ  ç”Ÿæ´»ç±»æ¯”**ï¼šå¤šä¸ªäººè¦ä½¿ç”¨åŒä¸€å°æ‰“å°æœºï¼Œéœ€è¦æ’é˜Ÿæœºåˆ¶ç¡®ä¿ä¸ä¼šåŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™æ‰“å°ç»“æœä¼šæ··ä¹±ã€‚

**âš ï¸ å¸¸è§é—®é¢˜åœºæ™¯**
```
åœºæ™¯1ï¼šåº“å­˜æ‰£å‡
ç”¨æˆ·Aå’Œç”¨æˆ·BåŒæ—¶è´­ä¹°æœ€åä¸€ä»¶å•†å“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·A   â”‚    â”‚  ç”¨æˆ·B   â”‚
â”‚ è¯»åº“å­˜:1 â”‚    â”‚ è¯»åº“å­˜:1 â”‚
â”‚ åº“å­˜-1  â”‚    â”‚ åº“å­˜-1  â”‚
â”‚ ä½™åº“å­˜:0 â”‚    â”‚ ä½™åº“å­˜:0 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç»“æœï¼šå–å‡ºäº†2ä»¶å•†å“ï¼Œä½†åº“å­˜åªæœ‰1ä»¶ï¼

åœºæ™¯2ï¼šIDç”Ÿæˆå™¨
å¤šä¸ªæœåŠ¡åŒæ—¶ç”Ÿæˆç”¨æˆ·ID
Node1: è¯»å–å½“å‰ID=100, ç”ŸæˆID=101
Node2: è¯»å–å½“å‰ID=100, ç”ŸæˆID=101
ç»“æœï¼šç”Ÿæˆäº†é‡å¤çš„IDï¼
```

### 5.2 åŸºäºMySQLçš„åˆ†å¸ƒå¼é”å®ç°


**ğŸ”’ è¡¨çº§é”å®ç°**
```sql
-- åˆ›å»ºåˆ†å¸ƒå¼é”è¡¨
CREATE TABLE distributed_locks (
    lock_name VARCHAR(100) PRIMARY KEY,
    holder VARCHAR(100) NOT NULL,
    acquired_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    INDEX idx_expires (expires_at)
);

-- è·å–é”çš„å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE acquire_lock(
    IN p_lock_name VARCHAR(100),
    IN p_holder VARCHAR(100),
    IN p_timeout_seconds INT,
    OUT p_success BOOLEAN
)
BEGIN
    DECLARE v_count INT DEFAULT 0;
    DECLARE v_expires_at TIMESTAMP;
    
    SET p_success = FALSE;
    SET v_expires_at = DATE_ADD(NOW(), INTERVAL p_timeout_seconds SECOND);
    
    -- æ¸…ç†è¿‡æœŸé”
    DELETE FROM distributed_locks 
    WHERE lock_name = p_lock_name AND expires_at < NOW();
    
    -- å°è¯•è·å–é”
    SELECT COUNT(*) INTO v_count 
    FROM distributed_locks 
    WHERE lock_name = p_lock_name;
    
    IF v_count = 0 THEN
        INSERT INTO distributed_locks (lock_name, holder, expires_at)
        VALUES (p_lock_name, p_holder, v_expires_at);
        SET p_success = TRUE;
    END IF;
END //
DELIMITER ;
```

**ğŸ’» Javaå®¢æˆ·ç«¯å®ç°**
```java
public class MySQLDistributedLock {
    private final DataSource dataSource;
    private final String lockName;
    private final String holder;
    
    public boolean tryLock(int timeoutSeconds) {
        try (Connection conn = dataSource.getConnection();
             CallableStatement stmt = conn.prepareCall(
                 "{CALL acquire_lock(?, ?, ?, ?)}")) {
            
            stmt.setString(1, lockName);
            stmt.setString(2, holder);
            stmt.setInt(3, timeoutSeconds);
            stmt.registerOutParameter(4, Types.BOOLEAN);
            
            stmt.execute();
            return stmt.getBoolean(4);
        } catch (SQLException e) {
            log.error("Failed to acquire lock", e);
            return false;
        }
    }
    
    public void unlock() {
        try (Connection conn = dataSource.getConnection();
             PreparedStatement stmt = conn.prepareStatement(
                 "DELETE FROM distributed_locks WHERE lock_name = ? AND holder = ?")) {
            
            stmt.setString(1, lockName);
            stmt.setString(2, holder);
            stmt.executeUpdate();
        } catch (SQLException e) {
            log.error("Failed to release lock", e);
        }
    }
}
```

### 5.3 ä¹è§‚é”ä¸ç‰ˆæœ¬æ§åˆ¶


**âš¡ ä¹è§‚é”ï¼šåŸºäºç‰ˆæœ¬å·çš„å¹¶å‘æ§åˆ¶**
```sql
-- å¸¦ç‰ˆæœ¬å·çš„ç”¨æˆ·è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY,
    username VARCHAR(100),
    email VARCHAR(100),
    balance DECIMAL(10,2),
    version INT NOT NULL DEFAULT 1,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ä¹è§‚é”æ›´æ–°ç¤ºä¾‹
UPDATE users 
SET balance = balance - 100, 
    version = version + 1,
    updated_at = NOW()
WHERE id = 123 
  AND version = 5;  -- åªæœ‰ç‰ˆæœ¬å·åŒ¹é…æ‰æ›´æ–°

-- Javaå®ç°
public boolean updateUserBalance(int userId, BigDecimal amount, int expectedVersion) {
    String sql = """
        UPDATE users 
        SET balance = balance + ?, 
            version = version + 1
        WHERE id = ? AND version = ?
        """;
    
    int rowsAffected = jdbcTemplate.update(sql, amount, userId, expectedVersion);
    return rowsAffected == 1; // è¿”å›æ˜¯å¦æ›´æ–°æˆåŠŸ
}
```

### 5.4 åŸºäºRedisçš„é«˜æ€§èƒ½åˆ†å¸ƒå¼é”


**ğŸš€ Redisåˆ†å¸ƒå¼é”ä¼˜åŠ¿**
- **æ€§èƒ½é«˜**ï¼šå†…å­˜æ“ä½œï¼Œå»¶è¿Ÿæä½
- **åŸå­æ€§**ï¼šSET NX EXå‘½ä»¤ä¿è¯åŸå­æ€§
- **è‡ªåŠ¨è¿‡æœŸ**ï¼šé¿å…æ­»é”

**ğŸ’» Redisåˆ†å¸ƒå¼é”å®ç°**
```java
public class RedisDistributedLock {
    private final StringRedisTemplate redisTemplate;
    private final String lockKey;
    private final String lockValue;
    
    public boolean tryLock(int expireSeconds) {
        Boolean success = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, lockValue, Duration.ofSeconds(expireSeconds));
        return Boolean.TRUE.equals(success);
    }
    
    public void unlock() {
        // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = """
            if redis.call('get', KEYS[1]) == ARGV[1] then
                return redis.call('del', KEYS[1])
            else
                return 0
            end
            """;
        
        redisTemplate.execute(new DefaultRedisScript<>(luaScript, Long.class),
                            Collections.singletonList(lockKey), lockValue);
    }
}
```

---

## 6. ğŸ“Š ä¸€è‡´æ€§ç›‘æ§ä¸è¿ç»´


### 6.1 ä¸€è‡´æ€§ç›‘æ§æŒ‡æ ‡ä½“ç³»


**ğŸ” æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**

| **æŒ‡æ ‡ç±»åˆ«** | **å…·ä½“æŒ‡æ ‡** | **æ­£å¸¸èŒƒå›´** | **å‘Šè­¦é˜ˆå€¼** |
|-------------|------------|-------------|-------------|
| **å¤åˆ¶å»¶è¿Ÿ** | ä¸»ä»å»¶è¿Ÿæ—¶é—´ | < 1ç§’ | > 3ç§’ |
| **æ•°æ®ä¸€è‡´æ€§** | ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ç‡ | < 0.01% | > 0.1% |
| **å†²çªè§£å†³** | å†²çªè§£å†³æˆåŠŸç‡ | > 99.9% | < 99% |
| **åŒæ­¥æ€§èƒ½** | åŒæ­¥ååé‡ | > 1000 TPS | < 500 TPS |

**ğŸ“Š ç›‘æ§æ•°æ®é‡‡é›†**
```sql
-- ä¸»ä»å»¶è¿Ÿç›‘æ§
CREATE VIEW replication_lag AS
SELECT 
    slave_host,
    slave_port,
    master_log_file,
    master_log_pos,
    slave_lag_seconds,
    CASE 
        WHEN slave_lag_seconds < 1 THEN 'HEALTHY'
        WHEN slave_lag_seconds < 3 THEN 'WARNING' 
        ELSE 'CRITICAL'
    END as status
FROM information_schema.slave_hosts sh
JOIN performance_schema.replication_connection_status rcs 
    ON sh.host = rcs.source_host;

-- ä¸€è‡´æ€§æ£€æŸ¥ç»Ÿè®¡
CREATE TABLE consistency_checks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    table_name VARCHAR(100),
    total_records BIGINT,
    inconsistent_records BIGINT,
    consistency_rate DECIMAL(8,6),
    check_duration_ms INT
);
```

### 6.2 è‡ªåŠ¨åŒ–ä¸€è‡´æ€§æ£€æŸ¥


**ğŸ¤– æ•°æ®ä¸€è‡´æ€§æ ¡éªŒå·¥å…·**
```java
@Component
public class ConsistencyChecker {
    
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkConsistency() {
        List<String> tables = getMonitorTables();
        
        for (String table : tables) {
            ConsistencyResult result = checkTableConsistency(table);
            recordCheckResult(result);
            
            if (result.getConsistencyRate() < 0.999) {
                alertService.sendAlert("æ•°æ®ä¸€è‡´æ€§å‘Šè­¦", 
                    String.format("è¡¨%sä¸€è‡´æ€§ç‡%.4fä½äºé˜ˆå€¼", 
                        table, result.getConsistencyRate()));
            }
        }
    }
    
    private ConsistencyResult checkTableConsistency(String tableName) {
        // ä»ä¸»åº“è·å–æ•°æ®æ‘˜è¦
        String masterChecksum = calculateChecksum("master", tableName);
        
        // ä»å„ä¸ªä»åº“è·å–æ•°æ®æ‘˜è¦
        List<String> slaveChecksums = new ArrayList<>();
        for (DataSource slave : slaveDataSources) {
            String checksum = calculateChecksum(slave, tableName);
            slaveChecksums.add(checksum);
        }
        
        // æ¯”è¾ƒä¸€è‡´æ€§
        long consistentSlaves = slaveChecksums.stream()
            .mapToLong(checksum -> checksum.equals(masterChecksum) ? 1 : 0)
            .sum();
        
        double consistencyRate = (double) consistentSlaves / slaveChecksums.size();
        
        return ConsistencyResult.builder()
            .tableName(tableName)
            .consistencyRate(consistencyRate)
            .masterChecksum(masterChecksum)
            .slaveChecksums(slaveChecksums)
            .build();
    }
}
```

### 6.3 è¡¥å¿æœºåˆ¶è®¾è®¡


**ğŸ”§ æ•°æ®ä¸ä¸€è‡´ä¿®å¤ç­–ç•¥**

```java
public class DataRepairService {
    
    // æ‰¹é‡ä¿®å¤ä¸ä¸€è‡´æ•°æ®
    public void repairInconsistentData(String tableName, 
                                     List<String> inconsistentIds) {
        for (String id : inconsistentIds) {
            try {
                repairSingleRecord(tableName, id);
            } catch (Exception e) {
                log.error("ä¿®å¤è®°å½•å¤±è´¥: table={}, id={}", tableName, id, e);
                // è®°å½•å¤±è´¥çš„ä¿®å¤å°è¯•
                recordRepairFailure(tableName, id, e.getMessage());
            }
        }
    }
    
    private void repairSingleRecord(String tableName, String id) {
        // 1. ä»ä¸»åº“è·å–æ­£ç¡®æ•°æ®
        Map<String, Object> masterData = masterDao.findById(tableName, id);
        
        if (masterData == null) {
            // ä¸»åº“ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œåˆ é™¤ä»åº“ä¸­çš„è®°å½•
            for (DataSource slave : slaveDataSources) {
                slaveDao.deleteById(tableName, id, slave);
            }
            return;
        }
        
        // 2. ä¿®å¤å„ä¸ªä»åº“
        for (DataSource slave : slaveDataSources) {
            Map<String, Object> slaveData = slaveDao.findById(tableName, id, slave);
            
            if (!Objects.equals(masterData, slaveData)) {
                // æ•°æ®ä¸ä¸€è‡´ï¼Œè¿›è¡Œä¿®å¤
                slaveDao.upsert(tableName, masterData, slave);
                log.info("ä¿®å¤å®Œæˆ: table={}, id={}", tableName, id);
            }
        }
    }
}
```

**ğŸ“Š è¡¥å¿æœºåˆ¶ç›‘æ§**
```sql
-- ä¿®å¤æ“ä½œè®°å½•è¡¨
CREATE TABLE repair_operations (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    operation_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    table_name VARCHAR(100),
    record_id VARCHAR(100),
    operation_type ENUM('INSERT', 'UPDATE', 'DELETE'),
    success BOOLEAN,
    error_message TEXT,
    repair_duration_ms INT
);

-- ä¿®å¤æ•ˆæœç»Ÿè®¡
SELECT 
    table_name,
    DATE(operation_time) as repair_date,
    COUNT(*) as total_repairs,
    SUM(CASE WHEN success = 1 THEN 1 ELSE 0 END) as successful_repairs,
    AVG(repair_duration_ms) as avg_duration
FROM repair_operations 
WHERE operation_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY table_name, DATE(operation_time)
ORDER BY repair_date DESC, table_name;
```

---

## 7. ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¸å®è·µç­–ç•¥


### 7.1 ä¸€è‡´æ€§çº§åˆ«åŠ¨æ€è°ƒæ•´


**âš–ï¸ æ™ºèƒ½ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©**

```java
public class DynamicConsistencyManager {
    
    // æ ¹æ®ä¸šåŠ¡åœºæ™¯åŠ¨æ€é€‰æ‹©ä¸€è‡´æ€§çº§åˆ«
    public ConsistencyLevel determineConsistencyLevel(BusinessContext context) {
        // å…³é”®ä¸šåŠ¡æ“ä½œï¼šå¼ºä¸€è‡´æ€§
        if (context.isCriticalOperation()) {
            return ConsistencyLevel.STRONG;
        }
        
        // å®æ—¶æ€§è¦æ±‚é«˜ï¼šä¼šè¯ä¸€è‡´æ€§
        if (context.requiresRealtime()) {
            return ConsistencyLevel.SESSION;
        }
        
        // ä¸€èˆ¬æŸ¥è¯¢ï¼šæœ€ç»ˆä¸€è‡´æ€§
        return ConsistencyLevel.EVENTUAL;
    }
    
    // æ‰§è¡Œè¯»æ“ä½œæ—¶çš„è·¯ç”±ç­–ç•¥
    public DataSource selectDataSource(String operation, ConsistencyLevel level) {
        switch (level) {
            case STRONG:
                return masterDataSource; // å¼ºåˆ¶ä¸»åº“è¯»
            case SESSION:
                return hasRecentWrite() ? masterDataSource : slaveDataSource;
            case EVENTUAL:
                return loadBalancer.selectSlave(); // è´Ÿè½½å‡è¡¡é€‰æ‹©ä»åº“
            default:
                return slaveDataSource;
        }
    }
}
```

**ğŸ“Š ä¸€è‡´æ€§çº§åˆ«é…ç½®è¡¨**
```sql
-- ä¸šåŠ¡ä¸€è‡´æ€§é…ç½®
CREATE TABLE consistency_policies (
    id INT AUTO_INCREMENT PRIMARY KEY,
    service_name VARCHAR(100),
    operation_type VARCHAR(50),
    consistency_level ENUM('STRONG', 'SESSION', 'EVENTUAL'),
    read_preference ENUM('MASTER', 'SLAVE', 'BALANCED'),
    max_lag_tolerance_ms INT,
    priority INT DEFAULT 100,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç¤ºä¾‹é…ç½®
INSERT INTO consistency_policies VALUES
(1, 'payment-service', 'transfer', 'STRONG', 'MASTER', 0, 100, NOW()),
(2, 'user-service', 'profile_update', 'SESSION', 'BALANCED', 1000, 80, NOW()),
(3, 'content-service', 'article_view', 'EVENTUAL', 'SLAVE', 5000, 60, NOW());
```

### 7.2 æ•°æ®åŒæ­¥æ€§èƒ½ä¼˜åŒ–


**âš¡ æ‰¹é‡åŒæ­¥ä¼˜åŒ–**
```java
public class OptimizedSyncService {
    
    // æ‰¹é‡æ•°æ®åŒæ­¥
    @Transactional
    public void batchSync(List<SyncOperation> operations) {
        // æŒ‰è¡¨ååˆ†ç»„ï¼Œå‡å°‘é”ç«äº‰
        Map<String, List<SyncOperation>> grouped = operations.stream()
            .collect(Collectors.groupingBy(SyncOperation::getTableName));
        
        for (Map.Entry<String, List<SyncOperation>> entry : grouped.entrySet()) {
            String tableName = entry.getKey();
            List<SyncOperation> tableOps = entry.getValue();
            
            // ä½¿ç”¨æ‰¹é‡æ“ä½œæå‡æ€§èƒ½
            executeBatchOperations(tableName, tableOps);
        }
    }
    
    private void executeBatchOperations(String tableName, List<SyncOperation> operations) {
        String sql = buildBatchUpsertSql(tableName, operations.size());
        
        try (PreparedStatement stmt = connection.prepareStatement(sql)) {
            int paramIndex = 1;
            for (SyncOperation op : operations) {
                for (Object param : op.getParameters()) {
                    stmt.setObject(paramIndex++, param);
                }
            }
            
            stmt.executeBatch();
        }
    }
}
```

**ğŸ”„ å¼‚æ­¥åŒæ­¥é˜Ÿåˆ—**
```java
@Component
public class AsyncSyncQueue {
    private final BlockingQueue<SyncTask> syncQueue = new LinkedBlockingQueue<>(10000);
    private final ExecutorService syncExecutor = Executors.newFixedThreadPool(5);
    
    @PostConstruct
    public void startSyncWorkers() {
        for (int i = 0; i < 5; i++) {
            syncExecutor.submit(this::processSyncTasks);
        }
    }
    
    public void addSyncTask(SyncTask task) {
        if (!syncQueue.offer(task)) {
            // é˜Ÿåˆ—æ»¡äº†ï¼Œè®°å½•å‘Šè­¦
            alertService.sendAlert("åŒæ­¥é˜Ÿåˆ—å·²æ»¡", "å½“å‰é˜Ÿåˆ—å¤§å°: " + syncQueue.size());
        }
    }
    
    private void processSyncTasks() {
        while (!Thread.currentThread().isInterrupted()) {
            try {
                SyncTask task = syncQueue.take();
                processSingleTask(task);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            } catch (Exception e) {
                log.error("åŒæ­¥ä»»åŠ¡å¤„ç†å¤±è´¥", e);
            }
        }
    }
}
```

### 7.3 ç½‘ç»œä¼˜åŒ–ä¸å‹ç¼©


**ğŸ“¦ æ•°æ®ä¼ è¾“ä¼˜åŒ–**
```java
public class OptimizedDataTransmission {
    private final Compressor compressor = new GzipCompressor();
    
    // å‹ç¼©æ•°æ®ä¼ è¾“
    public void syncWithCompression(List<DataRecord> records) {
        // åºåˆ—åŒ–æ•°æ®
        byte[] serializedData = serializeRecords(records);
        
        // å‹ç¼©æ•°æ®ï¼ˆé€šå¸¸å¯ä»¥å‹ç¼©60-80%ï¼‰
        byte[] compressedData = compressor.compress(serializedData);
        
        log.info("å‹ç¼©æ•ˆæœ: åŸå§‹{}KB -> å‹ç¼©{}KB, å‹ç¼©ç‡{}%",
            serializedData.length / 1024,
            compressedData.length / 1024,
            (1 - (double)compressedData.length / serializedData.length) * 100);
        
        // å‘é€å‹ç¼©æ•°æ®
        transmitData(compressedData);
    }
    
    // å¢é‡åŒæ­¥ä¼˜åŒ–
    public void incrementalSync(String tableName, long lastSyncTimestamp) {
        String sql = """
            SELECT * FROM %s 
            WHERE updated_at > ? 
            ORDER BY updated_at 
            LIMIT 1000
            """.formatted(tableName);
        
        List<DataRecord> changes = jdbcTemplate.query(sql, 
            new DataRecordMapper(), new Timestamp(lastSyncTimestamp));
        
        if (!changes.isEmpty()) {
            syncWithCompression(changes);
            // æ›´æ–°åŒæ­¥æ—¶é—´æˆ³
            updateLastSyncTimestamp(tableName, 
                changes.get(changes.size() - 1).getUpdatedAt());
        }
    }
}
```

**ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜**
```sql
-- åŒæ­¥æ€§èƒ½ç»Ÿè®¡è¡¨
CREATE TABLE sync_performance_stats (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    table_name VARCHAR(100),
    record_count INT,
    sync_duration_ms BIGINT,
    bytes_transferred BIGINT,
    compression_ratio DECIMAL(5,4),
    throughput_records_per_sec DECIMAL(10,2),
    throughput_mb_per_sec DECIMAL(8,3)
);

-- æ€§èƒ½åˆ†ææŸ¥è¯¢
SELECT 
    table_name,
    AVG(throughput_records_per_sec) as avg_records_per_sec,
    AVG(throughput_mb_per_sec) as avg_mb_per_sec,
    AVG(compression_ratio) as avg_compression_ratio,
    COUNT(*) as sync_operations
FROM sync_performance_stats 
WHERE sync_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
GROUP BY table_name
ORDER BY avg_records_per_sec DESC;
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ¯ **åˆ†å¸ƒå¼ä¸€è‡´æ€§æœ¬è´¨**
åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤šä¸ªæ•°æ®å‰¯æœ¬ä¿æŒåŒæ­¥ï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°ä¸€è‡´çš„æ•°æ®è§†å›¾

ğŸ”¸ **CAPå®šç†æƒè¡¡**
- C(ä¸€è‡´æ€§) + P(åˆ†åŒºå®¹é”™) = å¼ºä¸€è‡´ä½†å¯ç”¨æ€§é™ä½
- A(å¯ç”¨æ€§) + P(åˆ†åŒºå®¹é”™) = é«˜å¯ç”¨ä½†æ•°æ®å¯èƒ½ä¸ä¸€è‡´
- å®é™…åº”ç”¨ä¸­éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯æƒè¡¡é€‰æ‹©

ğŸ”¸ **BASEç†è®ºæŒ‡å¯¼**
- Basically Available: åŸºæœ¬åŠŸèƒ½å¯ç”¨ï¼Œå…è®¸æ€§èƒ½é™çº§
- Soft State: æ¥å—çŸ­æœŸæ•°æ®ä¸ä¸€è‡´çŠ¶æ€  
- Eventually Consistent: æœ€ç»ˆæ‰€æœ‰å‰¯æœ¬è¾¾åˆ°ä¸€è‡´

ğŸ”¸ **ä¸€è‡´æ€§æ¨¡å‹å±‚æ¬¡**
å¼ºä¸€è‡´æ€§ > å› æœä¸€è‡´æ€§ > ä¼šè¯ä¸€è‡´æ€§ > æœ€ç»ˆä¸€è‡´æ€§
```

### 8.2 å…³é”®å®ç°æœºåˆ¶


**ğŸ”„ æ•°æ®åŒæ­¥ç­–ç•¥**
```
âœ… MySQLä¸»ä»å¤åˆ¶
- å¼‚æ­¥å¤åˆ¶ï¼šæ€§èƒ½æœ€å¥½ï¼Œå¯èƒ½ä¸¢æ•°æ®
- åŠåŒæ­¥å¤åˆ¶ï¼šå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§ï¼ˆç”Ÿäº§æ¨èï¼‰
- åŒæ­¥å¤åˆ¶ï¼šæœ€å®‰å…¨ä½†æ€§èƒ½å·®

âœ… å†²çªæ£€æµ‹ä¸è§£å†³
- æ—¶é—´æˆ³ç­–ç•¥ï¼šLast Writer Wins (LWW)
- å‘é‡æ—¶é’Ÿï¼šç²¾ç¡®çš„å› æœå…³ç³»è¿½è¸ª
- æ™ºèƒ½è§£å†³ï¼šæ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©æœ€ä¼˜ç­–ç•¥

âœ… åˆ†å¸ƒå¼é”æœºåˆ¶
- æ‚²è§‚é”ï¼šäº‹å‰åŠ é”ï¼Œé€‚åˆå†™å¤šåœºæ™¯
- ä¹è§‚é”ï¼šç‰ˆæœ¬æ§åˆ¶ï¼Œé€‚åˆè¯»å¤šå†™å°‘åœºæ™¯
- Redisé”ï¼šé«˜æ€§èƒ½ï¼Œé€‚åˆä¸´ç•ŒåŒºä¿æŠ¤
```

**ğŸ› ï¸ è¿ç»´ç›‘æ§ä½“ç³»**
```
ğŸ“Š æ ¸å¿ƒç›‘æ§æŒ‡æ ‡
- å¤åˆ¶å»¶è¿Ÿï¼š< 1ç§’æ­£å¸¸ï¼Œ> 3ç§’å‘Šè­¦
- ä¸€è‡´æ€§ç‡ï¼š> 99.9%æ­£å¸¸ï¼Œ< 99%å‘Šè­¦  
- å†²çªè§£å†³æˆåŠŸç‡ï¼š> 99.9%

ğŸ¤– è‡ªåŠ¨åŒ–æœºåˆ¶
- å®šæœŸä¸€è‡´æ€§æ£€æŸ¥
- å¼‚å¸¸è‡ªåŠ¨å‘Šè­¦
- æ•°æ®è‡ªåŠ¨ä¿®å¤
- æ€§èƒ½åŠ¨æ€è°ƒä¼˜
```

### 8.3 å®æˆ˜åº”ç”¨æŒ‡å¯¼


**ğŸ¯ åœºæ™¯é€‰æ‹©ç­–ç•¥**

| **ä¸šåŠ¡åœºæ™¯** | **æ¨èä¸€è‡´æ€§çº§åˆ«** | **å®ç°æ–¹æ¡ˆ** | **ç›‘æ§é‡ç‚¹** |
|-------------|------------------|-------------|-------------|
| **é‡‘èè½¬è´¦** | å¼ºä¸€è‡´æ€§ | åŒæ­¥å¤åˆ¶+åˆ†å¸ƒå¼äº‹åŠ¡ | æ•°æ®å‡†ç¡®æ€§100% |
| **ç”¨æˆ·èµ„æ–™** | ä¼šè¯ä¸€è‡´æ€§ | è¯»å†™åˆ†ç¦»+session sticky | ç”¨æˆ·ä½“éªŒä¸€è‡´æ€§ |
| **å†…å®¹æµè§ˆ** | æœ€ç»ˆä¸€è‡´æ€§ | å¼‚æ­¥å¤åˆ¶+ç¼“å­˜ | åŒæ­¥å»¶è¿Ÿå’Œæ€§èƒ½ |
| **åº“å­˜æ‰£å‡** | å¼ºä¸€è‡´æ€§ | åˆ†å¸ƒå¼é”+ä¹è§‚é” | å¹¶å‘å†²çªç‡ |

**âš¡ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
ğŸš€ åŒæ­¥ä¼˜åŒ–
- æ‰¹é‡æ“ä½œï¼šå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°
- æ•°æ®å‹ç¼©ï¼šèŠ‚çœ60-80%ä¼ è¾“å¸¦å®½
- å¢é‡åŒæ­¥ï¼šåªä¼ è¾“å˜æ›´æ•°æ®
- å¼‚æ­¥å¤„ç†ï¼šæå‡ç”¨æˆ·å“åº”é€Ÿåº¦

ğŸ›ï¸ åŠ¨æ€è°ƒæ•´
- ä¸€è‡´æ€§çº§åˆ«åŠ¨æ€é€‰æ‹©
- è¯»å†™è·¯ç”±æ™ºèƒ½åˆ‡æ¢
- ç›‘æ§é˜ˆå€¼è‡ªé€‚åº”è°ƒæ•´
- è´Ÿè½½å‡è¡¡ç­–ç•¥ä¼˜åŒ–
```

### 8.4 æœ€ä½³å®è·µæ€»ç»“


**ğŸ’¡ è®¾è®¡åŸåˆ™**
- **ä¸šåŠ¡ä¼˜å…ˆ**ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§é€‰æ‹©ä¸€è‡´æ€§ç­–ç•¥
- **æ€§èƒ½å¹³è¡¡**ï¼šåœ¨ä¸€è‡´æ€§å’Œæ€§èƒ½é—´æ‰¾åˆ°æœ€ä¼˜å¹³è¡¡ç‚¹
- **æ¸è¿›å®ç°**ï¼šä»ç®€å•åˆ°å¤æ‚ï¼Œé€æ­¥å®Œå–„ä¸€è‡´æ€§ä¿éšœ
- **ç›‘æ§å…ˆè¡Œ**ï¼šå…ˆå»ºç«‹ç›‘æ§ï¼Œå†ä¼˜åŒ–æ€§èƒ½

**âš ï¸ å¸¸è§é™·é˜±**
```
âŒ è¿‡åº¦è¿½æ±‚å¼ºä¸€è‡´æ€§
æ­£è§£ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„ä¸€è‡´æ€§çº§åˆ«

âŒ å¿½ç•¥ç½‘ç»œåˆ†åŒºæƒ…å†µ
æ­£è§£ï¼šå……åˆ†è€ƒè™‘ç½‘ç»œåˆ†åŒºåœºæ™¯çš„å¤„ç†ç­–ç•¥

âŒ ç›‘æ§ä¸å¤Ÿå®Œå–„
æ­£è§£ï¼šå»ºç«‹å…¨æ–¹ä½çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

âŒ ç¼ºä¹æ•°æ®ä¿®å¤æœºåˆ¶
æ­£è§£ï¼šè®¾è®¡è‡ªåŠ¨åŒ–çš„æ•°æ®ä¸€è‡´æ€§ä¿®å¤èƒ½åŠ›
```

**ğŸ¯ æ ¸å¿ƒè®°å¿†å£è¯€**
```
åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¸‰è¦ç´ ï¼šCAPç†è®ºåšæƒè¡¡
æœ€ç»ˆä¸€è‡´å¤Ÿç”¨ï¼Œå¼ºä¸€è‡´è¦æ…é‡
ç›‘æ§å‘Šè­¦è¦åˆ°ä½ï¼Œæ•°æ®ä¿®å¤éœ€è‡ªåŠ¨
æ€§èƒ½ä¸€è‡´éœ€å¹³è¡¡ï¼Œä¸šåŠ¡åœºæ™¯æ˜¯å…³é”®
```

### 8.5 å­¦ä¹ æ£€æŸ¥ç‚¹


**ğŸ“ è‡ªæˆ‘æ£€æµ‹**
- [ ] èƒ½å¤Ÿè§£é‡ŠCAPå®šç†çš„å«ä¹‰å’Œå®é™…åº”ç”¨
- [ ] ç†è§£ä¸åŒä¸€è‡´æ€§æ¨¡å‹çš„é€‚ç”¨åœºæ™¯
- [ ] æŒæ¡MySQLä¸»ä»å¤åˆ¶çš„é…ç½®å’Œç›‘æ§
- [ ] ä¼šè®¾è®¡å’Œå®ç°åˆ†å¸ƒå¼é”æœºåˆ¶
- [ ] èƒ½å¤Ÿæ­å»ºä¸€è‡´æ€§ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

**ğŸš€ å®è·µæŒ‘æˆ˜**
å°è¯•è®¾è®¡ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆï¼Œè€ƒè™‘ç”¨æˆ·ã€è®¢å•ã€åº“å­˜ã€æ”¯ä»˜ç­‰æ ¸å¿ƒä¸šåŠ¡çš„ä¸€è‡´æ€§éœ€æ±‚ã€‚

**ğŸ“š æ‰©å±•å­¦ä¹ **
- ğŸ“– æ·±å…¥å­¦ä¹ ï¼šRaftã€Paxosç­‰åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•
- ğŸ¥ å®æˆ˜é¡¹ç›®ï¼šæ­å»ºMySQLé›†ç¾¤å¹¶å®ç°ä¸€è‡´æ€§ç›‘æ§
- ğŸ’» å·¥å…·å®è·µï¼šä½¿ç”¨Consulã€etcdç­‰åˆ†å¸ƒå¼åè°ƒå·¥å…·