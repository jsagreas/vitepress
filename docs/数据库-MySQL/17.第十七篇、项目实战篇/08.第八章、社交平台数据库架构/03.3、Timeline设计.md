---
title: 3ã€Timelineè®¾è®¡
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯Timelineæ—¶é—´çº¿](#1-ä»€ä¹ˆæ˜¯Timelineæ—¶é—´çº¿)
2. [Pushæ¨¡å¼ä¸Pullæ¨¡å¼è¯¦è§£](#2-Pushæ¨¡å¼ä¸Pullæ¨¡å¼è¯¦è§£)
3. [æ··åˆæ—¶é—´çº¿ç­–ç•¥](#3-æ··åˆæ—¶é—´çº¿ç­–ç•¥)
4. [æ—¶é—´çº¿ç”Ÿæˆç®—æ³•](#4-æ—¶é—´çº¿ç”Ÿæˆç®—æ³•)
5. [æ—¶é—´çº¿ç¼“å­˜è®¾è®¡](#5-æ—¶é—´çº¿ç¼“å­˜è®¾è®¡)
6. [å†…å®¹æ’åºä¸åˆ†é¡µç­–ç•¥](#6-å†…å®¹æ’åºä¸åˆ†é¡µç­–ç•¥)
7. [å®æ—¶æ›´æ–°æœºåˆ¶](#7-å®æ—¶æ›´æ–°æœºåˆ¶)
8. [ä¸ªæ€§åŒ–Timelineå®ç°](#8-ä¸ªæ€§åŒ–Timelineå®ç°)
9. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#9-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ä»€ä¹ˆæ˜¯Timelineæ—¶é—´çº¿


### 1.1 Timelineæ ¸å¿ƒæ¦‚å¿µ


**ğŸ“– é€šä¿—è§£é‡Š**
Timelineå°±åƒä½ çš„æœ‹å‹åœˆæˆ–å¾®åšé¦–é¡µï¼ŒæŠŠä½ å…³æ³¨çš„äººå‘å¸ƒçš„å†…å®¹æŒ‰æ—¶é—´é¡ºåºæ’åˆ—å±•ç¤ºã€‚ç®€å•è¯´å°±æ˜¯ä¸€ä¸ª"å†…å®¹å±•ç¤ºåˆ—è¡¨"ã€‚

**ğŸ” æ ¸å¿ƒä½œç”¨**
```
ç”¨æˆ·æ‰“å¼€åº”ç”¨ â†’ çœ‹åˆ°Timeline â†’ æµè§ˆæ„Ÿå…´è¶£çš„å†…å®¹
```

> ğŸ’¡ **ç±»æ¯”ç†è§£**
> 
> æƒ³è±¡Timelineå°±åƒä¸€ä»½æŠ¥çº¸ï¼š
> - **ç¼–è¾‘éƒ¨å†³å®š**ï¼šå“ªäº›æ–°é—»æ”¾åœ¨å¤´ç‰ˆï¼ˆç®—æ³•æ’åºï¼‰
> - **æŒ‰é‡è¦æ€§æ’åˆ—**ï¼šå¤´æ¡ã€æ¬¡è¦æ–°é—»ã€å¹¿å‘Š
> - **åŠæ—¶æ›´æ–°**ï¼šæ¯å¤©éƒ½æœ‰æ–°å†…å®¹

### 1.2 Timelineçš„æ ¸å¿ƒæŒ‘æˆ˜


**ğŸ¯ ä¸»è¦é—®é¢˜**
- **æ•°æ®é‡å¤§**ï¼šç”¨æˆ·å¯èƒ½å…³æ³¨ä¸Šåƒäººï¼Œå†…å®¹æµ·é‡
- **å®æ—¶æ€§è¦æ±‚**ï¼šæ–°å†…å®¹è¦å¿«é€Ÿå±•ç¤º
- **ä¸ªæ€§åŒ–éœ€æ±‚**ï¼šæ¯ä¸ªç”¨æˆ·çœ‹åˆ°çš„å†…å®¹åº”è¯¥ä¸åŒ
- **æ€§èƒ½å‹åŠ›**ï¼šç™¾ä¸‡ç”¨æˆ·åŒæ—¶åˆ·æ–°Timeline

**ğŸ“Š æ•°æ®è§„æ¨¡ç¤ºä¾‹**
```
å‡è®¾ä¸€ä¸ªç”¨æˆ·å…³æ³¨1000äººï¼š
- æ¯äººæ¯å¤©å‘5æ¡å†…å®¹ = 5000æ¡æ–°å†…å®¹
- éœ€è¦ä»5000æ¡ä¸­ç­›é€‰å‡ºæœ€é‡è¦çš„50æ¡å±•ç¤º
- è¿˜è¦è€ƒè™‘æ—¶é—´é¡ºåºã€ç”¨æˆ·å–œå¥½ç­‰å› ç´ 
```

---

## 2. âš–ï¸ Pushæ¨¡å¼ä¸Pullæ¨¡å¼è¯¦è§£


### 2.1 Pushæ¨¡å¼ï¼ˆæ¨é€æ¨¡å¼ï¼‰


**ğŸ”¸ åŸºæœ¬åŸç†**
å½“ç”¨æˆ·Aå‘å¸ƒå†…å®¹æ—¶ï¼Œç«‹å³æ¨é€åˆ°æ‰€æœ‰ç²‰ä¸çš„Timelineä¸­ã€‚

```
ç”¨æˆ·Aå‘å¸ƒå†…å®¹
        â†“
    ç³»ç»Ÿæ£€æµ‹åˆ°æ–°å†…å®¹
        â†“
æ¨é€åˆ°Açš„æ‰€æœ‰ç²‰ä¸Timeline
        â†“
    ç²‰ä¸ç›´æ¥çœ‹åˆ°å†…å®¹
```

**ğŸ’¾ æ•°æ®åº“è®¾è®¡**
```sql
-- ç”¨æˆ·Timelineè¡¨
CREATE TABLE user_timeline (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,        -- è°çš„Timeline
    content_id BIGINT NOT NULL,     -- å†…å®¹ID
    author_id BIGINT NOT NULL,      -- å†…å®¹ä½œè€…
    create_time TIMESTAMP,          -- åˆ›å»ºæ—¶é—´
    INDEX idx_user_time (user_id, create_time)
);

-- å½“ç”¨æˆ·Aå‘å¸ƒå†…å®¹æ—¶çš„æ“ä½œ
INSERT INTO user_timeline (user_id, content_id, author_id, create_time)
SELECT follower_id, 12345, 100, NOW()
FROM user_follows 
WHERE followed_id = 100;  -- 100æ˜¯ç”¨æˆ·Açš„ID
```

**âœ… Pushæ¨¡å¼ä¼˜ç‚¹**
- **è¯»å–é€Ÿåº¦å¿«**ï¼šç”¨æˆ·æ‰“å¼€Timelineç›´æ¥æŸ¥è¯¢å³å¯
- **å®æ—¶æ€§å¥½**ï¼šæ–°å†…å®¹ç«‹å³æ¨é€åˆ°ç²‰ä¸
- **æœåŠ¡å™¨å‹åŠ›å°**ï¼šè¯»å–æ—¶ä¸éœ€è¦å¤æ‚è®¡ç®—

**âŒ Pushæ¨¡å¼ç¼ºç‚¹**
- **å­˜å‚¨ç©ºé—´å¤§**ï¼šæ¯ä¸ªç²‰ä¸éƒ½å­˜ä¸€ä»½å†…å®¹
- **å¤§Vé—®é¢˜**ï¼šæœ‰ç™¾ä¸‡ç²‰ä¸çš„ç”¨æˆ·å‘å¸ƒå†…å®¹æ—¶ç³»ç»Ÿå‹åŠ›å·¨å¤§
- **ä¸æ´»è·ƒç”¨æˆ·æµªè´¹**ï¼šå¾ˆä¹…ä¸ä¸Šçº¿çš„ç”¨æˆ·ä¹Ÿä¼šæ”¶åˆ°æ¨é€

### 2.2 Pullæ¨¡å¼ï¼ˆæ‹‰å–æ¨¡å¼ï¼‰


**ğŸ”¸ åŸºæœ¬åŸç†**
ç”¨æˆ·æ‰“å¼€Timelineæ—¶ï¼Œå®æ—¶å»æŸ¥è¯¢å…³æ³¨çš„äººå‘å¸ƒçš„æœ€æ–°å†…å®¹ã€‚

```
ç”¨æˆ·æ‰“å¼€Timeline
        â†“
    æŸ¥è¯¢å…³æ³¨çš„æ‰€æœ‰äºº
        â†“
è·å–è¿™äº›äººçš„æœ€æ–°å†…å®¹
        â†“
    æŒ‰æ—¶é—´æ’åºåå±•ç¤º
```

**ğŸ’¾ æ•°æ®åº“è®¾è®¡**
```sql
-- ç”¨æˆ·å‘å¸ƒçš„å†…å®¹è¡¨
CREATE TABLE user_posts (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,       -- å‘å¸ƒè€…
    content TEXT,                  -- å†…å®¹
    create_time TIMESTAMP,         -- å‘å¸ƒæ—¶é—´
    INDEX idx_user_time (user_id, create_time)
);

-- ç”¨æˆ·æ‰“å¼€Timelineæ—¶çš„æŸ¥è¯¢
SELECT p.* FROM user_posts p
JOIN user_follows f ON p.user_id = f.followed_id
WHERE f.follower_id = 200  -- 200æ˜¯å½“å‰ç”¨æˆ·ID
ORDER BY p.create_time DESC
LIMIT 20;
```

**âœ… Pullæ¨¡å¼ä¼˜ç‚¹**
- **å­˜å‚¨æ•ˆç‡é«˜**ï¼šæ¯æ¡å†…å®¹åªå­˜ä¸€ä»½
- **å¤§Vå‹å¥½**ï¼šä¸ä¼šå› ä¸ºç²‰ä¸å¤šè€Œå½±å“å‘å¸ƒé€Ÿåº¦
- **å®æ—¶å‡†ç¡®**ï¼šæ€»æ˜¯è·å–æœ€æ–°æ•°æ®

**âŒ Pullæ¨¡å¼ç¼ºç‚¹**
- **è¯»å–é€Ÿåº¦æ…¢**ï¼šéœ€è¦å®æ—¶è®¡ç®—å’Œæ’åº
- **æœåŠ¡å™¨å‹åŠ›å¤§**ï¼šæ¯æ¬¡æ‰“å¼€Timelineéƒ½è¦å¤æ‚æŸ¥è¯¢
- **å“åº”æ—¶é—´é•¿**ï¼šå…³æ³¨äººæ•°å¤šæ—¶æŸ¥è¯¢å¾ˆæ…¢

### 2.3 æ¨¡å¼å¯¹æ¯”åˆ†æ


```
åœºæ™¯åˆ†æï¼š

å°ç”¨æˆ·ï¼ˆ<1000ç²‰ä¸ï¼‰ï¼š
â”œâ”€ Pushæ¨¡å¼ï¼šå†™å…¥å‹åŠ›å°ï¼Œå­˜å‚¨å¯æ§ âœ…
â””â”€ Pullæ¨¡å¼ï¼šè¯»å–é€Ÿåº¦å¯æ¥å— âœ…

å¤§Vç”¨æˆ·ï¼ˆ>100ä¸‡ç²‰ä¸ï¼‰ï¼š
â”œâ”€ Pushæ¨¡å¼ï¼šä¸€æ¬¡å‘å¸ƒ=100ä¸‡æ¬¡å†™å…¥ âŒ
â””â”€ Pullæ¨¡å¼ï¼šå‘å¸ƒé€Ÿåº¦ä¸å—å½±å“ âœ…

æ´»è·ƒç”¨æˆ·ï¼š
â”œâ”€ Pushæ¨¡å¼ï¼šé¢„å…ˆå‡†å¤‡å¥½ï¼Œè¯»å–å¿« âœ…
â””â”€ Pullæ¨¡å¼ï¼šé¢‘ç¹è®¡ç®—ï¼Œå‹åŠ›å¤§ âŒ

ä¸æ´»è·ƒç”¨æˆ·ï¼š
â”œâ”€ Pushæ¨¡å¼ï¼šæµªè´¹å­˜å‚¨ç©ºé—´ âŒ
â””â”€ Pullæ¨¡å¼ï¼šæŒ‰éœ€è®¡ç®—ï¼ŒèŠ‚çœèµ„æº âœ…
```

---

## 3. ğŸ”„ æ··åˆæ—¶é—´çº¿ç­–ç•¥


### 3.1 æ··åˆæ¨¡å¼æ ¸å¿ƒæ€æƒ³


**ğŸ¯ åŸºæœ¬åŸç†**
å¯¹ä¸åŒç±»å‹çš„ç”¨æˆ·é‡‡ç”¨ä¸åŒç­–ç•¥ï¼Œç»“åˆPushå’ŒPullçš„ä¼˜åŠ¿ã€‚

```
åˆ¤æ–­ç”¨æˆ·ç±»å‹
    â†“
æ™®é€šç”¨æˆ· â†’ Pushæ¨¡å¼ï¼ˆç²‰ä¸å°‘ï¼Œæ¨é€æˆæœ¬ä½ï¼‰
    â†“
å¤§Vç”¨æˆ· â†’ Pullæ¨¡å¼ï¼ˆç²‰ä¸å¤šï¼Œæ¨é€æˆæœ¬é«˜ï¼‰
    â†“
æ´»è·ƒç”¨æˆ· â†’ Pushæ¨¡å¼ï¼ˆç»å¸¸çœ‹ï¼Œéœ€è¦å¿«é€ŸåŠ è½½ï¼‰
    â†“
ä¸æ´»è·ƒç”¨æˆ· â†’ Pullæ¨¡å¼ï¼ˆå¾ˆå°‘çœ‹ï¼ŒæŒ‰éœ€è®¡ç®—ï¼‰
```

### 3.2 æ··åˆç­–ç•¥è®¾è®¡


**ğŸ“Š ç”¨æˆ·åˆ†ç±»æ ‡å‡†**
```sql
-- ç”¨æˆ·åˆ†ç±»é…ç½®
CREATE TABLE user_timeline_strategy (
    user_id BIGINT PRIMARY KEY,
    strategy_type ENUM('push', 'pull', 'hybrid'),
    follower_count INT,
    last_active_time TIMESTAMP,
    update_time TIMESTAMP
);

-- è‡ªåŠ¨åˆ†ç±»é€»è¾‘
UPDATE user_timeline_strategy 
SET strategy_type = CASE 
    WHEN follower_count > 100000 THEN 'pull'
    WHEN last_active_time < DATE_SUB(NOW(), INTERVAL 30 DAY) THEN 'pull'
    ELSE 'push'
END;
```

**ğŸ”§ æ··åˆå®ç°ç­–ç•¥**

**ç­–ç•¥1ï¼šæŒ‰ç²‰ä¸æ•°åˆ†ç±»**
```
ç²‰ä¸æ•° < 1ä¸‡ï¼šä½¿ç”¨Pushæ¨¡å¼
ç²‰ä¸æ•° 1ä¸‡-10ä¸‡ï¼šä½¿ç”¨æ··åˆæ¨¡å¼
ç²‰ä¸æ•° > 10ä¸‡ï¼šä½¿ç”¨Pullæ¨¡å¼
```

**ç­–ç•¥2ï¼šæŒ‰æ´»è·ƒåº¦åˆ†ç±»**
```
æ—¥æ´»è·ƒç”¨æˆ·ï¼šPushæ¨¡å¼ï¼ˆå¿«é€ŸåŠ è½½ï¼‰
å‘¨æ´»è·ƒç”¨æˆ·ï¼šæ··åˆæ¨¡å¼
æœˆæ´»è·ƒç”¨æˆ·ï¼šPullæ¨¡å¼ï¼ˆèŠ‚çœå­˜å‚¨ï¼‰
```

**ç­–ç•¥3ï¼šæŒ‰å†…å®¹ç±»å‹åˆ†ç±»**
```
çƒ­ç‚¹å†…å®¹ï¼šPushç»™æ‰€æœ‰ç”¨æˆ·ï¼ˆç¡®ä¿ä¼ æ’­ï¼‰
æ™®é€šå†…å®¹ï¼šæŒ‰ç”¨æˆ·ç±»å‹é€‰æ‹©æ¨¡å¼
å¹¿å‘Šå†…å®¹ï¼šç²¾å‡†Pushç»™ç›®æ ‡ç”¨æˆ·
```

---

## 4. ğŸ§® æ—¶é—´çº¿ç”Ÿæˆç®—æ³•


### 4.1 åŸºç¡€æ’åºç®—æ³•


**â° æ—¶é—´é¡ºåºæ’åº**
```sql
-- æœ€ç®€å•çš„æ—¶é—´çº¿ï¼šæŒ‰å‘å¸ƒæ—¶é—´å€’åº
SELECT * FROM user_timeline 
WHERE user_id = 123 
ORDER BY create_time DESC 
LIMIT 20;
```

**ğŸ“ˆ çƒ­åº¦æ’åºç®—æ³•**
```sql
-- è€ƒè™‘äº’åŠ¨çƒ­åº¦çš„æ’åº
SELECT *, 
       (like_count * 1 + comment_count * 2 + share_count * 3) as hot_score
FROM user_timeline ut
JOIN post_stats ps ON ut.content_id = ps.content_id
WHERE ut.user_id = 123
ORDER BY hot_score DESC, create_time DESC
LIMIT 20;
```

### 4.2 ä¸ªæ€§åŒ–æƒé‡ç®—æ³•


**ğŸ¯ ç”¨æˆ·å…³ç³»æƒé‡**
```sql
-- åŸºäºå…³ç³»äº²å¯†åº¦çš„æƒé‡è®¡ç®—
SELECT ut.*, 
       (CASE ur.relation_type 
        WHEN 'close_friend' THEN 3.0
        WHEN 'family' THEN 2.5
        WHEN 'colleague' THEN 1.5
        ELSE 1.0 
        END) as relation_weight
FROM user_timeline ut
JOIN user_relations ur ON ut.author_id = ur.target_user_id
WHERE ut.user_id = 123 AND ur.user_id = 123;
```

**ğŸ“Š å†…å®¹ç±»å‹æƒé‡**
```sql
-- åŸºäºç”¨æˆ·åå¥½çš„å†…å®¹æƒé‡
SELECT ut.*, up.preference_score
FROM user_timeline ut
JOIN user_preferences up ON ut.content_id = up.content_type
WHERE ut.user_id = 123
ORDER BY up.preference_score DESC, ut.create_time DESC;
```

### 4.3 å¤šç»´åº¦ç»¼åˆç®—æ³•


**ğŸ”„ ç»¼åˆè¯„åˆ†å…¬å¼**
```
æœ€ç»ˆå¾—åˆ† = æ—¶é—´æƒé‡ Ã— 0.3 + çƒ­åº¦æƒé‡ Ã— 0.4 + å…³ç³»æƒé‡ Ã— 0.2 + ä¸ªäººåå¥½æƒé‡ Ã— 0.1

æ—¶é—´æƒé‡ = 1 / (å½“å‰æ—¶é—´ - å‘å¸ƒæ—¶é—´)å°æ—¶æ•°
çƒ­åº¦æƒé‡ = (ç‚¹èµæ•° + è¯„è®ºæ•°Ã—2 + åˆ†äº«æ•°Ã—3) / 100
å…³ç³»æƒé‡ = ç”¨æˆ·å…³ç³»äº²å¯†åº¦åˆ†æ•°
åå¥½æƒé‡ = ç”¨æˆ·å¯¹è¯¥å†…å®¹ç±»å‹çš„å–œå¥½åˆ†æ•°
```

```sql
-- å®ç°ç»¼åˆç®—æ³•
SELECT 
    ut.*,
    (
        -- æ—¶é—´æƒé‡ï¼ˆ24å°æ—¶å†…æƒé‡æœ€é«˜ï¼‰
        (24 - TIMESTAMPDIFF(HOUR, ut.create_time, NOW())) / 24 * 0.3 +
        -- çƒ­åº¦æƒé‡
        (ps.like_count + ps.comment_count * 2 + ps.share_count * 3) / 100 * 0.4 +
        -- å…³ç³»æƒé‡
        ur.intimacy_score / 10 * 0.2 +
        -- åå¥½æƒé‡
        up.preference_score / 10 * 0.1
    ) as final_score
FROM user_timeline ut
JOIN post_stats ps ON ut.content_id = ps.content_id
JOIN user_relations ur ON ut.author_id = ur.target_user_id
JOIN user_preferences up ON ut.content_type = up.content_type
WHERE ut.user_id = 123 AND ur.user_id = 123
ORDER BY final_score DESC
LIMIT 20;
```

---

## 5. ğŸ’¾ æ—¶é—´çº¿ç¼“å­˜è®¾è®¡


### 5.1 ç¼“å­˜å±‚æ¬¡ç»“æ„


**ğŸ“š ä¸‰çº§ç¼“å­˜æ¶æ„**
```
L1ç¼“å­˜ï¼šRedisï¼ˆçƒ­æ•°æ®ï¼Œ1åˆ†é’Ÿè¿‡æœŸï¼‰
    â†“ ç¼“å­˜æœªå‘½ä¸­
L2ç¼“å­˜ï¼šMySQLå†…å­˜è¡¨ï¼ˆæ¸©æ•°æ®ï¼Œ10åˆ†é’Ÿè¿‡æœŸï¼‰
    â†“ ç¼“å­˜æœªå‘½ä¸­
L3å­˜å‚¨ï¼šMySQLç£ç›˜è¡¨ï¼ˆå†·æ•°æ®ï¼Œæ°¸ä¹…å­˜å‚¨ï¼‰
```

**ğŸ”§ Redisç¼“å­˜è®¾è®¡**
```redis
-- ç”¨æˆ·Timelineç¼“å­˜ï¼ˆå­˜å‚¨å†…å®¹IDåˆ—è¡¨ï¼‰
key: timeline:user:123
value: [content_id1, content_id2, content_id3, ...]
expire: 300ç§’

-- å†…å®¹è¯¦æƒ…ç¼“å­˜
key: content:12345
value: {"id":12345, "text":"hello", "author_id":100, ...}
expire: 3600ç§’

-- ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
key: user:100
value: {"id":100, "nickname":"å¼ ä¸‰", "avatar":"xxx.jpg", ...}
expire: 1800ç§’
```

### 5.2 ç¼“å­˜æ›´æ–°ç­–ç•¥


**ğŸ”„ å†™å…¥æ—¶æ›´æ–°**
```java
// ç”¨æˆ·å‘å¸ƒæ–°å†…å®¹æ—¶
public void publishContent(long authorId, String content) {
    // 1. ä¿å­˜åˆ°æ•°æ®åº“
    long contentId = saveToDatabase(authorId, content);
    
    // 2. è·å–ç²‰ä¸åˆ—è¡¨ï¼ˆåˆ†æ‰¹å¤„ç†ï¼‰
    List<Long> followers = getFollowers(authorId);
    
    // 3. æ›´æ–°ç²‰ä¸çš„Timelineç¼“å­˜
    for (long followerId : followers) {
        String key = "timeline:user:" + followerId;
        // åœ¨åˆ—è¡¨å¤´éƒ¨æ’å…¥æ–°å†…å®¹ID
        redis.lpush(key, contentId);
        // ä¿æŒåˆ—è¡¨é•¿åº¦ä¸è¶…è¿‡1000
        redis.ltrim(key, 0, 999);
    }
}
```

**ğŸ—‘ï¸ è¿‡æœŸæ¸…ç†ç­–ç•¥**
```java
// å®šæœŸæ¸…ç†è¿‡æœŸå†…å®¹
@Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ‰§è¡Œ
public void cleanExpiredContent() {
    // æ¸…ç†7å¤©å‰çš„Timelineç¼“å­˜
    String pattern = "timeline:user:*";
    Set<String> keys = redis.keys(pattern);
    
    for (String key : keys) {
        // ç§»é™¤7å¤©å‰çš„å†…å®¹
        long expireTime = System.currentTimeMillis() - 7 * 24 * 3600 * 1000;
        redis.zremrangebyscore(key, 0, expireTime);
    }
}
```

### 5.3 ç¼“å­˜é¢„çƒ­ç­–ç•¥


**ğŸ”¥ æ´»è·ƒç”¨æˆ·é¢„çƒ­**
```sql
-- è¯†åˆ«æ´»è·ƒç”¨æˆ·
SELECT user_id FROM user_activity 
WHERE last_active_time > DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY activity_score DESC
LIMIT 10000;

-- ä¸ºæ´»è·ƒç”¨æˆ·é¢„ç”ŸæˆTimeline
INSERT INTO timeline_cache (user_id, content_list, generate_time)
SELECT user_id, generateTimeline(user_id), NOW()
FROM active_users;
```

---

## 6. ğŸ“‘ å†…å®¹æ’åºä¸åˆ†é¡µç­–ç•¥


### 6.1 æ—¶é—´çº¿åˆ†é¡µè®¾è®¡


**ğŸ”¸ åŸºäºæ—¶é—´æˆ³çš„åˆ†é¡µ**
```sql
-- ç¬¬ä¸€é¡µï¼šè·å–æœ€æ–°20æ¡
SELECT * FROM user_timeline 
WHERE user_id = 123
ORDER BY create_time DESC 
LIMIT 20;

-- ç¬¬äºŒé¡µï¼šåŸºäºä¸Šä¸€é¡µæœ€åä¸€æ¡çš„æ—¶é—´æˆ³
SELECT * FROM user_timeline 
WHERE user_id = 123 AND create_time < '2024-01-15 14:30:00'
ORDER BY create_time DESC 
LIMIT 20;
```

**âš ï¸ ä¼ ç»Ÿåˆ†é¡µçš„é—®é¢˜**
```sql
-- ä¸æ¨èï¼šä½¿ç”¨OFFSETåˆ†é¡µ
SELECT * FROM user_timeline 
WHERE user_id = 123
ORDER BY create_time DESC 
LIMIT 20 OFFSET 40;  -- ç¬¬3é¡µ

é—®é¢˜ï¼š
1. OFFSETè¶Šå¤§ï¼ŒæŸ¥è¯¢è¶Šæ…¢
2. æ–°å†…å®¹æ’å…¥ä¼šå¯¼è‡´æ•°æ®é‡å¤
3. å¤§åç§»é‡æ€§èƒ½å·®
```

### 6.2 æ¸¸æ ‡åˆ†é¡µå®ç°


**ğŸ“ æ¸¸æ ‡åˆ†é¡µåŸç†**
```java
// åˆ†é¡µè¯·æ±‚å‚æ•°
public class TimelinePage {
    private String cursor;  // æ¸¸æ ‡ï¼ˆé€šå¸¸æ˜¯æ—¶é—´æˆ³ï¼‰
    private int limit = 20; // æ¯é¡µæ•°é‡
}

// åˆ†é¡µå“åº”
public class TimelineResponse {
    private List<Content> contents;
    private String nextCursor;  // ä¸‹ä¸€é¡µæ¸¸æ ‡
    private boolean hasMore;    // æ˜¯å¦è¿˜æœ‰æ›´å¤š
}
```

**ğŸ’¾ æ¸¸æ ‡æŸ¥è¯¢å®ç°**
```sql
-- ä½¿ç”¨æ¸¸æ ‡æŸ¥è¯¢
SELECT id, content, create_time 
FROM user_timeline 
WHERE user_id = 123 
  AND create_time < '2024-01-15 14:30:00'  -- cursor
ORDER BY create_time DESC 
LIMIT 21;  -- å¤šæŸ¥ä¸€æ¡åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ›´å¤š

-- å¦‚æœè¿”å›21æ¡ï¼Œè¯´æ˜è¿˜æœ‰æ›´å¤šæ•°æ®
-- å–å‰20æ¡è¿”å›ç»™ç”¨æˆ·ï¼Œç¬¬21æ¡çš„æ—¶é—´ä½œä¸ºnextCursor
```

### 6.3 å†…å®¹å»é‡ç­–ç•¥


**ğŸ”„ å»é‡åœºæ™¯**
- åŒä¸€å†…å®¹è¢«å¤šä¸ªæœ‹å‹è½¬å‘
- å¹¿å‘Šå†…å®¹é‡å¤å±•ç¤º
- çƒ­ç‚¹å†…å®¹å¤šæ¬¡æ¨è

**ğŸ’¡ å»é‡å®ç°**
```sql
-- åŸºäºå†…å®¹æŒ‡çº¹å»é‡
SELECT DISTINCT 
    ut.id,
    ut.content_id,
    ut.create_time,
    c.content_hash  -- å†…å®¹æŒ‡çº¹
FROM user_timeline ut
JOIN contents c ON ut.content_id = c.id
WHERE ut.user_id = 123
ORDER BY ut.create_time DESC;

-- 24å°æ—¶å†…ç›¸åŒç±»å‹å†…å®¹é™åˆ¶
WITH recent_content AS (
    SELECT content_type, COUNT(*) as count
    FROM user_timeline ut
    JOIN contents c ON ut.content_id = c.id
    WHERE ut.user_id = 123 
      AND ut.create_time > DATE_SUB(NOW(), INTERVAL 24 HOUR)
    GROUP BY c.content_type
)
SELECT ut.* FROM user_timeline ut
JOIN contents c ON ut.content_id = c.id
LEFT JOIN recent_content rc ON c.content_type = rc.content_type
WHERE ut.user_id = 123
  AND (rc.count IS NULL OR rc.count < 3)  -- åŒç±»å‹å†…å®¹24å°æ—¶å†…ä¸è¶…è¿‡3æ¡
ORDER BY ut.create_time DESC;
```

---

## 7. âš¡ å®æ—¶æ›´æ–°æœºåˆ¶


### 7.1 WebSocketå®æ—¶æ¨é€


**ğŸ”Œ è¿æ¥ç®¡ç†**
```java
@Component
public class TimelineWebSocket {
    // ç”¨æˆ·è¿æ¥æ˜ å°„
    private static Map<Long, WebSocketSession> userSessions = new ConcurrentHashMap<>();
    
    @OnOpen
    public void onConnect(@PathParam("userId") Long userId, Session session) {
        userSessions.put(userId, session);
        log.info("ç”¨æˆ·{}è¿æ¥Timelineå®æ—¶æ¨é€", userId);
    }
    
    // æ¨é€æ–°å†…å®¹ç»™åœ¨çº¿ç”¨æˆ·
    public void pushToUser(Long userId, Object content) {
        WebSocketSession session = userSessions.get(userId);
        if (session != null && session.isOpen()) {
            session.sendText(JSON.toJSONString(content));
        }
    }
}
```

**ğŸ“¤ å†…å®¹å‘å¸ƒæ¨é€**
```java
@Service
public class ContentPublishService {
    
    public void publishContent(Long authorId, String content) {
        // 1. ä¿å­˜å†…å®¹
        Content newContent = saveContent(authorId, content);
        
        // 2. è·å–åœ¨çº¿ç²‰ä¸
        List<Long> onlineFollowers = getOnlineFollowers(authorId);
        
        // 3. å®æ—¶æ¨é€ç»™åœ¨çº¿ç²‰ä¸
        for (Long followerId : onlineFollowers) {
            timelineWebSocket.pushToUser(followerId, newContent);
        }
        
        // 4. ç¦»çº¿ç”¨æˆ·å†™å…¥ç¼“å­˜é˜Ÿåˆ—
        List<Long> offlineFollowers = getOfflineFollowers(authorId);
        for (Long followerId : offlineFollowers) {
            redis.lpush("pending:timeline:" + followerId, newContent.getId());
        }
    }
}
```

### 7.2 å¢é‡æ›´æ–°ç­–ç•¥


**ğŸ“Š æ›´æ–°æ—¶é—´æˆ³è®°å½•**
```sql
-- ç”¨æˆ·Timelineæ›´æ–°æ—¶é—´è®°å½•
CREATE TABLE user_timeline_sync (
    user_id BIGINT PRIMARY KEY,
    last_sync_time TIMESTAMP,
    last_update_time TIMESTAMP,
    INDEX idx_update_time (last_update_time)
);

-- æŸ¥è¯¢ç”¨æˆ·è‡ªä¸Šæ¬¡åŒæ­¥åçš„æ–°å†…å®¹
SELECT ut.* FROM user_timeline ut
JOIN user_timeline_sync uts ON ut.user_id = uts.user_id
WHERE ut.user_id = 123 
  AND ut.create_time > uts.last_sync_time
ORDER BY ut.create_time DESC;
```

**ğŸ”„ é•¿è½®è¯¢å®ç°**
```java
@RestController
public class TimelineController {
    
    @GetMapping("/timeline/updates")
    public ResponseEntity<?> getUpdates(
            @RequestParam Long userId,
            @RequestParam String lastSyncTime,
            @RequestParam(defaultValue = "30") int timeout) {
        
        long startTime = System.currentTimeMillis();
        
        while (System.currentTimeMillis() - startTime < timeout * 1000) {
            // æ£€æŸ¥æ˜¯å¦æœ‰æ–°å†…å®¹
            List<Content> newContents = checkNewContents(userId, lastSyncTime);
            if (!newContents.isEmpty()) {
                return ResponseEntity.ok(newContents);
            }
            
            // æ²¡æœ‰æ–°å†…å®¹ï¼Œç­‰å¾…1ç§’åé‡è¯•
            try {
                Thread.sleep(1000);
            } catch (InterruptedException e) {
                break;
            }
        }
        
        // è¶…æ—¶è¿”å›ç©ºç»“æœ
        return ResponseEntity.ok(Collections.emptyList());
    }
}
```

---

## 8. ğŸ¯ ä¸ªæ€§åŒ–Timelineå®ç°


### 8.1 ç”¨æˆ·è¡Œä¸ºè¿½è¸ª


**ğŸ“Š ç”¨æˆ·è¡Œä¸ºæ•°æ®æ”¶é›†**
```sql
-- ç”¨æˆ·è¡Œä¸ºè®°å½•è¡¨
CREATE TABLE user_behavior_log (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    action_type ENUM('view', 'like', 'comment', 'share', 'skip'),
    content_id BIGINT,
    content_type VARCHAR(50),
    author_id BIGINT,
    dwell_time INT,  -- åœç•™æ—¶é—´ï¼ˆç§’ï¼‰
    action_time TIMESTAMP,
    INDEX idx_user_time (user_id, action_time),
    INDEX idx_content (content_id)
);

-- è®°å½•ç”¨æˆ·æŸ¥çœ‹å†…å®¹
INSERT INTO user_behavior_log 
(user_id, action_type, content_id, content_type, author_id, dwell_time, action_time)
VALUES 
(123, 'view', 456, 'image', 789, 15, NOW());
```

**ğŸ§® ç”¨æˆ·åå¥½è®¡ç®—**
```sql
-- è®¡ç®—ç”¨æˆ·å¯¹ä¸åŒå†…å®¹ç±»å‹çš„åå¥½
SELECT 
    content_type,
    COUNT(*) as view_count,
    AVG(dwell_time) as avg_dwell_time,
    SUM(CASE WHEN action_type = 'like' THEN 1 ELSE 0 END) as like_count,
    -- åå¥½åˆ†æ•°è®¡ç®—
    (COUNT(*) * 0.1 + AVG(dwell_time) * 0.3 + 
     SUM(CASE WHEN action_type = 'like' THEN 1 ELSE 0 END) * 2) as preference_score
FROM user_behavior_log 
WHERE user_id = 123 
  AND action_time > DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY content_type
ORDER BY preference_score DESC;
```

### 8.2 æœºå™¨å­¦ä¹ æ¨è


**ğŸ¤– ç‰¹å¾å·¥ç¨‹**
```python
# ç”¨æˆ·ç‰¹å¾
user_features = {
    'age_group': 25,
    'gender': 'female',
    'location': 'beijing',
    'active_hours': [9, 12, 18, 21],  # æ´»è·ƒæ—¶é—´æ®µ
    'interests': ['technology', 'travel', 'food']
}

# å†…å®¹ç‰¹å¾
content_features = {
    'content_type': 'image',
    'topic_category': 'travel',
    'publish_time_hour': 14,
    'author_follower_count': 5000,
    'engagement_rate': 0.05  # äº’åŠ¨ç‡
}

# äº¤äº’ç‰¹å¾
interaction_features = {
    'user_author_interaction_history': 5,  # å†å²äº’åŠ¨æ¬¡æ•°
    'similar_content_engagement': 0.8,     # å¯¹ç›¸ä¼¼å†…å®¹çš„å‚ä¸åº¦
    'recency_factor': 0.9                  # æ—¶é—´è¡°å‡å› å­
}
```

**ğŸ“ˆ æ¨èåˆ†æ•°è®¡ç®—**
```java
@Service
public class RecommendationService {
    
    public double calculateRecommendationScore(long userId, long contentId) {
        // è·å–ç”¨æˆ·ç‰¹å¾
        UserFeature userFeature = getUserFeature(userId);
        
        // è·å–å†…å®¹ç‰¹å¾
        ContentFeature contentFeature = getContentFeature(contentId);
        
        // è·å–å†å²äº¤äº’ç‰¹å¾
        InteractionFeature interaction = getInteractionFeature(userId, contentId);
        
        // è®¡ç®—ç›¸ä¼¼åº¦åˆ†æ•°
        double similarityScore = calculateSimilarity(userFeature, contentFeature);
        
        // è®¡ç®—æ–°é²œåº¦åˆ†æ•°
        double freshnessScore = calculateFreshness(contentFeature.getPublishTime());
        
        // è®¡ç®—ç¤¾äº¤å½±å“åˆ†æ•°
        double socialScore = calculateSocialInfluence(userId, contentFeature.getAuthorId());
        
        // ç»¼åˆåˆ†æ•°
        return similarityScore * 0.4 + freshnessScore * 0.3 + socialScore * 0.3;
    }
}
```

### 8.3 A/Bæµ‹è¯•æ¡†æ¶


**ğŸ”¬ å®éªŒé…ç½®**
```sql
-- A/Bæµ‹è¯•å®éªŒé…ç½®
CREATE TABLE ab_test_experiments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    experiment_name VARCHAR(100),
    description TEXT,
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    traffic_allocation DECIMAL(3,2),  -- æµé‡åˆ†é…æ¯”ä¾‹
    status ENUM('active', 'paused', 'completed'),
    config JSON  -- å®éªŒå‚æ•°é…ç½®
);

-- ç”¨æˆ·å®éªŒåˆ†ç»„
CREATE TABLE user_experiment_groups (
    user_id BIGINT,
    experiment_id BIGINT,
    group_name VARCHAR(50),  -- 'control', 'treatment_a', 'treatment_b'
    assign_time TIMESTAMP,
    PRIMARY KEY (user_id, experiment_id)
);
```

**ğŸ“Š å®éªŒæ•ˆæœç›‘æ§**
```sql
-- å®éªŒæ•ˆæœç»Ÿè®¡
SELECT 
    ueg.group_name,
    COUNT(DISTINCT ueg.user_id) as user_count,
    COUNT(ubl.id) as total_actions,
    AVG(ubl.dwell_time) as avg_dwell_time,
    SUM(CASE WHEN ubl.action_type = 'like' THEN 1 ELSE 0 END) / COUNT(ubl.id) as like_rate
FROM user_experiment_groups ueg
JOIN user_behavior_log ubl ON ueg.user_id = ubl.user_id
WHERE ueg.experiment_id = 1
  AND ubl.action_time BETWEEN '2024-01-01' AND '2024-01-31'
GROUP BY ueg.group_name;
```

---

## 9. ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 9.1 æ•°æ®åº“ä¼˜åŒ–


**ğŸ“ˆ ç´¢å¼•ä¼˜åŒ–**
```sql
-- TimelineæŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_timeline_user_time ON user_timeline(user_id, create_time DESC);

-- å¤åˆç´¢å¼•æ”¯æŒå¤šç»´åº¦æŸ¥è¯¢
CREATE INDEX idx_timeline_multi ON user_timeline(user_id, author_id, create_time DESC);

-- è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨
CREATE INDEX idx_timeline_cover ON user_timeline(user_id, create_time DESC) 
INCLUDE (content_id, author_id);

-- åˆ†åŒºè¡¨ä¼˜åŒ–ï¼ˆæŒ‰æ—¶é—´åˆ†åŒºï¼‰
CREATE TABLE user_timeline (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    content_id BIGINT NOT NULL,
    create_time TIMESTAMP
) PARTITION BY RANGE (UNIX_TIMESTAMP(create_time)) (
    PARTITION p_202401 VALUES LESS THAN (UNIX_TIMESTAMP('2024-02-01')),
    PARTITION p_202402 VALUES LESS THAN (UNIX_TIMESTAMP('2024-03-01')),
    -- ... æ›´å¤šåˆ†åŒº
);
```

**ğŸ”„ è¯»å†™åˆ†ç¦»**
```java
@Configuration
public class DatabaseConfig {
    
    @Bean("writeDataSource")
    @Primary
    public DataSource writeDataSource() {
        // ä¸»åº“é…ç½®ï¼ˆç”¨äºå†™æ“ä½œï¼‰
        return DataSourceBuilder.create()
                .url("jdbc:mysql://master-db:3306/timeline")
                .username("writer")
                .password("password")
                .build();
    }
    
    @Bean("readDataSource")
    public DataSource readDataSource() {
        // ä»åº“é…ç½®ï¼ˆç”¨äºè¯»æ“ä½œï¼‰
        return DataSourceBuilder.create()
                .url("jdbc:mysql://slave-db:3306/timeline")
                .username("reader")
                .password("password")
                .build();
    }
}

// æœåŠ¡å±‚ä½¿ç”¨
@Service
public class TimelineService {
    
    @Transactional(readOnly = true)
    public List<Content> getTimeline(long userId) {
        // è‡ªåŠ¨è·¯ç”±åˆ°è¯»åº“
        return timelineRepository.findByUserId(userId);
    }
    
    @Transactional
    public void addToTimeline(long userId, long contentId) {
        // è‡ªåŠ¨è·¯ç”±åˆ°å†™åº“
        timelineRepository.save(new UserTimeline(userId, contentId));
    }
}
```

### 9.2 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸƒâ€â™€ï¸ å¤šçº§ç¼“å­˜**
```java
@Service
public class CachedTimelineService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    @Autowired
    private CaffeineCache localCache;
    
    public List<Content> getTimeline(long userId) {
        String cacheKey = "timeline:user:" + userId;
        
        // L1: æœ¬åœ°ç¼“å­˜ï¼ˆæœ€å¿«ï¼‰
        List<Content> timeline = localCache.get(cacheKey);
        if (timeline != null) {
            return timeline;
        }
        
        // L2: Redisç¼“å­˜
        timeline = (List<Content>) redisTemplate.opsForValue().get(cacheKey);
        if (timeline != null) {
            localCache.put(cacheKey, timeline, 60); // æœ¬åœ°ç¼“å­˜1åˆ†é’Ÿ
            return timeline;
        }
        
        // L3: æ•°æ®åº“æŸ¥è¯¢
        timeline = generateTimelineFromDB(userId);
        
        // å†™å…¥ç¼“å­˜
        redisTemplate.opsForValue().set(cacheKey, timeline, Duration.ofMinutes(10));
        localCache.put(cacheKey, timeline, 60);
        
        return timeline;
    }
}
```

**ğŸ“Š ç¼“å­˜é¢„çƒ­ä¸é¢„åŠ è½½**
```java
@Component
public class TimelineCacheWarmer {
    
    // åº”ç”¨å¯åŠ¨æ—¶é¢„çƒ­çƒ­é—¨ç”¨æˆ·ç¼“å­˜
    @EventListener(ApplicationReadyEvent.class)
    public void warmupCache() {
        List<Long> vipUsers = getVipUsers();
        
        for (Long userId : vipUsers) {
            CompletableFuture.runAsync(() -> {
                generateAndCacheTimeline(userId);
            });
        }
    }
    
    // å®šæ—¶é¢„çƒ­æ´»è·ƒç”¨æˆ·ç¼“å­˜
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿ
    public void scheduleWarmup() {
        List<Long> activeUsers = getRecentActiveUsers(1000);
        
        activeUsers.parallelStream().forEach(userId -> {
            if (!isCacheExists(userId)) {
                generateAndCacheTimeline(userId);
            }
        });
    }
}
```

### 9.3 å¼‚æ­¥å¤„ç†ä¼˜åŒ–


**âš¡ å¼‚æ­¥Timelineç”Ÿæˆ**
```java
@Service
public class AsyncTimelineService {
    
    @Async("timelineExecutor")
    public CompletableFuture<Void> generateTimelineAsync(long userId) {
        try {
            List<Content> timeline = generateTimeline(userId);
            cacheTimeline(userId, timeline);
            return CompletableFuture.completedFuture(null);
        } catch (Exception e) {
            log.error("ç”ŸæˆTimelineå¤±è´¥: userId={}", userId, e);
            return CompletableFuture.failedFuture(e);
        }
    }
    
    // æ‰¹é‡å¼‚æ­¥ç”Ÿæˆ
    public void batchGenerateTimelines(List<Long> userIds) {
        List<CompletableFuture<Void>> futures = userIds.stream()
                .map(this::generateTimelineAsync)
                .collect(Collectors.toList());
        
        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
                .join();
    }
}
```

**ğŸ”„ æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦**
```java
// å†…å®¹å‘å¸ƒæ—¶å‘é€æ¶ˆæ¯
@Service
public class ContentPublisher {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void publishContent(Content content) {
        // ä¿å­˜å†…å®¹åˆ°æ•°æ®åº“
        contentRepository.save(content);
        
        // å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œå¼‚æ­¥å¤„ç†Timelineæ›´æ–°
        TimelineUpdateMessage message = new TimelineUpdateMessage();
        message.setAuthorId(content.getAuthorId());
        message.setContentId(content.getId());
        
        rabbitTemplate.convertAndSend("timeline.fanout", message);
    }
}

// æ¶ˆè´¹æ¶ˆæ¯æ›´æ–°Timeline
@RabbitListener(queues = "timeline.update.queue")
@Service
public class TimelineUpdateConsumer {
    
    public void updateTimeline(TimelineUpdateMessage message) {
        List<Long> followers = getFollowers(message.getAuthorId());
        
        // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§å¤„ç†è¿‡å¤šç”¨æˆ·
        int batchSize = 1000;
        for (int i = 0; i < followers.size(); i += batchSize) {
            List<Long> batch = followers.subList(i, 
                Math.min(i + batchSize, followers.size()));
            
            batchUpdateTimeline(batch, message.getContentId());
        }
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 Timelineè®¾è®¡æ ¸å¿ƒè¦ç‚¹


**ğŸ¯ æ ¸å¿ƒæ¦‚å¿µç†è§£**
```
Timeline = å†…å®¹å±•ç¤ºåˆ—è¡¨
ç›®æ ‡ = è®©ç”¨æˆ·çœ‹åˆ°æœ€æ„Ÿå…´è¶£çš„å†…å®¹
æŒ‘æˆ˜ = æµ·é‡æ•°æ® + å®æ—¶æ€§ + ä¸ªæ€§åŒ–
```

**âš–ï¸ Push vs Pull é€‰æ‹©åŸåˆ™**
- **ç²‰ä¸å°‘çš„ç”¨æˆ·** â†’ Pushæ¨¡å¼ï¼ˆå†™å…¥æˆæœ¬ä½ï¼‰
- **ç²‰ä¸å¤šçš„å¤§V** â†’ Pullæ¨¡å¼ï¼ˆé¿å…å†™æ”¾å¤§ï¼‰
- **æ´»è·ƒç”¨æˆ·** â†’ Pushæ¨¡å¼ï¼ˆè¯»å–é€Ÿåº¦å¿«ï¼‰
- **ä¸æ´»è·ƒç”¨æˆ·** â†’ Pullæ¨¡å¼ï¼ˆèŠ‚çœå­˜å‚¨ï¼‰

### 10.2 æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹


**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–**
- æ•°æ®åˆ†åŒºï¼šæŒ‰æ—¶é—´åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
- ç´¢å¼•è®¾è®¡ï¼šå¤åˆç´¢å¼•æ”¯æŒå¤šç»´åº¦æŸ¥è¯¢
- è¯»å†™åˆ†ç¦»ï¼šåˆ†æ‹…æ•°æ®åº“å‹åŠ›

**ğŸš€ ç¼“å­˜ä¼˜åŒ–**
- å¤šçº§ç¼“å­˜ï¼šæœ¬åœ°ç¼“å­˜ + Redisç¼“å­˜ + æ•°æ®åº“
- ç¼“å­˜é¢„çƒ­ï¼šæå‰ä¸ºæ´»è·ƒç”¨æˆ·ç”ŸæˆTimeline
- å¼‚æ­¥æ›´æ–°ï¼šåå°å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ

**âš¡ å®æ—¶æ€§ä¼˜åŒ–**
- WebSocketæ¨é€ï¼šå®æ—¶æ¨é€æ–°å†…å®¹
- é•¿è½®è¯¢ï¼šå…¼å®¹ä¸æ”¯æŒWebSocketçš„å®¢æˆ·ç«¯
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šè§£è€¦å†…å®¹å‘å¸ƒå’ŒTimelineæ›´æ–°

### 10.3 ä¸ªæ€§åŒ–æ¨èè¦ç‚¹


**ğŸ“Š æ•°æ®æ”¶é›†**
- ç”¨æˆ·è¡Œä¸ºï¼šæµè§ˆã€ç‚¹èµã€è¯„è®ºã€åˆ†äº«ã€è·³è¿‡
- åœç•™æ—¶é—´ï¼šåæ˜ ç”¨æˆ·å…´è¶£ç¨‹åº¦
- ç¤¾äº¤å…³ç³»ï¼šå¥½å‹äº’åŠ¨å½±å“æ¨èæƒé‡

**ğŸ¤– ç®—æ³•ä¼˜åŒ–**
- å¤šç»´åº¦æƒé‡ï¼šæ—¶é—´ + çƒ­åº¦ + å…³ç³» + åå¥½
- æœºå™¨å­¦ä¹ ï¼šæŒç»­ä¼˜åŒ–æ¨èç®—æ³•
- A/Bæµ‹è¯•ï¼šéªŒè¯ç®—æ³•æ•ˆæœ

### 10.4 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ æ ¹æ®ä¸šåŠ¡è§„æ¨¡é€‰æ‹©ç­–ç•¥**
```
ç”¨æˆ·è§„æ¨¡ < 10ä¸‡ï¼š
â”œâ”€ ç®€å•Pushæ¨¡å¼
â”œâ”€ MySQLå•æœº
â””â”€ Redisç¼“å­˜

ç”¨æˆ·è§„æ¨¡ 10ä¸‡-100ä¸‡ï¼š
â”œâ”€ æ··åˆæ¨¡å¼
â”œâ”€ è¯»å†™åˆ†ç¦»
â”œâ”€ å¤šçº§ç¼“å­˜
â””â”€ å¼‚æ­¥å¤„ç†

ç”¨æˆ·è§„æ¨¡ > 100ä¸‡ï¼š
â”œâ”€ å¤æ‚æ··åˆç­–ç•¥
â”œâ”€ åˆ†åº“åˆ†è¡¨
â”œâ”€ æ¶ˆæ¯é˜Ÿåˆ—
â”œâ”€ æœºå™¨å­¦ä¹ æ¨è
â””â”€ å®æ—¶è®¡ç®—å¹³å°
```

**ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®**
```
ç¼“å­˜ï¼šRedis Clusterï¼ˆé«˜å¯ç”¨ï¼‰
æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ/Kafkaï¼ˆå¯é æ€§ï¼‰
æ•°æ®åº“ï¼šMySQLåˆ†ç‰‡ + è¯»å†™åˆ†ç¦»
è®¡ç®—ï¼šFlink/Sparkï¼ˆå®æ—¶/ç¦»çº¿è®¡ç®—ï¼‰
ç›‘æ§ï¼šPrometheus + Grafana
```

> ğŸ’¡ **æ ¸å¿ƒè®°å¿†**
>
> Timelineè®¾è®¡çš„æœ¬è´¨æ˜¯åœ¨**å­˜å‚¨æˆæœ¬**ã€**è®¡ç®—æˆæœ¬**å’Œ**ç”¨æˆ·ä½“éªŒ**ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚
> 
> æ²¡æœ‰ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰æœ€é€‚åˆå½“å‰ä¸šåŠ¡åœºæ™¯çš„æ¶æ„è®¾è®¡ã€‚