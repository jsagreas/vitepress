---
title: 1ã€ç”¨æˆ·å…³ç³»è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [ç”¨æˆ·å…³ç³»åŸºç¡€æ¦‚å¿µ](#1-ç”¨æˆ·å…³ç³»åŸºç¡€æ¦‚å¿µ)
2. [å¥½å‹å…³ç³»è¡¨è®¾è®¡](#2-å¥½å‹å…³ç³»è¡¨è®¾è®¡)
3. [å…³æ³¨ç²‰ä¸æ¨¡å‹](#3-å…³æ³¨ç²‰ä¸æ¨¡å‹)
4. [åŒå‘å…³ç³»å­˜å‚¨ç­–ç•¥](#4-åŒå‘å…³ç³»å­˜å‚¨ç­–ç•¥)
5. [å…³ç³»é“¾æŸ¥è¯¢ä¼˜åŒ–](#5-å…³ç³»é“¾æŸ¥è¯¢ä¼˜åŒ–)
6. [é»‘åå•ç®¡ç†æœºåˆ¶](#6-é»‘åå•ç®¡ç†æœºåˆ¶)
7. [å…³ç³»æ¨èç®—æ³•](#7-å…³ç³»æ¨èç®—æ³•)
8. [ç¤¾äº¤è·ç¦»è®¡ç®—](#8-ç¤¾äº¤è·ç¦»è®¡ç®—)
9. [å›¾æ•°æ®åº“åº”ç”¨](#9-å›¾æ•°æ®åº“åº”ç”¨)
10. [ç¤¾äº¤ç½‘ç»œåˆ†æ](#10-ç¤¾äº¤ç½‘ç»œåˆ†æ)
11. [å¤§è§„æ¨¡å¤„ç†ä¼˜åŒ–](#11-å¤§è§„æ¨¡å¤„ç†ä¼˜åŒ–)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ‘¥ ç”¨æˆ·å…³ç³»åŸºç¡€æ¦‚å¿µ


### 1.1 ç¤¾äº¤å…³ç³»çš„æœ¬è´¨ç†è§£


**ä»€ä¹ˆæ˜¯ç”¨æˆ·å…³ç³»**ï¼š
ç”¨æˆ·å…³ç³»å°±æ˜¯ç¤¾äº¤å¹³å°ä¸Šç”¨æˆ·ä¹‹é—´çš„è¿æ¥çŠ¶æ€ï¼Œæ¯”å¦‚å¾®ä¿¡çš„å¥½å‹ã€å¾®åšçš„å…³æ³¨å’Œç²‰ä¸ã€QQçš„å¥½å‹ç­‰ã€‚è¿™äº›å…³ç³»åœ¨æ•°æ®åº“ä¸­éœ€è¦ç”¨ç‰¹å®šçš„è¡¨ç»“æ„æ¥å­˜å‚¨å’Œç®¡ç†ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦è®¾è®¡ç”¨æˆ·å…³ç³»**ï¼š
- **è¿æ¥ç”¨æˆ·**ï¼šè®©ç”¨æˆ·èƒ½å¤Ÿæ‰¾åˆ°å’Œè”ç³»å…¶ä»–äºº
- **å†…å®¹åˆ†å‘**ï¼šå†³å®šç”¨æˆ·èƒ½çœ‹åˆ°è°çš„åŠ¨æ€
- **æ¨èä¾æ®**ï¼šåŸºäºå…³ç³»æ¨èæ–°æœ‹å‹æˆ–å†…å®¹
- **æƒé™æ§åˆ¶**ï¼šæ§åˆ¶è°èƒ½çœ‹åˆ°æˆ‘çš„ä¿¡æ¯

### 1.2 ç¤¾äº¤å…³ç³»çš„åˆ†ç±»


```
ç¤¾äº¤å…³ç³»ç±»å‹å›¾è°±ï¼š

    åŒå‘å…³ç³»                å•å‘å…³ç³»
       |                      |
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  å¥½å‹   â”‚           â”‚  å…³æ³¨   â”‚
   â”‚(äº’ç›¸)   â”‚           â”‚(å•å‘)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       |                      |
   å¾®ä¿¡å¥½å‹              å¾®åšå…³æ³¨/ç²‰ä¸
   QQå¥½å‹               æŠ–éŸ³å…³æ³¨/ç²‰ä¸
   Facebookæœ‹å‹          Twitterå…³æ³¨
```

> **ğŸ’¡ æ ¸å¿ƒç†è§£**ï¼šåŒå‘å…³ç³»éœ€è¦åŒæ–¹åŒæ„(å¦‚åŠ å¥½å‹)ï¼Œå•å‘å…³ç³»åªéœ€ä¸€æ–¹æ“ä½œ(å¦‚å…³æ³¨æŸäºº)

### 1.3 å…³ç³»çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸ


**å…³ç³»çš„å‡ ç§çŠ¶æ€**ï¼š
```
å…³ç³»çŠ¶æ€æµè½¬å›¾ï¼š

é™Œç”Ÿäºº â”€â”€[å‘èµ·è¯·æ±‚]â”€â”€> å¾…ç¡®è®¤ â”€â”€[åŒæ„]â”€â”€> å¥½å‹
  |                      |           |
  |                   [æ‹’ç»]      [åˆ é™¤]
  |                      |           |
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€[å±è”½]â”€â”€â”€â”€â”€> é»‘åå• <â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ—ƒï¸ å¥½å‹å…³ç³»è¡¨è®¾è®¡


### 2.1 åŸºç¡€å¥½å‹è¡¨ç»“æ„


**æ ¸å¿ƒè®¾è®¡æ€è·¯**ï¼š
å¥½å‹å…³ç³»è¡¨è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼šè®°å½•è°å’Œè°æ˜¯å¥½å‹ã€ä»€ä¹ˆæ—¶å€™æˆä¸ºå¥½å‹ã€å…³ç³»çŠ¶æ€å¦‚ä½•ã€‚

```sql
-- å¥½å‹å…³ç³»è¡¨
CREATE TABLE user_friends (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    friend_id BIGINT NOT NULL COMMENT 'å¥½å‹ID', 
    status TINYINT DEFAULT 1 COMMENT 'å…³ç³»çŠ¶æ€ï¼š1æ­£å¸¸ 2åˆ é™¤ 3æ‹‰é»‘',
    intimacy_score INT DEFAULT 0 COMMENT 'äº²å¯†åº¦åˆ†æ•°',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_friend (user_id, friend_id),
    INDEX idx_user_status (user_id, status),
    INDEX idx_friend_status (friend_id, status)
) COMMENT='ç”¨æˆ·å¥½å‹å…³ç³»è¡¨';
```

**å­—æ®µå«ä¹‰è§£é‡Š**ï¼š
- `user_id`ï¼šä¸»åŠ¨æ–¹ç”¨æˆ·ID
- `friend_id`ï¼šè¢«æ·»åŠ çš„å¥½å‹ID  
- `status`ï¼šå…³ç³»çŠ¶æ€ï¼Œç”¨æ•°å­—è¡¨ç¤ºä¸åŒçŠ¶æ€
- `intimacy_score`ï¼šäº²å¯†åº¦åˆ†æ•°ï¼Œå¯ä»¥æ ¹æ®äº’åŠ¨é¢‘ç‡è®¡ç®—
- **å”¯ä¸€ç´¢å¼•**ï¼šé˜²æ­¢é‡å¤æ·»åŠ åŒä¸€ä¸ªå¥½å‹

### 2.2 å¥½å‹è¯·æ±‚è¡¨è®¾è®¡


**ä¸ºä»€ä¹ˆéœ€è¦å•ç‹¬çš„è¯·æ±‚è¡¨**ï¼š
åœ¨å¾®ä¿¡ç­‰åº”ç”¨ä¸­ï¼ŒåŠ å¥½å‹éœ€è¦å¯¹æ–¹åŒæ„ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸´æ—¶è¡¨å­˜å‚¨å¾…å¤„ç†çš„å¥½å‹è¯·æ±‚ã€‚

```sql
-- å¥½å‹è¯·æ±‚è¡¨
CREATE TABLE friend_requests (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    from_user_id BIGINT NOT NULL COMMENT 'å‘èµ·è¯·æ±‚çš„ç”¨æˆ·ID',
    to_user_id BIGINT NOT NULL COMMENT 'è¢«è¯·æ±‚çš„ç”¨æˆ·ID',
    message VARCHAR(255) DEFAULT '' COMMENT 'è¯·æ±‚æ¶ˆæ¯',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€ï¼š0å¾…å¤„ç† 1åŒæ„ 2æ‹’ç» 3è¿‡æœŸ',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP NULL COMMENT 'å¤„ç†æ—¶é—´',
    
    UNIQUE KEY uk_from_to (from_user_id, to_user_id),
    INDEX idx_to_user_status (to_user_id, status)
) COMMENT='å¥½å‹è¯·æ±‚è¡¨';
```

**å¤„ç†æµç¨‹ç¤ºä¾‹**ï¼š
```sql
-- 1. å‘èµ·å¥½å‹è¯·æ±‚
INSERT INTO friend_requests (from_user_id, to_user_id, message) 
VALUES (1001, 2001, 'ä½ å¥½ï¼Œæˆ‘æ˜¯é€šè¿‡å…±åŒæœ‹å‹è®¤è¯†çš„');

-- 2. åŒæ„å¥½å‹è¯·æ±‚
UPDATE friend_requests 
SET status = 1, processed_at = NOW() 
WHERE from_user_id = 1001 AND to_user_id = 2001;

-- 3. å»ºç«‹åŒå‘å¥½å‹å…³ç³»
INSERT INTO user_friends (user_id, friend_id) VALUES (1001, 2001);
INSERT INTO user_friends (user_id, friend_id) VALUES (2001, 1001);
```

---

## 3. ğŸ‘ï¸ å…³æ³¨ç²‰ä¸æ¨¡å‹


### 3.1 å…³æ³¨å…³ç³»è¡¨è®¾è®¡


**å•å‘å…³æ³¨çš„ç‰¹ç‚¹**ï¼š
å…³æ³¨å…³ç³»æ˜¯å•å‘çš„ï¼Œæˆ‘å…³æ³¨ä½ ä¸ä»£è¡¨ä½ å…³æ³¨æˆ‘ã€‚è¿™ç§æ¨¡å¼é€‚ç”¨äºå¾®åšã€æŠ–éŸ³ç­‰å¹³å°ã€‚

```sql
-- å…³æ³¨å…³ç³»è¡¨
CREATE TABLE user_follows (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    follower_id BIGINT NOT NULL COMMENT 'å…³æ³¨è€…ID',
    following_id BIGINT NOT NULL COMMENT 'è¢«å…³æ³¨è€…ID',
    follow_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'å…³æ³¨æ—¶é—´',
    is_mutual TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦äº’ç›¸å…³æ³¨ï¼š0å¦ 1æ˜¯',
    source VARCHAR(50) DEFAULT '' COMMENT 'å…³æ³¨æ¥æºï¼šæ¨è/æœç´¢/äºŒç»´ç ',
    
    UNIQUE KEY uk_follower_following (follower_id, following_id),
    INDEX idx_follower (follower_id),
    INDEX idx_following (following_id),
    INDEX idx_mutual (is_mutual)
) COMMENT='ç”¨æˆ·å…³æ³¨å…³ç³»è¡¨';
```

**æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **follower_id**ï¼šå…³æ³¨åˆ«äººçš„äºº(ç²‰ä¸)
- **following_id**ï¼šè¢«å…³æ³¨çš„äºº(åšä¸»)
- **is_mutual**ï¼šæ ‡è®°æ˜¯å¦äº’ç›¸å…³æ³¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡

### 3.2 ç²‰ä¸ç»Ÿè®¡è¡¨


**ä¸ºä»€ä¹ˆéœ€è¦ç»Ÿè®¡è¡¨**ï¼š
å½“ç”¨æˆ·å…³æ³¨æ•°å’Œç²‰ä¸æ•°å¾ˆå¤šæ—¶ï¼Œæ¯æ¬¡éƒ½COUNTæŸ¥è¯¢ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥ç”¨å•ç‹¬çš„è¡¨æ¥å­˜å‚¨ç»Ÿè®¡æ•°æ®ã€‚

```sql
-- ç”¨æˆ·ç»Ÿè®¡è¡¨
CREATE TABLE user_stats (
    user_id BIGINT PRIMARY KEY,
    following_count INT DEFAULT 0 COMMENT 'å…³æ³¨æ•°',
    followers_count INT DEFAULT 0 COMMENT 'ç²‰ä¸æ•°',
    mutual_count INT DEFAULT 0 COMMENT 'äº’å…³æ•°',
    posts_count INT DEFAULT 0 COMMENT 'å‘å¸ƒå†…å®¹æ•°',
    likes_count INT DEFAULT 0 COMMENT 'è·å¾—ç‚¹èµæ•°',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='ç”¨æˆ·ç»Ÿè®¡æ•°æ®è¡¨';
```

**ç»Ÿè®¡æ•°æ®ç»´æŠ¤**ï¼š
```sql
-- å…³æ³¨æŸäººæ—¶æ›´æ–°ç»Ÿè®¡
-- æ›´æ–°å…³æ³¨è€…çš„å…³æ³¨æ•° +1
UPDATE user_stats SET following_count = following_count + 1 
WHERE user_id = 1001;

-- æ›´æ–°è¢«å…³æ³¨è€…çš„ç²‰ä¸æ•° +1  
UPDATE user_stats SET followers_count = followers_count + 1 
WHERE user_id = 2001;
```

---

## 4. ğŸ”„ åŒå‘å…³ç³»å­˜å‚¨ç­–ç•¥


### 4.1 å­˜å‚¨æ–¹æ¡ˆå¯¹æ¯”


**æ–¹æ¡ˆä¸€ï¼šå•æ¡è®°å½•å­˜å‚¨**
```sql
-- åªå­˜ä¸€æ¡è®°å½•ï¼Œuser_idå§‹ç»ˆå°äºfriend_id
INSERT INTO friends (user_id, friend_id) 
VALUES (LEAST(1001, 2001), GREATEST(1001, 2001));
```

**æ–¹æ¡ˆäºŒï¼šåŒæ¡è®°å½•å­˜å‚¨**
```sql
-- å­˜å‚¨ä¸¤æ¡è®°å½•ï¼Œä¾¿äºæŸ¥è¯¢
INSERT INTO friends (user_id, friend_id) VALUES (1001, 2001);
INSERT INTO friends (user_id, friend_id) VALUES (2001, 1001);
```

**æ–¹æ¡ˆå¯¹æ¯”åˆ†æ**ï¼š

| å­˜å‚¨æ–¹æ¡ˆ | ç©ºé—´å ç”¨ | æŸ¥è¯¢æ•ˆç‡ | ç»´æŠ¤å¤æ‚åº¦ | æ¨èåœºæ™¯ |
|----------|----------|----------|------------|----------|
| **å•æ¡è®°å½•** | èŠ‚çœ50%ç©ºé—´ | æŸ¥è¯¢éœ€è¦ORæ¡ä»¶ | è¾ƒå¤æ‚ | å­˜å‚¨æ•æ„Ÿåœºæ™¯ |
| **åŒæ¡è®°å½•** | å ç”¨2å€ç©ºé—´ | æŸ¥è¯¢ç®€å•ç›´æ¥ | ç®€å• | **æ¨èä½¿ç”¨** |

> **ğŸ’¡ æ¨èæ–¹æ¡ˆ**ï¼šä½¿ç”¨åŒæ¡è®°å½•å­˜å‚¨ï¼Œå› ä¸ºç°ä»£å­˜å‚¨æˆæœ¬ä½ï¼Œä½†æŸ¥è¯¢æ•ˆç‡å¾ˆé‡è¦

### 4.2 åŒå‘å…³ç³»æŸ¥è¯¢ä¼˜åŒ–


**æŸ¥æ‰¾æˆ‘çš„æ‰€æœ‰å¥½å‹**ï¼š
```sql
-- æ–¹æ¡ˆäºŒçš„ç®€å•æŸ¥è¯¢
SELECT friend_id FROM user_friends 
WHERE user_id = 1001 AND status = 1;

-- æ–¹æ¡ˆä¸€éœ€è¦å¤æ‚æŸ¥è¯¢
SELECT CASE 
    WHEN user_id = 1001 THEN friend_id 
    ELSE user_id 
END AS friend_id
FROM friends 
WHERE (user_id = 1001 OR friend_id = 1001) AND status = 1;
```

---

## 5. ğŸ” å…³ç³»é“¾æŸ¥è¯¢ä¼˜åŒ–


### 5.1 å¸¸è§æŸ¥è¯¢åœºæ™¯


**æ ¸å¿ƒæŸ¥è¯¢éœ€æ±‚**ï¼š
- æŸ¥æ‰¾å…±åŒå¥½å‹
- æŸ¥æ‰¾äºŒåº¦å¥½å‹(æœ‹å‹çš„æœ‹å‹)
- åˆ¤æ–­ä¸¤äººå…³ç³»çŠ¶æ€
- æ¨èå¯èƒ½è®¤è¯†çš„äºº

### 5.2 å…±åŒå¥½å‹æŸ¥è¯¢


**æŸ¥è¯¢é€»è¾‘**ï¼šæ‰¾åˆ°æ—¢æ˜¯Açš„å¥½å‹ï¼Œä¹Ÿæ˜¯Bçš„å¥½å‹çš„äºº

```sql
-- æŸ¥æ‰¾ç”¨æˆ·1001å’Œ2001çš„å…±åŒå¥½å‹
SELECT f1.friend_id as common_friend_id,
       u.nickname
FROM user_friends f1
INNER JOIN user_friends f2 ON f1.friend_id = f2.friend_id
INNER JOIN users u ON f1.friend_id = u.id
WHERE f1.user_id = 1001 
  AND f2.user_id = 2001
  AND f1.status = 1 
  AND f2.status = 1
ORDER BY f1.created_at DESC;
```

### 5.3 äºŒåº¦å¥½å‹æŸ¥è¯¢


**äºŒåº¦å¥½å‹**ï¼šæœ‹å‹çš„æœ‹å‹ï¼Œä½†ä¸æ˜¯æˆ‘çš„ç›´æ¥å¥½å‹

```sql
-- æŸ¥æ‰¾äºŒåº¦å¥½å‹(å¯èƒ½è®¤è¯†çš„äºº)
SELECT DISTINCT f2.friend_id as suggested_friend_id,
       COUNT(*) as mutual_friends_count
FROM user_friends f1
INNER JOIN user_friends f2 ON f1.friend_id = f2.user_id
WHERE f1.user_id = 1001 
  AND f2.friend_id != 1001  -- æ’é™¤è‡ªå·±
  AND f1.status = 1 
  AND f2.status = 1
  AND f2.friend_id NOT IN (  -- æ’é™¤å·²ç»æ˜¯å¥½å‹çš„
    SELECT friend_id FROM user_friends 
    WHERE user_id = 1001 AND status = 1
  )
GROUP BY f2.friend_id
HAVING mutual_friends_count >= 2  -- è‡³å°‘2ä¸ªå…±åŒæœ‹å‹
ORDER BY mutual_friends_count DESC
LIMIT 10;
```

### 5.4 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**ç´¢å¼•ä¼˜åŒ–**ï¼š
```sql
-- åˆ›å»ºå¤åˆç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆç‡
CREATE INDEX idx_user_status_created ON user_friends(user_id, status, created_at);
CREATE INDEX idx_friend_status ON user_friends(friend_id, status);
```

**åˆ†é¡µæŸ¥è¯¢**ï¼š
```sql
-- å¥½å‹åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢
SELECT f.friend_id, u.nickname, u.avatar, f.created_at
FROM user_friends f
INNER JOIN users u ON f.friend_id = u.id  
WHERE f.user_id = 1001 AND f.status = 1
ORDER BY f.created_at DESC
LIMIT 20 OFFSET 0;
```

---

## 6. ğŸš« é»‘åå•ç®¡ç†æœºåˆ¶


### 6.1 é»‘åå•è¡¨è®¾è®¡


**é»‘åå•çš„ä½œç”¨**ï¼š
- å±è”½éªšæ‰°ç”¨æˆ·
- éšç§ä¿æŠ¤
- é˜²æ­¢æ¶æ„è¡Œä¸º

```sql
-- é»‘åå•è¡¨
CREATE TABLE user_blacklist (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    blocked_user_id BIGINT NOT NULL COMMENT 'è¢«å±è”½ç”¨æˆ·ID',
    block_type TINYINT DEFAULT 1 COMMENT 'å±è”½ç±»å‹ï¼š1å®Œå…¨å±è”½ 2ä»…å±è”½æ¶ˆæ¯',
    block_reason VARCHAR(255) DEFAULT '' COMMENT 'å±è”½åŸå› ',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_blocked (user_id, blocked_user_id),
    INDEX idx_blocked_user (blocked_user_id)
) COMMENT='ç”¨æˆ·é»‘åå•è¡¨';
```

### 6.2 é»‘åå•ä¸šåŠ¡é€»è¾‘


**æ‹‰é»‘ç”¨æˆ·çš„å¤„ç†æµç¨‹**ï¼š
```sql
-- 1. æ·»åŠ åˆ°é»‘åå•
INSERT INTO user_blacklist (user_id, blocked_user_id, block_reason) 
VALUES (1001, 2001, 'å‘é€åƒåœ¾ä¿¡æ¯');

-- 2. åˆ é™¤å¥½å‹å…³ç³»(å¦‚æœå­˜åœ¨)
UPDATE user_friends 
SET status = 3  -- 3è¡¨ç¤ºæ‹‰é»‘çŠ¶æ€
WHERE (user_id = 1001 AND friend_id = 2001) 
   OR (user_id = 2001 AND friend_id = 1001);

-- 3. å–æ¶ˆå…³æ³¨å…³ç³»
DELETE FROM user_follows 
WHERE (follower_id = 1001 AND following_id = 2001)
   OR (follower_id = 2001 AND following_id = 1001);
```

**æ£€æŸ¥æ˜¯å¦è¢«æ‹‰é»‘**ï¼š
```sql
-- åœ¨æ‰§è¡Œå…³æ³¨ã€å‘æ¶ˆæ¯ç­‰æ“ä½œå‰æ£€æŸ¥
SELECT 1 FROM user_blacklist 
WHERE user_id = 2001 AND blocked_user_id = 1001 
LIMIT 1;
```

---

## 7. ğŸ¤– å…³ç³»æ¨èç®—æ³•


### 7.1 æ¨èç®—æ³•åŸºç¡€


**æ¨èçš„æ ¸å¿ƒæ€è·¯**ï¼š
- åŸºäºå…±åŒå¥½å‹æ¨è
- åŸºäºè”ç³»äººå¯¼å…¥æ¨è  
- åŸºäºåœ°ç†ä½ç½®æ¨è
- åŸºäºå…´è¶£æ ‡ç­¾æ¨è

### 7.2 å…±åŒå¥½å‹æ¨èå®ç°


```sql
-- æ¨èç®—æ³•è¡¨ï¼šå­˜å‚¨æ¨èç»“æœ
CREATE TABLE friend_recommendations (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    recommended_user_id BIGINT NOT NULL,
    score DECIMAL(5,2) DEFAULT 0 COMMENT 'æ¨èåˆ†æ•°',
    reason VARCHAR(255) COMMENT 'æ¨èç†ç”±',
    mutual_friends_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_recommended (user_id, recommended_user_id),
    INDEX idx_user_score (user_id, score DESC)
) COMMENT='å¥½å‹æ¨èè¡¨';
```

**æ¨èåˆ†æ•°è®¡ç®—**ï¼š
```sql
-- è®¡ç®—æ¨èåˆ†æ•°çš„ç¤ºä¾‹é€»è¾‘
INSERT INTO friend_recommendations (user_id, recommended_user_id, score, reason, mutual_friends_count)
SELECT 
    1001 as user_id,
    candidate_id as recommended_user_id,
    -- æ¨èåˆ†æ•°è®¡ç®—å…¬å¼
    (mutual_friends_count * 10 + 
     same_city_bonus * 5 + 
     same_company_bonus * 8) as score,
    CONCAT('ä½ ä»¬æœ‰', mutual_friends_count, 'ä¸ªå…±åŒå¥½å‹') as reason,
    mutual_friends_count
FROM (
    -- å€™é€‰äººè®¡ç®—é€»è¾‘
    SELECT 
        f2.friend_id as candidate_id,
        COUNT(*) as mutual_friends_count,
        -- å…¶ä»–æ¨èå› å­...
        0 as same_city_bonus,
        0 as same_company_bonus
    FROM user_friends f1
    INNER JOIN user_friends f2 ON f1.friend_id = f2.user_id  
    WHERE f1.user_id = 1001 AND f1.status = 1 AND f2.status = 1
    GROUP BY f2.friend_id
    HAVING mutual_friends_count >= 2
) t
ORDER BY score DESC
LIMIT 50;
```

---

## 8. ğŸ“ ç¤¾äº¤è·ç¦»è®¡ç®—


### 8.1 ç¤¾äº¤è·ç¦»çš„æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ç¤¾äº¤è·ç¦»**ï¼š
ç¤¾äº¤è·ç¦»æ˜¯æŒ‡ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´é€šè¿‡å…³ç³»é“¾è¿æ¥æ‰€éœ€è¦çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚æ¯”å¦‚Aå’ŒBæ˜¯å¥½å‹(è·ç¦»1)ï¼ŒAå’ŒCæ˜¯å¥½å‹ï¼ŒCå’ŒDæ˜¯å¥½å‹ï¼Œé‚£ä¹ˆAå’ŒDçš„è·ç¦»æ˜¯2ã€‚

```
ç¤¾äº¤è·ç¦»ç¤ºä¾‹ï¼š

    A â†â†’ B â†â†’ C â†â†’ D
    |         |
    â””â”€â”€â”€â”€Eâ”€â”€â”€â”€â”˜

Aåˆ°B: è·ç¦»1 (ç›´æ¥å¥½å‹)  
Aåˆ°C: è·ç¦»2 (é€šè¿‡B)
Aåˆ°D: è·ç¦»3 (é€šè¿‡Bâ†’C)  
Aåˆ°E: è·ç¦»2 (é€šè¿‡C)
```

### 8.2 è·ç¦»è®¡ç®—å®ç°


**å¹¿åº¦ä¼˜å…ˆæœç´¢ç®—æ³•**ï¼š
```sql
-- ç¤¾äº¤è·ç¦»è¡¨(é¢„è®¡ç®—ç»“æœ)
CREATE TABLE social_distances (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    target_user_id BIGINT NOT NULL,  
    distance TINYINT NOT NULL COMMENT 'ç¤¾äº¤è·ç¦»ï¼š1-6',
    path_count INT DEFAULT 1 COMMENT 'è·¯å¾„æ•°é‡',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_target (user_id, target_user_id),
    INDEX idx_distance (distance)
) COMMENT='ç¤¾äº¤è·ç¦»ç¼“å­˜è¡¨';
```

**åˆ†å±‚æŸ¥è¯¢è·ç¦»**ï¼š
```sql
-- æŸ¥æ‰¾è·ç¦»ä¸º2çš„æ‰€æœ‰ç”¨æˆ·
WITH RECURSIVE social_path AS (
  -- è·ç¦»1ï¼šç›´æ¥å¥½å‹
  SELECT friend_id as target_user, 1 as distance
  FROM user_friends 
  WHERE user_id = 1001 AND status = 1
  
  UNION ALL
  
  -- è·ç¦»2ï¼šæœ‹å‹çš„æœ‹å‹  
  SELECT f.friend_id as target_user, sp.distance + 1
  FROM social_path sp
  JOIN user_friends f ON sp.target_user = f.user_id
  WHERE sp.distance < 3 AND f.status = 1
    AND f.friend_id != 1001  -- æ’é™¤è‡ªå·±
)
SELECT target_user, MIN(distance) as min_distance
FROM social_path
GROUP BY target_user
ORDER BY min_distance, target_user;
```

---

## 9. ğŸ“Š å›¾æ•°æ®åº“åº”ç”¨


### 9.1 ä¸ºä»€ä¹ˆéœ€è¦å›¾æ•°æ®åº“


**ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„é™åˆ¶**ï¼š
- å¤æ‚å…³ç³»æŸ¥è¯¢æ€§èƒ½å·®
- å¤šå±‚å…³ç³»åˆ†æå›°éš¾  
- å®æ—¶æ¨èè®¡ç®—æ…¢
- æ‰©å±•æ€§æœ‰é™

**å›¾æ•°æ®åº“çš„ä¼˜åŠ¿**ï¼š
- å¤©ç„¶é€‚åˆå­˜å‚¨å…³ç³»
- å›¾ç®—æ³•ä¸°å¯Œ  
- æŸ¥è¯¢æ€§èƒ½ä¼˜ç§€
- ä¾¿äºç¤¾äº¤åˆ†æ

### 9.2 Neo4jåœ¨ç¤¾äº¤å…³ç³»ä¸­çš„åº”ç”¨


**åŸºæœ¬æ•°æ®æ¨¡å‹**ï¼š
```cypher
-- åˆ›å»ºç”¨æˆ·èŠ‚ç‚¹
CREATE (u:User {id: 1001, name: 'Alice', age: 25})
CREATE (u:User {id: 2001, name: 'Bob', age: 28})

-- åˆ›å»ºå…³æ³¨å…³ç³»
MATCH (a:User {id: 1001}), (b:User {id: 2001})
CREATE (a)-[:FOLLOWS {since: '2024-01-01'}]->(b)

-- åˆ›å»ºå¥½å‹å…³ç³»  
MATCH (a:User {id: 1001}), (b:User {id: 2001})
CREATE (a)-[:FRIENDS {since: '2024-01-01', intimacy: 80}]->(b)
```

**å¤æ‚æŸ¥è¯¢ç¤ºä¾‹**ï¼š
```cypher
-- æŸ¥æ‰¾å…±åŒå¥½å‹
MATCH (me:User {id: 1001})-[:FRIENDS]-(mutual)-[:FRIENDS]-(friend:User {id: 2001})
RETURN mutual.name, mutual.id

-- æ¨èå¯èƒ½è®¤è¯†çš„äºº(2åº¦å¥½å‹)
MATCH (me:User {id: 1001})-[:FRIENDS]-(:User)-[:FRIENDS]-(suggestion:User)
WHERE NOT (me)-[:FRIENDS]-(suggestion) 
  AND me <> suggestion
RETURN suggestion.name, COUNT(*) as mutualFriends
ORDER BY mutualFriends DESC LIMIT 10
```

### 9.3 æ··åˆæ¶æ„è®¾è®¡


**MySQL + Neo4jæ··åˆæ–¹æ¡ˆ**ï¼š
```
æ•°æ®å­˜å‚¨æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MySQL       â”‚    â”‚     Neo4j       â”‚
â”‚   (ä¸»è¦æ•°æ®)    â”‚    â”‚   (å…³ç³»è®¡ç®—)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚â€¢ ç”¨æˆ·åŸºæœ¬ä¿¡æ¯   â”‚    â”‚â€¢ ç”¨æˆ·å…³ç³»å›¾è°±   â”‚
â”‚â€¢ å†…å®¹æ•°æ®       â”‚    â”‚â€¢ ç¤¾äº¤ç½‘ç»œåˆ†æ   â”‚  
â”‚â€¢ ç»Ÿè®¡æ•°æ®       â”‚    â”‚â€¢ æ¨èç®—æ³•è®¡ç®—   â”‚
â”‚â€¢ ä¸šåŠ¡é€»è¾‘       â”‚    â”‚â€¢ å½±å“åŠ›åˆ†æ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€[æ•°æ®åŒæ­¥]â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ğŸ”¬ ç¤¾äº¤ç½‘ç»œåˆ†æ


### 10.1 å…³ç³»å¼ºåº¦è®¡ç®—


**å…³ç³»å¼ºåº¦çš„å½±å“å› ç´ **ï¼š
- äº’åŠ¨é¢‘ç‡(ç‚¹èµã€è¯„è®ºã€ç§ä¿¡)
- å…±åŒå¥½å‹æ•°é‡
- å…³ç³»æŒç»­æ—¶é—´
- åœ°ç†ä½ç½®æ¥è¿‘åº¦

```sql
-- å…³ç³»å¼ºåº¦è¡¨
CREATE TABLE relationship_strength (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    friend_id BIGINT NOT NULL,
    strength_score DECIMAL(5,2) DEFAULT 0 COMMENT 'å…³ç³»å¼ºåº¦åˆ†æ•°(0-100)',
    interaction_count INT DEFAULT 0 COMMENT 'äº’åŠ¨æ¬¡æ•°',
    last_interaction_time TIMESTAMP NULL COMMENT 'æœ€åäº’åŠ¨æ—¶é—´',
    common_friends_count INT DEFAULT 0 COMMENT 'å…±åŒå¥½å‹æ•°',
    relationship_days INT DEFAULT 0 COMMENT 'å…³ç³»å¤©æ•°',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_user_friend (user_id, friend_id),
    INDEX idx_strength (strength_score DESC)
) COMMENT='å…³ç³»å¼ºåº¦è¡¨';
```

**å¼ºåº¦è®¡ç®—å…¬å¼**ï¼š
```sql
-- æ›´æ–°å…³ç³»å¼ºåº¦çš„è®¡ç®—é€»è¾‘
UPDATE relationship_strength rs
SET 
    strength_score = (
        -- äº’åŠ¨é¢‘ç‡æƒé‡(40%)
        LEAST(rs.interaction_count / 10.0, 40) +
        -- å…³ç³»æ—¶é•¿æƒé‡(20%) 
        LEAST(rs.relationship_days / 30.0, 20) +
        -- å…±åŒå¥½å‹æƒé‡(20%)
        LEAST(rs.common_friends_count * 2.0, 20) +
        -- æœ€è¿‘äº’åŠ¨æƒé‡(20%)
        CASE 
            WHEN rs.last_interaction_time > DATE_SUB(NOW(), INTERVAL 7 DAY) THEN 20
            WHEN rs.last_interaction_time > DATE_SUB(NOW(), INTERVAL 30 DAY) THEN 10  
            ELSE 0
        END
    ),
    updated_at = NOW()
WHERE user_id = 1001;
```

### 10.2 å½±å“åŠ›ä¼ æ’­æ¨¡å‹


**ç”¨æˆ·å½±å“åŠ›è®¡ç®—**ï¼š
```sql
-- ç”¨æˆ·å½±å“åŠ›è¡¨
CREATE TABLE user_influence (
    user_id BIGINT PRIMARY KEY,
    influence_score DECIMAL(8,2) DEFAULT 0 COMMENT 'å½±å“åŠ›åˆ†æ•°',
    local_influence DECIMAL(8,2) DEFAULT 0 COMMENT 'å±€éƒ¨å½±å“åŠ›',
    global_influence DECIMAL(8,2) DEFAULT 0 COMMENT 'å…¨å±€å½±å“åŠ›',
    active_followers_count INT DEFAULT 0 COMMENT 'æ´»è·ƒç²‰ä¸æ•°',
    content_viral_rate DECIMAL(5,4) DEFAULT 0 COMMENT 'å†…å®¹ä¼ æ’­ç‡',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_influence (influence_score DESC)
) COMMENT='ç”¨æˆ·å½±å“åŠ›è¡¨';
```

**PageRankç®—æ³•ç®€åŒ–å®ç°**ï¼š
```sql
-- ç®€åŒ–çš„å½±å“åŠ›ä¼ æ’­è®¡ç®—
-- ç”¨æˆ·çš„å½±å“åŠ› = è‡ªèº«æƒé‡ + è¢«å½±å“åŠ›ç”¨æˆ·å…³æ³¨çš„æƒé‡ä¼ é€’
UPDATE user_influence ui
SET influence_score = (
    -- åŸºç¡€åˆ†æ•°ï¼šç²‰ä¸æ•° * æ´»è·ƒåº¦
    (ui.active_followers_count * 0.1) + 
    -- ä¼ æ’­åˆ†æ•°ï¼šå†…å®¹ç—…æ¯’å¼ä¼ æ’­èƒ½åŠ›
    (ui.content_viral_rate * 1000) +
    -- ç½‘ç»œåˆ†æ•°ï¼šæ¥è‡ªå…³æ³¨è€…çš„å½±å“åŠ›ä¼ é€’
    COALESCE((
        SELECT SUM(ui2.influence_score * 0.15) 
        FROM user_follows uf
        JOIN user_influence ui2 ON uf.follower_id = ui2.user_id
        WHERE uf.following_id = ui.user_id
    ), 0)
);
```

---

## 11. âš¡ å¤§è§„æ¨¡å¤„ç†ä¼˜åŒ–


### 11.1 æ•°æ®åˆ†ç‰‡ç­–ç•¥


**ç”¨æˆ·åˆ†ç‰‡æ–¹æ¡ˆ**ï¼š
```sql
-- æŒ‰ç”¨æˆ·IDåˆ†ç‰‡çš„ç¤ºä¾‹
-- ç”¨æˆ·1001çš„æ•°æ®å­˜å‚¨åœ¨ shard_1 (1001 % 4 = 1)
-- ç”¨æˆ·2002çš„æ•°æ®å­˜å‚¨åœ¨ shard_2 (2002 % 4 = 2)

-- åˆ†ç‰‡è¡¨å‘½å
user_friends_0  -- å­˜å‚¨ user_id % 4 = 0 çš„æ•°æ®
user_friends_1  -- å­˜å‚¨ user_id % 4 = 1 çš„æ•°æ®  
user_friends_2  -- å­˜å‚¨ user_id % 4 = 2 çš„æ•°æ®
user_friends_3  -- å­˜å‚¨ user_id % 4 = 3 çš„æ•°æ®
```

**è·¨åˆ†ç‰‡æŸ¥è¯¢å¤„ç†**ï¼š
```python
# Pythonç¤ºä¾‹ï¼šåˆ†ç‰‡æŸ¥è¯¢é€»è¾‘
def get_user_friends(user_id):
    shard_num = user_id % 4
    table_name = f"user_friends_{shard_num}"
    
    sql = f"""
    SELECT friend_id FROM {table_name}
    WHERE user_id = %s AND status = 1
    """
    return db.query(sql, [user_id])
```

### 11.2 ç¼“å­˜ç­–ç•¥ä¼˜åŒ–


**å¤šçº§ç¼“å­˜æ¶æ„**ï¼š
```
ç¼“å­˜å±‚æ¬¡ç»“æ„ï¼š

åº”ç”¨å±‚ç¼“å­˜(æœ¬åœ°)
      â†“
Redisç¼“å­˜(åˆ†å¸ƒå¼)  
      â†“
MySQLè¯»ä»åº“
      â†“  
MySQLä¸»åº“
```

**ç¼“å­˜è®¾è®¡ç¤ºä¾‹**ï¼š
```python
# å¥½å‹åˆ—è¡¨ç¼“å­˜ç­–ç•¥
def get_friends_list(user_id, page=1, size=20):
    cache_key = f"friends_list:{user_id}:{page}:{size}"
    
    # 1. å…ˆæŸ¥æœ¬åœ°ç¼“å­˜
    result = local_cache.get(cache_key)
    if result:
        return result
    
    # 2. æŸ¥Redisç¼“å­˜  
    result = redis_client.get(cache_key)
    if result:
        local_cache.set(cache_key, result, 300)  # æœ¬åœ°ç¼“å­˜5åˆ†é’Ÿ
        return json.loads(result)
    
    # 3. æŸ¥æ•°æ®åº“
    result = db.query("""
        SELECT friend_id, nickname, avatar 
        FROM user_friends f 
        JOIN users u ON f.friend_id = u.id
        WHERE f.user_id = %s AND f.status = 1
        ORDER BY f.created_at DESC
        LIMIT %s OFFSET %s
    """, [user_id, size, (page-1)*size])
    
    # 4. å†™å…¥ç¼“å­˜
    redis_client.setex(cache_key, 1800, json.dumps(result))  # Redisç¼“å­˜30åˆ†é’Ÿ
    local_cache.set(cache_key, result, 300)  # æœ¬åœ°ç¼“å­˜5åˆ†é’Ÿ
    
    return result
```

### 11.3 å¼‚æ­¥å¤„ç†æœºåˆ¶


**å…³ç³»å˜æ›´çš„å¼‚æ­¥å¤„ç†**ï¼š
```sql
-- å…³ç³»å˜æ›´äº‹ä»¶è¡¨
CREATE TABLE relationship_events (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    event_type VARCHAR(50) NOT NULL COMMENT 'äº‹ä»¶ç±»å‹ï¼šfollow/unfollow/friend/unfriend',
    user_id BIGINT NOT NULL,
    target_user_id BIGINT NOT NULL,
    event_data JSON COMMENT 'äº‹ä»¶è¯¦ç»†æ•°æ®',
    processed TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²å¤„ç†',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_processed_created (processed, created_at)
) COMMENT='å…³ç³»å˜æ›´äº‹ä»¶è¡¨';
```

**äº‹ä»¶é©±åŠ¨å¤„ç†æµç¨‹**ï¼š
```
å…³ç³»å˜æ›´æµç¨‹ï¼š

ç”¨æˆ·æ“ä½œ â†’ å†™å…¥äº‹ä»¶è¡¨ â†’ ç«‹å³è¿”å›æˆåŠŸ
    â†“
å¼‚æ­¥å¤„ç†å™¨ â†’ æ›´æ–°ç»Ÿè®¡æ•°æ®
    â†“           â†“
  æ›´æ–°æ¨è    æ¸…ç†ç¼“å­˜
    â†“           â†“
  å‘é€é€šçŸ¥    æ›´æ–°ç´¢å¼•
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„è®¾è®¡åŸåˆ™


```
ğŸ”¸ å…³ç³»å­˜å‚¨ï¼šåŒå‘å…³ç³»ç”¨åŒæ¡è®°å½•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
ğŸ”¸ çŠ¶æ€ç®¡ç†ï¼šç”¨æ•°å­—çŠ¶æ€ç ç®¡ç†å…³ç³»ç”Ÿå‘½å‘¨æœŸ  
ğŸ”¸ ç´¢å¼•ä¼˜åŒ–ï¼šåˆç†åˆ›å»ºå¤åˆç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
ğŸ”¸ ç»Ÿè®¡åˆ†ç¦»ï¼šå¤§æ•°æ®é‡ç»Ÿè®¡å•ç‹¬å­˜å‚¨ï¼Œé¿å…å®æ—¶è®¡ç®—
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šå¤šçº§ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
ğŸ”¸ å¼‚æ­¥å¤„ç†ï¼šéæ ¸å¿ƒæ“ä½œå¼‚æ­¥åŒ–ï¼Œæå‡å“åº”é€Ÿåº¦
```

### 12.2 æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡è¦ç‚¹


**åŸºç¡€å…³ç³»è¡¨**ï¼š
- `user_friends`ï¼šå­˜å‚¨å¥½å‹å…³ç³»ï¼Œæ”¯æŒçŠ¶æ€ç®¡ç†
- `user_follows`ï¼šå­˜å‚¨å…³æ³¨å…³ç³»ï¼Œæ ‡è®°äº’å…³çŠ¶æ€  
- `friend_requests`ï¼šä¸´æ—¶å­˜å‚¨å¥½å‹ç”³è¯·
- `user_blacklist`ï¼šé»‘åå•ç®¡ç†

**è¾…åŠ©åˆ†æè¡¨**ï¼š
- `user_stats`ï¼šç”¨æˆ·ç»Ÿè®¡æ•°æ®ç¼“å­˜
- `relationship_strength`ï¼šå…³ç³»å¼ºåº¦è®¡ç®—ç»“æœ
- `friend_recommendations`ï¼šæ¨èç®—æ³•ç»“æœç¼“å­˜
- `social_distances`ï¼šç¤¾äº¤è·ç¦»é¢„è®¡ç®—ç»“æœ

### 12.3 æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹


**æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥**ï¼š
```sql
-- 1. åˆç†åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_status_time ON user_friends(user_id, status, created_at);

-- 2. é¿å…æ·±åº¦é€’å½’æŸ¥è¯¢
-- ä¸è¦è¶…è¿‡3åº¦å…³ç³»æŸ¥è¯¢ï¼Œä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜

-- 3. ä½¿ç”¨LIMITæ§åˆ¶ç»“æœé›†
SELECT * FROM user_friends WHERE user_id = ? LIMIT 100;

-- 4. é¢„è®¡ç®—å¤æ‚ç»“æœ
-- å…±åŒå¥½å‹ã€æ¨èç”¨æˆ·ç­‰å®šæœŸè®¡ç®—å­˜å‚¨
```

### 12.4 æ‰©å±•æ€§è®¾è®¡è€ƒè™‘


**æ•°æ®é‡å¢é•¿åº”å¯¹**ï¼š
- **åˆ†åº“åˆ†è¡¨**ï¼šæŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†ç‰‡
- **è¯»å†™åˆ†ç¦»**ï¼šæŸ¥è¯¢èµ°ä»åº“ï¼Œå†™å…¥èµ°ä¸»åº“
- **å›¾æ•°æ®åº“**ï¼šå¤æ‚å…³ç³»åˆ†æç”¨Neo4j
- **ç¼“å­˜ç­–ç•¥**ï¼šçƒ­ç‚¹æ•°æ®å¤šçº§ç¼“å­˜

**ä¸šåŠ¡åŠŸèƒ½æ‰©å±•**ï¼š
- **ç¾¤ç»„å…³ç³»**ï¼šæ‰©å±•æ”¯æŒç¾¤èŠã€åœˆå­
- **æ ‡ç­¾ç³»ç»Ÿ**ï¼šåŸºäºå…´è¶£çš„å…³ç³»æ¨è
- **åœ°ç†ä½ç½®**ï¼šLBSç›¸å…³çš„å…³ç³»å‘ç°
- **å®æ—¶æ¨é€**ï¼šå…³ç³»å˜æ›´çš„å®æ—¶é€šçŸ¥

### 12.5 å¼€å‘å®è·µå»ºè®®


**ä»£ç å±‚é¢**ï¼š
- å°è£…å…³ç³»æ“ä½œä¸ºç‹¬ç«‹æœåŠ¡
- ä½¿ç”¨äº‹åŠ¡ä¿è¯å…³ç³»ä¸€è‡´æ€§
- å®ç°å¹‚ç­‰æ€§ï¼Œé¿å…é‡å¤æ“ä½œ
- åšå¥½å¼‚å¸¸å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

**ç›‘æ§è¿ç»´**ï¼š
- ç›‘æ§å…³ç³»å¢é•¿é€Ÿåº¦å’Œåˆ†å¸ƒ
- å…³æ³¨æŸ¥è¯¢æ€§èƒ½å’Œæ…¢SQL
- å®šæœŸæ¸…ç†æ— æ•ˆå’Œè¿‡æœŸæ•°æ®
- å¤‡ä»½æ ¸å¿ƒå…³ç³»æ•°æ®

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ç¤¾äº¤å…³ç³»è®¾è®¡æœ‰é—¨é“ï¼ŒåŒå‘å­˜å‚¨æŸ¥è¯¢å¥½
çŠ¶æ€ç®¡ç†è¦ç²¾ç»†ï¼Œç´¢å¼•ä¼˜åŒ–æ€§èƒ½é«˜  
ç»Ÿè®¡åˆ†ç¦»é¿å®æ—¶ï¼Œç¼“å­˜ç­–ç•¥å‹åŠ›å°
å¼‚æ­¥å¤„ç†æå“åº”ï¼Œåˆ†ç‰‡æ‰©å±•æ’‘å¾—ç‰¢
æ¨èç®—æ³•é æ•°æ®ï¼Œå›¾åº“åˆ†ææ•ˆæœå¥½
```