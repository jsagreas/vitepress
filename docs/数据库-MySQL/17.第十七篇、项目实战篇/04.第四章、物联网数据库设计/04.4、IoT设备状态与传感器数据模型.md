---
title: 4ã€IoTè®¾å¤‡çŠ¶æ€ä¸ä¼ æ„Ÿå™¨æ•°æ®æ¨¡å‹
---
## ğŸ“š ç›®å½•

1. [IoTæ•°æ®åº“è®¾è®¡åŸºç¡€æ¦‚å¿µ](#1-IoTæ•°æ®åº“è®¾è®¡åŸºç¡€æ¦‚å¿µ)
2. [è®¾å¤‡çŠ¶æ€ç®¡ç†æ¨¡å‹](#2-è®¾å¤‡çŠ¶æ€ç®¡ç†æ¨¡å‹)
3. [ä¼ æ„Ÿå™¨æ•°æ®ç»“æ„è®¾è®¡](#3-ä¼ æ„Ÿå™¨æ•°æ®ç»“æ„è®¾è®¡)
4. [å¤šç»´åº¦æ•°æ®æ¨¡å‹](#4-å¤šç»´åº¦æ•°æ®æ¨¡å‹)
5. [æ•°æ®è´¨é‡ç®¡æ§ä½“ç³»](#5-æ•°æ®è´¨é‡ç®¡æ§ä½“ç³»)
6. [ä¼ æ„Ÿå™¨æ•°æ®èåˆä¸æ™ºèƒ½å¤„ç†](#6-ä¼ æ„Ÿå™¨æ•°æ®èåˆä¸æ™ºèƒ½å¤„ç†)
7. [å¼‚æ„è®¾å¤‡é€‚é…ç­–ç•¥](#7-å¼‚æ„è®¾å¤‡é€‚é…ç­–ç•¥)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ IoTæ•°æ®åº“è®¾è®¡åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯IoTæ•°æ®åº“è®¾è®¡


**ğŸ’¡ é€šä¿—ç†è§£**
æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½å·¥å‚ï¼Œé‡Œé¢æœ‰æˆåƒä¸Šä¸‡ä¸ªä¼ æ„Ÿå™¨ï¼šæ¸©åº¦è®¡ã€æ¹¿åº¦è®¡ã€å‹åŠ›è¡¨ã€æ‘„åƒå¤´ç­‰ç­‰ã€‚è¿™äº›è®¾å¤‡æ¯æ—¶æ¯åˆ»éƒ½åœ¨äº§ç”Ÿæ•°æ®ï¼Œå°±åƒäººçš„å¿ƒè·³ä¸€æ ·ä¸åœåœ°å‘æ•°æ®åº“"æ±‡æŠ¥"è‡ªå·±çš„çŠ¶æ€ã€‚

IoTæ•°æ®åº“è®¾è®¡å°±æ˜¯è¦è§£å†³ï¼š
- **æµ·é‡æ•°æ®å­˜å‚¨**ï¼šå¦‚ä½•å­˜å‚¨æ¯ç§’é’Ÿäº§ç”Ÿçš„å¤§é‡ä¼ æ„Ÿå™¨æ•°æ®
- **è®¾å¤‡çŠ¶æ€ç®¡ç†**ï¼šå¦‚ä½•çŸ¥é“å“ªäº›è®¾å¤‡åœ¨çº¿ã€ç¦»çº¿ã€æ•…éšœ
- **æ•°æ®è´¨é‡ä¿è¯**ï¼šå¦‚ä½•ç¡®ä¿ä¼ æ„Ÿå™¨ä¸ŠæŠ¥çš„æ•°æ®æ˜¯å‡†ç¡®å¯ä¿¡çš„

```
ç°å®åœºæ™¯å¯¹æ¯”ï¼š
ä¼ ç»Ÿåº”ç”¨ â†’ ç”¨æˆ·å¶å°”è®¿é—®ç½‘ç«™ â†’ æ•°æ®é‡å°ä¸”ä¸è§„å¾‹
IoTåº”ç”¨ â†’ è®¾å¤‡æŒç»­ä¸ŠæŠ¥æ•°æ® â†’ æ•°æ®é‡å¤§ä¸”æŒç»­ä¸æ–­

å°±åƒï¼š
ä¼ ç»Ÿ = å¶å°”æœ‰äººæ•²é—¨
IoT  = é—¨å¤–æœ‰ä¸ªè¯ç—¨ä¸€ç›´åœ¨è¯´è¯
```

### 1.2 IoTæ•°æ®çš„æ ¸å¿ƒç‰¹ç‚¹


**ğŸ” æ•°æ®ç‰¹å¾åˆ†æ**

| ç‰¹å¾ | **ä¼ ç»Ÿä¸šåŠ¡æ•°æ®** | **IoTä¼ æ„Ÿå™¨æ•°æ®** | **è®¾è®¡å½±å“** |
|------|---------------|-----------------|------------|
| ğŸ“Š **æ•°æ®é‡** | `ç”¨æˆ·æ“ä½œäº§ç”Ÿ` | `è®¾å¤‡æŒç»­äº§ç”Ÿ` | `éœ€è¦æ—¶åºæ•°æ®åº“ä¼˜åŒ–` |
| â° **æ—¶é—´æ€§** | `ä¸šåŠ¡æ—¶é—´ä¸ºä¸»` | `æ—¶é—´æˆ³æé‡è¦` | `æ—¶é—´ç´¢å¼•å¿…ä¸å¯å°‘` |
| ğŸ”„ **æ›´æ–°é¢‘ç‡** | `ä¸å®šæœŸæ›´æ–°` | `ç§’çº§/åˆ†é’Ÿçº§æ›´æ–°` | `å†™å…¥æ€§èƒ½è¦æ±‚é«˜` |
| ğŸ“ˆ **æŸ¥è¯¢æ¨¡å¼** | `å¤æ‚ä¸šåŠ¡æŸ¥è¯¢` | `æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¸ºä¸»` | `ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢` |
| ğŸ·ï¸ **æ•°æ®ç»“æ„** | `å…³ç³»å‹ä¸ºä¸»` | `é”®å€¼å¯¹+æ—¶åº` | `æ··åˆå­˜å‚¨æ¶æ„` |

---

## 2. ğŸ“± è®¾å¤‡çŠ¶æ€ç®¡ç†æ¨¡å‹


### 2.1 è®¾å¤‡çŠ¶æ€æšä¸¾è®¾è®¡


**ğŸ”¸ åŸºç¡€çŠ¶æ€å®šä¹‰**

è®¾å¤‡çŠ¶æ€å°±åƒäººçš„å¥åº·çŠ¶æ€ä¸€æ ·ï¼Œéœ€è¦ç”¨ç®€å•æ˜ç¡®çš„è¯è¯­æ¥æè¿°å½“å‰æƒ…å†µï¼š

```sql
-- è®¾å¤‡åŸºç¡€çŠ¶æ€æšä¸¾
CREATE TABLE device_status_enum (
    status_code VARCHAR(20) PRIMARY KEY COMMENT 'çŠ¶æ€ä»£ç ',
    status_name VARCHAR(50) NOT NULL COMMENT 'çŠ¶æ€åç§°',
    description TEXT COMMENT 'çŠ¶æ€æè¿°',
    color_code VARCHAR(7) COMMENT 'æ˜¾ç¤ºé¢œè‰²'
);

-- æ ‡å‡†çŠ¶æ€æ•°æ®
INSERT INTO device_status_enum VALUES 
('ONLINE', 'åœ¨çº¿', 'è®¾å¤‡æ­£å¸¸å·¥ä½œï¼Œæ•°æ®æ­£å¸¸ä¸ŠæŠ¥', '#00FF00'),
('OFFLINE', 'ç¦»çº¿', 'è®¾å¤‡æ— æ³•è¿æ¥ï¼Œè¶…è¿‡å¿ƒè·³æ—¶é—´', '#FF0000'),
('FAULT', 'æ•…éšœ', 'è®¾å¤‡å¼‚å¸¸ï¼Œéœ€è¦äººå·¥å¤„ç†', '#FF8C00'),
('MAINTAIN', 'ç»´æŠ¤', 'è®¾å¤‡è¿›å…¥ç»´æŠ¤æ¨¡å¼', '#FFD700'),
('SLEEP', 'ä¼‘çœ ', 'è®¾å¤‡æŒ‰è®¡åˆ’ä¼‘çœ ä»¥èŠ‚çœç”µé‡', '#808080');
```

**ğŸ’¡ çŠ¶æ€è½¬æ¢å…³ç³»**

```
è®¾å¤‡çŠ¶æ€è½¬æ¢æµç¨‹ï¼š
åˆå§‹åŒ– â†’ åœ¨çº¿ â†â†’ ç¦»çº¿
   â†“        â†“      â†“
 ç»´æŠ¤ â†â†’  æ•…éšœ  â†â†’ ä¼‘çœ 

å®é™…æ„ä¹‰ï¼š
- åœ¨çº¿ï¼šè®¾å¤‡æ­£å¸¸ï¼Œå¯ä»¥æ¥æ”¶æ•°æ®
- ç¦»çº¿ï¼šè®¾å¤‡æ–­ç½‘æˆ–å…³æœºï¼Œéœ€è¦æ£€æŸ¥
- æ•…éšœï¼šä¼ æ„Ÿå™¨å¼‚å¸¸ï¼Œæ•°æ®ä¸å¯ä¿¡
- ç»´æŠ¤ï¼šäººå·¥ç»´æŠ¤æœŸé—´ï¼Œæš‚åœç›‘æ§
- ä¼‘çœ ï¼šå®šæ—¶ä¼‘çœ ï¼Œå±äºæ­£å¸¸çŠ¶æ€
```

### 2.2 è®¾å¤‡å±æ€§ç®¡ç†è¡¨


**ğŸ·ï¸ è®¾å¤‡åŸºç¡€ä¿¡æ¯**

æ¯ä¸ªIoTè®¾å¤‡å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œéœ€è¦è®°å½•è¯¦ç»†çš„èº«ä»½ä¿¡æ¯ï¼š

```sql
-- è®¾å¤‡åŸºç¡€ä¿¡æ¯è¡¨
CREATE TABLE iot_devices (
    device_id VARCHAR(64) PRIMARY KEY COMMENT 'è®¾å¤‡å”¯ä¸€æ ‡è¯†',
    device_name VARCHAR(100) NOT NULL COMMENT 'è®¾å¤‡åç§°',
    device_type VARCHAR(50) NOT NULL COMMENT 'è®¾å¤‡ç±»å‹',
    manufacturer VARCHAR(100) COMMENT 'åˆ¶é€ å•†',
    model_number VARCHAR(50) COMMENT 'å‹å·',
    firmware_version VARCHAR(20) COMMENT 'å›ºä»¶ç‰ˆæœ¬',
    location_info JSON COMMENT 'ä½ç½®ä¿¡æ¯',
    install_date DATETIME COMMENT 'å®‰è£…æ—¥æœŸ',
    current_status VARCHAR(20) DEFAULT 'OFFLINE' COMMENT 'å½“å‰çŠ¶æ€',
    last_heartbeat TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æœ€åå¿ƒè·³æ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    INDEX idx_device_type (device_type),
    INDEX idx_current_status (current_status),
    INDEX idx_last_heartbeat (last_heartbeat),
    FOREIGN KEY (current_status) REFERENCES device_status_enum(status_code)
);
```

**ğŸ“ ä½ç½®ä¿¡æ¯JSONç»“æ„**

```json
{
  "building": "Aæ ‹",
  "floor": 3,
  "room": "301",
  "coordinates": {
    "latitude": 39.9042,
    "longitude": 116.4074
  },
  "zone": "ç”Ÿäº§åŒºåŸŸA"
}
```

### 2.3 è®¾å¤‡çŠ¶æ€å†å²è®°å½•


**ğŸ“Š çŠ¶æ€å˜æ›´è¿½è¸ª**

å°±åƒåŒ»é™¢çš„ç—…å†ä¸€æ ·ï¼Œéœ€è¦è®°å½•è®¾å¤‡çš„"å¥åº·å˜åŒ–å²"ï¼š

```sql
-- è®¾å¤‡çŠ¶æ€å†å²è¡¨
CREATE TABLE device_status_history (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL COMMENT 'è®¾å¤‡ID',
    old_status VARCHAR(20) COMMENT 'åŸçŠ¶æ€',
    new_status VARCHAR(20) NOT NULL COMMENT 'æ–°çŠ¶æ€',
    change_reason VARCHAR(200) COMMENT 'çŠ¶æ€å˜æ›´åŸå› ',
    change_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'å˜æ›´æ—¶é—´',
    operator VARCHAR(50) COMMENT 'æ“ä½œäººå‘˜',
    
    INDEX idx_device_time (device_id, change_time),
    INDEX idx_status (new_status),
    FOREIGN KEY (device_id) REFERENCES iot_devices(device_id)
);
```

**ğŸ” å®é™…åº”ç”¨åœºæ™¯**

```sql
-- æŸ¥è¯¢è®¾å¤‡æ•…éšœå†å²ï¼Œåˆ†ææ•…éšœé¢‘ç‡
SELECT 
    device_id,
    COUNT(*) as fault_count,
    AVG(TIMESTAMPDIFF(MINUTE, change_time, 
        LEAD(change_time) OVER (PARTITION BY device_id ORDER BY change_time))) as avg_fault_duration
FROM device_status_history 
WHERE new_status = 'FAULT' 
  AND change_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY device_id
HAVING fault_count > 3;
```

---

## 3. ğŸ“Š ä¼ æ„Ÿå™¨æ•°æ®ç»“æ„è®¾è®¡


### 3.1 ä¼ æ„Ÿå™¨æ•°æ®è¡¨æ ¸å¿ƒè®¾è®¡


**ğŸ”§ æ•°æ®ç»“æ„åˆ†æ**

ä¼ æ„Ÿå™¨æ•°æ®å°±åƒä½“æ£€æŠ¥å‘Šï¼Œæ¯ä¸ªæ£€æµ‹é¡¹ç›®éƒ½æœ‰å…·ä½“çš„æ•°å€¼å’Œå•ä½ï¼š

```sql
-- ä¼ æ„Ÿå™¨æ•°æ®ä¸»è¡¨ï¼ˆæ—¶åºæ•°æ®ï¼‰
CREATE TABLE sensor_data (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL COMMENT 'è®¾å¤‡ID',
    sensor_type VARCHAR(50) NOT NULL COMMENT 'ä¼ æ„Ÿå™¨ç±»å‹',
    measurement_time TIMESTAMP(3) NOT NULL COMMENT 'æµ‹é‡æ—¶é—´(æ¯«ç§’ç²¾åº¦)',
    raw_value DECIMAL(15,6) NOT NULL COMMENT 'åŸå§‹æµ‹é‡å€¼',
    processed_value DECIMAL(15,6) COMMENT 'å¤„ç†åçš„å€¼',
    unit VARCHAR(20) NOT NULL COMMENT 'æµ‹é‡å•ä½',
    data_quality TINYINT DEFAULT 100 COMMENT 'æ•°æ®è´¨é‡è¯„åˆ†(0-100)',
    is_anomaly BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å¼‚å¸¸æ•°æ®',
    batch_id VARCHAR(32) COMMENT 'æ‰¹æ¬¡ID',
    
    INDEX idx_device_time (device_id, measurement_time),
    INDEX idx_sensor_type_time (sensor_type, measurement_time),
    INDEX idx_quality (data_quality),
    FOREIGN KEY (device_id) REFERENCES iot_devices(device_id)
) PARTITION BY RANGE (UNIX_TIMESTAMP(measurement_time)) (
    PARTITION p_old VALUES LESS THAN (UNIX_TIMESTAMP('2024-01-01')),
    PARTITION p_2024_q1 VALUES LESS THAN (UNIX_TIMESTAMP('2024-04-01')),
    PARTITION p_2024_q2 VALUES LESS THAN (UNIX_TIMESTAMP('2024-07-01')),
    PARTITION p_2024_q3 VALUES LESS THAN (UNIX_TIMESTAMP('2024-10-01')),
    PARTITION p_2024_q4 VALUES LESS THAN (UNIX_TIMESTAMP('2025-01-01')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

**ğŸ’¡ è®¾è®¡è¦ç‚¹è§£é‡Š**

| å­—æ®µ | **ä½œç”¨è¯´æ˜** | **å®é™…å«ä¹‰** |
|------|------------|------------|
| `raw_value` | `ä¼ æ„Ÿå™¨ç›´æ¥è¯»å–çš„æ•°å€¼` | `æ¯”å¦‚ADCè¯»å–çš„ç”µå‹å€¼` |
| `processed_value` | `ç»è¿‡æ ¡å‡†å’Œè½¬æ¢çš„å€¼` | `æ¯”å¦‚è½¬æ¢æˆå®é™…æ¸©åº¦å€¼` |
| `data_quality` | `æ•°æ®å¯ä¿¡åº¦è¯„åˆ†` | `100åˆ†=å®Œå…¨å¯ä¿¡ï¼Œ0åˆ†=å®Œå…¨ä¸å¯ä¿¡` |
| `is_anomaly` | `å¼‚å¸¸æ ‡è®°` | `é€šè¿‡ç®—æ³•è¯†åˆ«çš„å¼‚å¸¸æ•°æ®ç‚¹` |
| `batch_id` | `æ‰¹æ¬¡æ ‡è¯†` | `åŒä¸€æ—¶åˆ»å¤šä¸ªä¼ æ„Ÿå™¨æ•°æ®çš„å…³è”ID` |

### 3.2 ä¼ æ„Ÿå™¨ç±»å‹é…ç½®


**âš™ï¸ ä¼ æ„Ÿå™¨è§„æ ¼ç®¡ç†**

```sql
-- ä¼ æ„Ÿå™¨ç±»å‹é…ç½®è¡¨
CREATE TABLE sensor_types (
    sensor_type VARCHAR(50) PRIMARY KEY COMMENT 'ä¼ æ„Ÿå™¨ç±»å‹',
    type_name VARCHAR(100) NOT NULL COMMENT 'ç±»å‹åç§°',
    measurement_range JSON COMMENT 'æµ‹é‡èŒƒå›´',
    precision_spec DECIMAL(10,6) COMMENT 'ç²¾åº¦è§„æ ¼',
    sampling_rate INT COMMENT 'é‡‡æ ·é¢‘ç‡(ç§’)',
    calibration_formula TEXT COMMENT 'æ ¡å‡†å…¬å¼',
    alert_thresholds JSON COMMENT 'æŠ¥è­¦é˜ˆå€¼',
    
    INDEX idx_type_name (type_name)
);
```

**ğŸ“‹ é…ç½®æ•°æ®ç¤ºä¾‹**

```sql
INSERT INTO sensor_types VALUES (
    'TEMP_DS18B20',
    'æ¸©åº¦ä¼ æ„Ÿå™¨',
    '{"min": -55, "max": 125, "unit": "Â°C"}',
    0.5,
    60,
    'processed_value = (raw_value * 0.0625)',
    '{"warning": {"min": 0, "max": 40}, "critical": {"min": -10, "max": 50}}'
);
```

### 3.3 æµ‹é‡å€¼æ ‡å‡†åŒ–å¤„ç†


**ğŸ”„ æ•°æ®æ ‡å‡†åŒ–æµç¨‹**

```
åŸå§‹æ•°æ®å¤„ç†æµç¨‹ï¼š
ä¼ æ„Ÿå™¨è¯»å– â†’ æ•°æ®æ ¡å‡† â†’ å•ä½è½¬æ¢ â†’ è´¨é‡è¯„ä¼° â†’ å¼‚å¸¸æ£€æµ‹ â†’ å­˜å‚¨

å®é™…ä¾‹å­ï¼š
æ¸©åº¦ä¼ æ„Ÿå™¨ï¼š3.25V â†’ ç»è¿‡å…¬å¼ â†’ 25.6Â°C â†’ è´¨é‡è¯„åˆ†95 â†’ æ­£å¸¸æ•°æ®
```

```sql
-- æ•°æ®æ ‡å‡†åŒ–å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE ProcessSensorData(
    IN p_device_id VARCHAR(64),
    IN p_sensor_type VARCHAR(50),
    IN p_raw_value DECIMAL(15,6),
    IN p_measurement_time TIMESTAMP(3)
)
BEGIN
    DECLARE v_processed_value DECIMAL(15,6);
    DECLARE v_quality_score TINYINT DEFAULT 100;
    DECLARE v_is_anomaly BOOLEAN DEFAULT FALSE;
    DECLARE v_calibration_formula TEXT;
    
    -- è·å–æ ¡å‡†å…¬å¼
    SELECT calibration_formula INTO v_calibration_formula 
    FROM sensor_types 
    WHERE sensor_type = p_sensor_type;
    
    -- åº”ç”¨æ ¡å‡†å…¬å¼ï¼ˆç®€åŒ–å¤„ç†ï¼‰
    SET v_processed_value = p_raw_value * 0.0625;  -- å®é™…åº”è§£æå…¬å¼
    
    -- æ•°æ®è´¨é‡è¯„ä¼°
    CALL EvaluateDataQuality(p_device_id, p_sensor_type, v_processed_value, v_quality_score);
    
    -- å¼‚å¸¸æ£€æµ‹
    CALL DetectAnomaly(p_sensor_type, v_processed_value, v_is_anomaly);
    
    -- æ’å…¥å¤„ç†åçš„æ•°æ®
    INSERT INTO sensor_data (
        device_id, sensor_type, measurement_time, 
        raw_value, processed_value, data_quality, is_anomaly
    ) VALUES (
        p_device_id, p_sensor_type, p_measurement_time,
        p_raw_value, v_processed_value, v_quality_score, v_is_anomaly
    );
END //
DELIMITER ;
```

---

## 4. ğŸ—ï¸ å¤šç»´åº¦æ•°æ®æ¨¡å‹


### 4.1 å¤šç»´åº¦æ•°æ®ç»“æ„


**ğŸ“Š ä»€ä¹ˆæ˜¯å¤šç»´åº¦æ•°æ®**

æƒ³è±¡ä¸€ä¸ªç¯å¢ƒç›‘æµ‹ç«™ï¼Œå®ƒä¸æ˜¯åªæµ‹é‡ä¸€ä¸ªæ•°æ®ï¼Œè€Œæ˜¯åŒæ—¶ç›‘æµ‹ï¼š
- **æ¸©åº¦**ï¼š25.6Â°C
- **æ¹¿åº¦**ï¼š65%
- **PM2.5**ï¼š35Î¼g/mÂ³
- **é£é€Ÿ**ï¼š3.2m/s
- **å™ªéŸ³**ï¼š45dB

è¿™å°±æ˜¯å¤šç»´åº¦æ•°æ®ï¼Œä¸€ä¸ªè®¾å¤‡åŒæ—¶äº§ç”Ÿå¤šä¸ªä¸åŒç±»å‹çš„æµ‹é‡å€¼ã€‚

```sql
-- å¤šç»´åº¦ä¼ æ„Ÿå™¨æ•°æ®è¡¨
CREATE TABLE multi_sensor_data (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL COMMENT 'è®¾å¤‡ID',
    measurement_time TIMESTAMP(3) NOT NULL COMMENT 'æµ‹é‡æ—¶é—´',
    data_payload JSON NOT NULL COMMENT 'å¤šç»´åº¦æ•°æ®è½½è·',
    data_version VARCHAR(10) DEFAULT '1.0' COMMENT 'æ•°æ®æ ¼å¼ç‰ˆæœ¬',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_device_time (device_id, measurement_time)
);
```

**ğŸ“‹ JSONæ•°æ®æ ¼å¼ç¤ºä¾‹**

```json
{
  "timestamp": "2024-09-10T15:30:00.123Z",
  "measurements": {
    "temperature": {
      "value": 25.6,
      "unit": "Â°C",
      "quality": 98,
      "sensor_id": "TEMP_001"
    },
    "humidity": {
      "value": 65.2,
      "unit": "%RH",
      "quality": 95,
      "sensor_id": "HUM_001"
    },
    "pm25": {
      "value": 35,
      "unit": "Î¼g/mÂ³",
      "quality": 92,
      "sensor_id": "PM_001"
    }
  },
  "device_status": {
    "battery": 85,
    "signal_strength": -65,
    "uptime": 86400
  }
}
```

### 4.2 æ—¶åºæ•°æ®åˆ†åŒºç­–ç•¥


**â° æ—¶é—´åˆ†åŒºè®¾è®¡**

IoTæ•°æ®çš„ç‰¹ç‚¹æ˜¯"æ–°æ•°æ®æŸ¥è¯¢é¢‘ç¹ï¼Œæ—§æ•°æ®æŸ¥è¯¢è¾ƒå°‘"ï¼Œç±»ä¼¼æ–°é—»ï¼š
- **æœ€è¿‘1å‘¨**ï¼šé¢‘ç¹æŸ¥è¯¢ï¼Œéœ€è¦æœ€å¿«é€Ÿåº¦
- **æœ€è¿‘1ä¸ªæœˆ**ï¼šå¶å°”æŸ¥è¯¢ï¼Œé€Ÿåº¦è¦æ±‚é€‚ä¸­
- **1ä¸ªæœˆä»¥å‰**ï¼šå¾ˆå°‘æŸ¥è¯¢ï¼Œå¯ä»¥æ…¢ä¸€äº›

```sql
-- æŒ‰æœˆåˆ†åŒºçš„ä¼ æ„Ÿå™¨æ•°æ®è¡¨
CREATE TABLE sensor_data_partitioned (
    id BIGINT AUTO_INCREMENT,
    device_id VARCHAR(64) NOT NULL,
    sensor_type VARCHAR(50) NOT NULL,
    measurement_time TIMESTAMP(3) NOT NULL,
    value_data JSON NOT NULL,
    
    PRIMARY KEY (id, measurement_time),
    INDEX idx_device (device_id, measurement_time)
) PARTITION BY RANGE (YEAR(measurement_time) * 100 + MONTH(measurement_time)) (
    PARTITION p_202409 VALUES LESS THAN (202410),
    PARTITION p_202410 VALUES LESS THAN (202411),
    PARTITION p_202411 VALUES LESS THAN (202412),
    PARTITION p_202412 VALUES LESS THAN (202501),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 4.3 è®¾å¤‡å±æ€§åŠ¨æ€é…ç½®


**ğŸ”§ çµæ´»çš„è®¾å¤‡é…ç½®**

ä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œå°±åƒä¸åŒå“ç‰Œçš„æ‰‹æœºæœ‰ä¸åŒçš„åŠŸèƒ½ä¸€æ ·ï¼š

```sql
-- è®¾å¤‡åŠ¨æ€å±æ€§è¡¨
CREATE TABLE device_attributes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL,
    attribute_name VARCHAR(100) NOT NULL,
    attribute_value JSON NOT NULL,
    attribute_type VARCHAR(50) NOT NULL COMMENT 'å±æ€§ç±»å‹ï¼šconfig/spec/runtime',
    is_active BOOLEAN DEFAULT TRUE,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    
    UNIQUE KEY uk_device_attr (device_id, attribute_name),
    INDEX idx_attr_type (attribute_type)
);
```

**ğŸ“ å±æ€§é…ç½®ç¤ºä¾‹**

```sql
-- è®¾å¤‡é‡‡æ ·é¢‘ç‡é…ç½®
INSERT INTO device_attributes VALUES (
    NULL, 'DEV001', 'sampling_config', 
    '{"temperature": 60, "humidity": 120, "pressure": 300}',
    'config', TRUE, NOW()
);

-- è®¾å¤‡æŠ€æœ¯è§„æ ¼
INSERT INTO device_attributes VALUES (
    NULL, 'DEV001', 'technical_specs',
    '{"power_consumption": "5W", "operating_temp": "-20~60Â°C", "accuracy": "Â±0.5Â°C"}',
    'spec', TRUE, NOW()
);
```

---

## 5. ğŸ›¡ï¸ æ•°æ®è´¨é‡ç®¡æ§ä½“ç³»


### 5.1 æ•°æ®æ ¡éªŒè§„åˆ™å¼•æ“


**âœ… æ•°æ®æ ¡éªŒçš„é‡è¦æ€§**

æƒ³è±¡ä½ æœ‰ä¸€ä¸ªæ¸©åº¦è®¡ï¼Œå¦‚æœå®ƒçªç„¶æ˜¾ç¤º100Â°Cï¼ˆè€Œä½ åœ¨å®¤å†…ï¼‰ï¼Œä½ è‚¯å®šçŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯é”™çš„ã€‚æ•°æ®æ ¡éªŒå°±æ˜¯è®©è®¡ç®—æœºä¹Ÿèƒ½è¯†åˆ«è¿™ç§æ˜æ˜¾çš„é”™è¯¯ã€‚

```sql
-- æ•°æ®æ ¡éªŒè§„åˆ™è¡¨
CREATE TABLE data_validation_rules (
    id INT AUTO_INCREMENT PRIMARY KEY,
    rule_name VARCHAR(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
    sensor_type VARCHAR(50) NOT NULL COMMENT 'é€‚ç”¨ä¼ æ„Ÿå™¨ç±»å‹',
    validation_type VARCHAR(50) NOT NULL COMMENT 'æ ¡éªŒç±»å‹',
    rule_config JSON NOT NULL COMMENT 'è§„åˆ™é…ç½®',
    severity VARCHAR(20) DEFAULT 'WARNING' COMMENT 'ä¸¥é‡çº§åˆ«',
    is_enabled BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_sensor_type (sensor_type),
    INDEX idx_validation_type (validation_type)
);
```

**ğŸ“‹ æ ¡éªŒè§„åˆ™é…ç½®**

```sql
-- æ¸©åº¦ä¼ æ„Ÿå™¨åˆç†èŒƒå›´æ ¡éªŒ
INSERT INTO data_validation_rules (rule_name, sensor_type, validation_type, rule_config) VALUES 
('æ¸©åº¦åˆç†èŒƒå›´', 'TEMP_DS18B20', 'RANGE_CHECK', 
 '{"min": -40, "max": 80, "unit": "Â°C", "action": "FLAG_ANOMALY"}'),

-- æ•°æ®å˜åŒ–ç‡æ ¡éªŒï¼ˆé˜²æ­¢çªå˜ï¼‰
('æ¸©åº¦å˜åŒ–ç‡æ ¡éªŒ', 'TEMP_DS18B20', 'RATE_OF_CHANGE', 
 '{"max_change_per_minute": 5, "window_minutes": 5, "action": "QUALITY_REDUCE"}'),

-- ä¼ æ„Ÿå™¨å¿ƒè·³æ£€æŸ¥
('æ•°æ®åŠæ—¶æ€§æ ¡éªŒ', 'ALL', 'TIMELINESS', 
 '{"max_delay_minutes": 10, "action": "MARK_STALE"}');
```

### 5.2 å¼‚å¸¸æ•°æ®å¤„ç†æœºåˆ¶


**ğŸš¨ å¼‚å¸¸å¤„ç†æµç¨‹**

```
å¼‚å¸¸æ•°æ®å¤„ç†æµç¨‹ï¼š
æ•°æ®æ¥æ”¶ â†’ å®æ—¶æ ¡éªŒ â†’ å‘ç°å¼‚å¸¸ â†’ åˆ†çº§å¤„ç† â†’ é€šçŸ¥å‘Šè­¦ â†’ äººå·¥ç¡®è®¤

å¤„ç†ç­–ç•¥ï¼š
- è½»å¾®å¼‚å¸¸ï¼šé™ä½è´¨é‡è¯„åˆ†ï¼Œç»§ç»­å¤„ç†
- ä¸­åº¦å¼‚å¸¸ï¼šæ ‡è®°å¼‚å¸¸ï¼Œå‘é€è­¦å‘Š
- ä¸¥é‡å¼‚å¸¸ï¼šä¸¢å¼ƒæ•°æ®ï¼Œç«‹å³å‘Šè­¦
```

```sql
-- å¼‚å¸¸æ•°æ®è®°å½•è¡¨
CREATE TABLE data_anomalies (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL,
    sensor_data_id BIGINT COMMENT 'å…³è”çš„ä¼ æ„Ÿå™¨æ•°æ®ID',
    anomaly_type VARCHAR(50) NOT NULL COMMENT 'å¼‚å¸¸ç±»å‹',
    anomaly_level VARCHAR(20) NOT NULL COMMENT 'å¼‚å¸¸çº§åˆ«',
    description TEXT COMMENT 'å¼‚å¸¸æè¿°',
    original_value DECIMAL(15,6) COMMENT 'åŸå§‹å€¼',
    expected_range VARCHAR(100) COMMENT 'é¢„æœŸèŒƒå›´',
    detection_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_confirmed BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²ç¡®è®¤',
    resolution_action VARCHAR(200) COMMENT 'å¤„ç†æªæ–½',
    resolved_at TIMESTAMP NULL COMMENT 'è§£å†³æ—¶é—´',
    
    INDEX idx_device_time (device_id, detection_time),
    INDEX idx_anomaly_type (anomaly_type),
    INDEX idx_unresolved (is_confirmed, resolved_at)
);
```

### 5.3 æ•°æ®è´¨é‡è¯„ä¼°ç³»ç»Ÿ


**ğŸ“Š è´¨é‡è¯„åˆ†ç®—æ³•**

æ•°æ®è´¨é‡å°±åƒå­¦ç”Ÿæˆç»©ï¼Œç”¨0-100åˆ†æ¥è¯„ä»·ï¼š

```sql
-- æ•°æ®è´¨é‡è¯„ä¼°å‡½æ•°
DELIMITER //
CREATE FUNCTION CalculateDataQuality(
    p_device_id VARCHAR(64),
    p_sensor_type VARCHAR(50),
    p_value DECIMAL(15,6),
    p_measurement_time TIMESTAMP
) RETURNS TINYINT
READS SQL DATA
DETERMINISTIC
BEGIN
    DECLARE v_quality_score TINYINT DEFAULT 100;
    DECLARE v_device_reliability TINYINT;
    DECLARE v_value_consistency TINYINT;
    DECLARE v_timeliness_score TINYINT;
    
    -- 1. è®¾å¤‡å¯é æ€§è¯„åˆ† (30%æƒé‡)
    SELECT AVG(CASE WHEN current_status = 'ONLINE' THEN 100 ELSE 0 END) INTO v_device_reliability
    FROM iot_devices WHERE device_id = p_device_id;
    
    -- 2. æ•°å€¼ä¸€è‡´æ€§è¯„åˆ† (40%æƒé‡) - ä¸å†å²æ•°æ®æ¯”è¾ƒ
    SELECT CASE 
        WHEN ABS(p_value - AVG(processed_value)) <= 2 * STDDEV(processed_value) THEN 100
        WHEN ABS(p_value - AVG(processed_value)) <= 3 * STDDEV(processed_value) THEN 80
        ELSE 60
    END INTO v_value_consistency
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND sensor_type = p_sensor_type 
      AND measurement_time >= DATE_SUB(p_measurement_time, INTERVAL 1 HOUR);
    
    -- 3. æ—¶æ•ˆæ€§è¯„åˆ† (30%æƒé‡)
    SET v_timeliness_score = CASE 
        WHEN TIMESTAMPDIFF(SECOND, p_measurement_time, NOW()) <= 60 THEN 100
        WHEN TIMESTAMPDIFF(SECOND, p_measurement_time, NOW()) <= 300 THEN 90
        WHEN TIMESTAMPDIFF(SECOND, p_measurement_time, NOW()) <= 600 THEN 80
        ELSE 60
    END;
    
    -- ç»¼åˆè¯„åˆ†
    SET v_quality_score = ROUND(
        v_device_reliability * 0.3 + 
        IFNULL(v_value_consistency, 100) * 0.4 + 
        v_timeliness_score * 0.3
    );
    
    RETURN v_quality_score;
END //
DELIMITER ;
```

---

## 6. ğŸ§  ä¼ æ„Ÿå™¨æ•°æ®èåˆä¸æ™ºèƒ½å¤„ç†


### 6.1 å¤šä¼ æ„Ÿå™¨æ•°æ®èåˆ


**ğŸ”„ æ•°æ®èåˆçš„æ¦‚å¿µ**

æ•°æ®èåˆå°±åƒåŒ»ç”Ÿçœ‹ç—…ï¼Œä¸æ˜¯åªçœ‹ä¸€ä¸ªæŒ‡æ ‡ï¼Œè€Œæ˜¯ç»¼åˆå¤šä¸ªæ£€æŸ¥ç»“æœï¼š
- **å•ä¸€ä¼ æ„Ÿå™¨**ï¼šåªçŸ¥é“æ¸©åº¦æ˜¯25Â°C
- **å¤šä¼ æ„Ÿå™¨èåˆ**ï¼šæ¸©åº¦25Â°C + æ¹¿åº¦65% + æ°”å‹1013hPa = èˆ’é€‚çš„å¤©æ°”

```sql
-- ä¼ æ„Ÿå™¨æ•°æ®èåˆè¡¨
CREATE TABLE sensor_data_fusion (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    fusion_id VARCHAR(64) NOT NULL COMMENT 'èåˆæ•°æ®å”¯ä¸€ID',
    device_group VARCHAR(100) NOT NULL COMMENT 'è®¾å¤‡ç»„',
    fusion_time TIMESTAMP(3) NOT NULL COMMENT 'èåˆæ—¶é—´',
    input_sensors JSON NOT NULL COMMENT 'å‚ä¸èåˆçš„ä¼ æ„Ÿå™¨',
    fusion_result JSON NOT NULL COMMENT 'èåˆç»“æœ',
    fusion_algorithm VARCHAR(50) NOT NULL COMMENT 'èåˆç®—æ³•',
    confidence_score DECIMAL(5,2) NOT NULL COMMENT 'ç½®ä¿¡åº¦è¯„åˆ†',
    
    INDEX idx_group_time (device_group, fusion_time),
    INDEX idx_fusion_algorithm (fusion_algorithm)
);
```

**ğŸ”¬ èåˆç®—æ³•ç¤ºä¾‹**

```sql
-- ç¯å¢ƒèˆ’é€‚åº¦èåˆè®¡ç®—
DELIMITER //
CREATE PROCEDURE FuseEnvironmentData(
    IN p_device_group VARCHAR(100),
    IN p_fusion_time TIMESTAMP(3)
)
BEGIN
    DECLARE v_temperature DECIMAL(10,2);
    DECLARE v_humidity DECIMAL(10,2);
    DECLARE v_comfort_index DECIMAL(5,2);
    DECLARE v_confidence DECIMAL(5,2);
    
    -- è·å–åŒæ—¶é—´ç‚¹çš„å¤šä¼ æ„Ÿå™¨æ•°æ®
    SELECT 
        AVG(CASE WHEN sensor_type = 'TEMPERATURE' THEN processed_value END) as temp,
        AVG(CASE WHEN sensor_type = 'HUMIDITY' THEN processed_value END) as humid
    INTO v_temperature, v_humidity
    FROM sensor_data sd
    JOIN iot_devices d ON sd.device_id = d.device_id
    WHERE d.location_info->>'$.zone' = p_device_group
      AND sd.measurement_time BETWEEN 
          DATE_SUB(p_fusion_time, INTERVAL 5 MINUTE) AND 
          DATE_ADD(p_fusion_time, INTERVAL 5 MINUTE);
    
    -- è®¡ç®—èˆ’é€‚åº¦æŒ‡æ•° (ç®€åŒ–çš„çƒ­èˆ’é€‚å…¬å¼)
    SET v_comfort_index = 100 - ABS(v_temperature - 22) * 2 - ABS(v_humidity - 50) * 0.5;
    
    -- è®¡ç®—ç½®ä¿¡åº¦
    SET v_confidence = CASE 
        WHEN v_temperature IS NOT NULL AND v_humidity IS NOT NULL THEN 95.0
        WHEN v_temperature IS NOT NULL OR v_humidity IS NOT NULL THEN 70.0
        ELSE 0.0
    END;
    
    -- æ’å…¥èåˆç»“æœ
    INSERT INTO sensor_data_fusion (
        fusion_id, device_group, fusion_time, 
        input_sensors, fusion_result, fusion_algorithm, confidence_score
    ) VALUES (
        CONCAT('COMFORT_', UNIX_TIMESTAMP(p_fusion_time)), 
        p_device_group, 
        p_fusion_time,
        JSON_OBJECT('temperature', v_temperature, 'humidity', v_humidity),
        JSON_OBJECT('comfort_index', v_comfort_index, 'level', 
            CASE 
                WHEN v_comfort_index >= 80 THEN 'èˆ’é€‚'
                WHEN v_comfort_index >= 60 THEN 'ä¸€èˆ¬'
                ELSE 'ä¸é€‚'
            END),
        'COMFORT_ALGORITHM_V1',
        v_confidence
    );
END //
DELIMITER ;
```

### 6.2 æ™ºèƒ½æ ¡å‡†ç®¡ç†


**âš™ï¸ ä¼ æ„Ÿå™¨æ ¡å‡†ç³»ç»Ÿ**

ä¼ æ„Ÿå™¨æ ¡å‡†å°±åƒæ ¡å‡†æ‰‹è¡¨ï¼Œéœ€è¦å®šæœŸä¸æ ‡å‡†æ—¶é—´å¯¹æ¯”ï¼Œç¡®ä¿å‡†ç¡®æ€§ï¼š

```sql
-- ä¼ æ„Ÿå™¨æ ¡å‡†è®°å½•è¡¨
CREATE TABLE sensor_calibration (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL,
    sensor_type VARCHAR(50) NOT NULL,
    calibration_time TIMESTAMP NOT NULL,
    calibration_method VARCHAR(50) NOT NULL COMMENT 'æ ¡å‡†æ–¹æ³•',
    reference_values JSON NOT NULL COMMENT 'å‚è€ƒæ ‡å‡†å€¼',
    measured_values JSON NOT NULL COMMENT 'å®é™…æµ‹é‡å€¼',
    calibration_factor DECIMAL(10,6) COMMENT 'æ ¡å‡†ç³»æ•°',
    calibration_offset DECIMAL(10,6) COMMENT 'æ ¡å‡†åç§»',
    accuracy_improvement DECIMAL(5,2) COMMENT 'ç²¾åº¦æå‡ç™¾åˆ†æ¯”',
    next_calibration_due DATE COMMENT 'ä¸‹æ¬¡æ ¡å‡†æ—¥æœŸ',
    calibrated_by VARCHAR(50) COMMENT 'æ ¡å‡†äººå‘˜',
    
    INDEX idx_device_sensor (device_id, sensor_type),
    INDEX idx_calibration_due (next_calibration_due)
);
```

**ğŸ“Š æ™ºèƒ½æ ¡å‡†ç®—æ³•**

```sql
-- è‡ªåŠ¨è®¡ç®—æ ¡å‡†å‚æ•°
DELIMITER //
CREATE PROCEDURE AutoCalibrateSensor(
    IN p_device_id VARCHAR(64),
    IN p_sensor_type VARCHAR(50),
    IN p_reference_value DECIMAL(10,6),
    IN p_measured_value DECIMAL(10,6)
)
BEGIN
    DECLARE v_calibration_factor DECIMAL(10,6);
    DECLARE v_calibration_offset DECIMAL(10,6);
    DECLARE v_old_accuracy DECIMAL(5,2);
    DECLARE v_new_accuracy DECIMAL(5,2);
    
    -- è®¡ç®—æ ¡å‡†å‚æ•°
    SET v_calibration_factor = p_reference_value / p_measured_value;
    SET v_calibration_offset = p_reference_value - p_measured_value;
    
    -- è®¡ç®—ç²¾åº¦æå‡
    SELECT AVG(ABS(processed_value - raw_value)) INTO v_old_accuracy
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND sensor_type = p_sensor_type 
      AND measurement_time >= DATE_SUB(NOW(), INTERVAL 7 DAY);
    
    SET v_new_accuracy = v_old_accuracy * 0.8;  -- é¢„æœŸæå‡20%
    
    -- è®°å½•æ ¡å‡†ä¿¡æ¯
    INSERT INTO sensor_calibration (
        device_id, sensor_type, calibration_time,
        calibration_method, reference_values, measured_values,
        calibration_factor, calibration_offset, accuracy_improvement,
        next_calibration_due, calibrated_by
    ) VALUES (
        p_device_id, p_sensor_type, NOW(),
        'AUTO_CALIBRATION',
        JSON_OBJECT('standard', p_reference_value),
        JSON_OBJECT('measured', p_measured_value),
        v_calibration_factor, v_calibration_offset,
        ((v_old_accuracy - v_new_accuracy) / v_old_accuracy * 100),
        DATE_ADD(NOW(), INTERVAL 3 MONTH),
        'SYSTEM_AUTO'
    );
    
    -- æ›´æ–°ä¼ æ„Ÿå™¨é…ç½®
    UPDATE sensor_types 
    SET calibration_formula = CONCAT('processed_value = raw_value * ', v_calibration_factor, ' + ', v_calibration_offset)
    WHERE sensor_type = p_sensor_type;
    
END //
DELIMITER ;
```

### 6.3 è®¾å¤‡çŠ¶æ€æ™ºèƒ½æ¨æ–­


**ğŸ” æ™ºèƒ½çŠ¶æ€åˆ†æ**

é€šè¿‡åˆ†æä¼ æ„Ÿå™¨æ•°æ®æ¨¡å¼ï¼Œè‡ªåŠ¨åˆ¤æ–­è®¾å¤‡å¥åº·çŠ¶æ€ï¼š

```sql
-- è®¾å¤‡å¥åº·çŠ¶æ€åˆ†æè¡¨
CREATE TABLE device_health_analysis (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    device_id VARCHAR(64) NOT NULL,
    analysis_time TIMESTAMP NOT NULL,
    health_metrics JSON NOT NULL COMMENT 'å¥åº·æŒ‡æ ‡',
    predicted_status VARCHAR(50) NOT NULL COMMENT 'é¢„æµ‹çŠ¶æ€',
    confidence_level DECIMAL(5,2) NOT NULL COMMENT 'é¢„æµ‹ç½®ä¿¡åº¦',
    risk_factors JSON COMMENT 'é£é™©å› ç´ ',
    maintenance_suggestion TEXT COMMENT 'ç»´æŠ¤å»ºè®®',
    
    INDEX idx_device_time (device_id, analysis_time),
    INDEX idx_predicted_status (predicted_status)
);
```

**ğŸ¤– æ™ºèƒ½åˆ†æç®—æ³•**

```sql
DELIMITER //
CREATE PROCEDURE AnalyzeDeviceHealth(IN p_device_id VARCHAR(64))
BEGIN
    DECLARE v_data_consistency DECIMAL(5,2);
    DECLARE v_response_time DECIMAL(8,2);
    DECLARE v_error_rate DECIMAL(5,2);
    DECLARE v_health_score DECIMAL(5,2);
    DECLARE v_predicted_status VARCHAR(50);
    
    -- è®¡ç®—æ•°æ®ä¸€è‡´æ€§
    SELECT (1 - STDDEV(processed_value) / AVG(processed_value)) * 100 INTO v_data_consistency
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND measurement_time >= DATE_SUB(NOW(), INTERVAL 24 HOUR);
    
    -- è®¡ç®—å“åº”æ—¶é—´
    SELECT AVG(TIMESTAMPDIFF(SECOND, measurement_time, created_at)) INTO v_response_time
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND measurement_time >= DATE_SUB(NOW(), INTERVAL 24 HOUR);
    
    -- è®¡ç®—é”™è¯¯ç‡
    SELECT (COUNT(CASE WHEN is_anomaly = TRUE THEN 1 END) / COUNT(*)) * 100 INTO v_error_rate
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND measurement_time >= DATE_SUB(NOW(), INTERVAL 24 HOUR);
    
    -- ç»¼åˆå¥åº·è¯„åˆ†
    SET v_health_score = (
        IFNULL(v_data_consistency, 50) * 0.4 + 
        (100 - LEAST(v_response_time, 100)) * 0.3 + 
        (100 - IFNULL(v_error_rate, 50)) * 0.3
    );
    
    -- é¢„æµ‹è®¾å¤‡çŠ¶æ€
    SET v_predicted_status = CASE 
        WHEN v_health_score >= 90 THEN 'EXCELLENT'
        WHEN v_health_score >= 75 THEN 'GOOD'
        WHEN v_health_score >= 60 THEN 'FAIR'
        WHEN v_health_score >= 40 THEN 'POOR'
        ELSE 'CRITICAL'
    END;
    
    -- è®°å½•åˆ†æç»“æœ
    INSERT INTO device_health_analysis (
        device_id, analysis_time, health_metrics, 
        predicted_status, confidence_level, maintenance_suggestion
    ) VALUES (
        p_device_id, NOW(),
        JSON_OBJECT(
            'consistency_score', v_data_consistency,
            'response_time', v_response_time,
            'error_rate', v_error_rate,
            'overall_score', v_health_score
        ),
        v_predicted_status,
        85.0,
        CASE 
            WHEN v_predicted_status IN ('POOR', 'CRITICAL') THEN 'å»ºè®®ç«‹å³æ£€æŸ¥è®¾å¤‡'
            WHEN v_predicted_status = 'FAIR' THEN 'å»ºè®®è®¡åˆ’ç»´æŠ¤'
            ELSE 'è®¾å¤‡çŠ¶æ€è‰¯å¥½'
        END
    );
    
END //
DELIMITER ;
```

---

## 7. ğŸ”„ å¼‚æ„è®¾å¤‡é€‚é…ç­–ç•¥


### 7.1 å¤šæºæ•°æ®åŒæ­¥æœºåˆ¶


**ğŸ”„ ä»€ä¹ˆæ˜¯å¼‚æ„è®¾å¤‡**

æƒ³è±¡ä¸€ä¸ªæ™ºèƒ½å®¶å±…ç³»ç»Ÿï¼š
- **å°ç±³**çš„æ¸©åº¦ä¼ æ„Ÿå™¨
- **åä¸º**çš„æ¹¿åº¦ä¼ æ„Ÿå™¨  
- **æµ·å°”**çš„ç©ºè°ƒæ§åˆ¶å™¨
- **è‡ªç ”**çš„ç©ºæ°”è´¨é‡æ£€æµ‹å™¨

è¿™äº›è®¾å¤‡æ¥è‡ªä¸åŒå‚å•†ï¼Œæ•°æ®æ ¼å¼ä¸åŒï¼Œé€šä¿¡åè®®ä¸åŒï¼Œè¿™å°±æ˜¯"å¼‚æ„è®¾å¤‡"ã€‚

```sql
-- è®¾å¤‡é€‚é…å™¨é…ç½®è¡¨
CREATE TABLE device_adapters (
    id INT AUTO_INCREMENT PRIMARY KEY,
    manufacturer VARCHAR(100) NOT NULL COMMENT 'åˆ¶é€ å•†',
    device_model VARCHAR(100) NOT NULL COMMENT 'è®¾å¤‡å‹å·',
    protocol_type VARCHAR(50) NOT NULL COMMENT 'é€šä¿¡åè®®',
    data_format VARCHAR(50) NOT NULL COMMENT 'æ•°æ®æ ¼å¼',
    adapter_config JSON NOT NULL COMMENT 'é€‚é…å™¨é…ç½®',
    message_template JSON COMMENT 'æ¶ˆæ¯æ¨¡æ¿',
    is_active BOOLEAN DEFAULT TRUE,
    
    UNIQUE KEY uk_manufacturer_model (manufacturer, device_model),
    INDEX idx_protocol (protocol_type)
);
```

**ğŸ“‹ é€‚é…å™¨é…ç½®ç¤ºä¾‹**

```sql
-- å°ç±³æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨é€‚é…
INSERT INTO device_adapters VALUES (
    NULL, 'Xiaomi', 'LYWSD03MMC', 'BLE', 'JSON',
    '{
        "data_mapping": {
            "temperature": "$.temp",
            "humidity": "$.humidity", 
            "battery": "$.battery"
        },
        "unit_conversion": {
            "temperature": {"from": "0.01Â°C", "to": "Â°C", "factor": 0.01},
            "humidity": {"from": "0.01%", "to": "%", "factor": 0.01}
        }
    }',
    '{
        "request": {"cmd": "read_sensors"},
        "response_format": "json"
    }',
    TRUE
);

-- åä¸ºä¼ æ„Ÿå™¨é€‚é…
INSERT INTO device_adapters VALUES (
    NULL, 'Huawei', 'SensorHub-01', 'MQTT', 'XML',
    '{
        "topic_pattern": "huawei/sensors/{device_id}/data",
        "data_mapping": {
            "temperature": "$.sensors.temperature.value",
            "humidity": "$.sensors.humidity.value"
        },
        "timestamp_format": "yyyy-MM-dd HH:mm:ss"
    }',
    NULL,
    TRUE
);
```

### 7.2 æ•°æ®æ ¼å¼æ ‡å‡†åŒ–


**ğŸ”„ æ•°æ®æ ‡å‡†åŒ–æµç¨‹**

```
å¼‚æ„æ•°æ®æ ‡å‡†åŒ–æµç¨‹ï¼š
åŸå§‹æ•°æ® â†’ æ ¼å¼è¯†åˆ« â†’ å­—æ®µæ˜ å°„ â†’ å•ä½è½¬æ¢ â†’ è´¨é‡æ£€æŸ¥ â†’ ç»Ÿä¸€å­˜å‚¨

å®é™…ä¾‹å­ï¼š
å°ç±³: {"temp": 2560, "hum": 6520}  (æ¸©åº¦25.60Â°C, æ¹¿åº¦65.20%)
åä¸º: <data><temperature unit="C">25.6</temperature></data>
ç»Ÿä¸€: {"temperature": 25.6, "humidity": 65.2, "unit": "Â°C"}
```

```sql
-- æ•°æ®æ ‡å‡†åŒ–å¤„ç†å‡½æ•°
DELIMITER //
CREATE FUNCTION StandardizeDeviceData(
    p_manufacturer VARCHAR(100),
    p_device_model VARCHAR(100),
    p_raw_data JSON
) RETURNS JSON
READS SQL DATA
DETERMINISTIC
BEGIN
    DECLARE v_adapter_config JSON;
    DECLARE v_standardized_data JSON DEFAULT JSON_OBJECT();
    DECLARE v_data_mapping JSON;
    DECLARE v_unit_conversion JSON;
    
    -- è·å–é€‚é…å™¨é…ç½®
    SELECT adapter_config INTO v_adapter_config
    FROM device_adapters 
    WHERE manufacturer = p_manufacturer 
      AND device_model = p_device_model
      AND is_active = TRUE;
    
    IF v_adapter_config IS NULL THEN
        RETURN JSON_OBJECT('error', 'No adapter found');
    END IF;
    
    -- æå–æ˜ å°„é…ç½®
    SET v_data_mapping = JSON_EXTRACT(v_adapter_config, '$.data_mapping');
    SET v_unit_conversion = JSON_EXTRACT(v_adapter_config, '$.unit_conversion');
    
    -- åº”ç”¨æ•°æ®æ˜ å°„ï¼ˆç®€åŒ–å®ç°ï¼‰
    IF JSON_EXTRACT(v_data_mapping, '$.temperature') IS NOT NULL THEN
        SET v_standardized_data = JSON_SET(v_standardized_data, 
            '$.temperature', 
            JSON_EXTRACT(p_raw_data, JSON_UNQUOTE(JSON_EXTRACT(v_data_mapping, '$.temperature')))
        );
    END IF;
    
    IF JSON_EXTRACT(v_data_mapping, '$.humidity') IS NOT NULL THEN
        SET v_standardized_data = JSON_SET(v_standardized_data, 
            '$.humidity',
            JSON_EXTRACT(p_raw_data, JSON_UNQUOTE(JSON_EXTRACT(v_data_mapping, '$.humidity')))
        );
    END IF;
    
    -- æ·»åŠ å…ƒæ•°æ®
    SET v_standardized_data = JSON_SET(v_standardized_data,
        '$.metadata.manufacturer', p_manufacturer,
        '$.metadata.model', p_device_model,
        '$.metadata.processed_at', NOW()
    );
    
    RETURN v_standardized_data;
END //
DELIMITER ;
```

### 7.3 æ•°æ®å®Œæ•´æ€§ä¿è¯æœºåˆ¶


**ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**

ç¡®ä¿å¼‚æ„è®¾å¤‡æ•°æ®åœ¨ä¼ è¾“å’Œå¤„ç†è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€ä¸ç¯¡æ”¹ï¼š

```sql
-- æ•°æ®å®Œæ•´æ€§æ£€æŸ¥è¡¨
CREATE TABLE data_integrity_checks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    check_batch VARCHAR(64) NOT NULL COMMENT 'æ£€æŸ¥æ‰¹æ¬¡',
    device_id VARCHAR(64) NOT NULL,
    check_type VARCHAR(50) NOT NULL COMMENT 'æ£€æŸ¥ç±»å‹',
    expected_count INT COMMENT 'é¢„æœŸæ•°æ®é‡',
    actual_count INT COMMENT 'å®é™…æ•°æ®é‡',
    missing_records JSON COMMENT 'ç¼ºå¤±è®°å½•',
    duplicate_records JSON COMMENT 'é‡å¤è®°å½•',
    integrity_score DECIMAL(5,2) NOT NULL COMMENT 'å®Œæ•´æ€§è¯„åˆ†',
    check_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_device_time (device_id, check_time),
    INDEX idx_check_type (check_type)
);
```

**ğŸ” å®Œæ•´æ€§æ£€æŸ¥ç®—æ³•**

```sql
DELIMITER //
CREATE PROCEDURE CheckDataIntegrity(
    IN p_device_id VARCHAR(64),
    IN p_start_time TIMESTAMP,
    IN p_end_time TIMESTAMP
)
BEGIN
    DECLARE v_expected_count INT;
    DECLARE v_actual_count INT;
    DECLARE v_duplicate_count INT;
    DECLARE v_integrity_score DECIMAL(5,2);
    DECLARE v_sampling_interval INT DEFAULT 60; -- 60ç§’é‡‡æ ·é—´éš”
    
    -- è®¡ç®—é¢„æœŸæ•°æ®é‡
    SET v_expected_count = TIMESTAMPDIFF(SECOND, p_start_time, p_end_time) / v_sampling_interval;
    
    -- ç»Ÿè®¡å®é™…æ•°æ®é‡
    SELECT COUNT(*) INTO v_actual_count
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND measurement_time BETWEEN p_start_time AND p_end_time;
    
    -- æ£€æŸ¥é‡å¤æ•°æ®
    SELECT COUNT(*) - COUNT(DISTINCT measurement_time, sensor_type) INTO v_duplicate_count
    FROM sensor_data 
    WHERE device_id = p_device_id 
      AND measurement_time BETWEEN p_start_time AND p_end_time;
    
    -- è®¡ç®—å®Œæ•´æ€§è¯„åˆ†
    SET v_integrity_score = CASE 
        WHEN v_expected_count = 0 THEN 0
        ELSE (v_actual_count / v_expected_count * 100) - (v_duplicate_count / v_actual_count * 10)
    END;
    
    SET v_integrity_score = GREATEST(0, LEAST(100, v_integrity_score));
    
    -- è®°å½•æ£€æŸ¥ç»“æœ
    INSERT INTO data_integrity_checks (
        check_batch, device_id, check_type,
        expected_count, actual_count, integrity_score
    ) VALUES (
        CONCAT('BATCH_', DATE_FORMAT(NOW(), '%Y%m%d_%H%i%s')),
        p_device_id, 'COMPLETENESS_CHECK',
        v_expected_count, v_actual_count, v_integrity_score
    );
    
    -- å¦‚æœå®Œæ•´æ€§è¯„åˆ†è¿‡ä½ï¼Œè§¦å‘å‘Šè­¦
    IF v_integrity_score < 80 THEN
        INSERT INTO data_anomalies (
            device_id, anomaly_type, anomaly_level, description
        ) VALUES (
            p_device_id, 'DATA_INTEGRITY', 'MEDIUM',
            CONCAT('æ•°æ®å®Œæ•´æ€§è¯„åˆ†è¿‡ä½: ', v_integrity_score, '%')
        );
    END IF;
    
END //
DELIMITER ;
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ IoTæ•°æ®ç‰¹ç‚¹ï¼šæµ·é‡ã€æ—¶åºã€å¤šç»´ã€å®æ—¶æ€§è¦æ±‚é«˜
ğŸ”¸ è®¾å¤‡çŠ¶æ€ç®¡ç†ï¼šåœ¨çº¿/ç¦»çº¿/æ•…éšœ/ç»´æŠ¤çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
ğŸ”¸ ä¼ æ„Ÿå™¨æ•°æ®æ¨¡å‹ï¼šåŸå§‹å€¼ã€å¤„ç†å€¼ã€è´¨é‡è¯„åˆ†çš„å®Œæ•´è®°å½•
ğŸ”¸ å¤šç»´åº¦æ•°æ®ï¼šä¸€ä¸ªè®¾å¤‡å¤šä¸ªä¼ æ„Ÿå™¨çš„ç»¼åˆæ•°æ®ç®¡ç†
ğŸ”¸ æ•°æ®è´¨é‡ä½“ç³»ï¼šæ ¡éªŒã€è¯„åˆ†ã€å¼‚å¸¸æ£€æµ‹çš„å®Œæ•´æµç¨‹
ğŸ”¸ æ•°æ®èåˆæŠ€æœ¯ï¼šå¤šä¼ æ„Ÿå™¨æ•°æ®æ™ºèƒ½æ•´åˆä¸åˆ†æ
ğŸ”¸ å¼‚æ„è®¾å¤‡é€‚é…ï¼šä¸åŒå‚å•†è®¾å¤‡çš„æ ‡å‡†åŒ–å¤„ç†
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦IoTä¸“é—¨çš„æ•°æ®åº“è®¾è®¡**
```
ä¼ ç»Ÿä¸šåŠ¡ç‰¹ç‚¹ï¼š
- ç”¨æˆ·ä¸»åŠ¨æ“ä½œäº§ç”Ÿæ•°æ®
- æ•°æ®é‡ç›¸å¯¹å¯æ§
- æŸ¥è¯¢æ¨¡å¼å¤æ‚å¤šæ ·

IoTä¸šåŠ¡ç‰¹ç‚¹ï¼š
- è®¾å¤‡è¢«åŠ¨æŒç»­äº§ç”Ÿæ•°æ®
- æ•°æ®é‡å·¨å¤§ä¸”æŒç»­å¢é•¿
- ä»¥æ—¶é—´åºåˆ—æŸ¥è¯¢ä¸ºä¸»

å› æ­¤éœ€è¦ä¸“é—¨ä¼˜åŒ–ï¼šæ—¶åºå­˜å‚¨ã€åˆ†åŒºç­–ç•¥ã€ç´¢å¼•è®¾è®¡
```

**ğŸ”¹ æ•°æ®è´¨é‡ä¸ºä»€ä¹ˆå¦‚æ­¤é‡è¦**
```
IoTç¯å¢ƒçš„æŒ‘æˆ˜ï¼š
- è®¾å¤‡å¯èƒ½æ•…éšœï¼šä¼ æ„Ÿå™¨è€åŒ–ã€ç”µè·¯é—®é¢˜
- ç½‘ç»œå¯èƒ½ä¸ç¨³å®šï¼šæ•°æ®ä¼ è¾“ä¸¢åŒ…ã€å»¶è¿Ÿ
- ç¯å¢ƒå¯èƒ½å¹²æ‰°ï¼šç”µç£å¹²æ‰°ã€æ¸©åº¦å½±å“

åæœï¼š
- é”™è¯¯æ•°æ® â†’ é”™è¯¯å†³ç­– â†’ ä¸šåŠ¡æŸå¤±
- å¼‚å¸¸æ•°æ® â†’ è¯¯æŠ¥å‘Šè­¦ â†’ äººåŠ›æµªè´¹
- ä½è´¨é‡æ•°æ® â†’ åˆ†æç»“æœä¸å¯ä¿¡

å› æ­¤å¿…é¡»å»ºç«‹å®Œæ•´çš„æ•°æ®è´¨é‡ä¿éšœä½“ç³»
```

**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®èåˆ**
```
å•ä¸€ä¼ æ„Ÿå™¨å±€é™ï¼š
- æµ‹é‡èŒƒå›´æœ‰é™
- å¯èƒ½å‡ºç°è¯¯å·®
- æ— æ³•æä¾›å®Œæ•´ä¿¡æ¯

å¤šä¼ æ„Ÿå™¨èåˆä¼˜åŠ¿ï¼š
- äº’ç›¸éªŒè¯ï¼Œæé«˜å‡†ç¡®æ€§
- ç»¼åˆåˆ†æï¼Œæä¾›æ›´ä¸°å¯Œä¿¡æ¯
- æ•…éšœå®¹é”™ï¼Œä¸€ä¸ªä¼ æ„Ÿå™¨åäº†è¿˜æœ‰å¤‡ä»½

å®é™…æ•ˆæœï¼š1+1 > 2
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è®¾è®¡åŸåˆ™æ€»ç»“**

```
ğŸ“Š å­˜å‚¨è®¾è®¡åŸåˆ™ï¼š
âœ… æ—¶é—´åˆ†åŒºï¼šæŒ‰æ—¶é—´èŒƒå›´åˆ†åŒºï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
âœ… ç´¢å¼•ä¼˜åŒ–ï¼šé‡ç‚¹ä¼˜åŒ–æ—¶é—´èŒƒå›´æŸ¥è¯¢
âœ… æ•°æ®å‹ç¼©ï¼šå†å²æ•°æ®å‹ç¼©å­˜å‚¨
âœ… å†·çƒ­åˆ†ç¦»ï¼šçƒ­æ•°æ®å¿«é€Ÿè®¿é—®ï¼Œå†·æ•°æ®å½’æ¡£

ğŸ”§ å¤„ç†è®¾è®¡åŸåˆ™ï¼š
âœ… å®æ—¶æ ¡éªŒï¼šæ•°æ®å…¥åº“æ—¶ç«‹å³æ ¡éªŒ
âœ… å¼‚æ­¥å¤„ç†ï¼šè€—æ—¶çš„åˆ†æç®—æ³•å¼‚æ­¥æ‰§è¡Œ
âœ… æ‰¹é‡æ“ä½œï¼šæ‰¹é‡æ’å…¥æé«˜æ€§èƒ½
âœ… å®¹é”™è®¾è®¡ï¼šå•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿ

ğŸ›¡ï¸ è´¨é‡è®¾è®¡åŸåˆ™ï¼š
âœ… åˆ†å±‚æ£€éªŒï¼šæ¥å…¥å±‚ã€å­˜å‚¨å±‚ã€åº”ç”¨å±‚ä¸‰é‡æ£€éªŒ
âœ… åˆ†çº§å¤„ç†ï¼šæ ¹æ®å¼‚å¸¸ä¸¥é‡ç¨‹åº¦åˆ†çº§å¤„ç†
âœ… è‡ªåŠ¨ä¿®å¤ï¼šèƒ½è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜ä¸éœ€è¦äººå·¥å¹²é¢„
âœ… äººå·¥ç¡®è®¤ï¼šé‡è¦å¼‚å¸¸éœ€è¦äººå·¥ç¡®è®¤
```

**ğŸš€ æœ€ä½³å®è·µå»ºè®®**

```
å¼€å‘é˜¶æ®µï¼š
1. å…ˆç¡®å®šä¸šåŠ¡åœºæ™¯ï¼Œå†è®¾è®¡æ•°æ®æ¨¡å‹
2. é¢„ç•™è¶³å¤Ÿçš„æ‰©å±•æ€§ï¼Œè®¾å¤‡ç±»å‹ä¼šä¸æ–­å¢åŠ 
3. å»ºç«‹å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼Œæ¨¡æ‹ŸçœŸå®IoTåœºæ™¯

è¿ç»´é˜¶æ®µï¼š
1. ç›‘æ§æ•°æ®è´¨é‡æŒ‡æ ‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
2. å®šæœŸåˆ†æè®¾å¤‡å¥åº·çŠ¶å†µï¼Œé¢„é˜²æ€§ç»´æŠ¤
3. å»ºç«‹å‘Šè­¦æœºåˆ¶ï¼Œå¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥

ä¼˜åŒ–é˜¶æ®µï¼š
1. æ ¹æ®å®é™…æŸ¥è¯¢æ¨¡å¼è°ƒæ•´ç´¢å¼•ç­–ç•¥
2. åˆ†æå†å²æ•°æ®ï¼Œä¼˜åŒ–æ•°æ®èåˆç®—æ³•
3. æŒç»­æ”¹è¿›å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼Œå‡å°‘è¯¯æŠ¥
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- IoTæ•°æ®åº“è®¾è®¡æ ¸å¿ƒæ˜¯**æ—¶åºæ€§**å’Œ**è´¨é‡ç®¡æ§**
- è®¾å¤‡çŠ¶æ€ç®¡ç†è¦è€ƒè™‘**å®Œæ•´ç”Ÿå‘½å‘¨æœŸ**
- æ•°æ®è´¨é‡ä½“ç³»è¦åšåˆ°**å®æ—¶æ£€éªŒã€åˆ†çº§å¤„ç†**
- å¤šä¼ æ„Ÿå™¨èåˆèƒ½**äº’ç›¸éªŒè¯ã€æä¾›ä¸°å¯Œä¿¡æ¯**
- å¼‚æ„è®¾å¤‡é€‚é…éœ€è¦**æ ‡å‡†åŒ–å¤„ç†æµç¨‹**
- æ‰€æœ‰è®¾è®¡éƒ½è¦è€ƒè™‘**å¤§æ•°æ®é‡**å’Œ**é«˜å¹¶å‘**åœºæ™¯