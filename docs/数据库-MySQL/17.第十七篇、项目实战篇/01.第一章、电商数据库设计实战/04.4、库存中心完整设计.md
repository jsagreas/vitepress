---
title: 4ã€åº“å­˜ä¸­å¿ƒå®Œæ•´è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [åº“å­˜ä¸­å¿ƒæ ¸å¿ƒæ¦‚å¿µ](#1-åº“å­˜ä¸­å¿ƒæ ¸å¿ƒæ¦‚å¿µ)
2. [åº“å­˜æ•°æ®åº“è®¾è®¡æ¶æ„](#2-åº“å­˜æ•°æ®åº“è®¾è®¡æ¶æ„)
3. [åº“å­˜æ‰£å‡ç­–ç•¥ä¸æœºåˆ¶](#3-åº“å­˜æ‰£å‡ç­–ç•¥ä¸æœºåˆ¶)
4. [åº“å­˜é”å®šä¸å¹¶å‘æ§åˆ¶](#4-åº“å­˜é”å®šä¸å¹¶å‘æ§åˆ¶)
5. [åº“å­˜è¡¥å¿ä¸äº‹åŠ¡å¤„ç†](#5-åº“å­˜è¡¥å¿ä¸äº‹åŠ¡å¤„ç†)
6. [åº“å­˜é¢„è­¦ä¸ç›‘æ§ç³»ç»Ÿ](#6-åº“å­˜é¢„è­¦ä¸ç›‘æ§ç³»ç»Ÿ)
7. [å¤šä»“åº“åº“å­˜åŒæ­¥](#7-å¤šä»“åº“åº“å­˜åŒæ­¥)
8. [åº“å­˜ç›˜ç‚¹ä¸æˆæœ¬ç®¡ç†](#8-åº“å­˜ç›˜ç‚¹ä¸æˆæœ¬ç®¡ç†)
9. [æ€§èƒ½ä¼˜åŒ–ä¸æ•°æ®æ²»ç†](#9-æ€§èƒ½ä¼˜åŒ–ä¸æ•°æ®æ²»ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“¦ åº“å­˜ä¸­å¿ƒæ ¸å¿ƒæ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åº“å­˜ä¸­å¿ƒ

**é€šä¿—ç†è§£**ï¼šåº“å­˜ä¸­å¿ƒå°±åƒä¸€ä¸ªè¶…å¤§å‹ä»“åº“çš„ç®¡ç†ç³»ç»Ÿï¼Œå®ƒä¸ä»…è¦çŸ¥é“æœ‰å¤šå°‘å•†å“ï¼Œè¿˜è¦ç®¡ç†è¿™äº›å•†å“çš„è¿›å‡ºã€é¢„è®¢ã€åˆ†é…ç­‰å„ç§å¤æ‚æ“ä½œã€‚

```
ç°å®åœºæ™¯å¯¹æ¯”ï¼š
å®ä½“ä»“åº“ï¼šè´§æ¶ä¸Šæœ‰100ä¸ªè‹¹æœï¼Œå–å‡º1ä¸ªå°±å‰©99ä¸ª
ç”µå•†åº“å­˜ï¼šè¦è€ƒè™‘å·²ä¸‹å•æœªä»˜æ¬¾ã€å·²ä»˜æ¬¾å¾…å‘è´§ã€é€€è´§åœ¨è·¯ä¸Šç­‰å¤æ‚çŠ¶æ€

åº“å­˜ä¸­å¿ƒçš„èŒè´£ï¼š
â”Œâ”€ å®æ—¶åº“å­˜ç®¡ç† â”€â”€ çŸ¥é“æ¯ä¸€åˆ»æœ‰å¤šå°‘å¯å–çš„å•†å“
â”œâ”€ åº“å­˜åˆ†é…æ§åˆ¶ â”€â”€ å¤šä¸ªæ¸ é“åŒæ—¶å–ï¼Œå¦‚ä½•åˆç†åˆ†é…
â”œâ”€ è¶…å–é˜²æŠ¤æœºåˆ¶ â”€â”€ é˜²æ­¢å–å‡ºè¶…è¿‡å®é™…åº“å­˜çš„å•†å“  
â”œâ”€ åº“å­˜çŠ¶æ€è¿½è¸ª â”€â”€ è®°å½•æ¯æ¬¡å˜åŒ–çš„åŸå› å’Œè¿‡ç¨‹
â””â”€ å¼‚å¸¸å¤„ç†æ¢å¤ â”€â”€ å‡ºé—®é¢˜æ—¶å¦‚ä½•å¿«é€Ÿæ¢å¤æ­£å¸¸
```

### 1.2 åº“å­˜åˆ†å±‚ç®¡ç†æ¦‚å¿µ


**ğŸ”¸ ç‰©ç†åº“å­˜ vs å¯é”€å”®åº“å­˜**
```
ç‰©ç†åº“å­˜ï¼ˆPhysical Stockï¼‰ï¼š
â”Œâ”€ å«ä¹‰ï¼šä»“åº“é‡Œå®é™…å­˜åœ¨çš„å•†å“æ•°é‡
â”œâ”€ ç‰¹ç‚¹ï¼šçœŸå®å­˜åœ¨ï¼Œå¯ä»¥çœ‹å¾—è§æ‘¸å¾—ç€
â””â”€ ç¤ºä¾‹ï¼šä»“åº“è´§æ¶ä¸Šå®é™…æœ‰100å°æ‰‹æœº

å¯é”€å”®åº“å­˜ï¼ˆAvailable Stockï¼‰ï¼š
â”Œâ”€ å«ä¹‰ï¼šå½“å‰å¯ä»¥å¯¹å¤–é”€å”®çš„å•†å“æ•°é‡  
â”œâ”€ è®¡ç®—ï¼šç‰©ç†åº“å­˜ - é¢„å åº“å­˜ - é”å®šåº“å­˜ - å®‰å…¨åº“å­˜
â””â”€ ç¤ºä¾‹ï¼š100å°æ‰‹æœº - 20å°é¢„è®¢ - 5å°é”å®š = 75å°å¯å–

åº“å­˜çŠ¶æ€è½¬æ¢ï¼š
ç‰©ç†åº“å­˜ â†’ é¢„å åº“å­˜ â†’ é”å®šåº“å­˜ â†’ å®é™…æ‰£å‡
    â†“         â†“         â†“         â†“
   å…¥åº“      ä¸‹å•      ä»˜æ¬¾      å‘è´§
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦åˆ†å±‚ç®¡ç†ï¼Ÿ**
> æƒ³è±¡ä½ å¼€äº†ä¸€å®¶æ‰‹æœºåº—ï¼Œæœ‰100å°æ‰‹æœºã€‚å¦‚æœæœ‰50ä¸ªå®¢æˆ·éƒ½åœ¨"è€ƒè™‘è´­ä¹°"ï¼Œä½ ä¸èƒ½å› ä¸ºä»–ä»¬è¿˜æ²¡ä»˜æ¬¾å°±å–ç»™å…¶ä»–äºº101å°ï¼Œè¿™å°±éœ€è¦åˆ†å±‚ç®¡ç†æ¥é¿å…æ··ä¹±ã€‚

### 1.3 åº“å­˜ä¸­å¿ƒæ ¸å¿ƒæŒ‘æˆ˜


**ğŸš« è¶…å–é—®é¢˜**
```
è¶…å–åœºæ™¯ï¼š
æ—¶é—´ç‚¹ 1ï¼šåº“å­˜æ˜¾ç¤ºè¿˜æœ‰1å°æ‰‹æœº
æ—¶é—´ç‚¹ 2ï¼šå®¢æˆ·Aæäº¤è®¢å•  
æ—¶é—´ç‚¹ 3ï¼šå®¢æˆ·Bä¹Ÿæäº¤è®¢å•ï¼ˆç³»ç»Ÿè¿˜æ²¡æ¥å¾—åŠæ‰£å‡ï¼‰
ç»“æœï¼šä¸¤ä¸ªäººéƒ½æˆåŠŸä¸‹å•ï¼Œä½†åªæœ‰1å°æ‰‹æœº

é˜²è¶…å–ç­–ç•¥ï¼š
â”Œâ”€ æ‚²è§‚é”ï¼šå…ˆé”å®šå†æ“ä½œï¼Œç¡®ä¿å®‰å…¨ä½†å½±å“æ€§èƒ½
â”œâ”€ ä¹è§‚é”ï¼šå…ˆæ“ä½œåæ£€æŸ¥ï¼Œæ€§èƒ½å¥½ä½†å¯èƒ½éœ€è¦é‡è¯•  
â””â”€ é¢„å æœºåˆ¶ï¼šæå‰é¢„ç•™åº“å­˜ï¼Œé¿å…ä¸´æ—¶äº‰æŠ¢
```

---

## 2. ğŸ—ï¸ åº“å­˜æ•°æ®åº“è®¾è®¡æ¶æ„


### 2.1 æ ¸å¿ƒåº“å­˜è¡¨è®¾è®¡


**ğŸ“‹ ä¸»åº“å­˜è¡¨ï¼ˆinventory_mainï¼‰**
```sql
-- å•†å“ä¸»åº“å­˜è¡¨ï¼šè®°å½•æ¯ä¸ªå•†å“åœ¨æ¯ä¸ªä»“åº“çš„åº“å­˜ä¿¡æ¯
CREATE TABLE inventory_main (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    sku_id varchar(64) NOT NULL COMMENT 'SKUå•†å“ç¼–ç ',
    warehouse_id varchar(32) NOT NULL COMMENT 'ä»“åº“ç¼–ç ', 
    physical_stock int NOT NULL DEFAULT 0 COMMENT 'ç‰©ç†åº“å­˜æ•°é‡',
    available_stock int NOT NULL DEFAULT 0 COMMENT 'å¯é”€å”®åº“å­˜',
    reserved_stock int NOT NULL DEFAULT 0 COMMENT 'é¢„å åº“å­˜',
    locked_stock int NOT NULL DEFAULT 0 COMMENT 'é”å®šåº“å­˜',
    safety_stock int NOT NULL DEFAULT 0 COMMENT 'å®‰å…¨åº“å­˜é˜ˆå€¼',
    version int NOT NULL DEFAULT 0 COMMENT 'ç‰ˆæœ¬å·(ä¹è§‚é”)',
    updated_time timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_time timestamp DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_sku_warehouse (sku_id, warehouse_id),
    INDEX idx_updated_time (updated_time)
) COMMENT='å•†å“åº“å­˜ä¸»è¡¨';
```

**ğŸ’¡ å­—æ®µå«ä¹‰è§£é‡Š**
- **`physical_stock`**ï¼šä»“åº“å®é™…æœ‰å¤šå°‘å•†å“ï¼Œè¿™æ˜¯çœŸå®çš„ç‰©ç†æ•°é‡
- **`available_stock`**ï¼šå½“å‰èƒ½å–ç»™å®¢æˆ·çš„æ•°é‡ï¼Œä¼šéšç€è®¢å•å®æ—¶å˜åŒ–
- **`reserved_stock`**ï¼šå®¢æˆ·ä¸‹å•ä½†è¿˜æœªä»˜æ¬¾æ—¶é¢„å çš„æ•°é‡
- **`version`**ï¼šç”¨äºä¹è§‚é”ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šå¢åŠ ï¼Œé˜²æ­¢å¹¶å‘ä¿®æ”¹å†²çª

### 2.2 åº“å­˜æµæ°´è¡¨è®¾è®¡


**ğŸ“ åº“å­˜å˜åŠ¨æµæ°´è¡¨ï¼ˆinventory_logï¼‰**
```sql
-- åº“å­˜å˜åŠ¨æ—¥å¿—ï¼šè®°å½•æ¯ä¸€æ¬¡åº“å­˜å˜åŒ–çš„è¯¦ç»†ä¿¡æ¯
CREATE TABLE inventory_log (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    sku_id varchar(64) NOT NULL COMMENT 'SKUç¼–ç ',
    warehouse_id varchar(32) NOT NULL COMMENT 'ä»“åº“ç¼–ç ',
    change_type tinyint NOT NULL COMMENT 'å˜åŠ¨ç±»å‹ï¼š1å…¥åº“ 2å‡ºåº“ 3é¢„å  4é‡Šæ”¾ 5é”å®š 6è§£é”',
    change_amount int NOT NULL COMMENT 'å˜åŠ¨æ•°é‡ï¼ˆæ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘ï¼‰',
    before_stock int NOT NULL COMMENT 'å˜åŠ¨å‰åº“å­˜',
    after_stock int NOT NULL COMMENT 'å˜åŠ¨ååº“å­˜', 
    business_no varchar(64) COMMENT 'ä¸šåŠ¡å•å·ï¼ˆè®¢å•å·ã€å…¥åº“å•å·ç­‰ï¼‰',
    business_type varchar(32) COMMENT 'ä¸šåŠ¡ç±»å‹ï¼šORDER/PURCHASE/TRANSFER',
    operator_id varchar(32) COMMENT 'æ“ä½œäººID',
    remark varchar(500) COMMENT 'å¤‡æ³¨ä¿¡æ¯',
    created_time timestamp DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_sku_warehouse_time (sku_id, warehouse_id, created_time),
    INDEX idx_business_no (business_no)
) COMMENT='åº“å­˜å˜åŠ¨æµæ°´è¡¨';
```

**ğŸ” ä¸ºä»€ä¹ˆéœ€è¦æµæ°´è¡¨ï¼Ÿ**
> å°±åƒé“¶è¡Œè¦è®°å½•æ¯ç¬”å­˜å–æ¬¾ä¸€æ ·ï¼Œåº“å­˜çš„æ¯æ¬¡å˜åŒ–éƒ½è¦æœ‰è®°å½•ã€‚è¿™æ ·å‡ºç°é—®é¢˜æ—¶å¯ä»¥è¿½æ ¹æº¯æºï¼ŒçŸ¥é“åº“å­˜æ˜¯æ€ä¹ˆå˜æˆç°åœ¨è¿™æ ·çš„ã€‚

### 2.3 åº“å­˜å¿«ç…§è¡¨è®¾è®¡


**ğŸ“¸ åº“å­˜å¿«ç…§è¡¨ï¼ˆinventory_snapshotï¼‰**
```sql
-- åº“å­˜å¿«ç…§ï¼šå®šæœŸä¿å­˜åº“å­˜çŠ¶æ€ï¼Œç”¨äºå¯¹è´¦å’Œæ•°æ®ä¿®å¤
CREATE TABLE inventory_snapshot (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    sku_id varchar(64) NOT NULL,
    warehouse_id varchar(32) NOT NULL, 
    physical_stock int NOT NULL COMMENT 'å¿«ç…§æ—¶ç‰©ç†åº“å­˜',
    available_stock int NOT NULL COMMENT 'å¿«ç…§æ—¶å¯é”€å”®åº“å­˜',
    snapshot_date date NOT NULL COMMENT 'å¿«ç…§æ—¥æœŸ',
    snapshot_type tinyint NOT NULL COMMENT 'å¿«ç…§ç±»å‹ï¼š1æ—¥å¿«ç…§ 2å‘¨å¿«ç…§ 3æœˆå¿«ç…§',
    created_time timestamp DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY uk_sku_warehouse_date (sku_id, warehouse_id, snapshot_date),
    INDEX idx_snapshot_date (snapshot_date)
) COMMENT='åº“å­˜å¿«ç…§è¡¨';
```

---

## 3. âš¡ åº“å­˜æ‰£å‡ç­–ç•¥ä¸æœºåˆ¶


### 3.1 åº“å­˜æ‰£å‡æ ¸å¿ƒæµç¨‹


**ğŸ“Š æ‰£å‡æµç¨‹å›¾**
```
ç”¨æˆ·ä¸‹å•æµç¨‹ï¼š
å®¢æˆ·æäº¤è®¢å• â†’ é¢„å åº“å­˜ â†’ ç”¨æˆ·ä»˜æ¬¾ â†’ é”å®šåº“å­˜ â†’ å•†å“å‘è´§ â†’ å®é™…æ‰£å‡
     â†“           â†“         â†“         â†“         â†“         â†“
  æ£€æŸ¥åº“å­˜    ä¸´æ—¶é¢„ç•™   ç¡®è®¤è´­ä¹°   å‡†å¤‡å‘è´§   å®Œæˆäº¤æ˜“   æ›´æ–°åº“å­˜

å¼‚å¸¸å¤„ç†ï¼š
é¢„å è¶…æ—¶ â†’ è‡ªåŠ¨é‡Šæ”¾é¢„å åº“å­˜
ä»˜æ¬¾å¤±è´¥ â†’ é‡Šæ”¾é¢„å åº“å­˜  
å‘è´§å¤±è´¥ â†’ è§£é”åº“å­˜ï¼Œæ¢å¤å¯é”€å”®æ•°é‡
ç”¨æˆ·é€€è´§ â†’ å¢åŠ ç‰©ç†åº“å­˜å’Œå¯é”€å”®åº“å­˜
```

### 3.2 é¢„å åº“å­˜æœºåˆ¶è¯¦è§£


**ğŸ”’ é¢„å åº“å­˜çš„ä½œç”¨**
é¢„å åº“å­˜å°±åƒç”µå½±é™¢é€‰åº§æ—¶çš„"æš‚æ—¶ä¿ç•™"ï¼Œç»™å®¢æˆ·ä¸€å®šæ—¶é—´è€ƒè™‘ï¼Œä½†ä¸ä¼šä¸€ç›´å ç€ä½ç½®ã€‚

```sql
-- é¢„å åº“å­˜æ“ä½œï¼ˆå®¢æˆ·ä¸‹å•æ—¶æ‰§è¡Œï¼‰
DELIMITER $$
CREATE PROCEDURE ReserveInventory(
    IN p_sku_id VARCHAR(64),
    IN p_warehouse_id VARCHAR(32), 
    IN p_quantity INT,
    IN p_order_no VARCHAR(64),
    OUT p_result INT
)
BEGIN
    DECLARE v_available_stock INT DEFAULT 0;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK;
    
    START TRANSACTION;
    
    -- æ£€æŸ¥å¯é”€å”®åº“å­˜æ˜¯å¦å……è¶³
    SELECT available_stock INTO v_available_stock 
    FROM inventory_main 
    WHERE sku_id = p_sku_id AND warehouse_id = p_warehouse_id;
    
    IF v_available_stock >= p_quantity THEN
        -- æ›´æ–°åº“å­˜ï¼šå‡å°‘å¯é”€å”®åº“å­˜ï¼Œå¢åŠ é¢„å åº“å­˜
        UPDATE inventory_main SET 
            available_stock = available_stock - p_quantity,
            reserved_stock = reserved_stock + p_quantity,
            version = version + 1
        WHERE sku_id = p_sku_id AND warehouse_id = p_warehouse_id;
        
        -- è®°å½•æµæ°´
        INSERT INTO inventory_log(sku_id, warehouse_id, change_type, change_amount, 
                                business_no, business_type, remark) 
        VALUES(p_sku_id, p_warehouse_id, 3, p_quantity, p_order_no, 'ORDER', 'é¢„å åº“å­˜');
        
        SET p_result = 1; -- æˆåŠŸ
    ELSE
        SET p_result = 0; -- åº“å­˜ä¸è¶³
    END IF;
    
    COMMIT;
END$$
DELIMITER ;
```

**â° é¢„å åº“å­˜è¶…æ—¶å¤„ç†**
```sql
-- å®šæ—¶ä»»åŠ¡ï¼šé‡Šæ”¾è¶…æ—¶çš„é¢„å åº“å­˜ï¼ˆæ¯”å¦‚30åˆ†é’Ÿæœªä»˜æ¬¾ï¼‰
UPDATE inventory_main im
JOIN (
    SELECT sku_id, warehouse_id, SUM(change_amount) as timeout_reserved
    FROM inventory_log 
    WHERE change_type = 3 -- é¢„å 
    AND business_type = 'ORDER'
    AND created_time < DATE_SUB(NOW(), INTERVAL 30 MINUTE)
    AND business_no NOT IN (
        SELECT order_no FROM orders WHERE status IN ('PAID', 'SHIPPED')
    )
    GROUP BY sku_id, warehouse_id
) timeout_data ON im.sku_id = timeout_data.sku_id 
                AND im.warehouse_id = timeout_data.warehouse_id
SET 
    im.available_stock = im.available_stock + timeout_data.timeout_reserved,
    im.reserved_stock = im.reserved_stock - timeout_data.timeout_reserved,
    im.version = im.version + 1;
```

### 3.3 åº“å­˜æ‰£å‡æ€§èƒ½ä¼˜åŒ–


**ğŸš€ æ‰¹é‡æ‰£å‡ä¼˜åŒ–**
```sql
-- å•ä¸ªå•†å“å¤šæ¬¡æ‰£å‡å¯ä»¥åˆå¹¶ä¸ºæ‰¹é‡æ“ä½œ
-- æ¯”å¦‚åŒä¸€ä¸ªSKUæœ‰10ä¸ªè®¢å•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æ‰£å‡è€Œä¸æ˜¯åˆ†10æ¬¡
INSERT INTO inventory_batch_operation (
    sku_id, warehouse_id, total_quantity, operation_type, batch_id
) 
SELECT sku_id, warehouse_id, SUM(quantity), 'DEDUCT', UUID()
FROM pending_inventory_operations 
WHERE status = 'PENDING'
GROUP BY sku_id, warehouse_id;
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦æ‰¹é‡ä¼˜åŒ–ï¼Ÿ**
> æƒ³è±¡è¶…å¸‚æ”¶é“¶å‘˜ç»“è´¦ï¼Œå¦‚æœæ¯ä¸ªå•†å“éƒ½è¦å•ç‹¬åˆ·ä¸€æ¬¡åº“å­˜ç³»ç»Ÿï¼Œä¼šå¾ˆæ…¢ã€‚æ‰¹é‡å¤„ç†å°±åƒç”¨æ‰«ææªä¸€æ¬¡æ‰«å®Œæ‰€æœ‰å•†å“ï¼Œç„¶åä¸€èµ·æ›´æ–°åº“å­˜ã€‚

---

## 4. ğŸ” åº“å­˜é”å®šä¸å¹¶å‘æ§åˆ¶


### 4.1 æ‚²è§‚é” vs ä¹è§‚é”åº”ç”¨


**ğŸ”’ æ‚²è§‚é”æœºåˆ¶**
æ‚²è§‚é”çš„æ€è·¯æ˜¯"å…ˆä¸Šé”å†æ“ä½œ"ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªæ“ä½œèƒ½ä¿®æ”¹åº“å­˜ã€‚

```sql
-- æ‚²è§‚é”æ‰£å‡åº“å­˜ï¼šä½¿ç”¨ SELECT ... FOR UPDATE
DELIMITER $$  
CREATE PROCEDURE DeductInventoryWithPessimisticLock(
    IN p_sku_id VARCHAR(64),
    IN p_quantity INT,
    OUT p_result INT
)
BEGIN
    DECLARE v_available_stock INT;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK;
    
    START TRANSACTION;
    
    -- æ‚²è§‚é”ï¼šé”å®šè¿™è¡Œæ•°æ®ï¼Œå…¶ä»–æ“ä½œå¿…é¡»ç­‰å¾…
    SELECT available_stock INTO v_available_stock
    FROM inventory_main 
    WHERE sku_id = p_sku_id 
    FOR UPDATE; -- å…³é”®ï¼šFOR UPDATE é”å®šè¡Œ
    
    IF v_available_stock >= p_quantity THEN
        UPDATE inventory_main 
        SET available_stock = available_stock - p_quantity
        WHERE sku_id = p_sku_id;
        
        SET p_result = 1; -- æˆåŠŸ
    ELSE  
        SET p_result = 0; -- åº“å­˜ä¸è¶³
    END IF;
    
    COMMIT;
END$$
DELIMITER ;
```

**âš¡ ä¹è§‚é”æœºåˆ¶**
ä¹è§‚é”çš„æ€è·¯æ˜¯"å…ˆæ“ä½œå†æ£€æŸ¥"ï¼Œé€šè¿‡ç‰ˆæœ¬å·æ¥æ£€æµ‹æ˜¯å¦æœ‰å¹¶å‘å†²çªã€‚

```sql
-- ä¹è§‚é”æ‰£å‡åº“å­˜ï¼šä½¿ç”¨ç‰ˆæœ¬å·æ£€æŸ¥
UPDATE inventory_main 
SET 
    available_stock = available_stock - #{quantity},
    version = version + 1,  -- ç‰ˆæœ¬å·åŠ 1
    updated_time = NOW()
WHERE sku_id = #{skuId} 
    AND warehouse_id = #{warehouseId}
    AND version = #{currentVersion}  -- å…³é”®ï¼šç‰ˆæœ¬å·å¿…é¡»åŒ¹é…
    AND available_stock >= #{quantity}; -- åº“å­˜å¿…é¡»å……è¶³

-- æ£€æŸ¥å½±å“è¡Œæ•°ï¼Œå¦‚æœä¸º0è¡¨ç¤ºæ›´æ–°å¤±è´¥ï¼ˆç‰ˆæœ¬å†²çªæˆ–åº“å­˜ä¸è¶³ï¼‰
-- éœ€è¦é‡æ–°æŸ¥è¯¢å½“å‰ç‰ˆæœ¬å·å¹¶é‡è¯•
```

**ğŸ†š æ‚²è§‚é” vs ä¹è§‚é”å¯¹æ¯”**
```
æ‚²è§‚é”ï¼š
âœ… æ•°æ®ä¸€è‡´æ€§å¼ºï¼Œç»å¯¹ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜
âŒ æ€§èƒ½è¾ƒä½ï¼Œé«˜å¹¶å‘æ—¶ä¼šæœ‰ç­‰å¾…
ğŸ¯ é€‚ç”¨åœºæ™¯ï¼šåº“å­˜ç´§å¼ ã€å¹¶å‘å†™å…¥å¤šçš„å•†å“

ä¹è§‚é”ï¼š  
âœ… æ€§èƒ½å¥½ï¼Œæ²¡æœ‰é”ç­‰å¾…æ—¶é—´
âŒ å¯èƒ½éœ€è¦é‡è¯•ï¼Œå¤æ‚åº¦ç¨é«˜
ğŸ¯ é€‚ç”¨åœºæ™¯ï¼šåº“å­˜å……è¶³ã€è¯»å¤šå†™å°‘çš„åœºæ™¯
```

### 4.2 åˆ†å¸ƒå¼é”å®ç°


**ğŸŒ Redisåˆ†å¸ƒå¼é”**
```java
// Javaä»£ç ï¼šä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼åº“å­˜é”
@Service
public class InventoryService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean deductInventoryWithDistributedLock(String skuId, int quantity) {
        String lockKey = "inventory_lock:" + skuId;
        String lockValue = UUID.randomUUID().toString();
        
        try {
            // å°è¯•è·å–åˆ†å¸ƒå¼é”ï¼Œè¶…æ—¶æ—¶é—´30ç§’
            Boolean acquired = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, lockValue, Duration.ofSeconds(30));
            
            if (acquired) {
                // è·å–é”æˆåŠŸï¼Œæ‰§è¡Œåº“å­˜æ‰£å‡
                return doDeductInventory(skuId, quantity);
            } else {
                // è·å–é”å¤±è´¥ï¼Œè¿”å›å¤±è´¥
                return false;
            }
        } finally {
            // é‡Šæ”¾é”ï¼ˆç¡®ä¿æ˜¯è‡ªå·±çš„é”ï¼‰
            String currentValue = redisTemplate.opsForValue().get(lockKey);
            if (lockValue.equals(currentValue)) {
                redisTemplate.delete(lockKey);
            }
        }
    }
}
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ**
> å½“ä½ çš„åº“å­˜ç³»ç»Ÿéƒ¨ç½²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ—¶ï¼Œæ•°æ®åº“çš„è¡Œé”åªèƒ½ä¿è¯å•ä¸ªæ•°æ®åº“å†…çš„å¹¶å‘å®‰å…¨ï¼Œä½†ä¸èƒ½ä¿è¯å¤šä¸ªåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„åè°ƒã€‚åˆ†å¸ƒå¼é”å°±åƒä¸€æŠŠ"å…¨å±€é”"ï¼Œç¡®ä¿æ•´ä¸ªç³»ç»Ÿä¸­åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªåœ°æ–¹åœ¨ä¿®æ”¹æŸä¸ªå•†å“çš„åº“å­˜ã€‚

---

## 5. ğŸ”„ åº“å­˜è¡¥å¿ä¸äº‹åŠ¡å¤„ç†


### 5.1 åº“å­˜è¡¥å¿äº‹åŠ¡æœºåˆ¶


**ğŸ”„ ä»€ä¹ˆæ˜¯åº“å­˜è¡¥å¿ï¼Ÿ**
åº“å­˜è¡¥å¿å°±åƒ"æ’¤é”€æ“ä½œ"ï¼Œå½“ä¸šåŠ¡æµç¨‹å‡ºç°å¼‚å¸¸æ—¶ï¼Œéœ€è¦æŠŠä¹‹å‰çš„åº“å­˜æ“ä½œæ¢å¤å›å»ã€‚

```
è¡¥å¿åœºæ™¯ä¸¾ä¾‹ï¼š
åœºæ™¯1ï¼šç”¨æˆ·ä¸‹å•æ‰£å‡åº“å­˜ â†’ ä»˜æ¬¾å¤±è´¥ â†’ è¡¥å¿ï¼šæ¢å¤åº“å­˜
åœºæ™¯2ï¼šå•†å“å‘è´§æ‰£å‡åº“å­˜ â†’ å¿«é€’ä¸¢å¤± â†’ è¡¥å¿ï¼šæ¢å¤åº“å­˜  
åœºæ™¯3ï¼šåº“å­˜è°ƒæ‹¨æ‰£å‡Aä»“ â†’ å¢åŠ Bä»“å¤±è´¥ â†’ è¡¥å¿ï¼šæ¢å¤Aä»“åº“å­˜

è¡¥å¿åŸåˆ™ï¼š
â”Œâ”€ å¹‚ç­‰æ€§ï¼šåŒä¸€ä¸ªè¡¥å¿æ“ä½œæ‰§è¡Œå¤šæ¬¡ç»“æœä¸€è‡´
â”œâ”€ å¯è¿½æº¯ï¼šæ¯ä¸ªè¡¥å¿æ“ä½œéƒ½æœ‰æ˜ç¡®çš„ä¸šåŠ¡åŸå› 
â”œâ”€ æ—¶æ•ˆæ€§ï¼šè¡¥å¿æ“ä½œè¦åŠæ—¶ï¼Œä¸èƒ½é•¿æ—¶é—´å»¶è¿Ÿ
â””â”€ å®Œæ•´æ€§ï¼šè¦è€ƒè™‘å„ç§å¼‚å¸¸æƒ…å†µçš„è¡¥å¿æ–¹æ¡ˆ
```

### 5.2 åº“å­˜å›æ»šæœºåˆ¶å®ç°


**ğŸ“ åº“å­˜è¡¥å¿è¡¨è®¾è®¡**
```sql
-- åº“å­˜è¡¥å¿è®°å½•è¡¨
CREATE TABLE inventory_compensation (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    compensation_id varchar(64) NOT NULL COMMENT 'è¡¥å¿å•å·',
    original_business_no varchar(64) NOT NULL COMMENT 'åŸå§‹ä¸šåŠ¡å•å·',
    sku_id varchar(64) NOT NULL,
    warehouse_id varchar(32) NOT NULL,
    compensation_type tinyint NOT NULL COMMENT 'è¡¥å¿ç±»å‹ï¼š1è®¢å•å–æ¶ˆ 2å‘è´§å¤±è´¥ 3é€€è´§å…¥åº“',
    compensation_amount int NOT NULL COMMENT 'è¡¥å¿æ•°é‡',
    compensation_status tinyint DEFAULT 0 COMMENT 'è¡¥å¿çŠ¶æ€ï¼š0å¾…å¤„ç† 1å·²å¤„ç† 2å¤„ç†å¤±è´¥',
    retry_count int DEFAULT 0 COMMENT 'é‡è¯•æ¬¡æ•°',
    created_time timestamp DEFAULT CURRENT_TIMESTAMP,
    processed_time timestamp NULL COMMENT 'å¤„ç†å®Œæˆæ—¶é—´',
    INDEX idx_business_no (original_business_no),
    INDEX idx_status_created (compensation_status, created_time)
) COMMENT='åº“å­˜è¡¥å¿è®°å½•è¡¨';
```

**âš¡ è¡¥å¿æ‰§è¡Œé€»è¾‘**
```sql
-- åº“å­˜è¡¥å¿å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE CompensateInventory(
    IN p_compensation_id VARCHAR(64),
    OUT p_result INT
)
BEGIN
    DECLARE v_sku_id VARCHAR(64);
    DECLARE v_warehouse_id VARCHAR(32);  
    DECLARE v_amount INT;
    DECLARE v_type TINYINT;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION ROLLBACK;
    
    START TRANSACTION;
    
    -- è·å–è¡¥å¿ä¿¡æ¯
    SELECT sku_id, warehouse_id, compensation_amount, compensation_type
    INTO v_sku_id, v_warehouse_id, v_amount, v_type
    FROM inventory_compensation 
    WHERE compensation_id = p_compensation_id 
    AND compensation_status = 0;
    
    -- æ ¹æ®è¡¥å¿ç±»å‹æ‰§è¡Œä¸åŒæ“ä½œ
    CASE v_type
        WHEN 1 THEN -- è®¢å•å–æ¶ˆï¼Œæ¢å¤å¯é”€å”®åº“å­˜
            UPDATE inventory_main SET 
                available_stock = available_stock + v_amount,
                reserved_stock = reserved_stock - v_amount,
                version = version + 1
            WHERE sku_id = v_sku_id AND warehouse_id = v_warehouse_id;
            
        WHEN 2 THEN -- å‘è´§å¤±è´¥ï¼Œè§£é”åº“å­˜
            UPDATE inventory_main SET 
                available_stock = available_stock + v_amount, 
                locked_stock = locked_stock - v_amount,
                version = version + 1
            WHERE sku_id = v_sku_id AND warehouse_id = v_warehouse_id;
            
        WHEN 3 THEN -- é€€è´§å…¥åº“ï¼Œå¢åŠ ç‰©ç†åº“å­˜
            UPDATE inventory_main SET
                physical_stock = physical_stock + v_amount,
                available_stock = available_stock + v_amount,
                version = version + 1  
            WHERE sku_id = v_sku_id AND warehouse_id = v_warehouse_id;
    END CASE;
    
    -- æ›´æ–°è¡¥å¿çŠ¶æ€
    UPDATE inventory_compensation SET 
        compensation_status = 1,
        processed_time = NOW()
    WHERE compensation_id = p_compensation_id;
    
    SET p_result = 1;
    COMMIT;
END$$
DELIMITER ;
```

### 5.3 å¼‚å¸¸æ•°æ®ä¿®å¤æœºåˆ¶


**ğŸ”§ åº“å­˜æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ**
```sql
-- å®šæœŸæ ¡éªŒåº“å­˜æ•°æ®ä¸€è‡´æ€§
SELECT 
    sku_id,
    warehouse_id,
    physical_stock,
    available_stock + reserved_stock + locked_stock as calculated_total,
    CASE 
        WHEN physical_stock != (available_stock + reserved_stock + locked_stock) 
        THEN 'INCONSISTENT' 
        ELSE 'CONSISTENT' 
    END as consistency_status
FROM inventory_main
WHERE physical_stock != (available_stock + reserved_stock + locked_stock);
```

**ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤æœºåˆ¶**
```java
// Javaä»£ç ï¼šåº“å­˜æ•°æ®è‡ªåŠ¨ä¿®å¤
@Scheduled(fixedDelay = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
public void autoFixInventoryData() {
    List<InventoryInconsistency> inconsistencies = inventoryMapper.findInconsistentInventory();
    
    for (InventoryInconsistency item : inconsistencies) {
        try {
            // é‡æ–°è®¡ç®—æ­£ç¡®çš„åº“å­˜æ•°é‡
            int correctAvailableStock = calculateCorrectAvailableStock(item.getSkuId(), item.getWarehouseId());
            
            // ä¿®å¤åº“å­˜æ•°æ®
            inventoryMapper.fixInventoryData(
                item.getSkuId(), 
                item.getWarehouseId(), 
                correctAvailableStock
            );
            
            // è®°å½•ä¿®å¤æ—¥å¿—
            logInventoryFix(item, correctAvailableStock);
            
        } catch (Exception e) {
            log.error("åº“å­˜æ•°æ®ä¿®å¤å¤±è´¥: {}", item, e);
        }
    }
}
```

---

## 6. ğŸš¨ åº“å­˜é¢„è­¦ä¸ç›‘æ§ç³»ç»Ÿ


### 6.1 æ™ºèƒ½åº“å­˜å‘Šè­¦ç­–ç•¥


**âš ï¸ åº“å­˜å‘Šè­¦è§„åˆ™è®¾è®¡**
```sql
-- åº“å­˜å‘Šè­¦è§„åˆ™è¡¨
CREATE TABLE inventory_alert_rule (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    rule_name varchar(100) NOT NULL COMMENT 'è§„åˆ™åç§°',
    sku_id varchar(64) COMMENT 'SKUç¼–ç ï¼Œä¸ºç©ºè¡¨ç¤ºå…¨å±€è§„åˆ™',
    warehouse_id varchar(32) COMMENT 'ä»“åº“ç¼–ç ',
    alert_type tinyint NOT NULL COMMENT 'å‘Šè­¦ç±»å‹ï¼š1ä½åº“å­˜ 2é›¶åº“å­˜ 3è´Ÿåº“å­˜ 4æ»é”€',
    threshold_value int COMMENT 'é˜ˆå€¼',
    threshold_percentage decimal(5,2) COMMENT 'ç™¾åˆ†æ¯”é˜ˆå€¼',
    is_enabled tinyint DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨',
    alert_frequency int DEFAULT 60 COMMENT 'å‘Šè­¦é¢‘ç‡ï¼ˆåˆ†é’Ÿï¼‰',
    created_time timestamp DEFAULT CURRENT_TIMESTAMP
) COMMENT='åº“å­˜å‘Šè­¦è§„åˆ™è¡¨';

-- ç¤ºä¾‹è§„åˆ™æ•°æ®
INSERT INTO inventory_alert_rule (rule_name, alert_type, threshold_value, alert_frequency) VALUES
('å…¨å±€ä½åº“å­˜å‘Šè­¦', 1, 10, 30),
('é›¶åº“å­˜ç´§æ€¥å‘Šè­¦', 2, 0, 5), 
('è´Ÿåº“å­˜å¼‚å¸¸å‘Šè­¦', 3, 0, 1);
```

**ğŸ“Š å®æ—¶åº“å­˜ç›‘æ§**
```sql
-- åº“å­˜é¢„è­¦æ£€æŸ¥æŸ¥è¯¢
SELECT 
    im.sku_id,
    im.warehouse_id,
    im.available_stock,
    im.safety_stock,
    p.product_name,
    CASE 
        WHEN im.available_stock <= 0 THEN 'é›¶åº“å­˜'
        WHEN im.available_stock < 0 THEN 'è´Ÿåº“å­˜å¼‚å¸¸'  
        WHEN im.available_stock <= im.safety_stock THEN 'ä½åº“å­˜é¢„è­¦'
        WHEN im.available_stock <= im.safety_stock * 0.5 THEN 'åº“å­˜ç´§æ€¥'
        ELSE 'åº“å­˜æ­£å¸¸'
    END as alert_level,
    CASE
        WHEN im.available_stock <= 0 THEN 'CRITICAL'
        WHEN im.available_stock <= im.safety_stock THEN 'WARNING'  
        ELSE 'NORMAL'
    END as alert_priority
FROM inventory_main im
JOIN products p ON im.sku_id = p.sku_id
WHERE im.available_stock <= im.safety_stock
ORDER BY im.available_stock ASC, im.updated_time DESC;
```

### 6.2 åº“å­˜æ°´ä½çº¿åŠ¨æ€è°ƒæ•´


**ğŸ“ˆ åŠ¨æ€å®‰å…¨åº“å­˜è®¡ç®—**
```java
// Javaä»£ç ï¼šåŠ¨æ€è°ƒæ•´å®‰å…¨åº“å­˜
@Service  
public class InventoryWaterlineService {
    
    /**
     * æ ¹æ®é”€å”®æ•°æ®åŠ¨æ€è°ƒæ•´å®‰å…¨åº“å­˜
     */
    public void adjustSafetyStock(String skuId, String warehouseId) {
        // è®¡ç®—æœ€è¿‘30å¤©çš„å¹³å‡æ—¥é”€é‡
        double avgDailySales = calculateAverageDailySales(skuId, warehouseId, 30);
        
        // è®¡ç®—é”€é‡æ³¢åŠ¨ç³»æ•°
        double salesVolatility = calculateSalesVolatility(skuId, warehouseId, 30);
        
        // è·å–ä¾›åº”å•†å¹³å‡äº¤ä»˜å‘¨æœŸï¼ˆå¤©ï¼‰
        int leadTimeDays = getSupplierLeadTime(skuId);
        
        // åŠ¨æ€å®‰å…¨åº“å­˜ = å¹³å‡æ—¥é”€é‡ Ã— äº¤ä»˜å‘¨æœŸ Ã— (1 + æ³¢åŠ¨ç³»æ•°)
        int newSafetyStock = (int) Math.ceil(avgDailySales * leadTimeDays * (1 + salesVolatility));
        
        // è®¾ç½®æœ€å°å’Œæœ€å¤§å®‰å…¨åº“å­˜é™åˆ¶
        newSafetyStock = Math.max(newSafetyStock, 5); // æœ€å°‘5ä»¶
        newSafetyStock = Math.min(newSafetyStock, 1000); // æœ€å¤š1000ä»¶
        
        // æ›´æ–°å®‰å…¨åº“å­˜
        inventoryMapper.updateSafetyStock(skuId, warehouseId, newSafetyStock);
        
        log.info("åŠ¨æ€è°ƒæ•´å®‰å…¨åº“å­˜: SKU={}, ä»“åº“={}, æ–°å®‰å…¨åº“å­˜={}", 
                skuId, warehouseId, newSafetyStock);
    }
}
```

### 6.3 åº“å­˜å®æ—¶ç›‘æ§å‘Šè­¦


**ğŸ”” å‘Šè­¦è§¦å‘æœºåˆ¶**
```java
// åº“å­˜å‘Šè­¦æœåŠ¡
@Component
public class InventoryAlertService {
    
    @EventListener
    public void handleInventoryChange(InventoryChangeEvent event) {
        String skuId = event.getSkuId();
        String warehouseId = event.getWarehouseId();
        int currentStock = event.getCurrentStock();
        
        // æ£€æŸ¥æ˜¯å¦è§¦å‘å‘Šè­¦
        List<AlertRule> triggeredRules = checkAlertRules(skuId, warehouseId, currentStock);
        
        for (AlertRule rule : triggeredRules) {
            // æ£€æŸ¥å‘Šè­¦é¢‘ç‡é™åˆ¶
            if (shouldSendAlert(rule, skuId, warehouseId)) {
                sendAlert(rule, skuId, warehouseId, currentStock);
                recordAlertSent(rule, skuId, warehouseId);
            }
        }
    }
    
    private void sendAlert(AlertRule rule, String skuId, String warehouseId, int currentStock) {
        AlertMessage message = AlertMessage.builder()
            .title("åº“å­˜å‘Šè­¦")
            .content(String.format("å•†å“%såœ¨ä»“åº“%såº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜ï¼š%d", 
                    skuId, warehouseId, currentStock))
            .level(rule.getAlertLevel())
            .skuId(skuId)
            .warehouseId(warehouseId)
            .build();
            
        // å‘é€å‘Šè­¦ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€é’‰é’‰ç­‰ï¼‰
        alertNotificationService.sendAlert(message);
    }
}
```

---

## 7. ğŸ”„ å¤šä»“åº“åº“å­˜åŒæ­¥


### 7.1 å¤šæ¸ é“åº“å­˜åŒæ­¥ç­–ç•¥


**ğŸŒ åº“å­˜åŒæ­¥æ¶æ„**
```
åº“å­˜åŒæ­¥æ¶æ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   çº¿ä¸Šå•†åŸ   â”‚    â”‚   çº¿ä¸‹é—¨åº—   â”‚    â”‚  ç¬¬ä¸‰æ–¹å¹³å°  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚                  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  åº“å­˜ä¸­å¿ƒç³»ç»Ÿ    â”‚ â† ç»Ÿä¸€åº“å­˜ç®¡ç†
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ååŒ—ä»“åº“   â”‚    â”‚   åä¸œä»“åº“   â”‚    â”‚   åå—ä»“åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”„ åº“å­˜åŒæ­¥ç­–ç•¥**
```java
// åº“å­˜åŒæ­¥ç­–ç•¥é…ç½®
@Configuration
public class InventorySyncConfig {
    
    /**
     * ä¸åŒæ¸ é“çš„åŒæ­¥ç­–ç•¥
     */
    public enum SyncStrategy {
        REAL_TIME,    // å®æ—¶åŒæ­¥ï¼šçº¿ä¸Šå•†åŸç­‰å¯¹åº“å­˜å‡†ç¡®æ€§è¦æ±‚é«˜çš„æ¸ é“
        BATCH_SYNC,   // æ‰¹é‡åŒæ­¥ï¼šç¬¬ä¸‰æ–¹å¹³å°ç­‰å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„æ¸ é“  
        SCHEDULED     // å®šæ—¶åŒæ­¥ï¼šçº¿ä¸‹é—¨åº—ç­‰å¯ä»¥æ¥å—å»¶è¿Ÿçš„æ¸ é“
    }
    
    /**
     * åº“å­˜åˆ†é…ä¼˜å…ˆçº§
     */
    public enum AllocationPriority {
        HIGH,    // é«˜ä¼˜å…ˆçº§ï¼šVIPå®¢æˆ·ã€é¢„å”®å•†å“
        NORMAL,  // æ™®é€šä¼˜å…ˆçº§ï¼šæ­£å¸¸è®¢å•
        LOW      // ä½ä¼˜å…ˆçº§ï¼šè¯•ç”¨ã€èµ å“ç­‰
    }
}
```

### 7.2 åº“å­˜è°ƒæ‹¨ç®¡ç†


**ğŸ“¦ åº“å­˜è°ƒæ‹¨è¡¨è®¾è®¡**
```sql
-- åº“å­˜è°ƒæ‹¨è¡¨
CREATE TABLE inventory_transfer (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    transfer_no varchar(64) NOT NULL COMMENT 'è°ƒæ‹¨å•å·',
    sku_id varchar(64) NOT NULL COMMENT 'SKUç¼–ç ', 
    from_warehouse_id varchar(32) NOT NULL COMMENT 'æºä»“åº“',
    to_warehouse_id varchar(32) NOT NULL COMMENT 'ç›®æ ‡ä»“åº“',
    transfer_quantity int NOT NULL COMMENT 'è°ƒæ‹¨æ•°é‡',
    transfer_status tinyint DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1ç”³è¯· 2å®¡æ ¸é€šè¿‡ 3å‡ºåº“ 4åœ¨é€” 5å…¥åº“å®Œæˆ',
    apply_reason varchar(500) COMMENT 'ç”³è¯·åŸå› ',
    operator_id varchar(32) COMMENT 'æ“ä½œäºº',
    apply_time timestamp DEFAULT CURRENT_TIMESTAMP,
    complete_time timestamp NULL,
    INDEX idx_transfer_no (transfer_no),
    INDEX idx_sku_status (sku_id, transfer_status)
) COMMENT='åº“å­˜è°ƒæ‹¨è¡¨';
```

**âš¡ è°ƒæ‹¨æ‰§è¡Œæµç¨‹**
```sql
-- åº“å­˜è°ƒæ‹¨æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE ExecuteInventoryTransfer(
    IN p_transfer_no VARCHAR(64),
    OUT p_result INT
)
BEGIN
    DECLARE v_sku_id VARCHAR(64);
    DECLARE v_from_warehouse VARCHAR(32);
    DECLARE v_to_warehouse VARCHAR(32);
    DECLARE v_quantity INT;
    DECLARE v_available_stock INT;
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION 
    BEGIN
        ROLLBACK;
        SET p_result = 0;
    END;
    
    START TRANSACTION;
    
    -- è·å–è°ƒæ‹¨ä¿¡æ¯
    SELECT sku_id, from_warehouse_id, to_warehouse_id, transfer_quantity
    INTO v_sku_id, v_from_warehouse, v_to_warehouse, v_quantity
    FROM inventory_transfer 
    WHERE transfer_no = p_transfer_no AND transfer_status = 2; -- å®¡æ ¸é€šè¿‡çŠ¶æ€
    
    -- æ£€æŸ¥æºä»“åº“åº“å­˜
    SELECT available_stock INTO v_available_stock
    FROM inventory_main 
    WHERE sku_id = v_sku_id AND warehouse_id = v_from_warehouse;
    
    IF v_available_stock >= v_quantity THEN
        -- å‡å°‘æºä»“åº“åº“å­˜
        UPDATE inventory_main SET
            available_stock = available_stock - v_quantity,
            physical_stock = physical_stock - v_quantity,
            version = version + 1
        WHERE sku_id = v_sku_id AND warehouse_id = v_from_warehouse;
        
        -- å¢åŠ ç›®æ ‡ä»“åº“åº“å­˜ï¼ˆå¦‚æœè®°å½•ä¸å­˜åœ¨åˆ™æ’å…¥ï¼‰
        INSERT INTO inventory_main (sku_id, warehouse_id, physical_stock, available_stock)
        VALUES (v_sku_id, v_to_warehouse, v_quantity, v_quantity)
        ON DUPLICATE KEY UPDATE
            physical_stock = physical_stock + v_quantity,
            available_stock = available_stock + v_quantity,
            version = version + 1;
            
        -- æ›´æ–°è°ƒæ‹¨çŠ¶æ€
        UPDATE inventory_transfer SET 
            transfer_status = 5, -- å®Œæˆ
            complete_time = NOW()
        WHERE transfer_no = p_transfer_no;
        
        SET p_result = 1; -- æˆåŠŸ
    ELSE
        SET p_result = -1; -- æºä»“åº“åº“å­˜ä¸è¶³
    END IF;
    
    COMMIT;
END$$
DELIMITER ;
```

---

## 8. ğŸ“Š åº“å­˜ç›˜ç‚¹ä¸æˆæœ¬ç®¡ç†


### 8.1 åº“å­˜ç›˜ç‚¹æ•°æ®å¤„ç†


**ğŸ“‹ ç›˜ç‚¹æ•°æ®è¡¨è®¾è®¡**
```sql
-- åº“å­˜ç›˜ç‚¹ä¸»è¡¨
CREATE TABLE inventory_check_main (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    check_no varchar(64) NOT NULL COMMENT 'ç›˜ç‚¹å•å·',
    warehouse_id varchar(32) NOT NULL COMMENT 'ç›˜ç‚¹ä»“åº“', 
    check_type tinyint NOT NULL COMMENT 'ç›˜ç‚¹ç±»å‹ï¼š1å…¨ç›˜ 2æŠ½ç›˜ 3å¾ªç¯ç›˜ç‚¹',
    check_status tinyint DEFAULT 1 COMMENT 'ç›˜ç‚¹çŠ¶æ€ï¼š1è¿›è¡Œä¸­ 2å·²å®Œæˆ 3å·²è°ƒè´¦',
    start_time timestamp NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    end_time timestamp NULL COMMENT 'ç»“æŸæ—¶é—´',
    checker_id varchar(32) COMMENT 'ç›˜ç‚¹äººå‘˜',
    total_sku_count int DEFAULT 0 COMMENT 'ç›˜ç‚¹SKUæ€»æ•°',
    difference_sku_count int DEFAULT 0 COMMENT 'å·®å¼‚SKUæ•°é‡',
    created_time timestamp DEFAULT CURRENT_TIMESTAMP
) COMMENT='åº“å­˜ç›˜ç‚¹ä¸»è¡¨';

-- åº“å­˜ç›˜ç‚¹æ˜ç»†è¡¨  
CREATE TABLE inventory_check_detail (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    check_no varchar(64) NOT NULL COMMENT 'ç›˜ç‚¹å•å·',
    sku_id varchar(64) NOT NULL COMMENT 'SKUç¼–ç ',
    system_quantity int NOT NULL COMMENT 'ç³»ç»Ÿåº“å­˜æ•°é‡',
    actual_quantity int NOT NULL COMMENT 'å®é™…ç›˜ç‚¹æ•°é‡', 
    difference_quantity int NOT NULL COMMENT 'å·®å¼‚æ•°é‡',
    difference_reason varchar(200) COMMENT 'å·®å¼‚åŸå› ',
    is_adjusted tinyint DEFAULT 0 COMMENT 'æ˜¯å¦å·²è°ƒè´¦',
    check_time timestamp DEFAULT CURRENT_TIMESTAMP
) COMMENT='åº“å­˜ç›˜ç‚¹æ˜ç»†è¡¨';
```

**ğŸ” ç›˜ç‚¹å·®å¼‚åˆ†æ**
```sql
-- åº“å­˜ç›˜ç‚¹å·®å¼‚ç»Ÿè®¡åˆ†æ
SELECT 
    cd.sku_id,
    p.product_name,
    cd.system_quantity,
    cd.actual_quantity,
    cd.difference_quantity,
    CASE 
        WHEN cd.difference_quantity > 0 THEN 'ç›˜ç›ˆ'
        WHEN cd.difference_quantity < 0 THEN 'ç›˜äº'
        ELSE 'æ— å·®å¼‚'
    END as difference_type,
    ROUND(cd.difference_quantity * p.cost_price, 2) as amount_difference,
    cd.difference_reason
FROM inventory_check_detail cd
JOIN products p ON cd.sku_id = p.sku_id  
WHERE cd.check_no = '#{checkNo}'
    AND cd.difference_quantity != 0
ORDER BY ABS(cd.difference_quantity * p.cost_price) DESC;
```

### 8.2 åº“å­˜æˆæœ¬è®¡ç®—æ¨¡å‹


**ğŸ’° ç§»åŠ¨åŠ æƒå¹³å‡æˆæœ¬æ³•**
```sql
-- åº“å­˜æˆæœ¬è®¡ç®—è¡¨
CREATE TABLE inventory_cost (
    id bigint PRIMARY KEY AUTO_INCREMENT,
    sku_id varchar(64) NOT NULL,
    warehouse_id varchar(32) NOT NULL,
    cost_price decimal(10,2) NOT NULL COMMENT 'å½“å‰æˆæœ¬ä»·',
    total_quantity int NOT NULL COMMENT 'æ€»åº“å­˜æ•°é‡',
    total_amount decimal(15,2) NOT NULL COMMENT 'æ€»åº“å­˜é‡‘é¢',
    last_updated timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_sku_warehouse (sku_id, warehouse_id)
) COMMENT='åº“å­˜æˆæœ¬è¡¨';

-- æˆæœ¬æ›´æ–°å­˜å‚¨è¿‡ç¨‹ï¼ˆç§»åŠ¨åŠ æƒå¹³å‡æ³•ï¼‰
DELIMITER $$
CREATE PROCEDURE UpdateInventoryCost(
    IN p_sku_id VARCHAR(64),
    IN p_warehouse_id VARCHAR(32),
    IN p_in_quantity INT,
    IN p_in_price DECIMAL(10,2)
)
BEGIN
    DECLARE v_current_quantity INT DEFAULT 0;
    DECLARE v_current_total_amount DECIMAL(15,2) DEFAULT 0;
    DECLARE v_new_total_quantity INT;
    DECLARE v_new_total_amount DECIMAL(15,2);
    DECLARE v_new_cost_price DECIMAL(10,2);
    
    -- è·å–å½“å‰åº“å­˜æˆæœ¬ä¿¡æ¯
    SELECT total_quantity, total_amount 
    INTO v_current_quantity, v_current_total_amount
    FROM inventory_cost 
    WHERE sku_id = p_sku_id AND warehouse_id = p_warehouse_id;
    
    -- è®¡ç®—æ–°çš„æ€»æ•°é‡å’Œæ€»é‡‘é¢
    SET v_new_total_quantity = v_current_quantity + p_in_quantity;
    SET v_new_total_amount = v_current_total_amount + (p_in_quantity * p_in_price);
    
    -- è®¡ç®—æ–°çš„åŠ æƒå¹³å‡æˆæœ¬ä»·
    IF v_new_total_quantity > 0 THEN
        SET v_new_cost_price = v_new_total_amount / v_new_total_quantity;
    ELSE
        SET v_new_cost_price = p_in_price;
    END IF;
    
    -- æ›´æ–°åº“å­˜æˆæœ¬
    INSERT INTO inventory_cost (sku_id, warehouse_id, cost_price, total_quantity, total_amount)
    VALUES (p_sku_id, p_warehouse_id, v_new_cost_price, v_new_total_quantity, v_new_total_amount)
    ON DUPLICATE KEY UPDATE
        cost_price = v_new_cost_price,
        total_quantity = v_new_total_quantity,
        total_amount = v_new_total_amount;
END$$
DELIMITER ;
```

### 8.3 åº“å­˜å‘¨è½¬ç‡åˆ†æ


**ğŸ“ˆ åº“å­˜å‘¨è½¬ç‡è®¡ç®—**
```sql
-- åº“å­˜å‘¨è½¬ç‡åˆ†æè§†å›¾
CREATE VIEW inventory_turnover_analysis AS
SELECT 
    s.sku_id,
    s.warehouse_id,
    p.product_name,
    p.category_id,
    -- å¹³å‡åº“å­˜ = (æœŸåˆåº“å­˜ + æœŸæœ«åº“å­˜) / 2
    (s.begin_stock + s.end_stock) / 2 as avg_inventory,
    
    -- é”€å”®æˆæœ¬ = é”€å”®æ•°é‡ Ã— å¹³å‡æˆæœ¬ä»·
    s.sales_quantity * ic.cost_price as cost_of_goods_sold,
    
    -- åº“å­˜å‘¨è½¬ç‡ = é”€å”®æˆæœ¬ / å¹³å‡åº“å­˜æˆæœ¬
    CASE 
        WHEN (s.begin_stock + s.end_stock) > 0 THEN
            ROUND((s.sales_quantity * ic.cost_price) / 
                  (((s.begin_stock + s.end_stock) / 2) * ic.cost_price), 2)
        ELSE 0 
    END as turnover_rate,
    
    -- åº“å­˜å‘¨è½¬å¤©æ•° = 365 / åº“å­˜å‘¨è½¬ç‡  
    CASE 
        WHEN (s.sales_quantity * ic.cost_price) > 0 AND (s.begin_stock + s.end_stock) > 0 THEN
            ROUND(365 / ((s.sales_quantity * ic.cost_price) / 
                        (((s.begin_stock + s.end_stock) / 2) * ic.cost_price)), 0)
        ELSE 365
    END as turnover_days
FROM inventory_summary s
JOIN inventory_cost ic ON s.sku_id = ic.sku_id AND s.warehouse_id = ic.warehouse_id
JOIN products p ON s.sku_id = p.sku_id;
```

---

## 9. ğŸš€ æ€§èƒ½ä¼˜åŒ–ä¸æ•°æ®æ²»ç†


### 9.1 åº“å­˜æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–


**âš¡ ç´¢å¼•ä¼˜åŒ–ç­–ç•¥**
```sql
-- åº“å­˜è¡¨å…³é”®ç´¢å¼•è®¾è®¡
CREATE INDEX idx_sku_warehouse_version ON inventory_main(sku_id, warehouse_id, version);
CREATE INDEX idx_available_stock_updated ON inventory_main(available_stock, updated_time);
CREATE INDEX idx_updated_time_sku ON inventory_main(updated_time, sku_id);

-- åº“å­˜æµæ°´è¡¨ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_sku_warehouse_time_type ON inventory_log(sku_id, warehouse_id, created_time, change_type);
CREATE INDEX idx_business_no_type ON inventory_log(business_no, business_type);

-- åˆ†åŒºè¡¨ä¼˜åŒ–ï¼ˆæŒ‰æ—¶é—´åˆ†åŒºï¼‰
ALTER TABLE inventory_log 
PARTITION BY RANGE (TO_DAYS(created_time)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    -- ... æ›´å¤šåˆ†åŒº
    PARTITION pmax VALUES LESS THAN MAXVALUE
);
```

**ğŸ”„ è¯»å†™åˆ†ç¦»ä¼˜åŒ–**
```java
// åº“å­˜è¯»å†™åˆ†ç¦»é…ç½®
@Service
public class InventoryQueryService {
    
    @Autowired
    @Qualifier("masterDataSource")
    private DataSource masterDataSource; // ä¸»åº“ï¼šå†™æ“ä½œ
    
    @Autowired  
    @Qualifier("slaveDataSource")
    private DataSource slaveDataSource;  // ä»åº“ï¼šè¯»æ“ä½œ
    
    /**
     * æŸ¥è¯¢åº“å­˜ï¼ˆä»è¯»åº“æŸ¥è¯¢ï¼‰
     */
    @ReadOnlyTransaction
    public InventoryInfo queryInventory(String skuId, String warehouseId) {
        return inventoryMapper.selectBySkuAndWarehouse(skuId, warehouseId);
    }
    
    /**
     * æ›´æ–°åº“å­˜ï¼ˆä¸»åº“å†™å…¥ï¼‰  
     */
    @WriteTransaction
    public boolean updateInventory(InventoryUpdateRequest request) {
        return inventoryMapper.updateInventoryStock(request) > 0;
    }
}
```

### 9.2 åº“å­˜æœåŠ¡æ•°æ®æ²»ç†


**ğŸ”§ æ•°æ®è´¨é‡ç›‘æ§**
```java
// åº“å­˜æ•°æ®è´¨é‡æ£€æŸ¥æœåŠ¡
@Component
@Slf4j
public class InventoryDataQualityService {
    
    @Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    public void checkInventoryDataQuality() {
        
        // 1. æ£€æŸ¥è´Ÿåº“å­˜å¼‚å¸¸
        List<NegativeInventory> negativeList = inventoryMapper.findNegativeInventory();
        if (!negativeList.isEmpty()) {
            log.error("å‘ç°{}ä¸ªè´Ÿåº“å­˜å¼‚å¸¸", negativeList.size());
            alertService.sendAlert("è´Ÿåº“å­˜å‘Šè­¦", negativeList);
        }
        
        // 2. æ£€æŸ¥åº“å­˜æ•°æ®ä¸ä¸€è‡´
        List<InventoryInconsistency> inconsistentList = inventoryMapper.findInconsistentInventory();
        if (!inconsistentList.isEmpty()) {
            log.warn("å‘ç°{}ä¸ªåº“å­˜æ•°æ®ä¸ä¸€è‡´", inconsistentList.size()); 
            // å°è¯•è‡ªåŠ¨ä¿®å¤
            autoFixInconsistentData(inconsistentList);
        }
        
        // 3. æ£€æŸ¥é•¿æ—¶é—´æœªå˜åŒ–çš„åº“å­˜
        List<StaleInventory> staleList = inventoryMapper.findStaleInventory(30); // 30å¤©æœªå˜åŒ–
        if (!staleList.isEmpty()) {
            log.info("å‘ç°{}ä¸ªé•¿æœŸæœªå˜åŒ–åº“å­˜ï¼Œå»ºè®®å…³æ³¨", staleList.size());
        }
        
        // 4. æ£€æŸ¥å¼‚å¸¸çš„åº“å­˜å˜åŠ¨
        List<AbnormalInventoryChange> abnormalList = inventoryMapper.findAbnormalInventoryChanges();
        for (AbnormalInventoryChange change : abnormalList) {
            log.warn("å‘ç°å¼‚å¸¸åº“å­˜å˜åŠ¨: SKU={}, å˜åŠ¨é‡={}, æ—¶é—´={}", 
                    change.getSkuId(), change.getChangeAmount(), change.getChangeTime());
        }
    }
}
```

### 9.3 åº“å­˜æ•°æ®å½’æ¡£ç­–ç•¥


**ğŸ“ å†å²æ•°æ®å½’æ¡£**
```sql
-- åº“å­˜å†å²æ•°æ®å½’æ¡£è¡¨
CREATE TABLE inventory_log_archive (
    -- ä¸inventory_logç»“æ„ç›¸åŒ
    id bigint PRIMARY KEY,
    sku_id varchar(64) NOT NULL,
    warehouse_id varchar(32) NOT NULL,
    change_type tinyint NOT NULL,
    change_amount int NOT NULL,
    -- ... å…¶ä»–å­—æ®µ
    archive_time timestamp DEFAULT CURRENT_TIMESTAMP COMMENT 'å½’æ¡£æ—¶é—´'
) COMMENT='åº“å­˜æµæ°´å½’æ¡£è¡¨';

-- æ•°æ®å½’æ¡£å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE PROCEDURE ArchiveInventoryLog(
    IN p_archive_days INT  -- å½’æ¡£å¤šå°‘å¤©å‰çš„æ•°æ®
)
BEGIN
    DECLARE v_archive_date DATE;
    DECLARE v_affected_rows INT DEFAULT 0;
    
    SET v_archive_date = DATE_SUB(CURDATE(), INTERVAL p_archive_days DAY);
    
    -- å°†æ—§æ•°æ®ç§»åŠ¨åˆ°å½’æ¡£è¡¨
    INSERT INTO inventory_log_archive 
    SELECT *, NOW() as archive_time
    FROM inventory_log 
    WHERE created_time < v_archive_date;
    
    SET v_affected_rows = ROW_COUNT();
    
    -- åˆ é™¤åŸè¡¨ä¸­çš„æ—§æ•°æ®
    DELETE FROM inventory_log 
    WHERE created_time < v_archive_date;
    
    SELECT CONCAT('æˆåŠŸå½’æ¡£ ', v_affected_rows, ' æ¡åº“å­˜æµæ°´è®°å½•') as result;
END$$
DELIMITER ;
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åº“å­˜åˆ†å±‚ç®¡ç†ï¼šç‰©ç†åº“å­˜ã€å¯é”€å”®åº“å­˜ã€é¢„å åº“å­˜ã€é”å®šåº“å­˜çš„åŒºåˆ«
ğŸ”¸ åº“å­˜æ‰£å‡ç­–ç•¥ï¼šé¢„å æœºåˆ¶ã€é”å®šæœºåˆ¶ã€å®é™…æ‰£å‡çš„ä¸‰é˜¶æ®µæµç¨‹
ğŸ”¸ å¹¶å‘æ§åˆ¶æ–¹æ¡ˆï¼šæ‚²è§‚é”ã€ä¹è§‚é”ã€åˆ†å¸ƒå¼é”çš„é€‚ç”¨åœºæ™¯
ğŸ”¸ è¡¥å¿äº‹åŠ¡æœºåˆ¶ï¼šåº“å­˜å›æ»šã€å¼‚å¸¸æ¢å¤çš„è®¾è®¡æ€è·¯
ğŸ”¸ ç›‘æ§å‘Šè­¦ä½“ç³»ï¼šåº“å­˜é¢„è­¦ã€æ°´ä½çº¿è°ƒæ•´ã€å¼‚å¸¸æ£€æµ‹
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦åº“å­˜åˆ†å±‚ï¼Ÿ**
```
ç°å®ç†è§£ï¼š
å°±åƒé“¶è¡Œè´¦æˆ·åˆ†ä¸ºå¯ç”¨ä½™é¢å’Œå†»ç»“é‡‘é¢ä¸€æ ·ï¼Œåº“å­˜ä¹Ÿéœ€è¦åˆ†å±‚ç®¡ç†ã€‚
ä¸èƒ½æŠŠæ‰€æœ‰åº“å­˜éƒ½å½“ä½œå¯é”€å”®çš„ï¼Œè¦è€ƒè™‘å„ç§ä¸šåŠ¡çŠ¶æ€ã€‚

æŠ€æœ¯ä»·å€¼ï¼š
- é¿å…è¶…å–ï¼šé€šè¿‡é¢„å æœºåˆ¶æå‰é”å®šåº“å­˜
- æé«˜å¹¶å‘ï¼šå‡å°‘é”ç«äº‰ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½
- ä¸šåŠ¡çµæ´»ï¼šæ”¯æŒå¤æ‚çš„ç”µå•†ä¸šåŠ¡åœºæ™¯
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©é”ç­–ç•¥ï¼Ÿ**
```
æ‚²è§‚é”é€‚ç”¨åœºæ™¯ï¼š
âœ… åº“å­˜ç´§å¼ çš„çƒ­é”€å•†å“
âœ… å¹¶å‘å†™å…¥é¢‘ç¹çš„åœºæ™¯
âœ… å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚æé«˜

ä¹è§‚é”é€‚ç”¨åœºæ™¯ï¼š  
âœ… åº“å­˜å……è¶³çš„å•†å“
âœ… è¯»å¤šå†™å°‘çš„åœºæ™¯
âœ… å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜

åˆ†å¸ƒå¼é”é€‚ç”¨åœºæ™¯ï¼š
âœ… å¤šæœåŠ¡å™¨éƒ¨ç½²
âœ… éœ€è¦å…¨å±€åè°ƒçš„æ“ä½œ
âœ… è·¨ç³»ç»Ÿçš„åº“å­˜æ“ä½œ
```

### 10.3 å®æˆ˜åº”ç”¨ä»·å€¼


**ğŸ¯ ç”µå•†åœºæ™¯åº”ç”¨**
- **ç§’æ€ç³»ç»Ÿ**ï¼šä½¿ç”¨é¢„å +é”å®šæœºåˆ¶é˜²æ­¢è¶…å–
- **å¤šæ¸ é“é”€å”®**ï¼šç»Ÿä¸€åº“å­˜ä¸­å¿ƒç®¡ç†æ‰€æœ‰é”€å”®æ¸ é“
- **åº“å­˜è°ƒæ‹¨**ï¼šæ”¯æŒå¤šä»“åº“é—´çš„åº“å­˜æµè½¬
- **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„è¡¥å¿æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§

**ğŸ”§ ç³»ç»Ÿè®¾è®¡è¦ç‚¹**
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•å’Œä¸šåŠ¡å¢é•¿
- **é«˜å¯ç”¨æ€§**ï¼šå¤šå±‚å®¹é”™å’Œå¿«é€Ÿæ¢å¤æœºåˆ¶
- **ç›‘æ§å®Œå–„**ï¼šå…¨æ–¹ä½çš„åº“å­˜ç›‘æ§å’Œå‘Šè­¦
- **æ•°æ®æ²»ç†**ï¼šå®Œå–„çš„æ•°æ®è´¨é‡ç®¡ç†ä½“ç³»

**ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
- **è¯»å†™åˆ†ç¦»**ï¼šæŸ¥è¯¢èµ°ä»åº“ï¼Œæ›´æ–°èµ°ä¸»åº“
- **ç¼“å­˜æœºåˆ¶**ï¼šçƒ­ç‚¹åº“å­˜æ•°æ®ç¼“å­˜åŠ é€Ÿ
- **æ‰¹é‡å¤„ç†**ï¼šåˆå¹¶å°äº‹åŠ¡æå‡æ•ˆç‡
- **å¼‚æ­¥å¤„ç†**ï¼šéæ ¸å¿ƒæµç¨‹å¼‚æ­¥åŒ–

### 10.4 æ ¸å¿ƒè®°å¿†è¦ç‚¹


**ğŸ“ åº“å­˜è®¾è®¡ä¸‰åŸåˆ™**
```
1. åˆ†å±‚è®¾è®¡ï¼šä¸åŒçŠ¶æ€çš„åº“å­˜è¦åˆ†å¼€ç®¡ç†
2. é˜²è¶…å–ï¼šé€šè¿‡é¢„å å’Œé”å®šæœºåˆ¶ç¡®ä¿ä¸ä¼šå–è¶…
3. å¯æ¢å¤ï¼šä»»ä½•å¼‚å¸¸éƒ½è¦æœ‰å¯¹åº”çš„è¡¥å¿æœºåˆ¶
```

**âš¡ æ€§èƒ½ä¼˜åŒ–ä¸‰è¦ç´ **  
```
1. ç´¢å¼•ä¼˜åŒ–ï¼šåˆç†è®¾è®¡æ•°æ®åº“ç´¢å¼•æå‡æŸ¥è¯¢æ•ˆç‡
2. é”ç­–ç•¥ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„å¹¶å‘æ§åˆ¶æ–¹æ¡ˆ  
3. ç¼“å­˜åº”ç”¨ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜å‡å°‘æ•°æ®åº“å‹åŠ›
```

**ğŸ”” ç›‘æ§å‘Šè­¦ä¸‰å±‚æ¬¡**
```
1. å®æ—¶ç›‘æ§ï¼šåº“å­˜æ•°é‡ã€ç³»ç»Ÿæ€§èƒ½ã€å¼‚å¸¸äº‹ä»¶
2. è¶‹åŠ¿åˆ†æï¼šåº“å­˜å‘¨è½¬ã€æˆæœ¬å˜åŒ–ã€ä¸šåŠ¡å¢é•¿
3. é¢„æµ‹å‘Šè­¦ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹åº“å­˜é£é™©
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> åº“å­˜åˆ†å±‚é˜²è¶…å–ï¼Œé¢„å é”å®šè¦åˆ†å¼€  
> è¡¥å¿æœºåˆ¶ä¿ä¸€è‡´ï¼Œç›‘æ§å‘Šè­¦ä¸å¯ç¼º  
> æ€§èƒ½ä¼˜åŒ–ä¸‰æ¿æ–§ï¼Œç´¢å¼•ç¼“å­˜åŠ é”ç­–  
> æ•°æ®æ²»ç†æ˜¯åŸºç¡€ï¼Œå½’æ¡£æ¸…ç†è¦åŠæ—¶