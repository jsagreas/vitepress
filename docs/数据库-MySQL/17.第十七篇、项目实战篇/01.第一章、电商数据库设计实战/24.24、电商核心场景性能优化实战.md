---
title: 24ã€ç”µå•†æ ¸å¿ƒåœºæ™¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [çƒ­ç‚¹å•†å“æ•°æ®å¤„ç†ç­–ç•¥](#1-çƒ­ç‚¹å•†å“æ•°æ®å¤„ç†ç­–ç•¥)
2. [ç§’æ€ç³»ç»Ÿæ¶æ„ä¼˜åŒ–](#2-ç§’æ€ç³»ç»Ÿæ¶æ„ä¼˜åŒ–)
3. [åº“å­˜æ‰£å‡æ€§èƒ½è°ƒä¼˜](#3-åº“å­˜æ‰£å‡æ€§èƒ½è°ƒä¼˜)
4. [å¤§ä¿ƒæµé‡å‰Šå³°å¡«è°·](#4-å¤§ä¿ƒæµé‡å‰Šå³°å¡«è°·)
5. [è®¢å•ä¸€è‡´æ€§ä¿è¯æ–¹æ¡ˆ](#5-è®¢å•ä¸€è‡´æ€§ä¿è¯æ–¹æ¡ˆ)
6. [æ”¯ä»˜ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–](#6-æ”¯ä»˜ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–)
7. [ç”µå•†æ ¸å¿ƒé“¾è·¯ç›‘æ§](#7-ç”µå•†æ ¸å¿ƒé“¾è·¯ç›‘æ§)
8. [é«˜å¹¶å‘åœºæ™¯æ•°æ®åº“è®¾è®¡](#8-é«˜å¹¶å‘åœºæ™¯æ•°æ®åº“è®¾è®¡)
9. [ç¼“å­˜ç©¿é€é›ªå´©å¤„ç†](#9-ç¼“å­˜ç©¿é€é›ªå´©å¤„ç†)
10. [åˆ†å¸ƒå¼é”ä¼˜åŒ–ç­–ç•¥](#10-åˆ†å¸ƒå¼é”ä¼˜åŒ–ç­–ç•¥)
11. [å¼‚æ­¥å¤„ç†é˜Ÿåˆ—è®¾è®¡](#11-å¼‚æ­¥å¤„ç†é˜Ÿåˆ—è®¾è®¡)
12. [é™çº§ç†”æ–­æœºåˆ¶å®ç°](#12-é™çº§ç†”æ–­æœºåˆ¶å®ç°)
13. [æ ¸å¿ƒé“¾è·¯æ€§èƒ½åŸºçº¿å»ºç«‹](#13-æ ¸å¿ƒé“¾è·¯æ€§èƒ½åŸºçº¿å»ºç«‹)
14. [æ€§èƒ½ç“¶é¢ˆè‡ªåŠ¨è¯†åˆ«ç®—æ³•](#14-æ€§èƒ½ç“¶é¢ˆè‡ªåŠ¨è¯†åˆ«ç®—æ³•)
15. [å®¹é‡è§„åˆ’é¢„æµ‹æ¨¡å‹](#15-å®¹é‡è§„åˆ’é¢„æµ‹æ¨¡å‹)
16. [æ€§èƒ½ä¼˜åŒ–æ•ˆæœè¯„ä¼°ä½“ç³»](#16-æ€§èƒ½ä¼˜åŒ–æ•ˆæœè¯„ä¼°ä½“ç³»)
17. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#17-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”¥ çƒ­ç‚¹å•†å“æ•°æ®å¤„ç†ç­–ç•¥


### 1.1 ä»€ä¹ˆæ˜¯çƒ­ç‚¹å•†å“é—®é¢˜


**ğŸ”¸ æ ¸å¿ƒæ¦‚å¿µ**
```
çƒ­ç‚¹å•†å“ï¼šçŸ­æ—¶é—´å†…è¢«å¤§é‡ç”¨æˆ·è®¿é—®çš„å•†å“
å…¸å‹åœºæ™¯ï¼šæ–°iPhoneå‘å¸ƒã€æ˜æ˜Ÿä»£è¨€çˆ†å“ã€é™æ—¶ç§’æ€å•†å“
é—®é¢˜æœ¬è´¨ï¼šå°‘æ•°å•†å“æ‰¿è½½ç»å¤§éƒ¨åˆ†æµé‡ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›é›†ä¸­
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒæ¼”å”±ä¼šå¼€ç¥¨ï¼Œæ‰€æœ‰äººéƒ½åœ¨æŠ¢åŒä¸€åœºç¥¨ï¼Œå”®ç¥¨ç½‘ç«™å°±ä¼šå´©æºƒ

**ğŸ“Š çƒ­ç‚¹å•†å“ç‰¹å¾**
| ç‰¹å¾ç»´åº¦ | æ™®é€šå•†å“ | çƒ­ç‚¹å•†å“ | å½±å“ç¨‹åº¦ |
|----------|----------|----------|----------|
| ğŸ“ˆ è®¿é—®é‡ | 100æ¬¡/åˆ†é’Ÿ | 10ä¸‡æ¬¡/åˆ†é’Ÿ | â­â­â­â­â­ |
| ğŸ• é›†ä¸­åº¦ | åˆ†æ•£è®¿é—® | ç¬é—´çˆ†å‘ | â­â­â­â­â­ |
| ğŸ’¾ ç¼“å­˜å‘½ä¸­ | 80% | å¯èƒ½ä¸º0% | â­â­â­â­ |

### 1.2 çƒ­ç‚¹è¯†åˆ«æœºåˆ¶


**ğŸ¯ å®æ—¶çƒ­ç‚¹è¯†åˆ«**
```sql
-- ç®€åŒ–çš„çƒ­ç‚¹å•†å“è¯†åˆ«æŸ¥è¯¢
SELECT 
    product_id,
    COUNT(*) as access_count,
    COUNT(*)/300 as qps  -- 5åˆ†é’Ÿå†…çš„QPS
FROM product_access_log 
WHERE access_time >= NOW() - INTERVAL 5 MINUTE
GROUP BY product_id 
HAVING access_count > 1000  -- 5åˆ†é’Ÿè¶…è¿‡1000æ¬¡è®¿é—®
ORDER BY access_count DESC;
```

**ğŸ”„ çƒ­ç‚¹å¤„ç†æµç¨‹**
```
æ­¥éª¤1: å®æ—¶ç›‘æ§ â†’ è¯†åˆ«QPSå¼‚å¸¸å•†å“
   â†“
æ­¥éª¤2: è‡ªåŠ¨æ ‡è®° â†’ å°†å•†å“æ ‡è®°ä¸ºçƒ­ç‚¹
   â†“  
æ­¥éª¤3: ç¼“å­˜é¢„çƒ­ â†’ æå‰åŠ è½½åˆ°å¤šçº§ç¼“å­˜
   â†“
æ­¥éª¤4: æµé‡åˆ†æ•£ â†’ å¯ç”¨CDNå’Œæœ¬åœ°ç¼“å­˜
```

### 1.3 å¤šçº§ç¼“å­˜ç­–ç•¥


**ğŸ—ï¸ ç¼“å­˜æ¶æ„è®¾è®¡**
```
ç”¨æˆ·è¯·æ±‚ â†’ æœ¬åœ°ç¼“å­˜(L1) â†’ Redisç¼“å­˜(L2) â†’ æ•°æ®åº“(L3)
           â†“               â†“              â†“
          1mså“åº”         5mså“åº”        50mså“åº”
```

**ğŸ’» æ ¸å¿ƒå®ç°ä»£ç **
```java
@Service
public class HotProductService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    // å¤šçº§ç¼“å­˜æŸ¥è¯¢çƒ­ç‚¹å•†å“
    public Product getHotProduct(Long productId) {
        // L1: æœ¬åœ°ç¼“å­˜(JVMå†…å­˜)
        Product product = localCache.get(productId);
        if (product != null) {
            return product;
        }
        
        // L2: Redisç¼“å­˜
        product = (Product) redisTemplate.opsForValue()
            .get("hot:product:" + productId);
        if (product != null) {
            localCache.put(productId, product);
            return product;
        }
        
        // L3: æ•°æ®åº“æŸ¥è¯¢
        product = productMapper.selectById(productId);
        if (product != null) {
            // çƒ­ç‚¹å•†å“ç¼“å­˜30åˆ†é’Ÿ
            redisTemplate.opsForValue()
                .set("hot:product:" + productId, product, 30, TimeUnit.MINUTES);
            localCache.put(productId, product);
        }
        
        return product;
    }
}
```

**ğŸ¯ çƒ­ç‚¹æ•°æ®ç‰¹æ®Šå¤„ç†**
- **é¢„çƒ­ç­–ç•¥**ï¼šæ´»åŠ¨å‰2å°æ—¶è‡ªåŠ¨é¢„çƒ­çƒ­ç‚¹å•†å“æ•°æ®
- **å¤šå‰¯æœ¬**ï¼šçƒ­ç‚¹å•†å“åœ¨Redisé›†ç¾¤ä¸­å­˜å‚¨å¤šä¸ªå‰¯æœ¬
- **é™çº§æ–¹æ¡ˆ**ï¼šç¼“å­˜å¤±æ•ˆæ—¶è¿”å›é™æ€ç‰ˆæœ¬å•†å“ä¿¡æ¯

---

## 2. âš¡ ç§’æ€ç³»ç»Ÿæ¶æ„ä¼˜åŒ–


### 2.1 ç§’æ€ç³»ç»Ÿæ ¸å¿ƒæŒ‘æˆ˜


**ğŸ”¸ ç§’æ€åœºæ™¯ç‰¹ç‚¹**
```
ç¬é—´å¹¶å‘ï¼š10ä¸‡äººæŠ¢100ä»¶å•†å“
è¯»å†™æ¯”ä¾‹ï¼š99%è¯»(æŸ¥çœ‹) + 1%å†™(ä¸‹å•)
æ—¶é—´é›†ä¸­ï¼šæ´»åŠ¨å¼€å§‹çš„å‰30ç§’å†…
æˆåŠŸç‡ä½ï¼š99.9%çš„è¯·æ±‚æ³¨å®šå¤±è´¥
```

> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šç§’æ€å°±åƒåœ°é“æ—©é«˜å³°ï¼Œå¤§å®¶éƒ½æŒ¤åœ¨åŒä¸€ä¸ªæ—¶é—´è¿›åŒä¸€æ‰‡é—¨

### 2.2 ç§’æ€æ¶æ„è®¾è®¡


**ğŸ—ï¸ ç§’æ€ç³»ç»Ÿæ¶æ„å›¾**
```
                    ç§’æ€ç³»ç»Ÿæ¶æ„
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚       CDN + é™æ€åŒ–          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      ç½‘å…³ + é™æµå™¨           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚     ç§’æ€æœåŠ¡é›†ç¾¤              â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Redisé›†ç¾¤    â”‚  MQ   â”‚   MySQLé›†ç¾¤    â”‚
    â”‚   (åº“å­˜è®¡æ•°)    â”‚ (å‰Šå³°) â”‚   (æœ€ç»ˆä¸€è‡´)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ ¸å¿ƒä¼˜åŒ–ç­–ç•¥


**ğŸ¯ å‰ç«¯ä¼˜åŒ–**
- **æŒ‰é’®æ§åˆ¶**ï¼šç§’æ€æœªå¼€å§‹æ—¶æŒ‰é’®ç½®ç°ï¼Œé¿å…æ— æ•ˆè¯·æ±‚
- **æœ¬åœ°è®¡æ—¶**ï¼šå®¢æˆ·ç«¯å€’è®¡æ—¶ï¼Œå‡å°‘æœåŠ¡ç«¯æ—¶é—´æŸ¥è¯¢
- **é˜²é‡å¤ç‚¹å‡»**ï¼šç‚¹å‡»åç«‹å³ç¦ç”¨æŒ‰é’®5ç§’

**âš™ï¸ æœåŠ¡ç«¯ä¼˜åŒ–**
```java
@RestController
public class SeckillController {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @PostMapping("/seckill/{productId}")
    public Result seckill(@PathVariable Long productId, @RequestParam Long userId) {
        
        // 1. æ—¶é—´æ ¡éªŒ - é¿å…æå‰è¯·æ±‚
        if (!isInSeckillTime(productId)) {
            return Result.fail("ç§’æ€æœªå¼€å§‹æˆ–å·²ç»“æŸ");
        }
        
        // 2. ç”¨æˆ·æ ¡éªŒ - é˜²æ­¢é‡å¤å‚ä¸
        String userKey = "seckill:user:" + productId + ":" + userId;
        if (redisTemplate.hasKey(userKey)) {
            return Result.fail("æ‚¨å·²å‚ä¸è¿‡æ­¤æ¬¡ç§’æ€");
        }
        
        // 3. åº“å­˜é¢„æ‰£ - RedisåŸå­æ“ä½œ
        String stockKey = "seckill:stock:" + productId;
        Long stock = redisTemplate.opsForValue().decrement(stockKey);
        
        if (stock < 0) {
            // åº“å­˜ä¸è¶³ï¼Œæ¢å¤åº“å­˜
            redisTemplate.opsForValue().increment(stockKey);
            return Result.fail("å•†å“å·²å”®ç½„");
        }
        
        // 4. è®°å½•ç”¨æˆ·å‚ä¸
        redisTemplate.opsForValue().set(userKey, "1", 86400, TimeUnit.SECONDS);
        
        // 5. å‘é€MQæ¶ˆæ¯ - å¼‚æ­¥åˆ›å»ºè®¢å•
        SeckillMessage message = new SeckillMessage(productId, userId);
        messageQueue.send(message);
        
        return Result.success("æ’é˜Ÿä¸­ï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ");
    }
}
```

**ğŸ“Š æ€§èƒ½å¯¹æ¯”**
| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å€æ•° |
|----------|--------|--------|----------|
| ğŸš€ å“åº”æ—¶é—´ | 500ms | 50ms | 10å€ |
| ğŸ“ˆ å¹¶å‘é‡ | 1000/s | 50000/s | 50å€ |
| ğŸ’¾ æ•°æ®åº“å‹åŠ› | 100% | 5% | é™ä½95% |

---

## 3. ğŸ“¦ åº“å­˜æ‰£å‡æ€§èƒ½è°ƒä¼˜


### 3.1 åº“å­˜æ‰£å‡çš„æ ¸å¿ƒé—®é¢˜


**ğŸ”¸ ä¼ ç»Ÿåº“å­˜æ‰£å‡é—®é¢˜**
```sql
-- ä¼ ç»Ÿæ–¹å¼ï¼šå…ˆæŸ¥è¯¢å†æ›´æ–°(å­˜åœ¨å¹¶å‘é—®é¢˜)
SELECT stock FROM product WHERE id = 123;  -- æŸ¥è¯¢åº“å­˜100
-- å¦‚æœåº“å­˜å¤Ÿï¼Œæ‰§è¡Œæ›´æ–°
UPDATE product SET stock = stock - 1 WHERE id = 123;  -- å¤šä¸ªè¯·æ±‚åŒæ—¶æ‰§è¡Œä¼šè¶…å–
```

> âŒ **é—®é¢˜æ‰€åœ¨**ï¼šæŸ¥è¯¢å’Œæ›´æ–°ä¸æ˜¯åŸå­æ“ä½œï¼Œé«˜å¹¶å‘æ—¶ä¼šå‡ºç°è¶…å–

### 3.2 æ•°æ®åº“å±‚é¢ä¼˜åŒ–


**âœ… æ­£ç¡®çš„åº“å­˜æ‰£å‡**
```sql
-- æ–¹æ¡ˆ1: ä¹è§‚é” - åŸºäºç‰ˆæœ¬å·
UPDATE product 
SET stock = stock - 1, version = version + 1
WHERE id = 123 AND version = 1 AND stock > 0;

-- æ–¹æ¡ˆ2: æ‚²è§‚é” - è¡Œé”æ§åˆ¶
SELECT stock FROM product WHERE id = 123 FOR UPDATE;
UPDATE product SET stock = stock - 1 WHERE id = 123;

-- æ–¹æ¡ˆ3: åŸå­æ“ä½œ - ç›´æ¥åˆ¤æ–­
UPDATE product 
SET stock = stock - 1 
WHERE id = 123 AND stock > 0;
-- é€šè¿‡affected_rowsåˆ¤æ–­æ˜¯å¦æ‰£å‡æˆåŠŸ
```

**ğŸ“Š ä¸åŒæ–¹æ¡ˆå¯¹æ¯”**
| æ–¹æ¡ˆç±»å‹ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|------|----------|
| ğŸ”“ ä¹è§‚é” | æ— é”ç­‰å¾…ï¼Œæ€§èƒ½å¥½ | å†²çªæ—¶éœ€é‡è¯• | å¹¶å‘é€‚ä¸­åœºæ™¯ |
| ğŸ”’ æ‚²è§‚é” | æ•°æ®ä¸€è‡´æ€§å¼º | é”ç­‰å¾…ï¼Œæ€§èƒ½å·® | å¼ºä¸€è‡´æ€§è¦æ±‚ |
| âš›ï¸ åŸå­æ“ä½œ | ç®€å•å¯é  | éœ€è¦ä¸šåŠ¡åˆ¤æ–­ | ä¸€èˆ¬ç”µå•†åœºæ™¯ |

### 3.3 Rediså±‚é¢åº“å­˜ç®¡ç†


**ğŸš€ RedisåŸå­åº“å­˜æ“ä½œ**
```java
@Service
public class StockService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * RedisåŸå­æ‰£å‡åº“å­˜
     * @param productId å•†å“ID
     * @param quantity æ‰£å‡æ•°é‡
     * @return æ‰£å‡ååº“å­˜ï¼Œ-1è¡¨ç¤ºåº“å­˜ä¸è¶³
     */
    public Long decrStock(Long productId, Integer quantity) {
        String stockKey = "stock:" + productId;
        
        // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = 
            "local stock = redis.call('GET', KEYS[1]) " +
            "if not stock then return -1 end " +
            "stock = tonumber(stock) " +
            "if stock >= tonumber(ARGV[1]) then " +
            "    return redis.call('DECRBY', KEYS[1], ARGV[1]) " +
            "else " +
            "    return -1 " +
            "end";
        
        DefaultRedisScript<Long> script = new DefaultRedisScript<>();
        script.setScriptText(luaScript);
        script.setResultType(Long.class);
        
        return redisTemplate.execute(script, 
            Arrays.asList(stockKey), quantity.toString());
    }
}
```

### 3.4 åº“å­˜åŒæ­¥ç­–ç•¥


**ğŸ”„ Redisä¸MySQLåº“å­˜åŒæ­¥**
```
å®æ—¶æ–¹æ¡ˆ: Redisæ‰£å‡æˆåŠŸ â†’ ç«‹å³åŒæ­¥MySQL
å®šæ—¶æ–¹æ¡ˆ: Redisæ‰£å‡æˆåŠŸ â†’ MQå¼‚æ­¥ â†’ å®šæ—¶åŒæ­¥MySQL  
æ··åˆæ–¹æ¡ˆ: æ­£å¸¸æ—¶å®šæ—¶åŒæ­¥ï¼Œå¼‚å¸¸æ—¶å®æ—¶åŒæ­¥
```

> ğŸ’¡ **æ¨èç­–ç•¥**ï¼šRedisåšå®æ—¶åº“å­˜æ§åˆ¶ï¼ŒMySQLåšæœ€ç»ˆåº“å­˜è®°å½•ï¼Œé€šè¿‡MQå¼‚æ­¥åŒæ­¥

---

## 4. ğŸŒŠ å¤§ä¿ƒæµé‡å‰Šå³°å¡«è°·


### 4.1 æµé‡ç‰¹å¾åˆ†æ


**ğŸ“ˆ å¤§ä¿ƒæµé‡ç‰¹ç‚¹**
```
å¹³æ—¶æµé‡: â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
å¤§ä¿ƒæµé‡: â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â–²â–²â–²â–²â–²â–²â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
                          â”‚    â”‚
                     æ´»åŠ¨å¼€å§‹  æ´»åŠ¨ç»“æŸ
```

**ğŸ¯ æµé‡å†²å‡»åˆ†æ**
- **å³°å€¼å€æ•°**ï¼šå¤§ä¿ƒæœŸé—´æµé‡æ˜¯å¹³æ—¶çš„50-100å€
- **æ—¶é—´åˆ†å¸ƒ**ï¼š80%æµé‡é›†ä¸­åœ¨æ´»åŠ¨å¼€å§‹çš„å‰2å°æ—¶
- **è¯·æ±‚ç±»å‹**ï¼šæŸ¥çœ‹å•†å“å 90%ï¼Œä¸‹å•æ”¯ä»˜å 10%

### 4.2 å‰Šå³°ç­–ç•¥è®¾è®¡


**ğŸ”§ å¤šå±‚å‰Šå³°æ–¹æ¡ˆ**
```
                     å‰Šå³°å¡«è°·æ¶æ„
    ç”¨æˆ·è¯·æ±‚ â†’ CDNé™æ€åŒ– â†’ APIé™æµ â†’ æœåŠ¡é™çº§ â†’ MQå‰Šå³° â†’ æ•°æ®åº“
    100ä¸‡    â†’   20ä¸‡   â†’  5ä¸‡   â†’   2ä¸‡   â†’  å¹³ç¨³  â†’  å¹³ç¨³
```

**âš™ï¸ é™æµç®—æ³•å®ç°**
```java
@Component
public class RateLimiter {
    
    private final RedisTemplate<String, String> redisTemplate;
    
    /**
     * ä»¤ç‰Œæ¡¶é™æµç®—æ³•
     * @param key é™æµkey
     * @param capacity æ¡¶å®¹é‡
     * @param tokens æ¯ç§’æ”¾å…¥ä»¤ç‰Œæ•°
     * @return true:é€šè¿‡ false:æ‹’ç»
     */
    public boolean isAllowed(String key, int capacity, int tokens) {
        String script = 
            "local key = KEYS[1] " +
            "local capacity = tonumber(ARGV[1]) " +
            "local tokens = tonumber(ARGV[2]) " +
            "local interval = tonumber(ARGV[3]) " +
            
            "local bucket = redis.call('HMGET', key, 'tokens', 'last_time') " +
            "local current_tokens = tonumber(bucket[1]) or capacity " +
            "local last_time = tonumber(bucket[2]) or 0 " +
            "local current_time = redis.call('TIME')[1] " +
            
            "local add_tokens = math.floor((current_time - last_time) * tokens) " +
            "current_tokens = math.min(capacity, current_tokens + add_tokens) " +
            
            "if current_tokens >= 1 then " +
            "    current_tokens = current_tokens - 1 " +
            "    redis.call('HMSET', key, 'tokens', current_tokens, 'last_time', current_time) " +
            "    redis.call('EXPIRE', key, 3600) " +
            "    return 1 " +
            "else " +
            "    return 0 " +
            "end";
        
        DefaultRedisScript<Long> redisScript = new DefaultRedisScript<>();
        redisScript.setScriptText(script);
        redisScript.setResultType(Long.class);
        
        Long result = redisTemplate.execute(redisScript, 
            Arrays.asList(key), String.valueOf(capacity), 
            String.valueOf(tokens), String.valueOf(1));
        
        return result != null && result == 1;
    }
}
```

### 4.3 æ¶ˆæ¯é˜Ÿåˆ—å‰Šå³°


**ğŸ“® MQå‰Šå³°åŸç†**
```
é«˜å³°æµé‡ â†’ MQç¼“å†² â†’ å¹³ç¨³æ¶ˆè´¹
  5ä¸‡/s  â†’ Queue  â†’  1ä¸‡/s
```

**ğŸ’» ç®€åŒ–MQå‰Šå³°å®ç°**
```java
// ç”Ÿäº§è€… - æ¥æ”¶ç”¨æˆ·è¯·æ±‚
@RestController
public class OrderController {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    @PostMapping("/order")
    public Result createOrder(@RequestBody OrderRequest request) {
        // ç®€å•æ ¡éªŒ
        if (!validateRequest(request)) {
            return Result.fail("è¯·æ±‚å‚æ•°é”™è¯¯");
        }
        
        // å‘é€åˆ°MQï¼Œå‰Šå³°å¤„ç†
        OrderMessage message = new OrderMessage(request);
        rabbitTemplate.convertAndSend("order.queue", message);
        
        return Result.success("è®¢å•æäº¤æˆåŠŸï¼Œæ­£åœ¨å¤„ç†ä¸­");
    }
}

// æ¶ˆè´¹è€… - å¹³ç¨³å¤„ç†è®¢å•
@RabbitListener(queues = "order.queue")
public class OrderConsumer {
    
    @Autowired
    private OrderService orderService;
    
    @RabbitHandler
    public void handleOrder(OrderMessage message) {
        try {
            // å®é™…åˆ›å»ºè®¢å•
            orderService.createOrder(message);
        } catch (Exception e) {
            // å¤±è´¥å¤„ç†ï¼Œå¯ä»¥é‡è¯•æˆ–è®°å½•
            log.error("è®¢å•å¤„ç†å¤±è´¥", e);
        }
    }
}
```

---

## 5. ğŸ¤ è®¢å•ä¸€è‡´æ€§ä¿è¯æ–¹æ¡ˆ


### 5.1 è®¢å•ä¸€è‡´æ€§æŒ‘æˆ˜


**ğŸ”¸ è®¢å•æ¶‰åŠçš„æ•°æ®**
```
è®¢å•åˆ›å»ºéœ€è¦åŒæ—¶æ“ä½œï¼š
1. è®¢å•è¡¨ - åˆ›å»ºè®¢å•è®°å½•
2. åº“å­˜è¡¨ - æ‰£å‡å•†å“åº“å­˜  
3. ç”¨æˆ·è¡¨ - æ‰£å‡ç”¨æˆ·ä½™é¢
4. ç§¯åˆ†è¡¨ - å¢åŠ ç”¨æˆ·ç§¯åˆ†
```

> âŒ **ä¸€è‡´æ€§é—®é¢˜**ï¼šå¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œéƒ½å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

### 5.2 åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ


**ğŸ¯ TCCæ¨¡å¼å®ç°**
```java
@Service
public class OrderTccService {
    
    /**
     * Tryé˜¶æ®µ - é¢„ç•™èµ„æº
     */
    @Tcc(confirmMethod = "confirmOrder", cancelMethod = "cancelOrder")
    public void tryCreateOrder(OrderRequest request) {
        // 1. é¢„æ‰£åº“å­˜
        stockService.tryReduceStock(request.getProductId(), request.getQuantity());
        
        // 2. å†»ç»“ç”¨æˆ·ä½™é¢
        accountService.tryFreezeBalance(request.getUserId(), request.getAmount());
        
        // 3. åˆ›å»ºé¢„è®¢å•
        orderService.tryCreateOrder(request);
    }
    
    /**
     * Confirmé˜¶æ®µ - ç¡®è®¤æäº¤
     */
    public void confirmOrder(OrderRequest request) {
        // 1. ç¡®è®¤æ‰£å‡åº“å­˜
        stockService.confirmReduceStock(request.getProductId(), request.getQuantity());
        
        // 2. ç¡®è®¤æ‰£å‡ä½™é¢
        accountService.confirmReduceBalance(request.getUserId(), request.getAmount());
        
        // 3. ç¡®è®¤åˆ›å»ºè®¢å•
        orderService.confirmCreateOrder(request);
    }
    
    /**
     * Cancelé˜¶æ®µ - å›æ»šæ“ä½œ
     */
    public void cancelOrder(OrderRequest request) {
        // 1. æ¢å¤åº“å­˜
        stockService.cancelReduceStock(request.getProductId(), request.getQuantity());
        
        // 2. è§£å†»ä½™é¢
        accountService.cancelFreezeBalance(request.getUserId(), request.getAmount());
        
        // 3. å–æ¶ˆé¢„è®¢å•
        orderService.cancelCreateOrder(request);
    }
}
```

### 5.3 æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ


**ğŸ“® åŸºäºæ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§**
```java
@Service
public class OrderSagaService {
    
    @Transactional
    public void createOrder(OrderRequest request) {
        try {
            // 1. æœ¬åœ°äº‹åŠ¡åˆ›å»ºè®¢å•
            Order order = orderService.createOrder(request);
            
            // 2. å‘é€åç»­å¤„ç†æ¶ˆæ¯
            OrderCreatedEvent event = new OrderCreatedEvent(order);
            messagePublisher.publish(event);
            
        } catch (Exception e) {
            log.error("è®¢å•åˆ›å»ºå¤±è´¥", e);
            throw new BusinessException("è®¢å•åˆ›å»ºå¤±è´¥");
        }
    }
    
    // ç›‘å¬è®¢å•åˆ›å»ºäº‹ä»¶
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        try {
            // æ‰£å‡åº“å­˜
            stockService.reduceStock(event.getProductId(), event.getQuantity());
            
            // æ‰£å‡ä½™é¢
            accountService.reduceBalance(event.getUserId(), event.getAmount());
            
            // å‘é€æˆåŠŸäº‹ä»¶
            OrderCompletedEvent completedEvent = new OrderCompletedEvent(event.getOrderId());
            messagePublisher.publish(completedEvent);
            
        } catch (Exception e) {
            // å‘é€è¡¥å¿äº‹ä»¶
            OrderCompensateEvent compensateEvent = new OrderCompensateEvent(event.getOrderId());
            messagePublisher.publish(compensateEvent);
        }
    }
}
```

**ğŸ”„ ä¸€è‡´æ€§æ–¹æ¡ˆå¯¹æ¯”**
| æ–¹æ¡ˆç±»å‹ | ä¸€è‡´æ€§ | æ€§èƒ½ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|----------|--------|------|--------|----------|
| ğŸ”„ TCC | å¼ºä¸€è‡´ | ä¸­ç­‰ | é«˜ | é‡‘èåœºæ™¯ |
| ğŸ“® SAGA | æœ€ç»ˆä¸€è‡´ | é«˜ | ä¸­ç­‰ | ä¸€èˆ¬ç”µå•† |
| ğŸ“¨ MQ | æœ€ç»ˆä¸€è‡´ | å¾ˆé«˜ | ä½ | é«˜å¹¶å‘åœºæ™¯ |

---

## 6. ğŸ’³ æ”¯ä»˜ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ–


### 6.1 æ”¯ä»˜ç³»ç»Ÿæ¶æ„æŒ‘æˆ˜


**ğŸ”¸ æ”¯ä»˜ç³»ç»Ÿç‰¹ç‚¹**
```
é«˜å¯ç”¨è¦æ±‚ï¼š99.99%å¯ç”¨æ€§
ä½å»¶è¿Ÿè¦æ±‚ï¼šæ”¯ä»˜å“åº”<500ms  
å¼ºä¸€è‡´æ€§ï¼šèµ„é‡‘æ•°æ®ç»å¯¹å‡†ç¡®
é«˜å¹¶å‘ï¼šå¤§ä¿ƒæœŸé—´10ä¸‡ç¬”/åˆ†é’Ÿ
```

> ğŸ’¡ **æ”¯ä»˜ç³»ç»Ÿæ ¸å¿ƒ**ï¼šé’±çš„é—®é¢˜å®¹ä¸å¾—åŠç‚¹é©¬è™ï¼Œæ€§èƒ½å’Œå‡†ç¡®æ€§å¿…é¡»å…¼é¡¾

### 6.2 æ”¯ä»˜æµç¨‹ä¼˜åŒ–


**ğŸ”„ æ”¯ä»˜æµç¨‹è®¾è®¡**
```
ç”¨æˆ·æ”¯ä»˜è¯·æ±‚ â†’ å‚æ•°æ ¡éªŒ â†’ é£æ§æ£€æŸ¥ â†’ ä½™é¢æ‰£å‡ â†’ ç¬¬ä¸‰æ–¹æ”¯ä»˜ â†’ ç»“æœé€šçŸ¥
     â†“            â†“         â†“         â†“         â†“         â†“
   50ms        100ms     200ms     100ms     1000ms    å¼‚æ­¥
```

**âš¡ æ”¯ä»˜æ€§èƒ½ä¼˜åŒ–ä»£ç **
```java
@Service
public class PaymentService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Autowired
    private PaymentChannelService channelService;
    
    /**
     * å¼‚æ­¥æ”¯ä»˜å¤„ç†
     */
    @Async
    public CompletableFuture<PaymentResult> processPayment(PaymentRequest request) {
        
        // 1. å¿«é€Ÿæ ¡éªŒ - æœ¬åœ°ç¼“å­˜
        if (!validatePayment(request)) {
            return CompletableFuture.completedFuture(
                PaymentResult.fail("æ”¯ä»˜å‚æ•°é”™è¯¯"));
        }
        
        // 2. é˜²é‡å¤æ”¯ä»˜ - Redisåˆ†å¸ƒå¼é”
        String lockKey = "payment:lock:" + request.getOrderId();
        if (!redisTemplate.opsForValue().setIfAbsent(lockKey, "1", 30, TimeUnit.SECONDS)) {
            return CompletableFuture.completedFuture(
                PaymentResult.fail("è¯·å‹¿é‡å¤æ”¯ä»˜"));
        }
        
        try {
            // 3. å¼‚æ­¥è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜
            CompletableFuture<ThirdPayResult> thirdPayFuture = 
                channelService.asyncPay(request);
            
            // 4. å¼‚æ­¥æ›´æ–°è®¢å•çŠ¶æ€
            CompletableFuture<Boolean> updateFuture = 
                orderService.asyncUpdateStatus(request.getOrderId());
            
            // 5. ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆ
            return CompletableFuture.allOf(thirdPayFuture, updateFuture)
                .thenApply(v -> {
                    ThirdPayResult payResult = thirdPayFuture.join();
                    Boolean updateResult = updateFuture.join();
                    
                    if (payResult.isSuccess() && updateResult) {
                        return PaymentResult.success(payResult.getTransactionId());
                    } else {
                        return PaymentResult.fail("æ”¯ä»˜å¤„ç†å¤±è´¥");
                    }
                });
                
        } finally {
            // é‡Šæ”¾åˆ†å¸ƒå¼é”
            redisTemplate.delete(lockKey);
        }
    }
    
    /**
     * æ”¯ä»˜ç»“æœæŸ¥è¯¢ - ç¼“å­˜ä¼˜åŒ–
     */
    public PaymentResult queryPayment(String orderId) {
        // å…ˆæŸ¥Redisç¼“å­˜
        String cacheKey = "payment:result:" + orderId;
        PaymentResult cached = (PaymentResult) redisTemplate.opsForValue().get(cacheKey);
        if (cached != null) {
            return cached;
        }
        
        // æŸ¥è¯¢æ•°æ®åº“
        PaymentResult result = paymentMapper.selectByOrderId(orderId);
        if (result != null) {
            // ç¼“å­˜10åˆ†é’Ÿ
            redisTemplate.opsForValue().set(cacheKey, result, 10, TimeUnit.MINUTES);
        }
        
        return result;
    }
}
```

### 6.3 æ”¯ä»˜æ¸ é“ä¼˜åŒ–


**ğŸ¦ å¤šæ¸ é“è´Ÿè½½å‡è¡¡**
```java
@Service
public class PaymentChannelService {
    
    private List<PaymentChannel> channels;
    
    /**
     * æ™ºèƒ½é€‰æ‹©æ”¯ä»˜æ¸ é“
     */
    public PaymentChannel selectChannel(PaymentRequest request) {
        // æ ¹æ®é‡‘é¢ã€ç”¨æˆ·ç­‰çº§ã€æ¸ é“æˆåŠŸç‡é€‰æ‹©æœ€ä¼˜æ¸ é“
        return channels.stream()
            .filter(channel -> channel.isAvailable())
            .filter(channel -> channel.supports(request.getPayType()))
            .max(Comparator.comparing(PaymentChannel::getSuccessRate))
            .orElseThrow(() -> new RuntimeException("æ— å¯ç”¨æ”¯ä»˜æ¸ é“"));
    }
}
```

---

## 7. ğŸ“Š ç”µå•†æ ¸å¿ƒé“¾è·¯ç›‘æ§


### 7.1 ç›‘æ§ä½“ç³»è®¾è®¡


**ğŸ¯ ç›‘æ§å±‚æ¬¡æ¶æ„**
```
                    ç”µå•†ç›‘æ§ä½“ç³»
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        ä¸šåŠ¡ç›‘æ§å±‚                â”‚
         â”‚    è®¢å•é‡ã€æ”¯ä»˜é‡ã€è½¬åŒ–ç‡          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        åº”ç”¨ç›‘æ§å±‚                â”‚
         â”‚   æ¥å£å“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€QPS        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚        ç³»ç»Ÿç›‘æ§å±‚                â”‚
         â”‚   CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å…³é”®æŒ‡æ ‡ç›‘æ§


**ğŸ“ˆ æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡**
| ç›‘æ§ç»´åº¦ | å…³é”®æŒ‡æ ‡ | æ­£å¸¸èŒƒå›´ | å‘Šè­¦é˜ˆå€¼ | ç›‘æ§çº§åˆ« |
|----------|----------|----------|----------|----------|
| ğŸ“± ç”¨æˆ·ä½“éªŒ | é¡µé¢åŠ è½½æ—¶é—´ | <2s | >5s | â­â­â­â­â­ |
| ğŸ›’ ä¸‹å•è½¬åŒ– | ä¸‹å•è½¬åŒ–ç‡ | >3% | <1% | â­â­â­â­â­ |
| ğŸ’³ æ”¯ä»˜æˆåŠŸ | æ”¯ä»˜æˆåŠŸç‡ | >95% | <90% | â­â­â­â­â­ |
| ğŸš€ æ¥å£æ€§èƒ½ | APIå“åº”æ—¶é—´ | <200ms | >1s | â­â­â­â­ |

**âš™ï¸ ç›‘æ§å®ç°ä»£ç **
```java
@Component
public class BusinessMonitor {
    
    @Autowired
    private MeterRegistry meterRegistry;
    
    /**
     * è®¢å•ç›‘æ§
     */
    public void recordOrder(OrderEvent event) {
        // è®¢å•æ€»æ•°è®¡æ•°
        Counter.builder("order.count")
            .tag("status", event.getStatus())
            .tag("channel", event.getChannel())
            .register(meterRegistry)
            .increment();
        
        // è®¢å•é‡‘é¢ç»Ÿè®¡
        Gauge.builder("order.amount")
            .tag("status", event.getStatus())
            .register(meterRegistry, event, OrderEvent::getAmount);
    }
    
    /**
     * æ¥å£æ€§èƒ½ç›‘æ§
     */
    @Around("@annotation(ApiMonitor)")
    public Object monitorApi(ProceedingJoinPoint joinPoint) throws Throwable {
        String methodName = joinPoint.getSignature().getName();
        Timer.Sample sample = Timer.start(meterRegistry);
        
        try {
            Object result = joinPoint.proceed();
            
            // è®°å½•æˆåŠŸè°ƒç”¨
            Counter.builder("api.call.success")
                .tag("method", methodName)
                .register(meterRegistry)
                .increment();
            
            return result;
            
        } catch (Exception e) {
            // è®°å½•å¤±è´¥è°ƒç”¨
            Counter.builder("api.call.error")
                .tag("method", methodName)
                .tag("error", e.getClass().getSimpleName())
                .register(meterRegistry)
                .increment();
            
            throw e;
        } finally {
            // è®°å½•å“åº”æ—¶é—´
            sample.stop(Timer.builder("api.call.duration")
                .tag("method", methodName)
                .register(meterRegistry));
        }
    }
}
```

### 7.3 å‘Šè­¦æœºåˆ¶


**ğŸš¨ åˆ†çº§å‘Šè­¦ç­–ç•¥**
```
P0çº§åˆ«(ä¸¥é‡): æ”¯ä»˜å¤±è´¥ç‡>10% â†’ ç«‹å³ç”µè¯å‘Šè­¦
P1çº§åˆ«(é‡è¦): ä¸‹å•å¤±è´¥ç‡>5%  â†’ çŸ­ä¿¡+é‚®ä»¶å‘Šè­¦  
P2çº§åˆ«(ä¸€èˆ¬): å“åº”æ—¶é—´>2s    â†’ é‚®ä»¶å‘Šè­¦
P3çº§åˆ«(æé†’): è®¿é—®é‡å¼‚å¸¸    â†’ ç³»ç»Ÿå†…å‘Šè­¦
```

---

## 8. ğŸ—ï¸ é«˜å¹¶å‘åœºæ™¯æ•°æ®åº“è®¾è®¡


### 8.1 æ•°æ®åº“æ¶æ„è®¾è®¡


**ğŸ¯ è¯»å†™åˆ†ç¦»æ¶æ„**
```
                   é«˜å¹¶å‘æ•°æ®åº“æ¶æ„
        ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“ä»£ç†å±‚
                     â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚
        è¯»è¯·æ±‚(90%)          å†™è¯·æ±‚(10%)
           â†“                   â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  è¯»åº“é›†ç¾¤   â”‚      â”‚  ä¸»åº“   â”‚
      â”‚  (3ä¸ªä»åº“)  â”‚â†â”€â”€â”€â”€â”€â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’» æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–**
```java
@Configuration
public class DataSourceConfig {
    
    @Primary
    @Bean("masterDataSource")
    public DataSource masterDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://master-db:3306/ecommerce");
        config.setUsername("root");
        config.setPassword("password");
        
        // è¿æ¥æ± ä¼˜åŒ–é…ç½®
        config.setMaximumPoolSize(50);        // æœ€å¤§è¿æ¥æ•°
        config.setMinimumIdle(10);            // æœ€å°ç©ºé—²è¿æ¥
        config.setConnectionTimeout(3000);    // è¿æ¥è¶…æ—¶3ç§’
        config.setIdleTimeout(300000);        // ç©ºé—²è¶…æ—¶5åˆ†é’Ÿ
        config.setMaxLifetime(900000);        // æœ€å¤§ç”Ÿå‘½å‘¨æœŸ15åˆ†é’Ÿ
        
        return new HikariDataSource(config);
    }
    
    @Bean("slaveDataSource")
    public DataSource slaveDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://slave-db:3306/ecommerce");
        // ä»åº“é…ç½®...
        return new HikariDataSource(config);
    }
}
```

### 8.2 åˆ†åº“åˆ†è¡¨ç­–ç•¥


**ğŸ—‚ï¸ è®¢å•è¡¨åˆ†ç‰‡ç­–ç•¥**
```sql
-- æŒ‰ç”¨æˆ·IDåˆ†åº“åˆ†è¡¨
-- åˆ†åº“ï¼šuser_id % 4 ç¡®å®šåº“
-- åˆ†è¡¨ï¼šuser_id % 16 ç¡®å®šè¡¨

-- åº“1: ecommerce_0
CREATE TABLE order_0 (id, user_id, ...) -- user_id % 16 = 0
CREATE TABLE order_1 (id, user_id, ...) -- user_id % 16 = 1
...
CREATE TABLE order_15 (id, user_id, ...) -- user_id % 16 = 15

-- åº“2: ecommerce_1  
-- åŒæ ·åˆ›å»º16å¼ è¡¨...
```

**ğŸ’» åˆ†ç‰‡è·¯ç”±å®ç°**
```java
@Component
public class ShardingStrategy {
    
    /**
     * æ ¹æ®ç”¨æˆ·IDè®¡ç®—åˆ†åº“åˆ†è¡¨
     */
    public ShardingInfo calculateSharding(Long userId) {
        int dbIndex = (int) (userId % 4);  // 4ä¸ªæ•°æ®åº“
        int tableIndex = (int) (userId % 16);  // æ¯åº“16å¼ è¡¨
        
        String dbName = "ecommerce_" + dbIndex;
        String tableName = "order_" + tableIndex;
        
        return new ShardingInfo(dbName, tableName);
    }
    
    /**
     * è·¨åˆ†ç‰‡æŸ¥è¯¢ - è®¢å•åˆ—è¡¨
     */
    public List<Order> queryUserOrders(Long userId, int page, int size) {
        ShardingInfo sharding = calculateSharding(userId);
        
        return orderMapper.selectByUserId(
            sharding.getDbName(), 
            sharding.getTableName(), 
            userId, page * size, size);
    }
}
```

### 8.3 ç´¢å¼•ä¼˜åŒ–ç­–ç•¥


**ğŸ“Š æ ¸å¿ƒè¡¨ç´¢å¼•è®¾è®¡**
```sql
-- å•†å“è¡¨ç´¢å¼•
CREATE INDEX idx_category_status ON product(category_id, status);
CREATE INDEX idx_price_range ON product(price, status);
CREATE INDEX idx_create_time ON product(create_time);

-- è®¢å•è¡¨ç´¢å¼•  
CREATE INDEX idx_user_time ON order_table(user_id, create_time);
CREATE INDEX idx_status_time ON order_table(status, create_time);
CREATE INDEX idx_payment_status ON order_table(payment_status, order_status);

-- å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
CREATE INDEX idx_user_status_time ON order_table(user_id, order_status, create_time);
```

---

## 9. ğŸ›¡ï¸ ç¼“å­˜ç©¿é€é›ªå´©å¤„ç†


### 9.1 ç¼“å­˜ç©¿é€é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€**
```
æ­£å¸¸æƒ…å†µ: è¯·æ±‚ â†’ ç¼“å­˜å‘½ä¸­ â†’ è¿”å›æ•°æ®
ç©¿é€æƒ…å†µ: è¯·æ±‚ â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ æ•°æ®åº“æœªå‘½ä¸­ â†’ è¿”å›ç©º
é—®é¢˜: æ¶æ„è¯·æ±‚å¤§é‡ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç»•è¿‡ç¼“å­˜ç›´å‡»æ•°æ®åº“
```

> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šå°±åƒæœ‰äººæ•…æ„è¯¢é—®å›¾ä¹¦é¦†é‡Œä¸å­˜åœ¨çš„ä¹¦ï¼Œç®¡ç†å‘˜æ¯æ¬¡éƒ½è¦å»ä¹¦åº“æ‰¾ä¸€é

**ğŸ›¡ï¸ å¸ƒéš†è¿‡æ»¤å™¨é˜²ç©¿é€**
```java
@Service
public class ProductCacheService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    private BloomFilter<Long> productBloomFilter;
    
    @PostConstruct
    public void initBloomFilter() {
        // åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ï¼Œé¢„æœŸ100ä¸‡å•†å“ï¼Œ1%è¯¯åˆ¤ç‡
        productBloomFilter = BloomFilter.create(
            Funnels.longFunnel(), 1000000, 0.01);
        
        // å°†æ‰€æœ‰å•†å“IDåŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨
        List<Long> productIds = productMapper.selectAllIds();
        productIds.forEach(productBloomFilter::put);
    }
    
    public Product getProduct(Long productId) {
        // 1. å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­
        if (!productBloomFilter.mightContain(productId)) {
            return null;  // è‚¯å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
        }
        
        // 2. æŸ¥è¯¢Redisç¼“å­˜
        String cacheKey = "product:" + productId;
        Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        product = productMapper.selectById(productId);
        if (product != null) {
            // ç¼“å­˜30åˆ†é’Ÿ
            redisTemplate.opsForValue().set(cacheKey, product, 30, TimeUnit.MINUTES);
        } else {
            // ç¼“å­˜ç©ºå€¼ï¼Œé˜²æ­¢é¢‘ç¹æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®
            redisTemplate.opsForValue().set(cacheKey, "NULL", 5, TimeUnit.MINUTES);
        }
        
        return product;
    }
}
```

### 9.2 ç¼“å­˜é›ªå´©é—®é¢˜


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç¼“å­˜é›ªå´©**
```
é›ªå´©åœºæ™¯: å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ â†’ è¯·æ±‚å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ â†’ æ•°æ®åº“å´©æºƒ
å…¸å‹æƒ…å†µ: å‡Œæ™¨2ç‚¹æ‰¹é‡ç¼“å­˜è¿‡æœŸï¼Œæ—©é«˜å³°8ç‚¹ç”¨æˆ·è®¿é—®
```

**â„ï¸ é›ªå´©é˜²æŠ¤ç­–ç•¥**
```java
@Service
public class AntiAvalancheService {
    
    /**
     * éšæœºè¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢åŒæ—¶è¿‡æœŸ
     */
    public void setCacheWithRandomExpire(String key, Object value, int baseExpire) {
        // åŸºç¡€è¿‡æœŸæ—¶é—´ + éšæœºæ—¶é—´(0-30åˆ†é’Ÿ)
        Random random = new Random();
        int randomExpire = baseExpire + random.nextInt(1800);
        
        redisTemplate.opsForValue().set(key, value, randomExpire, TimeUnit.SECONDS);
    }
    
    /**
     * äº’æ–¥é”é˜²æ­¢ç¼“å­˜å‡»ç©¿
     */
    public Product getProductWithMutex(Long productId) {
        String cacheKey = "product:" + productId;
        String lockKey = "lock:product:" + productId;
        
        // 1. å…ˆæŸ¥ç¼“å­˜
        Product product = (Product) redisTemplate.opsForValue().get(cacheKey);
        if (product != null) {
            return product;
        }
        
        // 2. è·å–åˆ†å¸ƒå¼é”
        Boolean lockAcquired = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, "1", 10, TimeUnit.SECONDS);
        
        if (lockAcquired) {
            try {
                // è·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢æ•°æ®åº“
                product = productMapper.selectById(productId);
                if (product != null) {
                    setCacheWithRandomExpire(cacheKey, product, 1800);
                }
                return product;
            } finally {
                // é‡Šæ”¾é”
                redisTemplate.delete(lockKey);
            }
        } else {
            // è·å–é”å¤±è´¥ï¼Œç­‰å¾…åé‡è¯•
            try {
                Thread.sleep(100);
                return getProductWithMutex(productId);  // é€’å½’é‡è¯•
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                return null;
            }
        }
    }
}
```

### 9.3 ç¼“å­˜é¢„çƒ­æœºåˆ¶


**ğŸ”¥ ç¼“å­˜é¢„çƒ­ç­–ç•¥**
```java
@Service
public class CacheWarmupService {
    
    @Scheduled(fixedRate = 3600000)  // æ¯å°æ—¶æ‰§è¡Œ
    public void warmupHotProducts() {
        // 1. è·å–çƒ­ç‚¹å•†å“åˆ—è¡¨
        List<Long> hotProductIds = getHotProductIds();
        
        // 2. å¹¶è¡Œé¢„çƒ­ç¼“å­˜
        hotProductIds.parallelStream().forEach(productId -> {
            try {
                Product product = productMapper.selectById(productId);
                if (product != null) {
                    String cacheKey = "product:" + productId;
                    redisTemplate.opsForValue().set(cacheKey, product, 
                        3600 + new Random().nextInt(1800), TimeUnit.SECONDS);
                }
            } catch (Exception e) {
                log.error("é¢„çƒ­å•†å“ç¼“å­˜å¤±è´¥: " + productId, e);
            }
        });
        
        log.info("çƒ­ç‚¹å•†å“ç¼“å­˜é¢„çƒ­å®Œæˆï¼Œé¢„çƒ­æ•°é‡: {}", hotProductIds.size());
    }
    
    private List<Long> getHotProductIds() {
        // ä»è®¿é—®ç»Ÿè®¡ä¸­è·å–çƒ­ç‚¹å•†å“
        return redisTemplate.opsForZSet()
            .reverseRange("hot:products", 0, 999)
            .stream()
            .map(obj -> Long.valueOf(obj.toString()))
            .collect(Collectors.toList());
    }
}
```

---

## 10. ğŸ” åˆ†å¸ƒå¼é”ä¼˜åŒ–ç­–ç•¥


### 10.1 åˆ†å¸ƒå¼é”åº”ç”¨åœºæ™¯


**ğŸ¯ ç”µå•†ä¸­çš„é”åœºæ™¯**
```
åº“å­˜æ‰£å‡: é˜²æ­¢è¶…å–
è®¢å•å·ç”Ÿæˆ: ä¿è¯å”¯ä¸€æ€§  
ç”¨æˆ·ç§¯åˆ†: é˜²æ­¢é‡å¤æ“ä½œ
é™æ—¶æŠ¢è´­: æ§åˆ¶å¹¶å‘æ•°é‡
```

> ğŸ’¡ **åˆ†å¸ƒå¼é”æœ¬è´¨**ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½æ‰§è¡Œç‰¹å®šæ“ä½œ

### 10.2 Redisåˆ†å¸ƒå¼é”å®ç°


**ğŸ”’ åŸºç¡€åˆ†å¸ƒå¼é”**
```java
@Component
public class RedisDistributedLock {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    /**
     * è·å–é”
     * @param lockKey é”çš„key
     * @param requestId è¯·æ±‚å”¯ä¸€æ ‡è¯†
     * @param expireTime è¿‡æœŸæ—¶é—´(ç§’)
     * @return true-è·å–æˆåŠŸ false-è·å–å¤±è´¥
     */
    public boolean tryLock(String lockKey, String requestId, int expireTime) {
        // ä½¿ç”¨SETå‘½ä»¤çš„NXå’ŒEXå‚æ•°ï¼ŒåŸå­æ€§è®¾ç½®
        String result = redisTemplate.execute((RedisCallback<String>) connection -> {
            byte[] key = lockKey.getBytes();
            byte[] value = requestId.getBytes();
            
            return connection.set(key, value, 
                Expiration.seconds(expireTime), SetOption.ifAbsent());
        });
        
        return "OK".equals(result);
    }
    
    /**
     * é‡Šæ”¾é” - ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
     */
    public boolean releaseLock(String lockKey, String requestId) {
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
        
        DefaultRedisScript<Long> script = new DefaultRedisScript<>();
        script.setScriptText(luaScript);
        script.setResultType(Long.class);
        
        Long result = redisTemplate.execute(script, 
            Collections.singletonList(lockKey), requestId);
        
        return result != null && result == 1L;
    }
}
```

### 10.3 é”ä¼˜åŒ–ç­–ç•¥


**âš¡ å¯é‡å…¥é”å®ç°**
```java
@Component
public class ReentrantRedisLock {
    
    private ThreadLocal<Map<String, Integer>> lockCount = new ThreadLocal<>();
    
    public boolean lock(String lockKey, int expireTime) {
        String requestId = Thread.currentThread().getName();
        
        // æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²æŒæœ‰é”
        Map<String, Integer> locks = lockCount.get();
        if (locks == null) {
            locks = new HashMap<>();
            lockCount.set(locks);
        }
        
        Integer count = locks.get(lockKey);
        if (count != null && count > 0) {
            // é‡å…¥é”ï¼Œè®¡æ•°+1
            locks.put(lockKey, count + 1);
            return true;
        }
        
        // å°è¯•è·å–é”
        boolean acquired = tryLock(lockKey, requestId, expireTime);
        if (acquired) {
            locks.put(lockKey, 1);
        }
        
        return acquired;
    }
    
    public void unlock(String lockKey) {
        String requestId = Thread.currentThread().getName();
        Map<String, Integer> locks = lockCount.get();
        
        if (locks != null) {
            Integer count = locks.get(lockKey);
            if (count != null && count > 0) {
                if (count == 1) {
                    // æœ€åä¸€æ¬¡é‡Šæ”¾ï¼ŒçœŸæ­£é‡Šæ”¾é”
                    releaseLock(lockKey, requestId);
                    locks.remove(lockKey);
                } else {
                    // é‡å…¥é”ï¼Œè®¡æ•°-1
                    locks.put(lockKey, count - 1);
                }
            }
        }
    }
}
```

**ğŸš€ é”æ€§èƒ½ä¼˜åŒ–**
```java
@Service
public class OptimizedLockService {
    
    /**
     * è‡ªæ—‹é” - çŸ­æ—¶é—´å†…é‡è¯•
     */
    public boolean spinLock(String lockKey, String requestId, 
                           int expireTime, int maxRetry, long retryInterval) {
        
        for (int i = 0; i < maxRetry; i++) {
            if (tryLock(lockKey, requestId, expireTime)) {
                return true;
            }
            
            try {
                Thread.sleep(retryInterval);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                return false;
            }
        }
        
        return false;
    }
    
    /**
     * åˆ†æ®µé” - é™ä½é”å†²çª
     */
    public boolean segmentLock(String baseLockKey, Object segmentKey, 
                              String requestId, int expireTime) {
        // æ ¹æ®åˆ†æ®µkeyè®¡ç®—å…·ä½“çš„é”key
        int segment = Math.abs(segmentKey.hashCode()) % 16;  // 16ä¸ªåˆ†æ®µ
        String lockKey = baseLockKey + ":" + segment;
        
        return tryLock(lockKey, requestId, expireTime);
    }
}
```

---

## 11. ğŸ“® å¼‚æ­¥å¤„ç†é˜Ÿåˆ—è®¾è®¡


### 11.1 å¼‚æ­¥å¤„ç†åœºæ™¯


**ğŸ¯ ç”µå•†å¼‚æ­¥å¤„ç†åœºæ™¯**
```
è®¢å•åˆ›å»º â†’ å¼‚æ­¥æ‰£å‡åº“å­˜
æ”¯ä»˜æˆåŠŸ â†’ å¼‚æ­¥å‘é€é‚®ä»¶/çŸ­ä¿¡
ç”¨æˆ·æ³¨å†Œ â†’ å¼‚æ­¥å‘æ”¾ä¼˜æƒ åˆ¸
å•†å“ä¸Šæ¶ â†’ å¼‚æ­¥æ›´æ–°æœç´¢ç´¢å¼•
æ•°æ®ç»Ÿè®¡ â†’ å¼‚æ­¥ç”ŸæˆæŠ¥è¡¨
```

> ğŸ’¡ **å¼‚æ­¥å¤„ç†ä»·å€¼**ï¼šå°†è€—æ—¶æ“ä½œä»ä¸»æµç¨‹ä¸­å‰¥ç¦»ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿååé‡

### 11.2 æ¶ˆæ¯é˜Ÿåˆ—æ¶æ„


**ğŸ“® MQæ¶æ„è®¾è®¡**
```
                      å¼‚æ­¥å¤„ç†æ¶æ„
    ä¸šåŠ¡æœåŠ¡ â†’ æ¶ˆæ¯ç”Ÿäº§è€… â†’ MQé›†ç¾¤ â†’ æ¶ˆæ¯æ¶ˆè´¹è€… â†’ ä¸šåŠ¡å¤„ç†
       â†“         â†“          â†“        â†“         â†“
    å¿«é€Ÿå“åº”   æ¶ˆæ¯å‘é€    æŒä¹…åŒ–    è´Ÿè½½å‡è¡¡   å®é™…æ‰§è¡Œ
      50ms      5ms      å¯é æ€§    é«˜åå    æŒ‰éœ€æ‰©å±•
```

**ğŸ’» RabbitMQå®ç°**
```java
// æ¶ˆæ¯é…ç½®
@Configuration
@EnableRabbit
public class RabbitConfig {
    
    @Bean
    public Queue orderQueue() {
        return QueueBuilder.durable("order.process.queue")
            .withArgument("x-message-ttl", 60000)  // æ¶ˆæ¯TTL 60ç§’
            .withArgument("x-max-length", 10000)   // é˜Ÿåˆ—æœ€å¤§é•¿åº¦
            .build();
    }
    
    @Bean
    public DirectExchange orderExchange() {
        return new DirectExchange("order.exchange", true, false);
    }
    
    @Bean
    public Binding orderBinding() {
        return BindingBuilder.bind(orderQueue())
            .to(orderExchange())
            .with("order.process");
    }
}

// æ¶ˆæ¯ç”Ÿäº§è€…
@Service
public class OrderMessageProducer {
    
    @Autowired
    private RabbitTemplate rabbitTemplate;
    
    public void sendOrderMessage(OrderMessage message) {
        try {
            // è®¾ç½®æ¶ˆæ¯å±æ€§
            MessageProperties properties = new MessageProperties();
            properties.setDeliveryMode(MessageDeliveryMode.PERSISTENT);  // æŒä¹…åŒ–
            properties.setExpiration("60000");  // è¿‡æœŸæ—¶é—´
            
            Message rabbitMessage = new Message(
                JSON.toJSONBytes(message), properties);
            
            // å‘é€æ¶ˆæ¯
            rabbitTemplate.convertAndSend(
                "order.exchange", "order.process", rabbitMessage);
            
            log.info("è®¢å•æ¶ˆæ¯å‘é€æˆåŠŸ: {}", message.getOrderId());
            
        } catch (Exception e) {
            log.error("è®¢å•æ¶ˆæ¯å‘é€å¤±è´¥", e);
            // å¯ä»¥è€ƒè™‘é‡è¯•æˆ–è®°å½•åˆ°å¤±è´¥è¡¨
        }
    }
}

// æ¶ˆæ¯æ¶ˆè´¹è€…
@Component
public class OrderMessageConsumer {
    
    @RabbitListener(queues = "order.process.queue", 
                   concurrency = "5-10")  // å¹¶å‘æ¶ˆè´¹è€…æ•°é‡
    public void processOrder(OrderMessage message, 
                           @Header Map<String, Object> headers, 
                           Channel channel, 
                           @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        try {
            // å¤„ç†è®¢å•é€»è¾‘
            orderProcessService.processOrder(message);
            
            // æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯
            channel.basicAck(deliveryTag, false);
            
            log.info("è®¢å•å¤„ç†æˆåŠŸ: {}", message.getOrderId());
            
        } catch (Exception e) {
            log.error("è®¢å•å¤„ç†å¤±è´¥: " + message.getOrderId(), e);
            
            try {
                // æ¶ˆæ¯é‡æ–°å…¥é˜Ÿï¼Œç­‰å¾…é‡è¯•
                channel.basicNack(deliveryTag, false, true);
            } catch (IOException ioException) {
                log.error("æ¶ˆæ¯ç¡®è®¤å¤±è´¥", ioException);
            }
        }
    }
}
```

### 11.3 é˜Ÿåˆ—ä¼˜åŒ–ç­–ç•¥


**ğŸš€ æ¶ˆè´¹æ€§èƒ½ä¼˜åŒ–**
```java
@Service
public class OptimizedConsumerService {
    
    private final ExecutorService executorService = 
        Executors.newFixedThreadPool(20);
    
    /**
     * æ‰¹é‡æ¶ˆè´¹æ¶ˆæ¯
     */
    @RabbitListener(queues = "batch.queue")
    public void batchConsume(@Payload List<OrderMessage> messages) {
        if (CollectionUtils.isEmpty(messages)) {
            return;
        }
        
        // æŒ‰ç±»å‹åˆ†ç»„æ‰¹é‡å¤„ç†
        Map<String, List<OrderMessage>> groupedMessages = messages.stream()
            .collect(Collectors.groupingBy(OrderMessage::getType));
        
        groupedMessages.forEach((type, batch) -> {
            executorService.submit(() -> {
                try {
                    processBatch(type, batch);
                } catch (Exception e) {
                    log.error("æ‰¹é‡å¤„ç†å¤±è´¥: " + type, e);
                }
            });
        });
    }
    
    /**
     * æ¶ˆæ¯ä¼˜å…ˆçº§å¤„ç†
     */
    @RabbitListener(queues = "priority.queue")
    public void processPriorityMessage(
            @Payload OrderMessage message,
            @Header("priority") Integer priority) {
        
        if (priority != null && priority > 8) {
            // é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ï¼Œä¼˜å…ˆå¤„ç†
            highPriorityExecutor.submit(() -> processHighPriorityOrder(message));
        } else {
            // æ™®é€šä¼˜å…ˆçº§æ¶ˆæ¯
            normalExecutor.submit(() -> processNormalOrder(message));
        }
    }
}
```

### 11.4 å¯é æ€§ä¿è¯


**ğŸ›¡ï¸ æ¶ˆæ¯å¯é æ€§æœºåˆ¶**
```java
@Service
public class ReliableMessageService {
    
    @Autowired
    private MessageLogService messageLogService;
    
    @Transactional
    public void sendReliableMessage(OrderMessage message) {
        // 1. å…ˆä¿å­˜æ¶ˆæ¯åˆ°æœ¬åœ°æ•°æ®åº“
        MessageLog messageLog = new MessageLog();
        messageLog.setMessageId(message.getMessageId());
        messageLog.setContent(JSON.toJSONString(message));
        messageLog.setStatus(MessageStatus.SENDING);
        messageLog.setCreateTime(new Date());
        messageLogService.save(messageLog);
        
        try {
            // 2. å‘é€æ¶ˆæ¯åˆ°MQ
            rabbitTemplate.convertAndSend("order.exchange", "order.process", message);
            
            // 3. æ›´æ–°æ¶ˆæ¯çŠ¶æ€ä¸ºå·²å‘é€
            messageLogService.updateStatus(message.getMessageId(), MessageStatus.SENT);
            
        } catch (Exception e) {
            // 4. å‘é€å¤±è´¥ï¼Œæ›´æ–°çŠ¶æ€
            messageLogService.updateStatus(message.getMessageId(), MessageStatus.FAILED);
            throw new RuntimeException("æ¶ˆæ¯å‘é€å¤±è´¥", e);
        }
    }
    
    /**
     * æ¶ˆæ¯è¡¥å¿æœºåˆ¶ - å®šæ—¶ä»»åŠ¡é‡è¯•å¤±è´¥æ¶ˆæ¯
     */
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ‰§è¡Œ
    public void retryFailedMessages() {
        List<MessageLog> failedMessages = messageLogService.findFailedMessages(100);
        
        failedMessages.forEach(messageLog -> {
            try {
                if (messageLog.getRetryCount() < 3) {  // æœ€å¤šé‡è¯•3æ¬¡
                    // é‡æ–°å‘é€æ¶ˆæ¯
                    OrderMessage message = JSON.parseObject(
                        messageLog.getContent(), OrderMessage.class);
                    rabbitTemplate.convertAndSend(
                        "order.exchange", "order.process", message);
                    
                    // æ›´æ–°é‡è¯•æ¬¡æ•°
                    messageLogService.incrementRetryCount(messageLog.getMessageId());
                    
                } else {
                    // è¶…è¿‡é‡è¯•æ¬¡æ•°ï¼Œæ ‡è®°ä¸ºæœ€ç»ˆå¤±è´¥
                    messageLogService.updateStatus(
                        messageLog.getMessageId(), MessageStatus.DEAD);
                }
            } catch (Exception e) {
                log.error("é‡è¯•æ¶ˆæ¯å¤±è´¥: " + messageLog.getMessageId(), e);
            }
        });
    }
}
```

---

## 12. ğŸ”„ é™çº§ç†”æ–­æœºåˆ¶å®ç°


### 12.1 é™çº§ç†”æ–­æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡é™çº§**
```
æ­£å¸¸æƒ…å†µ: ç”¨æˆ·æŸ¥è¯¢ â†’ è°ƒç”¨æ¨èæœåŠ¡ â†’ è¿”å›ä¸ªæ€§åŒ–å•†å“
é™çº§æƒ…å†µ: ç”¨æˆ·æŸ¥è¯¢ â†’ æ¨èæœåŠ¡è¶…æ—¶ â†’ è¿”å›çƒ­é”€å•†å“(é™çº§æ–¹æ¡ˆ)
```

> ğŸ’¡ **å½¢è±¡æ¯”å–»**ï¼šç”µæ¢¯åäº†å°±èµ°æ¥¼æ¢¯ï¼Œä¿è¯ç”¨æˆ·èƒ½åˆ°è¾¾ç›®çš„åœ°ï¼Œåªæ˜¯ä½“éªŒç¨å·®

**ğŸ”¸ ä»€ä¹ˆæ˜¯æœåŠ¡ç†”æ–­**
```
ç†”æ–­åŸç†ï¼šç±»ä¼¼ç”µè·¯ä¿é™©ä¸ï¼Œæ•…éšœè¾¾åˆ°é˜ˆå€¼æ—¶"æ–­è·¯"
ç†”æ–­çŠ¶æ€ï¼š
- å…³é—­çŠ¶æ€ï¼šæ­£å¸¸è°ƒç”¨
- å¼€å¯çŠ¶æ€ï¼šç›´æ¥è¿”å›é™çº§ç»“æœ  
- åŠå¼€çŠ¶æ€ï¼šå°è¯•éƒ¨åˆ†è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦æ¢å¤
```

### 12.2 Hystrixç†”æ–­å®ç°


**âš¡ ç†”æ–­é…ç½®**
```java
@Service
public class ProductRecommendService {
    
    @HystrixCommand(
        fallbackMethod = "getDefaultRecommendations",
        commandProperties = {
            @HystrixProperty(name = "execution.isolation.thread.timeoutInMilliseconds", 
                           value = "2000"),  // è¶…æ—¶æ—¶é—´2ç§’
            @HystrixProperty(name = "circuitBreaker.requestVolumeThreshold", 
                           value = "20"),    // ç†”æ–­è§¦å‘æœ€å°è¯·æ±‚æ•°
            @HystrixProperty(name = "circuitBreaker.errorThresholdPercentage", 
                           value = "50"),    // é”™è¯¯ç‡50%è§¦å‘ç†”æ–­
            @HystrixProperty(name = "circuitBreaker.sleepWindowInMilliseconds", 
                           value = "10000")  // ç†”æ–­æŒç»­10ç§’
        }
    )
    public List<Product> getRecommendations(Long userId) {
        // è°ƒç”¨æ¨èæœåŠ¡
        RestTemplate restTemplate = new RestTemplate();
        String url = "http://recommend-service/api/recommend/" + userId;
        
        ResponseEntity<List<Product>> response = restTemplate.exchange(
            url, HttpMethod.GET, null, 
            new ParameterizedTypeReference<List<Product>>() {});
        
        return response.getBody();
    }
    
    /**
     * é™çº§æ–¹æ³• - è¿”å›é»˜è®¤æ¨è
     */
    public List<Product> getDefaultRecommendations(Long userId) {
        // è¿”å›çƒ­é”€å•†å“ä½œä¸ºé™çº§æ–¹æ¡ˆ
        return productService.getHotProducts(10);
    }
}
```

### 12.3 è‡ªå®šä¹‰ç†”æ–­å™¨


**ğŸ”§ ç®€åŒ–ç‰ˆç†”æ–­å™¨å®ç°**
```java
@Component
public class SimpleCircuitBreaker {
    
    private final AtomicInteger requestCount = new AtomicInteger(0);
    private final AtomicInteger failureCount = new AtomicInteger(0);
    private volatile long lastFailureTime = 0;
    private volatile CircuitBreakerState state = CircuitBreakerState.CLOSED;
    
    private static final int FAILURE_THRESHOLD = 10;      // å¤±è´¥é˜ˆå€¼
    private static final int REQUEST_THRESHOLD = 20;      // æœ€å°è¯·æ±‚æ•°
    private static final long TIMEOUT = 10000;            // ç†”æ–­è¶…æ—¶æ—¶é—´
    
    public enum CircuitBreakerState {
        CLOSED,    // å…³é—­çŠ¶æ€ - æ­£å¸¸è°ƒç”¨
        OPEN,      // å¼€å¯çŠ¶æ€ - ç†”æ–­ä¸­
        HALF_OPEN  // åŠå¼€çŠ¶æ€ - è¯•æ¢æ¢å¤
    }
    
    /**
     * æ‰§è¡Œå—ä¿æŠ¤çš„æ–¹æ³•
     */
    public <T> T execute(Supplier<T> operation, Supplier<T> fallback) {
        if (state == CircuitBreakerState.OPEN) {
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›å…¥åŠå¼€çŠ¶æ€
            if (System.currentTimeMillis() - lastFailureTime > TIMEOUT) {
                state = CircuitBreakerState.HALF_OPEN;
            } else {
                // ä»åœ¨ç†”æ–­æœŸï¼Œè¿”å›é™çº§ç»“æœ
                return fallback.get();
            }
        }
        
        try {
            requestCount.incrementAndGet();
            T result = operation.get();
            
            // è°ƒç”¨æˆåŠŸï¼Œé‡ç½®è®¡æ•°å™¨
            if (state == CircuitBreakerState.HALF_OPEN) {
                reset();
            }
            
            return result;
            
        } catch (Exception e) {
            // è°ƒç”¨å¤±è´¥ï¼Œå¢åŠ å¤±è´¥è®¡æ•°
            recordFailure();
            return fallback.get();
        }
    }
    
    private void recordFailure() {
        failureCount.incrementAndGet();
        lastFailureTime = System.currentTimeMillis();
        
        // åˆ¤æ–­æ˜¯å¦éœ€è¦å¼€å¯ç†”æ–­
        if (requestCount.get() >= REQUEST_THRESHOLD &&
            failureCount.get() >= FAILURE_THRESHOLD) {
            state = CircuitBreakerState.OPEN;
        }
    }
    
    private void reset() {
        failureCount.set(0);
        requestCount.set(0);
        state = CircuitBreakerState.CLOSED;
    }
}
```

### 12.4 å¤šçº§é™çº§ç­–ç•¥


**ğŸ¯ é™çº§ç­–ç•¥å±‚æ¬¡**
```
Level 1: åŠŸèƒ½é™çº§ â†’ å…³é—­éæ ¸å¿ƒåŠŸèƒ½(æ¨èã€è¯„è®º)
Level 2: è¯»é™çº§  â†’ è¿”å›ç¼“å­˜æ•°æ®ï¼Œå³ä½¿è¿‡æœŸ  
Level 3: å†™é™çº§  â†’ å¼‚æ­¥å¤„ç†æˆ–ä¸´æ—¶å­˜å‚¨
Level 4: æœåŠ¡é™çº§ â†’ è¿”å›é™æ€é¡µé¢æˆ–æç¤ºä¿¡æ¯
```

**ğŸ’» å¤šçº§é™çº§å®ç°**
```java
@Service  
public class GradedDegradationService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    @Value("${degradation.level:0}")
    private int degradationLevel;
    
    public ProductDetailVO getProductDetail(Long productId) {
        ProductDetailVO result = new ProductDetailVO();
        
        // æ ¸å¿ƒä¿¡æ¯ - æ°¸è¿œä¸é™çº§
        Product product = productService.getProduct(productId);
        result.setProduct(product);
        
        // Level 1: æ¨èå•†å“é™çº§
        if (degradationLevel < 1) {
            try {
                List<Product> recommendations = recommendService.getRecommendations(productId);
                result.setRecommendations(recommendations);
            } catch (Exception e) {
                result.setRecommendations(getDefaultRecommendations());
            }
        }
        
        // Level 2: è¯„è®ºä¿¡æ¯é™çº§  
        if (degradationLevel < 2) {
            try {
                List<Comment> comments = commentService.getComments(productId);
                result.setComments(comments);
            } catch (Exception e) {
                // ä»ç¼“å­˜è·å–ï¼Œå³ä½¿è¿‡æœŸ
                List<Comment> cachedComments = getCachedComments(productId);
                result.setComments(cachedComments);
            }
        }
        
        // Level 3: åº“å­˜ä¿¡æ¯é™çº§
        if (degradationLevel < 3) {
            try {
                int stock = stockService.getStock(productId);
                result.setStock(stock);
            } catch (Exception e) {
                // æ˜¾ç¤º"æœ‰åº“å­˜"è€Œä¸æ˜¯ç²¾ç¡®æ•°é‡
                result.setStock(-1);  // è¡¨ç¤ºæœ‰åº“å­˜ä½†ä¸æ˜¾ç¤ºæ•°é‡
            }
        }
        
        return result;
    }
}
```

---

## 13. ğŸ“Š æ ¸å¿ƒé“¾è·¯æ€§èƒ½åŸºçº¿å»ºç«‹


### 13.1 æ€§èƒ½åŸºçº¿çš„é‡è¦æ€§


**ğŸ¯ ä»€ä¹ˆæ˜¯æ€§èƒ½åŸºçº¿**
```
æ€§èƒ½åŸºçº¿: ç³»ç»Ÿæ­£å¸¸è¿è¡Œæ—¶çš„æ€§èƒ½æŒ‡æ ‡å‚è€ƒæ ‡å‡†
ä½œç”¨: 
- åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦æ­£å¸¸è¿è¡Œ
- è¯†åˆ«æ€§èƒ½é€€åŒ–é—®é¢˜
- æŒ‡å¯¼å®¹é‡è§„åˆ’å†³ç­–
- è¯„ä¼°ä¼˜åŒ–æ•ˆæœ
```

> ğŸ’¡ **å½¢è±¡æ¯”å–»**: å°±åƒä½“æ£€æ—¶çš„å„é¡¹æ­£å¸¸æŒ‡æ ‡ï¼Œå¸®åŠ©åˆ¤æ–­èº«ä½“æ˜¯å¦å¥åº·

### 13.2 å…³é”®æŒ‡æ ‡å®šä¹‰


**ğŸ“ˆ æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡**
| é“¾è·¯ç¯èŠ‚ | å…³é”®æŒ‡æ ‡ | æ­£å¸¸åŸºçº¿ | é¢„è­¦é˜ˆå€¼ | å‘Šè­¦é˜ˆå€¼ |
|----------|----------|----------|----------|----------|
| ğŸ  é¦–é¡µè®¿é—® | é¡µé¢å“åº”æ—¶é—´ | 500ms | 1s | 2s |
| ğŸ” å•†å“æœç´¢ | æœç´¢å“åº”æ—¶é—´ | 200ms | 500ms | 1s |
| ğŸ“± å•†å“è¯¦æƒ… | APIå“åº”æ—¶é—´ | 100ms | 300ms | 500ms |
| ğŸ›’ åŠ å…¥è´­ç‰©è½¦ | æ“ä½œå“åº”æ—¶é—´ | 50ms | 200ms | 500ms |
| ğŸ’³ è®¢å•æ”¯ä»˜ | æ”¯ä»˜å“åº”æ—¶é—´ | 1s | 3s | 5s |

**ğŸ”§ æ€§èƒ½åŸºçº¿é‡‡é›†**
```java
@Component
public class PerformanceBaselineCollector {
    
    @Autowired
    private MeterRegistry meterRegistry;
    
    private final Map<String, PerformanceBaseline> baselines = new ConcurrentHashMap<>();
    
    /**
     * è®°å½•æ€§èƒ½æŒ‡æ ‡
     */
    @EventListener
    public void recordPerformance(PerformanceEvent event) {
        String key = event.getOperation();
        long responseTime = event.getResponseTime();
        
        // æ›´æ–°å®æ—¶æŒ‡æ ‡
        Timer.builder("api.response.time")
            .tag("operation", key)
            .register(meterRegistry)
            .record(responseTime, TimeUnit.MILLISECONDS);
        
        // æ›´æ–°åŸºçº¿ç»Ÿè®¡
        updateBaseline(key, responseTime);
    }
    
    /**
     * æ›´æ–°æ€§èƒ½åŸºçº¿
     */
    private void updateBaseline(String operation, long responseTime) {
        baselines.compute(operation, (k, baseline) -> {
            if (baseline == null) {
                baseline = new PerformanceBaseline(operation);
            }
            
            // æ»‘åŠ¨çª—å£æ›´æ–°åŸºçº¿
            baseline.addSample(responseTime);
            return baseline;
        });
    }
    
    /**
     * è·å–æ€§èƒ½åŸºçº¿
     */
    public PerformanceBaseline getBaseline(String operation) {
        return baselines.get(operation);
    }
}

@Data
public class PerformanceBaseline {
    private String operation;
    private long[] samples = new long[1000];  // ä¿å­˜æœ€è¿‘1000ä¸ªæ ·æœ¬
    private int sampleIndex = 0;
    private boolean full = false;
    
    public void addSample(long responseTime) {
        samples[sampleIndex] = responseTime;
        sampleIndex = (sampleIndex + 1) % 1000;
        if (sampleIndex == 0) {
            full = true;
        }
    }
    
    public double getAverage() {
        int count = full ? 1000 : sampleIndex;
        if (count == 0) return 0;
        
        long sum = 0;
        for (int i = 0; i < count; i++) {
            sum += samples[i];
        }
        return (double) sum / count;
    }
    
    public long getP95() {
        int count = full ? 1000 : sampleIndex;
        if (count == 0) return 0;
        
        long[] sorted = Arrays.copyOf(samples, count);
        Arrays.sort(sorted);
        
        int p95Index = (int) Math.ceil(count * 0.95) - 1;
        return sorted[p95Index];
    }
}
```

### 13.3 åŸºçº¿å¯¹æ¯”å‘Šè­¦


**ğŸš¨ æ€§èƒ½å¼‚å¸¸æ£€æµ‹**
```java
@Service
public class PerformanceAnomalyDetector {
    
    @Autowired
    private PerformanceBaselineCollector baselineCollector;
    
    @Autowired
    private AlertService alertService;
    
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ£€æµ‹
    public void detectAnomalies() {
        baselineCollector.getBaselines().forEach((operation, baseline) -> {
            double currentAvg = baseline.getAverage();
            long currentP95 = baseline.getP95();
            
            // è·å–å†å²åŸºçº¿(å¦‚å‰ä¸€å‘¨åŒæ—¶é—´æ®µ)
            HistoricalBaseline historical = getHistoricalBaseline(operation);
            
            if (historical != null) {
                // å“åº”æ—¶é—´è¶…è¿‡å†å²åŸºçº¿50%
                if (currentAvg > historical.getAverage() * 1.5) {
                    alertService.sendAlert(
                        AlertLevel.WARNING,
                        operation + "å¹³å‡å“åº”æ—¶é—´å¼‚å¸¸: " + currentAvg + "ms, åŸºçº¿: " + historical.getAverage() + "ms"
                    );
                }
                
                // P95è¶…è¿‡å†å²åŸºçº¿100%
                if (currentP95 > historical.getP95() * 2) {
                    alertService.sendAlert(
                        AlertLevel.CRITICAL,
                        operation + "P95å“åº”æ—¶é—´ä¸¥é‡å¼‚å¸¸: " + currentP95 + "ms, åŸºçº¿: " + historical.getP95() + "ms"
                    );
                }
            }
        });
    }
}
```

---

## 14. ğŸ” æ€§èƒ½ç“¶é¢ˆè‡ªåŠ¨è¯†åˆ«ç®—æ³•


### 14.1 ç“¶é¢ˆè¯†åˆ«åŸç†


**ğŸ¯ æ€§èƒ½ç“¶é¢ˆç±»å‹**
```
CPUç“¶é¢ˆ: CPUä½¿ç”¨ç‡æŒç»­é«˜äº80%
å†…å­˜ç“¶é¢ˆ: å†…å­˜ä½¿ç”¨ç‡>85% æˆ–é¢‘ç¹GC  
ç£ç›˜IOç“¶é¢ˆ: ç£ç›˜ä½¿ç”¨ç‡>90% æˆ–ç­‰å¾…æ—¶é—´é•¿
ç½‘ç»œç“¶é¢ˆ: ç½‘ç»œå¸¦å®½ä½¿ç”¨ç‡>80%
æ•°æ®åº“ç“¶é¢ˆ: æ…¢æŸ¥è¯¢ã€è¿æ¥æ± æ»¡ã€é”ç­‰å¾…
ç¼“å­˜ç“¶é¢ˆ: ç¼“å­˜å‘½ä¸­ç‡ä½ã€è¿æ¥æ•°æ»¡
```

### 14.2 ç“¶é¢ˆè¯†åˆ«ç®—æ³•


**ğŸ”§ ç»¼åˆç“¶é¢ˆåˆ†æç®—æ³•**
```java
@Service
public class PerformanceBottleneckDetector {
    
    @Autowired
    private SystemMetricsService metricsService;
    
    /**
     * æ£€æµ‹ç³»ç»Ÿç“¶é¢ˆ
     */
    public List<Bottleneck> detectBottlenecks() {
        List<Bottleneck> bottlenecks = new ArrayList<>();
        
        // 1. CPUç“¶é¢ˆæ£€æµ‹
        double cpuUsage = metricsService.getCpuUsage();
        if (cpuUsage > 80) {
            Bottleneck cpuBottleneck = Bottleneck.builder()
                .type(BottleneckType.CPU)
                .severity(cpuUsage > 95 ? Severity.CRITICAL : Severity.WARNING)
                .description("CPUä½¿ç”¨ç‡è¿‡é«˜: " + cpuUsage + "%")
                .suggestions(Arrays.asList(
                    "æ£€æŸ¥æ˜¯å¦æœ‰æ­»å¾ªç¯æˆ–è®¡ç®—å¯†é›†å‹ä»»åŠ¡",
                    "è€ƒè™‘æ°´å¹³æ‰©å®¹å¢åŠ æœºå™¨",
                    "ä¼˜åŒ–ç®—æ³•å‡å°‘CPUæ¶ˆè€—"
                ))
                .build();
            bottlenecks.add(cpuBottleneck);
        }
        
        // 2. å†…å­˜ç“¶é¢ˆæ£€æµ‹
        MemoryMetrics memory = metricsService.getMemoryMetrics();
        if (memory.getUsagePercent() > 85) {
            Bottleneck memoryBottleneck = Bottleneck.builder()
                .type(BottleneckType.MEMORY)
                .severity(memory.getUsagePercent() > 95 ? Severity.CRITICAL : Severity.WARNING)
                .description("å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: " + memory.getUsagePercent() + "%")
                .suggestions(Arrays.asList(
                    "æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„éœ²",
                    "è°ƒæ•´JVMå †å¤§å°",
                    "ä¼˜åŒ–æ•°æ®ç»“æ„å‡å°‘å†…å­˜å ç”¨"
                ))
                .build();
            bottlenecks.add(memoryBottleneck);
        }
        
        // 3. æ•°æ®åº“ç“¶é¢ˆæ£€æµ‹
        DatabaseMetrics db = metricsService.getDatabaseMetrics();
        if (db.getSlowQueryCount() > 10) {
            bottlenecks.add(Bottleneck.builder()
                .type(BottleneckType.DATABASE)
                .severity(Severity.WARNING)
                .description("æ…¢æŸ¥è¯¢æ•°é‡è¿‡å¤š: " + db.getSlowQueryCount())
                .suggestions(Arrays.asList(
                    "åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œä¼˜åŒ–SQL",
                    "æ£€æŸ¥ç´¢å¼•æ˜¯å¦æœ‰æ•ˆ",
                    "è€ƒè™‘åˆ†åº“åˆ†è¡¨"
                ))
                .build());
        }
        
        // 4. ç¼“å­˜ç“¶é¢ˆæ£€æµ‹
        CacheMetrics cache = metricsService.getCacheMetrics();
        if (cache.getHitRate() < 0.8) {
            bottlenecks.add(Bottleneck.builder()
                .type(BottleneckType.CACHE)
                .severity(Severity.WARNING)
                .description("ç¼“å­˜å‘½ä¸­ç‡è¿‡ä½: " + cache.getHitRate())
                .suggestions(Arrays.asList(
                    "æ£€æŸ¥ç¼“å­˜ç­–ç•¥æ˜¯å¦åˆç†",
                    "å¢åŠ ç¼“å­˜å®¹é‡",
                    "ä¼˜åŒ–ç¼“å­˜keyè®¾è®¡"
                ))
                .build());
        }
        
        return bottlenecks;
    }
    
    /**
     * æ™ºèƒ½ç“¶é¢ˆæ’åº - æŒ‰å½±å“ç¨‹åº¦æ’åº
     */
    public List<Bottleneck> prioritizeBottlenecks(List<Bottleneck> bottlenecks) {
        return bottlenecks.stream()
            .sorted((b1, b2) -> {
                // å…ˆæŒ‰ä¸¥é‡ç¨‹åº¦æ’åº
                int severityCompare = b2.getSeverity().getPriority() - b1.getSeverity().getPriority();
                if (severityCompare != 0) {
                    return severityCompare;
                }
                
                // å†æŒ‰ç±»å‹ä¼˜å…ˆçº§æ’åº (æ•°æ®åº“ > å†…å­˜ > CPU > ç¼“å­˜)
                return getTypeRank(b2.getType()) - getTypeRank(b1.getType());
            })
            .collect(Collectors.toList());
    }
    
    private int getTypeRank(BottleneckType type) {
        switch (type) {
            case DATABASE: return 4;
            case MEMORY: return 3;
            case CPU: return 2;
            case CACHE: return 1;
            default: return 0;
        }
    }
}
```

### 14.3 æ™ºèƒ½ä¼˜åŒ–å»ºè®®


**ğŸ§  AIè¾…åŠ©ä¼˜åŒ–å»ºè®®**
```java
@Service
public class IntelligentOptimizer {
    
    /**
     * æ ¹æ®ç“¶é¢ˆç”Ÿæˆä¼˜åŒ–æ–¹æ¡ˆ
     */
    public OptimizationPlan generateOptimizationPlan(List<Bottleneck> bottlenecks) {
        OptimizationPlan plan = new OptimizationPlan();
        
        for (Bottleneck bottleneck : bottlenecks) {
            switch (bottleneck.getType()) {
                case DATABASE:
                    plan.addAction(optimizeDatabaseBottleneck(bottleneck));
                    break;
                case MEMORY:
                    plan.addAction(optimizeMemoryBottleneck(bottleneck));
                    break;
                case CPU:
                    plan.addAction(optimizeCpuBottleneck(bottleneck));
                    break;
                case CACHE:
                    plan.addAction(optimizeCacheBottleneck(bottleneck));
                    break;
            }
        }
        
        return plan;
    }
    
    private OptimizationAction optimizeDatabaseBottleneck(Bottleneck bottleneck) {
        return OptimizationAction.builder()
            .title("æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–")
            .priority(Priority.HIGH)
            .estimatedImpact("æå‡å“åº”æ—¶é—´50-80%")
            .actions(Arrays.asList(
                "æ‰§è¡Œæ…¢æŸ¥è¯¢åˆ†æ: SHOW PROCESSLIST;",
                "æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ: EXPLAIN SELECT ...",
                "ä¼˜åŒ–æŸ¥è¯¢è¯­å¥ï¼Œé¿å…å…¨è¡¨æ‰«æ",
                "è€ƒè™‘å¢åŠ ä»åº“åˆ†æ‹…è¯»å‹åŠ›"
            ))
            .estimatedCost("1-3å¤©å¼€å‘æ—¶é—´")
            .riskLevel(RiskLevel.LOW)
            .build();
    }
}
```

---

## 15. ğŸ“ˆ å®¹é‡è§„åˆ’é¢„æµ‹æ¨¡å‹


### 15.1 å®¹é‡è§„åˆ’çš„é‡è¦æ€§


**ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å®¹é‡è§„åˆ’**
```
ä¸šåŠ¡å¢é•¿: ç”¨æˆ·é‡ã€è®¢å•é‡æŒç»­å¢é•¿
æˆæœ¬æ§åˆ¶: é¿å…è¿‡åº¦é‡‡è´­ç¡¬ä»¶èµ„æº
é£é™©é˜²æ§: é˜²æ­¢å¤§ä¿ƒæ—¶ç³»ç»Ÿå´©æºƒ
æ€§èƒ½ä¿è¯: ä¿æŒç³»ç»Ÿå“åº”æ—¶é—´ç¨³å®š
```

> ğŸ’¡ **å®¹é‡è§„åˆ’æœ¬è´¨**: åŸºäºå†å²æ•°æ®å’Œä¸šåŠ¡é¢„æµ‹ï¼Œæå‰å‡†å¤‡è¶³å¤Ÿçš„ç³»ç»Ÿèµ„æº

### 15.2 é¢„æµ‹æ¨¡å‹ç®—æ³•


**ğŸ“Š æ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹**
```java
@Service
public class CapacityPredictionService {
    
    /**
     * çº¿æ€§å›å½’é¢„æµ‹æ¨¡å‹
     */
    public PredictionResult predictByLinearRegression(List<CapacityData> historicalData) {
        int n = historicalData.size();
        double sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
        
        for (int i = 0; i < n; i++) {
            CapacityData data = historicalData.get(i);
            double x = i;  // æ—¶é—´åºåˆ—
            double y = data.getValue();  // å¯¹åº”çš„æŒ‡æ ‡å€¼
            
            sumX += x;
            sumY += y;
            sumXY += x * y;
            sumX2 += x * x;
        }
        
        // è®¡ç®—å›å½’ç³»æ•°
        double slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        double intercept = (sumY - slope * sumX) / n;
        
        // é¢„æµ‹æœªæ¥30å¤©çš„å€¼
        List<Double> predictions = new ArrayList<>();
        for (int i = n; i < n + 30; i++) {
            double predictedValue = intercept + slope * i;
            predictions.add(predictedValue);
        }
        
        return new PredictionResult(predictions, calculateAccuracy(historicalData, slope, intercept));
    }
    
    /**
     * ç§»åŠ¨å¹³å‡é¢„æµ‹ - é€‚ç”¨äºå‘¨æœŸæ€§æ•°æ®
     */
    public PredictionResult predictByMovingAverage(List<CapacityData> historicalData, int windowSize) {
        List<Double> predictions = new ArrayList<>();
        
        // è®¡ç®—æœ€è¿‘çª—å£æœŸçš„å¹³å‡å€¼
        for (int i = historicalData.size() - windowSize; i < historicalData.size(); i++) {
            double sum = 0;
            for (int j = i - windowSize + 1; j <= i; j++) {
                sum += historicalData.get(j).getValue();
            }
            double avg = sum / windowSize;
            predictions.add(avg);
        }
        
        return new PredictionResult(predictions, 0.85);
    }
    
    /**
     * å­£èŠ‚æ€§è°ƒæ•´é¢„æµ‹ - è€ƒè™‘ç”µå•†å‘¨æœŸç‰¹ç‚¹
     */
    public PredictionResult predictWithSeasonality(List<CapacityData> historicalData) {
        Map<Integer, Double> seasonalFactors = calculateSeasonalFactors(historicalData);
        
        List<Double> predictions = new ArrayList<>();
        for (int dayOfYear = 1; dayOfYear <= 30; dayOfYear++) {
            // åŸºç¡€è¶‹åŠ¿é¢„æµ‹
            double basePrediction = predictBaseTrend(historicalData, dayOfYear);
            
            // å­£èŠ‚æ€§è°ƒæ•´
            double seasonalFactor = seasonalFactors.getOrDefault(dayOfYear % 365, 1.0);
            double adjustedPrediction = basePrediction * seasonalFactor;
            
            predictions.add(adjustedPrediction);
        }
        
        return new PredictionResult(predictions, 0.92);
    }
}
```

### 15.3 èµ„æºéœ€æ±‚è®¡ç®—


**âš™ï¸ èµ„æºéœ€æ±‚é¢„æµ‹**
```java
@Service
public class ResourceCalculator {
    
    /**
     * æ ¹æ®ä¸šåŠ¡é‡é¢„æµ‹è®¡ç®—èµ„æºéœ€æ±‚
     */
    public ResourceRequirement calculateResourceRequirement(BusinessForecast forecast) {
        
        // 1. è®¡ç®—QPSéœ€æ±‚
        long expectedOrders = forecast.getExpectedOrders();
        long peakQPS = expectedOrders / (8 * 3600) * 10;  // å‡è®¾8å°æ—¶å†…å®Œæˆï¼Œå³°å€¼æ˜¯å¹³å‡çš„10å€
        
        // 2. è®¡ç®—æœåŠ¡å™¨æ•°é‡
        int serverCapacity = 1000;  // å•æœºQPSå®¹é‡
        int requiredServers = (int) Math.ceil((double) peakQPS / serverCapacity) * 2;  // 2å€å†—ä½™
        
        // 3. è®¡ç®—æ•°æ®åº“èµ„æº
        long expectedConnections = peakQPS / 10;  // å‡è®¾å¹³å‡10ä¸ªQPSéœ€è¦1ä¸ªè¿æ¥
        int requiredDBConnections = (int) expectedConnections * 2;  // 2å€å†—ä½™
        
        // 4. è®¡ç®—ç¼“å­˜èµ„æº
        long orderDataSize = expectedOrders * 1024;  // æ¯ä¸ªè®¢å•1KBç¼“å­˜æ•°æ®
        long userSessionSize = forecast.getExpectedUsers() * 512;  // æ¯ä¸ªç”¨æˆ·500Bä¼šè¯æ•°æ®
        long totalCacheMemory = (orderDataSize + userSessionSize) * 2;  // 2å€å†—ä½™
        
        // 5. è®¡ç®—å­˜å‚¨èµ„æº
        long orderStorageSize = expectedOrders * 2048;  // æ¯ä¸ªè®¢å•2KBå­˜å‚¨æ•°æ®
        long logStorageSize = peakQPS * 3600 * 24 * 100;  // æ¯ä¸ªè¯·æ±‚100Bæ—¥å¿—ï¼Œä¿å­˜24å°æ—¶
        long totalStorage = orderStorageSize + logStorageSize;
        
        return ResourceRequirement.builder()
            .applicationServers(requiredServers)
            .databaseConnections(requiredDBConnections)
            .cacheMemoryMB(totalCacheMemory / 1024 / 1024)
            .storageGB(totalStorage / 1024 / 1024 / 1024)
            .expectedPeakQPS(peakQPS)
            .confidenceLevel(forecast.getConfidenceLevel())
            .build();
    }
    
    /**
     * æˆæœ¬ä¼°ç®—
     */
    public CostEstimate estimateCost(ResourceRequirement requirement) {
        // æœåŠ¡å™¨æˆæœ¬ (æ¯å°æ¯æœˆ1000å…ƒ)
        double serverCost = requirement.getApplicationServers() * 1000;
        
        // æ•°æ®åº“æˆæœ¬ (æ¯100è¿æ¥æ¯æœˆ500å…ƒ)
        double dbCost = Math.ceil(requirement.getDatabaseConnections() / 100.0) * 500;
        
        // ç¼“å­˜æˆæœ¬ (æ¯GBæ¯æœˆ10å…ƒ)
        double cacheCost = requirement.getCacheMemoryMB() / 1024.0 * 10;
        
        // å­˜å‚¨æˆæœ¬ (æ¯GBæ¯æœˆ2å…ƒ)
        double storageCost = requirement.getStorageGB() * 2;
        
        double totalMonthlyCost = serverCost + dbCost + cacheCost + storageCost;
        
        return CostEstimate.builder()
            .serverCost(serverCost)
            .databaseCost(dbCost)
            .cacheCost(cacheCost)
            .storageCost(storageCost)
            .totalMonthlyCost(totalMonthlyCost)
            .build();
    }
}
```

---

## 16. ğŸ“‹ æ€§èƒ½ä¼˜åŒ–æ•ˆæœè¯„ä¼°ä½“ç³»


### 16.1 è¯„ä¼°ä½“ç³»æ¡†æ¶


**ğŸ¯ è¯„ä¼°ç»´åº¦è®¾è®¡**
```
æŠ€æœ¯æŒ‡æ ‡: å“åº”æ—¶é—´ã€ååé‡ã€èµ„æºä½¿ç”¨ç‡
ä¸šåŠ¡æŒ‡æ ‡: è½¬åŒ–ç‡ã€ç”¨æˆ·ä½“éªŒã€ç³»ç»Ÿç¨³å®šæ€§  
æˆæœ¬æŒ‡æ ‡: ç¡¬ä»¶æˆæœ¬ã€ç»´æŠ¤æˆæœ¬ã€å¼€å‘æˆæœ¬
é£é™©æŒ‡æ ‡: ç³»ç»Ÿå¯ç”¨æ€§ã€æ•°æ®å®‰å…¨æ€§ã€æ‰©å±•æ€§
```

### 16.2 æ•ˆæœé‡åŒ–æ¨¡å‹


**ğŸ“Š ä¼˜åŒ–æ•ˆæœè®¡ç®—**
```java
@Service
public class OptimizationEffectEvaluator {
    
    /**
     * ç»¼åˆæ•ˆæœè¯„ä¼°
     */
    public OptimizationReport evaluateOptimization(
            PerformanceData beforeData, 
            PerformanceData afterData,
            OptimizationCost cost) {
        
        // 1. æŠ€æœ¯æŒ‡æ ‡æ”¹è¿›
        TechnicalImprovements technical = calculateTechnicalImprovements(beforeData, afterData);
        
        // 2. ä¸šåŠ¡æŒ‡æ ‡æ”¹è¿›  
        BusinessImprovements business = calculateBusinessImprovements(beforeData, afterData);
        
        // 3. æˆæœ¬æ•ˆç›Šåˆ†æ
        CostBenefitAnalysis costBenefit = analyzeCostBenefit(technical, business, cost);
        
        // 4. ROIè®¡ç®—
        double roi = calculateROI(business, cost);
        
        return OptimizationReport.builder()
            .technicalImprovements(technical)
            .businessImprovements(business)
            .costBenefit(costBenefit)
            .roi(roi)
            .overallScore(calculateOverallScore(technical, business, costBenefit))
            .build();
    }
    
    private TechnicalImprovements calculateTechnicalImprovements(
            PerformanceData before, PerformanceData after) {
        
        // å“åº”æ—¶é—´æ”¹è¿›
        double responseTimeImprovement = 
            (before.getAverageResponseTime() - after.getAverageResponseTime()) 
            / before.getAverageResponseTime() * 100;
        
        // ååé‡æ”¹è¿›
        double throughputImprovement = 
            (after.getThroughput() - before.getThroughput()) 
            / before.getThroughput() * 100;
        
        // èµ„æºä½¿ç”¨ç‡æ”¹è¿›
        double cpuImprovement = 
            (before.getCpuUsage() - after.getCpuUsage()) 
            / before.getCpuUsage() * 100;
        
        return TechnicalImprovements.builder()
            .responseTimeImprovement(responseTimeImprovement)
            .throughputImprovement(throughputImprovement)
            .cpuUsageImprovement(cpuImprovement)
            .build();
    }
    
    private BusinessImprovements calculateBusinessImprovements(
            PerformanceData before, PerformanceData after) {
        
        // è½¬åŒ–ç‡æ”¹è¿› (å“åº”æ—¶é—´æ¯æ”¹è¿›100msï¼Œè½¬åŒ–ç‡æå‡0.1%)
        double conversionRateImprovement = 
            (before.getAverageResponseTime() - after.getAverageResponseTime()) / 100 * 0.1;
        
        // ç”¨æˆ·æ»¡æ„åº¦æ”¹è¿› (åŸºäºå“åº”æ—¶é—´)
        double satisfactionImprovement = calculateSatisfactionImprovement(before, after);
        
        return BusinessImprovements.builder()
            .conversionRateImprovement(conversionRateImprovement)
            .userSatisfactionImprovement(satisfactionImprovement)
            .build();
    }
    
    private double calculateROI(BusinessImprovements business, OptimizationCost cost) {
        // æ”¶ç›Šè®¡ç®— (è½¬åŒ–ç‡æå‡å¸¦æ¥çš„é¢å¤–æ”¶å…¥)
        double additionalRevenue = business.getConversionRateImprovement() * 
                                 1000000;  // å‡è®¾åŸºç¡€æ”¶å…¥100ä¸‡
        
        // æŠ•èµ„å›æŠ¥ç‡
        return (additionalRevenue - cost.getTotalCost()) / cost.getTotalCost() * 100;
    }
}
```

### 16.3 æŒç»­ç›‘æ§æœºåˆ¶


**ğŸ” é•¿æœŸæ•ˆæœè·Ÿè¸ª**
```java
@Service
public class ContinuousMonitoringService {
    
    @Scheduled(fixedRate = 86400000)  // æ¯å¤©æ‰§è¡Œ
    public void monitorOptimizationEffects() {
        List<OptimizationProject> projects = optimizationProjectService.getActiveProjects();
        
        projects.forEach(project -> {
            // æ”¶é›†å½“å‰æ€§èƒ½æ•°æ®
            PerformanceData currentData = collectPerformanceData(project.getScope());
            
            // ä¸åŸºçº¿å¯¹æ¯”
            PerformanceData baseline = project.getBaseline();
            double improvement = calculateImprovement(baseline, currentData);
            
            // æ•ˆæœæŒç»­æ€§æ£€æŸ¥
            if (improvement < project.getExpectedImprovement() * 0.8) {
                // æ•ˆæœä¸‹é™ï¼Œå‘é€å‘Šè­¦
                alertService.sendAlert(
                    AlertLevel.WARNING,
                    "ä¼˜åŒ–æ•ˆæœä¸‹é™: " + project.getName() + 
                    ", å½“å‰æ”¹è¿›: " + improvement + "%, é¢„æœŸ: " + project.getExpectedImprovement() + "%"
                );
                
                // è‡ªåŠ¨åˆ†æå¯èƒ½åŸå› 
                analyzePerformanceDegradation(project, currentData);
            }
            
            // æ›´æ–°é¡¹ç›®çŠ¶æ€
            project.setCurrentPerformance(currentData);
            project.setLastMonitorTime(new Date());
            optimizationProjectService.updateProject(project);
        });
    }
    
    private void analyzePerformanceDegradation(OptimizationProject project, PerformanceData current) {
        List<String> possibleCauses = new ArrayList<>();
        
        // åˆ†æå¯èƒ½åŸå› 
        if (current.getCpuUsage() > project.getBaseline().getCpuUsage() * 1.2) {
            possibleCauses.add("CPUä½¿ç”¨ç‡å¼‚å¸¸å‡é«˜ï¼Œå¯èƒ½æœ‰æ–°å¢è®¡ç®—å¯†é›†å‹ä»»åŠ¡");
        }
        
        if (current.getDatabaseResponseTime() > project.getBaseline().getDatabaseResponseTime() * 1.3) {
            possibleCauses.add("æ•°æ®åº“å“åº”æ—¶é—´å˜æ…¢ï¼Œå¯èƒ½éœ€è¦é‡æ–°ä¼˜åŒ–SQLæˆ–ç´¢å¼•");
        }
        
        if (current.getCacheHitRate() < project.getBaseline().getCacheHitRate() * 0.9) {
            possibleCauses.add("ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼Œå¯èƒ½ç¼“å­˜ç­–ç•¥å¤±æ•ˆ");
        }
        
        // ç”Ÿæˆåˆ†ææŠ¥å‘Š
        PerformanceDegradationReport report = PerformanceDegradationReport.builder()
            .projectName(project.getName())
            .degradationRate((project.getExpectedImprovement() - calculateImprovement(project.getBaseline(), current)) / project.getExpectedImprovement())
            .possibleCauses(possibleCauses)
            .recommendedActions(generateRecommendations(possibleCauses))
            .build();
        
        // å‘é€è¯¦ç»†æŠ¥å‘Š
        reportService.sendDegradationReport(report);
    }
}
```

---

## 17. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 17.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¥ çƒ­ç‚¹æ•°æ®å¤„ç†ï¼šå¤šçº§ç¼“å­˜ + é¢„çƒ­æœºåˆ¶ + æµé‡åˆ†æ•£
âš¡ ç§’æ€ç³»ç»Ÿä¼˜åŒ–ï¼šå‰ç«¯é™åˆ¶ + åç«¯å‰Šå³° + Redisè®¡æ•°
ğŸ“¦ åº“å­˜æ‰£å‡ä¼˜åŒ–ï¼šåŸå­æ“ä½œ + åˆ†å¸ƒå¼é” + å¼‚æ­¥åŒæ­¥
ğŸŒŠ æµé‡å‰Šå³°å¡«è°·ï¼šå¤šå±‚é™æµ + MQç¼“å†² + æœåŠ¡é™çº§
ğŸ¤ è®¢å•ä¸€è‡´æ€§ï¼šTCCæ¨¡å¼ + SAGAæ¨¡å¼ + æœ€ç»ˆä¸€è‡´æ€§
ğŸ’³ æ”¯ä»˜ç³»ç»Ÿä¼˜åŒ–ï¼šå¼‚æ­¥å¤„ç† + æ¸ é“é€‰æ‹© + ç»“æœç¼“å­˜
ğŸ“Š é“¾è·¯ç›‘æ§ï¼šå…¨é“¾è·¯è·Ÿè¸ª + å…³é”®æŒ‡æ ‡ + å¼‚å¸¸å‘Šè­¦
ğŸ—ï¸ æ•°æ®åº“è®¾è®¡ï¼šè¯»å†™åˆ†ç¦» + åˆ†åº“åˆ†è¡¨ + ç´¢å¼•ä¼˜åŒ–
ğŸ›¡ï¸ ç¼“å­˜ç­–ç•¥ï¼šé˜²ç©¿é€ + é˜²é›ªå´© + é¢„çƒ­æœºåˆ¶
ğŸ” åˆ†å¸ƒå¼é”ï¼šRediså®ç° + å¯é‡å…¥é” + æ€§èƒ½ä¼˜åŒ–
ğŸ“® æ¶ˆæ¯é˜Ÿåˆ—ï¼šå‰Šå³°å¡«è°· + å¯é æŠ•é€’ + æ‰¹é‡æ¶ˆè´¹
ğŸ”„ é™çº§ç†”æ–­ï¼šå¤šçº§é™çº§ + ç†”æ–­æœºåˆ¶ + æ•…éšœæ¢å¤
ğŸ“ˆ æ€§èƒ½åŸºçº¿ï¼šæŒ‡æ ‡é‡‡é›† + åŸºçº¿å»ºç«‹ + å¼‚å¸¸æ£€æµ‹
ğŸ” ç“¶é¢ˆè¯†åˆ«ï¼šè‡ªåŠ¨æ£€æµ‹ + æ™ºèƒ½åˆ†æ + ä¼˜åŒ–å»ºè®®
ğŸ“Š å®¹é‡è§„åˆ’ï¼šé¢„æµ‹æ¨¡å‹ + èµ„æºè®¡ç®— + æˆæœ¬ä¼°ç®—
ğŸ“‹ æ•ˆæœè¯„ä¼°ï¼šæŒ‡æ ‡é‡åŒ– + ROIè®¡ç®— + æŒç»­ç›‘æ§
```

### 17.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ€è·¯**
```
åˆ†å±‚ä¼˜åŒ–ï¼šå‰ç«¯ â†’ ç½‘å…³ â†’ åº”ç”¨ â†’ ç¼“å­˜ â†’ æ•°æ®åº“
å¼‚æ­¥è§£è€¦ï¼šåŒæ­¥å˜å¼‚æ­¥ï¼Œå®æ—¶å˜å‡†å®æ—¶
ç¼“å­˜ä¼˜å…ˆï¼šèƒ½ç¼“å­˜å°±ç¼“å­˜ï¼Œå¤šçº§ç¼“å­˜æ›´å¯é 
é™çº§ä¿æŠ¤ï¼šæ ¸å¿ƒåŠŸèƒ½ä¿è¯ï¼Œéæ ¸å¿ƒåŠŸèƒ½é™çº§
ç›‘æ§é©±åŠ¨ï¼šæ•°æ®è¯´è¯ï¼ŒæŒç»­ä¼˜åŒ–
```

**ğŸ”¹ é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡åŸåˆ™**
```
æ— çŠ¶æ€è®¾è®¡ï¼šåº”ç”¨æœåŠ¡å™¨æ— çŠ¶æ€ï¼Œä¾¿äºæ°´å¹³æ‰©å±•
è¯»å†™åˆ†ç¦»ï¼šè¯»å¤šå†™å°‘åœºæ™¯ï¼Œåˆ†ç¦»è¯»å†™æå‡æ€§èƒ½
åˆ†åº“åˆ†è¡¨ï¼šæ•°æ®é‡å¤§æ—¶ï¼Œé€šè¿‡åˆ†ç‰‡æå‡æ€§èƒ½
ç¼“å­˜ä¸ºç‹ï¼šçƒ­ç‚¹æ•°æ®å¿…é¡»ç¼“å­˜ï¼Œç¼“å­˜å¤±æ•ˆè¦æœ‰ä¿æŠ¤
å¼‚æ­¥ä¼˜å…ˆï¼šèƒ½å¼‚æ­¥å°±ä¸åŒæ­¥ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
```

**ğŸ”¹ ç”µå•†åœºæ™¯ç‰¹æ®Šè€ƒè™‘**
```
ä¸šåŠ¡ç‰¹ç‚¹ï¼š
â€¢ è¯»å¤šå†™å°‘ï¼šå•†å“æµè§ˆ >> ä¸‹å•æ”¯ä»˜
â€¢ æ³¢å³°æ³¢è°·ï¼šä¿ƒé”€æ—¶æµé‡æš´å¢ï¼Œå¹³æ—¶ç›¸å¯¹å¹³ç¨³
â€¢ å¼ºä¸€è‡´æ€§ï¼šè®¢å•ã€åº“å­˜ã€èµ„é‡‘æ•°æ®å¿…é¡»å‡†ç¡®
â€¢ é«˜å¯ç”¨æ€§ï¼šç³»ç»Ÿä¸èƒ½åœï¼Œåœä¸€åˆ†é’ŸæŸå¤±å·¨å¤§

æŠ€æœ¯é€‰å‹ï¼š
â€¢ ç¼“å­˜é€‰æ‹©Redisï¼šæ€§èƒ½å¥½ï¼Œæ”¯æŒä¸°å¯Œæ•°æ®ç»“æ„
â€¢ æ¶ˆæ¯é˜Ÿåˆ—é€‰æ‹©RabbitMQ/RocketMQï¼šå¯é æ€§é«˜
â€¢ æ•°æ®åº“é€‰æ‹©MySQLï¼šäº‹åŠ¡æ”¯æŒå¥½ï¼Œç”Ÿæ€æˆç†Ÿ
â€¢ ç›‘æ§é€‰æ‹©Prometheus+Grafanaï¼šå¼€æºæˆç†Ÿ
```

### 17.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡ä»·å€¼**
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šå“åº”æ—¶é—´ä»ç§’çº§ä¼˜åŒ–åˆ°æ¯«ç§’çº§
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šå¤§ä¿ƒæœŸé—´99.9%å¯ç”¨æ€§ä¿è¯
- **æˆæœ¬æ§åˆ¶**ï¼šé€šè¿‡ä¼˜åŒ–å‡å°‘50%ç¡¬ä»¶èµ„æºéœ€æ±‚
- **ä¸šåŠ¡å¢é•¿æ”¯æŒ**ï¼šç³»ç»Ÿèƒ½åŠ›æ”¯æ’‘10å€ä¸šåŠ¡å¢é•¿

**ğŸ”§ æŠ€æœ¯ä»·å€¼**
- **æ¶æ„ä¼˜åŒ–**ï¼šä»å•ä½“å‘å¾®æœåŠ¡æ¼”è¿›çš„å®è·µç»éªŒ
- **æ€§èƒ½è°ƒä¼˜**ï¼šæ•°æ®åº“ã€ç¼“å­˜ã€åº”ç”¨å±‚å…¨æ–¹ä½ä¼˜åŒ–
- **è¿ç»´å‡çº§**ï¼šä»è¢«åŠ¨è¿ç»´åˆ°ä¸»åŠ¨ç›‘æ§é¢„è­¦
- **å›¢é˜Ÿæå‡**ï¼šåŸ¹å…»é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡å’Œä¼˜åŒ–èƒ½åŠ›

**ğŸ’¡ å­¦ä¹ å»ºè®®**
```
ç†è®ºåŸºç¡€ï¼š
â€¢ æ·±å…¥ç†è§£æ•°æ®åº“åŸç†ã€ç¼“å­˜åŸç†ã€ç½‘ç»œåŸç†
â€¢ æŒæ¡åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºã€CAPå®šç†ã€BASEç†è®º
â€¢ å­¦ä¹ ç³»ç»Ÿè®¾è®¡æ¨¡å¼ã€æ¶æ„è®¾è®¡åŸåˆ™

å®è·µç»éªŒï¼š
â€¢ ä»å°é¡¹ç›®å¼€å§‹ï¼Œé€æ­¥ç§¯ç´¯æ€§èƒ½ä¼˜åŒ–ç»éªŒ
â€¢ å¤šå‚ä¸å¤§ä¿ƒå¤‡æˆ˜ï¼Œäº†è§£çœŸå®é«˜å¹¶å‘åœºæ™¯
â€¢ å…³æ³¨ä¸šç•Œæœ€ä½³å®è·µï¼Œå­¦ä¹ å¤§å‚ä¼˜åŒ–ç»éªŒ

å·¥å…·æŒæ¡ï¼š
â€¢ ç›‘æ§å·¥å…·ï¼šPrometheusã€Grafanaã€SkyWalking
â€¢ å‹æµ‹å·¥å…·ï¼šJMeterã€K6ã€é˜¿é‡Œäº‘PTS
â€¢ åˆ†æå·¥å…·ï¼šJProfilerã€Arthasã€å„ç§å‘½ä»¤è¡Œå·¥å…·
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> ğŸ”¥ **çƒ­ç‚¹ç¼“å­˜å¤šå±‚é˜²ï¼Œç§’æ€å‰Šå³°MQæ‰›**  
> ğŸ“¦ **åº“å­˜åŸå­é”æ¥ä¿ï¼Œè®¢å•ä¸€è‡´äº‹åŠ¡å¼º**  
> ğŸ›¡ï¸ **ç©¿é€é›ªå´©å¸ƒéš†æŒ¡ï¼Œé™çº§ç†”æ–­æ•…éšœé˜²**  
> ğŸ“Š **ç›‘æ§åŸºçº¿æ—¶åˆ»çœ‹ï¼Œç“¶é¢ˆè¯†åˆ«è‡ªåŠ¨å¸®**  
> ğŸ’° **å®¹é‡è§„åˆ’æˆæœ¬ç®—ï¼Œæ•ˆæœè¯„ä¼°ROIé‡**

è®°ä½ï¼šç”µå•†æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦ä»ä¸šåŠ¡ç†è§£åˆ°æŠ€æœ¯å®ç°ï¼Œä»æ¶æ„è®¾è®¡åˆ°è¿ç»´ç›‘æ§çš„å…¨æ–¹ä½è€ƒè™‘ã€‚æ¯ä¸€ä¸ªä¼˜åŒ–ç‚¹éƒ½è¦ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯ï¼Œè¿½æ±‚çš„æ˜¯æ•´ä½“æ•ˆæœè€Œä¸æ˜¯å•ç‚¹æè‡´ã€‚