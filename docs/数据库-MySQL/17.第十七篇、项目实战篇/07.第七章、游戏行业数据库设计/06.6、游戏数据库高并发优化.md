---
title: 6ã€æ¸¸æˆæ•°æ®åº“é«˜å¹¶å‘ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [æ¸¸æˆæ•°æ®åº“ç‰¹æ€§åˆ†æ](#1-æ¸¸æˆæ•°æ®åº“ç‰¹æ€§åˆ†æ)
2. [çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†](#2-çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†)
3. [é«˜å¹¶å‘æ¶æ„è®¾è®¡](#3-é«˜å¹¶å‘æ¶æ„è®¾è®¡)
4. [æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–](#4-æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–)
5. [æ‰¹é‡æ“ä½œä¸å¼‚æ­¥ç­–ç•¥](#5-æ‰¹é‡æ“ä½œä¸å¼‚æ­¥ç­–ç•¥)
6. [åˆ†åº“åˆ†è¡¨è®¾è®¡](#6-åˆ†åº“åˆ†è¡¨è®¾è®¡)
7. [ç¼“å­˜å±‚æ¶æ„](#7-ç¼“å­˜å±‚æ¶æ„)
8. [æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜](#8-æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ® æ¸¸æˆæ•°æ®åº“ç‰¹æ€§åˆ†æ


### 1.1 æ¸¸æˆæ•°æ®è¯»å†™ç‰¹å¾


**ğŸ”¸ æ ¸å¿ƒç‰¹ç‚¹è§£æ**
```
æ¸¸æˆæ•°æ®åº“ vs ä¼ ç»Ÿä¸šåŠ¡æ•°æ®åº“çš„æ ¹æœ¬åŒºåˆ«ï¼š

ä¼ ç»Ÿç”µå•†ï¼š
- å†™å°‘è¯»å¤šï¼ˆå•†å“ä¿¡æ¯æŸ¥è¯¢é¢‘ç¹ï¼Œè®¢å•ç”Ÿæˆç›¸å¯¹è¾ƒå°‘ï¼‰
- æ•°æ®ç›¸å¯¹é™æ€ï¼ˆå•†å“ä¿¡æ¯å˜åŒ–ä¸é¢‘ç¹ï¼‰
- ç”¨æˆ·è¡Œä¸ºå¯é¢„æµ‹ï¼ˆæµè§ˆâ†’è´­ä¹°çš„æ ‡å‡†æµç¨‹ï¼‰

æ¸¸æˆæ•°æ®åº“ï¼š
- è¯»å†™å¹¶é‡ï¼ˆç©å®¶çŠ¶æ€é¢‘ç¹æ›´æ–°ï¼ŒåŒæ—¶éœ€è¦é¢‘ç¹æŸ¥è¯¢ï¼‰
- æ•°æ®é«˜åº¦åŠ¨æ€ï¼ˆç©å®¶ä½ç½®ã€è¡€é‡ã€è£…å¤‡å®æ—¶å˜åŒ–ï¼‰
- ç”¨æˆ·è¡Œä¸ºä¸å¯é¢„æµ‹ï¼ˆPKã€ç»„é˜Ÿã€äº¤æ˜“éšæ—¶å‘ç”Ÿï¼‰
```

**ğŸ’¡ æ¸¸æˆæ•°æ®ç‰¹æ€§è¯¦è§£**

| æ•°æ®ç±»å‹ | **è¯»å†™æ¯”ä¾‹** | **æ›´æ–°é¢‘ç‡** | **æ•°æ®é‡** | **ä¸€è‡´æ€§è¦æ±‚** |
|---------|------------|-------------|-----------|---------------|
| **ç©å®¶çŠ¶æ€** | `è¯»å¤šå†™å¤š` | `ç§’çº§` | `ä¸­ç­‰` | **å¼ºä¸€è‡´** |
| **è£…å¤‡é“å…·** | `è¯»å¤šå†™ä¸­` | `åˆ†é’Ÿçº§` | `å¤§` | **æœ€ç»ˆä¸€è‡´** |
| **èŠå¤©è®°å½•** | `è¯»å°‘å†™å¤š` | `å®æ—¶` | `æå¤§` | **å¼±ä¸€è‡´** |
| **æ’è¡Œæ¦œ** | `è¯»å¤šå†™å°‘` | `å°æ—¶çº§` | `å°` | **æœ€ç»ˆä¸€è‡´** |

### 1.2 æ¸¸æˆåœºæ™¯æ•°æ®å‹åŠ›åˆ†æ


**âš¡ é«˜å³°æ—¶åˆ»å‹åŠ›æº**
```
å…¸å‹MMORPGæ¸¸æˆæ™šé«˜å³°ï¼ˆ20:00-22:00ï¼‰ï¼š

ä¸–ç•ŒBOSSæˆ˜æ–—åœºæ™¯ï¼š
â€¢ 1000+ç©å®¶åŒæ—¶åœ¨çº¿
â€¢ æ¯ç§’50+æ¬¡ä½ç½®æ›´æ–°
â€¢ æ¯ç§’30+æ¬¡æŠ€èƒ½é‡Šæ”¾
â€¢ æ¯ç§’20+æ¬¡è¡€é‡å˜åŒ–
â†’ æ€»è®¡ï¼š100+ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰

å…¬ä¼šæˆ˜åœºæ™¯ï¼š
â€¢ 500vs500ç©å®¶å¯¹æˆ˜
â€¢ å¯†é›†çš„çŠ¶æ€åŒæ­¥
â€¢ å®æ—¶æˆ˜æ–—æ•°æ®è®°å½•
â†’ å¯èƒ½äº§ç”Ÿï¼š500+ TPS

å…³é”®ç†è§£ï¼š
æ¸¸æˆä¸åŒäºç½‘ç«™ï¼Œç©å®¶æ“ä½œæ˜¯è¿ç»­çš„ã€å®æ—¶çš„
ä¸€ä¸ªç©å®¶ç§»åŠ¨ï¼Œéœ€è¦åŒæ­¥ç»™å‘¨å›´æ‰€æœ‰ç©å®¶
```

---

## 2. ğŸ¯ çƒ­ç‚¹æ•°æ®è¯†åˆ«ä¸å¤„ç†


### 2.1 ä»€ä¹ˆæ˜¯æ¸¸æˆçƒ­ç‚¹æ•°æ®


**ğŸ”¸ çƒ­ç‚¹æ•°æ®å®šä¹‰**
```
çƒ­ç‚¹æ•°æ®ï¼šåœ¨çŸ­æ—¶é—´å†…è¢«å¤§é‡ç©å®¶é¢‘ç¹è®¿é—®çš„æ•°æ®

å…¸å‹çƒ­ç‚¹æ•°æ®åœºæ™¯ï¼š
1. æ–°æœå¼€å¯ï¼šå¤§é‡ç©å®¶é›†ä¸­åœ¨æ–°æ‰‹æ‘
2. é™æ—¶æ´»åŠ¨ï¼šæŠ¢å¤ºç¨€æœ‰è£…å¤‡æˆ–ææ–™
3. æ’è¡Œæ¦œï¼šå…¬ä¼šæˆ˜æ’åã€ä¸ªäººç­‰çº§æ¦œ
4. æ‹å–è¡Œï¼šçƒ­é—¨è£…å¤‡çš„ç«æ‹
5. èŠå¤©é¢‘é“ï¼šä¸–ç•Œé¢‘é“æ¶ˆæ¯
```

**ğŸ“Š çƒ­ç‚¹æ•°æ®è¯†åˆ«æ–¹æ³•**

```sql
-- ç¤ºä¾‹ï¼šè¯†åˆ«çƒ­ç‚¹è£…å¤‡ï¼ˆ1å°æ—¶å†…è¢«æŸ¥çœ‹è¶…è¿‡1000æ¬¡çš„è£…å¤‡ï¼‰
SELECT 
    item_id,
    item_name,
    COUNT(*) as view_count
FROM item_view_log 
WHERE view_time >= NOW() - INTERVAL 1 HOUR
GROUP BY item_id, item_name
HAVING COUNT(*) > 1000
ORDER BY view_count DESC;
```

### 2.2 çƒ­ç‚¹æ•°æ®å¤„ç†ç­–ç•¥


**ğŸ› ï¸ åˆ†å±‚å¤„ç†æ–¹æ¡ˆ**

```
ç¬¬ä¸€å±‚ï¼šåº”ç”¨å±‚ç¼“å­˜ï¼ˆæ¸¸æˆæœåŠ¡å™¨å†…å­˜ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çƒ­ç‚¹è£…å¤‡ä¿¡æ¯ï¼ˆRedisï¼‰    â”‚ â† 1mså“åº”æ—¶é—´
â”‚ æ’è¡Œæ¦œæ•°æ®ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬äºŒå±‚ï¼šåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedisé›†ç¾¤ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç©å®¶åŸºç¡€ä¿¡æ¯            â”‚ â† 5mså“åº”æ—¶é—´
â”‚ å…¬ä¼šæ•°æ®               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸‰å±‚ï¼šæ•°æ®åº“ï¼ˆMySQLï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®Œæ•´æ•°æ®å­˜å‚¨            â”‚ â† 50mså“åº”æ—¶é—´
â”‚ æŒä¹…åŒ–æ•°æ®             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’­ å®é™…åº”ç”¨æ€è€ƒ**
> æƒ³è±¡çƒ­é—¨è£…å¤‡å°±åƒå•†åœºé‡Œçš„çˆ†æ¬¾å•†å“ï¼Œå¦‚æœæ¯ä¸ªé¡¾å®¢éƒ½å»ä»“åº“æ‹¿ï¼Œä»“åº“ä¼šè¢«æŒ¤çˆ†ã€‚æ‰€ä»¥è¦åœ¨åº—é“ºå‰å°å¤šæ”¾å‡ ä¸ªæ ·å“ï¼Œè®©å¤§éƒ¨åˆ†é¡¾å®¢ç›´æ¥åœ¨å‰å°å°±èƒ½çœ‹åˆ°ã€‚

---

## 3. ğŸ—ï¸ é«˜å¹¶å‘æ¶æ„è®¾è®¡


### 3.1 è¯»å†™åˆ†ç¦»æ¶æ„


**ğŸ”„ æ¶æ„åŸç†è§£é‡Š**

```
ä¸ºä»€ä¹ˆéœ€è¦è¯»å†™åˆ†ç¦»ï¼Ÿ

å•æœºMySQLå›°å¢ƒï¼š
â€¢ å†™æ“ä½œéœ€è¦æ›´æ–°ç´¢å¼•ã€è®°å½•æ—¥å¿—
â€¢ è¯»æ“ä½œå’Œå†™æ“ä½œä¼šäº’ç›¸äº‰æŠ¢èµ„æº
â€¢ ä¸€å°æœºå™¨æ—¢è¦ä¿è¯æ•°æ®å®‰å…¨ï¼Œåˆè¦å¿«é€Ÿå“åº”æŸ¥è¯¢

è¯»å†™åˆ†ç¦»è§£å†³æ€è·¯ï¼š
â€¢ ä¸“é—¨çš„ä¸»åº“ï¼ˆMasterï¼‰è´Ÿè´£å†™å…¥
â€¢ å¤šä¸ªä»åº“ï¼ˆSlaveï¼‰è´Ÿè´£æŸ¥è¯¢
â€¢ å†™ä¸€æ¬¡ï¼Œå¯ä»¥è¢«å¤šä¸ªä»åº“åˆ†æ‹…è¯»å–å‹åŠ›
```

**ğŸ›ï¸ æ¸¸æˆè¯»å†™åˆ†ç¦»æ¶æ„å›¾**

```
                     æ¸¸æˆå®¢æˆ·ç«¯
                         |
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    è´Ÿè½½å‡è¡¡å™¨        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         |
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚         æ¸¸æˆåº”ç”¨æœåŠ¡å™¨é›†ç¾¤          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               |                    |
        å†™æ“ä½œ  |                    | è¯»æ“ä½œ
               â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   MySQLä¸»åº“     â”‚â”€â”€â”€â”€â–¶â”‚  MySQLä»åº“1   â”‚
    â”‚   (å†™å…¥ä¸“ç”¨)    â”‚     â”‚  (è¯»å–ä¸“ç”¨)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  MySQLä»åº“2   â”‚
                           â”‚  (è¯»å–ä¸“ç”¨)   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš™ï¸ è¯»å†™åˆ†ç¦»é…ç½®ç¤ºä¾‹**

```java
// æ¸¸æˆæœåŠ¡å™¨æ•°æ®æºé…ç½®ï¼ˆç®€åŒ–ç‰ˆï¼‰
@Configuration
public class GameDBConfig {
    
    // ä¸»åº“é…ç½®ï¼ˆå†™æ“ä½œï¼‰
    @Bean("masterDB")
    public DataSource masterDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://master-db:3306/game_db");
        dataSource.setMaximumPoolSize(50);  // å†™æ“ä½œè¿æ¥æ± è¾ƒå°
        return dataSource;
    }
    
    // ä»åº“é…ç½®ï¼ˆè¯»æ“ä½œï¼‰
    @Bean("slaveDB")
    public DataSource slaveDataSource() {
        HikariDataSource dataSource = new HikariDataSource();
        dataSource.setJdbcUrl("jdbc:mysql://slave-db:3306/game_db");
        dataSource.setMaximumPoolSize(200); // è¯»æ“ä½œè¿æ¥æ± è¾ƒå¤§
        return dataSource;
    }
}

// æ¸¸æˆæ•°æ®è®¿é—®å±‚
@Service
public class PlayerService {
    
    // å†™æ“ä½œï¼šæ›´æ–°ç©å®¶ç»éªŒ
    @Transactional
    public void updatePlayerExp(Long playerId, int exp) {
        // è‡ªåŠ¨è·¯ç”±åˆ°ä¸»åº“
        playerMapper.updateExp(playerId, exp);
    }
    
    // è¯»æ“ä½œï¼šæŸ¥è¯¢ç©å®¶ä¿¡æ¯  
    @Transactional(readOnly = true)
    public Player getPlayerInfo(Long playerId) {
        // è‡ªåŠ¨è·¯ç”±åˆ°ä»åº“
        return playerMapper.selectById(playerId);
    }
}
```

### 3.2 æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤æ¶æ„


**ğŸ¯ é›†ç¾¤åŒ–å¿…è¦æ€§**
```
å•æœåŠ¡å™¨é—®é¢˜ï¼š
â€¢ 1å°æœåŠ¡å™¨æœ€å¤šæ‰¿è½½3000-5000åœ¨çº¿ç”¨æˆ·
â€¢ ç¡¬ä»¶æ•…éšœä¼šå¯¼è‡´æ‰€æœ‰ç©å®¶æ‰çº¿
â€¢ æ— æ³•åº”å¯¹çªå‘æµé‡ï¼ˆæ–°æœå¼€å¯ã€æ´»åŠ¨å¼€å§‹ï¼‰

é›†ç¾¤åŒ–ä¼˜åŠ¿ï¼š
â€¢ æ°´å¹³æ‰©å±•ï¼šåŠ æœºå™¨å°±èƒ½å¢åŠ æ‰¿è½½èƒ½åŠ›
â€¢ æ•…éšœéš”ç¦»ï¼šå•å°æ•…éšœä¸å½±å“æ•´ä½“æœåŠ¡
â€¢ è´Ÿè½½åˆ†æ•£ï¼šä¸åŒç©å®¶åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨
```

**ğŸŒ æ¸¸æˆé›†ç¾¤æ¶æ„è®¾è®¡**

```
                    å®¢æˆ·ç«¯è¿æ¥
                         |
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     ç½‘å…³æœåŠ¡å™¨      â”‚ â† ç»Ÿä¸€å…¥å£ï¼Œè·¯ç”±åˆ†å‘
               â”‚   (Gateway)        â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         |
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        |                |                |
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚æ¸¸æˆæœ1  â”‚    â”‚æ¸¸æˆæœ2  â”‚    â”‚æ¸¸æˆæœ3  â”‚ â† ä¸šåŠ¡å¤„ç†
   â”‚(åœºæ™¯A)  â”‚    â”‚(åœºæ™¯B)  â”‚    â”‚(PVP)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        |                |                |
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         |
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚     æ•°æ®åº“é›†ç¾¤      â”‚ â† æ•°æ®å­˜å‚¨
               â”‚   (ä¸»ä»åˆ†ç¦»)       â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ğŸ”Œ æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–


### 4.1 è¿æ¥æ± åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿æ¥æ± **
```
æ²¡æœ‰è¿æ¥æ± çš„é—®é¢˜ï¼š
æ¯æ¬¡æ•°æ®æ“ä½œéƒ½è¦ï¼šå»ºç«‹è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å…³é—­è¿æ¥
å°±åƒæ¯æ¬¡æ‰“ç”µè¯éƒ½è¦é‡æ–°ç”³è¯·ç”µè¯å·ç ä¸€æ ·éº»çƒ¦

è¿æ¥æ± çš„ä½œç”¨ï¼š
æå‰å‡†å¤‡å¥½ä¸€æ‰¹æ•°æ®åº“è¿æ¥ï¼Œéœ€è¦æ—¶ç›´æ¥æ‹¿æ¥ç”¨
ç”¨å®Œåå½’è¿˜ç»™è¿æ¥æ± ï¼Œè€Œä¸æ˜¯é”€æ¯
å°±åƒå…±äº«å•è½¦ï¼Œéšç”¨éšå–ï¼Œç”¨å®Œå½’è¿˜
```

**ğŸ“Š è¿æ¥æ± æ ¸å¿ƒå‚æ•°**

| å‚æ•°å | **å«ä¹‰** | **æ¸¸æˆæ¨èå€¼** | **è¯´æ˜** |
|--------|---------|---------------|----------|
| `minimumIdle` | **æœ€å°è¿æ¥æ•°** | `10-20` | å§‹ç»ˆä¿æŒçš„è¿æ¥æ•° |
| `maximumPoolSize` | **æœ€å¤§è¿æ¥æ•°** | `50-200` | é«˜å³°æ—¶æœ€å¤šè¿æ¥æ•° |
| `connectionTimeout` | **è·å–è¿æ¥è¶…æ—¶** | `5000ms` | è¶…è¿‡æ­¤æ—¶é—´è·å–ä¸åˆ°è¿æ¥å°±æŠ¥é”™ |
| `idleTimeout` | **ç©ºé—²è¶…æ—¶** | `300000ms` | è¿æ¥ç©ºé—²5åˆ†é’Ÿåå›æ”¶ |

### 4.2 æ¸¸æˆè¿æ¥æ± è°ƒä¼˜å®è·µ


**âš™ï¸ HikariCPä¼˜åŒ–é…ç½®**

```properties
# æ¸¸æˆæ•°æ®åº“è¿æ¥æ± é…ç½®ï¼ˆapplication.propertiesï¼‰

# åŸºç¡€è¿æ¥é…ç½®
spring.datasource.url=jdbc:mysql://localhost:3306/game_db?useSSL=false
spring.datasource.username=game_user
spring.datasource.password=game_pass

# HikariCPè¿æ¥æ± é…ç½®
spring.datasource.hikari.minimum-idle=20
spring.datasource.hikari.maximum-pool-size=100
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000

# æ¸¸æˆç‰¹å®šä¼˜åŒ–
spring.datasource.hikari.pool-name=GameHikariPool
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=3000
```

**ğŸ“ˆ è¿æ¥æ± å¤§å°è®¡ç®—å…¬å¼**
```
è¿æ¥æ± å¤§å°è®¡ç®—æ–¹æ³•ï¼š

åŸºç¡€å…¬å¼ï¼š
è¿æ¥æ± å¤§å° = ((æ ¸å¿ƒæ•° * 2) + ç£ç›˜æ•°) * å®‰å…¨ç³»æ•°

æ¸¸æˆæœåŠ¡å™¨ç¤ºä¾‹ï¼š
â€¢ 8æ ¸CPUæœåŠ¡å™¨
â€¢ 2å—SSDç¡¬ç›˜  
â€¢ å®‰å…¨ç³»æ•°ï¼š1.5-2
è®¡ç®—ï¼š((8 * 2) + 2) * 1.5 = 27ä¸ªè¿æ¥

å®é™…è°ƒä¼˜å»ºè®®ï¼š
â€¢ ä»27ä¸ªå¼€å§‹æµ‹è¯•
â€¢ ç›‘æ§è¿æ¥æ± ä½¿ç”¨ç‡
â€¢ æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´åˆ°50-100ä¸ª
```

### 4.3 è¿æ¥æ± ç›‘æ§ä¸å‘Šè­¦


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**

```java
// è¿æ¥æ± ç›‘æ§ä»£ç ç¤ºä¾‹
@Component
public class ConnectionPoolMonitor {
    
    @Autowired
    private HikariDataSource dataSource;
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void monitorConnectionPool() {
        HikariPoolMXBean poolBean = dataSource.getHikariPoolMXBean();
        
        int activeConnections = poolBean.getActiveConnections();
        int idleConnections = poolBean.getIdleConnections();
        int totalConnections = poolBean.getTotalConnections();
        int waitingThreads = poolBean.getThreadsAwaitingConnection();
        
        // è¿æ¥æ± ä½¿ç”¨ç‡
        double usageRate = (double) activeConnections / totalConnections;
        
        // å‘Šè­¦é˜ˆå€¼ï¼šä½¿ç”¨ç‡è¶…è¿‡80%
        if (usageRate > 0.8) {
            log.warn("è¿æ¥æ± ä½¿ç”¨ç‡è¿‡é«˜: {}%, æ´»è·ƒè¿æ¥: {}, ç­‰å¾…çº¿ç¨‹: {}", 
                    usageRate * 100, activeConnections, waitingThreads);
        }
        
        // è®°å½•ç›‘æ§æŒ‡æ ‡
        log.info("è¿æ¥æ± çŠ¶æ€ - æ´»è·ƒ: {}, ç©ºé—²: {}, æ€»è®¡: {}, ç­‰å¾…: {}", 
                activeConnections, idleConnections, totalConnections, waitingThreads);
    }
}
```

---

## 5. ğŸ“¦ æ‰¹é‡æ“ä½œä¸å¼‚æ­¥ç­–ç•¥


### 5.1 æ‰¹é‡æ“ä½œä¼˜åŒ–


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ‰¹é‡æ“ä½œ**
```
å•æ¡æ“ä½œçš„é—®é¢˜ï¼š
ç©å®¶å‡»è´¥100ä¸ªæ€ªç‰©ï¼Œå¦‚æœæ¯æ€æ­»ä¸€ä¸ªå°±ç«‹å³å†™æ•°æ®åº“ï¼š
â€¢ äº§ç”Ÿ100æ¬¡æ•°æ®åº“è¿æ¥
â€¢ æ¯æ¬¡éƒ½è¦ç­‰å¾…ç½‘ç»œå¾€è¿”
â€¢ æ•°æ®åº“æ‰¿å—100æ¬¡å†™å…¥å‹åŠ›

æ‰¹é‡æ“ä½œçš„ä¼˜åŠ¿ï¼š
æŠŠ100æ¬¡å‡»æ€åˆå¹¶æˆ1æ¬¡æ‰¹é‡å†™å…¥ï¼š
â€¢ åªéœ€è¦1æ¬¡æ•°æ®åº“è¿æ¥
â€¢ å‡å°‘ç½‘ç»œå¾€è¿”æ—¶é—´
â€¢ æ•°æ®åº“ä¸€æ¬¡æ€§å¤„ç†100æ¡è®°å½•ï¼Œæ•ˆç‡æ›´é«˜
```

**ğŸ’¡ æ‰¹é‡æ“ä½œå®ç°ç¤ºä¾‹**

```java
@Service
public class GameLogService {
    
    // ä½¿ç”¨é˜Ÿåˆ—ç¼“å­˜æ¸¸æˆæ—¥å¿—
    private final Queue<GameLog> logQueue = new ConcurrentLinkedQueue<>();
    
    // å•æ¡æ·»åŠ æ—¥å¿—ï¼ˆç«‹å³å“åº”ç©å®¶ï¼‰
    public void addLog(GameLog log) {
        logQueue.offer(log);
        // ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ•°æ®åº“å†™å…¥
    }
    
    // æ‰¹é‡å†™å…¥æ•°æ®åº“ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
    @Scheduled(fixedRate = 5000) // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡
    public void flushLogs() {
        if (logQueue.isEmpty()) {
            return;
        }
        
        List<GameLog> batch = new ArrayList<>();
        // å–å‡ºæœ€å¤š1000æ¡æ—¥å¿—
        for (int i = 0; i < 1000 && !logQueue.isEmpty(); i++) {
            GameLog log = logQueue.poll();
            if (log != null) {
                batch.add(log);
            }
        }
        
        if (!batch.isEmpty()) {
            // æ‰¹é‡æ’å…¥æ•°æ®åº“
            gameLogMapper.batchInsert(batch);
            log.info("æ‰¹é‡å†™å…¥æ¸¸æˆæ—¥å¿—: {} æ¡", batch.size());
        }
    }
}
```

**ğŸ¯ æ‰¹é‡æ“ä½œæœ€ä½³å®è·µ**
```
æ‰¹é‡å¤§å°é€‰æ‹©ï¼š
â€¢ å¤ªå°ï¼šæ‰¹é‡ä¼˜åŠ¿ä¸æ˜æ˜¾
â€¢ å¤ªå¤§ï¼šå•æ¬¡æ“ä½œæ—¶é—´è¿‡é•¿ï¼Œå¯èƒ½è¶…æ—¶
â€¢ æ¨èï¼š100-1000æ¡è®°å½•ä¸ºä¸€æ‰¹

é€‚åˆæ‰¹é‡çš„æ•°æ®ï¼š
âœ… æ¸¸æˆæ—¥å¿—ï¼ˆç©å®¶æ“ä½œè®°å½•ï¼‰
âœ… ç»Ÿè®¡æ•°æ®ï¼ˆç»éªŒè·å–ã€é‡‘å¸æ¶ˆè€—ï¼‰
âœ… èŠå¤©è®°å½•ï¼ˆé¢‘é“æ¶ˆæ¯ï¼‰
âœ… ç‰©å“å˜åŠ¨è®°å½•

ä¸é€‚åˆæ‰¹é‡çš„æ•°æ®ï¼š
âŒ ç©å®¶è¡€é‡ï¼ˆéœ€è¦å®æ—¶æ›´æ–°ï¼‰
âŒ è£…å¤‡å¼ºåŒ–ï¼ˆç©å®¶éœ€è¦ç«‹å³çœ‹åˆ°ç»“æœï¼‰
âŒ äº¤æ˜“è®°å½•ï¼ˆæ¶‰åŠé‡‘é’±å®‰å…¨ï¼‰
```

### 5.2 å¼‚æ­¥å†™å…¥ç­–ç•¥


**âš¡ å¼‚æ­¥å¤„ç†æ¶æ„**

```
åŒæ­¥å¤„ç†ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰ï¼š
ç©å®¶æ“ä½œ â†’ ç«‹å³å†™æ•°æ®åº“ â†’ ç­‰å¾…å®Œæˆ â†’ è¿”å›ç»“æœ
é—®é¢˜ï¼šç©å®¶éœ€è¦ç­‰å¾…æ•°æ®åº“æ“ä½œå®Œæˆ

å¼‚æ­¥å¤„ç†ï¼ˆä¼˜åŒ–æ–¹å¼ï¼‰ï¼š
ç©å®¶æ“ä½œ â†’ æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ— â†’ ç«‹å³è¿”å›ç»“æœ
             â†“
        åå°å¼‚æ­¥å¤„ç† â†’ å†™å…¥æ•°æ®åº“

ä¼˜åŠ¿ï¼šç©å®¶æ“ä½œç«‹å³å¾—åˆ°å“åº”ï¼Œä½“éªŒæ›´æµç•…
```

**ğŸ”„ å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—å®ç°**

```java
// ä½¿ç”¨Redisä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—
@Service
public class AsyncGameEventService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // å¼‚æ­¥å¤„ç†ç©å®¶å‡çº§äº‹ä»¶
    public void handlePlayerLevelUp(Long playerId, int newLevel) {
        // ç«‹å³æ›´æ–°å†…å­˜ä¸­çš„ç©å®¶ç­‰çº§ï¼ˆç©å®¶ç«‹å³çœ‹åˆ°å˜åŒ–ï¼‰
        updatePlayerLevelInMemory(playerId, newLevel);
        
        // å¼‚æ­¥å¤„ç†å‡çº§ç›¸å…³çš„å¤æ‚é€»è¾‘
        PlayerLevelUpEvent event = new PlayerLevelUpEvent(playerId, newLevel);
        redisTemplate.opsForList().leftPush("player_levelup_queue", event);
        
        // ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ•°æ®åº“æ›´æ–°
    }
    
    // åå°ä»»åŠ¡å¤„ç†å‡çº§äº‹ä»¶
    @Scheduled(fixedRate = 1000) // æ¯ç§’å¤„ç†ä¸€æ¬¡
    public void processLevelUpEvents() {
        Object eventObj = redisTemplate.opsForList().rightPop("player_levelup_queue");
        if (eventObj != null) {
            PlayerLevelUpEvent event = (PlayerLevelUpEvent) eventObj;
            
            // æ‰§è¡Œå¤æ‚çš„å‡çº§é€»è¾‘
            unlockNewSkills(event.getPlayerId(), event.getNewLevel());
            updatePlayerRanking(event.getPlayerId());
            sendLevelUpRewards(event.getPlayerId());
            
            // æŒä¹…åŒ–åˆ°æ•°æ®åº“
            persistPlayerLevel(event.getPlayerId(), event.getNewLevel());
        }
    }
}
```

---

## 6. ğŸ—„ï¸ åˆ†åº“åˆ†è¡¨è®¾è®¡


### 6.1 ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†åº“åˆ†è¡¨


**ğŸ¯ åˆ†åº“åˆ†è¡¨çš„åˆ¤æ–­æ ‡å‡†**
```
å•è¡¨æ•°æ®é‡è¿‡å¤§çš„ä¿¡å·ï¼š
â€¢ å•è¡¨è¶…è¿‡1000ä¸‡è¡Œæ•°æ®
â€¢ æŸ¥è¯¢é€Ÿåº¦æ˜æ˜¾å˜æ…¢ï¼ˆ>100msï¼‰
â€¢ ç´¢å¼•ç»´æŠ¤æˆæœ¬è¿‡é«˜
â€¢ å•æ¬¡å¤‡ä»½æ—¶é—´è¿‡é•¿

æ¸¸æˆåœºæ™¯ä¸¾ä¾‹ï¼š
èŠå¤©è®°å½•è¡¨ï¼š
â€¢ 1ä¸‡åœ¨çº¿ç”¨æˆ·ï¼Œæ¯äººæ¯å°æ—¶å‘10æ¡æ¶ˆæ¯
â€¢ ä¸€å¤©äº§ç”Ÿï¼š10000 * 10 * 24 = 240ä¸‡æ¡è®°å½•  
â€¢ ä¸€å¹´äº§ç”Ÿï¼š240ä¸‡ * 365 = 8.76äº¿æ¡è®°å½•
â†’ å¿…é¡»åˆ†è¡¨ï¼

ç©å®¶ä¿¡æ¯è¡¨ï¼š
â€¢ æ€»æ³¨å†Œç”¨æˆ·100ä¸‡ï¼Œå•è¡¨å®Œå…¨å¯ä»¥å¤„ç†
â†’ æš‚æ—¶ä¸éœ€è¦åˆ†è¡¨
```

**ğŸ“Š åˆ†åº“åˆ†è¡¨ç­–ç•¥é€‰æ‹©**

| åˆ†ç‰‡ç»´åº¦ | **é€‚ç”¨åœºæ™¯** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** |
|---------|-------------|----------|----------|
| **æŒ‰ç©å®¶ID** | `ç©å®¶ç›¸å…³æ•°æ®` | è´Ÿè½½å‡åŒ€ï¼Œæ˜“æ‰©å±• | è·¨ç©å®¶æŸ¥è¯¢å›°éš¾ |
| **æŒ‰æ—¶é—´** | `æ—¥å¿—ã€èŠå¤©è®°å½•` | å†å²æ•°æ®å¯å½’æ¡£ | çƒ­ç‚¹æ•°æ®é›†ä¸­ |
| **æŒ‰æœåŠ¡å™¨** | `æ¸¸æˆåŒºæœæ•°æ®` | ç¬¦åˆä¸šåŠ¡é€»è¾‘ | å•æœè´Ÿè½½ä¸å‡ |
| **æŒ‰åŠŸèƒ½** | `ä¸åŒæ¸¸æˆæ¨¡å—` | æ¨¡å—ç‹¬ç«‹æ€§å¼º | è·¨åŠŸèƒ½ç»Ÿè®¡å¤æ‚ |

### 6.2 æ¸¸æˆåˆ†åº“åˆ†è¡¨å®è·µ


**ğŸ® æŒ‰ç©å®¶IDåˆ†è¡¨ç¤ºä¾‹**

```sql
-- åˆ†è¡¨ç­–ç•¥ï¼šæ ¹æ®ç©å®¶IDåä¸¤ä½åˆ†æˆ100ä¸ªè¡¨
-- player_inventory_00, player_inventory_01, ..., player_inventory_99

-- è·¯ç”±è§„åˆ™
SELECT table_suffix = player_id % 100;

-- åˆ›å»ºåˆ†è¡¨
CREATE TABLE player_inventory_00 (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    player_id BIGINT NOT NULL,
    item_id INT NOT NULL,
    quantity INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_player_id (player_id)
) ENGINE=InnoDB;

-- é‡å¤åˆ›å»ºå…¶ä»–99å¼ è¡¨...
```

**ğŸ”§ åˆ†è¡¨è·¯ç”±ä»£ç å®ç°**

```java
@Service
public class PlayerInventoryService {
    
    @Autowired
    private Map<String, SqlSession> sqlSessionMap; // å¤šæ•°æ®æº
    
    // æ ¹æ®ç©å®¶IDè®¡ç®—åˆ†è¡¨å
    private String getTableName(Long playerId) {
        int suffix = (int)(playerId % 100);
        return String.format("player_inventory_%02d", suffix);
    }
    
    // æŸ¥è¯¢ç©å®¶èƒŒåŒ…
    public List<PlayerItem> getPlayerInventory(Long playerId) {
        String tableName = getTableName(playerId);
        
        // åŠ¨æ€SQLæŸ¥è¯¢å¯¹åº”åˆ†è¡¨
        String sql = "SELECT * FROM " + tableName + " WHERE player_id = ?";
        
        return jdbcTemplate.query(sql, new Object[]{playerId}, 
                new BeanPropertyRowMapper<>(PlayerItem.class));
    }
    
    // æ·»åŠ ç‰©å“åˆ°èƒŒåŒ…
    public void addItemToInventory(Long playerId, int itemId, int quantity) {
        String tableName = getTableName(playerId);
        
        String sql = "INSERT INTO " + tableName + 
                " (player_id, item_id, quantity) VALUES (?, ?, ?)";
                
        jdbcTemplate.update(sql, playerId, itemId, quantity);
    }
}
```

### 6.3 åˆ†è¡¨æŸ¥è¯¢ä¼˜åŒ–


**ğŸ“ˆ è·¨åˆ†è¡¨æŸ¥è¯¢è§£å†³æ–¹æ¡ˆ**

```java
// æŸ¥è¯¢æ‰€æœ‰æœåŠ¡å™¨çš„ç­‰çº§æ’è¡Œæ¦œï¼ˆéœ€è¦è·¨å¤šä¸ªåˆ†è¡¨ï¼‰
@Service  
public class RankingService {
    
    public List<PlayerRanking> getGlobalLevelRanking(int limit) {
        List<PlayerRanking> allPlayers = new ArrayList<>();
        
        // å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰åˆ†è¡¨
        List<CompletableFuture<List<PlayerRanking>>> futures = new ArrayList<>();
        
        for (int i = 0; i < 100; i++) {
            String tableName = String.format("player_info_%02d", i);
            
            CompletableFuture<List<PlayerRanking>> future = 
                CompletableFuture.supplyAsync(() -> {
                    String sql = "SELECT player_id, player_name, level FROM " + 
                            tableName + " ORDER BY level DESC LIMIT " + limit;
                    return jdbcTemplate.query(sql, new BeanPropertyRowMapper<>(PlayerRanking.class));
                });
                
            futures.add(future);
        }
        
        // ç­‰å¾…æ‰€æœ‰æŸ¥è¯¢å®Œæˆå¹¶åˆå¹¶ç»“æœ
        for (CompletableFuture<List<PlayerRanking>> future : futures) {
            try {
                allPlayers.addAll(future.get(5, TimeUnit.SECONDS));
            } catch (Exception e) {
                log.error("æŸ¥è¯¢åˆ†è¡¨å¤±è´¥", e);
            }
        }
        
        // å†…å­˜ä¸­æ’åºå¹¶è¿”å›Top N
        return allPlayers.stream()
                .sorted((a, b) -> b.getLevel() - a.getLevel())
                .limit(limit)
                .collect(Collectors.toList());
    }
}
```

---

## 7. ğŸ—ƒï¸ ç¼“å­˜å±‚æ¶æ„


### 7.1 æ¸¸æˆç¼“å­˜å±‚è®¾è®¡æ€è·¯


**ğŸ”¸ ç¼“å­˜å±‚çš„ä½œç”¨**
```
ä¸ºä»€ä¹ˆæ¸¸æˆç‰¹åˆ«éœ€è¦ç¼“å­˜ï¼Ÿ

æ•°æ®åº“æŸ¥è¯¢ï¼š50-100ms
å†…å­˜ç¼“å­˜ï¼š1-5ms  
æ€§èƒ½æå‡ï¼š10-50å€ï¼

æ¸¸æˆåœºæ™¯å¯¹æ¯”ï¼š
â€¢ æŸ¥çœ‹è£…å¤‡å±æ€§ï¼šæ¯ç§’å¯èƒ½å‘ç”Ÿå‡ åæ¬¡
â€¢ 50ms Ã— 30æ¬¡ = 1.5ç§’ï¼ˆç©å®¶ä¼šæ„Ÿè§‰å¡é¡¿ï¼‰
â€¢ 2ms Ã— 30æ¬¡ = 0.06ç§’ï¼ˆæµç•…ä½“éªŒï¼‰
```

**ğŸ—ï¸ å¤šçº§ç¼“å­˜æ¶æ„**

```
ç©å®¶è¯·æ±‚æŸ¥çœ‹è£…å¤‡å±æ€§ï¼š
            â†“
    L1: æœ¬åœ°ç¼“å­˜ (JVMå†…å­˜)
    å‘½ä¸­ç‡: 60% | å“åº”æ—¶é—´: <1ms
            â†“ (miss)
    L2: Redisç¼“å­˜ (åˆ†å¸ƒå¼)  
    å‘½ä¸­ç‡: 35% | å“åº”æ—¶é—´: 2-5ms
            â†“ (miss)
    L3: æ•°æ®åº“æŸ¥è¯¢ (MySQL)
    å‘½ä¸­ç‡: 5% | å“åº”æ—¶é—´: 50-100ms
            â†“
    å†™å…¥L2å’ŒL1ç¼“å­˜ï¼Œä¸‹æ¬¡æ›´å¿«è®¿é—®
```

### 7.2 Redisç¼“å­˜åº”ç”¨


**âš¡ Redisåœ¨æ¸¸æˆä¸­çš„å…¸å‹åº”ç”¨**

```java
@Service
public class GameCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // ç¼“å­˜ç©å®¶åŸºç¡€ä¿¡æ¯ï¼ˆçƒ­ç‚¹æ•°æ®ï¼‰
    public Player getPlayerInfo(Long playerId) {
        String key = "player:info:" + playerId;
        
        // å…ˆä»Redisè·å–
        Player player = (Player) redisTemplate.opsForValue().get(key);
        if (player != null) {
            return player; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›
        }
        
        // ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“
        player = playerMapper.selectById(playerId);
        if (player != null) {
            // å†™å…¥ç¼“å­˜ï¼Œè¿‡æœŸæ—¶é—´30åˆ†é’Ÿ
            redisTemplate.opsForValue().set(key, player, 30, TimeUnit.MINUTES);
        }
        
        return player;
    }
    
    // ç¼“å­˜æ’è¡Œæ¦œæ•°æ®ï¼ˆä½¿ç”¨Redisçš„ZSetï¼‰
    public void updatePlayerRanking(Long playerId, int level) {
        String key = "ranking:level";
        
        // ZSetè‡ªåŠ¨æŒ‰åˆ†æ•°æ’åºï¼Œlevelä½œä¸ºåˆ†æ•°
        redisTemplate.opsForZSet().add(key, playerId, level);
        
        // åªä¿ç•™å‰1000å
        redisTemplate.opsForZSet().removeRange(key, 0, -1001);
    }
    
    // è·å–ç­‰çº§æ’è¡Œæ¦œ
    public List<PlayerRanking> getLevelRanking(int limit) {
        String key = "ranking:level";
        
        // æŒ‰åˆ†æ•°å€’åºè·å–å‰Nå
        Set<ZSetOperations.TypedTuple<Object>> tuples = 
            redisTemplate.opsForZSet().reverseRangeWithScores(key, 0, limit - 1);
            
        List<PlayerRanking> rankings = new ArrayList<>();
        int rank = 1;
        for (ZSetOperations.TypedTuple<Object> tuple : tuples) {
            Long playerId = (Long) tuple.getValue();
            int level = tuple.getScore().intValue();
            rankings.add(new PlayerRanking(rank++, playerId, level));
        }
        
        return rankings;
    }
}
```

### 7.3 ç¼“å­˜ä¸€è‡´æ€§ä¿è¯


**ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥**

```java
@Service
public class PlayerDataService {
    
    // æ›´æ–°ç©å®¶ç­‰çº§æ—¶çš„ç¼“å­˜ä¸€è‡´æ€§å¤„ç†
    @Transactional
    public void updatePlayerLevel(Long playerId, int newLevel) {
        // 1. å…ˆæ›´æ–°æ•°æ®åº“
        playerMapper.updateLevel(playerId, newLevel);
        
        // 2. åˆ é™¤ç›¸å…³ç¼“å­˜ï¼ˆè€Œä¸æ˜¯æ›´æ–°ï¼‰
        String playerKey = "player:info:" + playerId;
        redisTemplate.delete(playerKey);
        
        // 3. æ›´æ–°æ’è¡Œæ¦œç¼“å­˜
        redisTemplate.opsForZSet().add("ranking:level", playerId, newLevel);
        
        // 4. å¦‚æœæ˜¯é‡è¦æ•°æ®ï¼Œå¯ä»¥é¢„çƒ­ç¼“å­˜
        if (isVipPlayer(playerId)) {
            // ç«‹å³é‡æ–°åŠ è½½åˆ°ç¼“å­˜
            Player player = playerMapper.selectById(playerId);
            redisTemplate.opsForValue().set(playerKey, player, 30, TimeUnit.MINUTES);
        }
    }
}
```

**ğŸ’¡ ç¼“å­˜ä¸€è‡´æ€§æœ€ä½³å®è·µ**
```
åˆ é™¤ vs æ›´æ–°çš„é€‰æ‹©ï¼š

æ¨èï¼šåˆ é™¤ç¼“å­˜
â€¢ å®ç°ç®€å•ï¼Œä¸æ˜“å‡ºé”™
â€¢ ä¸‹æ¬¡æŸ¥è¯¢æ—¶è‡ªç„¶é‡æ–°åŠ è½½æœ€æ–°æ•°æ®
â€¢ é¿å…ç¼“å­˜å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´

è°¨æ…ï¼šç›´æ¥æ›´æ–°ç¼“å­˜  
â€¢ å®¹æ˜“å‡ºç°å¹¶å‘é—®é¢˜
â€¢ æ›´æ–°å¤±è´¥æ—¶æ•°æ®ä¸ä¸€è‡´
â€¢ ä»£ç é€»è¾‘å¤æ‚

ä½¿ç”¨åœºæ™¯ï¼š
â€¢ ä¸€èˆ¬æ•°æ®ï¼šåˆ é™¤ç¼“å­˜
â€¢ çƒ­ç‚¹æ•°æ®ï¼šåˆ é™¤åç«‹å³é¢„çƒ­
â€¢ å®æ—¶æ•°æ®ï¼šè€ƒè™‘ä¸ä½¿ç”¨ç¼“å­˜
```

---

## 8. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜


### 8.1 å…³é”®æ€§èƒ½æŒ‡æ ‡


**ğŸ“ˆ æ¸¸æˆæ•°æ®åº“æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**

```
å“åº”æ—¶é—´æŒ‡æ ‡ï¼š
â€¢ æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´ï¼š< 50ms
â€¢ 99%æŸ¥è¯¢å“åº”æ—¶é—´ï¼š< 100ms  
â€¢ æ…¢æŸ¥è¯¢æ•°é‡ï¼š< 10ä¸ª/åˆ†é’Ÿ

å¹¶å‘æŒ‡æ ‡ï¼š
â€¢ åŒæ—¶è¿æ¥æ•°ï¼š< æœ€å¤§è¿æ¥æ•°çš„80%
â€¢ QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰ï¼šæ ¹æ®ä¸šåŠ¡åˆ¶å®šåŸºçº¿
â€¢ TPSï¼ˆæ¯ç§’äº‹åŠ¡æ•°ï¼‰ï¼šé‡ç‚¹å…³æ³¨å†™å…¥å‹åŠ›

èµ„æºä½¿ç”¨ç‡ï¼š
â€¢ CPUä½¿ç”¨ç‡ï¼š< 70%
â€¢ å†…å­˜ä½¿ç”¨ç‡ï¼š< 80%
â€¢ ç£ç›˜IOä½¿ç”¨ç‡ï¼š< 80%
```

**ğŸ”§ ç›‘æ§å®ç°ç¤ºä¾‹**

```java
@Component
public class DatabaseMonitor {
    
    @Autowired
    private DataSource dataSource;
    
    private final MeterRegistry meterRegistry;
    
    // è®°å½•SQLæ‰§è¡Œæ—¶é—´
    @EventListener
    public void handleSqlExecution(SqlExecutionEvent event) {
        Timer.Sample sample = Timer.start(meterRegistry);
        
        // SQLæ‰§è¡Œå®Œæˆåè®°å½•è€—æ—¶
        sample.stop(Timer.builder("sql.execution.time")
                .tag("table", event.getTableName())
                .tag("operation", event.getOperation())
                .register(meterRegistry));
    }
    
    // å®šæ—¶æ”¶é›†æ•°æ®åº“è¿æ¥æ± çŠ¶æ€
    @Scheduled(fixedRate = 30000)
    public void collectConnectionPoolMetrics() {
        HikariPoolMXBean poolBean = ((HikariDataSource) dataSource).getHikariPoolMXBean();
        
        // è®°å½•åˆ°ç›‘æ§ç³»ç»Ÿ
        Gauge.builder("db.connections.active")
                .register(meterRegistry, poolBean, HikariPoolMXBean::getActiveConnections);
                
        Gauge.builder("db.connections.idle")
                .register(meterRegistry, poolBean, HikariPoolMXBean::getIdleConnections);
                
        Gauge.builder("db.connections.waiting")
                .register(meterRegistry, poolBean, HikariPoolMXBean::getThreadsAwaitingConnection);
    }
}
```

### 8.2 æ…¢æŸ¥è¯¢ä¼˜åŒ–


**ğŸŒ æ…¢æŸ¥è¯¢è¯†åˆ«ä¸åˆ†æ**

```sql
-- å¼€å¯MySQLæ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 1;
SET GLOBAL long_query_time = 0.1;  -- è¶…è¿‡0.1ç§’çš„æŸ¥è¯¢è®°å½•ä¸ºæ…¢æŸ¥è¯¢

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
SHOW GLOBAL STATUS LIKE 'Slow_queries';

-- åˆ†æå…·ä½“æ…¢æŸ¥è¯¢ï¼ˆç¤ºä¾‹ï¼‰
-- é—®é¢˜SQLï¼šæŸ¥è¯¢ç©å®¶çš„æ‰€æœ‰è£…å¤‡
SELECT * FROM player_equipment WHERE player_id = 12345;

-- åˆ†ææ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM player_equipment WHERE player_id = 12345;

-- ç»“æœæ˜¾ç¤ºï¼štype=ALLï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œrows=1000000
-- é—®é¢˜ï¼šç¼ºå°‘player_idç´¢å¼•ï¼
```

**âš¡ ç´¢å¼•ä¼˜åŒ–å®è·µ**

```sql
-- æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•
ALTER TABLE player_equipment ADD INDEX idx_player_id (player_id);

-- å¤åˆç´¢å¼•ä¼˜åŒ–ï¼ˆæŸ¥è¯¢ç©å®¶ç‰¹å®šç±»å‹è£…å¤‡ï¼‰
-- åŸSQLï¼šç»å¸¸æŒ‰ç©å®¶IDå’Œè£…å¤‡ç±»å‹æŸ¥è¯¢
SELECT * FROM player_equipment 
WHERE player_id = 12345 AND equipment_type = 'weapon';

-- åˆ›å»ºå¤åˆç´¢å¼•
ALTER TABLE player_equipment 
ADD INDEX idx_player_equipment (player_id, equipment_type);

-- éªŒè¯ä¼˜åŒ–æ•ˆæœ
EXPLAIN SELECT * FROM player_equipment 
WHERE player_id = 12345 AND equipment_type = 'weapon';
-- ç»“æœï¼štype=refï¼ˆç´¢å¼•æŸ¥æ‰¾ï¼‰ï¼Œrows=5
```

### 8.3 å®¹é‡è§„åˆ’æ–¹æ³•


**ğŸ“Š å®¹é‡è§„åˆ’è®¡ç®—**

```
æ¸¸æˆæ•°æ®å¢é•¿é¢„æµ‹ï¼š

ç”¨æˆ·å¢é•¿é¢„æµ‹ï¼š
â€¢ å½“å‰æ³¨å†Œç”¨æˆ·ï¼š10ä¸‡
â€¢ æœˆå¢é•¿ç‡ï¼š20%
â€¢ 12ä¸ªæœˆåï¼š10ä¸‡ Ã— 1.2^12 â‰ˆ 89ä¸‡ç”¨æˆ·

æ•°æ®é‡å¢é•¿é¢„æµ‹ï¼š
â€¢ æ¯ç”¨æˆ·å¹³å‡æ•°æ®ï¼š1MBï¼ˆåŸºç¡€ä¿¡æ¯+è£…å¤‡+è®°å½•ï¼‰
â€¢ 12ä¸ªæœˆåæ€»æ•°æ®é‡ï¼š89ä¸‡ Ã— 1MB = 890GB

ç¡¬ä»¶å®¹é‡è§„åˆ’ï¼š
â€¢ æ•°æ®å­˜å‚¨ï¼š890GB Ã— 1.5ï¼ˆå†—ä½™ï¼‰ = 1.3TB
â€¢ å†…å­˜éœ€æ±‚ï¼š890GB Ã— 0.2ï¼ˆçƒ­æ•°æ®ï¼‰ = 180GB
â€¢ å»ºè®®é…ç½®ï¼š2TB SSD + 256GBå†…å­˜
```

**ğŸ”„ å¼¹æ€§æ‰©å®¹ç­–ç•¥**

```java
// è‡ªåŠ¨æ‰©å®¹è§¦å‘æ¡ä»¶ç›‘æ§
@Component  
public class AutoScalingMonitor {
    
    @Value("${game.scaling.cpu.threshold:70}")
    private double cpuThreshold;
    
    @Value("${game.scaling.memory.threshold:80}")
    private double memoryThreshold;
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥
    public void checkScalingConditions() {
        double cpuUsage = getCurrentCpuUsage();
        double memoryUsage = getCurrentMemoryUsage();
        int activeConnections = getActiveConnections();
        
        // æ‰©å®¹æ¡ä»¶ï¼šCPUæˆ–å†…å­˜æŒç»­é«˜è´Ÿè½½
        if (cpuUsage > cpuThreshold || memoryUsage > memoryThreshold) {
            scaleUpCounter++;
            
            if (scaleUpCounter >= 3) { // è¿ç»­3åˆ†é’Ÿè¶…é˜ˆå€¼
                triggerScaleUp();
                scaleUpCounter = 0;
            }
        } else {
            scaleUpCounter = 0;
        }
        
        // ç¼©å®¹æ¡ä»¶ï¼šèµ„æºä½¿ç”¨ç‡æŒç»­è¾ƒä½
        if (cpuUsage < 30 && memoryUsage < 40) {
            scaleDownCounter++;
            
            if (scaleDownCounter >= 10) { // è¿ç»­10åˆ†é’Ÿä½è´Ÿè½½
                triggerScaleDown();
                scaleDownCounter = 0;
            }
        } else {
            scaleDownCounter = 0;
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¸¸æˆæ•°æ®åº“ç‰¹æ€§ï¼šè¯»å†™å¹¶é‡ã€å®æ—¶æ€§è¦æ±‚é«˜ã€çƒ­ç‚¹æ•°æ®æ˜æ˜¾
ğŸ”¸ çƒ­ç‚¹æ•°æ®å¤„ç†ï¼šå¤šçº§ç¼“å­˜ã€é¢„çƒ­æœºåˆ¶ã€è´Ÿè½½åˆ†æ•£
ğŸ”¸ é«˜å¹¶å‘æ¶æ„ï¼šè¯»å†™åˆ†ç¦»ã€è¿æ¥æ± ä¼˜åŒ–ã€é›†ç¾¤åŒ–éƒ¨ç½²
ğŸ”¸ æ‰¹é‡ä¸å¼‚æ­¥ï¼šå‡å°‘æ•°æ®åº“å‹åŠ›ã€æå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ åˆ†åº“åˆ†è¡¨ï¼šåº”å¯¹æµ·é‡æ•°æ®ã€æå‡æŸ¥è¯¢æ€§èƒ½
ğŸ”¸ ç¼“å­˜ç­–ç•¥ï¼šRedisåº”ç”¨ã€ä¸€è‡´æ€§ä¿è¯ã€å‘½ä¸­ç‡ä¼˜åŒ–
ğŸ”¸ æ€§èƒ½ç›‘æ§ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ã€æ…¢æŸ¥è¯¢ä¼˜åŒ–ã€å®¹é‡è§„åˆ’
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¸¸æˆæ•°æ®åº“ä¸ä¼ ç»Ÿä¸šåŠ¡çš„åŒºåˆ«**
```
ä¼ ç»Ÿç”µå•†ï¼šç”¨æˆ·è®¿é—®ç›¸å¯¹åˆ†æ•£ï¼Œè¯»å¤šå†™å°‘
æ¸¸æˆä¸šåŠ¡ï¼šç”¨æˆ·è¡Œä¸ºé«˜åº¦é›†ä¸­ï¼Œè¯»å†™å¹¶é‡

è®¾è®¡é‡ç‚¹ï¼š
â€¢ ä¼ ç»Ÿï¼šé‡ç‚¹ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
â€¢ æ¸¸æˆï¼šéœ€è¦å¹³è¡¡è¯»å†™æ€§èƒ½ï¼Œé‡è§†å®æ—¶æ€§
```

**ğŸ”¹ ä¼˜åŒ–ç­–ç•¥çš„ä¼˜å…ˆçº§**
```
ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šç¼“å­˜ï¼ˆç«‹ç«¿è§å½±ï¼‰
â€¢ Redisç¼“å­˜çƒ­ç‚¹æ•°æ®
â€¢ æœ¬åœ°ç¼“å­˜é¢‘ç¹æŸ¥è¯¢æ•°æ®

ç¬¬äºŒä¼˜å…ˆçº§ï¼šç´¢å¼•ä¼˜åŒ–ï¼ˆåŸºç¡€ä¼˜åŒ–ï¼‰
â€¢ åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—
â€¢ æ·»åŠ åˆé€‚çš„ç´¢å¼•

ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šæ¶æ„è°ƒæ•´ï¼ˆé•¿è¿œè§„åˆ’ï¼‰
â€¢ è¯»å†™åˆ†ç¦»
â€¢ åˆ†åº“åˆ†è¡¨
```

**ğŸ”¹ æ€§èƒ½è°ƒä¼˜çš„é»„é‡‘æ³•åˆ™**
```
æµ‹é‡ â†’ åˆ†æ â†’ ä¼˜åŒ– â†’ éªŒè¯

ä¸è¦ç›²ç›®ä¼˜åŒ–ï¼š
â€¢ å…ˆç›‘æ§æ‰¾åˆ°çœŸæ­£çš„ç“¶é¢ˆ
â€¢ é’ˆå¯¹æ€§è§£å†³æœ€ä¸¥é‡çš„é—®é¢˜
â€¢ ä¼˜åŒ–åéªŒè¯æ•ˆæœ
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ é’ˆå¯¹ä¸åŒæ¸¸æˆç±»å‹çš„ä¼˜åŒ–é‡ç‚¹**

```
MMORPGï¼ˆå¤§å‹å¤šäººåœ¨çº¿ï¼‰ï¼š
é‡ç‚¹ï¼šåˆ†åº“åˆ†è¡¨ã€ç¼“å­˜æ¶æ„
åŸå› ï¼šç”¨æˆ·æ•°é‡å¤§ã€æ•°æ®é‡å¤§

MOBAï¼ˆå¤šäººåœ¨çº¿æˆ˜æœ¯ç«æŠ€ï¼‰ï¼š
é‡ç‚¹ï¼šå®æ—¶æ€§ã€è¿æ¥æ± ä¼˜åŒ–  
åŸå› ï¼šå¯¹æˆ˜æ—¶å»¶è¿Ÿæ•æ„Ÿ

å¡ç‰Œæ¸¸æˆï¼š
é‡ç‚¹ï¼šæ‰¹é‡æ“ä½œã€å¼‚æ­¥å¤„ç†
åŸå› ï¼šæ“ä½œé¢‘ç¹ä½†å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜
```

**ğŸ”§ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**

| é—®é¢˜ç°è±¡ | **å¯èƒ½åŸå› ** | **è§£å†³æ–¹æ¡ˆ** |
|---------|-------------|-------------|
| ç”¨æˆ·ç™»å½•æ…¢ | ç©å®¶æ•°æ®æŸ¥è¯¢æ…¢ | æ·»åŠ ç´¢å¼•ã€ä½¿ç”¨ç¼“å­˜ |
| æ’è¡Œæ¦œæ›´æ–°å¡é¡¿ | å¤§é‡æ•°æ®æ’åº | Redis ZSetã€å®šæ—¶æ›´æ–° |
| èƒŒåŒ…æ“ä½œå»¶è¿Ÿ | ç‰©å“æ•°æ®è¡¨è¿‡å¤§ | åˆ†è¡¨ã€æœ¬åœ°ç¼“å­˜ |
| èŠå¤©æ¶ˆæ¯ä¸¢å¤± | å†™å…¥å‹åŠ›å¤§ | å¼‚æ­¥é˜Ÿåˆ—ã€æ‰¹é‡å†™å…¥ |

**ğŸ’¡ æœ€ä½³å®è·µå»ºè®®**
```
å¼€å‘é˜¶æ®µï¼š
â€¢ é¢„ä¼°æ•°æ®å¢é•¿é‡
â€¢ æå‰è®¾è®¡åˆ†è¡¨ç­–ç•¥  
â€¢ å»ºç«‹ç›‘æ§ä½“ç³»

è¿è¥é˜¶æ®µï¼š
â€¢ æŒç»­ç›‘æ§å…³é”®æŒ‡æ ‡
â€¢ å®šæœŸåˆ†ææ…¢æŸ¥è¯¢
â€¢ æ ¹æ®ä¸šåŠ¡å‘å±•è°ƒæ•´æ¶æ„

æ•…éšœå¤„ç†ï¼š
â€¢ å»ºç«‹åº”æ€¥é¢„æ¡ˆ
â€¢ å‡†å¤‡æ•°æ®åº“ä¸»ä»åˆ‡æ¢æ–¹æ¡ˆ
â€¢ å…³é”®æ•°æ®å¤šé‡å¤‡ä»½
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ¸¸æˆæ•°æ®åº“è¯»å†™å¹¶é‡ï¼Œå®æ—¶æ€§è¦æ±‚é«˜
- çƒ­ç‚¹æ•°æ®ç”¨ç¼“å­˜ï¼Œå†·æ•°æ®é ç´¢å¼•
- æ‰¹é‡å¼‚æ­¥å¤„ç†ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- ç›‘æ§å…ˆè¡Œï¼Œé—®é¢˜å¯¼å‘ï¼ŒæŒç»­ä¼˜åŒ–