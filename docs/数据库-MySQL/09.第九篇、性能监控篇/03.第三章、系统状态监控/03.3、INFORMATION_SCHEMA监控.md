---
title: 3、INFORMATION_SCHEMA监控
---
## 📚 目录

1. [INFORMATION_SCHEMA概述](#1-INFORMATION_SCHEMA概述)
2. [系统元数据监控](#2-系统元数据监控)
3. [表结构监控](#3-表结构监控)
4. [权限监控](#4-权限监控)
5. [进程监控](#5-进程监控)
6. [锁信息监控](#6-锁信息监控)
7. [分区信息监控](#7-分区信息监控)
8. [触发器监控](#8-触发器监控)
9. [约束监控](#9-约束监控)
10. [监控最佳实践](#10-监控最佳实践)
11. [核心要点总结](#11-核心要点总结)

---

## 1. 📊 INFORMATION_SCHEMA概述


### 1.1 什么是INFORMATION_SCHEMA

INFORMATION_SCHEMA是MySQL内置的特殊数据库，专门用来存储数据库系统的元数据信息。简单说，就是**存放数据库信息的数据库**。

```
INFORMATION_SCHEMA = 数据库的"档案室"
```

**核心作用：**
- 🔍 **查看数据库结构** - 表、列、索引等信息
- 📊 **监控系统状态** - 连接、进程、锁等
- 🔒 **权限管理查看** - 用户权限分配情况
- ⚡ **性能分析支持** - 提供监控数据源

### 1.2 INFORMATION_SCHEMA的特点


```
特点对比表：
┌─────────────┬─────────────────┬─────────────────┐
│    特性     │ 普通数据库      │ INFORMATION_SCHEMA │
├─────────────┼─────────────────┼─────────────────┤
│ 数据类型    │ 业务数据        │ 系统元数据      │
│ 是否可写    │ 可以增删改查    │ 只读，不能修改  │
│ 数据来源    │ 用户创建        │ MySQL自动生成   │
│ 访问方式    │ 标准SQL查询     │ 标准SQL查询     │
└─────────────┴─────────────────┴─────────────────┘
```

> 💡 **新手提示**
> 
> 把INFORMATION_SCHEMA想象成MySQL的"体检报告"，通过查看这个报告，我们能了解数据库的健康状况和详细信息。

---

## 2. 🗃️ 系统元数据监控


### 2.1 查看数据库基本信息


**查看所有数据库：**
```sql
-- 查看系统中所有数据库
SELECT SCHEMA_NAME AS '数据库名称'
FROM INFORMATION_SCHEMA.SCHEMATA
ORDER BY SCHEMA_NAME;
```

**查看数据库字符集信息：**
```sql
-- 查看数据库字符集配置
SELECT 
    SCHEMA_NAME AS '数据库',
    DEFAULT_CHARACTER_SET_NAME AS '字符集',
    DEFAULT_COLLATION_NAME AS '排序规则'
FROM INFORMATION_SCHEMA.SCHEMATA
WHERE SCHEMA_NAME NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys');
```

### 2.2 系统版本和配置监控


**MySQL版本信息：**
```sql
-- 查看MySQL版本信息
SELECT 
    $$version AS 'MySQL版本',
    $$version_comment AS '版本说明';
```

**系统变量监控：**
```sql
-- 查看重要系统变量
SELECT 
    VARIABLE_NAME AS '配置项',
    VARIABLE_VALUE AS '当前值'
FROM INFORMATION_SCHEMA.GLOBAL_VARIABLES
WHERE VARIABLE_NAME IN (
    'max_connections',      -- 最大连接数
    'innodb_buffer_pool_size',  -- InnoDB缓冲池大小
    'query_cache_size'      -- 查询缓存大小
);
```

---

## 3. 📋 表结构监控


### 3.1 表基本信息监控


**查看数据库中的所有表：**
```sql
-- 查看指定数据库的表信息
SELECT 
    TABLE_NAME AS '表名',
    ENGINE AS '存储引擎',
    TABLE_ROWS AS '估算行数',
    ROUND(DATA_LENGTH/1024/1024, 2) AS '数据大小(MB)',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS '索引大小(MB)',
    TABLE_COMMENT AS '表注释'
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'your_database'
ORDER BY DATA_LENGTH DESC;
```

### 3.2 表字段详细信息


**查看表的列结构：**
```sql
-- 查看表的字段详情
SELECT 
    COLUMN_NAME AS '字段名',
    DATA_TYPE AS '数据类型',
    IS_NULLABLE AS '允许空值',
    COLUMN_DEFAULT AS '默认值',
    COLUMN_COMMENT AS '字段注释'
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'your_database' 
  AND TABLE_NAME = 'your_table'
ORDER BY ORDINAL_POSITION;
```

### 3.3 索引信息监控


**查看表的索引情况：**
```sql
-- 查看表的索引信息
SELECT 
    INDEX_NAME AS '索引名',
    COLUMN_NAME AS '字段名',
    INDEX_TYPE AS '索引类型',
    NON_UNIQUE AS '是否唯一'
FROM INFORMATION_SCHEMA.STATISTICS
WHERE TABLE_SCHEMA = 'your_database'
  AND TABLE_NAME = 'your_table'
ORDER BY INDEX_NAME, SEQ_IN_INDEX;
```

---

## 4. 🔐 权限监控


### 4.1 用户权限查看


**查看用户基本信息：**
```sql
-- 查看数据库用户列表
SELECT 
    User AS '用户名',
    Host AS '允许登录的主机',
    plugin AS '认证插件'
FROM mysql.user
ORDER BY User;
```

### 4.2 用户权限详情


**查看用户具体权限：**
```sql
-- 查看用户的数据库权限
SELECT 
    GRANTEE AS '用户',
    TABLE_SCHEMA AS '数据库',
    PRIVILEGE_TYPE AS '权限类型',
    IS_GRANTABLE AS '可授权'
FROM INFORMATION_SCHEMA.SCHEMA_PRIVILEGES
WHERE GRANTEE LIKE '%your_user%'
ORDER BY TABLE_SCHEMA, PRIVILEGE_TYPE;
```

**查看表级权限：**
```sql
-- 查看用户的表级权限
SELECT 
    GRANTEE AS '用户',
    TABLE_SCHEMA AS '数据库',
    TABLE_NAME AS '表名',
    PRIVILEGE_TYPE AS '权限类型'
FROM INFORMATION_SCHEMA.TABLE_PRIVILEGES
WHERE GRANTEE LIKE '%your_user%';
```

---

## 5. 🔄 进程监控


### 5.1 当前连接进程


**查看当前活跃连接：**
```sql
-- 查看当前数据库连接
SELECT 
    ID AS '进程ID',
    USER AS '用户',
    HOST AS '来源主机',
    DB AS '当前数据库',
    COMMAND AS '命令类型',
    TIME AS '执行时间(秒)',
    STATE AS '状态',
    LEFT(INFO, 50) AS 'SQL语句(前50字符)'
FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE COMMAND != 'Sleep'
ORDER BY TIME DESC;
```

### 5.2 长时间运行的查询


**监控慢查询进程：**
```sql
-- 查找运行时间超过10秒的查询
SELECT 
    ID AS '进程ID',
    USER AS '用户',
    HOST AS '主机',
    TIME AS '运行时间(秒)',
    STATE AS '状态',
    INFO AS 'SQL语句'
FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE COMMAND = 'Query' 
  AND TIME > 10
ORDER BY TIME DESC;
```

> ⚠️ **性能警告**
> 
> 长时间运行的查询可能会：
> - 🔒 锁定表资源
> - 📈 消耗大量CPU和内存
> - ⏰ 影响其他查询性能

---

## 6. 🔒 锁信息监控


### 6.1 表锁监控


**查看当前表锁情况：**
```sql
-- MySQL 8.0版本查看锁信息
SELECT 
    ENGINE_LOCK_ID AS '锁ID',
    ENGINE_TRANSACTION_ID AS '事务ID', 
    THREAD_ID AS '线程ID',
    OBJECT_SCHEMA AS '数据库',
    OBJECT_NAME AS '表名',
    LOCK_TYPE AS '锁类型',
    LOCK_MODE AS '锁模式',
    LOCK_STATUS AS '锁状态'
FROM performance_schema.data_locks
ORDER BY OBJECT_SCHEMA, OBJECT_NAME;
```

### 6.2 锁等待监控


**查看锁等待情况：**
```sql
-- 查看锁等待的详细信息
SELECT 
    waiting.ENGINE_LOCK_ID AS '等待的锁',
    waiting.THREAD_ID AS '等待线程',
    blocking.ENGINE_LOCK_ID AS '阻塞的锁',
    blocking.THREAD_ID AS '阻塞线程'
FROM performance_schema.data_lock_waits w
JOIN performance_schema.data_locks waiting 
    ON w.REQUESTING_ENGINE_LOCK_ID = waiting.ENGINE_LOCK_ID
JOIN performance_schema.data_locks blocking 
    ON w.BLOCKING_ENGINE_LOCK_ID = blocking.ENGINE_LOCK_ID;
```

---

## 7. 📁 分区信息监控


### 7.1 分区表概览


**查看分区表信息：**
```sql
-- 查看数据库中的分区表
SELECT 
    TABLE_SCHEMA AS '数据库',
    TABLE_NAME AS '表名',
    PARTITION_NAME AS '分区名',
    PARTITION_METHOD AS '分区方式',
    PARTITION_EXPRESSION AS '分区表达式',
    TABLE_ROWS AS '分区行数'
FROM INFORMATION_SCHEMA.PARTITIONS
WHERE PARTITION_NAME IS NOT NULL
ORDER BY TABLE_SCHEMA, TABLE_NAME, PARTITION_ORDINAL_POSITION;
```

### 7.2 分区大小监控


**监控分区存储大小：**
```sql
-- 查看各分区的存储空间使用情况
SELECT 
    TABLE_NAME AS '表名',
    PARTITION_NAME AS '分区名',
    ROUND(DATA_LENGTH/1024/1024, 2) AS '数据大小(MB)',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS '索引大小(MB)',
    TABLE_ROWS AS '估算行数'
FROM INFORMATION_SCHEMA.PARTITIONS
WHERE TABLE_SCHEMA = 'your_database'
  AND PARTITION_NAME IS NOT NULL
ORDER BY DATA_LENGTH DESC;
```

---

## 8. ⚡ 触发器监控


### 8.1 触发器基本信息


**查看数据库中的触发器：**
```sql
-- 查看触发器列表和基本信息
SELECT 
    TRIGGER_SCHEMA AS '所属数据库',
    TRIGGER_NAME AS '触发器名称',
    EVENT_MANIPULATION AS '触发事件',
    EVENT_OBJECT_TABLE AS '关联表',
    ACTION_TIMING AS '触发时机',
    DEFINER AS '创建者'
FROM INFORMATION_SCHEMA.TRIGGERS
WHERE TRIGGER_SCHEMA NOT IN ('sys', 'mysql', 'information_schema', 'performance_schema')
ORDER BY TRIGGER_SCHEMA, EVENT_OBJECT_TABLE;
```

### 8.2 触发器详细定义


**查看触发器的具体逻辑：**
```sql
-- 查看触发器的详细定义
SELECT 
    TRIGGER_NAME AS '触发器名称',
    EVENT_OBJECT_TABLE AS '表名',
    ACTION_STATEMENT AS '触发器逻辑'
FROM INFORMATION_SCHEMA.TRIGGERS
WHERE TRIGGER_SCHEMA = 'your_database'
  AND TRIGGER_NAME = 'your_trigger';
```

---

## 9. 🔗 约束监控


### 9.1 外键约束监控


**查看外键约束信息：**
```sql
-- 查看数据库中的外键约束
SELECT 
    CONSTRAINT_SCHEMA AS '数据库',
    TABLE_NAME AS '表名',
    CONSTRAINT_NAME AS '约束名',
    COLUMN_NAME AS '外键字段',
    REFERENCED_TABLE_NAME AS '引用表',
    REFERENCED_COLUMN_NAME AS '引用字段'
FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE CONSTRAINT_SCHEMA = 'your_database'
  AND REFERENCED_TABLE_NAME IS NOT NULL
ORDER BY TABLE_NAME;
```

### 9.2 检查约束监控


**查看表的约束条件：**
```sql
-- 查看表的检查约束（MySQL 8.0.16+）
SELECT 
    CONSTRAINT_SCHEMA AS '数据库',
    TABLE_NAME AS '表名',
    CONSTRAINT_NAME AS '约束名',
    CHECK_CLAUSE AS '约束条件'
FROM INFORMATION_SCHEMA.CHECK_CONSTRAINTS
WHERE CONSTRAINT_SCHEMA = 'your_database'
ORDER BY TABLE_NAME;
```

---

## 10. 📊 监控最佳实践


### 10.1 日常监控检查清单


**🎯 每日检查项目：**

- [x] **连接数监控**
```sql
-- 检查当前连接数
SELECT COUNT(*) AS '当前连接数' FROM INFORMATION_SCHEMA.PROCESSLIST;
```

- [x] **表大小监控**
```sql
-- 检查表大小增长情况
SELECT 
    TABLE_NAME,
    ROUND((DATA_LENGTH + INDEX_LENGTH)/1024/1024, 2) AS '总大小(MB)'
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'your_database'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC
LIMIT 10;
```

- [x] **慢查询监控**
```sql
-- 检查长时间运行的查询
SELECT COUNT(*) AS '慢查询数量'
FROM INFORMATION_SCHEMA.PROCESSLIST
WHERE COMMAND = 'Query' AND TIME > 30;
```

### 10.2 监控脚本示例


**创建监控视图：**
```sql
-- 创建数据库监控视图
CREATE VIEW db_monitor_view AS
SELECT 
    t.TABLE_SCHEMA AS '数据库',
    COUNT(t.TABLE_NAME) AS '表数量',
    ROUND(SUM(t.DATA_LENGTH)/1024/1024, 2) AS '数据大小(MB)',
    ROUND(SUM(t.INDEX_LENGTH)/1024/1024, 2) AS '索引大小(MB)',
    p.connection_count AS '当前连接数'
FROM INFORMATION_SCHEMA.TABLES t
CROSS JOIN (
    SELECT COUNT(*) AS connection_count 
    FROM INFORMATION_SCHEMA.PROCESSLIST
) p
WHERE t.TABLE_SCHEMA NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
GROUP BY t.TABLE_SCHEMA, p.connection_count;
```

### 10.3 性能监控指标


**关键监控指标对照表：**

| 📊 监控项目 | 🎯 正常范围 | ⚠️ 警告阈值 | 🚨 危险阈值 |
|------------|------------|------------|------------|
| 连接数使用率 | < 70% | 70-85% | > 85% |
| 表锁等待 | 0个 | 1-3个 | > 3个 |
| 长查询(>30s) | 0个 | 1-2个 | > 2个 |
| 单表大小 | < 1GB | 1-5GB | > 5GB |

---

## 11. 📋 核心要点总结


### 11.1 必须掌握的核心概念


```
🔸 INFORMATION_SCHEMA：MySQL的系统元数据库，只读
🔸 系统元数据：数据库、表、字段等结构信息
🔸 权限监控：用户权限分配和安全管理
🔸 进程监控：当前连接和查询执行状态
🔸 锁监控：表锁和行锁的使用情况
🔸 分区监控：分区表的存储和性能状态
🔸 触发器约束：数据库逻辑完整性监控
```

### 11.2 关键理解要点


**🔹 INFORMATION_SCHEMA的本质**
```
理解要点：
- 不是普通数据库，是系统信息的镜像
- 数据实时更新，反映当前状态
- 只能查询，不能修改
- 是DBA监控数据库的重要工具
```

**🔹 监控的重要性**
```
实际意义：
- 及时发现性能问题
- 预防系统故障
- 优化资源配置
- 确保数据安全
```

**🔹 监控数据的解读**
```
关键技能：
- 识别异常指标
- 理解指标含义
- 制定处理方案
- 建立监控体系
```

### 11.3 实际应用价值


- **🔍 故障诊断**：快速定位数据库问题根源
- **📊 性能优化**：基于监控数据进行调优
- **🔒 安全管理**：监控权限和访问情况
- **📈 容量规划**：预测资源需求和扩容
- **⚡ 实时监控**：建立自动化监控体系

**🧠 记忆口诀**：
```
信息模式是宝库，元数据监控全靠它
表结构权限锁进程，分区触发约束查
监控指标要关注，异常及时来处理
数据库管理好帮手，性能优化离不开
```

**核心记忆**：
- INFORMATION_SCHEMA是MySQL的"体检中心"
- 通过SQL查询获取系统各种状态信息
- 监控是预防问题的最佳手段
- 理解监控数据比收集数据更重要