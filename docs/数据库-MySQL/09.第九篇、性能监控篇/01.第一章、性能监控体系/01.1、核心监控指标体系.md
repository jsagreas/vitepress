---
title: 1、核心监控指标体系
---
## 📚 目录

1. [性能监控基础概念](#1-性能监控基础概念)
2. [核心监控指标体系](#2-核心监控指标体系)
3. [吞吐量性能指标](#3-吞吐量性能指标)
4. [响应时间与延迟指标](#4-响应时间与延迟指标)
5. [资源消耗监控指标](#5-资源消耗监控指标)
6. [业务级监控指标](#6-业务级监控指标)
7. [核心要点总结](#7-核心要点总结)

---

## 1. 🎯 性能监控基础概念


### 1.1 什么是MySQL性能监控


**性能监控**就是实时观察和记录MySQL数据库运行时的各种状态数据，就像给数据库装上"体检仪器"，随时了解它的健康状况。

```
数据库监控就像医院体检：

体检项目          数据库监控
────────         ────────────
血压心率      ←→  QPS/TPS吞吐量
血糖指标      ←→  响应时间延迟
体重身高      ←→  CPU/内存使用率
血常规        ←→  连接数/锁等待
```

> **💡 监控的本质目的**：提前发现问题，避免系统崩溃，保证数据库稳定运行。

### 1.2 监控与性能优化的关系


**监控是优化的基础**，没有监控数据就像盲人摸象，不知道问题出在哪里。

```
性能优化流程：

发现问题 → 分析问题 → 解决问题 → 验证效果
   ↑          ↑          ↑          ↑
监控告警    监控数据    调优操作    监控验证
```

**监控的三大作用：**
- **🚨 预警作用**：问题发生前提前报警
- **🔍 诊断作用**：快速定位性能瓶颈
- **📊 评估作用**：验证优化效果

### 1.3 MySQL性能监控发展历程


MySQL监控经历了从简单到复杂、从手工到自动的发展过程。

| **阶段** | **监控方式** | **特点** | **典型工具** |
|---------|-------------|---------|-------------|
| **早期阶段** | `手工命令查看` | `被动、间断` | `SHOW STATUS` |
| **工具阶段** | `专用监控工具` | `自动、图形化` | `Nagios, Zabbix` |
| **平台阶段** | `监控平台` | `集中、智能` | `Prometheus, Grafana` |
| **云原生** | `云监控服务` | `托管、弹性` | `CloudWatch, 云监控` |

---

## 2. 📊 核心监控指标体系


### 2.1 监控指标分类架构


MySQL性能监控指标可以分为四大类，每类都有其特定的监控目的。

```
MySQL监控指标体系架构：

                   MySQL性能监控
                  /             \
            系统层监控          应用层监控
           /         \        /         \
      硬件资源    数据库状态  业务指标   用户体验
     /   |   \    /   |   \   |        |
   CPU 内存 IO  连接 锁 缓存 QPS      响应时间
```

### 2.2 监控数据采集基本原理


监控数据主要通过三种方式获取：

**📋 数据采集方式：**

```sql
-- 1. 状态变量查询
SHOW GLOBAL STATUS LIKE 'Queries';
SHOW GLOBAL STATUS LIKE 'Uptime';

-- 2. 性能模式查询  
SELECT * FROM performance_schema.events_statements_summary_global_by_event_name;

-- 3. 系统表查询
SELECT * FROM information_schema.processlist;
```

**🔧 采集原理说明：**
- **状态变量**：MySQL内部计数器，记录各种操作统计
- **性能模式**：专门的性能监控框架，提供详细性能数据
- **系统表**：存储数据库元数据和运行时信息

---

## 3. ⚡ 吞吐量性能指标


### 3.1 QPS（每秒查询数）核心指标


**QPS**是"Queries Per Second"的缩写，表示数据库每秒钟能处理多少个查询请求。

```sql
-- 计算QPS的基本方法
SHOW GLOBAL STATUS LIKE 'Queries';
SHOW GLOBAL STATUS LIKE 'Uptime';

-- QPS = 总查询数 / 运行时间（秒）
```

**🎯 QPS指标含义：**
- **高QPS**：说明数据库处理能力强，但也可能意味着负载高
- **低QPS**：可能是业务访问量小，也可能是性能瓶颈导致
- **QPS波动**：反映业务访问模式和系统稳定性

> **⚠️ 注意**：QPS包括所有类型的查询，包括SELECT、INSERT、UPDATE、DELETE等。

### 3.2 TPS（每秒事务数）核心指标


**TPS**是"Transactions Per Second"的缩写，表示每秒钟完成的事务数量。

```sql
-- 监控TPS相关指标
SHOW GLOBAL STATUS LIKE 'Com_commit';
SHOW GLOBAL STATUS LIKE 'Com_rollback';

-- TPS = (提交事务数 + 回滚事务数) / 时间间隔
```

**📊 TPS与QPS的区别：**

| **指标** | **含义** | **计算方式** | **业务意义** |
|---------|---------|-------------|-------------|
| **QPS** | `每秒查询数` | `总查询数/时间` | `数据库繁忙程度` |
| **TPS** | `每秒事务数` | `事务数/时间` | `业务处理能力` |

### 3.3 并发连接数实时监控


连接数反映了当前有多少客户端在使用数据库。

```sql
-- 查看当前连接数
SHOW GLOBAL STATUS LIKE 'Threads_connected';

-- 查看历史最大连接数
SHOW GLOBAL STATUS LIKE 'Max_used_connections';

-- 查看连接数限制
SHOW VARIABLES LIKE 'max_connections';
```

**🔗 连接数监控要点：**
- **当前连接数**：实时反映系统负载
- **最大连接数**：历史峰值，用于容量规划
- **连接数比例**：当前连接数/最大允许连接数，超过80%需要关注

---

## 4. ⏱️ 响应时间与延迟指标


### 4.1 查询响应时间监控


响应时间是用户最直接感受到的性能指标，直接影响用户体验。

```sql
-- 开启慢查询日志监控
SET GLOBAL slow_query_log = ON;
SET GLOBAL long_query_time = 1.0;

-- 查看平均查询时间（通过performance_schema）
SELECT 
    EVENT_NAME,
    AVG_TIMER_WAIT/1000000000 AS avg_time_seconds
FROM performance_schema.events_statements_summary_global_by_event_name
WHERE EVENT_NAME LIKE 'statement/sql%';
```

**⏰ 响应时间分级标准：**
- **< 100ms**：优秀，用户无感知
- **100ms-500ms**：良好，可接受范围
- **500ms-2s**：一般，需要关注
- **> 2s**：差，必须优化

### 4.2 锁等待时间指标


锁等待时间反映数据库并发冲突的严重程度。

```sql
-- 查看锁等待统计
SHOW GLOBAL STATUS LIKE 'Table_locks_waited';
SHOW GLOBAL STATUS LIKE 'Table_locks_immediate';

-- 查看InnoDB锁等待
SELECT * FROM information_schema.INNODB_LOCK_WAITS;
```

**🔒 锁等待监控指标：**
- **表锁等待次数**：反映表级锁竞争
- **行锁等待时间**：反映行级锁冲突
- **死锁次数**：系统并发设计问题

### 4.3 复制延迟指标


对于主从复制环境，复制延迟是关键的监控指标。

```sql
-- 在从库查看复制延迟
SHOW SLAVE STATUS\G

-- 关键字段：Seconds_Behind_Master
```

**📡 复制延迟含义：**
- **0秒延迟**：主从完全同步
- **几秒延迟**：正常情况，可接受
- **几分钟延迟**：需要检查网络和配置
- **NULL值**：复制中断，需要立即处理

---

## 5. 💾 资源消耗监控指标


### 5.1 CPU、内存、IO资源指标


数据库性能最终受限于硬件资源，监控资源使用率是性能调优的基础。

```sql
-- 查看缓冲池使用情况
SHOW GLOBAL STATUS LIKE 'Innodb_buffer_pool%';

-- 查看查询缓存命中率
SHOW GLOBAL STATUS LIKE 'Qcache%';
```

**🖥️ 资源监控重点：**

| **资源类型** | **监控指标** | **健康范围** | **问题表现** |
|-------------|-------------|-------------|-------------|
| **CPU** | `CPU使用率` | `< 70%` | `查询变慢，响应延迟` |
| **内存** | `缓冲池命中率` | `> 95%` | `大量磁盘IO，性能下降` |
| **磁盘IO** | `IOPS、IO等待` | `IO等待 < 10%` | `查询排队，系统卡顿` |

### 5.2 缓存命中率指标


缓存命中率直接影响数据库性能，是最重要的性能指标之一。

```sql
-- InnoDB缓冲池命中率
SELECT 
  (1 - (Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests)) * 100 
  AS buffer_pool_hit_rate
FROM 
  (SELECT variable_value AS Innodb_buffer_pool_reads 
   FROM performance_schema.global_status 
   WHERE variable_name = 'Innodb_buffer_pool_reads') AS reads,
  (SELECT variable_value AS Innodb_buffer_pool_read_requests 
   FROM performance_schema.global_status 
   WHERE variable_name = 'Innodb_buffer_pool_read_requests') AS requests;
```

**📈 缓存命中率标准：**
- **> 99%**：优秀，内存配置合理
- **95%-99%**：良好，可适当增加内存
- **< 95%**：需要调整缓冲池大小

### 5.3 临时表创建频率


临时表创建频率反映查询复杂度和索引优化情况。

```sql
-- 查看临时表创建统计
SHOW GLOBAL STATUS LIKE 'Created_tmp_tables';
SHOW GLOBAL STATUS LIKE 'Created_tmp_disk_tables';

-- 磁盘临时表比例 = Created_tmp_disk_tables / Created_tmp_tables
```

**📊 临时表监控要点：**
- **内存临时表**：正常，但过多说明查询复杂
- **磁盘临时表**：性能杀手，需要重点优化
- **比例控制**：磁盘临时表比例应 < 25%

---

## 6. 🎯 业务级监控指标


### 6.1 慢查询统计指标


慢查询是性能优化的重点关注对象，直接影响用户体验。

```sql
-- 查看慢查询统计
SHOW GLOBAL STATUS LIKE 'Slow_queries';
SHOW VARIABLES LIKE 'long_query_time';

-- 慢查询率 = 慢查询数 / 总查询数
```

**🐌 慢查询监控策略：**
- **慢查询阈值**：通常设置为1-2秒
- **慢查询比例**：应控制在 < 5%
- **监控频率**：实时监控，定期分析

### 6.2 错误率监控统计


错误率反映系统稳定性和代码质量。

```sql
-- 查看连接错误
SHOW GLOBAL STATUS LIKE 'Connection_errors%';

-- 查看SQL执行错误
SHOW GLOBAL STATUS LIKE 'Com_stmt_execute';
```

**❌ 错误率分类：**
- **连接错误**：网络问题或连接数限制
- **权限错误**：用户权限配置问题  
- **SQL错误**：语法错误或逻辑错误
- **死锁错误**：并发设计问题

### 6.3 表扫描比例指标


表扫描比例反映索引使用效率，是SQL优化的重要指标。

```sql
-- 查看表扫描统计
SHOW GLOBAL STATUS LIKE 'Select_scan';
SHOW GLOBAL STATUS LIKE 'Select_range';

-- 全表扫描比例 = Select_scan / (Select_scan + Select_range + ...)
```

**🔍 表扫描监控含义：**
- **全表扫描**：没有使用索引，性能差
- **范围扫描**：使用了索引，性能好
- **比例控制**：全表扫描比例应 < 4%

### 6.4 死锁统计指标


死锁反映并发事务设计问题，需要重点监控。

```sql
-- 查看死锁统计
SHOW ENGINE INNODB STATUS;

-- 从状态信息中提取：
-- LATEST DETECTED DEADLOCK 部分
```

**⚠️ 死锁监控要点：**
- **死锁频率**：正常情况下应该很少发生
- **死锁模式**：分析死锁日志，找出规律
- **解决策略**：调整事务逻辑，减少锁竞争

---

## 7. 📋 核心要点总结


### 7.1 必须掌握的核心概念


```
🎯 性能监控本质：实时观察数据库健康状况的"体检系统"
🎯 监控分类：吞吐量、响应时间、资源消耗、业务指标四大类
🎯 核心指标：QPS/TPS反映处理能力，响应时间反映用户体验
🎯 资源监控：CPU/内存/IO是性能瓶颈的根本原因
🎯 业务监控：慢查询、错误率直接影响业务稳定性
```

### 7.2 关键理解要点


**🔹 QPS和TPS的本质区别**
```
QPS关注查询操作：包括所有SQL语句执行
TPS关注事务完整性：包括提交和回滚的完整事务
业务意义：TPS更能反映真实的业务处理能力
```

**🔹 缓存命中率的重要性**
```
命中率高：数据在内存中，访问速度快
命中率低：需要读磁盘，性能急剧下降
优化方向：增加内存、优化查询、调整缓冲池
```

**🔹 监控数据的时效性**
```
实时监控：发现问题及时报警
趋势分析：通过历史数据发现规律
容量规划：基于监控数据预测资源需求
```

### 7.3 实际应用价值


**💼 生产环境实践**
- **预警机制**：设置合理的监控阈值，提前发现问题
- **性能调优**：基于监控数据定位瓶颈，制定优化策略
- **容量规划**：根据监控趋势预测资源需求
- **故障排查**：利用历史监控数据快速定位问题原因

**🎯 监控最佳实践**
- **分层监控**：从硬件到业务的全方位监控
- **告警分级**：不同严重程度的问题设置不同告警级别
- **自动化**：减少人工干预，提高响应速度
- **可视化**：通过图表直观展示监控数据

### 7.4 常见问题与解决思路


**⚠️ 性能问题排查流程**
```
1. 查看QPS/TPS：确定是否有异常流量
2. 检查响应时间：定位用户体验问题
3. 分析资源使用：找出硬件瓶颈
4. 审查慢查询：优化具体SQL语句
```

**💡 监控指标阈值设置**
```
根据历史数据：基于正常运行时的数据范围
结合业务特点：不同业务场景的阈值不同
动态调整：随着系统优化不断调整阈值
分时段设置：高峰期和低峰期的阈值不同
```

**核心记忆口诀**：
```
监控数据库如体检，四大指标要记清
QPS TPS看吞吐，响应时间用户行
CPU内存IO资源，缓存命中是关键  
慢查错误要监控，死锁全扫需重视
预警诊断加评估，性能优化有依据
```