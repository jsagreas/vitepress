---
title: 10ã€ç›‘æ§æ•…éšœæ’æŸ¥
---
## ğŸ“š ç›®å½•

1. [ç›‘æ§ç³»ç»Ÿæ•…éšœå®šä½](#1-ç›‘æ§ç³»ç»Ÿæ•…éšœå®šä½)
2. [æ•°æ®é‡‡é›†å¼‚å¸¸å¤„ç†](#2-æ•°æ®é‡‡é›†å¼‚å¸¸å¤„ç†)
3. [å‘Šè­¦é£æš´å¤„ç†](#3-å‘Šè­¦é£æš´å¤„ç†)
4. [ç›‘æ§æ•°æ®ä¸¢å¤±æ¢å¤](#4-ç›‘æ§æ•°æ®ä¸¢å¤±æ¢å¤)
5. [æ€§èƒ½ç›‘æ§è°ƒä¼˜](#5-æ€§èƒ½ç›‘æ§è°ƒä¼˜)
6. [ç›‘æ§ç»„ä»¶æ•…éšœå¤„ç†](#6-ç›‘æ§ç»„ä»¶æ•…éšœå¤„ç†)
7. [ç›‘æ§æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ](#7-ç›‘æ§æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ)
8. [æ•…éšœé¢„é˜²æœºåˆ¶](#8-æ•…éšœé¢„é˜²æœºåˆ¶)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç›‘æ§ç³»ç»Ÿæ•…éšœå®šä½


### 1.1 ä»€ä¹ˆæ˜¯ç›‘æ§ç³»ç»Ÿæ•…éšœ


**ç®€å•ç†è§£**ï¼šç›‘æ§ç³»ç»Ÿæ•…éšœå°±æ˜¯åŸæœ¬ç”¨æ¥ç›‘æ§MySQLæ•°æ®åº“çš„å·¥å…·æœ¬èº«å‡ºç°äº†é—®é¢˜ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸æ”¶é›†ã€å­˜å‚¨æˆ–å±•ç¤ºç›‘æ§æ•°æ®ã€‚

**å¸¸è§æ•…éšœç±»å‹**ï¼š
```
æ•°æ®æ”¶é›†æ•…éšœï¼šç›‘æ§å·¥å…·æ— æ³•ä»MySQLè·å–æ•°æ®
æ•°æ®å­˜å‚¨æ•…éšœï¼šæ”¶é›†åˆ°çš„æ•°æ®æ— æ³•ä¿å­˜
æ•°æ®å±•ç¤ºæ•…éšœï¼šæ•°æ®æ­£å¸¸ä½†æ— æ³•åœ¨ç•Œé¢ä¸Šæ˜¾ç¤º
ç½‘ç»œè¿æ¥æ•…éšœï¼šç›‘æ§å·¥å…·ä¸MySQLå¤±å»è¿æ¥
```

### 1.2 æ•…éšœå®šä½çš„åŸºæœ¬æ€è·¯


**æ•…éšœå®šä½æµç¨‹å›¾**ï¼š
```
å‘ç°å¼‚å¸¸ â†’ ç¡®è®¤æ•…éšœèŒƒå›´ â†’ åˆ†ææ ¹æœ¬åŸå›  â†’ åˆ¶å®šè§£å†³æ–¹æ¡ˆ â†’ éªŒè¯ä¿®å¤æ•ˆæœ

å…·ä½“æ­¥éª¤ï¼š
1. æ£€æŸ¥ç›‘æ§å·¥å…·æœ¬èº«æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. éªŒè¯MySQLæ•°æ®åº“æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®
3. æµ‹è¯•ç½‘ç»œè¿æ¥æ˜¯å¦ç•…é€š
4. æŸ¥çœ‹ç›¸å…³æ—¥å¿—æ–‡ä»¶å¯»æ‰¾é”™è¯¯ä¿¡æ¯
5. é€æ­¥æ’é™¤å¯èƒ½çš„æ•…éšœç‚¹
```

### 1.3 å¿«é€Ÿæ•…éšœæ£€æŸ¥æ¸…å•


**ğŸ”¸ åŸºç¡€æ£€æŸ¥é¡¹ç›®**
```sql
-- æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
SHOW PROCESSLIST;

-- æ£€æŸ¥MySQLè¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';

-- æ£€æŸ¥MySQLé”™è¯¯æ—¥å¿—
SHOW VARIABLES LIKE 'log_error';
```

**ğŸ”¸ ç›‘æ§å·¥å…·æ£€æŸ¥**
```bash
# æ£€æŸ¥ç›‘æ§è¿›ç¨‹æ˜¯å¦è¿è¡Œ
ps aux | grep prometheus
ps aux | grep grafana

# æ£€æŸ¥ç›‘æ§æœåŠ¡çŠ¶æ€
systemctl status prometheus
systemctl status grafana-server

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
telnet mysql_host 3306
```

### 1.4 æ•…éšœå®šä½å·¥å…·å’Œæ–¹æ³•


| æ•…éšœç±»å‹ | **æ£€æŸ¥æ–¹æ³•** | **ä½¿ç”¨å·¥å…·** | **å…³é”®æŒ‡æ ‡** |
|---------|------------|-------------|-------------|
| ğŸ”— **è¿æ¥é—®é¢˜** | `æµ‹è¯•æ•°æ®åº“è¿æ¥` | `mysqlå®¢æˆ·ç«¯ã€telnet` | `è¿æ¥å»¶è¿Ÿã€è¿æ¥æˆåŠŸç‡` |
| ğŸ“Š **æ•°æ®é‡‡é›†** | `æŸ¥çœ‹é‡‡é›†æ—¥å¿—` | `ç›‘æ§å·¥å…·æ—¥å¿—` | `é‡‡é›†é¢‘ç‡ã€é”™è¯¯ç‡` |
| ğŸ’¾ **æ•°æ®å­˜å‚¨** | `æ£€æŸ¥å­˜å‚¨ç©ºé—´` | `dfã€iostat` | `ç£ç›˜ä½¿ç”¨ç‡ã€IOæ€§èƒ½` |
| ğŸ–¥ï¸ **ç•Œé¢å±•ç¤º** | `æ£€æŸ¥webæœåŠ¡` | `æµè§ˆå™¨å¼€å‘è€…å·¥å…·` | `HTTPçŠ¶æ€ç ã€å“åº”æ—¶é—´` |

---

## 2. ğŸ“¡ æ•°æ®é‡‡é›†å¼‚å¸¸å¤„ç†


### 2.1 æ•°æ®é‡‡é›†å¼‚å¸¸çš„å«ä¹‰


**é€šä¿—è§£é‡Š**ï¼šæ•°æ®é‡‡é›†å¼‚å¸¸å°±æ˜¯ç›‘æ§å·¥å…·æ— æ³•æ­£å¸¸ä»MySQLæ•°æ®åº“ä¸­è·å–éœ€è¦çš„æ€§èƒ½æ•°æ®ï¼Œå°±åƒä½“æ¸©è®¡åäº†æ— æ³•æµ‹é‡ä½“æ¸©ä¸€æ ·ã€‚

### 2.2 å¸¸è§é‡‡é›†å¼‚å¸¸æƒ…å†µ


**ğŸ”¸ é‡‡é›†é¢‘ç‡å¼‚å¸¸**
```
æ­£å¸¸æƒ…å†µï¼šæ¯30ç§’é‡‡é›†ä¸€æ¬¡æ•°æ®
å¼‚å¸¸æƒ…å†µï¼šé‡‡é›†é—´éš”å˜æˆ5åˆ†é’Ÿæˆ–æ›´é•¿
å½±å“ï¼šæ— æ³•åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
```

**ğŸ”¸ é‡‡é›†æ•°æ®ä¸å®Œæ•´**
```sql
-- ç¤ºä¾‹ï¼šéƒ¨åˆ†æŒ‡æ ‡ç¼ºå¤±
-- æ­£å¸¸åº”è¯¥æœ‰çš„æŒ‡æ ‡
SELECT 
    VARIABLE_NAME,
    VARIABLE_VALUE 
FROM performance_schema.global_status 
WHERE VARIABLE_NAME IN (
    'Threads_connected',
    'Threads_running',
    'Questions',
    'Slow_queries'
);

-- å¼‚å¸¸æ—¶æŸäº›æŒ‡æ ‡å¯èƒ½è¿”å›NULLæˆ–è€…æŸ¥è¯¢å¤±è´¥
```

### 2.3 é‡‡é›†å¼‚å¸¸çš„æ’æŸ¥æ­¥éª¤


**æ­¥éª¤1ï¼šæ£€æŸ¥é‡‡é›†é…ç½®**
```yaml
# prometheusé…ç½®ç¤ºä¾‹
scrape_configs:
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-host:9104']
    scrape_interval: 30s    # æ£€æŸ¥é‡‡é›†é—´éš”
    scrape_timeout: 10s     # æ£€æŸ¥è¶…æ—¶è®¾ç½®
```

**æ­¥éª¤2ï¼šéªŒè¯æ•°æ®æº**
```sql
-- æ‰‹åŠ¨æµ‹è¯•MySQLè¿æ¥å’ŒæŸ¥è¯¢
SHOW GLOBAL STATUS LIKE 'Questions';
SHOW GLOBAL STATUS LIKE 'Slow_queries';
```

**æ­¥éª¤3ï¼šæ£€æŸ¥æƒé™é—®é¢˜**
```sql
-- ç¡®è®¤ç›‘æ§ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'monitor_user'@'%';

-- ç›‘æ§ç”¨æˆ·éœ€è¦çš„åŸºæœ¬æƒé™
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* 
TO 'monitor_user'@'%';
```

### 2.4 é‡‡é›†å¼‚å¸¸çš„è§£å†³æ–¹æ¡ˆ


**ğŸ”¸ æƒé™ä¸è¶³è§£å†³**
```sql
-- ä¸ºç›‘æ§ç”¨æˆ·æ·»åŠ å¿…è¦æƒé™
GRANT PROCESS ON *.* TO 'monitor_user'@'%';
GRANT SELECT ON performance_schema.* TO 'monitor_user'@'%';
FLUSH PRIVILEGES;
```

**ğŸ”¸ ç½‘ç»œè¶…æ—¶è§£å†³**
```yaml
# è°ƒæ•´é‡‡é›†è¶…æ—¶æ—¶é—´
scrape_configs:
  - job_name: 'mysql'
    scrape_timeout: 30s  # å¢åŠ è¶…æ—¶æ—¶é—´
    metrics_path: /metrics
```

---

## 3. ğŸš¨ å‘Šè­¦é£æš´å¤„ç†


### 3.1 å‘Šè­¦é£æš´æ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£**ï¼šå‘Šè­¦é£æš´å°±æ˜¯ç›‘æ§ç³»ç»Ÿåœ¨çŸ­æ—¶é—´å†…å‘é€å¤§é‡å‘Šè­¦ä¿¡æ¯ï¼Œå°±åƒç«ç¾æŠ¥è­¦å™¨ä¸€ç›´å“ä¸ªä¸åœï¼Œè®©äººæ— æ³•åˆ†è¾¨çœŸæ­£çš„é—®é¢˜ã€‚

**å…¸å‹åœºæ™¯**ï¼š
```
åœºæ™¯1ï¼šMySQLä¸»åº“å®•æœºï¼Œå¯¼è‡´ä»åº“ã€åº”ç”¨ã€ç›‘æ§éƒ½å¼€å§‹æŠ¥è­¦
åœºæ™¯2ï¼šç½‘ç»œæ•…éšœå¯¼è‡´ç›‘æ§å·¥å…·æ— æ³•è¿æ¥MySQLï¼Œè§¦å‘å¤§é‡è¿æ¥å‘Šè­¦
åœºæ™¯3ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¼•å‘å¤šä¸ªç›¸å…³çš„å‘Šè­¦è§„åˆ™åŒæ—¶è§¦å‘
```

### 3.2 å‘Šè­¦é£æš´çš„è¯†åˆ«


**ğŸ”¸ è¯†åˆ«æ ‡å‡†**
```
æ—¶é—´ç»´åº¦ï¼š5åˆ†é’Ÿå†…æ”¶åˆ°è¶…è¿‡20æ¡å‘Šè­¦
èŒƒå›´ç»´åº¦ï¼šå¤šä¸ªä¸åŒç±»å‹çš„å‘Šè­¦åŒæ—¶å‡ºç°
é¢‘ç‡ç»´åº¦ï¼šåŒç±»å‘Šè­¦æ¯åˆ†é’Ÿè§¦å‘è¶…è¿‡5æ¬¡
```

**ğŸ”¸ ç›‘æ§å‘Šè­¦æ•°é‡**
```sql
-- æŸ¥çœ‹å‘Šè­¦å†å²è®°å½•ï¼ˆå¦‚æœæœ‰å‘Šè­¦å†å²è¡¨ï¼‰
SELECT 
    DATE_FORMAT(alert_time, '%Y-%m-%d %H:%i') as time_period,
    COUNT(*) as alert_count,
    alert_type
FROM alert_history 
WHERE alert_time >= NOW() - INTERVAL 1 HOUR
GROUP BY time_period, alert_type
ORDER BY time_period DESC;
```

### 3.3 å‘Šè­¦é£æš´å¤„ç†ç­–ç•¥


**ğŸ”¸ ç«‹å³å¤„ç†æªæ–½**
```
1. æš‚åœéå…³é”®å‘Šè­¦ï¼šä¸´æ—¶å…³é—­æ¬¡è¦å‘Šè­¦è§„åˆ™
2. å‘Šè­¦èšåˆï¼šå°†ç›¸åŒç±»å‹çš„å‘Šè­¦åˆå¹¶ä¸ºä¸€æ¡
3. å‘Šè­¦æŠ‘åˆ¶ï¼šè®¾ç½®å‘Šè­¦ä¾èµ–å…³ç³»ï¼Œé¿å…çº§è”å‘Šè­¦
4. æé«˜å‘Šè­¦é˜ˆå€¼ï¼šä¸´æ—¶è°ƒé«˜è§¦å‘æ¡ä»¶
```

**ğŸ”¸ å‘Šè­¦æŠ‘åˆ¶é…ç½®ç¤ºä¾‹**
```yaml
# AlertmanageræŠ‘åˆ¶è§„åˆ™ç¤ºä¾‹
inhibit_rules:
  - source_match:
      alertname: 'MySQLDown'
    target_match:
      service: 'mysql'
    equal: ['instance']
```

### 3.4 é¢„é˜²å‘Šè­¦é£æš´


**ğŸ”¸ åˆç†çš„å‘Šè­¦è§„åˆ™è®¾è®¡**
```yaml
# è®¾ç½®å‘Šè­¦é¢‘ç‡é™åˆ¶
groups:
  - name: mysql.rules
    interval: 30s
    rules:
      - alert: MySQLSlowQueries
        expr: rate(mysql_global_status_slow_queries[5m]) > 0.1
        for: 2m  # æŒç»­2åˆ†é’Ÿæ‰å‘Šè­¦ï¼Œé¿å…çŸ­æš‚æ³¢åŠ¨
```

**ğŸ”¸ å‘Šè­¦çº§åˆ«åˆ†ç±»**
```
ğŸ”´ P0çº§åˆ«ï¼šæ•°æ®åº“å®Œå…¨ä¸å¯ç”¨
ğŸŸ¡ P1çº§åˆ«ï¼šæ€§èƒ½ä¸¥é‡ä¸‹é™ä½†ä»å¯ç”¨
ğŸŸ¢ P2çº§åˆ«ï¼šæ€§èƒ½è½»å¾®ä¸‹é™æˆ–é¢„è­¦
```

---

## 4. ğŸ’¾ ç›‘æ§æ•°æ®ä¸¢å¤±æ¢å¤


### 4.1 ç›‘æ§æ•°æ®ä¸¢å¤±çš„å«ä¹‰


**é€šä¿—è§£é‡Š**ï¼šç›‘æ§æ•°æ®ä¸¢å¤±å°±æ˜¯åŸæœ¬åº”è¯¥è®°å½•ä¸‹æ¥çš„MySQLæ€§èƒ½æ•°æ®æ²¡æœ‰è¢«ä¿å­˜ï¼Œå°±åƒè¡Œè½¦è®°å½•ä»ªå‡ºæ•…éšœï¼ŒæŸæ®µæ—¶é—´çš„è¡Œé©¶è®°å½•ç¼ºå¤±äº†ã€‚

### 4.2 æ•°æ®ä¸¢å¤±çš„å¸¸è§åŸå› 


**ğŸ”¸ å­˜å‚¨ç©ºé—´ä¸è¶³**
```bash
# æ£€æŸ¥ç›‘æ§æ•°æ®å­˜å‚¨ç©ºé—´
df -h /var/lib/prometheus
df -h /var/lib/grafana

# æ¸…ç†è¿‡æœŸæ•°æ®
prometheus --storage.tsdb.retention.time=30d
```

**ğŸ”¸ ç›‘æ§æœåŠ¡é‡å¯**
```bash
# æ£€æŸ¥æœåŠ¡é‡å¯å†å²
journalctl -u prometheus | grep -i restart
journalctl -u grafana-server | grep -i restart
```

### 4.3 æ•°æ®æ¢å¤ç­–ç•¥


**ğŸ”¸ ä»å¤‡ä»½æ¢å¤**
```bash
# æ¢å¤Prometheusæ•°æ®
systemctl stop prometheus
cp -r /backup/prometheus/data/* /var/lib/prometheus/
systemctl start prometheus
```

**ğŸ”¸ ä»å…¶ä»–ç›‘æ§èŠ‚ç‚¹åŒæ­¥**
```bash
# å¦‚æœæœ‰å¤šä¸ªç›‘æ§èŠ‚ç‚¹ï¼Œå¯ä»¥ä»å…¶ä»–èŠ‚ç‚¹å¤åˆ¶æ•°æ®
rsync -av backup-node:/var/lib/prometheus/data/ /var/lib/prometheus/data/
```

### 4.4 æ•°æ®ä¸¢å¤±é¢„é˜²


**ğŸ”¸ å®šæœŸå¤‡ä»½ç­–ç•¥**
```bash
#!/bin/bash
# ç›‘æ§æ•°æ®å¤‡ä»½è„šæœ¬
BACKUP_DIR="/backup/prometheus/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR
tar -czf $BACKUP_DIR/prometheus-data.tar.gz /var/lib/prometheus/data/
```

**ğŸ”¸ å­˜å‚¨ç©ºé—´ç›‘æ§**
```yaml
# æ·»åŠ ç£ç›˜ç©ºé—´å‘Šè­¦
- alert: MonitoringDiskSpaceLow
  expr: (node_filesystem_avail_bytes / node_filesystem_size_bytes) < 0.1
  labels:
    severity: warning
  annotations:
    summary: "ç›‘æ§ç³»ç»Ÿç£ç›˜ç©ºé—´ä¸è¶³"
```

---

## 5. âš¡ æ€§èƒ½ç›‘æ§è°ƒä¼˜


### 5.1 ç›‘æ§è°ƒä¼˜çš„æ„ä¹‰


**ç®€å•ç†è§£**ï¼šæ€§èƒ½ç›‘æ§è°ƒä¼˜å°±æ˜¯ä¼˜åŒ–ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„æ€§èƒ½ï¼Œç¡®ä¿ç›‘æ§å·¥å…·ä¸ä¼šæˆä¸ºç³»ç»Ÿçš„è´Ÿæ‹…ï¼Œå°±åƒç¡®ä¿ä½“æ£€è®¾å¤‡ä¸ä¼šå½±å“èº«ä½“å¥åº·ä¸€æ ·ã€‚

### 5.2 ç›‘æ§æ€§èƒ½é—®é¢˜è¯†åˆ«


**ğŸ”¸ ç›‘æ§å·¥å…·èµ„æºå ç”¨è¿‡é«˜**
```bash
# æ£€æŸ¥ç›‘æ§å·¥å…·CPUå’Œå†…å­˜ä½¿ç”¨
top -p $(pgrep prometheus)
top -p $(pgrep grafana-server)

# æŸ¥çœ‹ç›‘æ§å·¥å…·IOä½¿ç”¨æƒ…å†µ
iotop -p $(pgrep prometheus)
```

**ğŸ”¸ ç›‘æ§æŸ¥è¯¢å“åº”æ…¢**
```sql
-- æ£€æŸ¥ç›‘æ§æŸ¥è¯¢å¯¹MySQLçš„å½±å“
SHOW PROCESSLIST;

-- æŸ¥çœ‹ç›‘æ§ç›¸å…³çš„æ…¢æŸ¥è¯¢
SELECT * FROM mysql.slow_log 
WHERE user_host LIKE '%monitor_user%' 
ORDER BY start_time DESC LIMIT 10;
```

### 5.3 é‡‡é›†é¢‘ç‡ä¼˜åŒ–


**ğŸ”¸ ä¸åŒæŒ‡æ ‡é‡‡ç”¨ä¸åŒé¢‘ç‡**
```yaml
# é«˜é¢‘é‡‡é›†å…³é”®æŒ‡æ ‡
scrape_configs:
  - job_name: 'mysql-critical'
    static_configs:
      - targets: ['mysql:9104']
    scrape_interval: 15s
    metrics_path: /metrics
    params:
      collect[]: ['global_status', 'processlist']

# ä½é¢‘é‡‡é›†éå…³é”®æŒ‡æ ‡  
  - job_name: 'mysql-extended'
    static_configs:
      - targets: ['mysql:9104']
    scrape_interval: 60s
    params:
      collect[]: ['info_schema', 'perf_schema']
```

### 5.4 æŸ¥è¯¢ä¼˜åŒ–


**ğŸ”¸ ä¼˜åŒ–ç›‘æ§æŸ¥è¯¢è¯­å¥**
```sql
-- é¿å…å…¨è¡¨æ‰«æçš„ç›‘æ§æŸ¥è¯¢
-- ä¸å¥½çš„æŸ¥è¯¢
SELECT * FROM information_schema.tables;

-- ä¼˜åŒ–åçš„æŸ¥è¯¢
SELECT 
    table_schema,
    COUNT(*) as table_count,
    SUM(data_length + index_length) as total_size
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema')
GROUP BY table_schema;
```

---

## 6. ğŸ”§ ç›‘æ§ç»„ä»¶æ•…éšœå¤„ç†


### 6.1 å¸¸è§ç›‘æ§ç»„ä»¶


**ç»„ä»¶æ¶æ„å›¾**ï¼š
```
MySQLæ•°æ®åº“ â†’ Exporter â†’ Prometheus â†’ Grafana â†’ å‘Šè­¦ç³»ç»Ÿ
     â†“           â†“          â†“           â†“         â†“
   æ•°æ®æº     æ•°æ®æ”¶é›†    æ•°æ®å­˜å‚¨    æ•°æ®å±•ç¤º   å‘Šè­¦é€šçŸ¥
```

### 6.2 å„ç»„ä»¶æ•…éšœå¤„ç†


**ğŸ”¸ MySQL Exporteræ•…éšœ**
```bash
# æ£€æŸ¥exporterçŠ¶æ€
curl http://localhost:9104/metrics

# é‡å¯exporter
systemctl restart mysqld_exporter

# æŸ¥çœ‹exporteræ—¥å¿—
journalctl -u mysqld_exporter -f
```

**ğŸ”¸ Prometheusæ•…éšœ**
```bash
# æ£€æŸ¥Prometheusé…ç½®
prometheus --config.file=/etc/prometheus/prometheus.yml --check-config

# é‡æ–°åŠ è½½é…ç½®
curl -X POST http://localhost:9090/-/reload

# æŸ¥çœ‹PrometheusçŠ¶æ€
curl http://localhost:9090/-/healthy
```

**ğŸ”¸ Grafanaæ•…éšœ**
```bash
# æ£€æŸ¥Grafanaé…ç½®
grafana-cli admin reset-admin-password admin

# é‡å¯Grafana
systemctl restart grafana-server

# æ£€æŸ¥Grafanaæ—¥å¿—
tail -f /var/log/grafana/grafana.log
```

### 6.3 ç»„ä»¶é€šä¿¡æ£€æŸ¥


**ğŸ”¸ æ£€æŸ¥ç»„ä»¶é—´è¿é€šæ€§**
```bash
# æ£€æŸ¥Prometheusæ˜¯å¦èƒ½è®¿é—®MySQL Exporter
curl http://exporter-host:9104/metrics

# æ£€æŸ¥Grafanaæ˜¯å¦èƒ½è®¿é—®Prometheus
curl http://prometheus-host:9090/api/v1/status/config
```

---

## 7. âœ… ç›‘æ§æ•°æ®ä¸€è‡´æ€§æ ¡éªŒ


### 7.1 æ•°æ®ä¸€è‡´æ€§çš„é‡è¦æ€§


**ç®€å•ç†è§£**ï¼šæ•°æ®ä¸€è‡´æ€§æ ¡éªŒå°±æ˜¯ç¡®ä¿ç›‘æ§ç³»ç»Ÿæ˜¾ç¤ºçš„æ•°æ®å’ŒMySQLå®é™…çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œå°±åƒç¡®ä¿æ¸©åº¦è®¡æ˜¾ç¤ºçš„æ¸©åº¦å’Œå®é™…æ¸©åº¦ç›¸ç¬¦ã€‚

### 7.2 ä¸€è‡´æ€§æ ¡éªŒæ–¹æ³•


**ğŸ”¸ å¯¹æ¯”å…³é”®æŒ‡æ ‡**
```sql
-- åœ¨MySQLä¸­æŸ¥è¯¢å®é™…å€¼
SELECT VARIABLE_VALUE as actual_connections
FROM performance_schema.global_status 
WHERE VARIABLE_NAME = 'Threads_connected';

-- åœ¨ç›‘æ§ç³»ç»Ÿä¸­æŸ¥è¯¢å¯¹åº”å€¼
-- ä¸¤è€…åº”è¯¥åŸºæœ¬ä¸€è‡´ï¼ˆå…è®¸å°èŒƒå›´æ—¶é—´å·®ï¼‰
```

**ğŸ”¸ æ ¡éªŒè„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# æ•°æ®ä¸€è‡´æ€§æ ¡éªŒè„šæœ¬

# ä»MySQLè·å–è¿æ¥æ•°
MYSQL_CONN=$(mysql -u monitor_user -p -e "SHOW STATUS LIKE 'Threads_connected';" | tail -n 1 | awk '{print $2}')

# ä»Prometheusè·å–è¿æ¥æ•°
PROM_CONN=$(curl -s 'http://localhost:9090/api/v1/query?query=mysql_global_status_threads_connected' | jq -r '.data.result[0].value[1]')

# æ¯”è¾ƒå·®å¼‚
DIFF=$(echo "$MYSQL_CONN - $PROM_CONN" | bc)
echo "MySQLè¿æ¥æ•°: $MYSQL_CONN"
echo "ç›‘æ§æ˜¾ç¤ºè¿æ¥æ•°: $PROM_CONN" 
echo "å·®å¼‚: $DIFF"
```

### 7.3 ä¸€è‡´æ€§é—®é¢˜å¤„ç†


**ğŸ”¸ æ—¶é—´åŒæ­¥é—®é¢˜**
```bash
# æ£€æŸ¥å„æœåŠ¡å™¨æ—¶é—´åŒæ­¥
ntpdate -q ntp.aliyun.com

# åŒæ­¥æ—¶é—´
ntpdate ntp.aliyun.com
```

**ğŸ”¸ é‡‡é›†å»¶è¿Ÿé—®é¢˜**
```yaml
# è°ƒæ•´é‡‡é›†å’ŒæŸ¥è¯¢æ—¶é—´çª—å£
scrape_interval: 15s
evaluation_interval: 15s
```

---

## 8. ğŸ›¡ï¸ æ•…éšœé¢„é˜²æœºåˆ¶


### 8.1 é¢„é˜²æ€§ç›‘æ§


**ç›‘æ§ç›‘æ§ç³»ç»Ÿæœ¬èº«**ï¼š
```yaml
# ç›‘æ§Prometheusè‡ªèº«å¥åº·çŠ¶æ€
- alert: PrometheusDown
  expr: up{job="prometheus"} == 0
  labels:
    severity: critical
  annotations:
    summary: "Prometheusç›‘æ§æœåŠ¡å®•æœº"

# ç›‘æ§æ•°æ®é‡‡é›†çŠ¶æ€
- alert: MySQLExporterDown
  expr: up{job="mysql"} == 0
  labels:
    severity: warning
  annotations:
    summary: "MySQLæ•°æ®é‡‡é›†å¼‚å¸¸"
```

### 8.2 è‡ªåŠ¨åŒ–æ¢å¤æœºåˆ¶


**ğŸ”¸ æœåŠ¡è‡ªåŠ¨é‡å¯**
```bash
# é…ç½®systemdè‡ªåŠ¨é‡å¯
[Unit]
Description=Prometheus
After=network.target

[Service]
Type=simple
Restart=always
RestartSec=10
ExecStart=/usr/local/bin/prometheus

[Install]
WantedBy=multi-user.target
```

**ğŸ”¸ å¥åº·æ£€æŸ¥è„šæœ¬**
```bash
#!/bin/bash
# ç›‘æ§ç»„ä»¶å¥åº·æ£€æŸ¥è„šæœ¬

check_service() {
    service_name=$1
    if ! systemctl is-active --quiet $service_name; then
        echo "$service_nameæœåŠ¡å¼‚å¸¸ï¼Œå°è¯•é‡å¯"
        systemctl restart $service_name
        sleep 10
        if systemctl is-active --quiet $service_name; then
            echo "$service_nameæœåŠ¡é‡å¯æˆåŠŸ"
        else
            echo "$service_nameæœåŠ¡é‡å¯å¤±è´¥ï¼Œéœ€è¦äººå·¥å¤„ç†"
        fi
    fi
}

check_service prometheus
check_service grafana-server
check_service mysqld_exporter
```

### 8.3 å®¹é‡è§„åˆ’


**ğŸ”¸ å­˜å‚¨å®¹é‡è§„åˆ’**
```bash
# è®¡ç®—ç›‘æ§æ•°æ®å­˜å‚¨éœ€æ±‚
# å‡è®¾ï¼š1000ä¸ªæŒ‡æ ‡ï¼Œ30ç§’é‡‡é›†ä¸€æ¬¡ï¼Œä¿ç•™30å¤©
# ä¼°ç®—ï¼š1000 * (24*3600/30) * 30 * 8å­—èŠ‚ â‰ˆ 700MB
```

**ğŸ”¸ æ€§èƒ½å®¹é‡è§„åˆ’**
```
ç›‘æ§ç›®æ ‡æ•°é‡ï¼š< 100ä¸ªMySQLå®ä¾‹
é‡‡é›†æŒ‡æ ‡æ•°é‡ï¼š< 10000ä¸ªæŒ‡æ ‡
æŸ¥è¯¢å¹¶å‘æ•°ï¼š< 50ä¸ªå¹¶å‘æŸ¥è¯¢
æ•°æ®ä¿ç•™å‘¨æœŸï¼š30å¤©
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§æ•…éšœå®šä½ï¼šç³»ç»ŸåŒ–æ’æŸ¥ç›‘æ§å·¥å…·æœ¬èº«çš„é—®é¢˜
ğŸ”¸ æ•°æ®é‡‡é›†å¼‚å¸¸ï¼šç¡®ä¿ç›‘æ§æ•°æ®èƒ½å¤Ÿæ­£å¸¸æ”¶é›†å’Œä¼ è¾“
ğŸ”¸ å‘Šè­¦é£æš´å¤„ç†ï¼šé¿å…å¤§é‡æ— ç”¨å‘Šè­¦å½±å“çœŸæ­£é—®é¢˜çš„å‘ç°
ğŸ”¸ æ•°æ®ä¸¢å¤±æ¢å¤ï¼šå»ºç«‹æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
ğŸ”¸ æ€§èƒ½è°ƒä¼˜ï¼šä¼˜åŒ–ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„æ€§èƒ½è¡¨ç°
ğŸ”¸ ç»„ä»¶æ•…éšœå¤„ç†ï¼šæŒæ¡å„ç›‘æ§ç»„ä»¶çš„æ•…éšœæ’æŸ¥æ–¹æ³•
ğŸ”¸ ä¸€è‡´æ€§æ ¡éªŒï¼šç¡®ä¿ç›‘æ§æ•°æ®çš„å‡†ç¡®æ€§
ğŸ”¸ é¢„é˜²æœºåˆ¶ï¼šå»ºç«‹ä¸»åŠ¨é¢„é˜²å’Œè‡ªåŠ¨æ¢å¤èƒ½åŠ›
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§ç³»ç»Ÿçš„é‡è¦æ€§**
```
ç›‘æ§ç³»ç»Ÿæ˜¯æ•°æ®åº“è¿ç»´çš„çœ¼ç›å’Œè€³æœµ
ç›‘æ§ç³»ç»Ÿæœ¬èº«çš„å¯é æ€§ç›´æ¥å½±å“è¿ç»´æ•ˆç‡
ç›‘æ§æ•…éšœå¯èƒ½å¯¼è‡´é”™è¿‡çœŸæ­£çš„æ•°æ®åº“é—®é¢˜
```

**ğŸ”¹ æ•…éšœå¤„ç†çš„åŸºæœ¬åŸåˆ™**
```
å¿«é€Ÿå“åº”ï¼šå°½å¿«æ¢å¤ç›‘æ§èƒ½åŠ›
æ ¹æœ¬è§£å†³ï¼šæ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œé¿å…é‡å¤æ•…éšœ
é¢„é˜²ä¸ºä¸»ï¼šå»ºç«‹é¢„é˜²æœºåˆ¶æ¯”äº‹åå¤„ç†æ›´é‡è¦
```

**ğŸ”¹ æ€§èƒ½å¹³è¡¡**
```
ç›‘æ§ç²¾åº¦ vs ç³»ç»Ÿå¼€é”€ï¼šæ‰¾åˆ°åˆé€‚çš„å¹³è¡¡ç‚¹
å®æ—¶æ€§ vs èµ„æºæ¶ˆè€—ï¼šæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é‡‡é›†é¢‘ç‡
æ•°æ®å®Œæ•´æ€§ vs å­˜å‚¨æˆæœ¬ï¼šåˆç†è®¾ç½®æ•°æ®ä¿ç•™ç­–ç•¥
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


- **å¿«é€Ÿæ•…éšœå®šä½**ï¼šç³»ç»ŸåŒ–çš„æ’æŸ¥æµç¨‹æé«˜æ•ˆç‡
- **å‡å°‘è¯¯æŠ¥å‘Šè­¦**ï¼šé€šè¿‡å‘Šè­¦ä¼˜åŒ–å‡å°‘å¹²æ‰°
- **æ•°æ®å¯é æ€§**ï¼šç¡®ä¿ç›‘æ§æ•°æ®çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šé€šè¿‡é¢„é˜²æœºåˆ¶æé«˜æ•´ä½“ç¨³å®šæ€§
- **è¿ç»´æ•ˆç‡**ï¼šè‡ªåŠ¨åŒ–å¤„ç†å‡å°‘äººå·¥å¹²é¢„

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç›‘æ§ç³»ç»Ÿè¦ç›‘æ§ï¼Œæ•…éšœå®šä½æœ‰ç« æ³•
- æ•°æ®é‡‡é›†è¦ç¨³å®šï¼Œå‘Šè­¦é£æš´è¦æ§åˆ¶  
- æ€§èƒ½è°ƒä¼˜å¾ˆé‡è¦ï¼Œé¢„é˜²èƒœè¿‡æ²»ç–—å¥½
- ä¸€è‡´æ€§æ ¡éªŒä¸èƒ½å°‘ï¼Œè‡ªåŠ¨æ¢å¤æ˜¯ç‹é“