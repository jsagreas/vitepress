---
title: 2ã€äº‹ä»¶ç›‘æ§é…ç½®
---
## ğŸ“š ç›®å½•

1. [äº‹ä»¶ç›‘æ§åŸºç¡€æ¦‚å¿µ](#1-äº‹ä»¶ç›‘æ§åŸºç¡€æ¦‚å¿µ)
2. [Instrumentsç›‘æ§è®¾å¤‡é…ç½®](#2-Instrumentsç›‘æ§è®¾å¤‡é…ç½®)
3. [Consumersæ¶ˆè´¹è€…é…ç½®](#3-Consumersæ¶ˆè´¹è€…é…ç½®)
4. [äº‹ä»¶è¿‡æ»¤ä¸é‡‡æ ·é…ç½®](#4-äº‹ä»¶è¿‡æ»¤ä¸é‡‡æ ·é…ç½®)
5. [å†…å­˜ä¸æ€§èƒ½é…ç½®](#5-å†…å­˜ä¸æ€§èƒ½é…ç½®)
6. [åŠ¨æ€é…ç½®ç®¡ç†](#6-åŠ¨æ€é…ç½®ç®¡ç†)
7. [é…ç½®æ¨¡æ¿ä¸æœ€ä½³å®è·µ](#7-é…ç½®æ¨¡æ¿ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ äº‹ä»¶ç›‘æ§åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Performance Schemaäº‹ä»¶ç›‘æ§


**ç®€å•ç†è§£**ï¼šPerformance Schemaå°±åƒæ˜¯MySQLæ•°æ®åº“çš„"ç›‘æ§æ‘„åƒå¤´ç³»ç»Ÿ"

```
ç°å®æ¯”å–»ï¼š
å•†åœºç›‘æ§ç³»ç»Ÿ          MySQL Performance Schema
â”œâ”€â”€ æ‘„åƒå¤´(Instruments) â† ç›‘æ§å„ç§æ•°æ®åº“æ“ä½œ
â”œâ”€â”€ å½•åƒå­˜å‚¨(Consumers) â† å†³å®šç›‘æ§æ•°æ®å­˜å‚¨åˆ°å“ªé‡Œ
â”œâ”€â”€ ç›‘æ§è§„åˆ™(Filters)   â† å†³å®šç›‘æ§ä»€ä¹ˆã€å¿½ç•¥ä»€ä¹ˆ
â””â”€â”€ å­˜å‚¨å®¹é‡(Memory)    â† ç›‘æ§æ•°æ®çš„å­˜å‚¨é™åˆ¶
```

### 1.2 æ ¸å¿ƒç»„ä»¶å…³ç³»


```
äº‹ä»¶ç›‘æ§å·¥ä½œæµç¨‹ï¼š
æ•°æ®åº“æ“ä½œ â†’ Instruments(æ£€æµ‹å™¨) â†’ Events(äº‹ä»¶) â†’ Consumers(æ¶ˆè´¹è€…) â†’ å­˜å‚¨è¡¨

å…·ä½“ç¤ºä¾‹ï¼š
SQLæŸ¥è¯¢ â†’ statement/sql/select â†’ SQLæ‰§è¡Œäº‹ä»¶ â†’ events_statements_current â†’ å­˜å‚¨åˆ°è¡¨ä¸­
```

**ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µè§£é‡Š**ï¼š
- **Instruments**ï¼šç›‘æ§è®¾å¤‡ï¼Œè´Ÿè´£æ£€æµ‹å’Œè®°å½•å„ç§æ•°æ®åº“æ´»åŠ¨
- **Events**ï¼šå…·ä½“çš„ç›‘æ§äº‹ä»¶ï¼Œæ¯”å¦‚ä¸€æ¬¡SQLæŸ¥è¯¢ã€ä¸€æ¬¡é”ç­‰å¾…
- **Consumers**ï¼šäº‹ä»¶æ¶ˆè´¹è€…ï¼Œå†³å®šç›‘æ§æ•°æ®å­˜å‚¨çš„ä½ç½®å’Œæ–¹å¼
- **Setup Tables**ï¼šé…ç½®è¡¨ï¼Œç”¨æ¥æ§åˆ¶ç›‘æ§è¡Œä¸º

---

## 2. ğŸ”§ Instrumentsç›‘æ§è®¾å¤‡é…ç½®


### 2.1 InstrumentsåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯Instruments**ï¼šå°±åƒä¸åŒç±»å‹çš„ç›‘æ§è®¾å¤‡ï¼Œä¸“é—¨ç›‘æ§ç‰¹å®šç±»å‹çš„æ•°æ®åº“æ´»åŠ¨

```
Instrumentsåˆ†ç±»ç»“æ„ï¼š
â”œâ”€â”€ wait/              â† ç­‰å¾…äº‹ä»¶ç›‘æ§
â”‚   â”œâ”€â”€ io/           â† ç£ç›˜IOç­‰å¾…
â”‚   â”œâ”€â”€ lock/         â† é”ç­‰å¾…
â”‚   â””â”€â”€ synch/        â† åŒæ­¥ç­‰å¾…
â”œâ”€â”€ statement/        â† SQLè¯­å¥ç›‘æ§
â”œâ”€â”€ stage/            â† SQLæ‰§è¡Œé˜¶æ®µç›‘æ§
â””â”€â”€ memory/           â† å†…å­˜ä½¿ç”¨ç›‘æ§
```

### 2.2 æŸ¥çœ‹å’Œç®¡ç†Instruments


**æŸ¥çœ‹å½“å‰InstrumentsçŠ¶æ€**ï¼š
```sql
-- æŸ¥çœ‹æ‰€æœ‰Instruments
SELECT NAME, ENABLED, TIMED 
FROM performance_schema.setup_instruments 
LIMIT 10;

-- æŸ¥çœ‹ç‰¹å®šç±»å‹çš„Instruments
SELECT NAME, ENABLED, TIMED 
FROM performance_schema.setup_instruments 
WHERE NAME LIKE 'statement/sql/%';
```

**å¯ç”¨/ç¦ç”¨Instruments**ï¼š
```sql
-- å¯ç”¨SQLè¯­å¥ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE 'statement/sql/%';

-- ç¦ç”¨å†…å­˜ç›‘æ§ï¼ˆå‡å°‘æ€§èƒ½å½±å“ï¼‰
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'NO' 
WHERE NAME LIKE 'memory/%';
```

### 2.3 Instrumentsé…ç½®ç­–ç•¥


**ğŸ¯ æŒ‰ä¸šåŠ¡éœ€æ±‚é…ç½®**ï¼š

```sql
-- 1. åŸºç¡€ç›‘æ§é…ç½®ï¼ˆæ¨èæ–°æ‰‹ï¼‰
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME IN (
    'statement/sql/select',
    'statement/sql/insert', 
    'statement/sql/update',
    'statement/sql/delete'
);

-- 2. æ€§èƒ½é—®é¢˜è¯Šæ–­é…ç½®
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE 'wait/io/file/%' 
   OR NAME LIKE 'wait/lock/%';

-- 3. å†…å­˜ä½¿ç”¨åˆ†æé…ç½®
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES' 
WHERE NAME LIKE 'memory/sql/%' 
   OR NAME LIKE 'memory/innodb/%';
```

> ğŸ’¡ **é…ç½®å»ºè®®**ï¼šåˆšå¼€å§‹å»ºè®®åªå¯ç”¨åŸºç¡€çš„SQLè¯­å¥ç›‘æ§ï¼Œé¿å…å¯¹æ€§èƒ½é€ æˆå¤ªå¤§å½±å“

---

## 3. ğŸ“Š Consumersæ¶ˆè´¹è€…é…ç½®


### 3.1 Consumersæ¦‚å¿µç†è§£


**ä»€ä¹ˆæ˜¯Consumers**ï¼šå†³å®šç›‘æ§åˆ°çš„æ•°æ®å­˜å‚¨åœ¨å“ªäº›è¡¨ä¸­ï¼Œå°±åƒå†³å®šç›‘æ§å½•åƒä¿å­˜åœ¨å“ªä¸ªç¡¬ç›˜é‡Œ

```
Consumersç±»å‹ï¼š
â”œâ”€â”€ events_statements_current      â† å½“å‰æ­£åœ¨æ‰§è¡Œçš„SQL
â”œâ”€â”€ events_statements_history      â† æ¯ä¸ªè¿æ¥çš„SQLå†å²
â”œâ”€â”€ events_statements_history_long â† å…¨å±€SQLå†å²
â”œâ”€â”€ events_waits_current          â† å½“å‰ç­‰å¾…äº‹ä»¶  
â”œâ”€â”€ events_waits_history          â† ç­‰å¾…äº‹ä»¶å†å²
â””â”€â”€ statements_digest             â† SQLæ‘˜è¦ç»Ÿè®¡
```

### 3.2 Consumersé…ç½®ç®¡ç†


**æŸ¥çœ‹ConsumersçŠ¶æ€**ï¼š
```sql
-- æŸ¥çœ‹æ‰€æœ‰Consumersé…ç½®
SELECT NAME, ENABLED 
FROM performance_schema.setup_consumers;
```

**å¸¸ç”¨Consumersé…ç½®**ï¼š
```sql
-- å¯ç”¨SQLè¯­å¥ç›‘æ§
UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME IN (
    'events_statements_current',
    'events_statements_history',
    'statements_digest'
);

-- å¯ç”¨ç­‰å¾…äº‹ä»¶ç›‘æ§
UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME IN (
    'events_waits_current',
    'events_waits_history'
);
```

### 3.3 Consumersé…ç½®ç­–ç•¥


**ğŸ“‹ ä¸åŒåœºæ™¯çš„é…ç½®ç»„åˆ**ï¼š

| ç›‘æ§åœºæ™¯ | **æ¨èå¯ç”¨çš„Consumers** | **è¯´æ˜** |
|---------|----------------------|---------|
| **åŸºç¡€ç›‘æ§** | `events_statements_current`<br>`statements_digest` | `è½»é‡çº§ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ` |
| **æ€§èƒ½è°ƒä¼˜** | `events_statements_history`<br>`events_waits_history` | `è¯¦ç»†å†å²ï¼Œä¾¿äºåˆ†æ` |
| **é—®é¢˜è¯Šæ–­** | `events_statements_history_long`<br>`events_waits_history_long` | `å…¨é‡æ•°æ®ï¼Œæ·±åº¦åˆ†æ` |

> âš ï¸ **æ³¨æ„**ï¼šhistory_longç±»å‹çš„consumersä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è°¨æ…ä½¿ç”¨

---

## 4. ğŸ›ï¸ äº‹ä»¶è¿‡æ»¤ä¸é‡‡æ ·é…ç½®


### 4.1 äº‹ä»¶è¿‡æ»¤åŸºæœ¬æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦è¿‡æ»¤**ï¼šæ•°æ®åº“æ¯ç§’äº§ç”Ÿæˆåƒä¸Šä¸‡ä¸ªäº‹ä»¶ï¼Œå…¨éƒ¨ç›‘æ§ä¼šæ‹–å®æ€§èƒ½ï¼Œéœ€è¦æœ‰é€‰æ‹©åœ°ç›‘æ§

### 4.2 åŸºäºå¯¹è±¡çš„è¿‡æ»¤


**é…ç½®ç›‘æ§çš„æ•°æ®åº“å’Œè¡¨**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰å¯¹è±¡è¿‡æ»¤é…ç½®
SELECT OBJECT_TYPE, OBJECT_SCHEMA, OBJECT_NAME, ENABLED 
FROM performance_schema.setup_objects;

-- åªç›‘æ§ç‰¹å®šæ•°æ®åº“
UPDATE performance_schema.setup_objects 
SET ENABLED = 'NO';

INSERT INTO performance_schema.setup_objects 
(OBJECT_TYPE, OBJECT_SCHEMA, OBJECT_NAME, ENABLED, TIMED) 
VALUES ('TABLE', 'myapp', '%', 'YES', 'YES');
```

**é…ç½®ç›‘æ§çš„ç”¨æˆ·è¿æ¥**ï¼š
```sql
-- æŸ¥çœ‹ç”¨æˆ·ç›‘æ§é…ç½®
SELECT USER, HOST, ENABLED 
FROM performance_schema.setup_actors;

-- åªç›‘æ§ç‰¹å®šç”¨æˆ·
DELETE FROM performance_schema.setup_actors;

INSERT INTO performance_schema.setup_actors 
(USER, HOST, ROLE, ENABLED, HISTORY) 
VALUES ('appuser', '%', '%', 'YES', 'YES');
```

### 4.3 é‡‡æ ·ç‡é…ç½®


**å†…å­˜é™åˆ¶é‡‡æ ·**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰å†…å­˜é…ç½®
SHOW VARIABLES LIKE 'performance_schema%';

-- åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é‡‡æ ·
[mysqld]
performance_schema_events_statements_history_size = 100
performance_schema_events_waits_history_size = 100
performance_schema_digest_max_sql_text_length = 2048
```

### 4.4 åŠ¨æ€è¿‡æ»¤ç¤ºä¾‹


```sql
-- è¿‡æ»¤è§„åˆ™ï¼šåªç›‘æ§æ…¢æŸ¥è¯¢
-- 1. å…ˆç¦ç”¨æ‰€æœ‰è¯­å¥ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'NO' 
WHERE NAME LIKE 'statement/%';

-- 2. é€šè¿‡å®šæœŸæ¸…ç†å¿«é€ŸæŸ¥è¯¢æ•°æ®å®ç°"é‡‡æ ·"
CREATE EVENT clean_fast_queries 
ON SCHEDULE EVERY 30 SECOND 
DO 
  DELETE FROM performance_schema.events_statements_history 
  WHERE TIMER_WAIT < 1000000000; -- å°äº1ç§’çš„æŸ¥è¯¢
```

---

## 5. ğŸ’¾ å†…å­˜ä¸æ€§èƒ½é…ç½®


### 5.1 å†…å­˜é…ç½®å‚æ•°


**æ ¸å¿ƒå†…å­˜å‚æ•°ç†è§£**ï¼š

```
Performance Schemaå†…å­˜åˆ†é…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ setup_instruments           â”‚ â† ç›‘æ§è®¾å¤‡é…ç½®è¡¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ events_statements_current   â”‚ â† å½“å‰è¯­å¥äº‹ä»¶(æŒ‰è¿æ¥)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ events_statements_history   â”‚ â† è¯­å¥å†å²(æ¯è¿æ¥Næ¡)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ events_statements_history_long â”‚ â† å…¨å±€è¯­å¥å†å²(Mæ¡)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®é…ç½®å‚æ•°**ï¼š
```ini
[mysqld]
# åŸºç¡€é…ç½®
performance_schema = ON
performance_schema_max_thread_instances = 1000

# è¯­å¥ç›‘æ§é…ç½®  
performance_schema_events_statements_history_size = 20
performance_schema_events_statements_history_long_size = 1000

# ç­‰å¾…äº‹ä»¶é…ç½®
performance_schema_events_waits_history_size = 20
performance_schema_events_waits_history_long_size = 1000

# æ‘˜è¦é…ç½®
performance_schema_digest_max_sql_text_length = 2048
```

### 5.2 æ€§èƒ½å½±å“è¯„ä¼°


**ğŸ“Š ä¸åŒé…ç½®çš„æ€§èƒ½å½±å“**ï¼š

| é…ç½®çº§åˆ« | **ç›‘æ§èŒƒå›´** | **æ€§èƒ½å½±å“** | **å†…å­˜å ç”¨** |
|---------|-------------|-------------|-------------|
| **æœ€å°** | `ä»…statements_digest` | `< 2%` | `~50MB` |
| **æ ‡å‡†** | `current + digest` | `3-5%` | `~100MB` |
| **è¯¦ç»†** | `history + waits` | `5-10%` | `~200MB` |
| **å®Œæ•´** | `æ‰€æœ‰consumers` | `10-15%` | `~500MB` |

### 5.3 å†…å­˜ä½¿ç”¨ç›‘æ§


**æ£€æŸ¥å½“å‰å†…å­˜ä½¿ç”¨**ï¼š
```sql
-- æŸ¥çœ‹Performance Schemaå†…å­˜ä½¿ç”¨
SELECT EVENT_NAME, COUNT_ALLOC, COUNT_FREE, 
       HIGH_COUNT_USED, HIGH_NUMBER_OF_BYTES_USED
FROM performance_schema.memory_summary_global_by_event_name 
WHERE EVENT_NAME LIKE 'memory/performance_schema/%' 
ORDER BY HIGH_NUMBER_OF_BYTES_USED DESC 
LIMIT 10;
```

---

## 6. ğŸ”„ åŠ¨æ€é…ç½®ç®¡ç†


### 6.1 è¿è¡Œæ—¶é…ç½®è°ƒæ•´


**å®æ—¶å¯ç”¨ç›‘æ§**ï¼š
```sql
-- ä¸´æ—¶å¯ç”¨æ…¢æŸ¥è¯¢ç›‘æ§
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME = 'statement/sql/select';

UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME = 'events_statements_current';
```

### 6.2 é…ç½®çƒ­æ›´æ–°æœºåˆ¶


**æ‰¹é‡é…ç½®æ›´æ–°**ï¼š
```sql
-- å­˜å‚¨è¿‡ç¨‹ï¼šä¸€é”®é…ç½®åŸºç¡€ç›‘æ§
DELIMITER //
CREATE PROCEDURE enable_basic_monitoring()
BEGIN
    -- å¯ç”¨åŸºç¡€instruments
    UPDATE performance_schema.setup_instruments 
    SET ENABLED = 'YES', TIMED = 'YES' 
    WHERE NAME LIKE 'statement/sql/%';
    
    -- å¯ç”¨åŸºç¡€consumers
    UPDATE performance_schema.setup_consumers 
    SET ENABLED = 'YES' 
    WHERE NAME IN ('events_statements_current', 'statements_digest');
    
    SELECT 'Basic monitoring enabled' AS status;
END //
DELIMITER ;

-- è°ƒç”¨é…ç½®
CALL enable_basic_monitoring();
```

### 6.3 é…ç½®çŠ¶æ€æ£€æŸ¥


**é…ç½®å†²çªæ£€æµ‹**ï¼š
```sql
-- æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
SELECT 
    i.NAME AS instrument_name,
    i.ENABLED AS instrument_enabled,
    c.NAME AS consumer_name,
    c.ENABLED AS consumer_enabled
FROM performance_schema.setup_instruments i
JOIN performance_schema.setup_consumers c
WHERE i.NAME LIKE 'statement/sql/select'
  AND c.NAME = 'events_statements_current';
```

---

## 7. ğŸ“‹ é…ç½®æ¨¡æ¿ä¸æœ€ä½³å®è·µ


### 7.1 é¢„è®¾é…ç½®æ¨¡æ¿


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒè½»é‡æ¨¡æ¿**ï¼š
```sql
-- 1. é‡ç½®æ‰€æœ‰é…ç½®
UPDATE performance_schema.setup_instruments SET ENABLED = 'NO';
UPDATE performance_schema.setup_consumers SET ENABLED = 'NO';

-- 2. å¯ç”¨æ ¸å¿ƒç›‘æ§
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME IN (
    'statement/sql/select',
    'statement/sql/insert', 
    'statement/sql/update',
    'statement/sql/delete'
);

UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME = 'statements_digest';
```

**ğŸ” é—®é¢˜è¯Šæ–­å¼ºåŒ–æ¨¡æ¿**ï¼š
```sql
-- å¯ç”¨è¯¦ç»†ç›‘æ§ï¼ˆä¸´æ—¶ä½¿ç”¨ï¼‰
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE 'wait/io/%' 
   OR NAME LIKE 'wait/lock/%'
   OR NAME LIKE 'statement/%';

UPDATE performance_schema.setup_consumers 
SET ENABLED = 'YES' 
WHERE NAME LIKE '%_current' 
   OR NAME LIKE '%_history';
```

### 7.2 é…ç½®ç®¡ç†æœ€ä½³å®è·µ


**ğŸ“ é…ç½®ç®¡ç†æµç¨‹**ï¼š

<details>
<summary>ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†é…ç½®æµç¨‹</summary>

```sql
-- 1. å¤‡ä»½å½“å‰é…ç½®
CREATE TABLE ps_instruments_backup AS 
SELECT * FROM performance_schema.setup_instruments;

CREATE TABLE ps_consumers_backup AS 
SELECT * FROM performance_schema.setup_consumers;

-- 2. åº”ç”¨æ–°é…ç½®
-- (å…·ä½“é…ç½®è¯­å¥)

-- 3. éªŒè¯é…ç½®æ•ˆæœ
SELECT COUNT(*) FROM performance_schema.events_statements_current;

-- 4. å¿…è¦æ—¶å›æ»šé…ç½®
UPDATE performance_schema.setup_instruments i
JOIN ps_instruments_backup b ON i.NAME = b.NAME
SET i.ENABLED = b.ENABLED, i.TIMED = b.TIMED;
```

</details>

**âš ï¸ é…ç½®æ³¨æ„äº‹é¡¹**ï¼š

> **ç”Ÿäº§ç¯å¢ƒé…ç½®åŸåˆ™**ï¼š
> - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é…ç½®æ•ˆæœ
> - ç›‘æ§å¯¹æ€§èƒ½çš„å½±å“ï¼Œå¿…è¦æ—¶åŠæ—¶å›æ»š
> - å®šæœŸæ¸…ç†å†å²æ•°æ®ï¼Œé¿å…å†…å­˜æº¢å‡º
> - æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´ç›‘æ§ç²’åº¦

### 7.3 å¸¸è§é…ç½®é—®é¢˜è§£å†³


**é—®é¢˜1ï¼šç›‘æ§æ•°æ®ä¸ºç©º**
```sql
-- æ£€æŸ¥é“¾è·¯ï¼šinstruments â†’ consumers â†’ data
SELECT 'Instruments' AS component, COUNT(*) AS enabled_count
FROM performance_schema.setup_instruments 
WHERE ENABLED = 'YES'
UNION ALL
SELECT 'Consumers', COUNT(*) 
FROM performance_schema.setup_consumers 
WHERE ENABLED = 'YES';
```

**é—®é¢˜2ï¼šæ€§èƒ½å½±å“è¿‡å¤§**
```sql
-- é™ä½ç›‘æ§ç²’åº¦
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'NO' 
WHERE NAME LIKE 'memory/%' 
   OR NAME LIKE 'wait/synch/%';
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Instrumentsï¼šç›‘æ§è®¾å¤‡ï¼Œå†³å®šç›‘æ§ä»€ä¹ˆç±»å‹çš„äº‹ä»¶
ğŸ”¸ Consumersï¼šæ•°æ®æ¶ˆè´¹è€…ï¼Œå†³å®šç›‘æ§æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œ  
ğŸ”¸ Eventsï¼šå…·ä½“çš„ç›‘æ§äº‹ä»¶è®°å½•
ğŸ”¸ Setup Tablesï¼šé…ç½®è¡¨ï¼Œæ§åˆ¶æ•´ä¸ªç›‘æ§è¡Œä¸º
ğŸ”¸ å†…å­˜é…ç½®ï¼šå†³å®šç›‘æ§æ•°æ®çš„å­˜å‚¨å®¹é‡å’Œæ€§èƒ½å½±å“
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§é“¾è·¯å…³ç³»**ï¼š
```
æ•°æ®åº“æ“ä½œ â†’ Instrumentsæ£€æµ‹ â†’ ç”ŸæˆEvents â†’ Consumerså­˜å‚¨ â†’ æŸ¥è¯¢åˆ†æ
           â†‘              â†‘             â†‘
         é…ç½®æ§åˆ¶        è¿‡æ»¤è§„åˆ™      å†…å­˜é™åˆ¶
```

**ğŸ”¹ é…ç½®ç­–ç•¥é€‰æ‹©**ï¼š
```
æ–°æ‰‹é˜¶æ®µï¼šåªå¯ç”¨statements_digestï¼Œå­¦ä¼šåŸºæœ¬æŸ¥è¯¢
è°ƒä¼˜é˜¶æ®µï¼šå¢åŠ currentçº§åˆ«ç›‘æ§ï¼Œåˆ†æå…·ä½“SQL
è¯Šæ–­é˜¶æ®µï¼šå¯ç”¨historyç›‘æ§ï¼Œæ·±å…¥åˆ†æé—®é¢˜
ä¸“å®¶é˜¶æ®µï¼šæŒ‰éœ€åŠ¨æ€è°ƒæ•´ï¼Œå¹³è¡¡ç›‘æ§ä¸æ€§èƒ½
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- **èµ·æ­¥é…ç½®**ï¼šåªç›‘æ§SQLè¯­å¥å’Œæ‘˜è¦ç»Ÿè®¡
- **æ¸è¿›å¢å¼º**ï¼šæ ¹æ®éœ€è¦é€æ­¥å¯ç”¨æ›´å¤šç›‘æ§é¡¹
- **å®šæœŸæ¸…ç†**ï¼šé¿å…å†å²æ•°æ®å ç”¨è¿‡å¤šå†…å­˜
- **æ€§èƒ½ç›‘æ§**ï¼šæŒç»­å…³æ³¨ç›‘æ§æœ¬èº«çš„æ€§èƒ½å½±å“

**ğŸ”§ æ•…éšœæ’æŸ¥æ—¶**ï¼š
- **é—®é¢˜å‘ç”Ÿæ—¶**ï¼šä¸´æ—¶å¯ç”¨è¯¦ç»†ç›‘æ§
- **åˆ†æå®Œæ¯•å**ï¼šåŠæ—¶æ¢å¤è½»é‡é…ç½®
- **é•¿æœŸç›‘æ§**ï¼šä¿æŒæ ¸å¿ƒæŒ‡æ ‡çš„æŒç»­ç›‘æ§

### 8.4 é…ç½®ä¼˜åŒ–åŸåˆ™


**ğŸ’¡ å¹³è¡¡ç›‘æ§ä¸æ€§èƒ½**ï¼š
```
ç›‘æ§ç²’åº¦ â†• æ€§èƒ½å½±å“
è¯¦ç»†ç›‘æ§ â†’ å½±å“è¾ƒå¤§ â†’ é—®é¢˜è¯Šæ–­æ—¶ä½¿ç”¨
åŸºç¡€ç›‘æ§ â†’ å½±å“å¾ˆå° â†’ æ—¥å¸¸ç›‘æ§ä½¿ç”¨
ç¦ç”¨ç›‘æ§ â†’ æ— å½±å“   â†’ ä¸å…³å¿ƒçš„åŠŸèƒ½
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Performance Schemaé…ç½®å°±æ˜¯åœ¨"ç›‘æ§è¦†ç›–é¢"å’Œ"æ€§èƒ½å½±å“"ä¹‹é—´æ‰¾å¹³è¡¡
- Instrumentsæ§åˆ¶"ç›‘æ§ä»€ä¹ˆ"ï¼ŒConsumersæ§åˆ¶"æ•°æ®å­˜å“ªé‡Œ"
- ç”Ÿäº§ç¯å¢ƒä»æœ€å°é…ç½®å¼€å§‹ï¼ŒæŒ‰éœ€é€æ­¥å¢å¼º
- é…ç½®å˜æ›´è¦è°¨æ…ï¼Œéšæ—¶å‡†å¤‡å›æ»šæ–¹æ¡ˆ