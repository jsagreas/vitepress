---
title: 1ã€MySQLå†…å­˜æ¶æ„è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [MySQLå†…å­˜ç®¡ç†åŸºç¡€](#1-mysqlå†…å­˜ç®¡ç†åŸºç¡€)
2. [å…¨å±€å†…å­˜åŒºåŸŸæ·±åº¦è§£æ](#2-å…¨å±€å†…å­˜åŒºåŸŸæ·±åº¦è§£æ)
3. [ä¼šè¯å†…å­˜åŒºåŸŸè¯¦è§£](#3-ä¼šè¯å†…å­˜åŒºåŸŸè¯¦è§£)
4. [Buffer Poolæ ¸å¿ƒæœºåˆ¶](#4-buffer-poolæ ¸å¿ƒæœºåˆ¶)
5. [å†…å­˜åˆ†é…ä¸ç®¡ç†æœºåˆ¶](#5-å†…å­˜åˆ†é…ä¸ç®¡ç†æœºåˆ¶)
6. [å†…å­˜ç›‘æ§ä¸ä¼˜åŒ–ç­–ç•¥](#6-å†…å­˜ç›‘æ§ä¸ä¼˜åŒ–ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ§  MySQLå†…å­˜ç®¡ç†åŸºç¡€


### 1.1 å†…å­˜ç®¡ç†çš„é‡è¦æ€§

MySQLçš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå†…å­˜çš„åˆç†ä½¿ç”¨ã€‚ç®€å•æ¥è¯´ï¼Œ**å†…å­˜å°±åƒæ•°æ®åº“çš„å·¥ä½œå°**ï¼Œå·¥ä½œå°è¶Šå¤§ã€è¶Šæœ‰åºï¼Œæ•°æ®åº“å¤„ç†é€Ÿåº¦å°±è¶Šå¿«ã€‚

**ğŸ’¡ ä¸ºä»€ä¹ˆå†…å­˜è¿™ä¹ˆé‡è¦ï¼Ÿ**
```
ç£ç›˜è¯»å–ï¼šè€—æ—¶10-15ms  â†  å¾ˆæ…¢ï¼Œåƒäººèµ°è·¯
å†…å­˜è¯»å–ï¼šè€—æ—¶0.1ms   â†  å¾ˆå¿«ï¼Œåƒåé£æœº

å·®è·ï¼šå†…å­˜æ¯”ç£ç›˜å¿«100-150å€ï¼
```

### 1.2 MySQLå†…å­˜æ¶æ„æ€»è§ˆ

MySQLå†…å­˜åˆ†ä¸ºä¸¤å¤§ç±»ï¼š**å…¨å±€å†…å­˜**ï¼ˆæ‰€æœ‰è¿æ¥å…±äº«ï¼‰å’Œ**ä¼šè¯å†…å­˜**ï¼ˆæ¯ä¸ªè¿æ¥ç‹¬æœ‰ï¼‰ã€‚

```
MySQLæœåŠ¡å™¨å†…å­˜å¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å…¨å±€å†…å­˜åŒºåŸŸ               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Buffer Pool  â”‚ â”‚Query Cache  â”‚   â”‚  â† æ‰€æœ‰ç”¨æˆ·å…±äº«
â”‚  â”‚(æ•°æ®é¡µç¼“å­˜) â”‚ â”‚(æŸ¥è¯¢ç¼“å­˜)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚InnoDBæ—¥å¿—   â”‚ â”‚äºŒè¿›åˆ¶æ—¥å¿—   â”‚   â”‚
â”‚  â”‚ç¼“å†²åŒº       â”‚ â”‚ç¼“å†²åŒº       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¼šè¯å†…å­˜åŒºåŸŸ               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚æ’åºç¼“å†²åŒº   â”‚ â”‚è¿æ¥ç¼“å†²åŒº   â”‚   â”‚  â† æ¯ä¸ªè¿æ¥ç‹¬æœ‰
â”‚  â”‚sort_buffer  â”‚ â”‚join_buffer  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚è¯»å–ç¼“å†²åŒº   â”‚ â”‚ä¸´æ—¶è¡¨ç©ºé—´   â”‚   â”‚
â”‚  â”‚read_buffer  â”‚ â”‚tmp_table    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å†…å­˜é…ç½®çš„åŸºæœ¬åŸåˆ™

- **ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼šæŠŠæœ€å¸¸ç”¨çš„æ•°æ®æ”¾åœ¨å†…å­˜é‡Œ
- **âš–ï¸ å¹³è¡¡åŸåˆ™**ï¼šå…¨å±€å†…å­˜è¦å¤§ï¼Œä½†ä¸èƒ½è®©ç³»ç»Ÿæ²¡å†…å­˜
- **ğŸ“Š ç›‘æ§åŸåˆ™**ï¼šå®šæœŸæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶è°ƒæ•´

---

## 2. ğŸŒ å…¨å±€å†…å­˜åŒºåŸŸæ·±åº¦è§£æ


### 2.1 Buffer Pool - æ•°æ®é¡µç¼“å­˜æ± 

Buffer Poolæ˜¯MySQLæœ€é‡è¦çš„å†…å­˜åŒºåŸŸï¼Œ**å°±åƒå›¾ä¹¦é¦†çš„é˜…è§ˆå®¤**ï¼ŒæŠŠæœ€å¸¸ç”¨çš„"ä¹¦"ï¼ˆæ•°æ®é¡µï¼‰æ”¾åœ¨æ‰‹è¾¹ã€‚

**ğŸ”¸ Buffer Poolçš„ä½œç”¨**
```
æ²¡æœ‰Buffer Poolï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ ç£ç›˜è¯»å– â†’ è¿”å›ç»“æœ
æ¯æ¬¡éƒ½è¦"è·‘"åˆ°ç£ç›˜æ‹¿æ•°æ®ï¼Œå¾ˆæ…¢ï¼

æœ‰äº†Buffer Poolï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ å…ˆæŸ¥å†…å­˜ â†’ å‘½ä¸­å°±ç›´æ¥è¿”å›
             â†“ æœªå‘½ä¸­
           ç£ç›˜è¯»å– â†’ æ”¾å…¥å†…å­˜ â†’ è¿”å›ç»“æœ
```

**ğŸ“Š Buffer Poolç»“æ„è¯¦è§£**
```
Buffer Poolå†…éƒ¨ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Buffer Pool            â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ é¡µæ¡†1   â”‚ â”‚ é¡µæ¡†2   â”‚ â”‚ é¡µæ¡†3   â”‚â”‚  â† 16KBæ•°æ®é¡µ
â”‚  â”‚Table A  â”‚ â”‚Index B  â”‚ â”‚Table C  â”‚â”‚
â”‚  â”‚Row 1-N  â”‚ â”‚B+Tree   â”‚ â”‚Row 1-M  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚        LRUé“¾è¡¨ç®¡ç†              â”‚â”‚  â† æœ€è¿‘æœ€å°‘ä½¿ç”¨
â”‚  â”‚  æ–°é¡µâ†’[é¡µ3]â†’[é¡µ1]â†’[é¡µ2]â†’æ—§é¡µ    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ å…³é”®é…ç½®å‚æ•°**
```sql
-- æŸ¥çœ‹Buffer Poolå¤§å°ï¼ˆæœ€é‡è¦çš„å‚æ•°ï¼‰
SHOW VARIABLES LIKE 'innodb_buffer_pool_size';

-- æ¨èé…ç½®ï¼šç‰©ç†å†…å­˜çš„70-80%
-- 8GBå†…å­˜æœåŠ¡å™¨ï¼šè®¾ç½®ä¸º6GB
SET GLOBAL innodb_buffer_pool_size = 6442450944; -- 6GB
```

### 2.2 Query Cache - æŸ¥è¯¢ç»“æœç¼“å­˜

Query Cacheå°±åƒ**é¤å…çš„æ‹›ç‰Œèœå•**ï¼Œå¸¸ç‚¹çš„èœç›´æ¥ä¸Šï¼Œä¸ç”¨é‡æ–°åšã€‚

> **âš ï¸ é‡è¦æé†’**ï¼šMySQL 8.0å·²ç»ç§»é™¤äº†Query Cacheï¼Œå› ä¸ºåœ¨é«˜å¹¶å‘ä¸‹åè€Œä¼šé™ä½æ€§èƒ½

**ğŸ”¸ Query Cacheå·¥ä½œåŸç†**
```
æŸ¥è¯¢ç¼“å­˜æµç¨‹ï¼š
å®¢æˆ·ç«¯SQL â†’ è®¡ç®—æŸ¥è¯¢å“ˆå¸Œå€¼ â†’ æ£€æŸ¥ç¼“å­˜
                                  â†“
                              ç¼“å­˜å‘½ä¸­ï¼Ÿ
                             â†™        â†˜
                        ç›´æ¥è¿”å›     æ‰§è¡ŒæŸ¥è¯¢
                        ç¼“å­˜ç»“æœ  â†’ å­˜å…¥ç¼“å­˜ â†’ è¿”å›ç»“æœ
```

### 2.3 æ—¥å¿—ç¼“å†²åŒº

**InnoDBæ—¥å¿—ç¼“å†²åŒº**å°±åƒ**è®°è´¦æœ¬çš„è‰ç¨¿çº¸**ï¼Œå…ˆåœ¨å†…å­˜é‡Œè®°å½•ï¼Œå®šæœŸæ•´ç†åˆ°æ­£å¼è´¦æœ¬ï¼ˆç£ç›˜ï¼‰ã€‚

```sql
-- æŸ¥çœ‹æ—¥å¿—ç¼“å†²åŒºå¤§å°
SHOW VARIABLES LIKE 'innodb_log_buffer_size';

-- å…¸å‹é…ç½®ï¼š16MB-64MB
innodb_log_buffer_size = 33554432  -- 32MB
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æ—¥å¿—ç¼“å†²åŒºï¼Ÿ**
- **æ‰¹é‡å†™å…¥**ï¼šæ”’å¤Ÿä¸€æ‰¹æ—¥å¿—å†å†™ç£ç›˜ï¼Œæ•ˆç‡é«˜
- **é¡ºåºå†™å…¥**ï¼šæ—¥å¿—æŒ‰é¡ºåºå†™ï¼Œæ¯”éšæœºå†™å¿«å¾ˆå¤š
- **äº‹åŠ¡å®‰å…¨**ï¼šä¿è¯äº‹åŠ¡çš„ACIDç‰¹æ€§

---

## 3. ğŸ‘¤ ä¼šè¯å†…å­˜åŒºåŸŸè¯¦è§£


### 3.1 ä¼šè¯å†…å­˜çš„ç‰¹ç‚¹

æ¯ä¸ªæ•°æ®åº“è¿æ¥éƒ½æœ‰è‡ªå·±çš„**ç§äººå·¥ä½œç©ºé—´**ï¼Œå°±åƒæ¯ä¸ªå‘˜å·¥éƒ½æœ‰è‡ªå·±çš„åŠå…¬æ¡Œã€‚

**ğŸ”¸ ä¼šè¯å†…å­˜ç‰¹ç‚¹**
- **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªè¿æ¥éƒ½æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
- **ä¸´æ—¶æ€§**ï¼šè¿æ¥æ–­å¼€åå†…å­˜è¢«é‡Šæ”¾
- **æŒ‰éœ€åˆ†é…**ï¼šæ ¹æ®æ“ä½œç±»å‹åŠ¨æ€åˆ†é…

### 3.2 æ’åºç¼“å†²åŒº (sort_buffer_size)

å½“éœ€è¦æ’åºæ•°æ®æ—¶ï¼ŒMySQLä¼šä¸ºæ¯ä¸ªè¿æ¥åˆ†é…æ’åºç¼“å†²åŒºï¼Œ**å°±åƒç»™å­¦ç”Ÿå‘è‰ç¨¿çº¸åšè®¡ç®—**ã€‚

```sql
-- æŸ¥çœ‹æ’åºç¼“å†²åŒºå¤§å°
SHOW VARIABLES LIKE 'sort_buffer_size';

-- ä»€ä¹ˆæ—¶å€™ç”¨åˆ°æ’åºç¼“å†²åŒºï¼Ÿ
SELECT * FROM users ORDER BY create_time DESC LIMIT 10;
SELECT name, COUNT(*) FROM orders GROUP BY name;
```

**ğŸ“Š æ’åºç¼“å†²åŒºå¤§å°å½±å“**
| ç¼“å†²åŒºå¤§å° | æ’åºæ–¹å¼ | æ€§èƒ½ç‰¹ç‚¹ |
|-----------|----------|----------|
| **è¶³å¤Ÿå¤§** | `å†…å­˜æ’åº` | ğŸŸ¢ **å¿«é€Ÿ**ï¼Œç›´æ¥åœ¨å†…å­˜å®Œæˆ |
| **ä¸å¤Ÿå¤§** | `æ–‡ä»¶æ’åº` | ğŸŸ¡ **è¾ƒæ…¢**ï¼Œéœ€è¦ä¸´æ—¶æ–‡ä»¶è¾…åŠ© |
| **å¤ªå°** | `å¤šæ¬¡æ–‡ä»¶æ’åº` | ğŸ”´ **å¾ˆæ…¢**ï¼Œé¢‘ç¹ç£ç›˜æ“ä½œ |

### 3.3 è¿æ¥ç¼“å†²åŒº (join_buffer_size)

å½“è¡¨å…³è”æŸ¥è¯¢æ—¶ç”¨åˆ°ï¼Œ**å°±åƒæ‹¼å›¾æ—¶çš„ä¸´æ—¶å·¥ä½œå°**ã€‚

```sql
-- å…¸å‹çš„éœ€è¦join_bufferçš„æŸ¥è¯¢
SELECT u.name, o.amount 
FROM users u 
JOIN orders o ON u.id = o.user_id
WHERE u.status = 'active';
```

**ğŸ”¸ Join Bufferå·¥ä½œç¤ºä¾‹**
```
ä¸ä½¿ç”¨ç´¢å¼•çš„JOINè¿‡ç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Table A   â”‚    â”‚ Join Buffer â”‚
â”‚   (å¤–è¡¨)    â”‚    â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Row 1       â”‚â”€â”€â”€â†’â”‚ Row 1 ç¼“å­˜  â”‚
â”‚ Row 2       â”‚â”€â”€â”€â†’â”‚ Row 2 ç¼“å­˜  â”‚
â”‚ ...         â”‚    â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    ä¸Table Bé€è¡Œæ¯”è¾ƒ
```

### 3.4 è¯»å–ç¼“å†²åŒº (read_buffer_size)

æ‰§è¡Œå…¨è¡¨æ‰«ææ—¶ä½¿ç”¨ï¼Œ**å°±åƒä¸€æ¬¡å¤šæ‹¿å‡ æœ¬ä¹¦ï¼Œå‡å°‘æ¥å›è·‘**ã€‚

```sql
-- å…¨è¡¨æ‰«æä¼šç”¨åˆ°read_buffer
SELECT * FROM large_table WHERE status = 'pending';
-- å¦‚æœstatuså­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œå°±ä¼šå…¨è¡¨æ‰«æ
```

---

## 4. ğŸŠ Buffer Poolæ ¸å¿ƒæœºåˆ¶


### 4.1 Buffer Poolçš„ç”Ÿå‘½å‘¨æœŸ

Buffer Poolå°±åƒ**æ™ºèƒ½åœè½¦åœº**ï¼Œè‡ªåŠ¨ç®¡ç†è½¦ä½ï¼Œä¼˜å…ˆä¿ç•™å¸¸ç”¨çš„è½¦ã€‚

```
Buffer Poolé¡µé¢ç”Ÿå‘½å‘¨æœŸï¼š
æ–°é¡µé¢è¿›å…¥ â†’ æ”¾å…¥NEWå­åˆ—è¡¨ â†’ è¢«è®¿é—®åç§»å…¥OLDå­åˆ—è¡¨ â†’ 
é¢‘ç¹è®¿é—® â†’ ç§»å…¥YOUNGå­åˆ—è¡¨ â†’ é•¿æœŸä¸ç”¨ â†’ è¢«æ·˜æ±°
```

### 4.2 LRUç®—æ³•ä¼˜åŒ–

MySQLä½¿ç”¨æ”¹è¿›çš„LRUç®—æ³•ï¼Œåˆ†ä¸º**çƒ­æ•°æ®åŒº**å’Œ**å†·æ•°æ®åŒº**ã€‚

```
æ”¹è¿›LRUé“¾è¡¨ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Buffer Pool             â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  YOUNGåŒº    â”‚ â”‚     OLDåŒº       â”‚ â”‚
â”‚ â”‚  (çƒ­æ•°æ®)   â”‚ â”‚   (å†·æ•°æ®)      â”‚ â”‚
â”‚ â”‚   37%       â”‚ â”‚      63%        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â†‘               â†‘             â”‚
â”‚   é¢‘ç¹è®¿é—®çš„       æ–°è¯»å…¥çš„æ•°æ®      â”‚
â”‚   çƒ­ç‚¹æ•°æ®         æš‚å­˜åŒº           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦åˆ†åŒºï¼Ÿ**
- é˜²æ­¢**å¤§è¡¨æ‰«æ**å†²æ‰çƒ­ç‚¹æ•°æ®
- æ–°æ•°æ®éœ€è¦"è€ƒéªŒæœŸ"æ‰èƒ½è¿›å…¥çƒ­æ•°æ®åŒº
- ä¿æŠ¤çœŸæ­£çš„çƒ­ç‚¹æ•°æ®ä¸è¢«è¯¯æ·˜æ±°

### 4.3 Buffer Poolå®ä¾‹

å¤§å†…å­˜æœåŠ¡å™¨å¯ä»¥é…ç½®å¤šä¸ªBuffer Poolå®ä¾‹ï¼Œ**å°±åƒå¼€å¤šä¸ªåœè½¦åœºï¼Œå‡å°‘æ‹¥å µ**ã€‚

```sql
-- é…ç½®å¤šä¸ªBuffer Poolå®ä¾‹
innodb_buffer_pool_instances = 8  -- å»ºè®®ï¼šæ¯GBå†…å­˜1ä¸ªå®ä¾‹

-- æŸ¥çœ‹å®ä¾‹çŠ¶æ€
SELECT * FROM information_schema.INNODB_BUFFER_POOL_STATS;
```

---

## 5. âš™ï¸ å†…å­˜åˆ†é…ä¸ç®¡ç†æœºåˆ¶


### 5.1 å†…å­˜åˆ†é…ç­–ç•¥

MySQLé‡‡ç”¨**æ™ºèƒ½å†…å­˜åˆ†é…**ï¼Œæ ¹æ®å®é™…éœ€è¦åŠ¨æ€è°ƒæ•´ã€‚

**ğŸ”¸ åˆ†é…ä¼˜å…ˆçº§**
```
å†…å­˜åˆ†é…ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. ğŸ”´ Buffer Pool       â† æœ€é‡è¦ï¼Œæ•°æ®ç¼“å­˜
2. ğŸŸ¡ æ—¥å¿—ç¼“å†²åŒº        â† äº‹åŠ¡å®‰å…¨ä¿éšœ  
3. ğŸŸ¢ ä¼šè¯ç¼“å†²åŒº        â† æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
4. ğŸ”µ å…¶ä»–ç³»ç»Ÿç¼“å†²åŒº    â† è¾…åŠ©åŠŸèƒ½
```

### 5.2 å†…å­˜ç¢ç‰‡ç®¡ç†

é•¿æ—¶é—´è¿è¡Œåï¼Œå†…å­˜ä¼šäº§ç”Ÿç¢ç‰‡ï¼Œ**å°±åƒä¹¦æ¶ç”¨ä¹…äº†ä¼šä¹±**ã€‚

**ğŸ“Š å†…å­˜ç¢ç‰‡æ£€æŸ¥**
```sql
-- æŸ¥çœ‹å†…å­˜ç¢ç‰‡æƒ…å†µ
SELECT 
  ROUND(DATA_LENGTH/1024/1024, 2) as data_mb,
  ROUND(DATA_FREE/1024/1024, 2) as free_mb,
  ROUND(DATA_FREE/DATA_LENGTH*100, 2) as fragment_pct
FROM information_schema.TABLES 
WHERE ENGINE = 'InnoDB';
```

### 5.3 NUMAæ¶æ„é€‚é…

ç°ä»£æœåŠ¡å™¨é€šå¸¸æ˜¯NUMAæ¶æ„ï¼ŒMySQLéœ€è¦ç‰¹æ®Šé…ç½®ã€‚

```
NUMAå†…å­˜æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CPU 0     â”‚    â”‚   CPU 1     â”‚
â”‚  (æ ¸å¿ƒ1-8)  â”‚    â”‚  (æ ¸å¿ƒ9-16) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬åœ°å†…å­˜   â”‚    â”‚  æœ¬åœ°å†…å­˜   â”‚
â”‚   16GB      â”‚    â”‚   16GB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†•                â†•
    å¿«é€Ÿè®¿é—®         è·¨èŠ‚ç‚¹è®¿é—®
                    (è¾ƒæ…¢)
```

**âš¡ NUMAä¼˜åŒ–é…ç½®**
```bash
# å¯åŠ¨æ—¶ç»‘å®šNUMAèŠ‚ç‚¹
numactl --cpunodebind=0 --membind=0 mysqld

# æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­
[mysqld]
innodb_numa_interleave = 1
```

---

## 6. ğŸ“Š å†…å­˜ç›‘æ§ä¸ä¼˜åŒ–ç­–ç•¥


### 6.1 å†…å­˜ä½¿ç”¨ç»Ÿè®¡æŸ¥çœ‹

æŒæ¡å†…å­˜ä½¿ç”¨æƒ…å†µæ˜¯ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥ã€‚

**ğŸ” å…³é”®ç›‘æ§SQL**
```sql
-- 1. æŸ¥çœ‹Buffer Poolå‘½ä¸­ç‡ï¼ˆåº”è¯¥>99%ï¼‰
SELECT 
  ROUND(
    (1 - (Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests)) * 100, 2
  ) as buffer_pool_hit_rate
FROM 
  (SELECT variable_value as Innodb_buffer_pool_reads 
   FROM performance_schema.global_status 
   WHERE variable_name = 'Innodb_buffer_pool_reads') a,
  (SELECT variable_value as Innodb_buffer_pool_read_requests 
   FROM performance_schema.global_status 
   WHERE variable_name = 'Innodb_buffer_pool_read_requests') b;

-- 2. æŸ¥çœ‹å†…å­˜æ€»ä½“ä½¿ç”¨æƒ…å†µ
SELECT 
  $$innodb_buffer_pool_size / 1024 / 1024 / 1024 as buffer_pool_gb,
  $$sort_buffer_size / 1024 / 1024 as sort_buffer_mb,
  $$join_buffer_size / 1024 / 1024 as join_buffer_mb;
```

### 6.2 å†…å­˜ä¼˜åŒ–ç­–ç•¥


**ğŸ“ˆ ä¼˜åŒ–æ­¥éª¤æµç¨‹**
```
å†…å­˜ä¼˜åŒ–æµç¨‹ï¼š
ç›‘æ§å½“å‰çŠ¶æ€ â†’ è¯†åˆ«ç“¶é¢ˆé—®é¢˜ â†’ è°ƒæ•´é…ç½®å‚æ•° â†’ 
è§‚å¯Ÿæ•ˆæœ â†’ ç»§ç»­å¾®è°ƒ â†’ è¾¾åˆ°æœ€ä¼˜çŠ¶æ€
```

**ğŸ¯ å…·ä½“ä¼˜åŒ–å»ºè®®**

| é—®é¢˜ç°è±¡ | å¯èƒ½åŸå›  | **ä¼˜åŒ–æ–¹æ¡ˆ** |
|---------|----------|-------------|
| Buffer Poolå‘½ä¸­ç‡<95% | å†…å­˜ä¸è¶³ | **å¢åŠ ** `innodb_buffer_pool_size` |
| å¤§é‡ä¸´æ—¶æ–‡ä»¶æ’åº | æ’åºç¼“å†²åŒºå° | **å¢åŠ ** `sort_buffer_size` |
| JOINæŸ¥è¯¢å¾ˆæ…¢ | è¿æ¥ç¼“å†²åŒºå° | **å¢åŠ ** `join_buffer_size` |
| ç³»ç»ŸOOM | å†…å­˜é…ç½®è¿‡å¤§ | **å‡å°‘**å„é¡¹ç¼“å†²åŒºé…ç½® |

**âš¡ é…ç½®å»ºè®®å…¬å¼**
```bash
# æœåŠ¡å™¨å†…å­˜åˆ†é…å»ºè®®
æ€»å†…å­˜ = MySQLå†…å­˜ + æ“ä½œç³»ç»Ÿå†…å­˜ + å…¶ä»–åº”ç”¨å†…å­˜

# MySQLå†…å­˜åˆ†é…
Buffer Pool = æ€»å†…å­˜ Ã— 70-80%    # æ ¸å¿ƒé…ç½®
å…¶ä»–ç¼“å†²åŒº = æ€»å†…å­˜ Ã— 5-10%      # è¾…åŠ©é…ç½®
é¢„ç•™ç»™OS = æ€»å†…å­˜ Ã— 15-20%       # ç³»ç»Ÿç¨³å®šæ€§
```

### 6.3 å†…å­˜é—®é¢˜è¯Šæ–­


**ğŸš¨ å¸¸è§å†…å­˜é—®é¢˜ç—‡çŠ¶**
- **ç—‡çŠ¶1**ï¼šæŸ¥è¯¢çªç„¶å˜æ…¢ â†’ å¯èƒ½æ˜¯Buffer Poolå‘½ä¸­ç‡ä¸‹é™
- **ç—‡çŠ¶2**ï¼šå¤§é‡ç£ç›˜IO â†’ å¯èƒ½æ˜¯å†…å­˜é…ç½®ä¸è¶³
- **ç—‡çŠ¶3**ï¼šç³»ç»ŸOOM â†’ å¯èƒ½æ˜¯å†…å­˜é…ç½®è¿‡å¤§

**ğŸ”§ é—®é¢˜å®šä½å·¥å…·**
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥çš„å†…å­˜ä½¿ç”¨
SELECT 
  user, host, 
  memory_used/1024/1024 as memory_mb
FROM performance_schema.users 
ORDER BY memory_used DESC;

-- æŸ¥çœ‹æœ€æ¶ˆè€—å†…å­˜çš„SQL
SELECT 
  digest_text,
  sum_memory_used/1024/1024 as total_memory_mb,
  avg_memory_used/1024/1024 as avg_memory_mb
FROM performance_schema.events_statements_summary_by_digest 
ORDER BY sum_memory_used DESC 
LIMIT 10;
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å†…å­˜æ¶æ„ï¼šå…¨å±€å†…å­˜(å…±äº«) + ä¼šè¯å†…å­˜(ç‹¬å )
ğŸ”¸ Buffer Poolï¼šæœ€é‡è¦çš„å†…å­˜åŒºåŸŸï¼Œç¼“å­˜æ•°æ®é¡µ
ğŸ”¸ LRUæœºåˆ¶ï¼šæ™ºèƒ½æ·˜æ±°ç®—æ³•ï¼Œä¿æŠ¤çƒ­ç‚¹æ•°æ®
ğŸ”¸ å†…å­˜ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥å‘½ä¸­ç‡å’Œä½¿ç”¨æƒ…å†µ
ğŸ”¸ ä¼˜åŒ–åŸåˆ™ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹åˆç†åˆ†é…å†…å­˜
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å†…å­˜çš„æœ¬è´¨ä½œç”¨**
```
æ•°æ®åº“æ€§èƒ½å…¬å¼ï¼š
æ€§èƒ½ = å†…å­˜å‘½ä¸­ç‡ Ã— å†…å­˜è®¿é—®é€Ÿåº¦ + 
       ç£ç›˜å‘½ä¸­ç‡ Ã— ç£ç›˜è®¿é—®é€Ÿåº¦

å†…å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œæ•´ä½“æ€§èƒ½è¶Šå¥½ï¼
```

**ğŸ”¹ é…ç½®ä¼˜åŒ–æ€è·¯**
```
é…ç½®ç­–ç•¥ï¼š
1. Buffer Poolä¼˜å…ˆï¼šå å¤§å¤´ï¼Œå½±å“æœ€å¤§
2. ä¼šè¯ç¼“å†²é€‚ä¸­ï¼šé¿å…å•ä¸ªè¿æ¥å ç”¨è¿‡å¤š
3. é¢„ç•™ç³»ç»Ÿå†…å­˜ï¼šä¿è¯ç³»ç»Ÿç¨³å®šè¿è¡Œ
4. æŒç»­ç›‘æ§è°ƒæ•´ï¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–
```

### 7.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æ–°æ‰‹å¸¸è§è¯¯åŒº**
- âŒ **è¯¯åŒº1**ï¼šå†…å­˜è¶Šå¤§è¶Šå¥½ â†’ æ­£ç¡®ï¼šè¦è€ƒè™‘ç³»ç»Ÿæ•´ä½“å¹³è¡¡
- âŒ **è¯¯åŒº2**ï¼šä¸€æ¬¡æ€§è°ƒæ•´æ‰€æœ‰å‚æ•° â†’ æ­£ç¡®ï¼šé€æ­¥è°ƒæ•´ï¼Œè§‚å¯Ÿæ•ˆæœ
- âŒ **è¯¯åŒº3**ï¼šå¿½ç•¥ç›‘æ§ â†’ æ­£ç¡®ï¼šå®šæœŸæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ

**âœ… æœ€ä½³å®è·µå»ºè®®**
```
ç”Ÿäº§ç¯å¢ƒé…ç½®æ­¥éª¤ï¼š
1. ğŸ” è¯„ä¼°æœåŠ¡å™¨ç¡¬ä»¶èµ„æº
2. ğŸ“Š åˆ†æä¸šåŠ¡æ•°æ®ç‰¹ç‚¹  
3. âš™ï¸ è®¾ç½®åˆå§‹å†…å­˜é…ç½®
4. ğŸ“ˆ ç›‘æ§è¿è¡ŒçŠ¶æ€
5. ğŸ”§ æ ¹æ®ç›‘æ§ç»“æœè°ƒä¼˜
6. ğŸ“ è®°å½•ä¼˜åŒ–è¿‡ç¨‹å’Œæ•ˆæœ
```

**ğŸ¯ è®°å¿†è¦ç‚¹**
- **Buffer Poolæ˜¯æ ¸å¿ƒ**ï¼šæ•°æ®ç¼“å­˜çš„ä¸»æˆ˜åœº
- **å‘½ä¸­ç‡æ˜¯å…³é”®**ï¼š>99%æ˜¯åŸºæœ¬è¦æ±‚
- **ç›‘æ§æ˜¯åŸºç¡€**ï¼šä¸ç›‘æ§å°±æ˜¯ç›²ç›®ä¼˜åŒ–
- **å¹³è¡¡æ˜¯æ™ºæ…§**ï¼šæ€§èƒ½å’Œç¨³å®šæ€§è¦å…¼é¡¾

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> å†…å­˜æ¶æ„åˆ†ä¸¤å±‚ï¼Œå…¨å±€ä¼šè¯è¦åˆ†æ¸…  
> Buffer Poolæ˜¯é‡ç‚¹ï¼Œå‘½ä¸­ç‡é«˜æ€§èƒ½è¡Œ  
> ç›‘æ§ä¼˜åŒ–ä¸¤æ‰‹æŠ“ï¼Œå¹³è¡¡é…ç½®ä¿ç¨³å®š