---
title: 11ã€å…¨å±€åºåˆ—å·ä¸äºŒçº§ç´¢å¼•
---
## ğŸ“š ç›®å½•

1. [å…¨å±€åºåˆ—å·åŸºç¡€æ¦‚å¿µ](#1-å…¨å±€åºåˆ—å·åŸºç¡€æ¦‚å¿µ)
2. [å…¨å±€åºåˆ—å·ç”Ÿæˆç­–ç•¥](#2-å…¨å±€åºåˆ—å·ç”Ÿæˆç­–ç•¥)
3. [åˆ†å¸ƒå¼åºåˆ—ç®¡ç†](#3-åˆ†å¸ƒå¼åºåˆ—ç®¡ç†)
4. [å…¨å±€äºŒçº§ç´¢å¼•æ¦‚å¿µ](#4-å…¨å±€äºŒçº§ç´¢å¼•æ¦‚å¿µ)
5. [å…¨å±€ç´¢å¼•æ¶æ„è®¾è®¡](#5-å…¨å±€ç´¢å¼•æ¶æ„è®¾è®¡)
6. [è·¨åˆ†ç‰‡ç´¢å¼•æŸ¥è¯¢](#6-è·¨åˆ†ç‰‡ç´¢å¼•æŸ¥è¯¢)
7. [ç´¢å¼•åŒæ­¥ä¸ä¸€è‡´æ€§](#7-ç´¢å¼•åŒæ­¥ä¸ä¸€è‡´æ€§)
8. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#8-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ†” å…¨å±€åºåˆ—å·åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å…¨å±€åºåˆ—å·


**ç®€å•ç†è§£**ï¼šå…¨å±€åºåˆ—å·å°±åƒæ˜¯ç»™æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¯æ¡æ•°æ®åˆ†é…ä¸€ä¸ª**å…¨ä¸–ç•Œå”¯ä¸€çš„èº«ä»½è¯å·ç **ã€‚

```
ä¼ ç»Ÿå•æœºç¯å¢ƒï¼š
æ•°æ®åº“è‡ªå¸¦çš„ AUTO_INCREMENT å°±å¤Ÿç”¨äº†
ID: 1, 2, 3, 4, 5... æŒ‰é¡ºåºé€’å¢

åˆ†å¸ƒå¼ç¯å¢ƒçš„é—®é¢˜ï¼š
åˆ†ç‰‡1: ID 1, 2, 3...
åˆ†ç‰‡2: ID 1, 2, 3...  â† é‡å¤äº†ï¼
åˆ†ç‰‡3: ID 1, 2, 3...  â† åˆé‡å¤äº†ï¼
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å…¨å±€åºåˆ—å·


**ğŸ”¸ æ ¸å¿ƒéœ€æ±‚**
```
å”¯ä¸€æ€§ä¿éšœï¼š
- ç¡®ä¿æ•´ä¸ªç³»ç»Ÿä¸­æ¯æ¡è®°å½•çš„IDéƒ½ä¸é‡å¤
- é¿å…æ•°æ®å†²çªå’Œä¸šåŠ¡é€»è¾‘é”™è¯¯

ä¸šåŠ¡åœºæ™¯éœ€è¦ï¼š
- è®¢å•å·å¿…é¡»å…¨å±€å”¯ä¸€
- ç”¨æˆ·IDä¸èƒ½é‡å¤
- äº¤æ˜“æµæ°´å·éœ€è¦å”¯ä¸€æ ‡è¯†
```

**ğŸ’¡ å®é™…é—®é¢˜ä¸¾ä¾‹**
```
ç”µå•†è®¢å•ç³»ç»Ÿï¼š
âŒ é”™è¯¯æƒ…å†µï¼š
åˆ†ç‰‡Aç”Ÿæˆè®¢å•ID: 202501210001
åˆ†ç‰‡Bä¹Ÿç”Ÿæˆè®¢å•ID: 202501210001  â† è®¢å•å·å†²çªï¼

âœ… æ­£ç¡®æƒ…å†µï¼š
å…¨å±€åºåˆ—ä¿è¯ï¼š
åˆ†ç‰‡Aè®¢å•ID: 202501210001
åˆ†ç‰‡Bè®¢å•ID: 202501210002  â† å…¨å±€å”¯ä¸€
```

### 1.3 å…¨å±€åºåˆ—å·çš„åŸºæœ¬è¦æ±‚


**ğŸ“‹ æ ¸å¿ƒè¦æ±‚**
```
ğŸ”¹ å…¨å±€å”¯ä¸€æ€§
æ¯ä¸ªIDåœ¨æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç»å¯¹å”¯ä¸€

ğŸ”¹ è¶‹åŠ¿é€’å¢
æ–°ç”Ÿæˆçš„IDè¦æ¯”ä¹‹å‰çš„å¤§ï¼ˆæœ‰åˆ©äºç´¢å¼•æ€§èƒ½ï¼‰

ğŸ”¹ é«˜æ€§èƒ½
ç”Ÿæˆé€Ÿåº¦è¦å¿«ï¼Œä¸èƒ½æˆä¸ºç³»ç»Ÿç“¶é¢ˆ

ğŸ”¹ é«˜å¯ç”¨
åºåˆ—å·ç”ŸæˆæœåŠ¡ä¸èƒ½å•ç‚¹æ•…éšœ

ğŸ”¹ å¯æ‰©å±•
èƒ½å¤Ÿæ”¯æŒç³»ç»Ÿè§„æ¨¡çš„æ°´å¹³æ‰©å±•
```

---

## 2. âš™ï¸ å…¨å±€åºåˆ—å·ç”Ÿæˆç­–ç•¥


### 2.1 æ•°æ®åº“å·æ®µæ¨¡å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰


**ğŸ”¸ å·¥ä½œåŸç†**
æ•°æ®åº“å·æ®µæ¨¡å¼å°±åƒæ˜¯**æå‰æ‰¹å‘IDå·ç **ï¼Œæ¯ä¸ªåº”ç”¨æœåŠ¡å™¨ä¸€æ¬¡æ€§å–ä¸€æ‰¹å·ç å›å»æ…¢æ…¢ç”¨ã€‚

```sql
-- åˆ›å»ºåºåˆ—å·åˆ†é…è¡¨
CREATE TABLE global_sequence (
    seq_name VARCHAR(50) PRIMARY KEY,  -- åºåˆ—åç§°
    current_value BIGINT NOT NULL,     -- å½“å‰å€¼
    step_size INT NOT NULL DEFAULT 1000  -- æ¯æ¬¡åˆ†é…æ­¥é•¿
);

-- åˆå§‹åŒ–åºåˆ—
INSERT INTO global_sequence VALUES ('user_id', 0, 1000);
INSERT INTO global_sequence VALUES ('order_id', 0, 1000);
```

**ğŸ’» å·æ®µåˆ†é…é€»è¾‘**
```java
public class SegmentIdGenerator {
    private volatile long currentId;    // å½“å‰ä½¿ç”¨çš„ID
    private volatile long maxId;        // å½“å‰å·æ®µçš„æœ€å¤§ID
    private final Object lock = new Object();
    
    // è·å–ä¸‹ä¸€ä¸ªID
    public long nextId() {
        if (currentId >= maxId) {
            synchronized (lock) {
                if (currentId >= maxId) {
                    allocateNewSegment();  // åˆ†é…æ–°å·æ®µ
                }
            }
        }
        return ++currentId;
    }
    
    // ä»æ•°æ®åº“åˆ†é…æ–°çš„å·æ®µ
    private void allocateNewSegment() {
        String sql = "UPDATE global_sequence SET current_value = current_value + step_size " +
                    "WHERE seq_name = ? RETURNING current_value, step_size";
        // æ‰§è¡ŒSQLï¼Œè·å–æ–°çš„å·æ®µèŒƒå›´
        // currentId = result.currentValue - result.stepSize
        // maxId = result.currentValue
    }
}
```

**ğŸ¯ ä¼˜ç¼ºç‚¹åˆ†æ**
```
âœ… ä¼˜ç‚¹ï¼š
â€¢ æ€§èƒ½é«˜ï¼šæ‰¹é‡è·å–ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®
â€¢ å®ç°ç®€å•ï¼šé€»è¾‘æ¸…æ™°æ˜“æ‡‚
â€¢ å¯ç”¨æ€§å¥½ï¼šå•ä¸ªæœåŠ¡å™¨æ•…éšœä¸å½±å“å…¶ä»–æœåŠ¡å™¨

âŒ ç¼ºç‚¹ï¼š
â€¢ IDä¸è¿ç»­ï¼šæœåŠ¡å™¨é‡å¯ä¼šæµªè´¹éƒ¨åˆ†å·æ®µ
â€¢ ä¾èµ–æ•°æ®åº“ï¼šåºåˆ—åˆ†é…è¡¨æˆä¸ºå•ç‚¹
```

### 2.2 é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰


**ğŸ”¸ ç®—æ³•åŸç†**
é›ªèŠ±ç®—æ³•åƒæ˜¯ç»™æ¯ä¸ªIDæ‰“ä¸Š**æ—¶é—´æˆ³ + æœºå™¨ç¼–å· + åºåˆ—å·**çš„æ ‡ç­¾ã€‚

```
64ä½IDç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ä½ â”‚    41ä½æ—¶é—´æˆ³    â”‚ 10ä½æœºå™¨ID â”‚ 12ä½åºåˆ—å· â”‚
â”‚ç¬¦å·ä½â”‚   (æ¯«ç§’çº§)      â”‚ (1024å°)  â”‚ (4096ä¸ª) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®é™…ç¤ºä¾‹ï¼š
æ—¶é—´æˆ³: 1642781234567 (2022-01-21 12:34:56.789)
æœºå™¨ID: 001 (ç¬¬1å°æœºå™¨)
åºåˆ—å·: 0001 (è¿™æ¯«ç§’å†…ç¬¬1ä¸ªID)
ç”ŸæˆID: 1642781234567001001
```

**ğŸ’» å®ç°ç¤ºä¾‹**
```java
public class SnowflakeIdGenerator {
    private final long startTime = 1640995200000L; // 2022-01-01
    private final long machineId;
    private long sequence = 0L;
    private long lastTimestamp = -1L;
    
    public SnowflakeIdGenerator(long machineId) {
        this.machineId = machineId;
    }
    
    public synchronized long nextId() {
        long currentTime = System.currentTimeMillis();
        
        // å¤„ç†æ—¶é’Ÿå›æ‹¨
        if (currentTime < lastTimestamp) {
            throw new RuntimeException("æ—¶é’Ÿå›æ‹¨å¼‚å¸¸");
        }
        
        // åŒä¸€æ¯«ç§’å†…åºåˆ—å·é€’å¢
        if (currentTime == lastTimestamp) {
            sequence = (sequence + 1) & 4095; // 12ä½åºåˆ—å·
            if (sequence == 0) {
                currentTime = waitNextMillis(currentTime);
            }
        } else {
            sequence = 0L;
        }
        
        lastTimestamp = currentTime;
        
        // ç»„è£…ID
        return ((currentTime - startTime) << 22) |
               (machineId << 12) |
               sequence;
    }
}
```

### 2.3 UUIDæ–¹æ¡ˆ


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
UUIDå°±åƒæ˜¯**éšæœºç”Ÿæˆçš„è¶…é•¿èº«ä»½è¯å·**ï¼Œå‡ ä¹ä¸å¯èƒ½é‡å¤ã€‚

```java
// æ ‡å‡†UUIDç”Ÿæˆ
String uuid = UUID.randomUUID().toString();
// ç¤ºä¾‹ï¼šf47ac10b-58cc-4372-a567-0e02b2c3d479

// å»æ‰æ¨ªçº¿çš„ç´§å‡‘æ ¼å¼
String compactUuid = uuid.replace("-", "");
// ç¤ºä¾‹ï¼šf47ac10b58cc4372a5670e02b2c3d479
```

**ğŸ¯ æ–¹æ¡ˆå¯¹æ¯”**
```
UUIDä¼˜ç‚¹ï¼š
â€¢ æœ¬åœ°ç”Ÿæˆï¼Œæ— éœ€ä¸­å¿ƒåŒ–æœåŠ¡
â€¢ å…¨çƒå”¯ä¸€æ€§æé«˜
â€¢ å®ç°æœ€ç®€å•

UUIDç¼ºç‚¹ï¼š
â€¢ é•¿åº¦è¾ƒé•¿ï¼ˆ32æˆ–36å­—ç¬¦ï¼‰
â€¢ æ— åºæ€§ï¼Œå½±å“æ•°æ®åº“ç´¢å¼•æ€§èƒ½
â€¢ ä¸é€‚åˆä½œä¸ºä¸šåŠ¡ä¸»é”®å±•ç¤º
```

---

## 3. ğŸ”„ åˆ†å¸ƒå¼åºåˆ—ç®¡ç†


### 3.1 å¤šå·æ®µç¼“å­˜ä¼˜åŒ–


**ğŸ”¸ åŒå·æ®µè®¾è®¡**
ä¸ºäº†é¿å…è·å–æ–°å·æ®µæ—¶çš„ç­‰å¾…ï¼Œå¯ä»¥**æå‰å‡†å¤‡ä¸‹ä¸€ä¸ªå·æ®µ**ã€‚

```java
public class DoubleSegmentIdGenerator {
    private Segment currentSegment;  // å½“å‰ä½¿ç”¨çš„å·æ®µ
    private Segment nextSegment;     // é¢„åŠ è½½çš„ä¸‹ä¸€ä¸ªå·æ®µ
    private volatile boolean isLoadingNext = false;
    
    static class Segment {
        long startId;   // å·æ®µèµ·å§‹ID
        long endId;     // å·æ®µç»“æŸID
        long currentId; // å½“å‰ä½¿ç”¨åˆ°çš„ID
        
        boolean isAvailable() {
            return currentId < endId;
        }
    }
    
    public long nextId() {
        // å½“å‰å·æ®µç”¨åˆ°80%æ—¶ï¼Œå¼€å§‹åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µ
        if (!isLoadingNext && 
            currentSegment.currentId > currentSegment.startId + 
            (currentSegment.endId - currentSegment.startId) * 0.8) {
            
            loadNextSegmentAsync();  // å¼‚æ­¥åŠ è½½ä¸‹ä¸€å·æ®µ
        }
        
        if (!currentSegment.isAvailable()) {
            switchToNextSegment();   // åˆ‡æ¢åˆ°ä¸‹ä¸€å·æ®µ
        }
        
        return ++currentSegment.currentId;
    }
}
```

### 3.2 åºåˆ—å·æœåŠ¡é›†ç¾¤


**ğŸ”¸ æ¶æ„è®¾è®¡**
```
                    è´Ÿè½½å‡è¡¡å™¨
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
   åºåˆ—æœåŠ¡A        åºåˆ—æœåŠ¡B        åºåˆ—æœåŠ¡C
   (è´Ÿè´£1-3ä¸‡)     (è´Ÿè´£3-6ä¸‡)     (è´Ÿè´£6-9ä¸‡)
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   åºåˆ—åˆ†é…æ•°æ®åº“
```

**ğŸ’» æœåŠ¡æ³¨å†Œä¸å‘ç°**
```java
@Service
public class SequenceService {
    
    @Value("${sequence.server.id}")
    private int serverId;
    
    @Value("${sequence.segment.size}")
    private int segmentSize;
    
    // å¯åŠ¨æ—¶æ³¨å†Œè‡ªå·±è´Ÿè´£çš„IDèŒƒå›´
    @PostConstruct
    public void register() {
        long startRange = serverId * 100000L;     // æ¯å°æœåŠ¡å™¨10ä¸‡èŒƒå›´
        long endRange = (serverId + 1) * 100000L;
        
        // æ³¨å†Œåˆ°é…ç½®ä¸­å¿ƒ
        registerToConfigCenter(serverId, startRange, endRange);
    }
    
    // ç”Ÿæˆæœ¬æœåŠ¡å™¨èŒƒå›´å†…çš„ID
    public long generateId(String sequenceName) {
        return localGenerator.nextId(sequenceName);
    }
}
```

### 3.3 å®¹ç¾ä¸æ•…éšœæ¢å¤


**ğŸ”¸ æ•…éšœæ£€æµ‹æœºåˆ¶**
```java
@Component
public class SequenceHealthChecker {
    
    // å¥åº·æ£€æŸ¥
    @Scheduled(fixedDelay = 5000)
    public void healthCheck() {
        for (SequenceServer server : serverList) {
            try {
                long testId = server.generateTestId();
                server.setHealthy(true);
            } catch (Exception e) {
                server.setHealthy(false);
                handleServerFailure(server);  // å¤„ç†æœåŠ¡å™¨æ•…éšœ
            }
        }
    }
    
    // æ•…éšœè½¬ç§»
    private void handleServerFailure(SequenceServer failedServer) {
        // 1. æ ‡è®°æœåŠ¡å™¨ä¸ºä¸å¯ç”¨
        // 2. å°†å…¶è´Ÿè´£çš„å·æ®µèŒƒå›´è½¬ç§»ç»™å…¶ä»–å¥åº·æœåŠ¡å™¨
        // 3. é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯æ›´æ–°è·¯ç”±ä¿¡æ¯
        redistributeSequenceRange(failedServer);
    }
}
```

---

## 4. ğŸ“Š å…¨å±€äºŒçº§ç´¢å¼•æ¦‚å¿µ


### 4.1 ä»€ä¹ˆæ˜¯å…¨å±€äºŒçº§ç´¢å¼•


**ç®€å•ç†è§£**ï¼šå…¨å±€äºŒçº§ç´¢å¼•å°±åƒæ˜¯ç»™åˆ†å¸ƒå¼æ•°æ®åº“å»ºç«‹ä¸€ä¸ª**å…¨å±€é€šç”¨çš„æŸ¥æ‰¾ç›®å½•**ã€‚

```
æ²¡æœ‰å…¨å±€ç´¢å¼•çš„é—®é¢˜ï¼š
è¦æŸ¥æ‰¾name='å¼ ä¸‰'çš„ç”¨æˆ·
éœ€è¦é€ä¸ªæŸ¥è¯¢æ‰€æœ‰åˆ†ç‰‡ï¼š
åˆ†ç‰‡1: SELECT * FROM user WHERE name='å¼ ä¸‰'
åˆ†ç‰‡2: SELECT * FROM user WHERE name='å¼ ä¸‰'  
åˆ†ç‰‡3: SELECT * FROM user WHERE name='å¼ ä¸‰'
...æ•ˆç‡å¾ˆä½ï¼

æœ‰å…¨å±€ç´¢å¼•çš„ä¼˜åŠ¿ï¼š
å…¨å±€ç´¢å¼•å‘Šè¯‰ä½ ï¼šname='å¼ ä¸‰'çš„æ•°æ®åœ¨åˆ†ç‰‡2
ç›´æ¥æŸ¥è¯¢åˆ†ç‰‡2å³å¯ï¼Œæ•ˆç‡é«˜ï¼
```

### 4.2 æœ¬åœ°ç´¢å¼• vs å…¨å±€ç´¢å¼•


**ğŸ“‹ å¯¹æ¯”è¯´æ˜**
```
æœ¬åœ°ç´¢å¼•ï¼ˆLocal Indexï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ†ç‰‡1   â”‚  åˆ†ç‰‡2   â”‚  åˆ†ç‰‡3   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç”¨æˆ·1-100â”‚ç”¨æˆ·101-200â”‚ç”¨æˆ·201-300â”‚
â”‚         â”‚         â”‚         â”‚
â”‚ æœ¬åœ°ç´¢å¼• â”‚ æœ¬åœ°ç´¢å¼• â”‚ æœ¬åœ°ç´¢å¼• â”‚
â”‚nameç´¢å¼• â”‚nameç´¢å¼• â”‚nameç´¢å¼• â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŸ¥è¯¢name='å¼ ä¸‰'ï¼šéœ€è¦æŸ¥æ‰€æœ‰åˆ†ç‰‡

å…¨å±€ç´¢å¼•ï¼ˆGlobal Indexï¼‰ï¼š
        â”Œâ”€å…¨å±€nameç´¢å¼•â”€â”
        â”‚  å¼ ä¸‰â†’åˆ†ç‰‡2   â”‚
        â”‚  æå››â†’åˆ†ç‰‡1   â”‚  
        â”‚  ç‹äº”â†’åˆ†ç‰‡3   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       â”‚       â”‚
  åˆ†ç‰‡1    åˆ†ç‰‡2    åˆ†ç‰‡3

æŸ¥è¯¢name='å¼ ä¸‰'ï¼šç›´æ¥å®šä½åˆ°åˆ†ç‰‡2
```

### 4.3 å…¨å±€ç´¢å¼•çš„ç±»å‹


**ğŸ”¸ æŒ‰æ•°æ®ç»„ç»‡æ–¹å¼åˆ†ç±»**
```
åˆ†åŒºå…¨å±€ç´¢å¼•ï¼š
â€¢ ç´¢å¼•æœ¬èº«ä¹Ÿè¿›è¡Œåˆ†ç‰‡å­˜å‚¨
â€¢ æ¯ä¸ªç´¢å¼•åˆ†ç‰‡è´Ÿè´£ä¸€éƒ¨åˆ†ç´¢å¼•æ•°æ®
â€¢ é€‚åˆå¤§è§„æ¨¡æ•°æ®åœºæ™¯

å¤åˆ¶å…¨å±€ç´¢å¼•ï¼š
â€¢ åœ¨æ¯ä¸ªæ•°æ®åˆ†ç‰‡ä¸Šéƒ½ä¿å­˜å®Œæ•´çš„ç´¢å¼•å‰¯æœ¬
â€¢ æŸ¥è¯¢å¿«ä½†ç»´æŠ¤æˆæœ¬é«˜
â€¢ é€‚åˆè¯»å¤šå†™å°‘åœºæ™¯
```

---

## 5. ğŸ—ï¸ å…¨å±€ç´¢å¼•æ¶æ„è®¾è®¡


### 5.1 ç´¢å¼•åˆ†ç¦»æ¶æ„


**ğŸ”¸ è®¾è®¡åŸç†**
å°†ç´¢å¼•æ•°æ®å’Œä¸šåŠ¡æ•°æ®**ç‰©ç†åˆ†ç¦»**ï¼Œç”¨ä¸“é—¨çš„ç´¢å¼•é›†ç¾¤æ¥å­˜å‚¨ç´¢å¼•ã€‚

```
ä¸šåŠ¡åº”ç”¨å±‚
    â”‚
    â”œâ”€ å†™æ“ä½œ â”€â”€â†’ æ•°æ®åˆ†ç‰‡é›†ç¾¤
    â”‚              â”‚
    â”‚              â”œâ”€ åˆ†ç‰‡1 (ç”¨æˆ·1-1000)
    â”‚              â”œâ”€ åˆ†ç‰‡2 (ç”¨æˆ·1001-2000) 
    â”‚              â””â”€ åˆ†ç‰‡3 (ç”¨æˆ·2001-3000)
    â”‚              â”‚
    â”‚              â””â”€ å¼‚æ­¥åŒæ­¥
    â”‚                   â”‚
    â””â”€ æŸ¥è¯¢æ“ä½œ â”€â”€â†’ ç´¢å¼•é›†ç¾¤
                      â”‚
                      â”œâ”€ ç´¢å¼•åˆ†ç‰‡1 (name: A-H)
                      â”œâ”€ ç´¢å¼•åˆ†ç‰‡2 (name: I-P)
                      â””â”€ ç´¢å¼•åˆ†ç‰‡3 (name: Q-Z)
```

**ğŸ’» ç´¢å¼•æœåŠ¡å®ç°**
```java
@Service
public class GlobalIndexService {
    
    @Autowired
    private IndexShardRouter indexRouter;
    
    @Autowired
    private DataShardRouter dataRouter;
    
    // æ ¹æ®ç´¢å¼•æŸ¥è¯¢æ•°æ®
    public List<User> queryByName(String name) {
        // 1. ä»å…¨å±€ç´¢å¼•è·å–æ•°æ®ä½ç½®ä¿¡æ¯
        IndexShard indexShard = indexRouter.route(name);
        List<DataLocation> locations = indexShard.query(name);
        
        // 2. æ ¹æ®ä½ç½®ä¿¡æ¯æŸ¥è¯¢å®é™…æ•°æ®
        List<User> results = new ArrayList<>();
        for (DataLocation location : locations) {
            DataShard dataShard = dataRouter.getShardById(location.getShardId());
            User user = dataShard.queryById(location.getDataId());
            results.add(user);
        }
        
        return results;
    }
    
    // æ›´æ–°ç´¢å¼•
    public void updateIndex(String indexName, Object indexValue, 
                           String shardId, String dataId) {
        IndexShard indexShard = indexRouter.route(indexValue);
        indexShard.updateIndex(indexName, indexValue, 
                              new DataLocation(shardId, dataId));
    }
}
```

### 5.2 ç´¢å¼•æ•°æ®ç»“æ„è®¾è®¡


**ğŸ”¸ ç´¢å¼•è¡¨ç»“æ„**
```sql
-- å…¨å±€ç´¢å¼•è¡¨
CREATE TABLE global_index (
    index_name VARCHAR(50),      -- ç´¢å¼•åç§°ï¼ˆå¦‚ï¼šuser_name_idxï¼‰
    index_value VARCHAR(255),    -- ç´¢å¼•å€¼ï¼ˆå¦‚ï¼šå¼ ä¸‰ï¼‰
    shard_id VARCHAR(50),        -- æ•°æ®æ‰€åœ¨åˆ†ç‰‡ID
    data_id BIGINT,              -- æ•°æ®è®°å½•ID
    version INT,                 -- ç‰ˆæœ¬å·ï¼ˆç”¨äºä¸€è‡´æ€§æ§åˆ¶ï¼‰
    created_time TIMESTAMP,      -- åˆ›å»ºæ—¶é—´
    updated_time TIMESTAMP,      -- æ›´æ–°æ—¶é—´
    
    PRIMARY KEY (index_name, index_value, shard_id, data_id),
    INDEX idx_index_value (index_name, index_value),
    INDEX idx_shard_data (shard_id, data_id)
);
```

**ğŸ“Š ç´¢å¼•åˆ†ç‰‡ç­–ç•¥**
```java
public class IndexShardStrategy {
    
    // æŒ‰ç´¢å¼•å€¼å“ˆå¸Œåˆ†ç‰‡
    public String getIndexShard(String indexValue) {
        int hash = indexValue.hashCode();
        int shardIndex = Math.abs(hash) % indexShardCount;
        return "index_shard_" + shardIndex;
    }
    
    // æŒ‰èŒƒå›´åˆ†ç‰‡ï¼ˆé€‚åˆèŒƒå›´æŸ¥è¯¢ï¼‰
    public String getIndexShardByRange(String indexValue) {
        char firstChar = indexValue.charAt(0);
        if (firstChar >= 'A' && firstChar <= 'H') {
            return "index_shard_1";
        } else if (firstChar >= 'I' && firstChar <= 'P') {
            return "index_shard_2";
        } else {
            return "index_shard_3";
        }
    }
}
```

### 5.3 ç´¢å¼•è·¯ç”±ä¸æŸ¥è¯¢


**ğŸ”¸ å¤šçº§è·¯ç”±è®¾è®¡**
```java
public class IndexQueryEngine {
    
    // ç²¾ç¡®æŸ¥è¯¢
    public List<DataLocation> exactQuery(String indexName, Object value) {
        String indexShard = shardStrategy.getIndexShard(value.toString());
        String sql = "SELECT shard_id, data_id FROM global_index " +
                    "WHERE index_name = ? AND index_value = ?";
        
        return indexShardManager.query(indexShard, sql, indexName, value);
    }
    
    // èŒƒå›´æŸ¥è¯¢
    public List<DataLocation> rangeQuery(String indexName, 
                                        Object startValue, Object endValue) {
        // 1. ç¡®å®šæ¶‰åŠçš„ç´¢å¼•åˆ†ç‰‡
        List<String> indexShards = shardStrategy.getRangeShards(
            startValue.toString(), endValue.toString());
        
        // 2. å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰ç›¸å…³åˆ†ç‰‡
        List<CompletableFuture<List<DataLocation>>> futures = 
            indexShards.stream()
                .map(shard -> CompletableFuture.supplyAsync(() -> 
                    queryRangeInShard(shard, indexName, startValue, endValue)))
                .collect(Collectors.toList());
        
        // 3. åˆå¹¶ç»“æœ
        return futures.stream()
                .map(CompletableFuture::join)
                .flatMap(List::stream)
                .collect(Collectors.toList());
    }
}
```

---

## 6. ğŸ” è·¨åˆ†ç‰‡ç´¢å¼•æŸ¥è¯¢


### 6.1 æŸ¥è¯¢æ‰§è¡Œæµç¨‹


**ğŸ”¸ æŸ¥è¯¢æ­¥éª¤è¯¦è§£**
```
æ­¥éª¤1: è§£ææŸ¥è¯¢æ¡ä»¶
ç”¨æˆ·æŸ¥è¯¢: SELECT * FROM user WHERE name='å¼ ä¸‰' AND age > 25

æ­¥éª¤2: ç´¢å¼•è·¯ç”±å†³ç­–  
åˆ¤æ–­å“ªäº›ç´¢å¼•å¯ä»¥ä½¿ç”¨ï¼š
- nameç´¢å¼•ï¼šå¯ä»¥ç²¾ç¡®å®šä½
- ageç´¢å¼•ï¼šéœ€è¦èŒƒå›´æŸ¥è¯¢
é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨nameç´¢å¼•

æ­¥éª¤3: æŸ¥è¯¢ç´¢å¼•åˆ†ç‰‡
ä»nameç´¢å¼•ä¸­æŸ¥æ‰¾'å¼ ä¸‰'å¯¹åº”çš„æ•°æ®ä½ç½®

æ­¥éª¤4: è·å–æ•°æ®ä½ç½®
å¾—åˆ°ç»“æœï¼šshard_2, user_id=1001

æ­¥éª¤5: æŸ¥è¯¢æ•°æ®åˆ†ç‰‡
åœ¨shard_2ä¸­æŸ¥è¯¢: SELECT * FROM user WHERE id=1001 AND age > 25

æ­¥éª¤6: è¿”å›æœ€ç»ˆç»“æœ
```

**ğŸ’» æŸ¥è¯¢åè°ƒå™¨å®ç°**
```java
@Service
public class QueryCoordinator {
    
    public List<User> executeQuery(QueryPlan queryPlan) {
        List<DataLocation> locations = new ArrayList<>();
        
        // 1. ä½¿ç”¨æœ€ä¼˜ç´¢å¼•è·å–æ•°æ®ä½ç½®
        if (queryPlan.hasExactIndexCondition()) {
            locations = executeExactIndexQuery(queryPlan);
        } else if (queryPlan.hasRangeIndexCondition()) {
            locations = executeRangeIndexQuery(queryPlan);
        } else {
            // å…¨è¡¨æ‰«ææ‰€æœ‰åˆ†ç‰‡
            locations = executeFullTableScan(queryPlan);
        }
        
        // 2. å¹¶è¡ŒæŸ¥è¯¢æ•°æ®åˆ†ç‰‡
        return locations.parallelStream()
                .map(location -> queryDataShard(location, queryPlan))
                .filter(Objects::nonNull)
                .collect(Collectors.toList());
    }
    
    private User queryDataShard(DataLocation location, QueryPlan plan) {
        DataShard shard = dataShardManager.getShard(location.getShardId());
        return shard.queryByIdWithConditions(location.getDataId(), 
                                           plan.getDataShardConditions());
    }
}
```

### 6.2 æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ ç´¢å¼•é€‰æ‹©ä¼˜åŒ–**
```java
public class IndexSelector {
    
    // è®¡ç®—ç´¢å¼•é€‰æ‹©æ€§å’ŒæŸ¥è¯¢æˆæœ¬
    public IndexPlan selectBestIndex(List<IndexCondition> conditions) {
        List<IndexOption> options = new ArrayList<>();
        
        for (IndexCondition condition : conditions) {
            IndexStatistics stats = getIndexStatistics(condition.getIndexName());
            
            // è®¡ç®—é€‰æ‹©æ€§ï¼šç»“æœæ•°é‡ / æ€»æ•°é‡
            double selectivity = calculateSelectivity(condition, stats);
            
            // è®¡ç®—æŸ¥è¯¢æˆæœ¬ï¼šIOæˆæœ¬ + CPUæˆæœ¬
            double cost = calculateQueryCost(condition, selectivity);
            
            options.add(new IndexOption(condition, selectivity, cost));
        }
        
        // é€‰æ‹©æˆæœ¬æœ€ä½çš„ç´¢å¼•
        return options.stream()
                .min(Comparator.comparing(IndexOption::getCost))
                .map(option -> createIndexPlan(option))
                .orElse(createFullScanPlan());
    }
}
```

**ğŸ“Š æŸ¥è¯¢æ€§èƒ½ç›‘æ§**
```java
@Component
public class QueryPerformanceMonitor {
    
    @EventListener
    public void onQueryExecuted(QueryExecutedEvent event) {
        QueryMetrics metrics = QueryMetrics.builder()
                .queryId(event.getQueryId())
                .executionTime(event.getExecutionTime())
                .indexUsed(event.getIndexUsed())
                .shardsAccessed(event.getShardsAccessed())
                .resultCount(event.getResultCount())
                .build();
                
        // è®°å½•æ…¢æŸ¥è¯¢
        if (metrics.getExecutionTime() > slowQueryThreshold) {
            logSlowQuery(metrics);
            suggestOptimization(metrics);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        updateQueryStatistics(metrics);
    }
}
```

---

## 7. ğŸ”„ ç´¢å¼•åŒæ­¥ä¸ä¸€è‡´æ€§


### 7.1 ç´¢å¼•æ›´æ–°ç­–ç•¥


**ğŸ”¸ åŒæ­¥æ›´æ–°æ¨¡å¼**
åœ¨**åŒä¸€ä¸ªäº‹åŠ¡**ä¸­åŒæ—¶æ›´æ–°æ•°æ®å’Œç´¢å¼•ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ã€‚

```java
@Transactional
public void updateUserWithIndex(User user) {
    try {
        // 1. æ›´æ–°æ•°æ®åˆ†ç‰‡
        dataShardService.updateUser(user);
        
        // 2. æ›´æ–°å…¨å±€ç´¢å¼•
        globalIndexService.updateUserNameIndex(
            user.getName(), 
            user.getShardId(), 
            user.getId()
        );
        
        // 3. å¦‚æœä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å›æ»š
    } catch (Exception e) {
        // äº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»š
        throw new RuntimeException("æ›´æ–°å¤±è´¥", e);
    }
}
```

**ğŸ”¸ å¼‚æ­¥æ›´æ–°æ¨¡å¼**
å…ˆæ›´æ–°æ•°æ®ï¼Œç„¶å**å¼‚æ­¥æ›´æ–°ç´¢å¼•**ï¼Œæé«˜å†™å…¥æ€§èƒ½ä½†å¯èƒ½çŸ­æš‚ä¸ä¸€è‡´ã€‚

```java
@Service
public class AsyncIndexUpdater {
    
    @Autowired
    private MessageQueue indexUpdateQueue;
    
    // æ•°æ®æ›´æ–°åå‘é€ç´¢å¼•æ›´æ–°æ¶ˆæ¯
    public void updateUserAsync(User user) {
        // 1. å…ˆæ›´æ–°æ•°æ®
        dataShardService.updateUser(user);
        
        // 2. å‘é€å¼‚æ­¥ç´¢å¼•æ›´æ–°æ¶ˆæ¯
        IndexUpdateMessage message = IndexUpdateMessage.builder()
                .operation("UPDATE")
                .indexName("user_name_idx")
                .indexValue(user.getName())
                .shardId(user.getShardId())
                .dataId(user.getId())
                .version(user.getVersion())
                .build();
                
        indexUpdateQueue.send(message);
    }
    
    // å¼‚æ­¥å¤„ç†ç´¢å¼•æ›´æ–°
    @RabbitListener(queues = "index.update.queue")
    public void handleIndexUpdate(IndexUpdateMessage message) {
        try {
            globalIndexService.updateIndex(message);
        } catch (Exception e) {
            // é‡è¯•æœºåˆ¶
            retryIndexUpdate(message);
        }
    }
}
```

### 7.2 ä¸€è‡´æ€§æ£€æµ‹æœºåˆ¶


**ğŸ”¸ å®šæœŸä¸€è‡´æ€§æ ¡éªŒ**
```java
@Service
public class IndexConsistencyChecker {
    
    @Scheduled(cron = "0 0 2 * * ?")  // æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
    public void checkConsistency() {
        List<String> allShards = dataShardManager.getAllShardIds();
        
        for (String shardId : allShards) {
            checkShardConsistency(shardId);
        }
    }
    
    private void checkShardConsistency(String shardId) {
        // 1. ä»æ•°æ®åˆ†ç‰‡è·å–æ‰€æœ‰è®°å½•
        List<User> usersInData = dataShardService.getAllUsers(shardId);
        
        // 2. ä»å…¨å±€ç´¢å¼•è·å–è¯¥åˆ†ç‰‡çš„ç´¢å¼•è®°å½•
        List<IndexRecord> indexRecords = globalIndexService
                .getIndexRecordsByShard(shardId);
        
        // 3. å¯¹æ¯”æ•°æ®å’Œç´¢å¼•
        Set<Long> dataIds = usersInData.stream()
                .map(User::getId)
                .collect(Collectors.toSet());
                
        Set<Long> indexIds = indexRecords.stream()
                .map(IndexRecord::getDataId)
                .collect(Collectors.toSet());
        
        // 4. æ‰¾å‡ºä¸ä¸€è‡´çš„è®°å½•
        Set<Long> missingInIndex = Sets.difference(dataIds, indexIds);
        Set<Long> extraInIndex = Sets.difference(indexIds, dataIds);
        
        // 5. ä¿®å¤ä¸ä¸€è‡´
        repairInconsistency(shardId, missingInIndex, extraInIndex);
    }
}
```

### 7.3 å†²çªè§£å†³æœºåˆ¶


**ğŸ”¸ ç‰ˆæœ¬æ§åˆ¶è§£å†³å†²çª**
```java
public class IndexConflictResolver {
    
    // ä½¿ç”¨ç‰ˆæœ¬å·è§£å†³æ›´æ–°å†²çª
    public boolean updateIndexWithVersion(IndexUpdateRequest request) {
        IndexRecord currentRecord = globalIndexService
                .getIndexRecord(request.getIndexName(), request.getIndexValue());
        
        if (currentRecord != null && 
            currentRecord.getVersion() > request.getVersion()) {
            // å½“å‰ç‰ˆæœ¬æ›´æ–°ï¼Œå¿½ç•¥æ—§ç‰ˆæœ¬çš„æ›´æ–°
            log.warn("å¿½ç•¥è¿‡æœŸçš„ç´¢å¼•æ›´æ–°: {}", request);
            return false;
        }
        
        // æ‰§è¡Œç´¢å¼•æ›´æ–°
        return globalIndexService.updateIndex(request);
    }
    
    // åŸºäºæ—¶é—´æˆ³çš„æœ€ç»ˆä¸€è‡´æ€§
    public void resolveConflictByTimestamp(List<IndexUpdateEvent> events) {
        // æŒ‰æ—¶é—´æˆ³æ’åº
        events.sort(Comparator.comparing(IndexUpdateEvent::getTimestamp));
        
        // åº”ç”¨æœ€åçš„æ›´æ–°
        IndexUpdateEvent finalEvent = events.get(events.size() - 1);
        globalIndexService.applyUpdate(finalEvent);
    }
}
```

---

## 8. âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 8.1 ç´¢å¼•ç¼“å­˜ä¼˜åŒ–


**ğŸ”¸ å¤šçº§ç¼“å­˜æ¶æ„**
```java
@Service
public class IndexCacheManager {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private final Cache<String, IndexResult> localCache = 
            Caffeine.newBuilder()
                .maximumSize(10000)
                .expireAfterWrite(5, TimeUnit.MINUTES)
                .build();
    
    // æŸ¥è¯¢ç´¢å¼•ï¼ˆå¸¦ç¼“å­˜ï¼‰
    public List<DataLocation> queryIndex(String indexName, Object value) {
        String cacheKey = buildCacheKey(indexName, value);
        
        // 1. å°è¯•æœ¬åœ°ç¼“å­˜
        IndexResult result = localCache.getIfPresent(cacheKey);
        if (result != null) {
            return result.getLocations();
        }
        
        // 2. å°è¯•Redisç¼“å­˜
        result = (IndexResult) redisTemplate.opsForValue().get(cacheKey);
        if (result != null) {
            localCache.put(cacheKey, result);  // å›å¡«æœ¬åœ°ç¼“å­˜
            return result.getLocations();
        }
        
        // 3. æŸ¥è¯¢æ•°æ®åº“
        List<DataLocation> locations = globalIndexService
                .queryFromDatabase(indexName, value);
        
        // 4. æ›´æ–°ç¼“å­˜
        result = new IndexResult(locations);
        redisTemplate.opsForValue().set(cacheKey, result, 
                Duration.ofMinutes(30));
        localCache.put(cacheKey, result);
        
        return locations;
    }
}
```

### 8.2 æ‰¹é‡æ“ä½œä¼˜åŒ–


**ğŸ”¸ æ‰¹é‡ç´¢å¼•æ›´æ–°**
```java
@Service
public class BatchIndexUpdater {
    
    private final BlockingQueue<IndexUpdateRequest> updateQueue = 
            new ArrayBlockingQueue<>(10000);
    
    @PostConstruct
    public void startBatchProcessor() {
        ScheduledExecutorService executor = Executors.newScheduledThreadPool(2);
        
        // å®šæ—¶æ‰¹é‡å¤„ç†
        executor.scheduleAtFixedRate(this::processBatch, 
                0, 100, TimeUnit.MILLISECONDS);
        
        // é˜Ÿåˆ—æ»¡æ—¶ç«‹å³å¤„ç†
        executor.submit(this::processWhenFull);
    }
    
    public void addUpdateRequest(IndexUpdateRequest request) {
        if (!updateQueue.offer(request)) {
            // é˜Ÿåˆ—æ»¡ï¼Œç«‹å³å¤„ç†ä¸€æ‰¹
            processBatch();
            updateQueue.offer(request);
        }
    }
    
    private void processBatch() {
        List<IndexUpdateRequest> batch = new ArrayList<>();
        updateQueue.drainTo(batch, 1000);  // æœ€å¤šå–1000ä¸ª
        
        if (!batch.isEmpty()) {
            globalIndexService.batchUpdateIndex(batch);
        }
    }
}
```

### 8.3 æŸ¥è¯¢è·¯å¾„ä¼˜åŒ–


**ğŸ”¸ æ™ºèƒ½è·¯ç”±é€‰æ‹©**
```java
public class SmartQueryRouter {
    
    // åŸºäºæŸ¥è¯¢æ¨¡å¼é€‰æ‹©æœ€ä¼˜è·¯å¾„
    public QueryPlan optimizeQuery(QueryCondition condition) {
        QueryStatistics stats = getQueryStatistics(condition);
        
        // æ ¹æ®å†å²æŸ¥è¯¢ç»Ÿè®¡é€‰æ‹©ç­–ç•¥
        if (stats.getSelectivity() < 0.01) {
            // é«˜é€‰æ‹©æ€§ï¼Œä½¿ç”¨ç´¢å¼•æŸ¥è¯¢
            return createIndexQueryPlan(condition);
        } else if (stats.getResultSetSize() < 1000) {
            // ç»“æœé›†è¾ƒå°ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•
            return createIndexQueryPlan(condition);
        } else {
            // ç»“æœé›†è¾ƒå¤§ï¼Œè€ƒè™‘å¹¶è¡Œæ‰«æ
            return createParallelScanPlan(condition);
        }
    }
    
    // è‡ªé€‚åº”è°ƒæ•´æŸ¥è¯¢ç­–ç•¥
    @EventListener
    public void onQueryCompleted(QueryCompletedEvent event) {
        QueryStatistics stats = getQueryStatistics(event.getCondition());
        
        // æ›´æ–°æŸ¥è¯¢ç»Ÿè®¡ä¿¡æ¯
        stats.updateExecutionTime(event.getExecutionTime());
        stats.updateResultSetSize(event.getResultSetSize());
        
        // å¦‚æœæ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œæ ‡è®°ä¸ºéœ€è¦ä¼˜åŒ–
        if (event.getExecutionTime() > slowQueryThreshold) {
            optimizationCandidates.add(event.getCondition());
        }
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å…¨å±€åºåˆ—å·ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¿è¯IDå…¨å±€å”¯ä¸€çš„æœºåˆ¶
ğŸ”¸ åºåˆ—ç”Ÿæˆç­–ç•¥ï¼šå·æ®µæ¨¡å¼ã€é›ªèŠ±ç®—æ³•ã€UUIDç­‰ä¸åŒæ–¹æ¡ˆ
ğŸ”¸ å…¨å±€äºŒçº§ç´¢å¼•ï¼šè·¨åˆ†ç‰‡çš„ç»Ÿä¸€ç´¢å¼•ç³»ç»Ÿ
ğŸ”¸ ç´¢å¼•åˆ†ç‰‡ç­–ç•¥ï¼šå¦‚ä½•å°†ç´¢å¼•æ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹
ğŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šå¦‚ä½•ä¿è¯æ•°æ®å’Œç´¢å¼•çš„ä¸€è‡´æ€§
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜ã€æ‰¹é‡æ“ä½œã€æ™ºèƒ½è·¯ç”±ç­‰ä¼˜åŒ–æ‰‹æ®µ
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å…¨å±€åºåˆ—å·çš„é€‰æ‹©åŸåˆ™**
```
å·æ®µæ¨¡å¼ï¼š
âœ… é€‚åˆï¼šå¯¹è¿ç»­æ€§è¦æ±‚ä¸é«˜ï¼Œè¿½æ±‚é«˜æ€§èƒ½
âŒ ä¸é€‚åˆï¼šéœ€è¦ä¸¥æ ¼è¿ç»­IDçš„åœºæ™¯

é›ªèŠ±ç®—æ³•ï¼š
âœ… é€‚åˆï¼šéœ€è¦æ—¶é—´æ’åºï¼Œåˆ†å¸ƒå¼éƒ¨ç½²
âŒ ä¸é€‚åˆï¼šæ—¶é’ŸåŒæ­¥å›°éš¾çš„ç¯å¢ƒ

UUIDï¼š
âœ… é€‚åˆï¼šå®Œå…¨åˆ†å¸ƒå¼ï¼Œæ— éœ€åè°ƒ
âŒ ä¸é€‚åˆï¼šéœ€è¦çŸ­IDï¼Œæœ‰åºæ€§è¦æ±‚
```

**ğŸ”¹ å…¨å±€ç´¢å¼•çš„æ¶æ„æƒè¡¡**
```
ç´¢å¼•åˆ†ç¦»æ¶æ„ï¼š
â€¢ ä¼˜ç‚¹ï¼šç´¢å¼•å’Œæ•°æ®ç‹¬ç«‹æ‰©å±•ï¼Œæ€§èƒ½æ›´å¥½
â€¢ ç¼ºç‚¹ï¼šä¸€è‡´æ€§ç»´æŠ¤å¤æ‚ï¼Œæˆæœ¬æ›´é«˜

ç´¢å¼•å¤åˆ¶æ¶æ„ï¼š
â€¢ ä¼˜ç‚¹ï¼šæŸ¥è¯¢ç®€å•ï¼Œä¸€è‡´æ€§å®¹æ˜“ä¿è¯
â€¢ ç¼ºç‚¹ï¼šå­˜å‚¨æˆæœ¬é«˜ï¼Œæ›´æ–°å¤æ‚
```

**ğŸ”¹ ä¸€è‡´æ€§ä¸æ€§èƒ½çš„å¹³è¡¡**
```
å¼ºä¸€è‡´æ€§ï¼š
â€¢ åŒæ­¥æ›´æ–°æ•°æ®å’Œç´¢å¼•
â€¢ æ€§èƒ½è¾ƒä½ä½†æ•°æ®å‡†ç¡®

æœ€ç»ˆä¸€è‡´æ€§ï¼š
â€¢ å¼‚æ­¥æ›´æ–°ç´¢å¼•
â€¢ æ€§èƒ½è¾ƒé«˜ä½†å¯èƒ½çŸ­æš‚ä¸ä¸€è‡´

é€‰æ‹©åŸåˆ™ï¼š
â€¢ æ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼šé€‰æ‹©å¼ºä¸€è‡´æ€§
â€¢ æŸ¥è¯¢è¾…åŠ©æ•°æ®ï¼šå¯ä»¥é€‰æ‹©æœ€ç»ˆä¸€è‡´æ€§
```

### 9.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å…¸å‹åº”ç”¨åœºæ™¯**
```
ç”µå•†è®¢å•ç³»ç»Ÿï¼š
â€¢ è®¢å•IDä½¿ç”¨é›ªèŠ±ç®—æ³•ä¿è¯å…¨å±€å”¯ä¸€
â€¢ ç”¨æˆ·åã€æ‰‹æœºå·å»ºç«‹å…¨å±€ç´¢å¼•ä¾¿äºæŸ¥è¯¢
â€¢ è®¢å•çŠ¶æ€ç´¢å¼•æ”¯æŒå¿«é€Ÿç­›é€‰

ç¤¾äº¤ç½‘ç»œç³»ç»Ÿï¼š
â€¢ ç”¨æˆ·IDä½¿ç”¨å·æ®µæ¨¡å¼é«˜æ€§èƒ½ç”Ÿæˆ
â€¢ æ˜µç§°ã€é‚®ç®±å»ºç«‹å…¨å±€ç´¢å¼•
â€¢ å…³æ³¨å…³ç³»ç´¢å¼•æ”¯æŒå¥½å‹æ¨è

é‡‘èäº¤æ˜“ç³»ç»Ÿï¼š
â€¢ äº¤æ˜“æµæ°´å·ä½¿ç”¨å¼ºä¸€è‡´æ€§åºåˆ—å·
â€¢ è´¦æˆ·ç´¢å¼•è¦æ±‚å¼ºä¸€è‡´æ€§
â€¢ äº¤æ˜“è®°å½•ç´¢å¼•æ”¯æŒå®¡è®¡æŸ¥è¯¢
```

**ğŸ”§ å®æ–½å»ºè®®**
```
é¡¹ç›®åˆæœŸï¼š
â€¢ ä¼˜å…ˆé€‰æ‹©ç®€å•å¯é çš„æ–¹æ¡ˆ
â€¢ å·æ®µæ¨¡å¼ + åŸºç¡€å…¨å±€ç´¢å¼•

ä¸šåŠ¡å‘å±•æœŸï¼š
â€¢ æ ¹æ®æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–ç´¢å¼•è®¾è®¡
â€¢ å¼•å…¥ç¼“å­˜æå‡æŸ¥è¯¢æ€§èƒ½

å¤§è§„æ¨¡é˜¶æ®µï¼š
â€¢ è€ƒè™‘ç´¢å¼•åˆ†ç‰‡å’Œæ™ºèƒ½è·¯ç”±
â€¢ å®æ–½è‡ªåŠ¨åŒ–è¿ç»´å’Œç›‘æ§
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- å…¨å±€åºåˆ—å·è§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸‹IDå”¯ä¸€æ€§é—®é¢˜
- é€‰æ‹©åºåˆ—ç”Ÿæˆç­–ç•¥è¦è€ƒè™‘æ€§èƒ½ã€ä¸€è‡´æ€§ã€å¯ç”¨æ€§
- å…¨å±€ç´¢å¼•æä¾›è·¨åˆ†ç‰‡çš„ç»Ÿä¸€æŸ¥è¯¢èƒ½åŠ›
- ç´¢å¼•è®¾è®¡è¦å¹³è¡¡æŸ¥è¯¢æ€§èƒ½å’Œç»´æŠ¤æˆæœ¬
- ä¸€è‡´æ€§ç­–ç•¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»é€‰æ‹©
- æ€§èƒ½ä¼˜åŒ–ä»ç¼“å­˜ã€æ‰¹é‡ã€è·¯ç”±ç­‰å¤šä¸ªç»´åº¦å…¥æ‰‹