---
title: 10ã€åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆ
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼IDåŸºç¡€æ¦‚å¿µ](#1-åˆ†å¸ƒå¼idåŸºç¡€æ¦‚å¿µ)
2. [é›ªèŠ±ç®—æ³•å®ç°](#2-é›ªèŠ±ç®—æ³•å®ç°)
3. [æ•°æ®åº“åºåˆ—æ–¹æ¡ˆ](#3-æ•°æ®åº“åºåˆ—æ–¹æ¡ˆ)
4. [å·æ®µæ¨¡å¼è®¾è®¡](#4-å·æ®µæ¨¡å¼è®¾è®¡)
5. [UUIDç”Ÿæˆæ–¹æ¡ˆ](#5-uuidç”Ÿæˆæ–¹æ¡ˆ)
6. [æ—¶é—´æˆ³IDæ–¹æ¡ˆ](#6-æ—¶é—´æˆ³idæ–¹æ¡ˆ)
7. [IDç”Ÿæˆå™¨é«˜å¯ç”¨](#7-idç”Ÿæˆå™¨é«˜å¯ç”¨)
8. [å¼€æºæ–¹æ¡ˆå¯¹æ¯”](#8-å¼€æºæ–¹æ¡ˆå¯¹æ¯”)
9. [é›†ç¾¤éƒ¨ç½²æ¶æ„](#9-é›†ç¾¤éƒ¨ç½²æ¶æ„)
10. [æ€§èƒ½åŸºå‡†æµ‹è¯•](#10-æ€§èƒ½åŸºå‡†æµ‹è¯•)
11. [ä¸šåŠ¡IDè¯­ä¹‰åŒ–è®¾è®¡](#11-ä¸šåŠ¡idè¯­ä¹‰åŒ–è®¾è®¡)
12. [ç›‘æ§ä¸å‘Šè­¦](#12-ç›‘æ§ä¸å‘Šè­¦)
13. [å…¨å±€å”¯ä¸€æ€§ä¿è¯](#13-å…¨å±€å”¯ä¸€æ€§ä¿è¯)
14. [å®¹ç¾ä¸æ•…éšœè½¬ç§»](#14-å®¹ç¾ä¸æ•…éšœè½¬ç§»)
15. [å¤šæ•°æ®ä¸­å¿ƒåè°ƒ](#15-å¤šæ•°æ®ä¸­å¿ƒåè°ƒ)
16. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#16-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†å¸ƒå¼IDåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ID


**é€šä¿—ç†è§£**ï¼šåˆ†å¸ƒå¼IDå°±åƒç»™å…¨çƒæ¯ä¸ªäººåˆ†é…ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„èº«ä»½è¯å·ç ï¼Œå³ä½¿åœ¨ä¸åŒçš„å›½å®¶ã€ä¸åŒçš„ç³»ç»Ÿä¸­ç”Ÿæˆï¼Œä¹Ÿèƒ½ä¿è¯ç»å¯¹ä¸é‡å¤ã€‚

**åˆ†å¸ƒå¼IDçš„æ ¸å¿ƒç‰¹å¾**ï¼š
- **ğŸ”‘ å…¨å±€å”¯ä¸€æ€§**ï¼šåœ¨æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç»å¯¹ä¸èƒ½é‡å¤
- **âš¡ é«˜æ€§èƒ½ç”Ÿæˆ**ï¼šèƒ½å¤Ÿå¿«é€Ÿå¤§æ‰¹é‡ç”ŸæˆID
- **ğŸ“ˆ å•è°ƒé€’å¢**ï¼šåç”Ÿæˆçš„IDè¦æ¯”å…ˆç”Ÿæˆçš„å¤§ï¼ˆå¯é€‰ï¼‰
- **ğŸ”§ æ˜“äºä½¿ç”¨**ï¼šç”Ÿæˆå’Œä½¿ç”¨éƒ½è¦ç®€å•æ–¹ä¾¿

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼ID


**ä¼ ç»Ÿè‡ªå¢IDçš„é—®é¢˜**ï¼š

```
å•æœºæ•°æ®åº“åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database   â”‚  auto_increment
â”‚  Table: 1,2,3,4,5... â”‚  â† ç®€å•å¯é 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å¸ƒå¼åœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database A  â”‚  â”‚ Database B  â”‚
â”‚ Table: 1,3,5â”‚  â”‚ Table: 2,4,6â”‚  â† IDå¯èƒ½å†²çª
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ†å¸ƒå¼ç¯å¢ƒçš„æŒ‘æˆ˜**ï¼š
- **ğŸ”„ IDå†²çª**ï¼šå¤šä¸ªæœåŠ¡å™¨å¯èƒ½ç”Ÿæˆç›¸åŒçš„ID
- **ğŸ“Š åˆå¹¶å›°éš¾**ï¼šæ¥è‡ªä¸åŒæ•°æ®åº“çš„æ•°æ®éš¾ä»¥åˆå¹¶
- **âš¡ æ€§èƒ½ç“¶é¢ˆ**ï¼šç»Ÿä¸€ç”ŸæˆIDå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- **ğŸ›¡ï¸ å¯ç”¨æ€§è¦æ±‚**ï¼šIDç”ŸæˆæœåŠ¡ä¸èƒ½æˆä¸ºå•ç‚¹æ•…éšœ

### 1.3 åˆ†å¸ƒå¼IDè®¾è®¡è¦æ±‚


**æ ¸å¿ƒè®¾è®¡æŒ‡æ ‡**ï¼š

| ç‰¹æ€§ | å¿…é¡» | å¯é€‰ | è¯´æ˜ |
|------|------|------|------|
| **å…¨å±€å”¯ä¸€** | âœ… | - | ç»å¯¹ä¸èƒ½é‡å¤ |
| **é«˜å¹¶å‘** | âœ… | - | æ”¯æŒå¤§é‡å¹¶å‘è¯·æ±‚ |
| **é«˜å¯ç”¨** | âœ… | - | æœåŠ¡ä¸èƒ½å•ç‚¹æ•…éšœ |
| **å•è°ƒé€’å¢** | - | âœ… | æœ‰åˆ©äºæ•°æ®åº“ç´¢å¼•æ€§èƒ½ |
| **ä¿¡æ¯å®‰å…¨** | - | âœ… | ä¸èƒ½è½»æ˜“è¢«çŒœæµ‹è§„å¾‹ |
| **å«æ—¶é—´æˆ³** | - | âœ… | ä¾¿äºæŒ‰æ—¶é—´æ’åºæŸ¥è¯¢ |

---

## 2. â„ï¸ é›ªèŠ±ç®—æ³•å®ç°


### 2.1 é›ªèŠ±ç®—æ³•åŸç†


**é€šä¿—ç†è§£**ï¼šé›ªèŠ±ç®—æ³•å°±åƒåˆ¶ä½œç‹¬ç‰¹çš„é›ªèŠ±ï¼Œæ¯ç‰‡é›ªèŠ±éƒ½ç”±æ—¶é—´æˆ³ã€æœºå™¨ç¼–å·ã€åºåˆ—å·ç»„æˆï¼Œä¿è¯æ¯ç‰‡éƒ½ç‹¬ä¸€æ— äºŒã€‚

**é›ªèŠ±ç®—æ³•ç»“æ„**ï¼ˆ64ä½ï¼‰ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1bit â”‚    41bit     â”‚   10bit    â”‚      12bit      â”‚
â”‚ ç¬¦å·ä½ â”‚    æ—¶é—´æˆ³     â”‚   æœºå™¨ID    â”‚     åºåˆ—å·       â”‚
â”‚  0   â”‚1288834974657 â”‚    1023    â”‚      4095       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ—¶é—´æˆ³ï¼šæ¯«ç§’çº§æ—¶é—´ï¼Œå¯ç”¨69å¹´
æœºå™¨IDï¼šæ”¯æŒ1024å°æœºå™¨
åºåˆ—å·ï¼šæ¯æ¯«ç§’æœ€å¤š4096ä¸ªID
```

### 2.2 é›ªèŠ±ç®—æ³•å®ç°


```java
public class SnowflakeIdGenerator {
    // èµ·å§‹æ—¶é—´æˆ³ (2020-01-01)
    private final long START_TIMESTAMP = 1577808000000L;
    
    // ä½æ•°åˆ†é…
    private final long SEQUENCE_BITS = 12L;
    private final long MACHINE_BITS = 10L;
    private final long TIMESTAMP_BITS = 41L;
    
    // æœ€å¤§å€¼
    private final long MAX_SEQUENCE = (1L << SEQUENCE_BITS) - 1;
    private final long MAX_MACHINE_ID = (1L << MACHINE_BITS) - 1;
    
    // ä½ç§»é‡
    private final long MACHINE_SHIFT = SEQUENCE_BITS;
    private final long TIMESTAMP_SHIFT = SEQUENCE_BITS + MACHINE_BITS;
    
    private long machineId;
    private long sequence = 0L;
    private long lastTimestamp = -1L;
    
    public SnowflakeIdGenerator(long machineId) {
        if (machineId > MAX_MACHINE_ID || machineId < 0) {
            throw new IllegalArgumentException("æœºå™¨IDè¶…å‡ºèŒƒå›´");
        }
        this.machineId = machineId;
    }
    
    public synchronized long nextId() {
        long currentTimestamp = System.currentTimeMillis();
        
        // æ—¶é’Ÿå›æ‹¨æ£€æŸ¥
        if (currentTimestamp < lastTimestamp) {
            throw new RuntimeException("æ—¶é’Ÿå›æ‹¨å¼‚å¸¸");
        }
        
        // åŒä¸€æ¯«ç§’å†…
        if (currentTimestamp == lastTimestamp) {
            sequence = (sequence + 1) & MAX_SEQUENCE;
            if (sequence == 0) {
                // åºåˆ—å·ç”¨å®Œï¼Œç­‰å¾…ä¸‹ä¸€æ¯«ç§’
                currentTimestamp = waitUntilNextMillis(lastTimestamp);
            }
        } else {
            sequence = 0L;
        }
        
        lastTimestamp = currentTimestamp;
        
        return ((currentTimestamp - START_TIMESTAMP) << TIMESTAMP_SHIFT)
               | (machineId << MACHINE_SHIFT)
               | sequence;
    }
    
    private long waitUntilNextMillis(long lastTimestamp) {
        long timestamp = System.currentTimeMillis();
        while (timestamp <= lastTimestamp) {
            timestamp = System.currentTimeMillis();
        }
        return timestamp;
    }
}
```

### 2.3 é›ªèŠ±ç®—æ³•ä¼˜åŒ–


**æ—¶é’Ÿå›æ‹¨å¤„ç†**ï¼š
```java
public class ImprovedSnowflake {
    private volatile long lastTimestamp = -1L;
    
    public synchronized long nextId() {
        long currentTimestamp = System.currentTimeMillis();
        
        // æ—¶é’Ÿå›æ‹¨å¤„ç†ç­–ç•¥
        if (currentTimestamp < lastTimestamp) {
            long offset = lastTimestamp - currentTimestamp;
            if (offset <= 5) {
                // å°å¹…å›æ‹¨ï¼Œç­‰å¾…æ¢å¤
                try {
                    Thread.sleep(offset << 1);
                    currentTimestamp = System.currentTimeMillis();
                } catch (InterruptedException e) {
                    throw new RuntimeException("ç­‰å¾…æ—¶é’Ÿæ¢å¤è¢«ä¸­æ–­");
                }
            } else {
                // å¤§å¹…å›æ‹¨ï¼ŒæŠ›å‡ºå¼‚å¸¸
                throw new RuntimeException("æ—¶é’Ÿå›æ‹¨è¶…è¿‡é˜ˆå€¼: " + offset + "ms");
            }
        }
        
        // å…¶ä»–é€»è¾‘...
    }
}
```

**æœºå™¨IDè‡ªåŠ¨è·å–**ï¼š
```java
public static long getMachineId() {
    try {
        InetAddress ip = InetAddress.getLocalHost();
        NetworkInterface network = NetworkInterface.getByInetAddress(ip);
        
        long id;
        if (network == null) {
            id = 1L;
        } else {
            byte[] mac = network.getHardwareAddress();
            if (mac != null) {
                id = ((0x000000FF & (long) mac[mac.length - 2]) 
                     | (0x0000FF00 & (((long) mac[mac.length - 1]) << 8))) >> 6;
                id = id % (MAX_MACHINE_ID + 1);
            } else {
                id = 1L;
            }
        }
        return id;
    } catch (Exception e) {
        return 1L;
    }
}
```

---

## 3. ğŸ—„ï¸ æ•°æ®åº“åºåˆ—æ–¹æ¡ˆ


### 3.1 å•æ•°æ®åº“åºåˆ—æ–¹æ¡ˆ


**åŸºæœ¬å®ç°æ€è·¯**ï¼šåˆ©ç”¨æ•°æ®åº“çš„è‡ªå¢ç‰¹æ€§ç”Ÿæˆå”¯ä¸€IDï¼Œé€‚åˆå¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚

```sql
-- åˆ›å»ºIDç”Ÿæˆè¡¨
CREATE TABLE id_generator (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    stub CHAR(1) NOT NULL DEFAULT '',
    UNIQUE KEY stub (stub)
) ENGINE=InnoDB;

-- æ’å…¥åˆå§‹è®°å½•
INSERT INTO id_generator (stub) VALUES ('a');

-- ç”ŸæˆIDçš„å­˜å‚¨è¿‡ç¨‹
DELIMITER $$
CREATE FUNCTION next_id() RETURNS BIGINT
READS SQL DATA
DETERMINISTIC
BEGIN
    UPDATE id_generator SET id = LAST_INSERT_ID(id + 1);
    RETURN LAST_INSERT_ID();
END$$
DELIMITER ;
```

**Javaå®¢æˆ·ç«¯å®ç°**ï¼š
```java
@Service
public class DatabaseIdGenerator {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public Long nextId() {
        return jdbcTemplate.queryForObject("SELECT next_id()", Long.class);
    }
    
    // æ‰¹é‡è·å–ID
    public List<Long> nextIds(int count) {
        List<Long> ids = new ArrayList<>();
        for (int i = 0; i < count; i++) {
            ids.add(nextId());
        }
        return ids;
    }
}
```

### 3.2 å¤šæ•°æ®åº“åºåˆ—æ–¹æ¡ˆ


**æ­¥é•¿åˆ†é…ç­–ç•¥**ï¼šå¤šä¸ªæ•°æ®åº“ä½¿ç”¨ä¸åŒçš„èµ·å§‹å€¼å’Œæ­¥é•¿ï¼Œé¿å…IDå†²çªã€‚

```sql
-- æ•°æ®åº“1è®¾ç½®
SET $$auto_increment_offset = 1;     -- èµ·å§‹å€¼ï¼š1
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ï¼š3
-- ç”ŸæˆIDï¼š1, 4, 7, 10, 13...

-- æ•°æ®åº“2è®¾ç½®  
SET $$auto_increment_offset = 2;     -- èµ·å§‹å€¼ï¼š2
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ï¼š3
-- ç”ŸæˆIDï¼š2, 5, 8, 11, 14...

-- æ•°æ®åº“3è®¾ç½®
SET $$auto_increment_offset = 3;     -- èµ·å§‹å€¼ï¼š3  
SET $$auto_increment_increment = 3;  -- æ­¥é•¿ï¼š3
-- ç”ŸæˆIDï¼š3, 6, 9, 12, 15...
```

**è´Ÿè½½å‡è¡¡å®ç°**ï¼š
```java
@Component
public class MultiDbIdGenerator {
    
    private final List<JdbcTemplate> jdbcTemplates;
    private final AtomicInteger counter = new AtomicInteger(0);
    
    public MultiDbIdGenerator(List<DataSource> dataSources) {
        this.jdbcTemplates = dataSources.stream()
            .map(JdbcTemplate::new)
            .collect(Collectors.toList());
    }
    
    public Long nextId() {
        // è½®è¯¢é€‰æ‹©æ•°æ®åº“
        int index = counter.getAndIncrement() % jdbcTemplates.size();
        JdbcTemplate template = jdbcTemplates.get(index);
        
        return template.queryForObject("SELECT next_id()", Long.class);
    }
}
```

---

## 4. ğŸ“Š å·æ®µæ¨¡å¼è®¾è®¡


### 4.1 å·æ®µæ¨¡å¼åŸç†


**é€šä¿—ç†è§£**ï¼šå·æ®µæ¨¡å¼å°±åƒæ‰¹å‘å•†å…ˆä»å·¥å‚æ‰¹é‡æ‹¿è´§ï¼Œç„¶åæ…¢æ…¢é›¶å”®ã€‚IDç”Ÿæˆå™¨å…ˆä»æ•°æ®åº“æ‰¹é‡è·å–ä¸€æ®µè¿ç»­çš„IDï¼Œç„¶ååœ¨å†…å­˜ä¸­é€ä¸ªåˆ†é…ã€‚

**å·æ®µæ¨¡å¼æµç¨‹**ï¼š
```
ç¬¬ä¸€æ­¥ï¼šä»æ•°æ®åº“è·å–å·æ®µ [1000, 2000)
ç¬¬äºŒæ­¥ï¼šåœ¨å†…å­˜ä¸­åˆ†é…ï¼š1000, 1001, 1002...
ç¬¬ä¸‰æ­¥ï¼šå·æ®µç”¨å®Œå‰ï¼Œé¢„ç”³è¯·ä¸‹ä¸€æ®µ [2000, 3000)
ç¬¬å››æ­¥ï¼šæ— ç¼åˆ‡æ¢åˆ°æ–°å·æ®µç»§ç»­åˆ†é…
```

### 4.2 å·æ®µæ¨¡å¼å®ç°


**æ•°æ®åº“è¡¨è®¾è®¡**ï¼š
```sql
CREATE TABLE id_segment (
    biz_tag VARCHAR(63) NOT NULL COMMENT 'ä¸šåŠ¡æ ‡è¯†',
    max_id BIGINT NOT NULL COMMENT 'å½“å‰æœ€å¤§ID',
    step INT NOT NULL COMMENT 'å·æ®µæ­¥é•¿',
    description VARCHAR(255) COMMENT 'æè¿°',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (biz_tag)
) ENGINE=InnoDB;

-- åˆå§‹åŒ–ä¸šåŠ¡å·æ®µ
INSERT INTO id_segment (biz_tag, max_id, step, description) 
VALUES ('order', 0, 1000, 'è®¢å•IDç”Ÿæˆå™¨');
```

**æ ¸å¿ƒå®ç°ä»£ç **ï¼š
```java
public class SegmentIdGenerator {
    
    private volatile Segment currentSegment;
    private volatile Segment nextSegment;
    private final Object lock = new Object();
    
    public Long nextId(String bizTag) {
        if (currentSegment == null) {
            synchronized (lock) {
                if (currentSegment == null) {
                    currentSegment = getNewSegment(bizTag);
                }
            }
        }
        
        Long id = currentSegment.nextId();
        
        // å·æ®µç”¨åˆ°90%æ—¶ï¼Œå¼‚æ­¥åŠ è½½ä¸‹ä¸€ä¸ªå·æ®µ
        if (currentSegment.getUsagePercent() > 0.9 && nextSegment == null) {
            synchronized (lock) {
                if (nextSegment == null) {
                    nextSegment = getNewSegment(bizTag);
                }
            }
        }
        
        // å½“å‰å·æ®µç”¨å®Œï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€å·æ®µ
        if (id == null) {
            synchronized (lock) {
                if (nextSegment != null) {
                    currentSegment = nextSegment;
                    nextSegment = null;
                    return currentSegment.nextId();
                }
            }
        }
        
        return id;
    }
    
    private Segment getNewSegment(String bizTag) {
        // æ•°æ®åº“æ›´æ–°è·å–æ–°å·æ®µ
        String sql = "UPDATE id_segment SET max_id = max_id + step WHERE biz_tag = ?";
        jdbcTemplate.update(sql, bizTag);
        
        String querySql = "SELECT max_id, step FROM id_segment WHERE biz_tag = ?";
        Map<String, Object> result = jdbcTemplate.queryForMap(querySql, bizTag);
        
        Long maxId = (Long) result.get("max_id");
        Integer step = (Integer) result.get("step");
        
        return new Segment(maxId - step + 1, maxId);
    }
}

class Segment {
    private final AtomicLong currentId;
    private final Long maxId;
    private final Long minId;
    
    public Segment(Long minId, Long maxId) {
        this.minId = minId;
        this.maxId = maxId;
        this.currentId = new AtomicLong(minId);
    }
    
    public Long nextId() {
        long id = currentId.getAndIncrement();
        return id <= maxId ? id : null;
    }
    
    public double getUsagePercent() {
        return (double)(currentId.get() - minId) / (maxId - minId + 1);
    }
}
```

### 4.3 å·æ®µæ¨¡å¼ä¼˜åŒ–


**åŠ¨æ€è°ƒæ•´æ­¥é•¿**ï¼š
```java
public class AdaptiveSegmentGenerator {
    
    private final Map<String, SegmentMetrics> metricsMap = new ConcurrentHashMap<>();
    
    private int calculateOptimalStep(String bizTag) {
        SegmentMetrics metrics = metricsMap.get(bizTag);
        if (metrics == null) {
            return 1000; // é»˜è®¤æ­¥é•¿
        }
        
        // æ ¹æ®QPSåŠ¨æ€è°ƒæ•´
        long qps = metrics.getQps();
        if (qps > 10000) {
            return 10000;
        } else if (qps > 1000) {
            return 5000;
        } else {
            return 1000;
        }
    }
}
```

---

## 5. ğŸ†” UUIDç”Ÿæˆæ–¹æ¡ˆ


### 5.1 UUIDåŸºç¡€æ¦‚å¿µ


**é€šä¿—ç†è§£**ï¼šUUIDå°±åƒä¸€ä¸ª32ä½çš„"è½¦ç‰Œå·"ï¼Œé€šè¿‡å¤æ‚çš„ç®—æ³•ä¿è¯å…¨çƒå”¯ä¸€ï¼Œä¸éœ€è¦ä¸­å¿ƒåŒ–åè°ƒã€‚

**UUIDç‰ˆæœ¬å¯¹æ¯”**ï¼š

| ç‰ˆæœ¬ | ç®—æ³•åŸºç¡€ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|---------|------|------|---------|
| **UUID1** | MACåœ°å€+æ—¶é—´æˆ³ | åŒ…å«æ—¶é—´ä¿¡æ¯ | æš´éœ²MACåœ°å€ | éœ€è¦æ—¶é—´æ’åº |
| **UUID4** | éšæœºæ•° | å®Œå…¨éšæœºï¼Œå®‰å…¨æ€§é«˜ | æ— ä¸šåŠ¡å«ä¹‰ | é€šç”¨åœºæ™¯ |
| **UUID7** | æ—¶é—´æˆ³+éšæœºæ•° | æ—¶é—´æœ‰åºï¼Œæ€§èƒ½å¥½ | è¾ƒæ–°æ ‡å‡† | é«˜æ€§èƒ½æ•°æ®åº“ |

### 5.2 ä¼˜åŒ–çš„UUIDå®ç°


**æœ‰åºUUIDç”Ÿæˆ**ï¼š
```java
public class OrderedUuidGenerator {
    
    public String generateOrderedUuid() {
        // è·å–å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
        long timestamp = System.currentTimeMillis();
        
        // ç”Ÿæˆéšæœºéƒ¨åˆ†
        UUID randomUuid = UUID.randomUUID();
        
        // å°†æ—¶é—´æˆ³æ”¾åœ¨å‰é¢ï¼Œä¿è¯æœ‰åºæ€§
        String timestampHex = String.format("%012x", timestamp);
        String randomPart = randomUuid.toString().replace("-", "").substring(12);
        
        // æ ¼å¼åŒ–ä¸ºæ ‡å‡†UUIDæ ¼å¼
        StringBuilder sb = new StringBuilder();
        sb.append(timestampHex.substring(0, 8)).append("-")
          .append(timestampHex.substring(8, 12)).append("-")
          .append("4").append(randomPart.substring(0, 3)).append("-")
          .append(randomPart.substring(3, 7)).append("-")
          .append(randomPart.substring(7, 19));
          
        return sb.toString();
    }
}
```

**çŸ­UUIDå®ç°**ï¼š
```java
public class ShortUuidGenerator {
    
    private static final String ALPHABET = "23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz";
    
    public String generateShortId() {
        UUID uuid = UUID.randomUUID();
        return encode(uuid);
    }
    
    private String encode(UUID uuid) {
        long mostSigBits = uuid.getMostSignificantBits();
        long leastSigBits = uuid.getLeastSignificantBits();
        
        // å°†UUIDè½¬æ¢ä¸ºBase58ç¼–ç 
        BigInteger number = new BigInteger(1, toByteArray(mostSigBits, leastSigBits));
        
        StringBuilder result = new StringBuilder();
        while (number.compareTo(BigInteger.ZERO) > 0) {
            BigInteger[] divmod = number.divideAndRemainder(BigInteger.valueOf(ALPHABET.length()));
            result.insert(0, ALPHABET.charAt(divmod[1].intValue()));
            number = divmod[0];
        }
        
        return result.toString();
    }
    
    private byte[] toByteArray(long mostSigBits, long leastSigBits) {
        byte[] bytes = new byte[16];
        for (int i = 0; i < 8; i++) {
            bytes[i] = (byte) (mostSigBits >>> (8 * (7 - i)));
            bytes[8 + i] = (byte) (leastSigBits >>> (8 * (7 - i)));
        }
        return bytes;
    }
}
```

---

## 6. â° æ—¶é—´æˆ³IDæ–¹æ¡ˆ


### 6.1 æ—¶é—´æˆ³IDè®¾è®¡


**åŸºæœ¬ç»“æ„**ï¼šæ—¶é—´æˆ³IDç”±æ—¶é—´æˆ³ã€æœºå™¨æ ‡è¯†ã€åºåˆ—å·ç»„æˆï¼Œç®€åŒ–ç‰ˆçš„é›ªèŠ±ç®—æ³•ã€‚

```
æ—¶é—´æˆ³IDç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æ—¶é—´æˆ³       â”‚ æœºå™¨ID  â”‚   åºåˆ—å·     â”‚
â”‚  20241201143000 â”‚   01    â”‚    0001     â”‚ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç®€å•å®ç°**ï¼š
```java
public class TimestampIdGenerator {
    
    private final int machineId;
    private final AtomicInteger sequence = new AtomicInteger(0);
    private volatile long lastTimestamp = 0;
    
    public TimestampIdGenerator(int machineId) {
        this.machineId = machineId;
    }
    
    public synchronized String nextId() {
        long currentTime = System.currentTimeMillis();
        
        // å¦‚æœæ˜¯åŒä¸€æ¯«ç§’ï¼Œåºåˆ—å·é€’å¢
        if (currentTime == lastTimestamp) {
            int seq = sequence.incrementAndGet();
            if (seq > 9999) {
                // ç­‰å¾…ä¸‹ä¸€æ¯«ç§’
                while (currentTime <= lastTimestamp) {
                    currentTime = System.currentTimeMillis();
                }
                sequence.set(0);
            }
        } else {
            sequence.set(0);
            lastTimestamp = currentTime;
        }
        
        // æ ¼å¼åŒ–ID
        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMddHHmmssSSS");
        String timestamp = sdf.format(new Date(currentTime));
        
        return String.format("%s%02d%04d", timestamp, machineId, sequence.get());
    }
}
```

### 6.2 å¯è¯»æ€§å¢å¼º


**ä¸šåŠ¡å‰ç¼€å¢å¼º**ï¼š
```java
public class BusinessTimestampId {
    
    private final Map<String, String> prefixMap = Map.of(
        "order", "ORD",
        "user", "USR", 
        "product", "PRD"
    );
    
    public String nextId(String bizType) {
        String prefix = prefixMap.getOrDefault(bizType, "DEF");
        String timestamp = String.valueOf(System.currentTimeMillis());
        String random = String.format("%04d", new Random().nextInt(10000));
        
        return prefix + timestamp + random;
    }
}
```

---

## 7. ğŸ›¡ï¸ IDç”Ÿæˆå™¨é«˜å¯ç”¨


### 7.1 é«˜å¯ç”¨æ¶æ„è®¾è®¡


**ä¸»å¤‡æ¨¡å¼**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è´Ÿè½½å‡è¡¡å™¨                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ä¸»IDæœåŠ¡å™¨  â”‚ â”‚  å¤‡IDæœåŠ¡å™¨  â”‚
    â”‚   Active   â”‚ â”‚  Standby   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         å…±äº«å­˜å‚¨/æ•°æ®åº“              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é›†ç¾¤æ¨¡å¼**ï¼š
```java
@Component
public class ClusterIdGenerator {
    
    private final List<IdService> idServices;
    private final CircuitBreaker circuitBreaker;
    
    public Long nextId() {
        for (IdService service : idServices) {
            try {
                if (circuitBreaker.isServiceAvailable(service)) {
                    return service.generateId();
                }
            } catch (Exception e) {
                circuitBreaker.recordFailure(service);
                // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæœåŠ¡
            }
        }
        throw new RuntimeException("æ‰€æœ‰IDæœåŠ¡ä¸å¯ç”¨");
    }
}
```

### 7.2 ç†”æ–­ä¸é™çº§


**ç†”æ–­å™¨å®ç°**ï¼š
```java
public class IdServiceCircuitBreaker {
    
    private final Map<IdService, ServiceState> serviceStates = new ConcurrentHashMap<>();
    
    static class ServiceState {
        AtomicInteger failureCount = new AtomicInteger(0);
        long lastFailureTime = 0;
        boolean isOpen = false;
    }
    
    public boolean isServiceAvailable(IdService service) {
        ServiceState state = serviceStates.computeIfAbsent(service, k -> new ServiceState());
        
        if (state.isOpen) {
            // ç†”æ–­å¼€å¯ï¼Œæ£€æŸ¥æ˜¯å¦å¯ä»¥å°è¯•æ¢å¤
            if (System.currentTimeMillis() - state.lastFailureTime > 60000) { // 1åˆ†é’Ÿåå°è¯•æ¢å¤
                state.isOpen = false;
                state.failureCount.set(0);
                return true;
            }
            return false;
        }
        
        return true;
    }
    
    public void recordFailure(IdService service) {
        ServiceState state = serviceStates.get(service);
        if (state != null) {
            state.lastFailureTime = System.currentTimeMillis();
            if (state.failureCount.incrementAndGet() >= 5) { // è¿ç»­5æ¬¡å¤±è´¥åˆ™ç†”æ–­
                state.isOpen = true;
            }
        }
    }
}
```

---

## 8. ğŸ”§ å¼€æºæ–¹æ¡ˆå¯¹æ¯”


### 8.1 ç¾å›¢Leafæ–¹æ¡ˆ


**Leafç‰¹ç‚¹**ï¼š
- **åŒæ¨¡å¼æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒå·æ®µæ¨¡å¼å’Œé›ªèŠ±ç®—æ³•æ¨¡å¼
- **é«˜å¯ç”¨ä¿è¯**ï¼šå…·å¤‡å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- **ç®€å•é›†æˆ**ï¼šæä¾›HTTPæ¥å£ï¼Œæ˜“äºé›†æˆ

**æ ¸å¿ƒé…ç½®**ï¼š
```properties
# Leafå·æ®µæ¨¡å¼é…ç½®
leaf.segment.enable=true
leaf.segment.url=jdbc:mysql://localhost:3306/leaf
leaf.segment.username=root
leaf.segment.password=password

# Leafé›ªèŠ±ç®—æ³•é…ç½®  
leaf.snowflake.enable=true
leaf.snowflake.zk.address=localhost:2181
leaf.snowflake.port=8080
```

### 8.2 ç™¾åº¦UidGenerator


**UidGeneratorç‰¹ç‚¹**ï¼š
- **æ—¶é—´å›æ‹¨å¤„ç†**ï¼šé€šè¿‡RingBufferè§£å†³æ—¶é’Ÿå›æ‹¨é—®é¢˜
- **é«˜æ€§èƒ½è®¾è®¡**ï¼šé¢„åˆ†é…IDåˆ°ç¯å½¢ç¼“å†²åŒº
- **Springé›†æˆ**ï¼šä¸Springæ¡†æ¶æ·±åº¦é›†æˆ

**åŸºæœ¬ä½¿ç”¨**ï¼š
```java
@Autowired
private UidGenerator uidGenerator;

public long getUID() {
    return uidGenerator.getUID();
}
```

### 8.3 æ»´æ»´TinyID


**TinyIDç‰¹ç‚¹**ï¼š
- **è½»é‡çº§è®¾è®¡**ï¼šæœ€å°åŒ–ä¾èµ–ï¼Œæ˜“äºéƒ¨ç½²
- **å¤šå·æ®µä¼˜åŒ–**ï¼šæ”¯æŒå¤šä¸ªå·æ®µåŒæ—¶å·¥ä½œ
- **å®æ—¶ç›‘æ§**ï¼šæä¾›è¯¦ç»†çš„è¿è¡ŒçŠ¶æ€ç›‘æ§

**æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“**ï¼š

| ç‰¹æ€§ | Leaf | UidGenerator | TinyID |
|------|------|-------------|--------|
| **å¤æ‚åº¦** | ä¸­ç­‰ | è¾ƒé«˜ | ç®€å• |
| **æ€§èƒ½** | é«˜ | å¾ˆé«˜ | é«˜ |
| **å¯ç”¨æ€§** | å¾ˆå¥½ | å¥½ | å¥½ |
| **ç»´æŠ¤æˆæœ¬** | ä¸­ç­‰ | é«˜ | ä½ |

---

## 9. ğŸ—ï¸ é›†ç¾¤éƒ¨ç½²æ¶æ„


### 9.1 å¤šæœºæˆ¿éƒ¨ç½²


**è·¨æœºæˆ¿æ¶æ„è®¾è®¡**ï¼š
```
          æœºæˆ¿A                æœºæˆ¿B                æœºæˆ¿C
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  IDæœåŠ¡é›†ç¾¤      â”‚  â”‚  IDæœåŠ¡é›†ç¾¤      â”‚  â”‚  IDæœåŠ¡é›†ç¾¤      â”‚
    â”‚  æœºå™¨ID: 1-100  â”‚  â”‚  æœºå™¨ID: 101-200â”‚  â”‚  æœºå™¨ID: 201-300â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                é…ç½®ä¸­å¿ƒ/æ³¨å†Œä¸­å¿ƒ                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é…ç½®ç®¡ç†**ï¼š
```yaml
# æœºæˆ¿Aé…ç½®
datacenter:
  id: 1
  machine-id-range: 
    start: 1
    end: 100
    
# æœºæˆ¿Bé…ç½®  
datacenter:
  id: 2
  machine-id-range:
    start: 101
    end: 200
```

### 9.2 åŠ¨æ€æ‰©å®¹æ–¹æ¡ˆ


**è‡ªåŠ¨æ‰©å®¹ç­–ç•¥**ï¼š
```java
@Component
public class AutoScaleManager {
    
    @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    public void checkAndScale() {
        Metrics metrics = collectMetrics();
        
        if (metrics.getQps() > 50000 && metrics.getCpuUsage() > 80) {
            // è§¦å‘æ‰©å®¹
            scaleOut();
        } else if (metrics.getQps() < 10000 && metrics.getInstanceCount() > 2) {
            // è§¦å‘ç¼©å®¹
            scaleIn();
        }
    }
    
    private void scaleOut() {
        // ç”³è¯·æ–°æœºå™¨ID
        int newMachineId = allocateNewMachineId();
        
        // å¯åŠ¨æ–°å®ä¾‹
        startNewInstance(newMachineId);
        
        // æ›´æ–°è´Ÿè½½å‡è¡¡é…ç½®
        updateLoadBalancer();
    }
}
```

---

## 10. ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•


### 10.1 æµ‹è¯•æ–¹æ¡ˆè®¾è®¡


**æµ‹è¯•åœºæ™¯å®šä¹‰**ï¼š
```java
@Component
public class IdGeneratorBenchmark {
    
    @Test
    public void singleThreadTest() {
        // å•çº¿ç¨‹æ€§èƒ½æµ‹è¯•
        long startTime = System.currentTimeMillis();
        for (int i = 0; i < 100000; i++) {
            idGenerator.nextId();
        }
        long endTime = System.currentTimeMillis();
        
        long qps = 100000 * 1000 / (endTime - startTime);
        System.out.println("å•çº¿ç¨‹QPS: " + qps);
    }
    
    @Test
    public void concurrentTest() throws InterruptedException {
        // å¹¶å‘æ€§èƒ½æµ‹è¯•
        int threadCount = 10;
        int iterationsPerThread = 10000;
        CountDownLatch latch = new CountDownLatch(threadCount);
        
        long startTime = System.currentTimeMillis();
        
        for (int i = 0; i < threadCount; i++) {
            new Thread(() -> {
                for (int j = 0; j < iterationsPerThread; j++) {
                    idGenerator.nextId();
                }
                latch.countDown();
            }).start();
        }
        
        latch.await();
        long endTime = System.currentTimeMillis();
        
        long totalOperations = threadCount * iterationsPerThread;
        long qps = totalOperations * 1000 / (endTime - startTime);
        System.out.println("å¹¶å‘QPS: " + qps);
    }
}
```

### 10.2 æ€§èƒ½æµ‹è¯•ç»“æœ


**åŸºå‡†æµ‹è¯•æ•°æ®**ï¼š

| æ–¹æ¡ˆ | å•çº¿ç¨‹QPS | 10çº¿ç¨‹QPS | 100çº¿ç¨‹QPS | å†…å­˜å ç”¨ |
|------|----------|-----------|------------|---------|
| **é›ªèŠ±ç®—æ³•** | 400ä¸‡ | 300ä¸‡ | 200ä¸‡ | æä½ |
| **å·æ®µæ¨¡å¼** | 500ä¸‡ | 400ä¸‡ | 300ä¸‡ | ä½ |
| **æ•°æ®åº“åºåˆ—** | 1000 | 5000 | 10000 | ä½ |
| **UUID** | 200ä¸‡ | 150ä¸‡ | 100ä¸‡ | æä½ |

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
- **é«˜QPSåœºæ™¯**ï¼šé€‰æ‹©å·æ®µæ¨¡å¼
- **ä½å»¶è¿Ÿè¦æ±‚**ï¼šé€‰æ‹©é›ªèŠ±ç®—æ³•
- **ç®€å•éƒ¨ç½²**ï¼šé€‰æ‹©UUIDæ–¹æ¡ˆ
- **å¼ºä¸€è‡´æ€§**ï¼šé€‰æ‹©æ•°æ®åº“åºåˆ—

---

## 11. ğŸ·ï¸ ä¸šåŠ¡IDè¯­ä¹‰åŒ–è®¾è®¡


### 11.1 è¯­ä¹‰åŒ–IDè®¾è®¡åŸåˆ™


**é€šä¿—ç†è§£**ï¼šè¯­ä¹‰åŒ–IDå°±åƒè½¦ç‰Œå·ï¼Œé€šè¿‡IDå°±èƒ½çœ‹å‡ºä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚å“ªä¸ªåŸå¸‚ã€ä»€ä¹ˆæ—¶é—´ç”³è¯·çš„ã€‚

**è¯­ä¹‰åŒ–IDç»“æ„**ï¼š
```
è®¢å•IDç¤ºä¾‹ï¼šORD20241201BJ0001234567
â”‚   â”‚       â”‚ â”‚          â”‚
â”‚   â”‚       â”‚ â”‚          â””â”€ åºåˆ—å·(10ä½)
â”‚   â”‚       â”‚ â””â”€ åœ°åŒºç (2ä½) 
â”‚   â”‚       â””â”€ æ—¥æœŸ(8ä½)
â”‚   â””â”€ ä¸šåŠ¡ç±»å‹(3ä½)
â””â”€ å‰ç¼€æ ‡è¯†
```

**è®¾è®¡å®ç°**ï¼š
```java
public class SemanticIdGenerator {
    
    private final Map<String, BizConfig> bizConfigs = Map.of(
        "order", new BizConfig("ORD", 10),
        "user", new BizConfig("USR", 8),
        "product", new BizConfig("PRD", 12)
    );
    
    public String generateId(String bizType, String regionCode) {
        BizConfig config = bizConfigs.get(bizType);
        if (config == null) {
            throw new IllegalArgumentException("ä¸æ”¯æŒçš„ä¸šåŠ¡ç±»å‹: " + bizType);
        }
        
        // æ„å»ºID
        StringBuilder idBuilder = new StringBuilder();
        
        // ä¸šåŠ¡å‰ç¼€
        idBuilder.append(config.getPrefix());
        
        // æ—¶é—´ä¿¡æ¯
        idBuilder.append(formatDate(new Date()));
        
        // åœ°åŒºç 
        idBuilder.append(regionCode);
        
        // åºåˆ—å·
        String sequence = String.format("%0" + config.getSequenceLength() + "d", 
                          getNextSequence(bizType));
        idBuilder.append(sequence);
        
        return idBuilder.toString();
    }
    
    static class BizConfig {
        private final String prefix;
        private final int sequenceLength;
        
        BizConfig(String prefix, int sequenceLength) {
            this.prefix = prefix;
            this.sequenceLength = sequenceLength;
        }
        
        // getters...
    }
}
```

### 11.2 IDè§£æå·¥å…·


**IDè§£æå™¨**ï¼š
```java
public class IdParser {
    
    public IdInfo parseId(String id) {
        if (id == null || id.length() < 13) {
            throw new IllegalArgumentException("IDæ ¼å¼ä¸æ­£ç¡®");
        }
        
        // è§£æå„éƒ¨åˆ†
        String bizType = id.substring(0, 3);
        String dateStr = id.substring(3, 11);
        String regionCode = id.substring(11, 13);
        String sequence = id.substring(13);
        
        // è½¬æ¢æ—¶é—´
        Date createTime = parseDate(dateStr);
        
        return new IdInfo(bizType, createTime, regionCode, sequence);
    }
    
    static class IdInfo {
        private final String bizType;
        private final Date createTime;
        private final String regionCode;
        private final String sequence;
        
        // æ„é€ å‡½æ•°å’Œgetters...
    }
}
```

---

## 12. ğŸ“Š ç›‘æ§ä¸å‘Šè­¦


### 12.1 å…³é”®ç›‘æ§æŒ‡æ ‡


**æ ¸å¿ƒç›‘æ§ç»´åº¦**ï¼š
```java
@Component
public class IdGeneratorMetrics {
    
    private final MeterRegistry meterRegistry;
    
    // QPSç›‘æ§
    private final Counter idGenerationCounter;
    
    // å»¶è¿Ÿç›‘æ§  
    private final Timer idGenerationTimer;
    
    // é”™è¯¯ç‡ç›‘æ§
    private final Counter errorCounter;
    
    public Long generateIdWithMetrics() {
        Timer.Sample sample = Timer.start(meterRegistry);
        try {
            Long id = idGenerator.nextId();
            idGenerationCounter.increment();
            return id;
        } catch (Exception e) {
            errorCounter.increment();
            throw e;
        } finally {
            sample.stop(idGenerationTimer);
        }
    }
}
```

### 12.2 å‘Šè­¦è§„åˆ™é…ç½®


**Prometheuså‘Šè­¦è§„åˆ™**ï¼š
```yaml
groups:
- name: id_generator_alerts
  rules:
  - alert: IdGeneratorHighLatency
    expr: histogram_quantile(0.95, id_generation_duration_seconds) > 0.1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "IDç”Ÿæˆå™¨å»¶è¿Ÿè¿‡é«˜"
      
  - alert: IdGeneratorHighErrorRate
    expr: rate(id_generation_errors_total[5m]) > 0.01
    for: 2m
    labels:
      severity: critical
    annotations:
      summary: "IDç”Ÿæˆå™¨é”™è¯¯ç‡è¿‡é«˜"
```

---

## 13. ğŸ”’ å…¨å±€å”¯ä¸€æ€§ä¿è¯


### 13.1 å”¯ä¸€æ€§éªŒè¯æœºåˆ¶


**é‡å¤IDæ£€æµ‹**ï¼š
```java
@Component
public class IdUniquenessValidator {
    
    private final BloomFilter<String> recentIds;
    private final RedisTemplate<String, String> redisTemplate;
    
    public boolean validateUniqueness(String id) {
        // å…ˆç”¨å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿæ£€æŸ¥
        if (recentIds.mightContain(id)) {
            // å¯èƒ½é‡å¤ï¼Œè¿›ä¸€æ­¥æ£€æŸ¥Redis
            Boolean exists = redisTemplate.hasKey("id:" + id);
            if (Boolean.TRUE.equals(exists)) {
                return false; // ç¡®å®é‡å¤
            }
        }
        
        // è®°å½•æ–°ID
        recentIds.put(id);
        redisTemplate.opsForValue().set("id:" + id, "1", Duration.ofHours(24));
        
        return true;
    }
}
```

### 13.2 å†²çªè§£å†³ç­–ç•¥


**IDå†²çªå¤„ç†**ï¼š
```java
public class ConflictResolver {
    
    public String resolveConflict(String originalId) {
        String resolvedId = originalId;
        int suffix = 1;
        
        // å¦‚æœIDå†²çªï¼Œæ·»åŠ åç¼€
        while (!isUnique(resolvedId)) {
            resolvedId = originalId + "_" + suffix;
            suffix++;
            
            if (suffix > 1000) {
                throw new RuntimeException("IDå†²çªè§£å†³å¤±è´¥ï¼Œè¶…è¿‡æœ€å¤§å°è¯•æ¬¡æ•°");
            }
        }
        
        return resolvedId;
    }
}
```

---

## 14. ğŸ”„ å®¹ç¾ä¸æ•…éšœè½¬ç§»


### 14.1 æ•…éšœæ£€æµ‹æœºåˆ¶


**å¥åº·æ£€æŸ¥å®ç°**ï¼š
```java
@Component
public class IdServiceHealthChecker {
    
    @Scheduled(fixedRate = 10000) // æ¯10ç§’æ£€æŸ¥ä¸€æ¬¡
    public void checkHealth() {
        for (IdService service : idServices) {
            try {
                // å°è¯•ç”ŸæˆID
                Long testId = service.generateId();
                if (testId != null) {
                    markServiceHealthy(service);
                } else {
                    markServiceUnhealthy(service);
                }
            } catch (Exception e) {
                markServiceUnhealthy(service);
                log.warn("IDæœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥: {}", service.getServiceUrl(), e);
            }
        }
    }
}
```

### 14.2 è‡ªåŠ¨æ•…éšœè½¬ç§»


**æ•…éšœè½¬ç§»ç­–ç•¥**ï¼š
```java
public class FailoverManager {
    
    private volatile IdService primaryService;
    private final List<IdService> backupServices;
    
    public Long generateId() {
        // å°è¯•ä¸»æœåŠ¡
        try {
            if (isServiceHealthy(primaryService)) {
                return primaryService.generateId();
            }
        } catch (Exception e) {
            log.warn("ä¸»IDæœåŠ¡å¤±è´¥ï¼Œå°è¯•æ•…éšœè½¬ç§»", e);
        }
        
        // æ•…éšœè½¬ç§»åˆ°å¤‡ç”¨æœåŠ¡
        for (IdService backupService : backupServices) {
            try {
                if (isServiceHealthy(backupService)) {
                    log.info("æ•…éšœè½¬ç§»åˆ°å¤‡ç”¨æœåŠ¡: {}", backupService.getServiceUrl());
                    return backupService.generateId();
                }
            } catch (Exception e) {
                log.warn("å¤‡ç”¨æœåŠ¡ä¹Ÿå¤±è´¥: {}", backupService.getServiceUrl(), e);
            }
        }
        
        throw new RuntimeException("æ‰€æœ‰IDæœåŠ¡éƒ½ä¸å¯ç”¨");
    }
}
```

---

## 15. ğŸŒ å¤šæ•°æ®ä¸­å¿ƒåè°ƒ


### 15.1 æ•°æ®ä¸­å¿ƒIDåˆ†é…


**å¤šDCæ¶æ„**ï¼š
```
æ•°æ®ä¸­å¿ƒåˆ†é…ç­–ç•¥ï¼š
DC1 (åŒ—äº¬): æœºå™¨IDèŒƒå›´ 1-1000,   æ•°æ®ä¸­å¿ƒID: 01
DC2 (ä¸Šæµ·): æœºå™¨IDèŒƒå›´ 1001-2000, æ•°æ®ä¸­å¿ƒID: 02  
DC3 (å¹¿å·): æœºå™¨IDèŒƒå›´ 2001-3000, æ•°æ®ä¸­å¿ƒID: 03

IDç»“æ„å¢å¼ºï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ—¶é—´æˆ³     â”‚ æ•°æ®ä¸­å¿ƒID â”‚  æœºå™¨ID   â”‚   åºåˆ—å·     â”‚
â”‚   41bit     â”‚   3bit   â”‚   10bit  â”‚    12bit   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è·¨DCåŒæ­¥æœºåˆ¶**ï¼š
```java
@Component
public class MultiDcCoordinator {
    
    private final Map<String, DcConfig> dcConfigs;
    
    public void syncMachineIdAllocation() {
        // åŒæ­¥å„æ•°æ®ä¸­å¿ƒçš„æœºå™¨IDåˆ†é…æƒ…å†µ
        for (DcConfig config : dcConfigs.values()) {
            try {
                MachineIdRegistry registry = getMachineIdRegistry(config.getDcId());
                Set<Integer> allocatedIds = registry.getAllocatedMachineIds();
                
                // æ›´æ–°æœ¬åœ°ç¼“å­˜
                updateLocalMachineIdCache(config.getDcId(), allocatedIds);
                
            } catch (Exception e) {
                log.error("åŒæ­¥æ•°æ®ä¸­å¿ƒ {} çš„æœºå™¨IDå¤±è´¥", config.getDcId(), e);
            }
        }
    }
}
```

### 15.2 è·¨DCä¸€è‡´æ€§ä¿è¯


**ä¸€è‡´æ€§åè°ƒç®—æ³•**ï¼š
```java
public class CrossDcConsistency {
    
    public boolean allocateMachineId(String dcId, int machineId) {
        // åˆ†å¸ƒå¼é”ä¿è¯è·¨DCçš„æœºå™¨IDåˆ†é…ä¸€è‡´æ€§
        String lockKey = "machine_id_allocation:" + machineId;
        
        try (DistributedLock lock = distributedLockManager.acquireLock(lockKey, 30)) {
            if (lock != null) {
                // æ£€æŸ¥æœºå™¨IDæ˜¯å¦å·²è¢«å…¶ä»–DCåˆ†é…
                if (isMachineIdAllocated(machineId)) {
                    return false;
                }
                
                // åˆ†é…æœºå™¨ID
                allocateMachineIdInDc(dcId, machineId);
                
                // åŒæ­¥åˆ°å…¶ä»–DC
                syncToOtherDcs(dcId, machineId);
                
                return true;
            }
        } catch (Exception e) {
            log.error("åˆ†é…æœºå™¨IDå¤±è´¥", e);
        }
        
        return false;
    }
}
```

---

## 16. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 16.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ åˆ†å¸ƒå¼IDç‰¹æ€§**ï¼šå…¨å±€å”¯ä¸€ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€å•è°ƒé€’å¢
**ğŸ”¸ ä¸»æµç®—æ³•å¯¹æ¯”**ï¼šé›ªèŠ±ç®—æ³•ã€å·æ®µæ¨¡å¼ã€æ•°æ®åº“åºåˆ—ã€UUIDå„æœ‰ä¼˜åŠ£
**ğŸ”¸ é«˜å¯ç”¨ä¿éšœ**ï¼šç†”æ–­é™çº§ã€æ•…éšœè½¬ç§»ã€å¤šæœºæˆ¿éƒ¨ç½²ç­–ç•¥
**ğŸ”¸ æ€§èƒ½ä¼˜åŒ–**ï¼šå†…å­˜é¢„åˆ†é…ã€æ‰¹é‡ç”Ÿæˆã€å¼‚æ­¥å¤„ç†æŠ€æœ¯
**ğŸ”¸ ç›‘æ§è¿ç»´**ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ã€å‘Šè­¦è§„åˆ™ã€æ•…éšœè¯Šæ–­æ–¹æ³•

### 16.2 å…³é”®æŠ€æœ¯é€‰å‹


**é€‰å‹å†³ç­–çŸ©é˜µ**ï¼š

| éœ€æ±‚åœºæ™¯ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|---------|---------|------|
| **è¶…é«˜æ€§èƒ½è¦æ±‚** | é›ªèŠ±ç®—æ³• | çº¯å†…å­˜æ“ä½œï¼ŒQPSæœ€é«˜ |
| **ç®€å•æ˜“ç”¨** | å·æ®µæ¨¡å¼ | å®ç°ç®€å•ï¼Œæ€§èƒ½è‰¯å¥½ |
| **å¼ºä¸€è‡´æ€§** | æ•°æ®åº“åºåˆ— | ä¾èµ–æ•°æ®åº“äº‹åŠ¡ä¿è¯ |
| **æ— ä¾èµ–éƒ¨ç½²** | UUID | ä¸éœ€è¦é¢å¤–åŸºç¡€è®¾æ–½ |
| **è¯­ä¹‰åŒ–éœ€æ±‚** | è‡ªå®šä¹‰ç»„åˆ | æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹å®šåˆ¶ |

### 16.3 éƒ¨ç½²è¿ç»´è¦ç‚¹


**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²checklist**ï¼š
- âœ… å¤šæœºæˆ¿éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœ
- âœ… é…ç½®ç›‘æ§å‘Šè­¦ï¼ŒåŠæ—¶å‘ç°é—®é¢˜  
- âœ… å®šæœŸæ€§èƒ½æµ‹è¯•ï¼ŒéªŒè¯ç³»ç»Ÿèƒ½åŠ›
- âœ… å»ºç«‹åº”æ€¥é¢„æ¡ˆï¼Œå¿«é€Ÿæ•…éšœæ¢å¤
- âœ… åšå¥½å®¹é‡è§„åˆ’ï¼Œæ”¯æ’‘ä¸šåŠ¡å¢é•¿

**å¸¸è§é—®é¢˜ä¸è§£å†³**ï¼š
- **æ—¶é’Ÿå›æ‹¨**ï¼šç­‰å¾…æ¢å¤æˆ–æŠ›å‡ºå¼‚å¸¸
- **æœºå™¨IDå†²çª**ï¼šå»ºç«‹ä¸­å¿ƒåŒ–åˆ†é…æœºåˆ¶
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šæ°´å¹³æ‰©å±•æˆ–ä¼˜åŒ–ç®—æ³•
- **æ•°æ®ä¸ä¸€è‡´**ï¼šå¢å¼ºæ ¡éªŒå’Œä¿®å¤æœºåˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- åˆ†å¸ƒå¼IDæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€è®¾æ–½
- ä¸åŒç®—æ³•é€‚ç”¨äºä¸åŒåœºæ™¯ï¼Œéœ€è¦æƒè¡¡é€‰æ‹©
- é«˜å¯ç”¨æ¯”é«˜æ€§èƒ½æ›´é‡è¦ï¼Œç¨³å®šæ€§æ˜¯ç¬¬ä¸€è¦ç´ 
- ç›‘æ§å’Œè¿ç»´èƒ½åŠ›å†³å®šç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§