---
title: 1ã€åˆ†å¸ƒå¼äº‹åŠ¡ç†è®ºåŸºç¡€
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µä¸æŒ‘æˆ˜](#1-åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µä¸æŒ‘æˆ˜)
2. [ACIDç‰¹æ€§åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æŒ‘æˆ˜](#2-ACIDç‰¹æ€§åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æŒ‘æˆ˜)
3. [CAPç†è®ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„åº”ç”¨](#3-CAPç†è®ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„åº”ç”¨)
4. [BASEç†è®ºä¸æœ€ç»ˆä¸€è‡´æ€§å®è·µ](#4-BASEç†è®ºä¸æœ€ç»ˆä¸€è‡´æ€§å®è·µ)
5. [åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ç±»ä¸åè°ƒæœºåˆ¶](#5-åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ç±»ä¸åè°ƒæœºåˆ¶)
6. [åˆ†å¸ƒå¼ä¸€è‡´æ€§çº§åˆ«ä¸é€‰æ‹©ç­–ç•¥](#6-åˆ†å¸ƒå¼ä¸€è‡´æ€§çº§åˆ«ä¸é€‰æ‹©ç­–ç•¥)
7. [åˆ†å¸ƒå¼é”æœºåˆ¶è®¾è®¡ä¸å®ç°](#7-åˆ†å¸ƒå¼é”æœºåˆ¶è®¾è®¡ä¸å®ç°)
8. [åˆ†å¸ƒå¼äº‹åŠ¡è®¾è®¡æƒè¡¡åŸåˆ™](#8-åˆ†å¸ƒå¼äº‹åŠ¡è®¾è®¡æƒè¡¡åŸåˆ™)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µä¸æŒ‘æˆ˜


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡


**ç®€å•ç†è§£**ï¼šåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯è·¨è¶Šå¤šä¸ªæ•°æ®åº“æˆ–ç³»ç»Ÿçš„äº‹åŠ¡æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚

```
ä¼ ç»Ÿå•æœºäº‹åŠ¡ï¼š
é“¶è¡Œè½¬è´¦ï¼šAè´¦æˆ·-100ï¼ŒBè´¦æˆ·+100
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“     â”‚ â† æ‰€æœ‰æ“ä½œåœ¨ä¸€ä¸ªæ•°æ®åº“å†…
â”‚  A: 1000    â”‚
â”‚  B: 500     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åˆ†å¸ƒå¼äº‹åŠ¡ï¼š
è·¨è¡Œè½¬è´¦ï¼šå·¥è¡ŒAè´¦æˆ·-100ï¼Œå»ºè¡ŒBè´¦æˆ·+100
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç½‘ç»œ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å·¥è¡Œæ•°æ®åº“  â”‚ â†â”€â”€â”€â”€â”€â†’   â”‚   å»ºè¡Œæ•°æ®åº“  â”‚
â”‚  A: 1000    â”‚           â”‚  B: 500     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒé—®é¢˜**ï¼šå¦‚ä½•ä¿è¯è·¨å¤šä¸ªç³»ç»Ÿçš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼Ÿ

### 1.2 åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹ç‚¹


**ç½‘ç»œä¸å¯é æ€§**ï¼š
```
é—®é¢˜ï¼šç½‘ç»œå»¶è¿Ÿã€ä¸¢åŒ…ã€åˆ†åŒº
å½±å“ï¼šæ“ä½œå¯èƒ½è¶…æ—¶ï¼Œæ— æ³•ç¡®å®šè¿œç¨‹æ“ä½œæ˜¯å¦æˆåŠŸ
ç¤ºä¾‹ï¼šå‘é€è½¬è´¦è¯·æ±‚åï¼Œç½‘ç»œæ–­å¼€ï¼Œä¸çŸ¥é“å¯¹æ–¹æ˜¯å¦æ”¶åˆ°
```

**èŠ‚ç‚¹ç‹¬ç«‹æ€§**ï¼š
```
é—®é¢˜ï¼šæ¯ä¸ªç³»ç»Ÿç‹¬ç«‹è¿è¡Œï¼Œå¯èƒ½å‡ºç°æ•…éšœ
å½±å“ï¼šæ— æ³•ç»Ÿä¸€æ§åˆ¶æ‰€æœ‰å‚ä¸èŠ‚ç‚¹
ç¤ºä¾‹ï¼šAç³»ç»Ÿæ‰£æ¬¾æˆåŠŸï¼ŒBç³»ç»Ÿæ•…éšœæ— æ³•åŠ æ¬¾
```

**å¹¶å‘å¤æ‚æ€§**ï¼š
```
é—®é¢˜ï¼šå¤šä¸ªäº‹åŠ¡åŒæ—¶æ“ä½œç›¸åŒèµ„æº
å½±å“ï¼šå¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´
ç¤ºä¾‹ï¼šä¸¤ä¸ªäººåŒæ—¶å‘åŒä¸€è´¦æˆ·è½¬è´¦
```

### 1.3 åˆ†å¸ƒå¼äº‹åŠ¡çš„æŒ‘æˆ˜


**åŸå­æ€§éš¾é¢˜**ï¼š
```
å•æœºç¯å¢ƒï¼šè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
åˆ†å¸ƒå¼ç¯å¢ƒï¼šéƒ¨åˆ†èŠ‚ç‚¹æˆåŠŸï¼Œéƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

å®é™…åœºæ™¯ï¼š
1. ç”¨æˆ·ä¸‹å•å‡åº“å­˜ï¼ˆåº“å­˜ç³»ç»Ÿï¼‰
2. æ‰£å‡è´¦æˆ·ä½™é¢ï¼ˆæ”¯ä»˜ç³»ç»Ÿï¼‰  
3. åˆ›å»ºè®¢å•è®°å½•ï¼ˆè®¢å•ç³»ç»Ÿï¼‰

é—®é¢˜ï¼šå¦‚æœæ­¥éª¤2å¤±è´¥äº†ï¼Œæ­¥éª¤1çš„åº“å­˜æ‰£å‡è¦ä¸è¦å›æ»šï¼Ÿ
```

**ä¸€è‡´æ€§éš¾é¢˜**ï¼š
```
å•æœºç¯å¢ƒï¼šACIDä¿è¯ä¸€è‡´æ€§
åˆ†å¸ƒå¼ç¯å¢ƒï¼šä¸åŒèŠ‚ç‚¹å¯èƒ½çœ‹åˆ°ä¸åŒçš„æ•°æ®çŠ¶æ€

å®é™…åœºæ™¯ï¼š
ç”µå•†ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢æ˜¾ç¤º100å…ƒ
åŒæ—¶æŸ¥è¯¢è®¢å•ç³»ç»Ÿï¼Œæ˜¾ç¤ºåˆšæ‰£è´¹50å…ƒ
ä½†æ”¯ä»˜ç³»ç»Ÿè¿˜æ˜¾ç¤ºä½™é¢100å…ƒï¼ˆæ•°æ®è¿˜æ²¡åŒæ­¥ï¼‰
```

---

## 2. âš–ï¸ ACIDç‰¹æ€§åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æŒ‘æˆ˜


### 2.1 ACIDç‰¹æ€§å›é¡¾


**ä¼ ç»ŸACIDç‰¹æ€§**ï¼š
- **A (Atomicity)**ï¼šåŸå­æ€§ - è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆå…¨ä¸åš
- **C (Consistency)**ï¼šä¸€è‡´æ€§ - æ•°æ®ä¿æŒä¸€è‡´çŠ¶æ€  
- **I (Isolation)**ï¼šéš”ç¦»æ€§ - å¹¶å‘äº‹åŠ¡äº’ä¸å¹²æ‰°
- **D (Durability)**ï¼šæŒä¹…æ€§ - æäº¤åæ•°æ®æ°¸ä¹…ä¿å­˜

### 2.2 åŸå­æ€§ (Atomicity) çš„æŒ‘æˆ˜


**å•æœºå®ç°**ï¼š
```sql
BEGIN TRANSACTION;
UPDATE account SET balance = balance - 100 WHERE id = 'A';
UPDATE account SET balance = balance + 100 WHERE id = 'B';
COMMIT; -- è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
```

**åˆ†å¸ƒå¼å®ç°æŒ‘æˆ˜**ï¼š
```
ç³»ç»ŸAï¼šæ‰£æ¬¾æ“ä½œ  â†â†’  ç½‘ç»œ  â†â†’  ç³»ç»ŸBï¼šåŠ æ¬¾æ“ä½œ

é—®é¢˜åœºæ™¯ï¼š
1. ç³»ç»ŸAæ‰£æ¬¾æˆåŠŸ
2. ç½‘ç»œè°ƒç”¨ç³»ç»ŸB
3. ç³»ç»ŸBå®•æœºæˆ–ç½‘ç»œè¶…æ—¶
4. ç°åœ¨æ€ä¹ˆåŠï¼ŸAçš„æ‰£æ¬¾è¦ä¸è¦å›æ»šï¼Ÿ
```

**è§£å†³æ€è·¯é¢„è§ˆ**ï¼š
- **ä¸¤é˜¶æ®µæäº¤ (2PC)**ï¼šå…ˆè¯¢é—®æ‰€æœ‰ç³»ç»Ÿæ˜¯å¦å‡†å¤‡å¥½ï¼Œå†ç»Ÿä¸€æäº¤
- **è¡¥å¿æ¨¡å¼ (Saga)**ï¼šå‡ºé”™æ—¶æ‰§è¡Œç›¸åæ“ä½œè¿›è¡Œè¡¥å¿
- **äº‹åŠ¡æ¶ˆæ¯**ï¼šé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æœ€ç»ˆä¸€è‡´æ€§

### 2.3 ä¸€è‡´æ€§ (Consistency) çš„æŒ‘æˆ˜


**å•æœºä¸€è‡´æ€§**ï¼š
```
è½¬è´¦å‰ï¼šA=1000, B=500, æ€»é¢=1500
è½¬è´¦åï¼šA=900,  B=600, æ€»é¢=1500
æ•°æ®å§‹ç»ˆæ»¡è¶³çº¦æŸæ¡ä»¶
```

**åˆ†å¸ƒå¼ä¸€è‡´æ€§æŒ‘æˆ˜**ï¼š
```
æ—¶åˆ»T1ï¼š
ç³»ç»ŸAï¼šA=900  (å·²æ‰£æ¬¾)
ç³»ç»ŸBï¼šB=500  (æœªåŠ æ¬¾ï¼Œç½‘ç»œå»¶è¿Ÿ)
æ€»é¢=1400 â† è¿åäº†ä¸€è‡´æ€§çº¦æŸï¼

æ—¶åˆ»T2 (ç½‘ç»œæ¢å¤å)ï¼š
ç³»ç»ŸAï¼šA=900  
ç³»ç»ŸBï¼šB=600  (å»¶è¿Ÿçš„åŠ æ¬¾åˆ°è¾¾)
æ€»é¢=1500 â† ä¸€è‡´æ€§æ¢å¤
```

**ä¸€è‡´æ€§çº§åˆ«**ï¼š
- **å¼ºä¸€è‡´æ€§**ï¼šä»»ä½•æ—¶åˆ»æ‰€æœ‰èŠ‚ç‚¹æ•°æ®éƒ½ç›¸åŒ
- **å¼±ä¸€è‡´æ€§**ï¼šå…è®¸çŸ­æ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´
- **æœ€ç»ˆä¸€è‡´æ€§**ï¼šä¿è¯æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€

### 2.4 éš”ç¦»æ€§ (Isolation) çš„æŒ‘æˆ˜


**åˆ†å¸ƒå¼éš”ç¦»çº§åˆ«é€‚ç”¨æ€§**ï¼š

| éš”ç¦»çº§åˆ« | **å•æœºé€‚ç”¨æ€§** | **åˆ†å¸ƒå¼æŒ‘æˆ˜** | **å®ç°å¤æ‚åº¦** |
|---------|-------------|-------------|-------------|
| `READ UNCOMMITTED` | æ€§èƒ½é«˜ï¼Œæ•°æ®å¯èƒ½è„è¯» | åˆ†å¸ƒå¼è„è¯»æ›´å¤æ‚ | ä½ |
| `READ COMMITTED` | é¿å…è„è¯» | è·¨ç³»ç»Ÿè¯»å–ä¸€è‡´æ€§éš¾ä¿è¯ | ä¸­ |
| `REPEATABLE READ` | é¿å…ä¸å¯é‡å¤è¯» | åˆ†å¸ƒå¼é”å¼€é”€å¤§ | é«˜ |
| `SERIALIZABLE` | æœ€é«˜éš”ç¦»çº§åˆ« | åˆ†å¸ƒå¼ç¯å¢ƒæ€§èƒ½æå·® | æé«˜ |

**å®é™…é—®é¢˜**ï¼š
```
åœºæ™¯ï¼šç”¨æˆ·AæŸ¥è¯¢è´¦æˆ·ä½™é¢
1. æŸ¥è¯¢ç³»ç»ŸAï¼šä½™é¢1000å…ƒ
2. åŒæ—¶æœ‰è½¬è´¦æ“ä½œæ‰£å‡äº†100å…ƒ
3. æŸ¥è¯¢ç³»ç»ŸBï¼šå‘ç°æœ‰ç¬”è½¬å‡ºè®°å½•
4. ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ï¼šä½™é¢1000ï¼Œä½†æœ‰100å…ƒè½¬å‡º â† æ•°æ®ä¸ä¸€è‡´
```

### 2.5 æŒä¹…æ€§ (Durability) çš„æŒ‘æˆ˜


**åˆ†å¸ƒå¼æŒä¹…æ€§é—®é¢˜**ï¼š
```
é—®é¢˜ï¼šå¦‚ä½•ä¿è¯æ‰€æœ‰ç³»ç»Ÿéƒ½æŒä¹…åŒ–ä¿å­˜ï¼Ÿ

åœºæ™¯ï¼š
1. ç³»ç»ŸAæäº¤æˆåŠŸï¼Œæ•°æ®å·²æŒä¹…åŒ–
2. ç³»ç»ŸBæäº¤æ—¶çªç„¶æ–­ç”µï¼Œæ•°æ®ä¸¢å¤±
3. é‡å¯åå‘ç°æ•°æ®ä¸ä¸€è‡´

è§£å†³æ–¹æ¡ˆï¼š
- åˆ†å¸ƒå¼æ—¥å¿—åŒæ­¥
- å¤šå‰¯æœ¬ä¿è¯
- æ•…éšœæ¢å¤æœºåˆ¶
```

---

## 3. ğŸ”º CAPç†è®ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„åº”ç”¨


### 3.1 CAPç†è®ºæ ¸å¿ƒæ¦‚å¿µ


**CAPä¸‰è¦ç´ **ï¼š
```
C (Consistency)ï¼šä¸€è‡´æ€§
æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°ç›¸åŒçš„æ•°æ®

A (Availability)ï¼šå¯ç”¨æ€§  
ç³»ç»ŸæŒç»­æä¾›æœåŠ¡ï¼Œä¸ä¼šå› ä¸ºèŠ‚ç‚¹æ•…éšœè€Œåœæ­¢

P (Partition Tolerance)ï¼šåˆ†åŒºå®¹é”™æ€§
ç³»ç»Ÿåœ¨ç½‘ç»œåˆ†åŒºæ—¶ä»èƒ½ç»§ç»­è¿è¡Œ
```

**CAPä¸å¯èƒ½ä¸‰è§’**ï¼š
```
      ä¸€è‡´æ€§ (C)
         â–³
        /  \
       /    \
      /      \
     /        \
    /    ?     \
   /            \
  /              \
å¯ç”¨æ€§(A) â€”â€”â€”â€”â€”â€”â€” åˆ†åŒºå®¹é”™(P)

åªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤ä¸ªï¼
```

### 3.2 CAPç†è®ºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­çš„ä½“ç°


**CAç³»ç»Ÿ - ä¼ ç»Ÿæ•°æ®åº“**ï¼š
```
ç‰¹ç‚¹ï¼šå¼ºä¸€è‡´æ€§ + é«˜å¯ç”¨æ€§ï¼Œä½†ä¸å®¹å¿ç½‘ç»œåˆ†åŒº
ä»£è¡¨ï¼šå•æœºRDBMS (MySQL, PostgreSQL)
åœºæ™¯ï¼šæ•°æ®ä¸­å¿ƒå†…éƒ¨ç³»ç»Ÿ

é—®é¢˜ï¼šä¸€æ—¦ç½‘ç»œåˆ†åŒºï¼Œç³»ç»Ÿæ— æ³•å·¥ä½œ
```

**CPç³»ç»Ÿ - å¼ºä¸€è‡´æ€§ä¼˜å…ˆ**ï¼š
```
ç‰¹ç‚¹ï¼šå¼ºä¸€è‡´æ€§ + åˆ†åŒºå®¹é”™ï¼Œç‰ºç‰²å¯ç”¨æ€§
ä»£è¡¨ï¼šä¼ ç»Ÿåˆ†å¸ƒå¼æ•°æ®åº“ (å¦‚æŸäº›é…ç½®çš„MongoDB)
åœºæ™¯ï¼šé“¶è¡Œæ ¸å¿ƒç³»ç»Ÿ

è¡Œä¸ºï¼šç½‘ç»œåˆ†åŒºæ—¶ï¼Œç³»ç»Ÿåœæ­¢æœåŠ¡ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
```

**APç³»ç»Ÿ - å¯ç”¨æ€§ä¼˜å…ˆ**ï¼š
```
ç‰¹ç‚¹ï¼šé«˜å¯ç”¨æ€§ + åˆ†åŒºå®¹é”™ï¼Œç‰ºç‰²å¼ºä¸€è‡´æ€§
ä»£è¡¨ï¼šNoSQLæ•°æ®åº“ (Cassandra, DynamoDB)
åœºæ™¯ï¼šç¤¾äº¤åª’ä½“ã€ç”µå•†æ¨è

è¡Œä¸ºï¼šç½‘ç»œåˆ†åŒºæ—¶ï¼Œç³»ç»Ÿç»§ç»­æœåŠ¡ï¼Œå¯èƒ½è¿”å›ä¸ä¸€è‡´æ•°æ®
```

### 3.3 å®é™…åº”ç”¨åœºæ™¯åˆ†æ


**é“¶è¡Œè½¬è´¦ç³»ç»Ÿ (CPæ¨¡å¼)**ï¼š
```
éœ€æ±‚ï¼šç»å¯¹ä¸èƒ½å‡ºç°é’±å‡­ç©ºå¢åŠ æˆ–æ¶ˆå¤±
é€‰æ‹©ï¼šç‰ºç‰²å¯ç”¨æ€§ï¼Œä¿è¯å¼ºä¸€è‡´æ€§

å®ç°ï¼š
- ç½‘ç»œåˆ†åŒºæ—¶ï¼Œåœæ­¢è·¨è¡Œè½¬è´¦æœåŠ¡
- æ˜¾ç¤º"ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•"
- ä¿è¯è´¦æˆ·ä½™é¢ç»å¯¹å‡†ç¡®
```

**ç”µå•†åº“å­˜ç³»ç»Ÿ (APæ¨¡å¼)**ï¼š
```
éœ€æ±‚ï¼šç”¨æˆ·éšæ—¶å¯ä»¥ä¸‹å•ï¼Œå¶å°”è¶…å–å¯ä»¥æ¥å—
é€‰æ‹©ï¼šç‰ºç‰²å¼ºä¸€è‡´æ€§ï¼Œä¿è¯é«˜å¯ç”¨æ€§

å®ç°ï¼š
- ç½‘ç»œåˆ†åŒºæ—¶ï¼Œå„ç³»ç»Ÿç‹¬ç«‹å¤„ç†è®¢å•
- å¯èƒ½å‡ºç°çŸ­æ—¶é—´è¶…å–
- åç»­é€šè¿‡è¡¥å¿æœºåˆ¶å¤„ç†
```

**ç¤¾äº¤åª’ä½“ç‚¹èµ (APæ¨¡å¼)**ï¼š
```
éœ€æ±‚ï¼šç”¨æˆ·æ“ä½œå“åº”è¦å¿«ï¼Œç‚¹èµæ•°å¶å°”ä¸å‡†ç¡®å¯æ¥å—
é€‰æ‹©ï¼šæœ€ç»ˆä¸€è‡´æ€§å³å¯

å®ç°ï¼š
- ç‚¹èµç«‹å³å“åº”ç”¨æˆ·
- åå°å¼‚æ­¥åŒæ­¥ç‚¹èµæ•°
- ç”¨æˆ·çœ‹åˆ°çš„ç‚¹èµæ•°å¯èƒ½ç•¥æœ‰å»¶è¿Ÿ
```

### 3.4 CAPç†è®ºæŒ‡å¯¼åˆ†å¸ƒå¼äº‹åŠ¡è®¾è®¡


**è®¾è®¡å†³ç­–æ¡†æ¶**ï¼š
```
1. æ˜ç¡®ä¸šåŠ¡å¯¹ä¸€è‡´æ€§çš„è¦æ±‚
   - å¼ºä¸€è‡´æ€§ï¼šé‡‘èäº¤æ˜“ã€åº“å­˜æ‰£å‡
   - æœ€ç»ˆä¸€è‡´æ€§ï¼šç§¯åˆ†ç´¯è®¡ã€ç»Ÿè®¡æ•°æ®
   - å¼±ä¸€è‡´æ€§ï¼šæ¨èç®—æ³•ã€æ—¥å¿—åˆ†æ

2. è¯„ä¼°ç³»ç»Ÿå¯ç”¨æ€§è¦æ±‚
   - é«˜å¯ç”¨ï¼šé¢å‘ç”¨æˆ·çš„æ ¸å¿ƒåŠŸèƒ½
   - å¯é™çº§ï¼šåå°ç®¡ç†ã€æŠ¥è¡¨ç³»ç»Ÿ

3. è€ƒè™‘ç½‘ç»œåˆ†åŒºæ¦‚ç‡
   - è·¨åœ°åŸŸï¼šåˆ†åŒºæ¦‚ç‡é«˜ï¼Œå¿…é¡»è€ƒè™‘P
   - åŒæœºæˆ¿ï¼šåˆ†åŒºæ¦‚ç‡ä½ï¼Œå¯ä»¥æƒè¡¡
```

---

## 4. ğŸ”„ BASEç†è®ºä¸æœ€ç»ˆä¸€è‡´æ€§å®è·µ


### 4.1 BASEç†è®ºæ ¸å¿ƒæ€æƒ³


**BASEç†è®º**ï¼šCAPç†è®ºçš„è¡¥å……ï¼Œæä¾›äº†ä¸€ç§æ›´å®ç”¨çš„è®¾è®¡æ€è·¯
```
BA (Basically Available)ï¼šåŸºæœ¬å¯ç”¨
- ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§
- ä¾‹ï¼šå“åº”æ—¶é—´å»¶é•¿ã€åŠŸèƒ½é™çº§

S (Soft State)ï¼šè½¯çŠ¶æ€  
- å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹é—´å­˜åœ¨ä¸­é—´çŠ¶æ€
- æ•°æ®å¯ä»¥æœ‰ä¸€æ®µæ—¶é—´ä¸ä¸€è‡´

E (Eventually Consistent)ï¼šæœ€ç»ˆä¸€è‡´æ€§
- ç³»ç»Ÿä¿è¯æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€
- ä¸è¦æ±‚å®æ—¶ä¸€è‡´æ€§
```

### 4.2 æœ€ç»ˆä¸€è‡´æ€§çš„å®ç°æ¨¡å¼


**å¼‚æ­¥æ¶ˆæ¯æ¨¡å¼**ï¼š
```
è®¢å•ç³»ç»Ÿæµç¨‹ï¼š
1. ç”¨æˆ·ä¸‹å• â†’ ç«‹å³è¿”å›"è®¢å•æäº¤æˆåŠŸ"
2. å‘é€æ¶ˆæ¯ â†’ åº“å­˜ç³»ç»Ÿå¼‚æ­¥æ‰£å‡åº“å­˜  
3. å‘é€æ¶ˆæ¯ â†’ æ”¯ä»˜ç³»ç»Ÿå¼‚æ­¥æ‰£æ¬¾
4. å„ç³»ç»Ÿå¤„ç†å®Œæˆåï¼Œæœ€ç»ˆæ•°æ®ä¸€è‡´

ä¼˜ç‚¹ï¼šå“åº”å¿«ï¼Œç”¨æˆ·ä½“éªŒå¥½
ç¼ºç‚¹ï¼šå¯èƒ½å‡ºç°çŸ­æ—¶é—´æ•°æ®ä¸ä¸€è‡´
```

**è¡¥å¿äº‹åŠ¡æ¨¡å¼ (Saga)**ï¼š
```
é•¿é€”æ—…è¡Œé¢„è®¢ï¼š
1. é¢„è®¢æœºç¥¨ âœ“
2. é¢„è®¢é…’åº— âœ“  
3. é¢„è®¢ç§Ÿè½¦ âœ— (å¤±è´¥)

è¡¥å¿æµç¨‹ï¼š
4. å–æ¶ˆé…’åº—é¢„è®¢
5. å–æ¶ˆæœºç¥¨é¢„è®¢
6. è¿”å›ç”¨æˆ·"é¢„è®¢å¤±è´¥"

é€šè¿‡ä¸šåŠ¡è¡¥å¿ä¿è¯æœ€ç»ˆä¸€è‡´æ€§
```

**å®šæ—¶å¯¹è´¦æ¨¡å¼**ï¼š
```
ç”µå•†ç³»ç»Ÿå¯¹è´¦ï¼š
1. è®¢å•ç³»ç»Ÿè®°å½•ï¼šå·²æ‰£æ¬¾100å…ƒ
2. æ”¯ä»˜ç³»ç»Ÿè®°å½•ï¼šå®é™…æ‰£æ¬¾100å…ƒ
3. åº“å­˜ç³»ç»Ÿè®°å½•ï¼šå·²æ‰£å‡å•†å“1ä¸ª

å®šæ—¶ä»»åŠ¡ï¼š
- æ¯å°æ—¶å¯¹æ¯”ä¸‰ä¸ªç³»ç»Ÿçš„æ•°æ®
- å‘ç°ä¸ä¸€è‡´åˆ™è§¦å‘ä¿®å¤æµç¨‹
- æœ€ç»ˆä¿è¯æ•°æ®ä¸€è‡´
```

### 4.3 æœ€ç»ˆä¸€è‡´æ€§çš„æ—¶é—´çª—å£


**ä¸šåŠ¡å®¹å¿åº¦åˆ†æ**ï¼š
```
ç§’çº§ä¸€è‡´æ€§ï¼š
- æ”¯ä»˜ç»“æœç¡®è®¤
- åº“å­˜å®æ—¶æ˜¾ç¤º
- å®ç°ï¼šåŒæ­¥è°ƒç”¨ + å¿«é€Ÿå¤±è´¥

åˆ†é’Ÿçº§ä¸€è‡´æ€§ï¼š
- ç§¯åˆ†ç´¯è®¡æ›´æ–°
- ç”¨æˆ·ç­‰çº§å˜æ›´  
- å®ç°ï¼šå¯é æ¶ˆæ¯é˜Ÿåˆ—

å°æ—¶çº§ä¸€è‡´æ€§ï¼š
- æŠ¥è¡¨æ•°æ®ç»Ÿè®¡
- æ¨èç®—æ³•æ›´æ–°
- å®ç°ï¼šæ‰¹å¤„ç† + å®šæ—¶åŒæ­¥

å¤©çº§ä¸€è‡´æ€§ï¼š
- å†å²æ•°æ®å½’æ¡£
- å®¡è®¡æ—¥å¿—æ•´ç†
- å®ç°ï¼šç¦»çº¿æ•°æ®å¤„ç†
```

### 4.4 BASEç†è®ºå®é™…åº”ç”¨


**ç”µå•†ä¸‹å•æµç¨‹**ï¼š
```
1. ç”¨æˆ·ç‚¹å‡»"ç«‹å³è´­ä¹°" 
   â†“ (åŸºæœ¬å¯ç”¨ï¼šå¿«é€Ÿå“åº”)
2. è®¢å•ç³»ç»Ÿåˆ›å»ºé¢„è®¢å•
   â†“ (è½¯çŠ¶æ€ï¼šè®¢å•çŠ¶æ€ä¸º"å¤„ç†ä¸­") 
3. å¼‚æ­¥å¤„ç†ï¼š
   - åº“å­˜ç³»ç»Ÿæ‰£å‡ â†’ å¯èƒ½å»¶è¿Ÿå‡ ç§’
   - æ”¯ä»˜ç³»ç»Ÿæ‰£æ¬¾ â†’ å¯èƒ½å»¶è¿Ÿå‡ ç§’
   - ç‰©æµç³»ç»Ÿåˆ›å»ºè¿å• â†’ å¯èƒ½å»¶è¿Ÿå‡ åˆ†é’Ÿ
   â†“ (æœ€ç»ˆä¸€è‡´æ€§ï¼šæ‰€æœ‰ç³»ç»Ÿæœ€ç»ˆè¾¾åˆ°ä¸€è‡´)
4. è®¢å•çŠ¶æ€æ›´æ–°ä¸º"å·²ç¡®è®¤"
```

**ä¼˜åŠ¿åˆ†æ**ï¼š
- **ç”¨æˆ·ä½“éªŒ**ï¼šä¸‹å•ç«‹å³å“åº”ï¼Œä¸ç”¨ç­‰å¾…æ‰€æœ‰ç³»ç»Ÿå¤„ç†å®Œæˆ
- **ç³»ç»Ÿå¥å£®æ€§**ï¼šæŸä¸ªå­ç³»ç»Ÿæ•…éšœä¸å½±å“æ•´ä½“æµç¨‹
- **æ€§èƒ½**ï¼šé¿å…äº†åˆ†å¸ƒå¼é”çš„æ€§èƒ½å¼€é”€

---

## 5. ğŸ”§ åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ç±»ä¸åè°ƒæœºåˆ¶


### 5.1 åˆ†å¸ƒå¼äº‹åŠ¡åˆ†ç±»


**æŒ‰å®ç°æ–¹å¼åˆ†ç±»**ï¼š

**åˆšæ€§äº‹åŠ¡**ï¼š
```
ç‰¹ç‚¹ï¼šä¸¥æ ¼éµå¾ªACIDï¼Œä¿è¯å¼ºä¸€è‡´æ€§
ä»£è¡¨ï¼šä¸¤é˜¶æ®µæäº¤(2PC)ã€ä¸‰é˜¶æ®µæäº¤(3PC)
é€‚ç”¨ï¼šé“¶è¡Œè½¬è´¦ã€é‡‘èäº¤æ˜“
ä»£ä»·ï¼šæ€§èƒ½è¾ƒä½ï¼Œå¯ç”¨æ€§å—å½±å“
```

**æŸ”æ€§äº‹åŠ¡**ï¼š
```
ç‰¹ç‚¹ï¼šæ”¾æ¾ä¸€è‡´æ€§è¦æ±‚ï¼Œè¿½æ±‚é«˜æ€§èƒ½å’Œå¯ç”¨æ€§
ä»£è¡¨ï¼šTCCã€Sagaã€äº‹åŠ¡æ¶ˆæ¯
é€‚ç”¨ï¼šç”µå•†ä¸‹å•ã€ç§¯åˆ†ç³»ç»Ÿ
ä¼˜åŠ¿ï¼šæ€§èƒ½å¥½ï¼Œå¯ç”¨æ€§é«˜
```

### 5.2 ä¸¤é˜¶æ®µæäº¤ (2PC) åè°ƒæœºåˆ¶


**åŸºæœ¬åŸç†**ï¼š
```
è§’è‰²ï¼š
- äº‹åŠ¡åè°ƒå™¨ (TC)ï¼šç»Ÿä¸€è°ƒåº¦æ‰€æœ‰å‚ä¸è€…
- èµ„æºç®¡ç†å™¨ (RM)ï¼šå„ä¸ªæ•°æ®åº“æˆ–ç³»ç»Ÿ

é˜¶æ®µ1 - æŠ•ç¥¨é˜¶æ®µï¼š
TC: "å¤§å®¶å‡†å¤‡å¥½æäº¤äº‹åŠ¡äº†å—ï¼Ÿ"
RM1: "æˆ‘å‡†å¤‡å¥½äº†" (Yes)
RM2: "æˆ‘å‡†å¤‡å¥½äº†" (Yes) 
RM3: "æˆ‘å‡†å¤‡å¥½äº†" (Yes)

é˜¶æ®µ2 - æäº¤é˜¶æ®µï¼š
TC: "æ‰€æœ‰äººéƒ½å‡†å¤‡å¥½äº†ï¼Œæ­£å¼æäº¤ï¼"
RM1: "æäº¤å®Œæˆ"
RM2: "æäº¤å®Œæˆ"
RM3: "æäº¤å®Œæˆ"
```

**å…·ä½“æµç¨‹å›¾**ï¼š
```
åè°ƒå™¨TC        å‚ä¸è€…RM1       å‚ä¸è€…RM2       å‚ä¸è€…RM3
    |               |               |               |
    |--å‡†å¤‡æäº¤---->|               |               |
    |               |--å‡†å¤‡æäº¤---->|               |
    |               |               |--å‡†å¤‡æäº¤---->|
    |<----Yes-------|               |               |
    |               |<----Yes-------|               |
    |               |               |<----Yes-------|
    |               |               |               |
    |--æ­£å¼æäº¤---->|               |               |
    |               |--æ­£å¼æäº¤---->|               |
    |               |               |--æ­£å¼æäº¤---->|
    |<--æäº¤å®Œæˆ----|               |               |
    |               |<--æäº¤å®Œæˆ----|               |
    |               |               |<--æäº¤å®Œæˆ----|
```

**2PCçš„é—®é¢˜**ï¼š
```
é˜»å¡é—®é¢˜ï¼š
- å‚ä¸è€…åœ¨ç¬¬ä¸€é˜¶æ®µåå¿…é¡»ç­‰å¾…åè°ƒå™¨çš„å†³å®š
- å¦‚æœåè°ƒå™¨æ•…éšœï¼Œæ‰€æœ‰å‚ä¸è€…éƒ½è¢«é˜»å¡

å•ç‚¹æ•…éšœï¼š
- åè°ƒå™¨æ˜¯å”¯ä¸€çš„æ§åˆ¶ç‚¹
- åè°ƒå™¨æ•…éšœä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡æ— æ³•å®Œæˆ

æ•°æ®ä¸ä¸€è‡´é£é™©ï¼š
- ç¬¬äºŒé˜¶æ®µç½‘ç»œåˆ†åŒºå¯èƒ½å¯¼è‡´éƒ¨åˆ†æäº¤ã€éƒ¨åˆ†å›æ»š
```

### 5.3 TCC äº‹åŠ¡æ¨¡å¼


**TCCå«ä¹‰**ï¼š
- **Try**ï¼šå°è¯•æ‰§è¡Œï¼Œé¢„ç•™èµ„æº
- **Confirm**ï¼šç¡®è®¤æ‰§è¡Œï¼Œæäº¤èµ„æº
- **Cancel**ï¼šå–æ¶ˆæ‰§è¡Œï¼Œé‡Šæ”¾èµ„æº

**å®é™…æ¡ˆä¾‹ - è½¬è´¦æ“ä½œ**ï¼š
```
Tryé˜¶æ®µï¼š
è´¦æˆ·A: å†»ç»“100å…ƒ (ä½™é¢1000 â†’ å¯ç”¨900, å†»ç»“100)
è´¦æˆ·B: é¢„åŠ 100å…ƒ (é¢„ç•™åŠ æ¬¾è®°å½•)

Confirmé˜¶æ®µï¼š
è´¦æˆ·A: æ‰£å‡å†»ç»“é‡‘é¢ (å†»ç»“100 â†’ 0, ä½™é¢ä¸å˜)
è´¦æˆ·B: ç¡®è®¤åŠ æ¬¾ (ä½™é¢500 â†’ 600)

Cancelé˜¶æ®µ (å¦‚æœå¤±è´¥)ï¼š
è´¦æˆ·A: è§£å†»é‡‘é¢ (å¯ç”¨900 â†’ 1000, å†»ç»“100 â†’ 0)  
è´¦æˆ·B: åˆ é™¤é¢„åŠ æ¬¾è®°å½•
```

**TCCå®ç°ç¤ºä¾‹**ï¼š
```java
// ç®€åŒ–çš„TCCæ¥å£
public interface AccountService {
    // Try: é¢„ç•™èµ„æº
    boolean tryTransfer(String fromAccount, String toAccount, int amount);
    
    // Confirm: ç¡®è®¤æäº¤
    boolean confirmTransfer(String transactionId);
    
    // Cancel: å–æ¶ˆå›æ»š
    boolean cancelTransfer(String transactionId);
}

// è½¬è´¦TCCå®ç°
public class TransferTCCService {
    public void transfer(String fromAccount, String toAccount, int amount) {
        String txId = generateTransactionId();
        
        try {
            // Tryé˜¶æ®µï¼šæ‰€æœ‰æœåŠ¡é¢„ç•™èµ„æº
            boolean tryResult = accountService.tryTransfer(fromAccount, toAccount, amount);
            
            if (tryResult) {
                // Confirmé˜¶æ®µï¼šç¡®è®¤æ‰€æœ‰æ“ä½œ
                accountService.confirmTransfer(txId);
            } else {
                // Cancelé˜¶æ®µï¼šå›æ»šæ‰€æœ‰æ“ä½œ
                accountService.cancelTransfer(txId);
            }
        } catch (Exception e) {
            // å¼‚å¸¸æ—¶å›æ»š
            accountService.cancelTransfer(txId);
        }
    }
}
```

### 5.4 Saga äº‹åŠ¡æ¨¡å¼


**SagaåŸºæœ¬æ€æƒ³**ï¼šå°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºä¸€ç³»åˆ—å­äº‹åŠ¡ï¼Œæ¯ä¸ªå­äº‹åŠ¡éƒ½æœ‰å¯¹åº”çš„è¡¥å¿æ“ä½œã€‚

**å®é™…æ¡ˆä¾‹ - æ—…è¡Œé¢„è®¢**ï¼š
```
æ­£å‘æ“ä½œåºåˆ—ï¼š
T1: é¢„è®¢æœºç¥¨
T2: é¢„è®¢é…’åº—  
T3: é¢„è®¢ç§Ÿè½¦
T4: å‘é€ç¡®è®¤é‚®ä»¶

è¡¥å¿æ“ä½œåºåˆ—ï¼š
C1: å–æ¶ˆæœºç¥¨é¢„è®¢
C2: å–æ¶ˆé…’åº—é¢„è®¢
C3: å–æ¶ˆç§Ÿè½¦é¢„è®¢  
C4: å‘é€å–æ¶ˆé‚®ä»¶

æ‰§è¡Œæµç¨‹ï¼š
æˆåŠŸæƒ…å†µï¼šT1 â†’ T2 â†’ T3 â†’ T4 (å…¨éƒ¨æˆåŠŸ)
å¤±è´¥æƒ…å†µï¼šT1 â†’ T2 â†’ T3(å¤±è´¥) â†’ C2 â†’ C1 (è¡¥å¿å›æ»š)
```

**Sagaå®ç°æ–¹å¼**ï¼š

**åè°ƒå™¨æ¨¡å¼**ï¼š
```
ä¸­å¤®åè°ƒå™¨æ§åˆ¶æ•´ä¸ªSagaæµç¨‹
ä¼˜ç‚¹ï¼šæµç¨‹æ¸…æ™°ï¼Œä¾¿äºç›‘æ§
ç¼ºç‚¹ï¼šåè°ƒå™¨å¯èƒ½æˆä¸ºç“¶é¢ˆ
```

**ç¼–æ’æ¨¡å¼**ï¼š
```
æ¯ä¸ªæœåŠ¡å¤„ç†å®Œåé€šçŸ¥ä¸‹ä¸€ä¸ªæœåŠ¡
ä¼˜ç‚¹ï¼šå»ä¸­å¿ƒåŒ–ï¼Œæ€§èƒ½å¥½
ç¼ºç‚¹ï¼šæµç¨‹åˆ†æ•£ï¼Œéš¾ä»¥ç›‘æ§
```

---

## 6. ğŸ“Š åˆ†å¸ƒå¼ä¸€è‡´æ€§çº§åˆ«ä¸é€‰æ‹©ç­–ç•¥


### 6.1 ä¸€è‡´æ€§çº§åˆ«è¯¦è§£


**å¼ºä¸€è‡´æ€§**ï¼š
```
å®šä¹‰ï¼šä»»ä½•æ—¶åˆ»ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®éƒ½ç›¸åŒ
å®ç°ï¼šåŒæ­¥å¤åˆ¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç¡®è®¤åæ‰æäº¤
åœºæ™¯ï¼šé“¶è¡Œè´¦æˆ·ä½™é¢ã€åº“å­˜æ•°é‡
ä»£ä»·ï¼šæ€§èƒ½ä½ï¼Œå¯ç”¨æ€§å—å½±å“

ç¤ºä¾‹ï¼š
ç”¨æˆ·Aè½¬è´¦100å…ƒç»™ç”¨æˆ·B
- æ‰€æœ‰æ•°æ®åº“èŠ‚ç‚¹éƒ½æ›´æ–°å®Œæˆåï¼Œæ‰è¿”å›"è½¬è´¦æˆåŠŸ"
- ä»»ä½•æ—¶åˆ»æŸ¥è¯¢ï¼ŒAå’ŒBçš„ä½™é¢éƒ½æ˜¯å‡†ç¡®çš„
```

**å¼±ä¸€è‡´æ€§**ï¼š
```
å®šä¹‰ï¼šä¸ä¿è¯ä½•æ—¶è¾¾åˆ°ä¸€è‡´æ€§ï¼Œç”šè‡³å¯èƒ½æ°¸è¿œä¸ä¸€è‡´
å®ç°ï¼šå¼‚æ­¥å¤åˆ¶ï¼Œå¯èƒ½å‡ºç°æ•°æ®ä¸¢å¤±
åœºæ™¯ï¼šç¼“å­˜æ•°æ®ã€ä¸´æ—¶çŠ¶æ€
ç‰¹ç‚¹ï¼šæ€§èƒ½æœ€é«˜ï¼Œä½†æ•°æ®å¯é æ€§æœ€ä½

ç¤ºä¾‹ï¼š
ç½‘é¡µæµè§ˆè®¡æ•°å™¨
- ç”¨æˆ·è®¿é—®æ—¶ç«‹å³+1å¹¶è¿”å›
- æ•°æ®å¯èƒ½åœ¨æŸäº›èŠ‚ç‚¹ä¸¢å¤±
- ä¸å½±å“æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
```

**æœ€ç»ˆä¸€è‡´æ€§**ï¼š
```
å®šä¹‰ï¼šä¿è¯æœ€ç»ˆä¼šè¾¾åˆ°ä¸€è‡´çŠ¶æ€ï¼Œä½†å…è®¸ä¸­é—´è¿‡ç¨‹ä¸ä¸€è‡´
å®ç°ï¼šå¼‚æ­¥å¤åˆ¶ + å†²çªæ£€æµ‹å’Œä¿®å¤
åœºæ™¯ï¼šç¤¾äº¤åª’ä½“ã€å†…å®¹åˆ†å‘ã€ç”µå•†è¯„è®º
ç‰¹ç‚¹ï¼šå¹³è¡¡æ€§èƒ½å’Œä¸€è‡´æ€§

ç¤ºä¾‹ï¼š
å¾®åšç‚¹èµåŠŸèƒ½
- ç”¨æˆ·ç‚¹èµç«‹å³æ˜¾ç¤ºæˆåŠŸ
- ç‚¹èµæ•°åœ¨å„ä¸ªæœåŠ¡å™¨é—´é€æ­¥åŒæ­¥
- å‡ ç§’æˆ–å‡ åˆ†é’Ÿåæ‰€æœ‰ç”¨æˆ·çœ‹åˆ°ç›¸åŒçš„ç‚¹èµæ•°
```

### 6.2 ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©å†³ç­–çŸ©é˜µ


| ä¸šåŠ¡åœºæ™¯ | **æ•°æ®é‡è¦æ€§** | **ä¸€è‡´æ€§è¦æ±‚** | **æ¨èçº§åˆ«** | **å®ç°æ–¹æ¡ˆ** |
|---------|-------------|-------------|-------------|-------------|
| `é“¶è¡Œè½¬è´¦` | æé«˜ | ç»å¯¹ä¸èƒ½é”™ | å¼ºä¸€è‡´æ€§ | 2PC/3PC |
| `åº“å­˜æ‰£å‡` | é«˜ | ä¸èƒ½è¶…å– | å¼ºä¸€è‡´æ€§ | åˆ†å¸ƒå¼é” |
| `è®¢å•çŠ¶æ€` | é«˜ | æœ€ç»ˆå‡†ç¡® | æœ€ç»ˆä¸€è‡´æ€§ | äº‹åŠ¡æ¶ˆæ¯ |
| `ç”¨æˆ·ç§¯åˆ†` | ä¸­ | æœ€ç»ˆå‡†ç¡® | æœ€ç»ˆä¸€è‡´æ€§ | å¼‚æ­¥å¤„ç† |
| `æµè§ˆå†å²` | ä½ | å¯ä»¥ä¸¢å¤± | å¼±ä¸€è‡´æ€§ | æœ¬åœ°ç¼“å­˜ |
| `æ¨èç®—æ³•` | ä½ | å…è®¸å»¶è¿Ÿ | å¼±ä¸€è‡´æ€§ | æ‰¹å¤„ç† |

### 6.3 ä¸€è‡´æ€§çº§åˆ«æƒè¡¡åˆ†æ


**æ€§èƒ½vsä¸€è‡´æ€§æƒè¡¡**ï¼š
```
å¼ºä¸€è‡´æ€§ï¼š
å»¶è¿Ÿï¼šé«˜ (éœ€è¦ç­‰å¾…æ‰€æœ‰èŠ‚ç‚¹ç¡®è®¤)
ååé‡ï¼šä½ (å—æœ€æ…¢èŠ‚ç‚¹å½±å“)  
å¯ç”¨æ€§ï¼šä½ (å•ç‚¹æ•…éšœå½±å“æ•´ä½“)
é€‚ç”¨ï¼šå…³é”®ä¸šåŠ¡æ•°æ®

æœ€ç»ˆä¸€è‡´æ€§ï¼š
å»¶è¿Ÿï¼šä½ (å¼‚æ­¥å¤„ç†)
ååé‡ï¼šé«˜ (å¹¶è¡Œå¤„ç†)
å¯ç”¨æ€§ï¼šé«˜ (å±€éƒ¨æ•…éšœä¸å½±å“æ•´ä½“)  
é€‚ç”¨ï¼šå¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯

å¼±ä¸€è‡´æ€§ï¼š
å»¶è¿Ÿï¼šæœ€ä½ (æ— åŒæ­¥å¼€é”€)
ååé‡ï¼šæœ€é«˜ (æ— ä¸€è‡´æ€§çº¦æŸ)
å¯ç”¨æ€§ï¼šæœ€é«˜ (å®Œå…¨ç‹¬ç«‹)
é€‚ç”¨ï¼šä¸´æ—¶æ•°æ®ã€ç¼“å­˜
```

### 6.4 å®é™…é€‰æ‹©ç­–ç•¥


**ä¸šåŠ¡åˆ†å±‚ç­–ç•¥**ï¼š
```
æ ¸å¿ƒä¸šåŠ¡å±‚ï¼šå¼ºä¸€è‡´æ€§
- ç”¨æˆ·è´¦æˆ·ä½™é¢
- å•†å“åº“å­˜æ•°é‡
- äº¤æ˜“è®°å½•

ä¸€èˆ¬ä¸šåŠ¡å±‚ï¼šæœ€ç»ˆä¸€è‡´æ€§  
- ç”¨æˆ·ç§¯åˆ†ç´¯è®¡
- è®¢å•çŠ¶æ€åŒæ­¥
- æ¶ˆæ¯é€šçŸ¥

è¾…åŠ©ä¸šåŠ¡å±‚ï¼šå¼±ä¸€è‡´æ€§
- è®¿é—®ç»Ÿè®¡
- æ¨èç®—æ³•
- æ—¥å¿—è®°å½•
```

**æ··åˆä¸€è‡´æ€§ç­–ç•¥**ï¼š
```java
// è®¢å•ç³»ç»Ÿç¤ºä¾‹
public class OrderService {
    
    // åº“å­˜æ‰£å‡ï¼šå¼ºä¸€è‡´æ€§
    @StrongConsistency
    public boolean reduceInventory(String productId, int quantity) {
        return inventoryService.reduceWithLock(productId, quantity);
    }
    
    // è®¢å•åˆ›å»ºï¼šæœ€ç»ˆä¸€è‡´æ€§
    @EventualConsistency  
    public void createOrder(Order order) {
        orderRepository.save(order);
        messageQueue.send(new OrderCreatedEvent(order));
    }
    
    // æ¨èæ›´æ–°ï¼šå¼±ä¸€è‡´æ€§
    @WeakConsistency
    public void updateRecommendation(String userId, String productId) {
        // å¼‚æ­¥æ›´æ–°ï¼Œä¸ä¿è¯å®æ—¶æ€§
        recommendationService.updateAsync(userId, productId);
    }
}
```

---

## 7. ğŸ”’ åˆ†å¸ƒå¼é”æœºåˆ¶è®¾è®¡ä¸å®ç°


### 7.1 åˆ†å¸ƒå¼é”çš„å¿…è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”**ï¼š
```
å•æœºç¯å¢ƒï¼š
çº¿ç¨‹Aå’Œçº¿ç¨‹Bç«äº‰åŒä¸€èµ„æºï¼Œä½¿ç”¨synchronizedæˆ–Lock

åˆ†å¸ƒå¼ç¯å¢ƒï¼š
æœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨Bçš„è¿›ç¨‹ç«äº‰åŒä¸€èµ„æºï¼Œsynchronizedæ— æ•ˆï¼

å®é™…åœºæ™¯ï¼š
å¤šä¸ªè®¢å•æœåŠ¡å®ä¾‹åŒæ—¶å¤„ç†åŒä¸€å•†å“çš„åº“å­˜æ‰£å‡
å¯èƒ½å¯¼è‡´è¶…å–é—®é¢˜
```

**åˆ†å¸ƒå¼é”çš„ç‰¹æ€§**ï¼š
```
äº’æ–¥æ€§ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è·å–é”
å¯é‡å…¥æ€§ï¼šåŒä¸€è¿›ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”  
é”è¶…æ—¶ï¼šé¿å…æ­»é”ï¼Œé”æœ‰è¿‡æœŸæ—¶é—´
éé˜»å¡ï¼šè·å–é”å¤±è´¥æ—¶å¯ä»¥ç«‹å³è¿”å›
å®¹é”™æ€§ï¼šé”æœåŠ¡æ•…éšœæ—¶èƒ½å¤Ÿæ¢å¤
```

### 7.2 åŸºäºRedisçš„åˆ†å¸ƒå¼é”


**åŸºæœ¬å®ç°**ï¼š
```java
public class RedisDistributedLock {
    private StringRedisTemplate redisTemplate;
    
    // è·å–é”
    public boolean tryLock(String lockKey, String lockValue, long expireTime) {
        // ä½¿ç”¨SETå‘½ä»¤çš„NXï¼ˆä¸å­˜åœ¨æ‰è®¾ç½®ï¼‰å’ŒEXï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰é€‰é¡¹
        String result = redisTemplate.execute((RedisCallback<String>) connection -> {
            byte[] key = lockKey.getBytes();
            byte[] value = lockValue.getBytes();
            return (String) connection.execute("SET", key, value, "NX".getBytes(), "EX".getBytes(), 
                   String.valueOf(expireTime).getBytes());
        });
        
        return "OK".equals(result);
    }
    
    // é‡Šæ”¾é”ï¼ˆä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰
    public boolean releaseLock(String lockKey, String lockValue) {
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
            
        Long result = redisTemplate.execute((RedisCallback<Long>) connection -> 
            (Long) connection.eval(luaScript.getBytes(), 1, 
                   lockKey.getBytes(), lockValue.getBytes()));
                   
        return result != null && result > 0;
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```java
// åº“å­˜æ‰£å‡åœºæ™¯
public boolean reduceInventory(String productId, int quantity) {
    String lockKey = "inventory_lock_" + productId;
    String lockValue = UUID.randomUUID().toString();
    long expireTime = 30; // 30ç§’è¶…æ—¶
    
    if (distributedLock.tryLock(lockKey, lockValue, expireTime)) {
        try {
            // æ£€æŸ¥åº“å­˜
            int currentStock = getInventory(productId);
            if (currentStock >= quantity) {
                // æ‰£å‡åº“å­˜
                updateInventory(productId, currentStock - quantity);
                return true;
            }
            return false;
        } finally {
            // é‡Šæ”¾é”
            distributedLock.releaseLock(lockKey, lockValue);
        }
    }
    
    // è·å–é”å¤±è´¥
    return false;
}
```

### 7.3 åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”


**å®ç°æ–¹æ¡ˆ**ï¼š
```sql
-- åˆ›å»ºé”è¡¨
CREATE TABLE distributed_lock (
    lock_name VARCHAR(64) PRIMARY KEY,
    locked_by VARCHAR(64) NOT NULL,
    locked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expire_at TIMESTAMP NOT NULL
);

-- è·å–é”ï¼ˆåˆ©ç”¨ä¸»é”®å”¯ä¸€çº¦æŸï¼‰
INSERT INTO distributed_lock (lock_name, locked_by, expire_at) 
VALUES ('inventory_123', 'server-001', DATE_ADD(NOW(), INTERVAL 30 SECOND));

-- é‡Šæ”¾é”
DELETE FROM distributed_lock 
WHERE lock_name = 'inventory_123' AND locked_by = 'server-001';

-- æ¸…ç†è¿‡æœŸé”ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
DELETE FROM distributed_lock WHERE expire_at < NOW();
```

**ä¼˜ç¼ºç‚¹åˆ†æ**ï¼š
```
ä¼˜ç‚¹ï¼š
âœ“ å®ç°ç®€å•ï¼Œåˆ©ç”¨æ•°æ®åº“ç‰¹æ€§
âœ“ å¼ºä¸€è‡´æ€§ï¼Œå¯é æ€§é«˜
âœ“ æ”¯æŒäº‹åŠ¡ï¼Œä¸ä¸šåŠ¡æ•°æ®ä¿æŒä¸€è‡´

ç¼ºç‚¹ï¼š
âœ— æ€§èƒ½è¾ƒä½ï¼Œæ•°æ®åº“å‹åŠ›å¤§
âœ— å•ç‚¹æ•…éšœé£é™©
âœ— é”ç²’åº¦ç²—ï¼Œå¹¶å‘åº¦ä¸é«˜
```

### 7.4 åˆ†å¸ƒå¼é”æœ€ä½³å®è·µ


**é”ç²’åº¦è®¾è®¡**ï¼š
```java
// ç²—ç²’åº¦é”ï¼šé”æ•´ä¸ªå•†å“ç±»ç›®
String coarseLock = "category_lock_electronics";

// ç»†ç²’åº¦é”ï¼šé”å…·ä½“å•†å“
String fineLock = "product_lock_" + productId;

// è¶…ç»†ç²’åº¦é”ï¼šé”å•†å“çš„ç‰¹å®šå±æ€§
String ultraFineLock = "inventory_lock_" + productId + "_" + warehouseId;

é€‰æ‹©åŸåˆ™ï¼š
- ç²’åº¦è¶Šç»†ï¼Œå¹¶å‘åº¦è¶Šé«˜
- ç²’åº¦è¶Šç²—ï¼Œå®ç°è¶Šç®€å•
- æ ¹æ®ä¸šåŠ¡åœºæ™¯æƒè¡¡é€‰æ‹©
```

**é”è¶…æ—¶è®¾è®¡**ï¼š
```java
public class LockTimeoutStrategy {
    
    // çŸ­æœŸé”ï¼šå¿«é€Ÿæ“ä½œ
    public static final long SHORT_LOCK = 5; // 5ç§’
    
    // ä¸­æœŸé”ï¼šä¸€èˆ¬ä¸šåŠ¡æ“ä½œ  
    public static final long MEDIUM_LOCK = 30; // 30ç§’
    
    // é•¿æœŸé”ï¼šå¤æ‚è®¡ç®—æˆ–IOæ“ä½œ
    public static final long LONG_LOCK = 300; // 5åˆ†é’Ÿ
    
    // æ ¹æ®æ“ä½œç±»å‹é€‰æ‹©è¶…æ—¶æ—¶é—´
    public long getTimeoutByOperation(String operation) {
        switch (operation) {
            case "inventory_reduce":
                return SHORT_LOCK;
            case "order_process":
                return MEDIUM_LOCK;
            case "batch_settlement":
                return LONG_LOCK;
            default:
                return MEDIUM_LOCK;
        }
    }
}
```

**é”™è¯¯å¤„ç†ç­–ç•¥**ï¼š
```java
public boolean processWithLock(String resource, Runnable task) {
    String lockKey = "lock_" + resource;
    String lockValue = generateLockValue();
    
    // é‡è¯•æœºåˆ¶
    int maxRetries = 3;
    int retryDelay = 100; // æ¯«ç§’
    
    for (int i = 0; i < maxRetries; i++) {
        if (distributedLock.tryLock(lockKey, lockValue, 30)) {
            try {
                task.run();
                return true;
            } catch (Exception e) {
                logger.error("Task execution failed", e);
                throw e;
            } finally {
                distributedLock.releaseLock(lockKey, lockValue);
            }
        }
        
        // è·å–é”å¤±è´¥ï¼Œç­‰å¾…é‡è¯•
        if (i < maxRetries - 1) {
            try {
                Thread.sleep(retryDelay * (i + 1)); // æŒ‡æ•°é€€é¿
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                return false;
            }
        }
    }
    
    // æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥
    logger.warn("Failed to acquire lock after {} retries", maxRetries);
    return false;
}
```

---

## 8. âš–ï¸ åˆ†å¸ƒå¼äº‹åŠ¡è®¾è®¡æƒè¡¡åŸåˆ™


### 8.1 æ€§èƒ½vsä¸€è‡´æ€§æƒè¡¡


**æƒè¡¡ç»´åº¦åˆ†æ**ï¼š
```
é«˜æ€§èƒ½éœ€æ±‚ï¼š
- ç”¨æˆ·äº¤äº’æ“ä½œï¼ˆç‚¹å‡»ã€æµè§ˆï¼‰
- é«˜å¹¶å‘åœºæ™¯ï¼ˆç§’æ€ã€æŠ¢è´­ï¼‰  
- å®æ—¶å“åº”è¦æ±‚ï¼ˆæœç´¢ã€æ¨èï¼‰

é€‰æ‹©ï¼šæœ€ç»ˆä¸€è‡´æ€§æˆ–å¼±ä¸€è‡´æ€§

é«˜ä¸€è‡´æ€§éœ€æ±‚ï¼š
- é‡‘èäº¤æ˜“ï¼ˆè½¬è´¦ã€æ”¯ä»˜ï¼‰
- åº“å­˜ç®¡ç†ï¼ˆå•†å“åº“å­˜ï¼‰
- æƒé™æ§åˆ¶ï¼ˆç”¨æˆ·æˆæƒï¼‰

é€‰æ‹©ï¼šå¼ºä¸€è‡´æ€§
```

**å®é™…æƒè¡¡ç­–ç•¥**ï¼š
```java
// ç”µå•†ç³»ç»Ÿçš„åˆ†å±‚è®¾è®¡
public class ECommerceTransactionStrategy {
    
    // æ ¸å¿ƒäº¤æ˜“ï¼šå¼ºä¸€è‡´æ€§
    @StrongConsistency
    public PaymentResult processPayment(PaymentRequest request) {
        // ä½¿ç”¨2PCç¡®ä¿èµ„é‡‘å®‰å…¨
        return paymentService.processWithTwoPhaseCommit(request);
    }
    
    // ä¸šåŠ¡æµç¨‹ï¼šæœ€ç»ˆä¸€è‡´æ€§
    @EventualConsistency
    public void processOrder(Order order) {
        // ç«‹å³å“åº”ç”¨æˆ·
        orderService.createOrder(order);
        
        // å¼‚æ­¥å¤„ç†åç»­æµç¨‹
        eventBus.publishAsync(new OrderCreatedEvent(order));
    }
    
    // ç»Ÿè®¡æ•°æ®ï¼šå¼±ä¸€è‡´æ€§
    @WeakConsistency  
    public void updateStatistics(String userId, String action) {
        // æœ€ä½³åŠªåŠ›ï¼Œå…è®¸æ•°æ®ä¸¢å¤±
        statisticsService.updateAsync(userId, action);
    }
}
```

### 8.2 å¤æ‚æ€§vså¯ç»´æŠ¤æ€§æƒè¡¡


**å¤æ‚æ€§æ¥æº**ï¼š
```
æŠ€æœ¯å¤æ‚æ€§ï¼š
- åˆ†å¸ƒå¼åè®®å®ç°
- æ•…éšœæ£€æµ‹å’Œæ¢å¤
- æ•°æ®ä¸€è‡´æ€§ä¿è¯

ä¸šåŠ¡å¤æ‚æ€§ï¼š
- è¡¥å¿é€»è¾‘è®¾è®¡
- å¼‚å¸¸åœºæ™¯å¤„ç†
- ç›‘æ§å’Œè¿ç»´
```

**ç®€åŒ–ç­–ç•¥**ï¼š
```java
// é¿å…è¿‡åº¦è®¾è®¡çš„åŸåˆ™
public class TransactionDesignPrinciples {
    
    // åŸåˆ™1ï¼šä¸šåŠ¡ä¼˜å…ˆï¼ŒæŠ€æœ¯æœåŠ¡ä¸šåŠ¡
    public void designByBusinessFirst() {
        // å…ˆæ˜ç¡®ä¸šåŠ¡å¯¹ä¸€è‡´æ€§çš„çœŸå®éœ€æ±‚
        // å†é€‰æ‹©å¯¹åº”çš„æŠ€æœ¯æ–¹æ¡ˆ
        // é¿å…ä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯
    }
    
    // åŸåˆ™2ï¼šæ¸è¿›å¼æ¼”è¿›
    public void evolutionaryDesign() {
        // åˆæœŸï¼šå•æœºäº‹åŠ¡ï¼Œç®€å•å¯é 
        // å‘å±•ï¼šå¼‚æ­¥æ¶ˆæ¯ï¼Œæœ€ç»ˆä¸€è‡´æ€§  
        // æˆç†Ÿï¼šåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¼ºä¸€è‡´æ€§
        // æ ¹æ®ä¸šåŠ¡å‘å±•é€æ­¥æ¼”è¿›
    }
    
    // åŸåˆ™3ï¼šç›‘æ§å¯è§‚æµ‹
    public void observabilityFirst() {
        // å®Œå–„çš„ç›‘æ§æ¯”å¤æ‚çš„å®¹é”™æ›´é‡è¦
        // èƒ½å¿«é€Ÿå‘ç°å’Œå®šä½é—®é¢˜
        // äººå·¥ä»‹å…¥ä¿®å¤æ¯”è‡ªåŠ¨æ¢å¤æ›´å¯é 
    }
}
```

### 8.3 æˆæœ¬vsæ”¶ç›Šæƒè¡¡


**æˆæœ¬åˆ†æ**ï¼š
```
å¼€å‘æˆæœ¬ï¼š
- å­¦ä¹ åˆ†å¸ƒå¼äº‹åŠ¡ç†è®º
- å®ç°å¤æ‚çš„åè°ƒé€»è¾‘
- æµ‹è¯•å„ç§å¼‚å¸¸åœºæ™¯

è¿ç»´æˆæœ¬ï¼š
- ç›‘æ§åˆ†å¸ƒå¼äº‹åŠ¡çŠ¶æ€
- å¤„ç†äº‹åŠ¡è¶…æ—¶å’Œå¤±è´¥
- æ•°æ®ä¸€è‡´æ€§æ ¡éªŒå’Œä¿®å¤

æ€§èƒ½æˆæœ¬ï¼š
- åˆ†å¸ƒå¼åè°ƒçš„ç½‘ç»œå¼€é”€
- é”ç«äº‰å¯¼è‡´çš„ååé‡ä¸‹é™
- å¤æ‚é€»è¾‘çš„CPUæ¶ˆè€—
```

**æ”¶ç›Šè¯„ä¼°**ï¼š
```
ä¸šåŠ¡æ”¶ç›Šï¼š
- æ•°æ®ä¸€è‡´æ€§ä¿è¯
- ç”¨æˆ·ä½“éªŒæå‡
- ä¸šåŠ¡å¯é æ€§å¢å¼º

æŠ€æœ¯æ”¶ç›Šï¼š
- ç³»ç»Ÿæ‰©å±•æ€§æå‡
- æ•…éšœå®¹é”™èƒ½åŠ›å¢å¼º
- æŠ€æœ¯æ¶æ„å…ˆè¿›æ€§
```

**å†³ç­–çŸ©é˜µ**ï¼š
| åœºæ™¯ç±»å‹ | **ä¸€è‡´æ€§è¦æ±‚** | **æŠ€æœ¯å¤æ‚åº¦** | **æ¨èæ–¹æ¡ˆ** | **å®æ–½ä¼˜å…ˆçº§** |
|---------|-------------|-------------|-------------|-------------|
| `åˆ›ä¸šåˆæœŸ` | ä¸­ç­‰ | ç®€å• | æœ€ç»ˆä¸€è‡´æ€§+äººå·¥ä¿®å¤ | é«˜ |
| `å¿«é€Ÿå‘å±•` | é«˜ | ä¸­ç­‰ | äº‹åŠ¡æ¶ˆæ¯+è¡¥å¿æœºåˆ¶ | ä¸­ |
| `æˆç†Ÿä¼ä¸š` | æé«˜ | å¤æ‚ | åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ | ä½ |
| `é‡‘èè¡Œä¸š` | æé«˜ | æå¤æ‚ | å¼ºä¸€è‡´æ€§+å¤šé‡ä¿éšœ | æé«˜ |

### 8.4 åˆ†å¸ƒå¼äº‹åŠ¡é€‰å‹æŒ‡å—


**é€‰å‹å†³ç­–æ ‘**ï¼š
```
é—®é¢˜1ï¼šèƒ½å¦æ¥å—æ•°æ®çŸ­æ—¶é—´ä¸ä¸€è‡´ï¼Ÿ
â”œâ”€ èƒ½æ¥å— â†’ è€ƒè™‘æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ
â”‚   â”œâ”€ å¼‚æ­¥æ¶ˆæ¯
â”‚   â”œâ”€ äº‹ä»¶é©±åŠ¨
â”‚   â””â”€ å®šæ—¶åŒæ­¥
â”‚
â””â”€ ä¸èƒ½æ¥å— â†’ è€ƒè™‘å¼ºä¸€è‡´æ€§æ–¹æ¡ˆ
    â”œâ”€ æ•°æ®é‡å°ä¸”æ€§èƒ½è¦æ±‚ä¸é«˜ â†’ 2PC/3PC
    â”œâ”€ éœ€è¦ä¸šåŠ¡è¡¥å¿èƒ½åŠ› â†’ TCC/Saga
    â””â”€ å¯¹æ€§èƒ½è¦æ±‚æé«˜ â†’ åˆ†å¸ƒå¼é”

é—®é¢˜2ï¼šç³»ç»Ÿè§„æ¨¡å’Œå¤æ‚åº¦å¦‚ä½•ï¼Ÿ
â”œâ”€ å°è§„æ¨¡ â†’ ä¼˜å…ˆé€‰æ‹©ç®€å•æ–¹æ¡ˆ
â”œâ”€ ä¸­ç­‰è§„æ¨¡ â†’ é€‰æ‹©æˆç†Ÿçš„å¼€æºæ–¹æ¡ˆ
â””â”€ å¤§è§„æ¨¡ â†’ è€ƒè™‘è‡ªç ”æˆ–å•†ä¸šè§£å†³æ–¹æ¡ˆ

é—®é¢˜3ï¼šå›¢é˜ŸæŠ€æœ¯èƒ½åŠ›å¦‚ä½•ï¼Ÿ
â”œâ”€ ä¸€èˆ¬ â†’ é€‰æ‹©ç®€å•æ˜“æ‡‚çš„æ–¹æ¡ˆ
â”œâ”€ è¾ƒå¼º â†’ å¯ä»¥å°è¯•å¤æ‚æ–¹æ¡ˆ
â””â”€ å¾ˆå¼º â†’ å¯ä»¥è‡ªç ”å®šåˆ¶æ–¹æ¡ˆ
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼äº‹åŠ¡æœ¬è´¨ï¼šåœ¨ç½‘ç»œç¯å¢ƒä¸‹ä¿è¯å¤šä¸ªç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§
ğŸ”¸ ACIDæŒ‘æˆ˜ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°ACIDç‰¹æ€§é¢ä¸´ç½‘ç»œã€å¹¶å‘ã€æ•…éšœç­‰æŒ‘æˆ˜
ğŸ”¸ CAPç†è®ºï¼šä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ä¸å¯èƒ½åŒæ—¶æ»¡è¶³
ğŸ”¸ BASEç†è®ºï¼šåŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§çš„å®ç”¨è®¾è®¡æ€è·¯
ğŸ”¸ åˆ†å¸ƒå¼é”ï¼šè§£å†³åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„èµ„æºç«äº‰é—®é¢˜
ğŸ”¸ è®¾è®¡æƒè¡¡ï¼šåœ¨æ€§èƒ½ã€ä¸€è‡´æ€§ã€å¤æ‚æ€§ä¹‹é—´æ‰¾åˆ°å¹³è¡¡
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆåˆ†å¸ƒå¼äº‹åŠ¡æ¯”å•æœºäº‹åŠ¡å¤æ‚**ï¼š
```
æ ¹æœ¬åŸå› ï¼š
- ç½‘ç»œä¸å¯é ï¼šå»¶è¿Ÿã€ä¸¢åŒ…ã€åˆ†åŒº
- èŠ‚ç‚¹ç‹¬ç«‹ï¼šæ•…éšœç‹¬ç«‹ã€æ—¶é’Ÿä¸åŒæ­¥
- å¹¶å‘å¤æ‚ï¼šåˆ†å¸ƒå¼é”ã€æ­»é”æ£€æµ‹

å¯¼è‡´ç»“æœï¼š
- æ— æ³•ä¿è¯åŸå­æ€§ï¼šéƒ¨åˆ†æˆåŠŸéƒ¨åˆ†å¤±è´¥
- ä¸€è‡´æ€§éš¾ä»¥ç»´æŠ¤ï¼šæ•°æ®åˆ†æ•£åœ¨å¤šä¸ªç³»ç»Ÿ
- æ€§èƒ½å¤§å¹…ä¸‹é™ï¼šç½‘ç»œé€šä¿¡å’Œåè°ƒå¼€é”€
```

**ğŸ”¹ å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ**ï¼š
```
ä¸šåŠ¡åˆ†æï¼š
1. æ•°æ®ä¸€è‡´æ€§è¦æ±‚ç¨‹åº¦
2. ç³»ç»Ÿæ€§èƒ½è¦æ±‚
3. æ•…éšœå®¹å¿åº¦
4. å¼€å‘ç»´æŠ¤æˆæœ¬

æŠ€æœ¯é€‰æ‹©ï¼š
- å¼ºä¸€è‡´æ€§éœ€æ±‚ â†’ 2PCã€åˆ†å¸ƒå¼é”
- æœ€ç»ˆä¸€è‡´æ€§å¯æ¥å— â†’ TCCã€Sagaã€äº‹åŠ¡æ¶ˆæ¯
- å¼±ä¸€è‡´æ€§å¯æ¥å— â†’ å¼‚æ­¥å¤„ç†ã€è¡¥å¿æœºåˆ¶
```

**ğŸ”¹ åˆ†å¸ƒå¼äº‹åŠ¡çš„å®æ–½åŸåˆ™**ï¼š
```
è®¾è®¡åŸåˆ™ï¼š
- ä¸šåŠ¡ä¼˜å…ˆï¼šæŠ€æœ¯æ–¹æ¡ˆæœåŠ¡ä¸šåŠ¡éœ€æ±‚
- æ¸è¿›æ¼”è¿›ï¼šä»ç®€å•åˆ°å¤æ‚é€æ­¥å‘å±•
- ç›‘æ§å®Œå–„ï¼šå¯è§‚æµ‹æ€§æ¯”å¤æ‚å®¹é”™æ›´é‡è¦

å®æ–½åŸåˆ™ï¼š
- é¿å…åˆ†å¸ƒå¼äº‹åŠ¡ï¼šèƒ½æ‹†åˆ†å°±æ‹†åˆ†
- è®¾è®¡è¡¥å¿æœºåˆ¶ï¼šå‡ºé”™æ—¶æœ‰æ¢å¤æ‰‹æ®µ
- å®Œå–„ç›‘æ§ï¼šåŠæ—¶å‘ç°å’Œå¤„ç†å¼‚å¸¸
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ä¸šåŠ¡åœºæ™¯æŒ‡å¯¼**ï¼š
- **ç”µå•†ç³»ç»Ÿ**ï¼šè®¢å•-åº“å­˜-æ”¯ä»˜çš„ä¸€è‡´æ€§ä¿è¯
- **é‡‘èç³»ç»Ÿ**ï¼šè½¬è´¦äº¤æ˜“çš„å¼ºä¸€è‡´æ€§è¦æ±‚
- **å†…å®¹å¹³å°**ï¼šç”¨æˆ·æ“ä½œçš„æœ€ç»ˆä¸€è‡´æ€§å¤„ç†
- **ç‰©è”ç½‘**ï¼šè®¾å¤‡çŠ¶æ€åŒæ­¥çš„å¼±ä¸€è‡´æ€§åº”ç”¨

**æ¶æ„è®¾è®¡æŒ‡å¯¼**ï¼š
- **å¾®æœåŠ¡æ‹†åˆ†**ï¼šé¿å…è·¨æœåŠ¡äº‹åŠ¡ï¼Œå‡å°‘åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚
- **æ•°æ®è®¾è®¡**ï¼šé€šè¿‡æ•°æ®æ¨¡å‹è®¾è®¡å‡å°‘åˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚æ€§
- **ä¸šåŠ¡æµç¨‹**ï¼šè®¾è®¡å¯è¡¥å¿çš„ä¸šåŠ¡æµç¨‹
- **ç›‘æ§è¿ç»´**ï¼šå»ºç«‹å®Œå–„çš„äº‹åŠ¡ç›‘æ§å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶

**æŠ€æœ¯é€‰å‹æŒ‡å¯¼**ï¼š
- **åˆåˆ›å…¬å¸**ï¼šä¼˜å…ˆé€‰æ‹©ç®€å•å¯é çš„æ–¹æ¡ˆï¼Œå¿«é€Ÿè¿­ä»£
- **æˆé•¿æœŸå…¬å¸**ï¼šå¼•å…¥æˆç†Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶
- **å¤§å‹ä¼ä¸š**ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©æˆ–è‡ªç ”ä¸“é—¨æ–¹æ¡ˆ

### 9.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


```
åŸºç¡€ç†è®ºï¼ˆæœ¬ç« å†…å®¹ï¼‰ï¼š
âœ“ åˆ†å¸ƒå¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ
âœ“ CAPå’ŒBASEç†è®º
âœ“ ä¸€è‡´æ€§çº§åˆ«é€‰æ‹©

å®ç°æŠ€æœ¯ï¼ˆä¸‹ç« å­¦ä¹ ï¼‰ï¼š
â–¡ 2PC/3PCè¯¦ç»†å®ç°
â–¡ TCCæ¡†æ¶ä½¿ç”¨
â–¡ Sagaæ¨¡å¼å®è·µ
â–¡ åˆ†å¸ƒå¼é”é«˜çº§ç‰¹æ€§

å·¥ç¨‹å®è·µï¼ˆåç»­å­¦ä¹ ï¼‰ï¼š
â–¡ åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶å¯¹æ¯”
â–¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§
â–¡ æ•…éšœå¤„ç†å’Œæ¢å¤
â–¡ ç›‘æ§å’Œè¿ç»´å®è·µ
```

**ğŸ§  æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ†å¸ƒå¼äº‹åŠ¡ä¿ä¸€è‡´ï¼Œç½‘ç»œæ•…éšœæ˜¯éš¾é¢˜
- CAPä¸‰é€‰äºŒï¼ŒBASEæ¥è¡¥å……
- å¼ºå¼±ä¸€è‡´çœ‹ä¸šåŠ¡ï¼Œæ€§èƒ½å¤æ‚è¦æƒè¡¡
- ç›‘æ§è¡¥å¿èƒœå¤æ‚ï¼Œæ¸è¿›æ¼”è¿›æ˜¯ç‹é“