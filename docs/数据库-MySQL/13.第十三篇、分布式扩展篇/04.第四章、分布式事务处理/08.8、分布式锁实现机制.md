---
title: 8ã€åˆ†å¸ƒå¼é”å®ç°æœºåˆ¶
---
## ğŸ“š ç›®å½•

1. [åˆ†å¸ƒå¼é”åŸºæœ¬æ¦‚å¿µ](#1-åˆ†å¸ƒå¼é”åŸºæœ¬æ¦‚å¿µ)
2. [æ•°æ®åº“åˆ†å¸ƒå¼é”](#2-æ•°æ®åº“åˆ†å¸ƒå¼é”)
3. [Redisåˆ†å¸ƒå¼é”](#3-Redisåˆ†å¸ƒå¼é”)
4. [ZooKeeperåˆ†å¸ƒå¼é”](#4-ZooKeeperåˆ†å¸ƒå¼é”)
5. [åˆ†å¸ƒå¼é”æ ¸å¿ƒæœºåˆ¶](#5-åˆ†å¸ƒå¼é”æ ¸å¿ƒæœºåˆ¶)
6. [æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹](#6-æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹)
7. [é«˜å¯ç”¨è®¾è®¡ä¸ç›‘æ§](#7-é«˜å¯ç”¨è®¾è®¡ä¸ç›‘æ§)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” åˆ†å¸ƒå¼é”åŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”


**ç®€å•ç†è§£**ï¼šåˆ†å¸ƒå¼é”å°±åƒç»™åˆ†æ•£åœ¨ä¸åŒåœ°æ–¹çš„ç¨‹åºåŠ ä¸Šä¸€æŠŠ"å…±åŒçš„é”"ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªç¨‹åºèƒ½æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚

```
ç”Ÿæ´»ä¸­çš„ç±»æ¯”ï¼š
å¤šäººå…±ç”¨ä¸€ä¸ªå«ç”Ÿé—´ï¼š
- è¿›å…¥å‰è¦æ£€æŸ¥é—¨é”
- å¦‚æœæœ‰äººåœ¨ç”¨ï¼Œå°±ç­‰å¾…
- ç”¨å®Œåé‡Šæ”¾é”ï¼Œè®©åˆ«äººä½¿ç”¨

åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼š
å¤šä¸ªæœåŠ¡å™¨å¤„ç†åŒä¸€ä¸ªè®¢å•ï¼š
- å¤„ç†å‰è¦è·å–é”
- å¦‚æœæœ‰æœåŠ¡å™¨åœ¨å¤„ç†ï¼Œå…¶ä»–ç­‰å¾…
- å¤„ç†å®Œé‡Šæ”¾é”ï¼Œé¿å…é‡å¤å¤„ç†
```

> ğŸ“Œ **æ ¸å¿ƒæ¦‚å¿µ**  
> åˆ†å¸ƒå¼é”æ˜¯åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œé€šè¿‡å¤–éƒ¨åè°ƒæœºåˆ¶å®ç°çš„äº’æ–¥è®¿é—®æ§åˆ¶ã€‚

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”


**ä¼ ç»Ÿé”çš„å±€é™æ€§**ï¼š
```
å•æœºç¯å¢ƒï¼š
çº¿ç¨‹A â†â†’ [JVMé”] â†â†’ çº¿ç¨‹B
        â†“
    å…±äº«èµ„æºè®¿é—®æ§åˆ¶ âœ…

åˆ†å¸ƒå¼ç¯å¢ƒï¼š
æœåŠ¡å™¨A â†â†’ [ï¼Ÿ] â†â†’ æœåŠ¡å™¨B
          â†“
    JVMé”æ— æ³•è·¨æœåŠ¡å™¨ âŒ
```

**å®é™…é—®é¢˜åœºæ™¯**ï¼š
- **åº“å­˜æ‰£å‡**ï¼šå¤šä¸ªè®¢å•æœåŠ¡åŒæ—¶æ‰£å‡åº“å­˜ï¼Œå¯èƒ½å‡ºç°è¶…å–
- **è®¢å•å¤„ç†**ï¼šé˜²æ­¢åŒä¸€è®¢å•è¢«å¤šæ¬¡å¤„ç†
- **ç¼“å­˜æ›´æ–°**ï¼šç¡®ä¿ç¼“å­˜æ•°æ®ä¸€è‡´æ€§
- **ä»»åŠ¡è°ƒåº¦**ï¼šå®šæ—¶ä»»åŠ¡åªåœ¨ä¸€å°æœºå™¨ä¸Šæ‰§è¡Œ

### 1.3 åˆ†å¸ƒå¼é”çš„åŸºæœ¬ç‰¹æ€§


```
ğŸ”¸ äº’æ–¥æ€§(Mutual Exclusion)
å«ä¹‰ï¼šåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”
ä½œç”¨ï¼šé˜²æ­¢å¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®ä¸´ç•Œèµ„æº

ğŸ”¸ é˜²æ­»é”(Deadlock-free)  
å«ä¹‰ï¼šå³ä½¿æŒé”è¿›ç¨‹å´©æºƒï¼Œé”ä¹Ÿèƒ½è¢«é‡Šæ”¾
å®ç°ï¼šè®¾ç½®é”è¶…æ—¶æ—¶é—´

ğŸ”¸ å®¹é”™æ€§(Fault tolerance)
å«ä¹‰ï¼šéƒ¨åˆ†èŠ‚ç‚¹æ•…éšœä¸å½±å“é”æœåŠ¡
å®ç°ï¼šå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œæ•…éšœè½¬ç§»

ğŸ”¸ å¯é‡å…¥æ€§(Reentrant)
å«ä¹‰ï¼šåŒä¸€å®¢æˆ·ç«¯å¯ä»¥å¤šæ¬¡è·å–åŒä¸€æŠŠé”
åœºæ™¯ï¼šé€’å½’è°ƒç”¨æˆ–åµŒå¥—é”å®š
```

---

## 2. ğŸ—„ï¸ æ•°æ®åº“åˆ†å¸ƒå¼é”


### 2.1 åŸºäºå”¯ä¸€ç´¢å¼•çš„å®ç°


**å®ç°åŸç†**ï¼šåˆ©ç”¨æ•°æ®åº“å”¯ä¸€ç´¢å¼•çš„çº¦æŸç‰¹æ€§ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ’å…¥ä¸€æ¡è®°å½•ã€‚

```sql
-- åˆ›å»ºé”è¡¨
CREATE TABLE distributed_lock (
    lock_name VARCHAR(64) PRIMARY KEY,  -- é”åç§°ï¼Œå”¯ä¸€ç´¢å¼•
    lock_value VARCHAR(64) NOT NULL,    -- é”æŒæœ‰è€…æ ‡è¯†
    expire_time TIMESTAMP NOT NULL,     -- é”è¿‡æœŸæ—¶é—´
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**åŠ é”æ“ä½œ**ï¼š
```sql
-- å°è¯•è·å–é”
INSERT INTO distributed_lock (lock_name, lock_value, expire_time) 
VALUES ('order_lock_12345', 'server_001', DATE_ADD(NOW(), INTERVAL 30 SECOND));

-- å¦‚æœæ’å…¥æˆåŠŸ = è·é”æˆåŠŸ
-- å¦‚æœæ’å…¥å¤±è´¥(å”¯ä¸€ç´¢å¼•å†²çª) = è·é”å¤±è´¥
```

**é‡Šæ”¾é”æ“ä½œ**ï¼š
```sql
-- é‡Šæ”¾é”(åªèƒ½é‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”)
DELETE FROM distributed_lock 
WHERE lock_name = 'order_lock_12345' 
  AND lock_value = 'server_001';
```

### 2.2 åŸºäºæ’ä»–é”çš„å®ç°


**å®ç°æ–¹å¼**ï¼šä½¿ç”¨æ•°æ®åº“çš„è¡Œçº§é”æœºåˆ¶ã€‚

```sql
-- æ–¹å¼1ï¼šSELECT FOR UPDATE
SELECT * FROM distributed_lock 
WHERE lock_name = 'order_lock_12345' 
FOR UPDATE;

-- æ–¹å¼2ï¼šUPDATEæ“ä½œ
UPDATE distributed_lock 
SET lock_value = 'server_001', 
    expire_time = DATE_ADD(NOW(), INTERVAL 30 SECOND)
WHERE lock_name = 'order_lock_12345';
```

### 2.3 æ•°æ®åº“é”çš„ä¼˜ç¼ºç‚¹


```
âœ… ä¼˜ç‚¹ï¼š
â€¢ å®ç°ç®€å•ï¼Œå®¹æ˜“ç†è§£
â€¢ å¼ºä¸€è‡´æ€§ï¼Œä¾èµ–æ•°æ®åº“ACIDç‰¹æ€§
â€¢ æ— éœ€é¢å¤–ç»„ä»¶ï¼Œç°æœ‰æ•°æ®åº“å³å¯

âŒ ç¼ºç‚¹ï¼š
â€¢ æ€§èƒ½è¾ƒå·®ï¼Œæ•°æ®åº“IOå¼€é”€å¤§
â€¢ å¯èƒ½å¯¼è‡´æ•°æ®åº“è¿æ¥æ± è€—å°½
â€¢ é”è¶…æ—¶å¤„ç†å¤æ‚
â€¢ å•ç‚¹æ•…éšœé£é™©(æ•°æ®åº“å®•æœº)

ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š
â€¢ å¯¹æ€§èƒ½è¦æ±‚ä¸é«˜çš„åœºæ™¯
â€¢ å·²æœ‰æ•°æ®åº“åŸºç¡€è®¾æ–½
â€¢ é”ç«äº‰ä¸æ¿€çƒˆçš„æƒ…å†µ
```

---

## 3. ğŸ”´ Redisåˆ†å¸ƒå¼é”


### 3.1 åŸºäºSETNXçš„ç®€å•å®ç°


**åŸºæœ¬åŸç†**ï¼šåˆ©ç”¨Redisçš„`SETNX`å‘½ä»¤çš„åŸå­æ€§ç‰¹å¾ã€‚

```java
public class RedisDistributedLock {
    private StringRedisTemplate redisTemplate;
    
    // ç®€å•åŠ é”
    public boolean tryLock(String lockKey, String clientId, long expireTime) {
        // SETNX: å¦‚æœkeyä¸å­˜åœ¨æ‰è®¾ç½®ï¼Œè¿”å›trueè¡¨ç¤ºè·é”æˆåŠŸ
        Boolean result = redisTemplate.opsForValue()
            .setIfAbsent(lockKey, clientId, expireTime, TimeUnit.SECONDS);
        return Boolean.TRUE.equals(result);
    }
    
    // é‡Šæ”¾é”
    public void unlock(String lockKey, String clientId) {
        // Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼šåªé‡Šæ”¾è‡ªå·±æŒæœ‰çš„é”
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('del', KEYS[1]) " +
            "else " +
            "    return 0 " +
            "end";
        
        redisTemplate.execute(new DefaultRedisScript<>(luaScript, Long.class),
            Arrays.asList(lockKey), clientId);
    }
}
```

> âš ï¸ **æ³¨æ„äº‹é¡¹**  
> ç®€å•çš„SETNXå®ç°å­˜åœ¨é—®é¢˜ï¼šå¦‚æœè®¾ç½®keyæˆåŠŸä½†è®¾ç½®è¿‡æœŸæ—¶é—´å¤±è´¥ï¼Œä¼šå¯¼è‡´æ­»é”ã€‚å¿…é¡»ä½¿ç”¨åŸå­æ“ä½œã€‚

### 3.2 Luaè„šæœ¬å®ç°åŸå­æ“ä½œ


**å®Œæ•´çš„åŠ é”è„šæœ¬**ï¼š
```lua
-- åŠ é”Luaè„šæœ¬
local lockKey = KEYS[1]      -- é”çš„key
local clientId = ARGV[1]     -- å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†
local expireTime = ARGV[2]   -- è¿‡æœŸæ—¶é—´(ç§’)

-- æ£€æŸ¥é”æ˜¯å¦å­˜åœ¨
if redis.call('exists', lockKey) == 0 then
    -- é”ä¸å­˜åœ¨ï¼Œè®¾ç½®é”å¹¶è¿”å›æˆåŠŸ
    redis.call('setex', lockKey, expireTime, clientId)
    return 1
else
    -- é”å·²å­˜åœ¨ï¼Œè¿”å›å¤±è´¥
    return 0
end
```

**å®Œæ•´çš„é‡Šæ”¾é”è„šæœ¬**ï¼š
```lua
-- é‡Šæ”¾é”Luaè„šæœ¬
local lockKey = KEYS[1]
local clientId = ARGV[1]

-- æ£€æŸ¥é”çš„æŒæœ‰è€…
if redis.call('get', lockKey) == clientId then
    -- æ˜¯è‡ªå·±æŒæœ‰çš„é”ï¼Œå¯ä»¥é‡Šæ”¾
    return redis.call('del', lockKey)
else
    -- ä¸æ˜¯è‡ªå·±çš„é”ï¼Œä¸èƒ½é‡Šæ”¾
    return 0
end
```

### 3.3 å¯é‡å…¥é”çš„å®ç°


**å®ç°æ€è·¯**ï¼šä½¿ç”¨Hashç»“æ„å­˜å‚¨é‡å…¥æ¬¡æ•°ã€‚

```java
public class RedisReentrantLock {
    
    // å¯é‡å…¥åŠ é”
    public boolean tryLock(String lockKey, String clientId, long expireTime) {
        String luaScript = 
            "local lockKey = KEYS[1] " +
            "local clientId = ARGV[1] " +
            "local expireTime = ARGV[2] " +
            
            "if redis.call('exists', lockKey) == 0 then " +
            "    redis.call('hset', lockKey, clientId, 1) " +
            "    redis.call('expire', lockKey, expireTime) " +
            "    return 1 " +
            "elseif redis.call('hexists', lockKey, clientId) == 1 then " +
            "    redis.call('hincrby', lockKey, clientId, 1) " +
            "    redis.call('expire', lockKey, expireTime) " +
            "    return 1 " +
            "else " +
            "    return 0 " +
            "end";
            
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Arrays.asList(lockKey), clientId, String.valueOf(expireTime));
            
        return result != null && result == 1L;
    }
    
    // å¯é‡å…¥é‡Šæ”¾é”
    public void unlock(String lockKey, String clientId) {
        String luaScript = 
            "local lockKey = KEYS[1] " +
            "local clientId = ARGV[1] " +
            
            "if redis.call('hexists', lockKey, clientId) == 0 then " +
            "    return 0 " +
            "else " +
            "    local count = redis.call('hincrby', lockKey, clientId, -1) " +
            "    if count > 0 then " +
            "        return 1 " +
            "    else " +
            "        redis.call('del', lockKey) " +
            "        return 1 " +
            "    end " +
            "end";
            
        redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Arrays.asList(lockKey), clientId);
    }
}
```

### 3.4 Redisé”çš„ä¼˜ç¼ºç‚¹


```
âœ… ä¼˜ç‚¹ï¼š
â€¢ æ€§èƒ½ä¼˜ç§€ï¼ŒRediså†…å­˜æ“ä½œé€Ÿåº¦å¿«
â€¢ æ”¯æŒè‡ªåŠ¨è¿‡æœŸï¼Œé¿å…æ­»é”
â€¢ å®ç°ç›¸å¯¹ç®€å•
â€¢ æ”¯æŒå¯é‡å…¥é”

âŒ ç¼ºç‚¹ï¼š
â€¢ Rediså•ç‚¹æ•…éšœé£é™©
â€¢ ä¸»ä»åˆ‡æ¢æ—¶å¯èƒ½ä¸¢å¤±é”
â€¢ æ—¶é’Ÿåç§»å¯èƒ½å¯¼è‡´é”æå‰è¿‡æœŸ
â€¢ éœ€è¦å®¢æˆ·ç«¯å¤„ç†ç»­ç§Ÿé—®é¢˜

ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š
â€¢ é«˜å¹¶å‘ã€ä½å»¶è¿Ÿè¦æ±‚
â€¢ é”æŒæœ‰æ—¶é—´è¾ƒçŸ­
â€¢ å¯æ¥å—æœ€ç»ˆä¸€è‡´æ€§
```

---

## 4. ğŸŒ² ZooKeeperåˆ†å¸ƒå¼é”


### 4.1 åŸºäºä¸´æ—¶é¡ºåºèŠ‚ç‚¹çš„å®ç°


**å®ç°åŸç†**ï¼šåˆ©ç”¨ZooKeeperçš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ç‰¹æ€§å’ŒWatcheræœºåˆ¶ã€‚

```
ZooKeeperé”å®ç°æµç¨‹ï¼š

/locks
  â”œâ”€â”€ lock_000000001  (ä¸´æ—¶é¡ºåºèŠ‚ç‚¹)
  â”œâ”€â”€ lock_000000002  
  â”œâ”€â”€ lock_000000003  
  â””â”€â”€ ...

è§„åˆ™ï¼š
1. åºå·æœ€å°çš„èŠ‚ç‚¹æŒæœ‰é”
2. å…¶ä»–èŠ‚ç‚¹ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
3. èŠ‚ç‚¹åˆ é™¤æ—¶ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹è·å¾—é”
```

**Javaå®ç°ç¤ºä¾‹**ï¼š
```java
public class ZooKeeperDistributedLock {
    private ZooKeeper zooKeeper;
    private String lockPath = "/distributed_locks";
    private String currentLockPath;
    private CountDownLatch lockAcquiredSignal;
    
    public boolean tryLock(long waitTime, TimeUnit unit) throws Exception {
        // 1. åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹
        currentLockPath = zooKeeper.create(
            lockPath + "/lock_", 
            new byte[0], 
            ZooDefs.Ids.OPEN_ACL_UNSAFE, 
            CreateMode.EPHEMERAL_SEQUENTIAL
        );
        
        // 2. è·å–æ‰€æœ‰å­èŠ‚ç‚¹å¹¶æ’åº
        List<String> children = zooKeeper.getChildren(lockPath, false);
        Collections.sort(children);
        
        // 3. åˆ¤æ–­æ˜¯å¦è·å¾—é”
        String currentNode = currentLockPath.substring(lockPath.length() + 1);
        int currentIndex = children.indexOf(currentNode);
        
        if (currentIndex == 0) {
            // å½“å‰èŠ‚ç‚¹æ˜¯æœ€å°çš„ï¼Œè·å¾—é”
            return true;
        } else {
            // ç›‘å¬å‰ä¸€ä¸ªèŠ‚ç‚¹
            String prevNode = children.get(currentIndex - 1);
            lockAcquiredSignal = new CountDownLatch(1);
            
            Stat stat = zooKeeper.exists(lockPath + "/" + prevNode, 
                new Watcher() {
                    @Override
                    public void process(WatchedEvent event) {
                        if (event.getType() == Event.EventType.NodeDeleted) {
                            lockAcquiredSignal.countDown();
                        }
                    }
                });
                
            if (stat == null) {
                // å‰ä¸€ä¸ªèŠ‚ç‚¹å·²åˆ é™¤ï¼Œé‡æ–°æ£€æŸ¥
                return tryLock(waitTime, unit);
            } else {
                // ç­‰å¾…å‰ä¸€ä¸ªèŠ‚ç‚¹åˆ é™¤
                return lockAcquiredSignal.await(waitTime, unit);
            }
        }
    }
    
    public void unlock() throws Exception {
        if (currentLockPath != null) {
            zooKeeper.delete(currentLockPath, -1);
            currentLockPath = null;
        }
    }
}
```

### 4.2 ZooKeeperé”çš„ç‰¹ç‚¹


**ä¼˜åŠ¿ç‰¹æ€§**ï¼š
```
ğŸ”¸ å¼ºä¸€è‡´æ€§
â€¢ åŸºäºZABåè®®ï¼Œä¿è¯å¼ºä¸€è‡´æ€§
â€¢ ä¸ä¼šå‡ºç°è„‘è£‚é—®é¢˜

ğŸ”¸ è‡ªåŠ¨æ•…éšœæ¢å¤
â€¢ ä¸´æ—¶èŠ‚ç‚¹åœ¨ä¼šè¯æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤
â€¢ é¿å…æ­»é”é—®é¢˜

ğŸ”¸ å…¬å¹³é”
â€¢ æŒ‰ç…§èŠ‚ç‚¹åˆ›å»ºé¡ºåºè·å¾—é”
â€¢ é¿å…é¥¥é¥¿é—®é¢˜

ğŸ”¸ é«˜å¯ç”¨
â€¢ é›†ç¾¤æ¨¡å¼ï¼Œå•ç‚¹æ•…éšœè‡ªåŠ¨æ¢å¤
```

### 4.3 ZooKeeperé”çš„ä¼˜ç¼ºç‚¹


```
âœ… ä¼˜ç‚¹ï¼š
â€¢ å¼ºä¸€è‡´æ€§ä¿è¯ï¼Œæ•°æ®å¯é æ€§é«˜
â€¢ è‡ªåŠ¨æ•…éšœæ¢å¤ï¼Œé¿å…æ­»é”
â€¢ å¤©ç„¶æ”¯æŒå…¬å¹³é”
â€¢ é›†ç¾¤é«˜å¯ç”¨

âŒ ç¼ºç‚¹ï¼š
â€¢ æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œç½‘ç»œé€šä¿¡å¼€é”€å¤§
â€¢ å®ç°å¤æ‚åº¦é«˜
â€¢ ä¾èµ–ZooKeeperé›†ç¾¤
â€¢ ä¸é€‚åˆé«˜é¢‘é”æ“ä½œ

ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š
â€¢ å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜
â€¢ é”ç«äº‰ä¸æ¿€çƒˆ
â€¢ å¯æ¥å—è¾ƒé«˜å»¶è¿Ÿ
â€¢ å·²æœ‰ZooKeeperåŸºç¡€è®¾æ–½
```

---

## 5. âš™ï¸ åˆ†å¸ƒå¼é”æ ¸å¿ƒæœºåˆ¶


### 5.1 é”è¶…æ—¶å¤„ç†æœºåˆ¶


**ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
å®¢æˆ·ç«¯Aè·å¾—é” â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘ â†’ è¿›ç¨‹å´©æºƒ
                              â†“
                          é”æ— æ³•é‡Šæ”¾ â†’ æ­»é”

è§£å†³æ–¹æ¡ˆï¼š
ä¸ºé”è®¾ç½®TTL(Time To Live)ï¼Œåˆ°æœŸè‡ªåŠ¨é‡Šæ”¾
```

**è¶…æ—¶æ—¶é—´è®¾ç½®ç­–ç•¥**ï¼š
```java
public class LockTimeoutStrategy {
    
    // ä¿å®ˆç­–ç•¥ï¼šä¸šåŠ¡æ‰§è¡Œæ—¶é—´ Ã— 2
    public long getConservativeTimeout(long businessTime) {
        return businessTime * 2;
    }
    
    // åŠ¨æ€è°ƒæ•´ç­–ç•¥ï¼šæ ¹æ®å†å²æ‰§è¡Œæ—¶é—´è®¡ç®—
    public long getDynamicTimeout(String lockKey) {
        // è·å–å†å²å¹³å‡æ‰§è¡Œæ—¶é—´
        long avgTime = getAverageExecutionTime(lockKey);
        // åŠ ä¸Šå®‰å…¨è¾¹ç•Œ
        return avgTime + (avgTime * 50 / 100); // +50%çš„å®‰å…¨è¾¹ç•Œ
    }
    
    // æœ€å¤§è¶…æ—¶é™åˆ¶
    private static final long MAX_TIMEOUT = 300_000; // 5åˆ†é’Ÿ
    
    public long getSafeTimeout(long calculatedTimeout) {
        return Math.min(calculatedTimeout, MAX_TIMEOUT);
    }
}
```

### 5.2 é”ç»­ç§Ÿæœºåˆ¶


**ç»­ç§Ÿçš„å¿…è¦æ€§**ï¼š
```
é—®é¢˜ï¼šä¸šåŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡é”è¶…æ—¶æ—¶é—´
ä¸šåŠ¡å¼€å§‹ â†’ è·å¾—é”(30s) â†’ ä¸šåŠ¡æ‰§è¡Œ(45s) â†’ é”å·²è¿‡æœŸè¢«å…¶ä»–è¿›ç¨‹è·å¾— âŒ

è§£å†³ï¼šé”ç»­ç§Ÿæœºåˆ¶
ä¸šåŠ¡å¼€å§‹ â†’ è·å¾—é”(30s) â†’ åå°ç»­ç§Ÿ+15s â†’ ç»§ç»­æ‰§è¡Œ â†’ æ­£å¸¸é‡Šæ”¾ âœ…
```

**ç»­ç§Ÿå®ç°**ï¼š
```java
public class LockRenewal {
    private final ScheduledExecutorService scheduler = 
        Executors.newScheduledThreadPool(1);
    
    public void startRenewal(String lockKey, String clientId, 
                           long renewalInterval) {
        scheduler.scheduleAtFixedRate(() -> {
            try {
                // æ£€æŸ¥é”æ˜¯å¦è¿˜å±äºå½“å‰å®¢æˆ·ç«¯
                if (isLockOwnedByClient(lockKey, clientId)) {
                    // ç»­ç§Ÿï¼šå»¶é•¿è¿‡æœŸæ—¶é—´
                    renewLock(lockKey, clientId, 30); // ç»­ç§Ÿ30ç§’
                } else {
                    // é”å·²ä¸¢å¤±ï¼Œåœæ­¢ç»­ç§Ÿ
                    stopRenewal();
                }
            } catch (Exception e) {
                // ç»­ç§Ÿå¤±è´¥ï¼Œè®°å½•æ—¥å¿—
                log.warn("Lock renewal failed for key: {}", lockKey, e);
            }
        }, renewalInterval, renewalInterval, TimeUnit.SECONDS);
    }
    
    private void renewLock(String lockKey, String clientId, long seconds) {
        String luaScript = 
            "if redis.call('get', KEYS[1]) == ARGV[1] then " +
            "    return redis.call('expire', KEYS[1], ARGV[2]) " +
            "else " +
            "    return 0 " +
            "end";
        // æ‰§è¡Œç»­ç§Ÿ...
    }
}
```

### 5.3 æ­»é”æ£€æµ‹ä¸å¤„ç†


**æ­»é”äº§ç”ŸåŸå› **ï¼š
```
åœºæ™¯1ï¼šé”æŒæœ‰è€…è¿›ç¨‹å´©æºƒ
è¿›ç¨‹Aè·å¾—é” â†’ è¿›ç¨‹Aå´©æºƒ â†’ é”æ— æ³•é‡Šæ”¾ â†’ æ­»é”

åœºæ™¯2ï¼šç½‘ç»œåˆ†åŒºå¯¼è‡´
è¿›ç¨‹Aè·å¾—é” â†’ ç½‘ç»œä¸­æ–­ â†’ æ— æ³•ä¸é”æœåŠ¡é€šä¿¡ â†’ å…¶ä»–è¿›ç¨‹æ— æ³•è·é”

åœºæ™¯3ï¼šç³»ç»Ÿæ—¶é’Ÿåç§»
è¿›ç¨‹Aè®¾ç½®é”TTL=30s â†’ ç³»ç»Ÿæ—¶é’Ÿå¿«è¿› â†’ é”æå‰è¿‡æœŸ â†’ è¿›ç¨‹Bè·å¾—åŒä¸€æŠŠé”
```

**æ­»é”æ£€æµ‹ç­–ç•¥**ï¼š
```java
public class DeadlockDetector {
    
    // æ£€æµ‹è¶…æ—¶é”
    public void detectTimeoutLocks() {
        String luaScript = 
            "local locks = redis.call('keys', 'lock:*') " +
            "local timeoutLocks = {} " +
            "for i=1, #locks do " +
            "    local ttl = redis.call('ttl', locks[i]) " +
            "    if ttl == -1 then " +  // æ°¸ä¸è¿‡æœŸçš„é”
            "        table.insert(timeoutLocks, locks[i]) " +
            "    end " +
            "end " +
            "return timeoutLocks";
        
        // å¤„ç†æ£€æµ‹åˆ°çš„æ­»é”...
    }
    
    // å¼ºåˆ¶é‡Šæ”¾è¶…æ—¶é”
    public void forceReleaseLock(String lockKey) {
        // è®°å½•æ—¥å¿—
        log.warn("Force releasing timeout lock: {}", lockKey);
        
        // åˆ é™¤é”
        redisTemplate.delete(lockKey);
        
        // å‘é€å‘Šè­¦
        alertService.sendDeadlockAlert(lockKey);
    }
}
```

### 5.4 é”é‡å…¥æœºåˆ¶å®ç°


**é‡å…¥é”çš„ä»·å€¼**ï¼š
```
ä¸šåŠ¡åœºæ™¯ï¼š
æ–¹æ³•Aè·å¾—é” â†’ è°ƒç”¨æ–¹æ³•B â†’ æ–¹æ³•Bä¹Ÿéœ€è¦åŒä¸€æŠŠé”

éé‡å…¥é”ï¼šæ–¹æ³•Bæ— æ³•è·å¾—é” â†’ æ­»é”
é‡å…¥é”ï¼šæ–¹æ³•Bæ£€æµ‹åˆ°æ˜¯åŒä¸€çº¿ç¨‹/è¿›ç¨‹ â†’ å…è®¸è·å¾—é”
```

**é‡å…¥è®¡æ•°å®ç°**ï¼š
```java
public class ReentrantCounter {
    
    public boolean tryLockWithReentrant(String lockKey, String threadId, 
                                      long expireSeconds) {
        String luaScript = 
            "local lockKey = KEYS[1] " +
            "local threadId = ARGV[1] " +
            "local expireTime = ARGV[2] " +
            
            // æ£€æŸ¥é”æ˜¯å¦å­˜åœ¨
            "if redis.call('exists', lockKey) == 0 then " +
            "    redis.call('hset', lockKey, threadId, 1) " +        // é¦–æ¬¡è·é”
            "    redis.call('expire', lockKey, expireTime) " +
            "    return 1 " +
            "end " +
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºé‡å…¥
            "if redis.call('hexists', lockKey, threadId) == 1 then " +
            "    redis.call('hincrby', lockKey, threadId, 1) " +      // é‡å…¥è®¡æ•°+1
            "    redis.call('expire', lockKey, expireTime) " +        // åˆ·æ–°è¿‡æœŸæ—¶é—´
            "    return 1 " +
            "else " +
            "    return 0 " +                                        // è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰
            "end";
            
        Long result = redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Arrays.asList(lockKey), threadId, String.valueOf(expireSeconds));
            
        return result != null && result.equals(1L);
    }
}
```

---

## 6. ğŸ“Š æ€§èƒ½å¯¹æ¯”ä¸é€‰å‹


### 6.1 æ€§èƒ½å¯¹æ¯”åˆ†æ


| ğŸ†š **å¯¹æ¯”ç»´åº¦** | **æ•°æ®åº“é”** | **Redisé”** | **ZooKeeperé”** |
|---------------|-------------|------------|----------------|
| **æ€§èƒ½** | ğŸ¢ æ…¢(100-500ms) | âš¡ å¿«(1-10ms) | ğŸ”„ ä¸­ç­‰(10-50ms) |
| **ä¸€è‡´æ€§** | ğŸ’ª å¼ºä¸€è‡´æ€§ | ğŸ”„ æœ€ç»ˆä¸€è‡´æ€§ | ğŸ’ª å¼ºä¸€è‡´æ€§ |
| **å¯ç”¨æ€§** | âš ï¸ å•ç‚¹é£é™© | ğŸ”„ ä¸»ä»åˆ‡æ¢ | âœ… é›†ç¾¤é«˜å¯ç”¨ |
| **å¤æ‚åº¦** | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ | ğŸ”´ å¤æ‚ |
| **èµ„æºæ¶ˆè€—** | ğŸ“ˆ é«˜(æ•°æ®åº“è¿æ¥) | ğŸ“‰ ä½(å†…å­˜) | ğŸ“Š ä¸­ç­‰(ç½‘ç»œé€šä¿¡) |

### 6.2 é€‰å‹å†³ç­–ä½“ç³»


```
ğŸ¯ ä¸šåŠ¡åœºæ™¯åˆ†æï¼š

é«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼š
â€¢ QPS > 10000
â€¢ å»¶è¿Ÿ < 10ms
â€¢ æ¨èï¼šRedisé”

è®¢å•å¤„ç†ç³»ç»Ÿï¼š
â€¢ å¼ºä¸€è‡´æ€§è¦æ±‚
â€¢ å¯æ¥å—ä¸­ç­‰å»¶è¿Ÿ
â€¢ æ¨èï¼šZooKeeperé”

å†…éƒ¨ç®¡ç†ç³»ç»Ÿï¼š
â€¢ å¹¶å‘é‡ä¸é«˜
â€¢ å®ç°ç®€å•ä¼˜å…ˆ
â€¢ æ¨èï¼šæ•°æ®åº“é”
```

**é€‰å‹å†³ç­–æµç¨‹**ï¼š
```
ä¸šåŠ¡éœ€æ±‚åˆ†æ
    â†“
å¹¶å‘é‡è¯„ä¼°(QPS)
    â”œâ”€â”€ ä½(<1000) â†’ æ•°æ®åº“é”
    â”œâ”€â”€ ä¸­(1000-10000) â†’ Redisé”
    â””â”€â”€ é«˜(>10000) â†’ Redisé” + ä¼˜åŒ–
    
ä¸€è‡´æ€§è¦æ±‚è¯„ä¼°
    â”œâ”€â”€ å¼ºä¸€è‡´æ€§ â†’ ZooKeeperé”
    â”œâ”€â”€ æœ€ç»ˆä¸€è‡´æ€§ â†’ Redisé”
    â””â”€â”€ åŸºæœ¬ä¸€è‡´æ€§ â†’ æ•°æ®åº“é”
    
æŠ€æœ¯æ ˆåŒ¹é…åº¦
    â”œâ”€â”€ å·²æœ‰Redis â†’ Redisé”
    â”œâ”€â”€ å·²æœ‰ZooKeeper â†’ ZooKeeperé”
    â””â”€â”€ ä»…æœ‰æ•°æ®åº“ â†’ æ•°æ®åº“é”
```

### 6.3 é”ç²’åº¦æ§åˆ¶ç­–ç•¥


**ç²’åº¦é€‰æ‹©åŸåˆ™**ï¼š
```
ğŸ”¸ ç»†ç²’åº¦é”
ä¼˜åŠ¿ï¼šå¹¶å‘åº¦é«˜ï¼Œé”ç«äº‰å°‘
ç¤ºä¾‹ï¼šæŒ‰è®¢å•IDåŠ é” lock:order:12345
é€‚ç”¨ï¼šé«˜å¹¶å‘åœºæ™¯

ğŸ”¸ ç²—ç²’åº¦é”  
ä¼˜åŠ¿ï¼šå®ç°ç®€å•ï¼Œç®¡ç†æ–¹ä¾¿
ç¤ºä¾‹ï¼šæŒ‰ç”¨æˆ·IDåŠ é” lock:user:1001
é€‚ç”¨ï¼šä¸šåŠ¡é€»è¾‘ç®€å•åœºæ™¯

ğŸ”¸ åˆ†æ®µé”
ä¼˜åŠ¿ï¼šå¹³è¡¡å¹¶å‘åº¦å’Œå¤æ‚åº¦
ç¤ºä¾‹ï¼šæŒ‰è®¢å•IDå“ˆå¸Œåˆ†æ®µ lock:order:segment:1
å®ç°ï¼šhash(orderId) % 16
```

**é”ç²’åº¦å®ç°ç¤ºä¾‹**ï¼š
```java
public class LockGranularityManager {
    
    // ç»†ç²’åº¦é”ï¼šå…·ä½“èµ„æºé”å®š
    public String getResourceLock(String resourceType, String resourceId) {
        return String.format("lock:%s:%s", resourceType, resourceId);
    }
    
    // åˆ†æ®µé”ï¼šå‡å°‘é”ç«äº‰
    public String getSegmentLock(String resourceId, int segments) {
        int segment = Math.abs(resourceId.hashCode()) % segments;
        return String.format("lock:segment:%d", segment);
    }
    
    // å±‚çº§é”ï¼šæ”¯æŒä¸åŒå±‚æ¬¡çš„é”å®š
    public List<String> getHierarchicalLocks(String userId, String orderId) {
        return Arrays.asList(
            "lock:global",           // å…¨å±€é”
            "lock:user:" + userId,   // ç”¨æˆ·çº§é”
            "lock:order:" + orderId  // è®¢å•çº§é”
        );
    }
}
```

---

## 7. ğŸ›¡ï¸ é«˜å¯ç”¨è®¾è®¡ä¸ç›‘æ§


### 7.1 é«˜å¯ç”¨è®¾è®¡ç­–ç•¥


**å¤šçº§å®¹é”™æœºåˆ¶**ï¼š
```
Level 1: å®¢æˆ·ç«¯å®¹é”™
â€¢ é‡è¯•æœºåˆ¶ï¼šæŒ‡æ•°é€€é¿é‡è¯•
â€¢ è¶…æ—¶å¤„ç†ï¼šè®¾ç½®åˆç†è¶…æ—¶æ—¶é—´
â€¢ é™çº§ç­–ç•¥ï¼šé”è·å–å¤±è´¥æ—¶çš„ä¸šåŠ¡é™çº§

Level 2: æœåŠ¡ç«¯å®¹é”™  
â€¢ ä¸»ä»åˆ‡æ¢ï¼šRedis Sentinel/Cluster
â€¢ æ•…éšœè½¬ç§»ï¼šZooKeeper Leaderé€‰ä¸¾
â€¢ æ•°æ®å¤‡ä»½ï¼šå®šæœŸå¤‡ä»½é”çŠ¶æ€

Level 3: ä¸šåŠ¡å®¹é”™
â€¢ å¹‚ç­‰è®¾è®¡ï¼šä¸šåŠ¡æ“ä½œæ”¯æŒé‡å¤æ‰§è¡Œ
â€¢ è¡¥å¿æœºåˆ¶ï¼šå¼‚å¸¸æƒ…å†µä¸‹çš„æ•°æ®ä¿®å¤
â€¢ ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§é”çŠ¶æ€å¼‚å¸¸
```

**å®¹é”™å®ç°ç¤ºä¾‹**ï¼š
```java
public class FaultTolerantLock {
    private final List<DistributedLock> lockProviders;
    private final RetryTemplate retryTemplate;
    
    public boolean tryLockWithFallback(String lockKey, long timeout) {
        // ä¸»é”æä¾›è€…
        for (DistributedLock provider : lockProviders) {
            try {
                Boolean result = retryTemplate.execute(context -> {
                    return provider.tryLock(lockKey, timeout);
                });
                
                if (Boolean.TRUE.equals(result)) {
                    return true;
                }
            } catch (Exception e) {
                log.warn("Lock provider {} failed", 
                    provider.getClass().getSimpleName(), e);
                // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæä¾›è€…
            }
        }
        
        // æ‰€æœ‰æä¾›è€…éƒ½å¤±è´¥ï¼Œæ‰§è¡Œé™çº§ç­–ç•¥
        return handleLockFailure(lockKey);
    }
    
    private boolean handleLockFailure(String lockKey) {
        // è®°å½•å¤±è´¥æŒ‡æ ‡
        meterRegistry.counter("lock.failure", "key", lockKey).increment();
        
        // æ ¹æ®ä¸šåŠ¡ç­–ç•¥å†³å®šæ˜¯å¦ç»§ç»­
        if (allowWithoutLock(lockKey)) {
            log.warn("Proceeding without lock for key: {}", lockKey);
            return true;
        }
        
        return false;
    }
}
```

### 7.2 é”ç«äº‰ä¼˜åŒ–ç®—æ³•


**ç«äº‰æ£€æµ‹æœºåˆ¶**ï¼š
```java
public class LockContention {
    private final MeterRegistry meterRegistry;
    private final Map<String, AtomicLong> contentionCounters = new ConcurrentHashMap<>();
    
    public void recordLockContention(String lockKey) {
        // è®°å½•ç«äº‰æ¬¡æ•°
        contentionCounters.computeIfAbsent(lockKey, k -> new AtomicLong(0))
                         .incrementAndGet();
        
        // å‘é€ç›‘æ§æŒ‡æ ‡
        meterRegistry.counter("lock.contention", "key", lockKey).increment();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦ä¼˜åŒ–
        checkOptimizationTrigger(lockKey);
    }
    
    private void checkOptimizationTrigger(String lockKey) {
        long contentionCount = contentionCounters.get(lockKey).get();
        
        if (contentionCount > 100) { // é˜ˆå€¼ï¼š100æ¬¡ç«äº‰
            // è§¦å‘ä¼˜åŒ–ç­–ç•¥
            optimizeLockStrategy(lockKey);
        }
    }
    
    private void optimizeLockStrategy(String lockKey) {
        // ç­–ç•¥1ï¼šå¢åŠ é”ç²’åº¦åˆ†ç‰‡
        suggestLockSharding(lockKey);
        
        // ç­–ç•¥2ï¼šè°ƒæ•´ä¸šåŠ¡é€»è¾‘
        suggestBusinessOptimization(lockKey);
        
        // ç­–ç•¥3ï¼šä½¿ç”¨é˜Ÿåˆ—æœºåˆ¶
        suggestQueueBasedProcessing(lockKey);
    }
}
```

**è‡ªé€‚åº”é€€é¿ç®—æ³•**ï¼š
```java
public class AdaptiveBackoff {
    private static final long BASE_DELAY_MS = 10;
    private static final long MAX_DELAY_MS = 1000;
    private static final double BACKOFF_MULTIPLIER = 1.5;
    
    public long calculateDelay(int attempt, String lockKey) {
        // åŸºç¡€æŒ‡æ•°é€€é¿
        long delay = (long) (BASE_DELAY_MS * Math.pow(BACKOFF_MULTIPLIER, attempt));
        
        // æ·»åŠ éšæœºæŠ–åŠ¨ï¼Œé¿å…æƒŠç¾¤æ•ˆåº”
        long jitter = (long) (delay * 0.1 * Math.random());
        
        // æ ¹æ®é”ç«äº‰æƒ…å†µè°ƒæ•´
        double contentionFactor = getLockContentionFactor(lockKey);
        delay = (long) (delay * contentionFactor);
        
        return Math.min(delay + jitter, MAX_DELAY_MS);
    }
    
    private double getLockContentionFactor(String lockKey) {
        // æ ¹æ®å†å²ç«äº‰æ•°æ®è®¡ç®—è°ƒæ•´å› å­
        long recentContention = getRecentContentionCount(lockKey);
        if (recentContention > 50) {
            return 2.0; // é«˜ç«äº‰ï¼Œå»¶é•¿ç­‰å¾…
        } else if (recentContention > 10) {
            return 1.5; // ä¸­ç­‰ç«äº‰
        } else {
            return 1.0; // ä½ç«äº‰ï¼Œæ­£å¸¸ç­‰å¾…
        }
    }
}
```

### 7.3 æ™ºèƒ½ç›‘æ§ç³»ç»Ÿ


**ç›‘æ§æŒ‡æ ‡ä½“ç³»**ï¼š
```java
@Component
public class LockMonitoring {
    private final MeterRegistry meterRegistry;
    
    // æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§
    public void recordLockMetrics(String lockKey, String operation, 
                                 long duration, boolean success) {
        // æ“ä½œè€—æ—¶
        meterRegistry.timer("lock.operation.duration", 
            "key", lockKey, "operation", operation)
            .record(duration, TimeUnit.MILLISECONDS);
        
        // æˆåŠŸç‡
        meterRegistry.counter("lock.operation.result",
            "key", lockKey, "operation", operation, 
            "result", success ? "success" : "failure")
            .increment();
        
        // å¹¶å‘åº¦
        meterRegistry.gauge("lock.concurrency", 
            Tags.of("key", lockKey), getCurrentConcurrency(lockKey));
    }
    
    // å¼‚å¸¸æ£€æµ‹
    public void detectAnomalies() {
        // æ£€æµ‹é•¿æ—¶é—´æŒé”
        detectLongHoldLocks();
        
        // æ£€æµ‹é«˜é¢‘ç«äº‰
        detectHighContention();
        
        // æ£€æµ‹æ­»é”é£é™©
        detectDeadlockRisk();
    }
    
    private void detectLongHoldLocks() {
        String luaScript = 
            "local locks = redis.call('keys', 'lock:*') " +
            "local longHoldLocks = {} " +
            "for i=1, #locks do " +
            "    local startTime = redis.call('hget', locks[i], 'startTime') " +
            "    if startTime and (redis.call('time')[1] - startTime) > 300 then " +
            "        table.insert(longHoldLocks, locks[i]) " +
            "    end " +
            "end " +
            "return longHoldLocks";
        
        // å¤„ç†é•¿æ—¶é—´æŒé”çš„æƒ…å†µ...
    }
}
```

**å‘Šè­¦ç­–ç•¥**ï¼š
```yaml
# ç›‘æ§å‘Šè­¦é…ç½®
lock_monitoring:
  alerts:
    # é”ç«äº‰å‘Šè­¦
    high_contention:
      threshold: 100          # 5åˆ†é’Ÿå†…ç«äº‰æ¬¡æ•°è¶…è¿‡100
      window: 5m
      severity: warning
    
    # æ­»é”æ£€æµ‹å‘Šè­¦  
    deadlock_suspected:
      threshold: 1            # å‘ç°ç–‘ä¼¼æ­»é”
      window: 1m
      severity: critical
    
    # é•¿æ—¶é—´æŒé”å‘Šè­¦
    long_hold:
      threshold: 300s         # æŒé”è¶…è¿‡5åˆ†é’Ÿ
      window: 1m
      severity: warning
    
    # é”å¤±è´¥ç‡å‘Šè­¦
    failure_rate:
      threshold: 10%          # å¤±è´¥ç‡è¶…è¿‡10%
      window: 5m
      severity: critical
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ åˆ†å¸ƒå¼é”æœ¬è´¨ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å®ç°èµ„æºçš„äº’æ–¥è®¿é—®æ§åˆ¶
ğŸ”¸ ä¸‰ç§ä¸»è¦å®ç°ï¼šæ•°æ®åº“é”ã€Redisé”ã€ZooKeeperé”
ğŸ”¸ æ ¸å¿ƒç‰¹æ€§ï¼šäº’æ–¥æ€§ã€é˜²æ­»é”ã€å®¹é”™æ€§ã€å¯é‡å…¥æ€§  
ğŸ”¸ å…³é”®æœºåˆ¶ï¼šè¶…æ—¶å¤„ç†ã€ç»­ç§Ÿæœºåˆ¶ã€æ­»é”æ£€æµ‹ã€é‡å…¥æ§åˆ¶
ğŸ”¸ é€‰å‹è€ƒè™‘ï¼šæ€§èƒ½è¦æ±‚ã€ä¸€è‡´æ€§è¦æ±‚ã€æŠ€æœ¯æ ˆåŒ¹é…
```

### 8.2 å®ç°æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“


> ğŸ“Œ **æ•°æ®åº“é”**  
> ä¼˜åŠ¿ï¼šå®ç°ç®€å•ï¼Œå¼ºä¸€è‡´æ€§  
> åŠ£åŠ¿ï¼šæ€§èƒ½è¾ƒå·®ï¼Œå•ç‚¹é£é™©  
> é€‚ç”¨ï¼šä½å¹¶å‘ã€å¼ºä¸€è‡´æ€§è¦æ±‚çš„åœºæ™¯

> ğŸ“Œ **Redisé”**  
> ä¼˜åŠ¿ï¼šæ€§èƒ½ä¼˜ç§€ï¼Œå®ç°çµæ´»  
> åŠ£åŠ¿ï¼šæœ€ç»ˆä¸€è‡´æ€§ï¼Œéœ€è¦å¤„ç†ç»­ç§Ÿ  
> é€‚ç”¨ï¼šé«˜å¹¶å‘ã€ä½å»¶è¿Ÿè¦æ±‚çš„åœºæ™¯

> ğŸ“Œ **ZooKeeperé”**  
> ä¼˜åŠ¿ï¼šå¼ºä¸€è‡´æ€§ï¼Œå¤©ç„¶å…¬å¹³é”ï¼Œé«˜å¯ç”¨  
> åŠ£åŠ¿ï¼šæ€§èƒ½ä¸­ç­‰ï¼Œå®ç°å¤æ‚  
> é€‚ç”¨ï¼šå¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯

### 8.3 æœ€ä½³å®è·µæŒ‡å¯¼


**è®¾è®¡åŸåˆ™**ï¼š
```
ğŸ”¸ é”ç²’åº¦è¦åˆé€‚ï¼šå¤ªç²—å½±å“å¹¶å‘ï¼Œå¤ªç»†å¢åŠ å¤æ‚åº¦
ğŸ”¸ è¶…æ—¶æ—¶é—´è¦åˆç†ï¼šå¤ªçŸ­å®¹æ˜“è¯¯é‡Šæ”¾ï¼Œå¤ªé•¿å½±å“æ•…éšœæ¢å¤
ğŸ”¸ é‡è¯•ç­–ç•¥è¦æ™ºèƒ½ï¼šæŒ‡æ•°é€€é¿+éšæœºæŠ–åŠ¨é¿å…æƒŠç¾¤
ğŸ”¸ ç›‘æ§å‘Šè­¦è¦å®Œå–„ï¼šåŠæ—¶å‘ç°å¼‚å¸¸å’Œæ€§èƒ½é—®é¢˜
```

**å¸¸è§é—®é¢˜é¿å…**ï¼š
```
âŒ å¿˜è®°è®¾ç½®é”è¶…æ—¶ â†’ å¯èƒ½å¯¼è‡´æ­»é”
âŒ é‡Šæ”¾ä»–äººæŒæœ‰çš„é” â†’ ç ´åäº’æ–¥æ€§
âŒ é”ç²’åº¦è¿‡ç²— â†’ å½±å“ç³»ç»Ÿå¹¶å‘æ€§èƒ½
âŒ ç¼ºä¹ç›‘æ§ â†’ é—®é¢˜éš¾ä»¥åŠæ—¶å‘ç°
```

### 8.4 ä¸šåŠ¡åº”ç”¨å»ºè®®


**åœºæ™¯åŒ–é€‰æ‹©**ï¼š
- **åº“å­˜æ‰£å‡**ï¼šä½¿ç”¨Redisé”ï¼Œæ”¯æŒé«˜å¹¶å‘
- **è®¢å•å¹‚ç­‰**ï¼šä½¿ç”¨æ•°æ®åº“é”ï¼Œä¿è¯å¼ºä¸€è‡´æ€§  
- **å®šæ—¶ä»»åŠ¡**ï¼šä½¿ç”¨ZooKeeperé”ï¼Œé¿å…é‡å¤æ‰§è¡Œ
- **ç¼“å­˜æ›´æ–°**ï¼šä½¿ç”¨Redisé”ï¼Œå¿«é€Ÿå“åº”

**æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼š
- åˆç†è®¾ç½®é”ç²’åº¦ï¼Œé¿å…ä¸å¿…è¦çš„ç«äº‰
- ä½¿ç”¨åˆ†æ®µé”æŠ€æœ¯ï¼Œæé«˜å¹¶å‘åº¦
- å®ç°æ™ºèƒ½é‡è¯•å’Œé€€é¿ç®—æ³•
- å»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ†å¸ƒå¼é”ä¿äº’æ–¥ï¼Œä¸‰ç§æ–¹æ¡ˆå„æœ‰ä¼˜
- æ•°æ®åº“ç®€å•ä½†æ…¢ï¼ŒRediså¿«é€Ÿéœ€ç»­ç§Ÿ  
- ZooKeeperä¸€è‡´å¼ºï¼Œé€‰å‹è¦çœ‹ä¸šåŠ¡éœ€
- è¶…æ—¶é‡å…¥æ­»é”é˜²ï¼Œç›‘æ§å‘Šè­¦ä¸å¯å°‘