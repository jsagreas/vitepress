---
title: 7ã€IDç”Ÿæˆå™¨æ¶æ„è®¾è®¡
---
## ğŸ“š ç›®å½•

1. [IDç”Ÿæˆå™¨æ¶æ„è®¾è®¡æ¦‚è¿°](#1-IDç”Ÿæˆå™¨æ¶æ„è®¾è®¡æ¦‚è¿°)
2. [ç”Ÿæˆå™¨æ¶æ„æ¨¡å¼](#2-ç”Ÿæˆå™¨æ¶æ„æ¨¡å¼)
3. [æœåŠ¡åŒ–è®¾è®¡ä¸å¾®æœåŠ¡æ¶æ„](#3-æœåŠ¡åŒ–è®¾è®¡ä¸å¾®æœåŠ¡æ¶æ„)
4. [è´Ÿè½½å‡è¡¡ä¸é›†ç¾¤ç­–ç•¥](#4-è´Ÿè½½å‡è¡¡ä¸é›†ç¾¤ç­–ç•¥)
5. [ç¼“å­˜æœºåˆ¶è®¾è®¡](#5-ç¼“å­˜æœºåˆ¶è®¾è®¡)
6. [ç›‘æ§å‘Šè­¦ä¸è¿ç»´ä¿éšœ](#6-ç›‘æ§å‘Šè­¦ä¸è¿ç»´ä¿éšœ)
7. [å®¹ç¾å¤‡ä»½ä¸é«˜å¯ç”¨](#7-å®¹ç¾å¤‡ä»½ä¸é«˜å¯ç”¨)
8. [æ‰©å®¹ç¼©å®¹ç­–ç•¥](#8-æ‰©å®¹ç¼©å®¹ç­–ç•¥)
9. [å®‰å…¨æœºåˆ¶è®¾è®¡](#9-å®‰å…¨æœºåˆ¶è®¾è®¡)
10. [æ€§èƒ½è°ƒä¼˜æŒ‡å—](#10-æ€§èƒ½è°ƒä¼˜æŒ‡å—)
11. [å¤šç§Ÿæˆ·æ”¯æŒ](#11-å¤šç§Ÿæˆ·æ”¯æŒ)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ—ï¸ IDç”Ÿæˆå™¨æ¶æ„è®¾è®¡æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯IDç”Ÿæˆå™¨æ¶æ„


**åŸºæœ¬æ¦‚å¿µ**ï¼š
IDç”Ÿæˆå™¨æ¶æ„æ˜¯æŒ‡ä¸“é—¨ç”¨äºç”Ÿæˆå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦çš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚å®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„**åŸºç¡€è®¾æ–½ç»„ä»¶**ï¼Œå°±åƒä¾›ç”µç³»ç»Ÿä¸ºæ•´ä¸ªåŸå¸‚æä¾›ç”µåŠ›ä¸€æ ·ï¼ŒIDç”Ÿæˆå™¨ä¸ºæ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å”¯ä¸€æ ‡è¯†ç¬¦ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„æ¶æ„è®¾è®¡**ï¼š
- **æµ·é‡å¹¶å‘**ï¼šæ¯ç§’å¯èƒ½éœ€è¦ç”Ÿæˆæ•°ä¸‡ç”šè‡³æ•°åä¸‡ä¸ªID
- **å…¨å±€å”¯ä¸€**ï¼šä¿è¯ä»»ä½•æ—¶å€™ç”Ÿæˆçš„IDéƒ½ä¸ä¼šé‡å¤
- **é«˜å¯ç”¨æ€§**ï¼šä¸èƒ½å› ä¸ºIDç”ŸæˆæœåŠ¡æ•…éšœå½±å“æ•´ä¸ªä¸šåŠ¡ç³»ç»Ÿ
- **ä½å»¶è¿Ÿ**ï¼šIDç”Ÿæˆä¸èƒ½æˆä¸ºç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆ

### 1.2 æ¶æ„è®¾è®¡çš„æ ¸å¿ƒç›®æ ‡


```
æ€§èƒ½ç›®æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QPS: 100,000+   â”‚ â† æ¯ç§’å¤„ç†è¯·æ±‚æ•°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å»¶è¿Ÿ: < 1ms     â”‚ â† å“åº”æ—¶é—´è¦æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¯ç”¨æ€§: 99.99%  â”‚ â† é«˜å¯ç”¨æ€§ä¿è¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸šåŠ¡ç›®æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…¨å±€å”¯ä¸€æ€§      â”‚ â† ç»å¯¹ä¸èƒ½é‡å¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœ‰åºæ€§(å¯é€‰)    â”‚ â† éƒ¨åˆ†åœºæ™¯éœ€è¦
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®‰å…¨æ€§          â”‚ â† é˜²æ­¢æ¶æ„æ”»å‡»
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”§ ç”Ÿæˆå™¨æ¶æ„æ¨¡å¼


### 2.1 å•æœºé›†ä¸­å¼æ¶æ„


**æ¶æ„å›¾**ï¼š
```
åº”ç”¨ç³»ç»Ÿç¾¤           IDç”Ÿæˆå™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨A   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚  å•æœº   â”‚
â”‚ åº”ç”¨B   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  ID     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚ ç”Ÿæˆå™¨  â”‚
â”‚ åº”ç”¨C   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹è¯´æ˜**ï¼š
- **ç®€å•ç›´è§‚**ï¼šæ‰€æœ‰åº”ç”¨éƒ½å‘åŒä¸€ä¸ªIDç”Ÿæˆå™¨è¯·æ±‚
- **å®¹æ˜“ä¿è¯å”¯ä¸€æ€§**ï¼šåªæœ‰ä¸€ä¸ªç”Ÿæˆæºï¼Œä¸ä¼šå†²çª
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šå•æœºå¤„ç†èƒ½åŠ›æœ‰é™ï¼Œæ— æ³•æ”¯æ’‘é«˜å¹¶å‘
- **å•ç‚¹æ•…éšœ**ï¼šç”Ÿæˆå™¨æŒ‚æ‰ï¼Œæ•´ä¸ªç³»ç»Ÿæ— æ³•è·å–ID

**é€‚ç”¨åœºæ™¯**ï¼šå°å‹ç³»ç»Ÿï¼Œå¹¶å‘é‡ä¸é«˜ï¼ˆ< 1000 QPSï¼‰

### 2.2 åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„


**æ¶æ„å›¾**ï¼š
```
åº”ç”¨ç³»ç»Ÿç¾¤              IDç”Ÿæˆå™¨é›†ç¾¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨A   â”‚         â”‚ ç”Ÿæˆå™¨1 â”‚ â”‚ ç”Ÿæˆå™¨2 â”‚ â”‚ ç”Ÿæˆå™¨3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”€â”€â”€â”€â†’â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº”ç”¨B   â”‚    LB   â”‚ å·¥ä½œID1 â”‚ â”‚ å·¥ä½œID2 â”‚ â”‚ å·¥ä½œID3 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”€â”€â”€â”€â†’â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ åº”ç”¨C   â”‚             â†‘           â†‘           â†‘
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          ä¸åŒæœºå™¨ID   ä¸åŒæœºå™¨ID   ä¸åŒæœºå™¨ID
```

**å…³é”®è®¾è®¡**ï¼š
- **æœºå™¨IDåˆ†é…**ï¼šæ¯å°ç”Ÿæˆå™¨åˆ†é…ä¸åŒçš„æœºå™¨æ ‡è¯†
- **è´Ÿè½½å‡è¡¡**ï¼šè¯·æ±‚åˆ†æ•£åˆ°ä¸åŒçš„ç”Ÿæˆå™¨
- **é«˜å¯ç”¨**ï¼šå•å°æ•…éšœä¸å½±å“æ•´ä½“æœåŠ¡
- **æ°´å¹³æ‰©å±•**ï¼šå¯ä»¥å¢åŠ æ›´å¤šç”Ÿæˆå™¨èŠ‚ç‚¹

### 2.3 æ··åˆæ¶æ„æ¨¡å¼


**ä¸¤çº§ç”Ÿæˆæ¶æ„**ï¼š
```
ç¬¬ä¸€çº§ï¼šå·æ®µåˆ†é…å™¨        ç¬¬äºŒçº§ï¼šæœ¬åœ°IDç”Ÿæˆå™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ä¸­å¤®å·æ®µ     â”‚â”€â”€â”€â”€â†’â”‚ åº”ç”¨A    â”‚ â”‚ åº”ç”¨B    â”‚
â”‚    åˆ†é…æœåŠ¡     â”‚     â”‚ æœ¬åœ°ç¼“å­˜ â”‚ â”‚ æœ¬åœ°ç¼“å­˜ â”‚
â”‚   (åˆ†é…èŒƒå›´)    â”‚     â”‚1000-1999 â”‚ â”‚2000-2999 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·¥ä½œåŸç†**ï¼š
- ä¸­å¤®æœåŠ¡åˆ†é…IDå·æ®µç»™å„ä¸ªåº”ç”¨
- åº”ç”¨æœ¬åœ°æ¶ˆè´¹å·æ®µå†…çš„ID
- å·æ®µç”¨å®Œåå†å‘ä¸­å¤®æœåŠ¡ç”³è¯·æ–°å·æ®µ
- å…¼å…·é›†ä¸­ç®¡ç†å’Œåˆ†å¸ƒå¼æ€§èƒ½çš„ä¼˜åŠ¿

---

## 3. ğŸš€ æœåŠ¡åŒ–è®¾è®¡ä¸å¾®æœåŠ¡æ¶æ„


### 3.1 IDç”Ÿæˆå™¨å¾®æœåŠ¡æ¶æ„


**æ•´ä½“æ¶æ„å›¾**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIç½‘å…³å±‚                            â”‚
â”‚              (é‰´æƒã€é™æµã€è·¯ç”±)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä¸šåŠ¡æœåŠ¡å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æœåŠ¡   â”‚  è®¢å•æœåŠ¡   â”‚  å•†å“æœåŠ¡   â”‚   å…¶ä»–æœåŠ¡    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                IDç”ŸæˆæœåŠ¡é›†ç¾¤                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Snowflake   â”‚  æ•°æ®åº“     â”‚   Redis     â”‚   UUID        â”‚
â”‚ ç”Ÿæˆå™¨      â”‚ è‡ªå¢ç”Ÿæˆå™¨  â”‚  ç”Ÿæˆå™¨     â”‚  ç”Ÿæˆå™¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç”Ÿæˆå™¨ç½‘å…³å±‚è®¾è®¡


**ç½‘å…³çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š

```java
@RestController
@RequestMapping("/id")
public class IdGatewayController {
    
    @Autowired
    private IdGeneratorService idGeneratorService;
    
    // ç»Ÿä¸€IDç”Ÿæˆæ¥å£
    @GetMapping("/generate")
    public Response<Long> generateId(
        @RequestParam String bizType,  // ä¸šåŠ¡ç±»å‹
        @RequestParam(required = false) String strategy // ç”Ÿæˆç­–ç•¥
    ) {
        // æ ¹æ®ä¸šåŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„ç”Ÿæˆç­–ç•¥
        Long id = idGeneratorService.generateId(bizType, strategy);
        return Response.success(id);
    }
    
    // æ‰¹é‡IDç”Ÿæˆæ¥å£
    @GetMapping("/batch")
    public Response<List<Long>> batchGenerateId(
        @RequestParam String bizType,
        @RequestParam int count  // éœ€è¦ç”Ÿæˆçš„IDæ•°é‡
    ) {
        List<Long> ids = idGeneratorService.batchGenerateId(bizType, count);
        return Response.success(ids);
    }
}
```

**ç½‘å…³å±‚çš„ä»·å€¼**ï¼š
- **ç»Ÿä¸€å…¥å£**ï¼šæ‰€æœ‰IDç”Ÿæˆè¯·æ±‚é€šè¿‡ç½‘å…³è¿›å…¥
- **è·¯ç”±åˆ†å‘**ï¼šæ ¹æ®ä¸šåŠ¡ç±»å‹è·¯ç”±åˆ°ä¸åŒçš„ç”Ÿæˆå™¨
- **å®‰å…¨æ§åˆ¶**ï¼šç»Ÿä¸€å¤„ç†é‰´æƒå’Œè®¿é—®æ§åˆ¶
- **ç›‘æ§ç»Ÿè®¡**ï¼šç»Ÿä¸€æ”¶é›†è®¿é—®æ•°æ®å’Œæ€§èƒ½æŒ‡æ ‡

### 3.3 æœåŠ¡åŒ–éƒ¨ç½²æ–¹æ³•


**å®¹å™¨åŒ–éƒ¨ç½²**ï¼š
```yaml
# docker-compose.yml ç¤ºä¾‹
version: '3.8'
services:
  id-generator-1:
    image: id-generator:latest
    environment:
      - MACHINE_ID=1
      - DATA_CENTER_ID=1
    ports:
      - "8001:8080"
    
  id-generator-2:
    image: id-generator:latest
    environment:
      - MACHINE_ID=2
      - DATA_CENTER_ID=1
    ports:
      - "8002:8080"
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
```

**æœåŠ¡å‘ç°ä¸æ³¨å†Œ**ï¼š
```java
@SpringBootApplication
@EnableEurekaClient  // æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒ
public class IdGeneratorApplication {
    public static void main(String[] args) {
        SpringApplication.run(IdGeneratorApplication.class, args);
    }
}
```

---

## 4. âš–ï¸ è´Ÿè½½å‡è¡¡ä¸é›†ç¾¤ç­–ç•¥


### 4.1 ç”Ÿæˆå™¨é›†ç¾¤è´Ÿè½½å‡è¡¡ç­–ç•¥


**è½®è¯¢ç­–ç•¥**ï¼š
```
è¯·æ±‚åˆ†å‘ç¤ºæ„ï¼š
è¯·æ±‚1 â†’ ç”Ÿæˆå™¨A (æœºå™¨ID=1)
è¯·æ±‚2 â†’ ç”Ÿæˆå™¨B (æœºå™¨ID=2)  
è¯·æ±‚3 â†’ ç”Ÿæˆå™¨C (æœºå™¨ID=3)
è¯·æ±‚4 â†’ ç”Ÿæˆå™¨A (æœºå™¨ID=1)  â† å¾ªç¯åˆ†å‘
```

**ä¸€è‡´æ€§å“ˆå¸Œç­–ç•¥**ï¼š
```java
public class ConsistentHashLoadBalancer {
    private TreeMap<Long, String> virtualNodes = new TreeMap<>();
    
    public void addServer(String server, int virtualNodeCount) {
        for (int i = 0; i < virtualNodeCount; i++) {
            long hash = hash(server + "#" + i);
            virtualNodes.put(hash, server);
        }
    }
    
    public String selectServer(String key) {
        long hash = hash(key);
        Map.Entry<Long, String> entry = virtualNodes.ceilingEntry(hash);
        if (entry == null) {
            entry = virtualNodes.firstEntry();
        }
        return entry.getValue();
    }
}
```

**åŠ æƒè´Ÿè½½å‡è¡¡**ï¼š
```
æœåŠ¡å™¨é…ç½®æƒé‡ï¼š
ç”Ÿæˆå™¨A: æƒé‡5 (é«˜æ€§èƒ½æœºå™¨)
ç”Ÿæˆå™¨B: æƒé‡3 (ä¸­ç­‰æ€§èƒ½)
ç”Ÿæˆå™¨C: æƒé‡2 (æ™®é€šæœºå™¨)

åˆ†å‘æ¯”ä¾‹: A:B:C = 5:3:2
```

### 4.2 é›†ç¾¤å®¹é”™ç­–ç•¥


**æ•…éšœè½¬ç§»æœºåˆ¶**ï¼š
```java
public class FailoverIdGenerator {
    private List<IdGenerator> generators;
    private int currentIndex = 0;
    
    public Long generateId() {
        for (int i = 0; i < generators.size(); i++) {
            try {
                IdGenerator generator = generators.get(currentIndex);
                Long id = generator.generateId();
                return id;
            } catch (Exception e) {
                // å½“å‰ç”Ÿæˆå™¨æ•…éšœï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª
                currentIndex = (currentIndex + 1) % generators.size();
                logger.warn("ç”Ÿæˆå™¨æ•…éšœï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨ç”Ÿæˆå™¨");
            }
        }
        throw new RuntimeException("æ‰€æœ‰IDç”Ÿæˆå™¨éƒ½ä¸å¯ç”¨");
    }
}
```

---

## 5. ğŸ’¾ ç¼“å­˜æœºåˆ¶è®¾è®¡


### 5.1 IDé¢„ç”Ÿæˆç¼“å­˜


**ç¼“å­˜æ¶æ„**ï¼š
```
å†…å­˜ç¼“å­˜ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¾…åˆ†å‘IDç¼“å­˜æ±    â”‚
â”‚                â”‚
â”‚ [001][002][003] â”‚ â† é¢„ç”Ÿæˆçš„IDé˜Ÿåˆ—
â”‚ [004][005][006] â”‚
â”‚ [007][008][009] â”‚
â”‚                â”‚
â”‚ ä½æ°´ä½å‘Šè­¦ï¼š100  â”‚
â”‚ é«˜æ°´ä½é™åˆ¶ï¼š1000 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¢„ç”Ÿæˆæœºåˆ¶å®ç°**ï¼š
```java
@Component
public class IdCacheManager {
    private final Queue<Long> idQueue = new ConcurrentLinkedQueue<>();
    private final int LOW_WATER_MARK = 100;   // ä½æ°´ä½
    private final int HIGH_WATER_MARK = 1000; // é«˜æ°´ä½
    
    @Autowired
    private IdGenerator idGenerator;
    
    // è·å–IDï¼ˆä¼˜å…ˆä»ç¼“å­˜è·å–ï¼‰
    public Long getId() {
        Long id = idQueue.poll();
        if (id != null) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦è¡¥å……ç¼“å­˜
            if (idQueue.size() < LOW_WATER_MARK) {
                asyncRefillCache();
            }
            return id;
        }
        // ç¼“å­˜ä¸ºç©ºï¼ŒåŒæ­¥ç”Ÿæˆ
        return idGenerator.generateId();
    }
    
    // å¼‚æ­¥è¡¥å……ç¼“å­˜
    @Async
    public void asyncRefillCache() {
        while (idQueue.size() < HIGH_WATER_MARK) {
            Long id = idGenerator.generateId();
            idQueue.offer(id);
        }
    }
}
```

### 5.2 åˆ†å¸ƒå¼ç¼“å­˜è®¾è®¡


**Redisç¼“å­˜æ–¹æ¡ˆ**ï¼š
```java
@Service
public class RedisIdCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    // ä»Redisè·å–IDæ®µ
    public List<Long> getIdSegment(String bizType, int size) {
        String key = "id_segment:" + bizType;
        List<Long> ids = new ArrayList<>();
        
        // ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
        String luaScript = 
            "local key = KEYS[1] " +
            "local size = ARGV[1] " +
            "local current = redis.call('get', key) or 0 " +
            "redis.call('incrby', key, size) " +
            "return current";
            
        Long startId = (Long) redisTemplate.execute(
            new DefaultRedisScript<>(luaScript, Long.class),
            Collections.singletonList(key),
            size
        );
        
        // ç”ŸæˆIDæ®µ
        for (int i = 0; i < size; i++) {
            ids.add(startId + i + 1);
        }
        
        return ids;
    }
}
```

---

## 6. ğŸ“Š ç›‘æ§å‘Šè­¦ä¸è¿ç»´ä¿éšœ


### 6.1 ç›‘æ§ç³»ç»Ÿè®¾è®¡


**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š
```
æ€§èƒ½æŒ‡æ ‡ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QPS: å½“å‰è¯·æ±‚é‡  â”‚ â† å®æ—¶ç›‘æ§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å»¶è¿Ÿ: å“åº”æ—¶é—´   â”‚ â† P99å»¶è¿Ÿ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é”™è¯¯ç‡: å¤±è´¥ç‡   â”‚ â† å‘Šè­¦é˜ˆå€¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿æ¥æ•°: æ´»è·ƒè¿æ¥ â”‚ â† èµ„æºä½¿ç”¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDç”Ÿæˆæ€»æ•°       â”‚ â† ä¸šåŠ¡ç»Ÿè®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å„ä¸šåŠ¡ç±»å‹åˆ†å¸ƒ   â”‚ â† ä½¿ç”¨åˆ†æ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¼“å­˜å‘½ä¸­ç‡       â”‚ â† ç¼“å­˜æ•ˆæœ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¶é’Ÿå›æ‹¨æ£€æµ‹     â”‚ â† å®‰å…¨ç›‘æ§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç›‘æ§å®ç°**ï¼š
```java
@Component
public class IdGeneratorMetrics {
    
    private final MeterRegistry meterRegistry;
    private final Counter totalRequests;
    private final Timer requestLatency;
    
    public IdGeneratorMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.totalRequests = Counter.builder("id_generator_requests_total")
            .description("IDç”Ÿæˆæ€»è¯·æ±‚æ•°")
            .register(meterRegistry);
        this.requestLatency = Timer.builder("id_generator_request_duration")
            .description("IDç”Ÿæˆè¯·æ±‚å»¶è¿Ÿ")
            .register(meterRegistry);
    }
    
    public Long generateIdWithMetrics(String bizType) {
        Timer.Sample sample = Timer.start(meterRegistry);
        try {
            totalRequests.increment(Tags.of("biz_type", bizType));
            return doGenerateId(bizType);
        } finally {
            sample.stop(requestLatency);
        }
    }
}
```

### 6.2 å‘Šè­¦ç³»ç»Ÿ


**å‘Šè­¦è§„åˆ™é…ç½®**ï¼š
```yaml
# å‘Šè­¦è§„åˆ™ç¤ºä¾‹
alerts:
  - name: IDç”Ÿæˆå™¨é«˜å»¶è¿Ÿå‘Šè­¦
    condition: id_generator_request_duration_p99 > 10ms
    duration: 30s
    severity: warning
    
  - name: IDç”Ÿæˆå™¨é”™è¯¯ç‡å‘Šè­¦
    condition: id_generator_error_rate > 1%
    duration: 1m
    severity: critical
    
  - name: æ—¶é’Ÿå›æ‹¨å‘Šè­¦
    condition: clock_backwards_detected == 1
    duration: 0s
    severity: critical
```

---

## 7. ğŸ›¡ï¸ å®¹ç¾å¤‡ä»½ä¸é«˜å¯ç”¨


### 7.1 å®¹ç¾å¤‡ä»½æ–¹æ¡ˆ


**å¤šæœºæˆ¿éƒ¨ç½²æ¶æ„**ï¼š
```
ä¸»æœºæˆ¿                     å¤‡æœºæˆ¿
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDç”Ÿæˆå™¨é›†ç¾¤A    â”‚       â”‚ IDç”Ÿæˆå™¨é›†ç¾¤B    â”‚
â”‚ æœºå™¨ID: 1-10    â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ æœºå™¨ID: 11-20   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®ä¸­å¿ƒID: 1   â”‚       â”‚ æ•°æ®ä¸­å¿ƒID: 2   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   åº”ç”¨ç³»ç»Ÿ      â”‚
        â”‚ (æ™ºèƒ½è·¯ç”±)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•…éšœåˆ‡æ¢ç­–ç•¥**ï¼š
```java
@Service
public class DisasterRecoveryService {
    
    private boolean primaryDataCenterAvailable = true;
    private IdGenerator primaryGenerator;
    private IdGenerator backupGenerator;
    
    public Long generateId() {
        if (primaryDataCenterAvailable) {
            try {
                return primaryGenerator.generateId();
            } catch (Exception e) {
                logger.error("ä¸»æœºæˆ¿IDç”Ÿæˆå™¨æ•…éšœï¼Œåˆ‡æ¢åˆ°å¤‡æœºæˆ¿");
                primaryDataCenterAvailable = false;
                return backupGenerator.generateId();
            }
        } else {
            // å®šæœŸæ£€æµ‹ä¸»æœºæˆ¿æ˜¯å¦æ¢å¤
            if (checkPrimaryHealth()) {
                logger.info("ä¸»æœºæˆ¿å·²æ¢å¤ï¼Œåˆ‡å›ä¸»æœºæˆ¿");
                primaryDataCenterAvailable = true;
                return primaryGenerator.generateId();
            }
            return backupGenerator.generateId();
        }
    }
}
```

### 7.2 æ•°æ®å¤‡ä»½ç­–ç•¥


**é…ç½®æ•°æ®å¤‡ä»½**ï¼š
- **æœºå™¨IDåˆ†é…è¡¨**ï¼šè®°å½•æ¯å°æœºå™¨çš„IDåˆ†é…
- **ä¸šåŠ¡é…ç½®**ï¼šä¸åŒä¸šåŠ¡ç±»å‹çš„ç”Ÿæˆç­–ç•¥
- **å†å²ç»Ÿè®¡**ï¼šIDç”Ÿæˆçš„å†å²æ•°æ®

**å¤‡ä»½å®ç°**ï¼š
```java
@Scheduled(cron = "0 0 2 * * ?") // æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
public void backupConfiguration() {
    // å¤‡ä»½æœºå™¨IDåˆ†é…ä¿¡æ¯
    List<MachineConfig> configs = configService.getAllMachineConfigs();
    backupService.backup("machine_configs", configs);
    
    // å¤‡ä»½ä¸šåŠ¡é…ç½®
    List<BusinessConfig> bizConfigs = configService.getAllBusinessConfigs();
    backupService.backup("business_configs", bizConfigs);
}
```

---

## 8. ğŸ“ˆ æ‰©å®¹ç¼©å®¹ç­–ç•¥


### 8.1 æ°´å¹³æ‰©å®¹æ–¹æ¡ˆ


**æ‰©å®¹æµç¨‹**ï¼š
```
æ‰©å®¹æ­¥éª¤ï¼š
1. åˆ†é…æ–°çš„æœºå™¨ID
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ–°æœºå™¨ç”³è¯·  â”‚ â†’ è·å¾—æœºå™¨ID=11
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. éƒ¨ç½²æ–°çš„ç”Ÿæˆå™¨å®ä¾‹
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å¯åŠ¨æœåŠ¡    â”‚ â†’ éªŒè¯IDç”Ÿæˆæ­£å¸¸
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. æ³¨å†Œåˆ°è´Ÿè½½å‡è¡¡
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æœåŠ¡æ³¨å†Œ    â”‚ â†’ å¼€å§‹æ¥æ”¶æµé‡
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. éªŒè¯æœåŠ¡çŠ¶æ€
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å¥åº·æ£€æŸ¥    â”‚ â†’ ç¡®è®¤æ‰©å®¹æˆåŠŸ
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è‡ªåŠ¨æ‰©å®¹å®ç°**ï¼š
```java
@Component
public class AutoScalingService {
    
    @Value("${scaling.cpu.threshold:80}")
    private int cpuThreshold;
    
    @Value("${scaling.qps.threshold:50000}")
    private int qpsThreshold;
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void checkScaling() {
        double avgCpu = getAverageCpuUsage();
        int currentQps = getCurrentQps();
        
        if (avgCpu > cpuThreshold && currentQps > qpsThreshold) {
            logger.info("è§¦å‘è‡ªåŠ¨æ‰©å®¹æ¡ä»¶ï¼Œå¼€å§‹æ‰©å®¹");
            scaleOut();
        }
    }
    
    private void scaleOut() {
        // 1. ç”³è¯·æ–°çš„æœºå™¨ID
        int newMachineId = machineIdAllocator.allocateNewId();
        
        // 2. å¯åŠ¨æ–°å®ä¾‹
        containerOrchestrator.deployNewInstance(newMachineId);
        
        // 3. ç­‰å¾…å¥åº·æ£€æŸ¥é€šè¿‡
        waitForHealthCheck(newMachineId);
        
        // 4. æ³¨å†Œåˆ°è´Ÿè½½å‡è¡¡
        loadBalancer.registerServer(newMachineId);
    }
}
```

### 8.2 å¼¹æ€§ç¼©å®¹ç­–ç•¥


**ç¼©å®¹æ¡ä»¶åˆ¤æ–­**ï¼š
- CPUä½¿ç”¨ç‡é•¿æœŸä½äº30%
- QPSä½äºè®¾å®šé˜ˆå€¼çš„50%
- è‡³å°‘ä¿ç•™æœ€å°å®ä¾‹æ•°

**å®‰å…¨ç¼©å®¹å®ç°**ï¼š
```java
private void scaleIn() {
    List<String> candidates = findScaleInCandidates();
    
    for (String serverId : candidates) {
        // 1. ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤
        loadBalancer.unregisterServer(serverId);
        
        // 2. ç­‰å¾…ç°æœ‰è¯·æ±‚å¤„ç†å®Œæˆ
        waitForRequestsDrain(serverId);
        
        // 3. åœæ­¢æœåŠ¡å®ä¾‹
        containerOrchestrator.stopInstance(serverId);
        
        // 4. å›æ”¶æœºå™¨ID
        machineIdAllocator.recycleId(serverId);
    }
}
```

---

## 9. ğŸ”’ å®‰å…¨æœºåˆ¶è®¾è®¡


### 9.1 IDç”Ÿæˆå™¨å®‰å…¨æœºåˆ¶


**è®¿é—®æ§åˆ¶**ï¼š
```java
@RestController
public class SecureIdController {
    
    @Autowired
    private AuthenticationService authService;
    
    @PostMapping("/secure/id/generate")
    public Response<Long> generateSecureId(
        @RequestHeader("Authorization") String token,
        @RequestBody IdRequest request
    ) {
        // 1. TokenéªŒè¯
        if (!authService.validateToken(token)) {
            throw new UnauthorizedException("Tokenæ— æ•ˆ");
        }
        
        // 2. æƒé™æ£€æŸ¥
        if (!authService.hasPermission(token, request.getBizType())) {
            throw new ForbiddenException("æ— æƒé™è®¿é—®æ­¤ä¸šåŠ¡ç±»å‹");
        }
        
        // 3. é¢‘ç‡é™åˆ¶
        if (!rateLimiter.tryAcquire(getUserId(token))) {
            throw new TooManyRequestsException("è¯·æ±‚é¢‘ç‡è¿‡é«˜");
        }
        
        return Response.success(idGenerator.generateId(request.getBizType()));
    }
}
```

**é˜²æŠ¤æœºåˆ¶**ï¼š
```java
@Component
public class SecurityDefense {
    
    // é˜²æ­¢æš´åŠ›ç ´è§£
    private final Cache<String, Integer> attemptCache = 
        Caffeine.newBuilder()
            .expireAfterWrite(1, TimeUnit.HOURS)
            .build();
    
    public boolean checkSecurityPolicy(String clientIp, String bizType) {
        // 1. IPé¢‘ç‡é™åˆ¶
        Integer attempts = attemptCache.getIfPresent(clientIp);
        if (attempts != null && attempts > 1000) { // æ¯å°æ—¶æœ€å¤š1000æ¬¡
            logger.warn("IP {} è¯·æ±‚é¢‘ç‡è¿‡é«˜", clientIp);
            return false;
        }
        
        // 2. ä¸šåŠ¡ç±»å‹éªŒè¯
        if (!isValidBizType(bizType)) {
            logger.warn("æ— æ•ˆçš„ä¸šåŠ¡ç±»å‹: {}", bizType);
            return false;
        }
        
        // 3. è®°å½•è®¿é—®æ¬¡æ•°
        attemptCache.put(clientIp, (attempts == null ? 0 : attempts) + 1);
        return true;
    }
}
```

### 9.2 æ•°æ®åŠ å¯†ä¸éšç§ä¿æŠ¤


**IDæ··æ·†æœºåˆ¶**ï¼š
```java
public class IdObfuscator {
    private static final String SALT = "your-secret-salt";
    
    // å°†å†…éƒ¨IDè½¬æ¢ä¸ºå¯¹å¤–ID
    public String obfuscate(Long internalId) {
        // ç®€å•çš„æ··æ·†ç®—æ³•ï¼ˆå®é™…åº”ç”¨ä¸­ä½¿ç”¨æ›´å¤æ‚çš„ç®—æ³•ï¼‰
        long obfuscated = internalId ^ SALT.hashCode();
        return Long.toHexString(obfuscated).toUpperCase();
    }
    
    // å°†å¯¹å¤–IDè¿˜åŸä¸ºå†…éƒ¨ID
    public Long deobfuscate(String externalId) {
        long obfuscated = Long.parseLong(externalId, 16);
        return obfuscated ^ SALT.hashCode();
    }
}
```

---

## 10. âš¡ æ€§èƒ½è°ƒä¼˜æŒ‡å—


### 10.1 ç”Ÿæˆå™¨æ€§èƒ½è°ƒä¼˜


**JVMè°ƒä¼˜å‚æ•°**ï¼š
```bash
# IDç”Ÿæˆå™¨JVMå¯åŠ¨å‚æ•°ç¤ºä¾‹
java -Xms4g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=50 \
     -XX:+DisableExplicitGC \
     -XX:+PrintGCDetails \
     -XX:+PrintGCTimeStamps \
     -Dserver.port=8080 \
     -jar id-generator.jar
```

**è¿æ¥æ± ä¼˜åŒ–**ï¼š
```java
@Configuration
public class DataSourceConfig {
    
    @Bean
    @Primary
    public DataSource primaryDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://localhost:3306/id_generator");
        config.setUsername("username");
        config.setPassword("password");
        
        // è¿æ¥æ± ä¼˜åŒ–
        config.setMaximumPoolSize(20);          // æœ€å¤§è¿æ¥æ•°
        config.setMinimumIdle(5);               // æœ€å°ç©ºé—²è¿æ¥
        config.setConnectionTimeout(30000);     // è¿æ¥è¶…æ—¶30ç§’
        config.setIdleTimeout(600000);          // ç©ºé—²è¶…æ—¶10åˆ†é’Ÿ
        config.setMaxLifetime(1800000);         // è¿æ¥æœ€å¤§ç”Ÿå‘½å‘¨æœŸ30åˆ†é’Ÿ
        
        return new HikariDataSource(config);
    }
}
```

### 10.2 ç¼“å­˜ä¼˜åŒ–ç­–ç•¥


**æœ¬åœ°ç¼“å­˜è°ƒä¼˜**ï¼š
```java
@Configuration
public class CacheConfig {
    
    @Bean
    public Cache<String, Long> idCache() {
        return Caffeine.newBuilder()
            .maximumSize(10000)                    // æœ€å¤§ç¼“å­˜æ•°é‡
            .expireAfterWrite(5, TimeUnit.MINUTES) // å†™å…¥å5åˆ†é’Ÿè¿‡æœŸ
            .recordStats()                         // å¯ç”¨ç»Ÿè®¡
            .build();
    }
}
```

**æ‰¹é‡å¤„ç†ä¼˜åŒ–**ï¼š
```java
public class BatchIdGenerator {
    
    public List<Long> batchGenerate(int count) {
        // æ‰¹é‡ç”Ÿæˆï¼Œå‡å°‘æ•°æ®åº“è®¿é—®æ¬¡æ•°
        if (count <= 100) {
            return generateSmallBatch(count);
        } else {
            return generateLargeBatch(count);
        }
    }
    
    private List<Long> generateLargeBatch(int count) {
        List<Long> result = new ArrayList<>();
        int batchSize = 100;
        
        for (int i = 0; i < count; i += batchSize) {
            int currentBatchSize = Math.min(batchSize, count - i);
            result.addAll(generateSmallBatch(currentBatchSize));
        }
        
        return result;
    }
}
```

---

## 11. ğŸ¢ å¤šç§Ÿæˆ·æ”¯æŒ


### 11.1 å¤šç§Ÿæˆ·æ¶æ„è®¾è®¡


**ç§Ÿæˆ·éš”ç¦»æ¨¡å¼**ï¼š
```
ç‰©ç†éš”ç¦»æ¨¡å¼ï¼š
ç§Ÿæˆ·A                    ç§Ÿæˆ·B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IDç”Ÿæˆå™¨é›†ç¾¤A    â”‚     â”‚ IDç”Ÿæˆå™¨é›†ç¾¤B    â”‚
â”‚ ç‹¬ç«‹æ•°æ®åº“A     â”‚     â”‚ ç‹¬ç«‹æ•°æ®åº“B     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€»è¾‘éš”ç¦»æ¨¡å¼ï¼š
     å…±äº«IDç”Ÿæˆå™¨é›†ç¾¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§Ÿæˆ·A: å‰ç¼€A_xxxxxxx     â”‚
â”‚ ç§Ÿæˆ·B: å‰ç¼€B_xxxxxxx     â”‚
â”‚ ç§Ÿæˆ·C: å‰ç¼€C_xxxxxxx     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç§Ÿæˆ·éš”ç¦»å®ç°**ï¼š
```java
@Service
public class MultiTenantIdGenerator {
    
    private final Map<String, IdGenerator> tenantGenerators = new HashMap<>();
    
    public Long generateId(String tenantId, String bizType) {
        // 1. è·å–ç§Ÿæˆ·ä¸“ç”¨çš„ç”Ÿæˆå™¨
        IdGenerator generator = getTenantGenerator(tenantId);
        
        // 2. ç”ŸæˆåŸºç¡€ID
        Long baseId = generator.generateId();
        
        // 3. æ·»åŠ ç§Ÿæˆ·å‰ç¼€
        return addTenantPrefix(tenantId, baseId);
    }
    
    private IdGenerator getTenantGenerator(String tenantId) {
        return tenantGenerators.computeIfAbsent(tenantId, 
            tid -> createTenantGenerator(tid)
        );
    }
    
    private IdGenerator createTenantGenerator(String tenantId) {
        // ä¸ºæ¯ä¸ªç§Ÿæˆ·åˆ†é…ä¸åŒçš„æœºå™¨IDèŒƒå›´
        int machineIdStart = getTenantMachineIdRange(tenantId);
        return new SnowflakeIdGenerator(machineIdStart, 1);
    }
}
```

### 11.2 ç§Ÿæˆ·é…ç½®ç®¡ç†


**ç§Ÿæˆ·é…ç½®ç¤ºä¾‹**ï¼š
```java
@Entity
public class TenantConfig {
    private String tenantId;
    private String idPrefix;           // IDå‰ç¼€
    private String generatorType;      // ç”Ÿæˆå™¨ç±»å‹
    private Integer machineIdStart;    // æœºå™¨IDèµ·å§‹å€¼
    private Integer machineIdEnd;      // æœºå™¨IDç»“æŸå€¼
    private Long maxQps;              // æœ€å¤§QPSé™åˆ¶
    private Boolean enableMetrics;     // æ˜¯å¦å¯ç”¨ç›‘æ§
    
    // getter/setterçœç•¥
}

@Service
public class TenantConfigService {
    
    public TenantConfig getTenantConfig(String tenantId) {
        TenantConfig config = configRepository.findByTenantId(tenantId);
        if (config == null) {
            // è¿”å›é»˜è®¤é…ç½®
            return getDefaultConfig(tenantId);
        }
        return config;
    }
}
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„æ¶æ„è¦ç´ 


```
ğŸ”¸ æ¶æ„æ¨¡å¼é€‰æ‹©ï¼šå•æœº â†’ é›†ç¾¤ â†’ æ··åˆï¼Œæ ¹æ®ä¸šåŠ¡è§„æ¨¡é€‰æ‹©
ğŸ”¸ æœåŠ¡åŒ–è®¾è®¡ï¼šå¾®æœåŠ¡æ¶æ„ï¼Œç½‘å…³ç»Ÿä¸€å…¥å£ï¼ŒæœåŠ¡æ³¨å†Œå‘ç°
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šè½®è¯¢ã€ä¸€è‡´æ€§å“ˆå¸Œã€åŠ æƒåˆ†é…ï¼Œä¿è¯é«˜å¯ç”¨
ğŸ”¸ ç¼“å­˜è®¾è®¡ï¼šé¢„ç”Ÿæˆç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæå‡æ€§èƒ½
ğŸ”¸ ç›‘æ§å‘Šè­¦ï¼šæ€§èƒ½æŒ‡æ ‡ã€ä¸šåŠ¡æŒ‡æ ‡ã€å®æ—¶ç›‘æ§ã€åŠæ—¶å‘Šè­¦
ğŸ”¸ å®¹ç¾å¤‡ä»½ï¼šå¤šæœºæˆ¿éƒ¨ç½²ã€æ•…éšœåˆ‡æ¢ã€æ•°æ®å¤‡ä»½
ğŸ”¸ å¼¹æ€§ä¼¸ç¼©ï¼šè‡ªåŠ¨æ‰©å®¹ç¼©å®¹ã€èµ„æºä¼˜åŒ–ã€æˆæœ¬æ§åˆ¶
ğŸ”¸ å®‰å…¨é˜²æŠ¤ï¼šè®¿é—®æ§åˆ¶ã€é¢‘ç‡é™åˆ¶ã€æ•°æ®åŠ å¯†
ğŸ”¸ æ€§èƒ½è°ƒä¼˜ï¼šJVMè°ƒä¼˜ã€è¿æ¥æ± ä¼˜åŒ–ã€æ‰¹é‡å¤„ç†
ğŸ”¸ å¤šç§Ÿæˆ·ï¼šç§Ÿæˆ·éš”ç¦»ã€é…ç½®ç®¡ç†ã€èµ„æºåˆ†é…
```

### 12.2 æ¶æ„è®¾è®¡æ ¸å¿ƒåŸåˆ™


**ğŸ”¹ é«˜å¯ç”¨è®¾è®¡åŸåˆ™**ï¼š
- **æ— å•ç‚¹æ•…éšœ**ï¼šä»»ä½•ç»„ä»¶æ•…éšœéƒ½ä¸å½±å“æ•´ä½“æœåŠ¡
- **æ•…éšœè‡ªæ¢å¤**ï¼šç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤æ•…éšœ
- **ä¼˜é›…é™çº§**ï¼šåœ¨éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸æ—¶ä¿è¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸

**ğŸ”¹ é«˜æ€§èƒ½è®¾è®¡åŸåˆ™**ï¼š
- **å‡å°‘ç½‘ç»œè°ƒç”¨**ï¼šæ‰¹é‡æ“ä½œã€æœ¬åœ°ç¼“å­˜
- **å¼‚æ­¥å¤„ç†**ï¼šéé˜»å¡æ“ä½œã€äº‹ä»¶é©±åŠ¨
- **èµ„æºæ± åŒ–**ï¼šè¿æ¥æ± ã€çº¿ç¨‹æ± ã€å¯¹è±¡æ± 

**ğŸ”¹ å¯æ‰©å±•è®¾è®¡åŸåˆ™**ï¼š
- **æ°´å¹³æ‰©å±•**ï¼šé€šè¿‡å¢åŠ æœºå™¨æå‡å®¹é‡
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šåŠŸèƒ½ç‹¬ç«‹ã€ä½è€¦åˆ
- **é…ç½®é©±åŠ¨**ï¼šè¡Œä¸ºå¯é…ç½®ã€ç­–ç•¥å¯åˆ‡æ¢

### 12.3 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‰æ‹©åˆé€‚çš„æ¶æ„**ï¼š
- **å°å‹ç³»ç»Ÿ**ï¼šå•æœºæ¶æ„ + æœ¬åœ°ç¼“å­˜
- **ä¸­å‹ç³»ç»Ÿ**ï¼šé›†ç¾¤æ¶æ„ + åˆ†å¸ƒå¼ç¼“å­˜  
- **å¤§å‹ç³»ç»Ÿ**ï¼šæ··åˆæ¶æ„ + å¤šçº§ç¼“å­˜

**è¿ç»´ç®¡ç†è¦ç‚¹**ï¼š
- **å®¹é‡è§„åˆ’**ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿é¢„ä¼°èµ„æºéœ€æ±‚
- **æ€§èƒ½ç›‘æ§**ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- **æ•…éšœæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¢å¤æ¼”ç»ƒ
- **ç‰ˆæœ¬ç®¡ç†**ï¼šæ”¯æŒç°åº¦å‘å¸ƒå’Œå¿«é€Ÿå›æ»š

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ¶æ„è®¾è®¡è®²å±‚æ¬¡ï¼Œé«˜å¯ç”¨æ€§æ˜¯åŸºç¡€
- è´Ÿè½½å‡è¡¡ä¿æ€§èƒ½ï¼Œç¼“å­˜æœºåˆ¶æé€Ÿåº¦  
- ç›‘æ§å‘Šè­¦è¦åŠæ—¶ï¼Œå®¹ç¾å¤‡ä»½ä¿å®‰å…¨
- æ‰©å®¹ç¼©å®¹è¦å¼¹æ€§ï¼Œå®‰å…¨é˜²æŠ¤ä¸å¯å°‘
- å¤šç§Ÿæˆ·éš”ç¦»å¥½ï¼Œæ€§èƒ½è°ƒä¼˜å‡ºæ•ˆæœ