---
title: 13ã€å‡½æ•°ç´¢å¼•ä½¿ç”¨
---
## ðŸ“š ç›®å½•

1. [å‡½æ•°ç´¢å¼•æ¦‚è¿°](#1-å‡½æ•°ç´¢å¼•æ¦‚è¿°)
2. [è¡¨è¾¾å¼ç´¢å¼•åˆ›å»º](#2-è¡¨è¾¾å¼ç´¢å¼•åˆ›å»º)
3. [è™šæ‹Ÿåˆ—ä¸Žè®¡ç®—åˆ—ç´¢å¼•](#3-è™šæ‹Ÿåˆ—ä¸Žè®¡ç®—åˆ—ç´¢å¼•)
4. [é€‚ç”¨åœºæ™¯åˆ†æž](#4-é€‚ç”¨åœºæ™¯åˆ†æž)
5. [æ€§èƒ½ä¸Žé™åˆ¶è€ƒè™‘](#5-æ€§èƒ½ä¸Žé™åˆ¶è€ƒè™‘)
6. [ç›‘æŽ§ä¸Žç»´æŠ¤](#6-ç›‘æŽ§ä¸Žç»´æŠ¤)
7. [æœ€ä½³å®žè·µæŒ‡å—](#7-æœ€ä½³å®žè·µæŒ‡å—)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸŽ¯ å‡½æ•°ç´¢å¼•æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å‡½æ•°ç´¢å¼•


**ç®€å•ç†è§£**ï¼šå‡½æ•°ç´¢å¼•å°±æ˜¯å¯¹åˆ—çš„è®¡ç®—ç»“æžœå»ºç«‹ç´¢å¼•ï¼Œè€Œä¸æ˜¯å¯¹åŽŸå§‹åˆ—å€¼å»ºç´¢å¼•

```sql
-- ä¼ ç»Ÿç´¢å¼•ï¼šå¯¹åŽŸå§‹åˆ—å»ºç´¢å¼•
CREATE INDEX idx_name ON users(name);

-- å‡½æ•°ç´¢å¼•ï¼šå¯¹è®¡ç®—ç»“æžœå»ºç´¢å¼•  
CREATE INDEX idx_upper_name ON users((UPPER(name)));
CREATE INDEX idx_year ON orders((YEAR(order_date)));
```

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
- ðŸŽ¯ **ç´¢å¼•å¯¹è±¡**ï¼šå‡½æ•°è¡¨è¾¾å¼çš„è®¡ç®—ç»“æžœï¼Œä¸æ˜¯åŽŸå§‹åˆ—å€¼
- âš¡ **æŸ¥è¯¢ä¼˜åŒ–**ï¼šå½“WHEREæ¡ä»¶ä½¿ç”¨ç›¸åŒå‡½æ•°æ—¶ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ç´¢å¼•
- ðŸ“Š **å­˜å‚¨æ–¹å¼**ï¼šé¢„è®¡ç®—å‡½æ•°ç»“æžœå¹¶å­˜å‚¨ï¼Œé¿å…æŸ¥è¯¢æ—¶é‡å¤è®¡ç®—

### 1.2 MySQL 8.0çš„æ”¯æŒæƒ…å†µ


**ç‰ˆæœ¬æ”¯æŒ**ï¼š
```
MySQLç‰ˆæœ¬å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç‰ˆæœ¬       â”‚   å‡½æ•°ç´¢å¼•æ”¯æŒ  â”‚      å®žçŽ°æ–¹å¼   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL 5.7   â”‚      âŒ         â”‚   ä¸æ”¯æŒ        â”‚
â”‚ MySQL 8.0+  â”‚      âœ…         â”‚   åŽŸç”Ÿæ”¯æŒ      â”‚
â”‚ MySQL 8.0+  â”‚      âœ…         â”‚   è™šæ‹Ÿåˆ—æ–¹å¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**> âš ï¸ é‡è¦**ï¼šå‡½æ•°ç´¢å¼•æ˜¯MySQL 8.0å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œæ—©æœŸç‰ˆæœ¬éœ€è¦é€šè¿‡è™šæ‹Ÿåˆ—å®žçŽ°ç±»ä¼¼åŠŸèƒ½

### 1.3 å‡½æ•°ç´¢å¼•vsä¼ ç»Ÿç´¢å¼•


**å·¥ä½œåŽŸç†å¯¹æ¯”**ï¼š
```
ä¼ ç»Ÿç´¢å¼•å·¥ä½œæµç¨‹ï¼š
ç”¨æˆ·æŸ¥è¯¢ â†’ ç›´æŽ¥æŸ¥æ‰¾ç´¢å¼• â†’ è¿”å›žç»“æžœ

å‡½æ•°ç´¢å¼•å·¥ä½œæµç¨‹ï¼š  
åˆ›å»ºæ—¶ï¼šè®¡ç®—å‡½æ•°ç»“æžœ â†’ å­˜å‚¨åˆ°ç´¢å¼•ä¸­
æŸ¥è¯¢æ—¶ï¼šåŒ¹é…å‡½æ•°è¡¨è¾¾å¼ â†’ ç›´æŽ¥ä½¿ç”¨ç´¢å¼• â†’ è¿”å›žç»“æžœ

æ€§èƒ½å¯¹æ¯”ï¼š
â”œâ”€ åˆ›å»ºé€Ÿåº¦ï¼šå‡½æ•°ç´¢å¼•æ…¢ï¼ˆéœ€è¦è®¡ç®—ï¼‰
â”œâ”€ æŸ¥è¯¢é€Ÿåº¦ï¼šå‡½æ•°ç´¢å¼•å¿«ï¼ˆé¿å…é‡å¤è®¡ç®—ï¼‰  
â”œâ”€ å­˜å‚¨ç©ºé—´ï¼šå‡½æ•°ç´¢å¼•ç•¥å¤§ï¼ˆå­˜å‚¨è®¡ç®—ç»“æžœï¼‰
â””â”€ ç»´æŠ¤æˆæœ¬ï¼šå‡½æ•°ç´¢å¼•é«˜ï¼ˆæ•°æ®å˜æ›´æ—¶éœ€é‡æ–°è®¡ç®—ï¼‰
```

---

## 2. ðŸ”§ è¡¨è¾¾å¼ç´¢å¼•åˆ›å»º


### 2.1 åŸºæœ¬è¯­æ³•


**å‡½æ•°ç´¢å¼•åˆ›å»ºè¯­æ³•**ï¼š
```sql
-- åŸºæœ¬è¯­æ³•
CREATE INDEX index_name ON table_name ((expression));

-- æ³¨æ„ï¼šè¡¨è¾¾å¼éœ€è¦ç”¨åŒå±‚æ‹¬å·åŒ…å›´
```

### 2.2 å¸¸è§å‡½æ•°ç´¢å¼•ç¤ºä¾‹


**ðŸ”¸ å­—ç¬¦ä¸²å‡½æ•°ç´¢å¼•**
```sql
-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

-- å¤§å°å†™ä¸æ•æ„Ÿæœç´¢ç´¢å¼•
CREATE INDEX idx_upper_name ON users ((UPPER(name)));

-- é‚®ç®±åŸŸåç´¢å¼•
CREATE INDEX idx_email_domain ON users ((SUBSTRING_INDEX(email, '@', -1)));

-- ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE UPPER(name) = 'JOHN';
SELECT * FROM users WHERE SUBSTRING_INDEX(email, '@', -1) = 'gmail.com';
```

**ðŸ”¸ æ—¥æœŸæ—¶é—´å‡½æ•°ç´¢å¼•**
```sql
-- åˆ›å»ºè®¢å•è¡¨
CREATE TABLE orders (
    id INT PRIMARY KEY,
    user_id INT,
    order_date DATETIME,
    amount DECIMAL(10,2)
);

-- å¹´ä»½ç´¢å¼•
CREATE INDEX idx_order_year ON orders ((YEAR(order_date)));

-- æœˆä»½ç´¢å¼•  
CREATE INDEX idx_order_month ON orders ((DATE_FORMAT(order_date, '%Y-%m')));

-- ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM orders WHERE YEAR(order_date) = 2024;
SELECT * FROM orders WHERE DATE_FORMAT(order_date, '%Y-%m') = '2024-09';
```

**ðŸ”¸ æ•°å­¦å‡½æ•°ç´¢å¼•**
```sql
-- åˆ›å»ºäº§å“è¡¨
CREATE TABLE products (
    id INT PRIMARY KEY,
    price DECIMAL(10,2),
    cost DECIMAL(10,2),
    quantity INT
);

-- åˆ©æ¶¦çŽ‡ç´¢å¼•
CREATE INDEX idx_profit_rate ON products (((price - cost) / cost));

-- æ€»ä»·å€¼ç´¢å¼•
CREATE INDEX idx_total_value ON products ((price * quantity));

-- ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM products WHERE (price - cost) / cost > 0.2;
SELECT * FROM products WHERE price * quantity > 10000;
```

### 2.3 å¤åˆå‡½æ•°ç´¢å¼•


**å¤šè¡¨è¾¾å¼ç»„åˆç´¢å¼•**ï¼š
```sql
-- å¤åˆå‡½æ•°ç´¢å¼•
CREATE INDEX idx_complex ON users ((UPPER(name)), (YEAR(created_at)));

-- å‡½æ•°ä¸Žæ™®é€šåˆ—æ··åˆ
CREATE INDEX idx_mixed ON orders (user_id, (YEAR(order_date)));

-- ä½¿ç”¨åœºæ™¯
SELECT * FROM users 
WHERE UPPER(name) = 'JOHN' AND YEAR(created_at) = 2024;

SELECT * FROM orders 
WHERE user_id = 123 AND YEAR(order_date) = 2024;
```

---

## 3. ðŸ’¾ è™šæ‹Ÿåˆ—ä¸Žè®¡ç®—åˆ—ç´¢å¼•


### 3.1 è™šæ‹Ÿåˆ—æ–¹å¼å®žçŽ°


**è™šæ‹Ÿåˆ—æ¦‚å¿µ**ï¼šä¸å®žé™…å­˜å‚¨æ•°æ®ï¼Œåªå­˜å‚¨è®¡ç®—å…¬å¼çš„åˆ—
```sql
-- åˆ›å»ºå¸¦è™šæ‹Ÿåˆ—çš„è¡¨
CREATE TABLE users (
    id INT PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    -- è™šæ‹Ÿåˆ—ï¼šå…¨å
    full_name VARCHAR(101) AS (CONCAT(first_name, ' ', last_name)) VIRTUAL,
    -- è™šæ‹Ÿåˆ—ï¼šå§“åé•¿åº¦
    name_length INT AS (LENGTH(CONCAT(first_name, ' ', last_name))) VIRTUAL
);

-- ä¸ºè™šæ‹Ÿåˆ—åˆ›å»ºç´¢å¼•
CREATE INDEX idx_full_name ON users(full_name);
CREATE INDEX idx_name_length ON users(name_length);
```

**è™šæ‹Ÿåˆ—ç´¢å¼•çš„ä¼˜åŠ¿**ï¼š
```
ä¼˜åŠ¿åˆ†æžï¼š
â”œâ”€ è¯­æ³•æ¸…æ™°ï¼šè™šæ‹Ÿåˆ—æœ‰æ˜Žç¡®çš„åˆ—å
â”œâ”€ æŸ¥è¯¢ç®€å•ï¼šå¯ä»¥ç›´æŽ¥SELECTè™šæ‹Ÿåˆ—
â”œâ”€ å…¼å®¹æ€§å¥½ï¼šMySQL 5.7+éƒ½æ”¯æŒ
â””â”€ ç»´æŠ¤æ–¹ä¾¿ï¼šåˆ—å®šä¹‰å’Œç´¢å¼•åˆ†ç¦»

ä½¿ç”¨ç¤ºä¾‹ï¼š
SELECT full_name FROM users WHERE full_name LIKE 'John%';
SELECT * FROM users WHERE name_length > 10;
```

### 3.2 å­˜å‚¨åˆ—vsè™šæ‹Ÿåˆ—


**å­˜å‚¨æ–¹å¼å¯¹æ¯”**ï¼š
```sql
-- è™šæ‹Ÿåˆ—ï¼ˆVIRTUALï¼‰- ä¸å­˜å‚¨ï¼Œå®žæ—¶è®¡ç®—
ALTER TABLE users ADD COLUMN 
upper_name VARCHAR(100) AS (UPPER(name)) VIRTUAL;

-- å­˜å‚¨åˆ—ï¼ˆSTOREDï¼‰- ç‰©ç†å­˜å‚¨è®¡ç®—ç»“æžœ  
ALTER TABLE users ADD COLUMN
upper_name_stored VARCHAR(100) AS (UPPER(name)) STORED;
```

| ç±»åž‹ | **å­˜å‚¨ç©ºé—´** | **è®¡ç®—å¼€é”€** | **æŸ¥è¯¢æ€§èƒ½** | **æ›´æ–°å¼€é”€** |
|------|-------------|-------------|-------------|-------------|
| ðŸ”¸ **VIRTUAL** | `æ— é¢å¤–å­˜å‚¨` | `æŸ¥è¯¢æ—¶è®¡ç®—` | `è¾ƒå¿«` | `æ— é¢å¤–å¼€é”€` |
| ðŸ”¸ **STORED** | `å ç”¨å­˜å‚¨ç©ºé—´` | `å†™å…¥æ—¶è®¡ç®—` | `æœ€å¿«` | `æ›´æ–°æ—¶é‡æ–°è®¡ç®—` |

### 3.3 è®¡ç®—åˆ—ç´¢å¼•æœ€ä½³å®žè·µ


**é€‰æ‹©å»ºè®®**ï¼š
```sql
-- å¤æ‚è®¡ç®— â†’ ä½¿ç”¨STOREDåˆ—
CREATE TABLE sales (
    id INT PRIMARY KEY,
    price DECIMAL(10,2),
    tax_rate DECIMAL(5,4),
    discount DECIMAL(5,4),
    -- å¤æ‚è®¡ç®—ç»“æžœå­˜å‚¨
    final_amount DECIMAL(10,2) AS (
        price * (1 + tax_rate) * (1 - discount)
    ) STORED
);

CREATE INDEX idx_final_amount ON sales(final_amount);

-- ç®€å•è®¡ç®— â†’ ä½¿ç”¨VIRTUALåˆ—
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    -- ç®€å•å¤§å†™è½¬æ¢
    upper_name VARCHAR(100) AS (UPPER(name)) VIRTUAL
);

CREATE INDEX idx_upper_name ON products(upper_name);
```

---

## 4. ðŸŽ¯ é€‚ç”¨åœºæ™¯åˆ†æž


### 4.1 å…¸åž‹åº”ç”¨åœºæ™¯


**ðŸ”¸ ä¸åŒºåˆ†å¤§å°å†™æœç´¢**
```sql
-- åœºæ™¯ï¼šç”¨æˆ·åæœç´¢ä¸åŒºåˆ†å¤§å°å†™
CREATE TABLE members (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100)
);

-- åˆ›å»ºå¤§å†™å‡½æ•°ç´¢å¼•
CREATE INDEX idx_upper_username ON members ((UPPER(username)));

-- æŸ¥è¯¢è‡ªåŠ¨ä½¿ç”¨ç´¢å¼•
SELECT * FROM members WHERE UPPER(username) = UPPER('John');

æ€§èƒ½æå‡ï¼š
â”œâ”€ æ— ç´¢å¼•ï¼šå…¨è¡¨æ‰«æ + æ¯è¡Œéƒ½è¦æ‰§è¡ŒUPPERå‡½æ•°
â”œâ”€ æœ‰ç´¢å¼•ï¼šç›´æŽ¥ç´¢å¼•æŸ¥æ‰¾ï¼Œæ— éœ€é‡å¤è®¡ç®—
â””â”€ æ•ˆæžœï¼š10å€ä»¥ä¸Šæ€§èƒ½æå‡ï¼ˆå–å†³äºŽæ•°æ®é‡ï¼‰
```

**ðŸ”¸ JSONå­—æ®µæŸ¥è¯¢ä¼˜åŒ–**
```sql
-- JSONæ•°æ®æŸ¥è¯¢åœºæ™¯
CREATE TABLE user_profiles (
    id INT PRIMARY KEY,
    profile JSON
);

-- ä¸ºJSONå­—æ®µçš„ç‰¹å®šè·¯å¾„åˆ›å»ºç´¢å¼•
CREATE INDEX idx_age ON user_profiles ((JSON_EXTRACT(profile, '$.age')));
CREATE INDEX idx_city ON user_profiles ((JSON_UNQUOTE(JSON_EXTRACT(profile, '$.city'))));

-- é«˜æ•ˆçš„JSONæŸ¥è¯¢
SELECT * FROM user_profiles 
WHERE JSON_EXTRACT(profile, '$.age') > 25;

SELECT * FROM user_profiles 
WHERE JSON_UNQUOTE(JSON_EXTRACT(profile, '$.city')) = 'Beijing';
```

**ðŸ”¸ æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¼˜åŒ–**
```sql
-- æŒ‰æ—¶é—´æ®µç»Ÿè®¡çš„åœºæ™¯
CREATE TABLE access_logs (
    id INT PRIMARY KEY,
    user_id INT,
    access_time DATETIME,
    url VARCHAR(200)
);

-- æŒ‰å°æ—¶ç»Ÿè®¡çš„ç´¢å¼•
CREATE INDEX idx_hour ON access_logs ((DATE_FORMAT(access_time, '%Y-%m-%d %H')));

-- æŒ‰æœˆç»Ÿè®¡çš„ç´¢å¼•  
CREATE INDEX idx_month ON access_logs ((DATE_FORMAT(access_time, '%Y-%m')));

-- é«˜æ•ˆçš„æ—¶é—´æ®µæŸ¥è¯¢
SELECT COUNT(*) FROM access_logs 
WHERE DATE_FORMAT(access_time, '%Y-%m-%d %H') = '2024-09-09 14';
```

### 4.2 ä¸šåŠ¡åœºæ™¯ä¸¾ä¾‹


**ç”µå•†ç³»ç»Ÿåº”ç”¨**ï¼š
```sql
-- å•†å“æœç´¢ä¼˜åŒ–
CREATE TABLE products (
    id INT PRIMARY KEY,
    title VARCHAR(200),
    price DECIMAL(10,2),
    brand VARCHAR(50),
    category_id INT
);

-- æœç´¢å…³é”®å­—ç´¢å¼•ï¼ˆåˆ†è¯åŽçš„å…³é”®å­—ï¼‰
CREATE INDEX idx_search_keywords ON products (
    (CONCAT(UPPER(title), ' ', UPPER(brand)))
);

-- ä»·æ ¼åŒºé—´ç´¢å¼•
CREATE INDEX idx_price_range ON products (
    (FLOOR(price / 100) * 100)  -- æŒ‰100å…ƒåˆ†ç»„
);

-- åº”ç”¨æŸ¥è¯¢
SELECT * FROM products 
WHERE CONCAT(UPPER(title), ' ', UPPER(brand)) LIKE '%IPHONE APPLE%';

SELECT * FROM products 
WHERE FLOOR(price / 100) * 100 = 1000;  -- 1000-1099ä»·æ ¼åŒºé—´
```

---

## 5. âš–ï¸ æ€§èƒ½ä¸Žé™åˆ¶è€ƒè™‘


### 5.1 å‡½æ•°ç´¢å¼•çš„é™åˆ¶


**è¯­æ³•é™åˆ¶**ï¼š
```sql
-- âœ… æ”¯æŒçš„å‡½æ•°ç±»åž‹
CREATE INDEX idx1 ON table1 ((ABS(column1)));           -- æ•°å­¦å‡½æ•°
CREATE INDEX idx2 ON table1 ((UPPER(column2)));         -- å­—ç¬¦ä¸²å‡½æ•°  
CREATE INDEX idx3 ON table1 ((DATE(column3)));          -- æ—¥æœŸå‡½æ•°
CREATE INDEX idx4 ON table1 ((JSON_EXTRACT(col, path))); -- JSONå‡½æ•°

-- âŒ ä¸æ”¯æŒçš„æƒ…å†µ
CREATE INDEX idx_bad1 ON table1 ((RAND()));             -- éžç¡®å®šæ€§å‡½æ•°
CREATE INDEX idx_bad2 ON table1 ((NOW()));              -- æ—¶é—´ç›¸å…³å‡½æ•°
CREATE INDEX idx_bad3 ON table1 ((column1 + RAND()));   -- åŒ…å«éšæœºå‡½æ•°
```

**è¡¨è¾¾å¼é™åˆ¶**ï¼š
```
å‡½æ•°ç´¢å¼•é™åˆ¶æ¸…å•ï¼š
â”œâ”€ è¡¨è¾¾å¼å¿…é¡»æ˜¯ç¡®å®šæ€§çš„ï¼ˆç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºï¼‰
â”œâ”€ ä¸èƒ½åŒ…å«å­æŸ¥è¯¢
â”œâ”€ ä¸èƒ½å¼•ç”¨å…¶ä»–è¡¨çš„åˆ—
â”œâ”€ ä¸èƒ½ä½¿ç”¨å­˜å‚¨å‡½æ•°ï¼ˆç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼‰
â”œâ”€ ä¸èƒ½ä½¿ç”¨èšåˆå‡½æ•°ï¼ˆSUMã€COUNTç­‰ï¼‰
â””â”€ è¡¨è¾¾å¼é•¿åº¦æœ‰é™åˆ¶ï¼ˆé€šå¸¸3072å­—èŠ‚ï¼‰
```

### 5.2 æ€§èƒ½è€ƒè™‘å› ç´ 


**åˆ›å»ºå¼€é”€åˆ†æž**ï¼š
```sql
-- å¤§è¡¨åˆ›å»ºå‡½æ•°ç´¢å¼•çš„å¼€é”€
CREATE TABLE large_table (
    id INT PRIMARY KEY,
    data VARCHAR(1000),
    created_at DATETIME
) ENGINE=InnoDB;

-- æ’å…¥100ä¸‡æ¡æµ‹è¯•æ•°æ®
INSERT INTO large_table VALUES (...);  -- å‡è®¾å·²æœ‰100ä¸‡æ¡æ•°æ®

-- åˆ›å»ºå‡½æ•°ç´¢å¼•çš„æ—¶é—´å¼€é”€
CREATE INDEX idx_upper_data ON large_table ((UPPER(data)));
-- é¢„è®¡è€—æ—¶ï¼šä¼ ç»Ÿç´¢å¼•çš„2-3å€æ—¶é—´

æ—¶é—´å¼€é”€æž„æˆï¼š
â”œâ”€ è¯»å–åŽŸå§‹æ•°æ®ï¼š30%
â”œâ”€ è®¡ç®—å‡½æ•°ç»“æžœï¼š40%  
â”œâ”€ æž„å»ºç´¢å¼•ç»“æž„ï¼š25%
â””â”€ å…¶ä»–å¼€é”€ï¼š5%
```

**æŸ¥è¯¢æ€§èƒ½å¯¹æ¯”**ï¼š
```sql
-- æ€§èƒ½æµ‹è¯•å¯¹æ¯”
EXPLAIN SELECT * FROM large_table WHERE UPPER(data) LIKE 'TEST%';

æ— å‡½æ•°ç´¢å¼•ï¼š
â”œâ”€ æ‰«ææ–¹å¼ï¼šå…¨è¡¨æ‰«æ
â”œâ”€ è®¡ç®—å¼€é”€ï¼šæ¯è¡Œéƒ½è¦æ‰§è¡ŒUPPERå‡½æ•°
â”œâ”€ æ—¶é—´å¤æ‚åº¦ï¼šO(n)
â””â”€ é¢„è®¡è€—æ—¶ï¼š5-10ç§’ï¼ˆ100ä¸‡è¡Œï¼‰

æœ‰å‡½æ•°ç´¢å¼•ï¼š
â”œâ”€ æ‰«ææ–¹å¼ï¼šç´¢å¼•èŒƒå›´æ‰«æ
â”œâ”€ è®¡ç®—å¼€é”€ï¼šæ— ï¼ˆé¢„è®¡ç®—å®Œæˆï¼‰
â”œâ”€ æ—¶é—´å¤æ‚åº¦ï¼šO(log n)  
â””â”€ é¢„è®¡è€—æ—¶ï¼š10-50æ¯«ç§’
```

### 5.3 ç»´æŠ¤æˆæœ¬è¯„ä¼°


**æ›´æ–°å¼€é”€**ï¼š
```sql
-- æ•°æ®æ›´æ–°æ—¶çš„é¢å¤–å¼€é”€
UPDATE large_table SET data = 'new value' WHERE id = 1;

å½±å“çš„ç»´æŠ¤æ“ä½œï¼š
â”œâ”€ é‡æ–°è®¡ç®—å‡½æ•°ç»“æžœ
â”œâ”€ æ›´æ–°ç´¢å¼•æ¡ç›®
â”œâ”€ ç»´æŠ¤ç´¢å¼•ç»“æž„
â””â”€ é¢å¤–I/Oå¼€é”€

å¼€é”€ä¼°ç®—ï¼š
â”œâ”€ INSERTï¼šå¢žåŠ 20-30%æ—¶é—´
â”œâ”€ UPDATEï¼šå¢žåŠ 30-50%æ—¶é—´ï¼ˆå¦‚æžœæ›´æ–°ç´¢å¼•åˆ—ï¼‰
â”œâ”€ DELETEï¼šå¢žåŠ 10-20%æ—¶é—´
â””â”€ æ€»ä½“è¯„ä¼°ï¼šå†™æ“ä½œå˜æ…¢ï¼Œè¯»æ“ä½œå¤§å¹…æå‡
```

---

## 6. ðŸ“Š ç›‘æŽ§ä¸Žç»´æŠ¤


### 6.1 å‡½æ•°ç´¢å¼•ç›‘æŽ§


**ç´¢å¼•ä½¿ç”¨æƒ…å†µæŸ¥è¯¢**ï¼š
```sql
-- æŸ¥çœ‹å‡½æ•°ç´¢å¼•å®šä¹‰
SELECT 
    table_name,
    index_name,
    column_name,
    expression
FROM information_schema.statistics 
WHERE expression IS NOT NULL;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SELECT 
    object_schema,
    object_name,
    index_name,
    count_read,
    count_insert,
    count_update,
    count_delete
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE index_name LIKE 'idx_%expression%';
```

**æ€§èƒ½ç›‘æŽ§æŸ¥è¯¢**ï¼š
```sql
-- ç›‘æŽ§æ…¢æŸ¥è¯¢ä¸­çš„å‡½æ•°ä½¿ç”¨
SELECT 
    sql_text,
    exec_count,
    avg_timer_wait/1000000000 as avg_duration_sec
FROM performance_schema.events_statements_summary_by_digest 
WHERE sql_text LIKE '%UPPER(%' 
   OR sql_text LIKE '%DATE(%'
   OR sql_text LIKE '%JSON_EXTRACT(%'
ORDER BY avg_timer_wait DESC;
```

### 6.2 ç´¢å¼•ç»´æŠ¤ç­–ç•¥


**å®šæœŸç»´æŠ¤ä»»åŠ¡**ï¼š
```sql
-- 1. æ£€æŸ¥ç´¢å¼•ç¢Žç‰‡
SELECT 
    table_name,
    index_name,
    stat_value as pages
FROM mysql.innodb_index_stats 
WHERE stat_name = 'n_leaf_pages'
  AND index_name LIKE 'idx_%';

-- 2. é‡å»ºç´¢å¼•ï¼ˆå¦‚æžœç¢Žç‰‡ä¸¥é‡ï¼‰
ALTER TABLE table_name DROP INDEX idx_function_name;
CREATE INDEX idx_function_name ON table_name ((expression));

-- 3. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE table_name;
```

### 6.3 é—®é¢˜è¯Šæ–­


**å¸¸è§é—®é¢˜æŽ’æŸ¥**ï¼š
```sql
-- é—®é¢˜1ï¼šå‡½æ•°ç´¢å¼•æ²¡æœ‰è¢«ä½¿ç”¨
EXPLAIN SELECT * FROM users WHERE UPPER(name) = 'JOHN';

æŽ’æŸ¥æ­¥éª¤ï¼š
â”œâ”€ æ£€æŸ¥å‡½æ•°è¡¨è¾¾å¼æ˜¯å¦å®Œå…¨åŒ¹é…
â”œâ”€ ç¡®è®¤MySQLç‰ˆæœ¬æ”¯æŒå‡½æ•°ç´¢å¼•  
â”œâ”€ æŸ¥çœ‹ä¼˜åŒ–å™¨æ˜¯å¦é€‰æ‹©äº†å…¶ä»–ç´¢å¼•
â””â”€ æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦è¿‡æœŸ

-- é—®é¢˜2ï¼šæŸ¥è¯¢æ€§èƒ½åè€Œå˜æ…¢
å¯èƒ½åŽŸå› ï¼š
â”œâ”€ ç´¢å¼•é€‰æ‹©æ€§å¤ªå·®
â”œâ”€ å‡½æ•°è®¡ç®—å¼€é”€è¿‡å¤§
â”œâ”€ æ•°æ®åˆ†å¸ƒä¸å‡åŒ€
â””â”€ ç´¢å¼•ç¢Žç‰‡è¿‡å¤š
```

---

## 7. ðŸ† æœ€ä½³å®žè·µæŒ‡å—


### 7.1 è®¾è®¡åŽŸåˆ™


**å‡½æ•°ç´¢å¼•è®¾è®¡å»ºè®®**ï¼š
```sql
-- âœ… å¥½çš„è®¾è®¡
-- 1. ç¡®å®šæ€§å‡½æ•°
CREATE INDEX idx_upper_name ON users ((UPPER(name)));

-- 2. é«˜é€‰æ‹©æ€§è¡¨è¾¾å¼
CREATE INDEX idx_email_domain ON users ((SUBSTRING_INDEX(email, '@', -1)));

-- 3. ç®€å•è¡¨è¾¾å¼
CREATE INDEX idx_year ON orders ((YEAR(order_date)));

-- âŒ é¿å…çš„è®¾è®¡
-- 1. å¤æ‚åµŒå¥—å‡½æ•°
CREATE INDEX idx_bad ON users ((UPPER(SUBSTRING(REVERSE(name), 1, 3))));

-- 2. ä½Žé€‰æ‹©æ€§è¡¨è¾¾å¼  
CREATE INDEX idx_bad2 ON users ((LENGTH(name) > 5));  -- åªæœ‰true/false

-- 3. è®¡ç®—å¼€é”€å¤§çš„å‡½æ•°
CREATE INDEX idx_bad3 ON logs ((MD5(CONCAT(col1, col2, col3, col4))));
```

### 7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**æŸ¥è¯¢ç¼–å†™è§„èŒƒ**ï¼š
```sql
-- âœ… æ­£ç¡®çš„æŸ¥è¯¢å†™æ³•
-- æŸ¥è¯¢æ¡ä»¶ä¸Žç´¢å¼•è¡¨è¾¾å¼å®Œå…¨åŒ¹é…
SELECT * FROM users WHERE UPPER(name) = 'JOHN';
SELECT * FROM orders WHERE YEAR(order_date) = 2024;

-- âŒ é”™è¯¯çš„æŸ¥è¯¢å†™æ³•  
-- æŸ¥è¯¢æ¡ä»¶ä¸Žç´¢å¼•è¡¨è¾¾å¼ä¸åŒ¹é…
SELECT * FROM users WHERE name = UPPER('john');  -- å‡½æ•°ä½ç½®é”™è¯¯
SELECT * FROM orders WHERE order_date >= '2024-01-01' 
  AND order_date < '2025-01-01';  -- æ²¡æœ‰ä½¿ç”¨YEARå‡½æ•°
```

**ç´¢å¼•ç»„åˆç­–ç•¥**ï¼š
```sql
-- ç­–ç•¥1ï¼šå‡½æ•°ç´¢å¼•+æ™®é€šç´¢å¼•ç»„åˆ
CREATE INDEX idx_user_year ON orders (user_id, (YEAR(order_date)));

-- ç­–ç•¥2ï¼šå¤šä¸ªå‡½æ•°ç´¢å¼•
CREATE INDEX idx_name_upper ON users ((UPPER(name)));
CREATE INDEX idx_name_length ON users ((LENGTH(name)));

-- ç­–ç•¥3ï¼šå‡½æ•°ç´¢å¼•+è¦†ç›–ç´¢å¼•
CREATE INDEX idx_cover ON orders ((YEAR(order_date)), amount, status);
```

### 7.3 è¿ç§»æŒ‡å¯¼


**ä»Žä¼ ç»Ÿç´¢å¼•è¿ç§»åˆ°å‡½æ•°ç´¢å¼•**ï¼š
```sql
-- è¿ç§»æ­¥éª¤ç¤ºä¾‹

-- ç¬¬1æ­¥ï¼šåˆ†æžçŽ°æœ‰æŸ¥è¯¢
-- æ‰¾å‡ºç»å¸¸ä½¿ç”¨å‡½æ•°çš„æŸ¥è¯¢
SELECT sql_text, exec_count 
FROM performance_schema.events_statements_summary_by_digest 
WHERE sql_text LIKE '%UPPER(%name%';

-- ç¬¬2æ­¥ï¼šåˆ›å»ºå‡½æ•°ç´¢å¼•
CREATE INDEX idx_upper_name ON users ((UPPER(name)));

-- ç¬¬3æ­¥ï¼šéªŒè¯æ€§èƒ½æå‡
EXPLAIN SELECT * FROM users WHERE UPPER(name) = 'JOHN';

-- ç¬¬4æ­¥ï¼šç›‘æŽ§ä¸€æ®µæ—¶é—´åŽï¼Œåˆ é™¤ä¸å¿…è¦çš„æ—§ç´¢å¼•
-- ï¼ˆè°¨æ…Žæ“ä½œï¼Œç¡®ä¿æ²¡æœ‰å…¶ä»–æŸ¥è¯¢ä¾èµ–ï¼‰
```

### 7.4 å¼€å‘è§„èŒƒ


**å›¢é˜Ÿå¼€å‘å»ºè®®**ï¼š
```sql
-- å‘½åè§„èŒƒ
-- å‡½æ•°ç´¢å¼•å‘½åï¼šidx_å‡½æ•°å_åˆ—å
CREATE INDEX idx_upper_name ON users ((UPPER(name)));
CREATE INDEX idx_year_order_date ON orders ((YEAR(order_date)));

-- æ–‡æ¡£è®°å½•
-- ä¸ºæ¯ä¸ªå‡½æ•°ç´¢å¼•æ·»åŠ æ³¨é‡Šè¯´æ˜Žç”¨é€”
CREATE INDEX idx_email_domain ON users ((SUBSTRING_INDEX(email, '@', -1))) 
COMMENT 'é‚®ç®±åŸŸåç´¢å¼•ï¼Œç”¨äºŽæŒ‰é‚®ç®±æä¾›å•†æŸ¥è¯¢ç”¨æˆ·';

-- ä»£ç å®¡æŸ¥è¦ç‚¹
-- 1. ç¡®è®¤å‡½æ•°ç´¢å¼•çš„å¿…è¦æ€§
-- 2. éªŒè¯è¡¨è¾¾å¼çš„ç¡®å®šæ€§
-- 3. è¯„ä¼°ç»´æŠ¤æˆæœ¬
-- 4. æ£€æŸ¥æ˜¯å¦æœ‰æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆ
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ å‡½æ•°ç´¢å¼•æœ¬è´¨ï¼šå¯¹è®¡ç®—ç»“æžœå»ºç´¢å¼•ï¼Œé¿å…æŸ¥è¯¢æ—¶é‡å¤è®¡ç®—
ðŸ”¸ é€‚ç”¨ç‰ˆæœ¬ï¼šMySQL 8.0+åŽŸç”Ÿæ”¯æŒï¼Œ5.7+å¯é€šè¿‡è™šæ‹Ÿåˆ—å®žçŽ°
ðŸ”¸ è¯­æ³•è¦ç‚¹ï¼šè¡¨è¾¾å¼ç”¨åŒæ‹¬å·åŒ…å›´ ((expression))
ðŸ”¸ æ ¸å¿ƒé™åˆ¶ï¼šåªèƒ½ä½¿ç”¨ç¡®å®šæ€§å‡½æ•°ï¼Œä¸èƒ½åŒ…å«éšæœºæˆ–æ—¶é—´ç›¸å…³å‡½æ•°
ðŸ”¸ æ€§èƒ½æƒè¡¡ï¼šæŸ¥è¯¢å¤§å¹…æå‡ï¼Œå†™å…¥ç•¥æœ‰ä¸‹é™
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä½•æ—¶ä½¿ç”¨å‡½æ•°ç´¢å¼•**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… é¢‘ç¹å¯¹åˆ—è¿›è¡Œå‡½æ•°è®¡ç®—æŸ¥è¯¢
âœ… å‡½æ•°è®¡ç®—å¼€é”€è¾ƒå¤§
âœ… æŸ¥è¯¢é¢‘çŽ‡è¿œå¤§äºŽæ›´æ–°é¢‘çŽ‡
âœ… å‡½æ•°ç»“æžœæœ‰è¾ƒå¥½çš„é€‰æ‹©æ€§

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ æ›´æ–°é¢‘ç¹çš„è¡¨
âŒ å‡½æ•°è®¡ç®—å¼€é”€å¾ˆå°
âŒ å‡½æ•°ç»“æžœé€‰æ‹©æ€§å¾ˆå·®
âŒ æŸ¥è¯¢æ¨¡å¼ä¸å›ºå®š
```

**ðŸ”¹ å‡½æ•°ç´¢å¼•vsè™šæ‹Ÿåˆ—ç´¢å¼•**
```
å‡½æ•°ç´¢å¼•ï¼ˆMySQL 8.0+ï¼‰ï¼š
â”œâ”€ è¯­æ³•ç®€æ´ï¼Œç›´æŽ¥åœ¨ç´¢å¼•ä¸­å®šä¹‰è¡¨è¾¾å¼
â”œâ”€ ä¸éœ€è¦é¢å¤–çš„åˆ—å®šä¹‰
â””â”€ æ›´åŠ ç›´è§‚å’Œä¾¿äºŽç»´æŠ¤

è™šæ‹Ÿåˆ—ç´¢å¼•ï¼ˆMySQL 5.7+ï¼‰ï¼š
â”œâ”€ å…¼å®¹æ€§æ›´å¥½ï¼Œæ”¯æŒæ›´å¤šç‰ˆæœ¬
â”œâ”€ å¯ä»¥åœ¨SELECTä¸­ç›´æŽ¥ä½¿ç”¨è™šæ‹Ÿåˆ—
â””â”€ åˆ—å’Œç´¢å¼•åˆ†ç¦»ï¼Œæ›´æ˜“äºŽç†è§£
```

### 8.3 å®žé™…åº”ç”¨ä»·å€¼


**æ€§èƒ½æå‡åœºæ™¯**ï¼š
- **å¤§å°å†™ä¸æ•æ„Ÿæœç´¢**ï¼šæå‡10-100å€æŸ¥è¯¢æ€§èƒ½
- **JSONå­—æ®µæŸ¥è¯¢**ï¼šé¿å…æ¯æ¬¡è§£æžJSONï¼Œæ€§èƒ½æå‡5-20å€  
- **æ—¥æœŸå‡½æ•°æŸ¥è¯¢**ï¼šæŒ‰å¹´æœˆç»Ÿè®¡ç±»æŸ¥è¯¢ï¼Œæ€§èƒ½æå‡10-50å€
- **å¤æ‚è®¡ç®—æŸ¥è¯¢**ï¼šé¿å…é‡å¤è®¡ç®—ï¼Œæ€§èƒ½æå‡æ ¹æ®è®¡ç®—å¤æ‚åº¦è€Œå®š

**ä¸šåŠ¡ä»·å€¼**ï¼š
- **ç”¨æˆ·ä½“éªŒ**ï¼šæœç´¢å“åº”æ—¶é—´ä»Žç§’çº§é™åˆ°æ¯«ç§’çº§
- **ç³»ç»Ÿè´Ÿè½½**ï¼šå‡å°‘CPUè®¡ç®—åŽ‹åŠ›ï¼Œæé«˜å¹¶å‘èƒ½åŠ›
- **å¼€å‘æ•ˆçŽ‡**ï¼šæ— éœ€ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ï¼Œé€æ˜Žçš„æ€§èƒ½ä¼˜åŒ–

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å‡½æ•°ç´¢å¼•è§£å†³"ç»å¸¸ç”¨å‡½æ•°æŸ¥è¯¢ä½†å¾ˆæ…¢"çš„é—®é¢˜
- æ ¸å¿ƒæ˜¯é¢„è®¡ç®—å¹¶å­˜å‚¨å‡½æ•°ç»“æžœï¼ŒæŸ¥è¯¢æ—¶ç›´æŽ¥ä½¿ç”¨
- é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œèƒ½æ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½
- MySQL 8.0+çš„é‡è¦ç‰¹æ€§ï¼Œå€¼å¾—é‡ç‚¹æŽŒæ¡å’Œåº”ç”¨