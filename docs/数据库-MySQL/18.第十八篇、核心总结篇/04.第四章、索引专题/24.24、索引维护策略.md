---
title: 24ã€ç´¢å¼•ç»´æŠ¤ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [ç´¢å¼•ç»´æŠ¤åŸºç¡€æ¦‚å¿µ](#1-ç´¢å¼•ç»´æŠ¤åŸºç¡€æ¦‚å¿µ)
2. [ç»´æŠ¤è®¡åˆ’åˆ¶å®šç­–ç•¥](#2-ç»´æŠ¤è®¡åˆ’åˆ¶å®šç­–ç•¥)
3. [å®šæœŸæ£€æŸ¥ä»»åŠ¡ä½“ç³»](#3-å®šæœŸæ£€æŸ¥ä»»åŠ¡ä½“ç³»)
4. [æ€§èƒ½ç›‘æ§ä½“ç³»å»ºè®¾](#4-æ€§èƒ½ç›‘æ§ä½“ç³»å»ºè®¾)
5. [é—®é¢˜å‘ç°ä¸è¯Šæ–­æœºåˆ¶](#5-é—®é¢˜å‘ç°ä¸è¯Šæ–­æœºåˆ¶)
6. [ç»´æŠ¤æ“ä½œæ ‡å‡†æµç¨‹](#6-ç»´æŠ¤æ“ä½œæ ‡å‡†æµç¨‹)
7. [ç»´æŠ¤çª—å£ç®¡ç†ç­–ç•¥](#7-ç»´æŠ¤çª—å£ç®¡ç†ç­–ç•¥)
8. [ç»´æŠ¤è„šæœ¬å¼€å‘è§„èŒƒ](#8-ç»´æŠ¤è„šæœ¬å¼€å‘è§„èŒƒ)
9. [ç»´æŠ¤è®°å½•ç®¡ç†ä½“ç³»](#9-ç»´æŠ¤è®°å½•ç®¡ç†ä½“ç³»)
10. [ç»´æŠ¤æ•ˆæœè¯„ä¼°æ–¹æ³•](#10-ç»´æŠ¤æ•ˆæœè¯„ä¼°æ–¹æ³•)
11. [åº”æ€¥å¤„ç†æµç¨‹](#11-åº”æ€¥å¤„ç†æµç¨‹)
12. [å›¢é˜Ÿåä½œä¸æœ€ä½³å®è·µ](#12-å›¢é˜Ÿåä½œä¸æœ€ä½³å®è·µ)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ ç´¢å¼•ç»´æŠ¤åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•ç»´æŠ¤


**ğŸ“– ç®€å•ç†è§£**ï¼š
ç´¢å¼•ç»´æŠ¤å°±åƒç»™å›¾ä¹¦é¦†çš„ç›®å½•å¡ç‰‡åšæ—¥å¸¸ç®¡ç†ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå›¾ä¹¦é¦†æ¯å¤©éƒ½æœ‰æ–°ä¹¦å…¥åº“ã€æ—§ä¹¦ä¸‹æ¶ï¼Œå¦‚æœä¸åŠæ—¶æ›´æ–°ç›®å½•å¡ç‰‡ï¼Œè¯»è€…å°±å¾ˆéš¾å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„ä¹¦ã€‚

**ğŸ¯ æ ¸å¿ƒå®šä¹‰**ï¼š
```
ç´¢å¼•ç»´æŠ¤ï¼šå¯¹æ•°æ®åº“ç´¢å¼•è¿›è¡Œå®šæœŸæ£€æŸ¥ã€ä¼˜åŒ–ã€é‡å»ºçš„ç®¡ç†è¿‡ç¨‹
ç›®æ ‡ï¼šä¿æŒç´¢å¼•çš„æœ€ä½³æ€§èƒ½çŠ¶æ€ï¼Œç¡®ä¿æŸ¥è¯¢æ•ˆç‡
æœ¬è´¨ï¼šé¢„é˜²æ€§ç®¡ç† + é—®é¢˜ä¿®å¤ + æŒç»­ä¼˜åŒ–
```

**ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ç»´æŠ¤**ï¼š
```
ç´¢å¼•ä¼š"å˜è„"ï¼š
â€¢ æ•°æ®é¢‘ç¹å¢åˆ æ”¹ â†’ ç´¢å¼•ç¢ç‰‡åŒ–
â€¢ æ•°æ®åˆ†å¸ƒå˜åŒ– â†’ ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶
â€¢ å­˜å‚¨ç©ºé—´æµªè´¹ â†’ å½±å“æŸ¥è¯¢æ€§èƒ½
â€¢ é”ç­‰å¾…å¢åŠ  â†’ å¹¶å‘æ€§èƒ½ä¸‹é™

å°±åƒæ±½è½¦éœ€è¦ä¿å…»ä¸€æ ·ï¼Œä¸ç»´æŠ¤çš„ç´¢å¼•ä¼šè¶Šæ¥è¶Šæ…¢ï¼
```

### 1.2 ç´¢å¼•ç»´æŠ¤çš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ **ä¸šåŠ¡ä»·å€¼ä½“ç°**ï¼š

| ç»´æŠ¤æ•ˆæœ | **ä¸šåŠ¡å½±å“** | **æŠ€æœ¯æŒ‡æ ‡** | **ç”¨æˆ·ä½“éªŒ** |
|----------|------------|-------------|-------------|
| ğŸš€ **æŸ¥è¯¢åŠ é€Ÿ** | `é¡µé¢å“åº”å¿«50%` | `æŸ¥è¯¢æ—¶é—´ä»2ç§’é™åˆ°400ms` | `ç”¨æˆ·ç­‰å¾…æ—¶é—´æ˜æ˜¾å‡å°‘` |
| ğŸ’¾ **ç©ºé—´ä¼˜åŒ–** | `æœåŠ¡å™¨æˆæœ¬é™ä½30%` | `å­˜å‚¨ç©ºé—´èŠ‚çœ20GB` | `ç³»ç»Ÿæ›´ç¨³å®š` |
| ğŸ”„ **å¹¶å‘æå‡** | `æ”¯æŒç”¨æˆ·æ•°ç¿»å€` | `é”ç­‰å¾…æ—¶é—´å‡å°‘80%` | `é«˜å³°æœŸä¸å¡é¡¿` |

**ğŸ”— **å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦å…ˆäº†è§£ `ç´¢å¼•åŸºæœ¬åŸç†` å’Œ `MySQLå­˜å‚¨å¼•æ“ç‰¹æ€§`

---

## 2. ğŸ“‹ ç»´æŠ¤è®¡åˆ’åˆ¶å®šç­–ç•¥


### 2.1 ç»´æŠ¤è®¡åˆ’åˆ†ç±»


**ğŸ“… **æŒ‰æ—¶é—´é¢‘ç‡åˆ†ç±»**ï¼š

```
ğŸŸ¢ **æ—¥å¸¸ç»´æŠ¤**ï¼ˆæ¯å¤©ï¼‰ï¼š
â€¢ ç›‘æ§æ…¢æŸ¥è¯¢æ—¥å¿—
â€¢ æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
â€¢ è§‚å¯Ÿç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
â€¢ å¤„ç†ç´§æ€¥æ€§èƒ½é—®é¢˜

ğŸŸ¡ **å‘¨æœŸç»´æŠ¤**ï¼ˆæ¯å‘¨ï¼‰ï¼š
â€¢ åˆ†æç´¢å¼•ç¢ç‰‡ç‡
â€¢ æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
â€¢ æ£€æŸ¥ç´¢å¼•é‡å¤æƒ…å†µ
â€¢ è¯„ä¼°æ–°ç´¢å¼•éœ€æ±‚

ğŸ”´ **æ·±åº¦ç»´æŠ¤**ï¼ˆæ¯æœˆï¼‰ï¼š
â€¢ ç´¢å¼•é‡å»ºæ“ä½œ
â€¢ ç»´æŠ¤çª—å£å†…æ‰¹é‡ä¼˜åŒ–
â€¢ ç´¢å¼•ç­–ç•¥è°ƒæ•´
â€¢ æ€§èƒ½åŸºçº¿æ›´æ–°
```

**ğŸ¯ **ç»´æŠ¤ä¼˜å…ˆçº§çŸ©é˜µ**ï¼š

| è¡¨ç±»å‹ | **æ•°æ®å˜åŒ–é¢‘ç‡** | **ä¸šåŠ¡é‡è¦æ€§** | **ç»´æŠ¤é¢‘ç‡** | **ç»´æŠ¤ç­–ç•¥** |
|--------|----------------|---------------|-------------|-------------|
| ğŸ”¥ **æ ¸å¿ƒä¸šåŠ¡è¡¨** | `é«˜é¢‘è¯»å†™` | `æé‡è¦` | `æ¯å‘¨` | `æœ€å°åŒ–åœæœºç»´æŠ¤` |
| â­ **ä¸€èˆ¬ä¸šåŠ¡è¡¨** | `ä¸­é¢‘è¯»å†™` | `é‡è¦` | `åŒå‘¨` | `ä½å³°æœŸç»´æŠ¤` |
| ğŸ“Š **ç»Ÿè®¡æŠ¥è¡¨è¡¨** | `æ‰¹é‡å†™å…¥` | `ä¸€èˆ¬` | `æ¯æœˆ` | `ç»´æŠ¤çª—å£é›†ä¸­å¤„ç†` |

### 2.2 åˆ¶å®šä¸ªæ€§åŒ–ç»´æŠ¤è®¡åˆ’


**ğŸ” **è¯„ä¼°ç»´æŠ¤éœ€æ±‚çš„æ­¥éª¤**ï¼š

**Step 1** ğŸ” **ä¸šåŠ¡åˆ†æ**
```sql
-- åˆ†æè¡¨çš„é‡è¦æ€§å’Œè®¿é—®æ¨¡å¼
SELECT 
    table_name,
    table_rows,
    avg_row_length,
    data_length/1024/1024 as data_mb,
    index_length/1024/1024 as index_mb
FROM information_schema.TABLES 
WHERE table_schema = 'your_database'
ORDER BY data_length DESC;
```

**Step 2** âš™ï¸ **æ€§èƒ½åŸºçº¿å»ºç«‹**
```sql
-- è®°å½•å½“å‰æ€§èƒ½åŸºçº¿
SELECT 
    schema_name,
    sum_timer_wait/1000000000 as total_time_sec,
    count_star as query_count,
    avg_timer_wait/1000000000 as avg_time_sec
FROM performance_schema.events_statements_summary_by_digest 
WHERE schema_name = 'your_database'
ORDER BY sum_timer_wait DESC
LIMIT 20;
```

**Step 3** âœ… **åˆ¶å®šç»´æŠ¤æ—¥å†**

**ğŸ’¼ **å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```
æŸç”µå•†ç³»ç»Ÿç»´æŠ¤è®¡åˆ’ï¼š

æ¯æ—¥ 08:00-09:00ï¼š
â€¢ æ£€æŸ¥è®¢å•è¡¨ç´¢å¼•ä½¿ç”¨ç‡
â€¢ ç›‘æ§å•†å“æœç´¢æ€§èƒ½
â€¢ åˆ†ææ…¢æŸ¥è¯¢Top10

æ¯å‘¨æ—¥ 02:00-04:00ï¼š
â€¢ é‡å»ºç”¨æˆ·è¡Œä¸ºåˆ†æè¡¨ç´¢å¼•
â€¢ æ›´æ–°å•†å“åˆ†ç±»è¡¨ç»Ÿè®¡ä¿¡æ¯
â€¢ æ¸…ç†æ— ç”¨ç´¢å¼•

æ¯æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥ 01:00-05:00ï¼š
â€¢ æ ¸å¿ƒä¸šåŠ¡è¡¨ç´¢å¼•é‡å»º
â€¢ æ•°æ®å½’æ¡£æ“ä½œ
â€¢ æ€§èƒ½åŸºçº¿æ›´æ–°
```

---

## 3. ğŸ” å®šæœŸæ£€æŸ¥ä»»åŠ¡ä½“ç³»


### 3.1 ç´¢å¼•å¥åº·åº¦æ£€æŸ¥


**ğŸ“Š **æ ¸å¿ƒæ£€æŸ¥æŒ‡æ ‡**ï¼š

**ğŸ¯ **ç´¢å¼•ç¢ç‰‡ç‡æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥è¡¨çš„ç¢ç‰‡æƒ…å†µ
SELECT 
    table_name,
    engine,
    table_rows,
    avg_row_length,
    data_length,
    index_length,
    data_free,
    (data_free/(data_length+index_length))*100 as fragmentation_pct
FROM information_schema.TABLES 
WHERE table_schema = 'your_database'
  AND data_free > 0
ORDER BY fragmentation_pct DESC;
```

**ğŸ’¡ **åˆ¤æ–­æ ‡å‡†**ï¼š
```
ğŸŸ¢ ç¢ç‰‡ç‡ < 5%ï¼šå¥åº·çŠ¶æ€ï¼Œæ— éœ€å¤„ç†
ğŸŸ¡ ç¢ç‰‡ç‡ 5-15%ï¼šå»ºè®®ä¼˜åŒ–ï¼Œå¯å®‰æ’ç»´æŠ¤
ğŸ”´ ç¢ç‰‡ç‡ > 15%ï¼šéœ€è¦ç«‹å³é‡å»ºç´¢å¼•
```

**ğŸ” **ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ**ï¼š
```sql
-- æŸ¥æ‰¾ä»æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    object_schema,
    object_name,
    index_name,
    count_star,
    sum_timer_wait
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE index_name IS NOT NULL 
  AND count_star = 0
  AND object_schema = 'your_database'
ORDER BY object_name;
```

### 3.2 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬


**ğŸ¤– **ç´¢å¼•å¥åº·æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# ç´¢å¼•å¥åº·åº¦è‡ªåŠ¨æ£€æŸ¥è„šæœ¬

DB_NAME="your_database"
ALERT_THRESHOLD=15
LOG_FILE="/var/log/mysql_index_check.log"

echo "å¼€å§‹ç´¢å¼•å¥åº·æ£€æŸ¥ - $(date)" >> $LOG_FILE

# æ£€æŸ¥ç¢ç‰‡ç‡è¶…æ ‡çš„è¡¨
mysql -e "
SELECT 
    CONCAT('è¡¨: ', table_name, ' ç¢ç‰‡ç‡: ', 
           ROUND((data_free/(data_length+index_length))*100, 2), '%') as alert
FROM information_schema.TABLES 
WHERE table_schema = '$DB_NAME'
  AND (data_free/(data_length+index_length))*100 > $ALERT_THRESHOLD
" >> $LOG_FILE

echo "æ£€æŸ¥å®Œæˆ - $(date)" >> $LOG_FILE
```

---

## 4. ğŸ“Š æ€§èƒ½ç›‘æ§ä½“ç³»å»ºè®¾


### 4.1 å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰


**ğŸ“ˆ **ç›‘æ§æŒ‡æ ‡ä½“ç³»**ï¼š

```
ğŸ¯ **å“åº”æ—¶é—´æŒ‡æ ‡**ï¼š
â€¢ å¹³å‡æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
â€¢ 95%æŸ¥è¯¢å“åº”æ—¶é—´ < 500ms  
â€¢ 99%æŸ¥è¯¢å“åº”æ—¶é—´ < 1s

ğŸ”„ **ååé‡æŒ‡æ ‡**ï¼š
â€¢ æ¯ç§’æŸ¥è¯¢æ•°(QPS) > 1000
â€¢ æ¯ç§’äº‹åŠ¡æ•°(TPS) > 500
â€¢ ç´¢å¼•æ‰«ææ•ˆç‡ > 90%

ğŸ’¾ **èµ„æºä½¿ç”¨æŒ‡æ ‡**ï¼š
â€¢ ç´¢å¼•å‘½ä¸­ç‡ > 95%
â€¢ ç¼“å†²æ± å‘½ä¸­ç‡ > 99%
â€¢ é”ç­‰å¾…æ—¶é—´ < 10ms
```

**ğŸ”§ **ç›‘æ§å®ç°æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆä¸€ï¼šåŸºäºMySQLè‡ªå¸¦å·¥å…·**
```sql
-- è®¾ç½®æ€§èƒ½ç›‘æ§
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 0.1;
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- å¯ç”¨æ€§èƒ½æ¨¡å¼
UPDATE performance_schema.setup_instruments 
SET ENABLED = 'YES', TIMED = 'YES' 
WHERE NAME LIKE '%statement%';
```

**æ–¹æ¡ˆäºŒï¼šç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·é›†æˆ**
```yaml
# ç›‘æ§é…ç½®ç¤ºä¾‹ï¼ˆPrometheus + Grafanaï¼‰
mysql_exporter:
  config:
    - collect.info_schema.innodb_metrics
    - collect.info_schema.query_response_time
    - collect.perf_schema.indexiowaits
    - collect.perf_schema.tableiowaits
```

### 4.2 ç›‘æ§å‘Šè­¦æœºåˆ¶


**ğŸš¨ **å‘Šè­¦çº§åˆ«å®šä¹‰**ï¼š

| å‘Šè­¦çº§åˆ« | **è§¦å‘æ¡ä»¶** | **å“åº”æ—¶é—´** | **å¤„ç†æ–¹å¼** |
|----------|-------------|-------------|-------------|
| ğŸ”´ **ç´§æ€¥** | `æŸ¥è¯¢å“åº”æ—¶é—´>2s` | `5åˆ†é’Ÿå†…` | `ç«‹å³äººå·¥ä»‹å…¥` |
| ğŸŸ¡ **è­¦å‘Š** | `æ…¢æŸ¥è¯¢å¢é•¿50%` | `30åˆ†é’Ÿå†…` | `è®°å½•å¹¶åˆ†æ` |
| ğŸŸ¢ **ä¿¡æ¯** | `ç´¢å¼•ç¢ç‰‡ç‡>10%` | `24å°æ—¶å†…` | `è®¡åˆ’ç»´æŠ¤` |

---

## 5. ğŸ” é—®é¢˜å‘ç°ä¸è¯Šæ–­æœºåˆ¶


### 5.1 å¸¸è§é—®é¢˜è¯†åˆ«


**âŒ **é—®é¢˜ç±»å‹ä¸ç—‡çŠ¶å¯¹ç…§**ï¼š

**ğŸŒ **æŸ¥è¯¢å˜æ…¢é—®é¢˜**ï¼š
```
ç—‡çŠ¶è¡¨ç°ï¼š
â€¢ åŒæ ·çš„SQLçªç„¶æ‰§è¡Œå¾ˆæ…¢
â€¢ ç”¨æˆ·åé¦ˆé¡µé¢å“åº”æ…¢
â€¢ æ•°æ®åº“CPUä½¿ç”¨ç‡é£™å‡

å¯èƒ½åŸå› ï¼š
â€¢ ç´¢å¼•ç¢ç‰‡è¿‡å¤š â†’ éœ€è¦é‡å»º
â€¢ ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶ â†’ éœ€è¦æ›´æ–°  
â€¢ ç´¢å¼•è¢«è¯¯åˆ  â†’ éœ€è¦é‡å»º
â€¢ æ•°æ®é‡å¢é•¿ â†’ éœ€è¦è°ƒæ•´ç­–ç•¥
```

**ğŸ”’ **é”ç­‰å¾…é—®é¢˜**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread,
    b.trx_query blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;
```

### 5.2 é—®é¢˜è¯Šæ–­æ–¹æ³•


**ğŸ”¬ **åˆ†å±‚è¯Šæ–­æ³•**ï¼š

**Level 1** ğŸš€ **å¿«é€Ÿè¯Šæ–­**ï¼ˆ2åˆ†é’Ÿå†…ï¼‰
```sql
-- å¿«é€Ÿæ£€æŸ¥å½“å‰æ€§èƒ½çŠ¶æ€
SHOW PROCESSLIST;
SHOW ENGINE INNODB STATUS\G
```

**Level 2** âš™ï¸ **æ·±å…¥åˆ†æ**ï¼ˆ10åˆ†é’Ÿå†…ï¼‰  
```sql
-- åˆ†ææ…¢æŸ¥è¯¢æ¨¡å¼
SELECT 
    digest_text,
    count_star,
    avg_timer_wait/1000000000 as avg_time_sec,
    sum_rows_examined/count_star as avg_rows_examined
FROM performance_schema.events_statements_summary_by_digest 
WHERE avg_timer_wait > 1000000000
ORDER BY count_star DESC;
```

**Level 3** ğŸ” **æ ¹æœ¬åŸå› åˆ†æ**ï¼ˆ30åˆ†é’Ÿå†…ï¼‰
```sql
-- è¯¦ç»†çš„ç´¢å¼•ä½¿ç”¨åˆ†æ
SELECT 
    object_name,
    index_name,
    count_read,
    count_write,
    sum_timer_read/1000000000 as read_time_sec,
    sum_timer_write/1000000000 as write_time_sec
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'your_database'
ORDER BY sum_timer_read DESC;
```

**ğŸ’¡ **é—®é¢˜è¯Šæ–­å†³ç­–æ ‘**ï¼š
```
æŸ¥è¯¢å˜æ…¢ â†’
â”œâ”€â”€ CPUé«˜ï¼Ÿ â†’ æ£€æŸ¥ç´¢å¼•æ•ˆç‡
â”œâ”€â”€ IOé«˜ï¼Ÿ â†’ æ£€æŸ¥ç£ç›˜ç¢ç‰‡
â”œâ”€â”€ é”å¤šï¼Ÿ â†’ åˆ†æäº‹åŠ¡å†²çª
â””â”€â”€ å†…å­˜ä¸è¶³ï¼Ÿ â†’ è°ƒæ•´ç¼“å­˜é…ç½®
```

---

## 6. âš™ï¸ ç»´æŠ¤æ“ä½œæ ‡å‡†æµç¨‹


### 6.1 ç´¢å¼•é‡å»ºæ ‡å‡†æµç¨‹


**ğŸ”„ **å®‰å…¨é‡å»ºæµç¨‹**ï¼š

**Step 1** ğŸ” **ç»´æŠ¤å‰æ£€æŸ¥**
```sql
-- 1. è®°å½•å½“å‰çŠ¶æ€
CREATE TABLE index_status_backup AS 
SELECT * FROM information_schema.statistics 
WHERE table_schema = 'your_database';

-- 2. æ£€æŸ¥è¡¨å¤§å°å’Œé¢„ä¼°æ—¶é—´
SELECT 
    table_name,
    ROUND(data_length/1024/1024, 2) as data_mb,
    table_rows,
    -- é¢„ä¼°é‡å»ºæ—¶é—´ï¼ˆå¤§çº¦æ¯GBéœ€è¦2-5åˆ†é’Ÿï¼‰
    ROUND(data_length/1024/1024/1024 * 3, 1) as estimated_minutes
FROM information_schema.tables 
WHERE table_schema = 'your_database';
```

**Step 2** âš™ï¸ **æ‰§è¡Œé‡å»º**
```sql
-- åœ¨çº¿é‡å»ºï¼ˆMySQL 5.6+ï¼‰
ALTER TABLE your_table 
ENGINE=InnoDB, 
ALGORITHM=INPLACE, 
LOCK=NONE;

-- æˆ–è€…é‡å»ºç‰¹å®šç´¢å¼•
ALTER TABLE your_table 
DROP INDEX old_index,
ADD INDEX new_index (column1, column2),
ALGORITHM=INPLACE,
LOCK=NONE;
```

**Step 3** âœ… **éªŒè¯ç»“æœ**
```sql
-- éªŒè¯ç´¢å¼•æ˜¯å¦æ­£å¸¸å·¥ä½œ
EXPLAIN SELECT * FROM your_table 
WHERE indexed_column = 'test_value';

-- æ£€æŸ¥ç¢ç‰‡ç‡æ˜¯å¦é™ä½
SELECT 
    (data_free/(data_length+index_length))*100 as fragmentation_pct
FROM information_schema.TABLES 
WHERE table_name = 'your_table';
```

### 6.2 ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æµç¨‹


**ğŸ“Š **ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤**ï¼š
```sql
-- æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE your_table;

-- æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æ—¶é—´
SELECT 
    table_name,
    update_time,
    table_rows,
    avg_row_length
FROM information_schema.TABLES 
WHERE table_schema = 'your_database'
ORDER BY update_time DESC;
```

**ğŸ¯ **æ›´æ–°ç­–ç•¥é€‰æ‹©**ï¼š
```
ğŸŸ¢ **å°è¡¨**ï¼ˆ<100MBï¼‰ï¼šæ¯å¤©æ›´æ–°ï¼Œå½±å“å¾ˆå°
ğŸŸ¡ **ä¸­è¡¨**ï¼ˆ100MB-10GBï¼‰ï¼šæ¯å‘¨æ›´æ–°ï¼Œé€‰æ‹©ä½å³°æœŸ
ğŸ”´ **å¤§è¡¨**ï¼ˆ>10GBï¼‰ï¼šæ¯æœˆæ›´æ–°ï¼Œç»´æŠ¤çª—å£è¿›è¡Œ
```

---

## 7. â° ç»´æŠ¤çª—å£ç®¡ç†ç­–ç•¥


### 7.1 ç»´æŠ¤çª—å£è§„åˆ’


**ğŸ“… **ç»´æŠ¤çª—å£åˆ†ç±»**ï¼š

```
ğŸŒ™ **æ—¥å¸¸ç»´æŠ¤çª—å£**ï¼š
â€¢ æ—¶é—´ï¼šæ¯æ—¥ 02:00-04:00
â€¢ å½±å“ï¼šæœ€å°ï¼Œä»…ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
â€¢ é€‚ç”¨ï¼šå°å‹è¡¨ç»´æŠ¤ã€ç›‘æ§æ£€æŸ¥

ğŸ› ï¸ **å‘¨åº¦ç»´æŠ¤çª—å£**ï¼š  
â€¢ æ—¶é—´ï¼šæ¯å‘¨æ—¥ 01:00-05:00
â€¢ å½±å“ï¼šä¸­ç­‰ï¼Œå¯èƒ½æœ‰çŸ­æš‚é”å®š
â€¢ é€‚ç”¨ï¼šä¸­å‹è¡¨é‡å»ºã€ç¢ç‰‡æ•´ç†

ğŸ”§ **æœˆåº¦ç»´æŠ¤çª—å£**ï¼š
â€¢ æ—¶é—´ï¼šæ¯æœˆç¬¬ä¸€ä¸ªå‘¨æ—¥ 00:00-06:00  
â€¢ å½±å“ï¼šè¾ƒå¤§ï¼Œéœ€è¦ä¸šåŠ¡é…åˆ
â€¢ é€‚ç”¨ï¼šå¤§å‹è¡¨é‡å»ºã€æ¶æ„è°ƒæ•´
```

**âš–ï¸ **ç»´æŠ¤çª—å£ vs ä¸šåŠ¡å½±å“è¯„ä¼°**ï¼š

| ç»´æŠ¤ç±»å‹ | **é¢„è®¡æ—¶é•¿** | **ä¸šåŠ¡å½±å“** | **ç”¨æˆ·å½±å“** | **å›æ»šæ–¹æ¡ˆ** |
|----------|-------------|-------------|-------------|-------------|
| ğŸ” **ç»Ÿè®¡æ›´æ–°** | `5-30åˆ†é’Ÿ` | `å‡ ä¹æ— å½±å“` | `ç”¨æˆ·æ— æ„ŸçŸ¥` | `æ— éœ€å›æ»š` |
| ğŸ”„ **åœ¨çº¿é‡å»º** | `30åˆ†é’Ÿ-2å°æ—¶` | `æ€§èƒ½ç•¥å¾®ä¸‹é™` | `è½»å¾®å»¶è¿Ÿ` | `å¯éšæ—¶åœæ­¢` |
| ğŸ› ï¸ **ç¦»çº¿é‡å»º** | `1-6å°æ—¶` | `åŠŸèƒ½ä¸å¯ç”¨` | `æ— æ³•è®¿é—®` | `å¿«é€Ÿå›æ»š` |

### 7.2 ç»´æŠ¤çª—å£æ‰§è¡Œç®¡ç†


**ğŸ“‹ **ç»´æŠ¤çª—å£æ¸…å•**ï¼š
```
ç»´æŠ¤å‰ï¼ˆT-30åˆ†é’Ÿï¼‰ï¼š
â–¡ é€šçŸ¥ç›¸å…³å›¢é˜Ÿå¼€å§‹ç»´æŠ¤
â–¡ ç¡®è®¤å¤‡ä»½å·²å®Œæˆ
â–¡ éªŒè¯å›æ»šæ–¹æ¡ˆå¯ç”¨
â–¡ ç›‘æ§ç³»ç»ŸçŠ¶æ€æ­£å¸¸

ç»´æŠ¤ä¸­ï¼ˆTæ—¶åˆ»ï¼‰ï¼š
â–¡ æŒ‰ç…§æ ‡å‡†æµç¨‹æ‰§è¡Œ
â–¡ å®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€  
â–¡ è®°å½•å…³é”®æ“ä½œæ—¥å¿—
â–¡ é‡åˆ°é—®é¢˜ç«‹å³æ±‡æŠ¥

ç»´æŠ¤åï¼ˆT+30åˆ†é’Ÿï¼‰ï¼š
â–¡ éªŒè¯ç»´æŠ¤æ•ˆæœ
â–¡ æ£€æŸ¥ä¸šåŠ¡åŠŸèƒ½æ­£å¸¸
â–¡ æ›´æ–°ç»´æŠ¤è®°å½•
â–¡ é€šçŸ¥å›¢é˜Ÿç»´æŠ¤å®Œæˆ
```

---

## 8. ğŸ“ ç»´æŠ¤è„šæœ¬å¼€å‘è§„èŒƒ


### 8.1 è„šæœ¬å¼€å‘æ ‡å‡†


**ğŸ› ï¸ **è„šæœ¬è®¾è®¡åŸåˆ™**ï¼š
```
âœ… å®‰å…¨æ€§ä¼˜å…ˆï¼š
â€¢ æ‰§è¡Œå‰å¿…é¡»æ£€æŸ¥ç¯å¢ƒ
â€¢ å…³é”®æ“ä½œéœ€è¦ç¡®è®¤
â€¢ å¼‚å¸¸æƒ…å†µè‡ªåŠ¨å›æ»š
â€¢ è¯¦ç»†æ—¥å¿—è®°å½•

âœ… å¯ç»´æŠ¤æ€§ï¼š
â€¢ ä»£ç ç»“æ„æ¸…æ™°
â€¢ æ³¨é‡Šè¯¦ç»†å®Œæ•´  
â€¢ å‚æ•°åŒ–é…ç½®
â€¢ æ¨¡å—åŒ–è®¾è®¡
```

**ğŸ“‹ **æ ‡å‡†è„šæœ¬æ¨¡æ¿**ï¼š
```bash
#!/bin/bash
# MySQLç´¢å¼•ç»´æŠ¤è„šæœ¬æ¨¡æ¿
# ä½œè€…ï¼šDBAå›¢é˜Ÿ
# åˆ›å»ºæ—¶é—´ï¼š2025-09-10
# åŠŸèƒ½ï¼šè‡ªåŠ¨åŒ–ç´¢å¼•ç»´æŠ¤

# é…ç½®åŒºåŸŸ
DB_HOST="localhost"
DB_USER="dba_user"
DB_NAME="your_database"
LOG_FILE="/var/log/mysql_maintenance_$(date +%Y%m%d).log"
BACKUP_DIR="/backup/mysql/$(date +%Y%m%d)"

# æ—¥å¿—å‡½æ•°
log_info() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] INFO: $1" | tee -a $LOG_FILE
}

log_error() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] ERROR: $1" | tee -a $LOG_FILE
}

# å®‰å…¨æ£€æŸ¥å‡½æ•°
check_environment() {
    log_info "å¼€å§‹ç¯å¢ƒæ£€æŸ¥..."
    
    # æ£€æŸ¥æ•°æ®åº“è¿æ¥
    if ! mysql -h$DB_HOST -u$DB_USER -e "SELECT 1" >/dev/null 2>&1; then
        log_error "æ•°æ®åº“è¿æ¥å¤±è´¥"
        exit 1
    fi
    
    # æ£€æŸ¥ç£ç›˜ç©ºé—´
    DISK_USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ $DISK_USAGE -gt 80 ]; then
        log_error "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œä½¿ç”¨ç‡ï¼š${DISK_USAGE}%"
        exit 1
    fi
    
    log_info "ç¯å¢ƒæ£€æŸ¥é€šè¿‡"
}

# ä¸»å‡½æ•°
main() {
    log_info "å¼€å§‹æ‰§è¡Œç´¢å¼•ç»´æŠ¤è„šæœ¬"
    
    check_environment
    
    # åœ¨è¿™é‡Œæ·»åŠ å…·ä½“çš„ç»´æŠ¤é€»è¾‘
    
    log_info "ç´¢å¼•ç»´æŠ¤è„šæœ¬æ‰§è¡Œå®Œæˆ"
}

# è„šæœ¬å…¥å£
main "$@"
```

### 8.2 å¸¸ç”¨ç»´æŠ¤è„šæœ¬ç¤ºä¾‹


**ğŸ”§ **è‡ªåŠ¨ç¢ç‰‡æ•´ç†è„šæœ¬**ï¼š
```bash
#!/bin/bash
# è‡ªåŠ¨æ£€æŸ¥å¹¶æ•´ç†ç´¢å¼•ç¢ç‰‡

FRAGMENTATION_THRESHOLD=15
DB_NAME="your_database"

# è·å–ç¢ç‰‡ç‡è¶…æ ‡çš„è¡¨
FRAGMENTED_TABLES=$(mysql -N -e "
SELECT table_name 
FROM information_schema.TABLES 
WHERE table_schema = '$DB_NAME'
  AND (data_free/(data_length+index_length))*100 > $FRAGMENTATION_THRESHOLD
")

# å¤„ç†æ¯ä¸ªç¢ç‰‡åŒ–çš„è¡¨
for table in $FRAGMENTED_TABLES; do
    log_info "å¼€å§‹æ•´ç†è¡¨ï¼š$table"
    
    # è®°å½•æ•´ç†å‰çŠ¶æ€
    BEFORE_SIZE=$(mysql -N -e "
    SELECT ROUND((data_length+index_length)/1024/1024, 2) 
    FROM information_schema.TABLES 
    WHERE table_schema = '$DB_NAME' AND table_name = '$table'
    ")
    
    # æ‰§è¡Œåœ¨çº¿é‡å»º
    mysql -e "ALTER TABLE $DB_NAME.$table ENGINE=InnoDB, ALGORITHM=INPLACE, LOCK=NONE"
    
    # è®°å½•æ•´ç†åçŠ¶æ€
    AFTER_SIZE=$(mysql -N -e "
    SELECT ROUND((data_length+index_length)/1024/1024, 2) 
    FROM information_schema.TABLES 
    WHERE table_schema = '$DB_NAME' AND table_name = '$table'
    ")
    
    log_info "è¡¨ $table æ•´ç†å®Œæˆï¼Œå¤§å°ä» ${BEFORE_SIZE}MB å˜ä¸º ${AFTER_SIZE}MB"
done
```

---

## 9. ğŸ“Š ç»´æŠ¤è®°å½•ç®¡ç†ä½“ç³»


### 9.1 ç»´æŠ¤è®°å½•æ ‡å‡†åŒ–


**ğŸ“ **ç»´æŠ¤è®°å½•æ¨¡æ¿**ï¼š
```sql
-- åˆ›å»ºç»´æŠ¤è®°å½•è¡¨
CREATE TABLE maintenance_log (
    id INT AUTO_INCREMENT PRIMARY KEY,
    maintenance_date DATE NOT NULL,
    maintenance_type ENUM('index_rebuild', 'stats_update', 'fragment_cleanup', 'emergency_fix'),
    target_schema VARCHAR(64),
    target_table VARCHAR(64),
    target_index VARCHAR(64),
    duration_minutes INT,
    before_size_mb DECIMAL(10,2),
    after_size_mb DECIMAL(10,2),
    before_fragmentation_pct DECIMAL(5,2),
    after_fragmentation_pct DECIMAL(5,2),
    performance_impact ENUM('none', 'minimal', 'moderate', 'significant'),
    success_status ENUM('success', 'partial', 'failed'),
    operator VARCHAR(32),
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**ğŸ“Š **ç»´æŠ¤è®°å½•åˆ†ææŸ¥è¯¢**ï¼š
```sql
-- æŸ¥çœ‹æœ€è¿‘çš„ç»´æŠ¤æ•ˆæœ
SELECT 
    maintenance_type,
    COUNT(*) as maintenance_count,
    AVG(duration_minutes) as avg_duration,
    AVG(before_fragmentation_pct - after_fragmentation_pct) as avg_improvement,
    SUM(before_size_mb - after_size_mb) as total_space_saved_mb
FROM maintenance_log 
WHERE maintenance_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
GROUP BY maintenance_type;
```

### 9.2 ç»´æŠ¤æ•ˆæœè¿½è¸ª


**ğŸ“ˆ **æ•ˆæœè¯„ä¼°ç»´åº¦**ï¼š

```
ğŸ¯ **æ€§èƒ½æ”¹å–„æŒ‡æ ‡**ï¼š
â€¢ å¹³å‡æŸ¥è¯¢æ—¶é—´å˜åŒ–
â€¢ ç´¢å¼•æ‰«ææ•ˆç‡æå‡  
â€¢ å¹¶å‘èƒ½åŠ›æ”¹å–„
â€¢ èµ„æºä½¿ç”¨ä¼˜åŒ–

ğŸ’¾ **ç©ºé—´ä¼˜åŒ–æŒ‡æ ‡**ï¼š
â€¢ ç¢ç‰‡ç©ºé—´å›æ”¶é‡
â€¢ ç´¢å¼•å¤§å°ä¼˜åŒ–æ¯”ä¾‹
â€¢ å­˜å‚¨æˆæœ¬èŠ‚çœ
â€¢ å¤‡ä»½æ—¶é—´ç¼©çŸ­

ğŸ”„ **å¯ç”¨æ€§æŒ‡æ ‡**ï¼š
â€¢ ç»´æŠ¤çª—å£ä½¿ç”¨ç‡
â€¢ ä¸šåŠ¡å½±å“æ—¶é•¿
â€¢ å›æ»šæ¬¡æ•°ç»Ÿè®¡
â€¢ ç”¨æˆ·æ»¡æ„åº¦è¯„åˆ†
```

**ğŸ“Š **ç»´æŠ¤æ•ˆæœä»ªè¡¨æ¿**ï¼š
```sql
-- ç”Ÿæˆç»´æŠ¤æ•ˆæœæŠ¥å‘Š
SELECT 
    DATE_FORMAT(maintenance_date, '%Y-%m') as month,
    COUNT(*) as total_maintenance,
    SUM(CASE WHEN success_status = 'success' THEN 1 ELSE 0 END) as successful_count,
    ROUND(AVG(before_fragmentation_pct - after_fragmentation_pct), 2) as avg_fragmentation_improvement,
    ROUND(SUM(before_size_mb - after_size_mb), 2) as total_space_saved_mb,
    ROUND(AVG(duration_minutes), 1) as avg_duration_minutes
FROM maintenance_log 
WHERE maintenance_date >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
GROUP BY DATE_FORMAT(maintenance_date, '%Y-%m')
ORDER BY month DESC;
```

---

## 10. ğŸ“ˆ ç»´æŠ¤æ•ˆæœè¯„ä¼°æ–¹æ³•


### 10.1 è¯„ä¼°æŒ‡æ ‡ä½“ç³»


**ğŸ¯ **æ ¸å¿ƒè¯„ä¼°æŒ‡æ ‡**ï¼š

| è¯„ä¼°ç»´åº¦ | **æŒ‡æ ‡åç§°** | **è®¡ç®—æ–¹æ³•** | **ç›®æ ‡å€¼** | **è¯„ä¼°é¢‘ç‡** |
|----------|-------------|-------------|-----------|-------------|
| ğŸš€ **æ€§èƒ½** | `æŸ¥è¯¢å“åº”æ—¶é—´æ”¹å–„ç‡` | `(ç»´æŠ¤å‰-ç»´æŠ¤å)/ç»´æŠ¤å‰Ã—100%` | `>20%` | `ç»´æŠ¤å24å°æ—¶` |
| ğŸ’¾ **ç©ºé—´** | `å­˜å‚¨ç©ºé—´èŠ‚çœç‡` | `å›æ”¶ç©ºé—´/åŸç©ºé—´Ã—100%` | `>10%` | `ç»´æŠ¤å®Œæˆå` |
| ğŸ”„ **ç¨³å®šæ€§** | `ç»´æŠ¤æˆåŠŸç‡` | `æˆåŠŸæ¬¡æ•°/æ€»æ¬¡æ•°Ã—100%` | `>95%` | `æ¯æœˆç»Ÿè®¡` |
| â° **æ•ˆç‡** | `ç»´æŠ¤æ—¶é—´è¾¾æˆç‡` | `å®é™…æ—¶é—´/è®¡åˆ’æ—¶é—´Ã—100%` | `<120%` | `æ¯æ¬¡ç»´æŠ¤å` |

### 10.2 è¯„ä¼°æ–¹æ³•å®æ–½


**ğŸ“Š **è‡ªåŠ¨åŒ–è¯„ä¼°è„šæœ¬**ï¼š
```sql
-- ç»´æŠ¤æ•ˆæœè‡ªåŠ¨è¯„ä¼°å­˜å‚¨è¿‡ç¨‹
DELIMITER //
CREATE PROCEDURE evaluate_maintenance_effect(
    IN p_table_name VARCHAR(64),
    IN p_maintenance_date DATE
)
BEGIN
    DECLARE v_before_avg_time DECIMAL(10,3);
    DECLARE v_after_avg_time DECIMAL(10,3);
    DECLARE v_improvement_pct DECIMAL(5,2);
    
    -- è·å–ç»´æŠ¤å‰åçš„å¹³å‡æŸ¥è¯¢æ—¶é—´
    SELECT AVG(avg_timer_wait)/1000000000 INTO v_before_avg_time
    FROM performance_schema.events_statements_summary_by_digest_history
    WHERE digest_text LIKE CONCAT('%', p_table_name, '%')
      AND first_seen < p_maintenance_date;
      
    SELECT AVG(avg_timer_wait)/1000000000 INTO v_after_avg_time
    FROM performance_schema.events_statements_summary_by_digest
    WHERE digest_text LIKE CONCAT('%', p_table_name, '%')
      AND first_seen >= p_maintenance_date;
    
    -- è®¡ç®—æ”¹å–„ç™¾åˆ†æ¯”
    SET v_improvement_pct = (v_before_avg_time - v_after_avg_time) / v_before_avg_time * 100;
    
    -- æ›´æ–°ç»´æŠ¤è®°å½•
    UPDATE maintenance_log 
    SET 
        performance_improvement_pct = v_improvement_pct,
        evaluation_completed = 1
    WHERE target_table = p_table_name 
      AND maintenance_date = p_maintenance_date;
      
    SELECT 
        p_table_name as table_name,
        v_before_avg_time as before_avg_time_sec,
        v_after_avg_time as after_avg_time_sec,
        v_improvement_pct as improvement_percentage;
END //
DELIMITER ;
```

**ğŸ¯ **ROIï¼ˆæŠ•èµ„å›æŠ¥ç‡ï¼‰è®¡ç®—**ï¼š
```
ç»´æŠ¤ROIè®¡ç®—å…¬å¼ï¼š

æ€§èƒ½æ”¶ç›Š = å“åº”æ—¶é—´æ”¹å–„ Ã— æ¯æ—¥æŸ¥è¯¢é‡ Ã— ç”¨æˆ·ä»·å€¼è½¬æ¢ç‡
æˆæœ¬æŠ•å…¥ = ç»´æŠ¤äººåŠ›æˆæœ¬ + ç³»ç»Ÿèµ„æºæˆæœ¬ + ä¸šåŠ¡å½±å“æˆæœ¬

ROI = (æ€§èƒ½æ”¶ç›Š - æˆæœ¬æŠ•å…¥) / æˆæœ¬æŠ•å…¥ Ã— 100%

ç¤ºä¾‹ï¼š
æŸæ ¸å¿ƒè¡¨ç»´æŠ¤åæŸ¥è¯¢é€Ÿåº¦æå‡50%
æ¯æ—¥100ä¸‡æ¬¡æŸ¥è¯¢ï¼Œæ¯æ¬¡æŸ¥è¯¢èŠ‚çœ0.5ç§’
å‡è®¾æ¯ç§’ç”¨æˆ·æ—¶é—´ä»·å€¼0.01å…ƒ
æœˆåº¦æ”¶ç›Š = 1000000 Ã— 0.5 Ã— 0.01 Ã— 30 = 15ä¸‡å…ƒ
ç»´æŠ¤æˆæœ¬ = äººåŠ›2ä¸‡ + èµ„æº1ä¸‡ = 3ä¸‡å…ƒ
ROI = (15-3)/3 Ã— 100% = 400%
```

---

## 11. ğŸš¨ åº”æ€¥å¤„ç†æµç¨‹


### 11.1 åº”æ€¥å“åº”æœºåˆ¶


**âš¡ **åº”æ€¥æƒ…å†µåˆ†çº§**ï¼š

```
ğŸ”´ **P0çº§-ç³»ç»Ÿç˜«ç—ª**ï¼š
â€¢ è§¦å‘æ¡ä»¶ï¼šæ•°æ®åº“æ— æ³•è¿æ¥ï¼Œæ ¸å¿ƒä¸šåŠ¡å®Œå…¨ä¸­æ–­
â€¢ å“åº”æ—¶é—´ï¼š5åˆ†é’Ÿå†…
â€¢ å¤„ç†å›¢é˜Ÿï¼šDBAä¸»ç®¡ + æ¶æ„å¸ˆ + è¿ç»´ç»ç†
â€¢ å¤„ç†æƒé™ï¼šå¯ç›´æ¥åœæœºç»´æŠ¤

ğŸŸ¡ **P1çº§-ä¸¥é‡æ€§èƒ½é—®é¢˜**ï¼š
â€¢ è§¦å‘æ¡ä»¶ï¼šå“åº”æ—¶é—´è¶…è¿‡5ç§’ï¼Œå¤§é‡ç”¨æˆ·æŠ•è¯‰
â€¢ å“åº”æ—¶é—´ï¼š15åˆ†é’Ÿå†…  
â€¢ å¤„ç†å›¢é˜Ÿï¼šå€¼ç­DBA + å¼€å‘è´Ÿè´£äºº
â€¢ å¤„ç†æƒé™ï¼šå¯killé•¿äº‹åŠ¡ï¼Œé‡å¯ç´¢å¼•

ğŸŸ¢ **P2çº§-æ€§èƒ½é¢„è­¦**ï¼š
â€¢ è§¦å‘æ¡ä»¶ï¼šå“åº”æ—¶é—´è¶…è¿‡2ç§’ï¼Œç›‘æ§å‘Šè­¦
â€¢ å“åº”æ—¶é—´ï¼š30åˆ†é’Ÿå†…
â€¢ å¤„ç†å›¢é˜Ÿï¼šå€¼ç­DBA
â€¢ å¤„ç†æƒé™ï¼šæŸ¥çœ‹åˆ†æï¼Œè®°å½•é—®é¢˜
```

### 11.2 åº”æ€¥å¤„ç†æ ‡å‡†æµç¨‹


**ğŸ”§ **åº”æ€¥å¤„ç†å†³ç­–æ ‘**ï¼š
```
æ€§èƒ½é—®é¢˜ â†’
â”œâ”€â”€ æ˜¯å¦ç´¢å¼•é—®é¢˜ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ æ£€æŸ¥ç´¢å¼•æ˜¯å¦å­˜åœ¨ â†’ é‡å»º/åˆ›å»ºç´¢å¼•
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­åˆ†æ
â”œâ”€â”€ æ˜¯å¦é”ç­‰å¾…ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ æ‰¾åˆ°é˜»å¡äº‹åŠ¡ â†’ é€‚å½“killé•¿äº‹åŠ¡
â”‚   â””â”€â”€ å¦ â†’ ç»§ç»­åˆ†æ  
â”œâ”€â”€ æ˜¯å¦èµ„æºä¸è¶³ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ æ‰©å®¹/ä¼˜åŒ–é…ç½®
â”‚   â””â”€â”€ å¦ â†’ å‡çº§åˆ°é«˜çº§åˆ«å¤„ç†
```

**ğŸ“‹ **åº”æ€¥å·¥å…·ç®±**ï¼š
```sql
-- 1. å¿«é€Ÿæ‰¾å‡ºå½“å‰æ…¢æŸ¥è¯¢
SELECT 
    id, user, host, db, command, time, state, info
FROM information_schema.processlist 
WHERE time > 10 AND command != 'Sleep'
ORDER BY time DESC;

-- 2. å¿«é€Ÿæ‰¾å‡ºé”ç­‰å¾…
SELECT 
    waiting_pid,
    waiting_query,
    blocking_pid,
    blocking_query,
    wait_time
FROM sys.innodb_lock_waits;

-- 3. å¿«é€Ÿæ£€æŸ¥ç´¢å¼•é—®é¢˜
SELECT 
    object_name,
    index_name,
    count_read,
    count_write
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = DATABASE()
  AND count_read = 0 
  AND count_write = 0;

-- 4. åº”æ€¥killé•¿äº‹åŠ¡ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
-- SELECT CONCAT('KILL ', id, ';') FROM information_schema.processlist WHERE time > 300;
```

**ğŸ›¡ï¸ **åº”æ€¥å›æ»šæ–¹æ¡ˆ**ï¼š
```bash
#!/bin/bash
# åº”æ€¥å›æ»šè„šæœ¬

# 1. åœæ­¢å½“å‰ç»´æŠ¤æ“ä½œ
mysql -e "KILL QUERY [process_id]"

# 2. æ¢å¤å¤‡ä»½ç´¢å¼•ï¼ˆå¦‚æœæœ‰ï¼‰
mysql your_database < /backup/indexes_backup_$(date +%Y%m%d).sql

# 3. é‡å¯MySQLæœåŠ¡ï¼ˆæœ€åæ‰‹æ®µï¼‰
# systemctl restart mysql

# 4. é€šçŸ¥ç›¸å…³äººå‘˜
echo "åº”æ€¥å›æ»šå®Œæˆï¼Œè¯·æ£€æŸ¥ç³»ç»ŸçŠ¶æ€" | mail -s "æ•°æ®åº“åº”æ€¥å›æ»šé€šçŸ¥" dba-team@company.com
```

---

## 12. ğŸ‘¥ å›¢é˜Ÿåä½œä¸æœ€ä½³å®è·µ


### 12.1 å›¢é˜Ÿåä½œè§„èŒƒ


**ğŸ‘¥ **è§’è‰²èŒè´£åˆ’åˆ†**ï¼š

| è§’è‰² | **ä¸»è¦èŒè´£** | **æƒé™èŒƒå›´** | **å€¼ç­è¦æ±‚** |
|------|-------------|-------------|-------------|
| ğŸ¯ **DBAä¸»ç®¡** | `åˆ¶å®šç»´æŠ¤ç­–ç•¥ï¼Œé‡å¤§å†³ç­–` | `æ‰€æœ‰æ•°æ®åº“æ“ä½œæƒé™` | `24å°æ—¶å¾…å‘½` |
| âš™ï¸ **è¿ç»´DBA** | `æ—¥å¸¸ç»´æŠ¤æ‰§è¡Œï¼Œç›‘æ§åˆ†æ` | `å¸¸è§„ç»´æŠ¤æ“ä½œæƒé™` | `å·¥ä½œæ—¶é—´å€¼ç­` |
| ğŸ” **å¼€å‘DBA** | `SQLä¼˜åŒ–ï¼Œç´¢å¼•è®¾è®¡å»ºè®®` | `æŸ¥è¯¢åˆ†ææƒé™` | `å¼€å‘æ—¶é—´æ”¯æŒ` |
| ğŸ“Š **æ•°æ®åˆ†æå¸ˆ** | `æ€§èƒ½åˆ†æï¼Œæ•ˆæœè¯„ä¼°` | `åªè¯»æŸ¥è¯¢æƒé™` | `æŒ‰éœ€å‚ä¸` |

**ğŸ”„ **åä½œå·¥ä½œæµ**ï¼š
```
ç»´æŠ¤ç”³è¯· â†’ DBAä¸»ç®¡å®¡æ‰¹ â†’ æ’æœŸå®‰æ’ â†’ æ‰§è¡Œç¡®è®¤ â†’ æ•ˆæœè¯„ä¼° â†’ è®°å½•å½’æ¡£

å…·ä½“æµç¨‹ï¼š
1. å¼€å‘å›¢é˜Ÿæäº¤ç»´æŠ¤éœ€æ±‚ 
2. DBAä¸»ç®¡è¯„ä¼°å½±å“å’Œå¿…è¦æ€§
3. è¿ç»´DBAå®‰æ’åˆ°ç»´æŠ¤æ—¥å†
4. æ‰§è¡Œå‰å¤šæ–¹ç¡®è®¤å‡†å¤‡å°±ç»ª
5. æŒ‰æ ‡å‡†æµç¨‹æ‰§è¡Œç»´æŠ¤
6. æ•°æ®åˆ†æå¸ˆè¯„ä¼°æ•ˆæœ
7. æ‰€æœ‰è®°å½•å­˜æ¡£å¤‡æŸ¥
```

### 12.2 æœ€ä½³å®è·µæ€»ç»“


**ğŸ† **ç»´æŠ¤æœ€ä½³å®è·µ**ï¼š

**ğŸ”¸ **é¢„é˜²æ€§ç»´æŠ¤åŸåˆ™**ï¼š
```
â€¢ å®šæœŸèƒœè¿‡åº”æ€¥ï¼šæŒ‰è®¡åˆ’ç»´æŠ¤æ¯”ä¸´æ—¶æ•‘ç«æ•ˆæœå¥½
â€¢ å°æ­¥å¿«è·‘ï¼šå¤šæ¬¡å°ç»´æŠ¤æ¯”ä¸€æ¬¡å¤§ç»´æŠ¤é£é™©ä½
â€¢ ç›‘æ§å…ˆè¡Œï¼šé—®é¢˜å‘ç°è¶Šæ—©ï¼Œå¤„ç†æˆæœ¬è¶Šä½
â€¢ è‡ªåŠ¨åŒ–ä¼˜å…ˆï¼šå‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜æ•ˆç‡
```

**ğŸ”¸ **å®‰å…¨æ€§ä¿éšœåŸåˆ™**ï¼š
```
â€¢ å¤‡ä»½å¿…é¡»ï¼šä»»ä½•ç»´æŠ¤å‰éƒ½è¦ç¡®ä¿æœ‰å¯ç”¨å¤‡ä»½
â€¢ æµ‹è¯•å…ˆè¡Œï¼šåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ç»´æŠ¤æ“ä½œ
â€¢ å›æ»šå‡†å¤‡ï¼šå‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
â€¢ å½±å“æœ€å°ï¼šé€‰æ‹©å¯¹ä¸šåŠ¡å½±å“æœ€å°çš„æ—¶é—´å’Œæ–¹å¼
```

**ğŸ”¸ **æ•ˆç‡æå‡æŠ€å·§**ï¼š
```
ğŸ’¡ **æ‰¹é‡å¤„ç†**ï¼š
â€¢ åŒç±»æ“ä½œé›†ä¸­å¤„ç†ï¼Œå‡å°‘ç»´æŠ¤çª—å£æ¬¡æ•°
â€¢ ç›¸å…³è¡¨åŒæ—¶ç»´æŠ¤ï¼Œé¿å…é‡å¤å½±å“

ğŸ’¡ **å¹¶è¡Œæ‰§è¡Œ**ï¼š  
â€¢ ç‹¬ç«‹è¡¨å¯ä»¥å¹¶è¡Œç»´æŠ¤ï¼Œç¼©çŸ­æ€»æ—¶é—´
â€¢ è¯»å†™åˆ†ç¦»æ¶æ„ä¸‹ï¼Œå¯ä»¥å…ˆç»´æŠ¤ä»åº“

ğŸ’¡ **å¢é‡ç»´æŠ¤**ï¼š
â€¢ åªå¤„ç†ç¡®å®éœ€è¦ç»´æŠ¤çš„è¡¨
â€¢ æ ¹æ®å˜åŒ–é¢‘ç‡è°ƒæ•´ç»´æŠ¤é¢‘ç‡
```

**ğŸ“š **çŸ¥è¯†ç®¡ç†å®è·µ**ï¼š
```
ğŸ”— **çŸ¥è¯†ç§¯ç´¯**ï¼š
â€¢ ç»´æŠ¤ç»éªŒæ–‡æ¡£åŒ–
â€¢ é—®é¢˜è§£å†³æ–¹æ¡ˆåº“
â€¢ æœ€ä½³å®è·µæ¡ˆä¾‹é›†

ğŸ”— **å›¢é˜ŸåŸ¹è®­**ï¼š
â€¢ å®šæœŸæŠ€æœ¯åˆ†äº«ä¼š
â€¢ æ–°äººå¯¼å¸ˆåˆ¶åº¦  
â€¢ åº”æ€¥æ¼”ç»ƒè®­ç»ƒ

ğŸ”— **å·¥å…·å»ºè®¾**ï¼š
â€¢ ç»´æŠ¤è„šæœ¬æ ‡å‡†åŒ–
â€¢ ç›‘æ§å·¥å…·ä¼˜åŒ–
â€¢ è‡ªåŠ¨åŒ–ç¨‹åº¦æå‡
```

**âš ï¸ **å¸¸è§é™·é˜±é¿å…**ï¼š
```
âŒ é¿å…çš„é”™è¯¯åšæ³•ï¼š
â€¢ æ²¡æœ‰å¤‡ä»½å°±å¼€å§‹ç»´æŠ¤
â€¢ åœ¨ä¸šåŠ¡é«˜å³°æœŸè¿›è¡Œé‡å‹ç»´æŠ¤
â€¢ ä¸€æ¬¡æ€§å¤„ç†è¿‡å¤šè¡¨
â€¢ å¿½ç•¥ç»´æŠ¤åçš„æ•ˆæœéªŒè¯
â€¢ ç¼ºä¹å›æ»šé¢„æ¡ˆ

âœ… æ¨èçš„æ­£ç¡®åšæ³•ï¼š
â€¢ ç»´æŠ¤å‰å……åˆ†å‡†å¤‡å’Œæµ‹è¯•
â€¢ é€‰æ‹©åˆé€‚çš„ç»´æŠ¤çª—å£
â€¢ åˆ†æ‰¹åˆ†é˜¶æ®µæ‰§è¡Œ
â€¢ å®æ—¶ç›‘æ§ç»´æŠ¤è¿‡ç¨‹  
â€¢ ç»´æŠ¤ååŠæ—¶éªŒè¯æ•ˆæœ
```

---

## 13. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŒæ¡çš„å…³é”®æ¦‚å¿µ


```
ğŸ”¸ **ç´¢å¼•ç»´æŠ¤æœ¬è´¨**ï¼šé¢„é˜²æ€§ç®¡ç†ï¼Œä¿æŒæ•°æ®åº“æœ€ä½³æ€§èƒ½çŠ¶æ€
ğŸ”¸ **ç»´æŠ¤è®¡åˆ’é‡è¦æ€§**ï¼šç³»ç»ŸåŒ–ç®¡ç†æ¯”ä¸´æ—¶æ•‘ç«æ•ˆæœå¥½ç™¾å€
ğŸ”¸ **ç›‘æ§ä½“ç³»ä»·å€¼**ï¼šæ—©å‘ç°æ—©å¤„ç†ï¼Œé¿å…å°é—®é¢˜å˜å¤§æ•…éšœ
ğŸ”¸ **æ ‡å‡†åŒ–æµç¨‹**ï¼šè§„èŒƒæ“ä½œå‡å°‘é£é™©ï¼Œæé«˜ç»´æŠ¤æˆåŠŸç‡
ğŸ”¸ **å›¢é˜Ÿåä½œå¿…è¦æ€§**ï¼šå¤æ‚ç»´æŠ¤éœ€è¦å¤šè§’è‰²é…åˆå®Œæˆ
```

### 13.2 å®ç”¨æ“ä½œè¦ç‚¹


**ğŸ¯ **æ—¥å¸¸æ“ä½œé‡ç‚¹**ï¼š
```
æ¯æ—¥å¿…æŸ¥ï¼š
âœ… æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ
âœ… ç´¢å¼•ä½¿ç”¨æƒ…å†µæ£€æŸ¥  
âœ… ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ç›‘æ§
âœ… å¼‚å¸¸å‘Šè­¦åŠæ—¶å¤„ç†

æ¯å‘¨å¿…åšï¼š
âœ… ç´¢å¼•ç¢ç‰‡ç‡ç»Ÿè®¡
âœ… ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
âœ… ç»´æŠ¤è®¡åˆ’æ‰§è¡Œ
âœ… æ€§èƒ½è¶‹åŠ¿åˆ†æ

æ¯æœˆå¿…è¯„ï¼š
âœ… ç»´æŠ¤æ•ˆæœè¯„ä¼°
âœ… ç»´æŠ¤ç­–ç•¥è°ƒæ•´
âœ… å›¢é˜ŸåŸ¹è®­äº¤æµ
âœ… å·¥å…·ä¼˜åŒ–æ”¹è¿›
```

**ğŸ”§ **å®æ–½å»ºè®®ä¼˜å…ˆçº§**ï¼š

| ä¼˜å…ˆçº§ | **å®æ–½å†…å®¹** | **é¢„æœŸæ•ˆæœ** | **å®æ–½éš¾åº¦** |
|--------|-------------|-------------|-------------|
| â­â­â­ **é«˜ä¼˜å…ˆçº§** | `å»ºç«‹ç›‘æ§å‘Šè­¦` | `åŠæ—¶å‘ç°é—®é¢˜` | `ç®€å•` |
| â­â­ **ä¸­ä¼˜å…ˆçº§** | `åˆ¶å®šç»´æŠ¤è®¡åˆ’` | `ç³»ç»ŸåŒ–ç®¡ç†` | `ä¸­ç­‰` |
| â­ **ä½ä¼˜å…ˆçº§** | `å¼€å‘è‡ªåŠ¨åŒ–è„šæœ¬` | `æå‡æ•ˆç‡` | `å¤æ‚` |

### 13.3 æˆåŠŸå®æ–½è·¯å¾„


**ğŸ›¤ï¸ **åˆ†é˜¶æ®µå®æ–½å»ºè®®**ï¼š

**é˜¶æ®µä¸€**ï¼ˆç¬¬1ä¸ªæœˆï¼‰ï¼šåŸºç¡€å»ºè®¾
```
ğŸ¯ ç›®æ ‡ï¼šå»ºç«‹åŸºæœ¬çš„ç›‘æ§å’Œè®°å½•ä½“ç³»
ğŸ“‹ ä»»åŠ¡ï¼š
â€¢ éƒ¨ç½²æ€§èƒ½ç›‘æ§å·¥å…·  
â€¢ å»ºç«‹ç»´æŠ¤è®°å½•è¡¨
â€¢ åˆ¶å®šåŸºç¡€ç»´æŠ¤è®¡åˆ’
â€¢ åŸ¹è®­å›¢é˜ŸåŸºæœ¬æŠ€èƒ½
```

**é˜¶æ®µäºŒ**ï¼ˆç¬¬2-3ä¸ªæœˆï¼‰ï¼šæµç¨‹ä¼˜åŒ–
```
ğŸ¯ ç›®æ ‡ï¼šå®Œå–„ç»´æŠ¤æµç¨‹å’Œè‡ªåŠ¨åŒ–ç¨‹åº¦
ğŸ“‹ ä»»åŠ¡ï¼š
â€¢ å¼€å‘å¸¸ç”¨ç»´æŠ¤è„šæœ¬
â€¢ å»ºç«‹åº”æ€¥å“åº”æœºåˆ¶
â€¢ ä¼˜åŒ–ç»´æŠ¤çª—å£å®‰æ’
â€¢ å®æ–½æ•ˆæœè¯„ä¼°ä½“ç³»
```

**é˜¶æ®µä¸‰**ï¼ˆç¬¬4-6ä¸ªæœˆï¼‰ï¼šæ·±åº¦ä¼˜åŒ–
```
ğŸ¯ ç›®æ ‡ï¼šè¾¾åˆ°é«˜åº¦è‡ªåŠ¨åŒ–å’Œé¢„æµ‹æ€§ç»´æŠ¤
ğŸ“‹ ä»»åŠ¡ï¼š
â€¢ å®ç°æ™ºèƒ½ç›‘æ§å‘Šè­¦
â€¢ å»ºç«‹é¢„æµ‹æ€§ç»´æŠ¤æ¨¡å‹
â€¢ å®Œå–„å›¢é˜Ÿåä½œæœºåˆ¶
â€¢ æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›
```

**ğŸ’¡ **å®ç”¨è®°å¿†å£è¯€**ï¼š
```
"ç›‘æ§å…ˆè¡Œæ—©å‘ç°ï¼Œè®¡åˆ’ç»´æŠ¤æ•ˆæœä½³
æ ‡å‡†æµç¨‹å‡é£é™©ï¼Œå›¢é˜Ÿåä½œå…±æˆé•¿
å¤‡ä»½æµ‹è¯•ä¸èƒ½å°‘ï¼Œå›æ»šé¢„æ¡ˆè¦å‘¨åˆ°"
```

**ğŸ”— **å…³é”®æˆåŠŸå› ç´ **ï¼š
- **ç®¡ç†å±‚æ”¯æŒ**ï¼šè·å¾—è¶³å¤Ÿçš„èµ„æºå’Œæ—¶é—´æŠ•å…¥
- **å›¢é˜ŸæŠ€èƒ½**ï¼šç¡®ä¿å›¢é˜Ÿå…·å¤‡å¿…è¦çš„æŠ€æœ¯èƒ½åŠ›  
- **å·¥å…·æ”¯æŒ**ï¼šé€‰æ‹©åˆé€‚çš„ç›‘æ§å’Œç»´æŠ¤å·¥å…·
- **æŒç»­æ”¹è¿›**ï¼šæ ¹æ®å®é™…æ•ˆæœä¸æ–­ä¼˜åŒ–ç­–ç•¥

**æ ¸å¿ƒä»·å€¼å®ç°**ï¼šé€šè¿‡ç³»ç»ŸåŒ–çš„ç´¢å¼•ç»´æŠ¤ç®¡ç†ï¼Œå®ç°æ•°æ®åº“æ€§èƒ½çš„æŒç»­ä¼˜åŒ–ï¼Œä¸ºä¸šåŠ¡å‘å±•æä¾›ç¨³å®šå¯é çš„æ•°æ®æ”¯æ’‘ï¼ŒåŒæ—¶é™ä½è¿ç»´æˆæœ¬å’Œé£é™©ï¼