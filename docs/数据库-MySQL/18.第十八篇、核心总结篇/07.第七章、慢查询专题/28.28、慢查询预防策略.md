---
title: 28ã€æ…¢æŸ¥è¯¢é¢„é˜²ç­–ç•¥
---
## ğŸ“š ç›®å½•


1. [æ…¢æŸ¥è¯¢é¢„é˜²æ¦‚è¿°](#1-æ…¢æŸ¥è¯¢é¢„é˜²æ¦‚è¿°)
2. [å¼€å‘è§„èŒƒåˆ¶å®š](#2-å¼€å‘è§„èŒƒåˆ¶å®š)
3. [SQLå®¡æ ¸æµç¨‹å»ºç«‹](#3-SQLå®¡æ ¸æµç¨‹å»ºç«‹)
4. [æ€§èƒ½æµ‹è¯•ç­–ç•¥](#4-æ€§èƒ½æµ‹è¯•ç­–ç•¥)
5. [å®¹é‡è§„åˆ’æ–¹æ³•](#5-å®¹é‡è§„åˆ’æ–¹æ³•)
6. [æ¶æ„è®¾è®¡åŸåˆ™](#6-æ¶æ„è®¾è®¡åŸåˆ™)
7. [ä»£ç å®¡æŸ¥è¦ç‚¹](#7-ä»£ç å®¡æŸ¥è¦ç‚¹)
8. [ä¸Šçº¿å‰æ€§èƒ½éªŒè¯](#8-ä¸Šçº¿å‰æ€§èƒ½éªŒè¯)
9. [é¢„é˜²æ€§ç›‘æ§éƒ¨ç½²](#9-é¢„é˜²æ€§ç›‘æ§éƒ¨ç½²)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æ…¢æŸ¥è¯¢é¢„é˜²æ¦‚è¿°



### 1.1 ä¸ºä»€ä¹ˆè¦é¢„é˜²æ…¢æŸ¥è¯¢



**ğŸ”¸ é—®é¢˜çš„ä¸¥é‡æ€§**
```
æ•°æ®åº“æ…¢æŸ¥è¯¢å°±åƒèº«ä½“ç–¾ç—…ï¼š
â€¢ é¢„é˜² > æ²»ç–—ï¼šæå‰é¿å…æ¯”å‡ºç°åä¿®å¤å®¹æ˜“å¾—å¤š
â€¢ è¿é”ååº”ï¼šä¸€ä¸ªæ…¢æŸ¥è¯¢å¯èƒ½æ‹–å®æ•´ä¸ªç³»ç»Ÿ
â€¢ ç”¨æˆ·ä½“éªŒï¼šé¡µé¢å¡é¡¿ç›´æ¥å½±å“ç”¨æˆ·æ»¡æ„åº¦
â€¢ è¿ç»´æˆæœ¬ï¼šæ·±å¤œè¢«æ…¢æŸ¥è¯¢å‘Šè­¦å«é†’çš„ç—›è‹¦
```

**ğŸ’¡ é¢„é˜²çš„æ ¸å¿ƒæ€è·¯**
```
ä¼ ç»Ÿæ–¹å¼ï¼šå‡ºç°é—®é¢˜ â†’ åˆ†æå®šä½ â†’ ç´§æ€¥ä¼˜åŒ–
é¢„é˜²æ–¹å¼ï¼šè§„èŒƒåˆ¶å®š â†’ æµç¨‹æŠŠæ§ â†’ æå‰éªŒè¯ â†’ æŒç»­ç›‘æ§

å¥½æ¯”ï¼š
ä¼ ç»Ÿ = æˆ¿å­æ¼æ°´äº†å†ä¿®è¡¥ï¼ˆè¢«åŠ¨ï¼‰
é¢„é˜² = å»ºæˆ¿æ—¶å°±åšå¥½é˜²æ°´ï¼ˆä¸»åŠ¨ï¼‰
```

### 1.2 é¢„é˜²ç­–ç•¥æ€»è§ˆ



**ğŸ—ºï¸ é¢„é˜²ç­–ç•¥åœ°å›¾**
```
å¼€å‘é˜¶æ®µé¢„é˜²ï¼š
   â”œâ”€â”€ å¼€å‘è§„èŒƒ â†’ ä»æºå¤´æ§åˆ¶SQLè´¨é‡
   â”œâ”€â”€ ä»£ç å®¡æŸ¥ â†’ äººå·¥æŠŠå…³SQLæ€§èƒ½  
   â””â”€â”€ æ€§èƒ½æµ‹è¯• â†’ ä¸Šçº¿å‰éªŒè¯

è¿è¡Œé˜¶æ®µé¢„é˜²ï¼š
   â”œâ”€â”€ å®¹é‡è§„åˆ’ â†’ æå‰å‡†å¤‡ç¡¬ä»¶èµ„æº
   â”œâ”€â”€ æ¶æ„è®¾è®¡ â†’ åˆç†çš„ç³»ç»Ÿæ¶æ„
   â””â”€â”€ ç›‘æ§é¢„è­¦ â†’ åŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜

å…¨æµç¨‹è¦†ç›–ï¼š
å¼€å‘ â†’ æµ‹è¯• â†’ å®¡æŸ¥ â†’ ä¸Šçº¿ â†’ ç›‘æ§
```

---

## 2. ğŸ“ å¼€å‘è§„èŒƒåˆ¶å®š



### 2.1 SQLç¼–å†™è§„èŒƒ



**ğŸ”¸ è¡¨ç»“æ„è®¾è®¡è§„èŒƒ**
```sql
-- âœ… å¥½çš„è®¾è®¡
CREATE TABLE user_orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    order_time DATETIME NOT NULL,
    status TINYINT NOT NULL DEFAULT 0,
    amount DECIMAL(10,2) NOT NULL,
    
    -- é‡è¦ï¼šä¸ºæŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•
    INDEX idx_user_id (user_id),
    INDEX idx_order_time (order_time),
    INDEX idx_status (status)
);

-- âŒ ä¸å¥½çš„è®¾è®¡
CREATE TABLE bad_orders (
    id VARCHAR(100),  -- ä¸»é”®ç”¨å­—ç¬¦ä¸²ï¼Œæ€§èƒ½å·®
    user_info TEXT,   -- å¤§å­—æ®µï¼ŒæŸ¥è¯¢æ…¢
    data JSON         -- æ²¡æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢å…¨è¡¨æ‰«æ
);
```

**ğŸ’­ è®¾è®¡è§„èŒƒè§£é‡Š**
> **ä¸»é”®é€‰æ‹©**ï¼šç”¨è‡ªå¢æ•°å­—åšä¸»é”®ï¼Œæ¯”å­—ç¬¦ä¸²å¿«å¾ˆå¤š
> **å­—æ®µç±»å‹**ï¼šåˆé€‚çš„æ•°æ®ç±»å‹ï¼Œä¸è¦ç”¨TEXTå­˜å‚¨çŸ­æ–‡æœ¬
> **ç´¢å¼•è§„åˆ’**ï¼šå¸¸ç”¨æŸ¥è¯¢å­—æ®µéƒ½è¦æœ‰ç´¢å¼•

**ğŸ”¸ æŸ¥è¯¢è¯­å¥è§„èŒƒ**
```sql
-- âœ… è§„èŒƒçš„æŸ¥è¯¢
SELECT id, user_id, amount 
FROM user_orders 
WHERE user_id = 12345 
  AND order_time >= '2023-01-01'
  AND status = 1
LIMIT 10;

-- âŒ ä¸è§„èŒƒçš„æŸ¥è¯¢
SELECT * FROM user_orders 
WHERE YEAR(order_time) = 2023;  -- å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ
```

**ğŸ“‹ SQLç¼–å†™é»„é‡‘æ³•åˆ™**
```
1. SELECTæŒ‡å®šå­—æ®µï¼Œä¸ç”¨SELECT *
2. WHEREæ¡ä»¶èƒ½ç”¨ç´¢å¼•ï¼Œé¿å…å‡½æ•°åŒ…è£…
3. JOINæŸ¥è¯¢è¦æœ‰åˆé€‚çš„ç´¢å¼•
4. å¤§è¡¨æŸ¥è¯¢å¿…é¡»æœ‰LIMIT
5. é¿å…å­æŸ¥è¯¢ï¼Œä¼˜å…ˆç”¨JOIN
```

### 2.2 å‘½åè§„èŒƒ



**ğŸ·ï¸ ç»Ÿä¸€å‘½åçº¦å®š**
```sql
-- è¡¨åï¼šä¸šåŠ¡æ¨¡å—_å…·ä½“å«ä¹‰
user_orders     -- ç”¨æˆ·è®¢å•è¡¨
product_info    -- å•†å“ä¿¡æ¯è¡¨
order_items     -- è®¢å•æ˜ç»†è¡¨

-- å­—æ®µåï¼šå«ä¹‰æ¸…æ™°ï¼Œç±»å‹æ˜ç¡®
created_time    -- åˆ›å»ºæ—¶é—´
updated_at      -- æ›´æ–°æ—¶é—´  
is_deleted      -- åˆ é™¤æ ‡è®°ï¼ˆå¸ƒå°”å‹ï¼‰
order_status    -- è®¢å•çŠ¶æ€

-- ç´¢å¼•åï¼šidx_è¡¨å_å­—æ®µå
idx_user_orders_user_id
idx_product_info_category_id
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€å‘½å**
> å›¢é˜Ÿåˆä½œæ—¶ï¼Œå¤§å®¶ä¸€çœ‹å°±çŸ¥é“å­—æ®µå«ä¹‰ï¼Œå‡å°‘ç†è§£æˆæœ¬ã€‚è€Œä¸”ç´¢å¼•å‘½åè§„èŒƒï¼Œç»´æŠ¤æ—¶èƒ½å¿«é€Ÿå®šä½ã€‚

---

## 3. ğŸ” SQLå®¡æ ¸æµç¨‹å»ºç«‹



### 3.3 è‡ªåŠ¨åŒ–å®¡æ ¸å·¥å…·



**ğŸ¤– SQLå®¡æ ¸å·¥å…·å¯¹æ¯”**

| å·¥å…·åç§° | **ç±»å‹** | **ä¼˜ç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|----------|----------|-------------|
| `SQLAdvisor` | å¼€æºå·¥å…· | å…è´¹ï¼Œå¯å®šåˆ¶ | ä¸­å°å‹å›¢é˜Ÿ |
| `pt-query-digest` | Perconaå·¥å…· | åŠŸèƒ½å¼ºå¤§ | æ€§èƒ½åˆ†æ |
| `Yearning` | Webå¹³å° | ç•Œé¢å‹å¥½ | å›¢é˜Ÿåä½œ |
| `SQLE` | ä¼ä¸šçº§ | åŠŸèƒ½å…¨é¢ | å¤§å‹ä¼ä¸š |

**ğŸ”§ å®¡æ ¸å·¥å…·é…ç½®ç¤ºä¾‹**
```bash
# ä½¿ç”¨pt-query-digeståˆ†ææ…¢æŸ¥è¯¢

pt-query-digest \
  --filter '$event->{arg} =~ m/SELECT.*FROM.*WHERE.*/' \
  --report-format=query_report \
  slow.log

# è¾“å‡ºï¼šè‡ªåŠ¨åˆ†æå“ªäº›æŸ¥è¯¢æœ€è€—æ—¶

```

### 3.2 äººå·¥å®¡æ ¸è¦ç‚¹



**ğŸ‘€ ä»£ç Reviewæ£€æŸ¥æ¸…å•**
```markdown
# SQLå®¡æ ¸æ£€æŸ¥è¡¨



## åŸºç¡€æ£€æŸ¥ âœ…


- [ ] æ˜¯å¦ä½¿ç”¨SELECT *ï¼Ÿ
- [ ] WHEREæ¡ä»¶æ˜¯å¦æœ‰ç´¢å¼•æ”¯æŒï¼Ÿ
- [ ] å¤§è¡¨æŸ¥è¯¢æ˜¯å¦æœ‰LIMITï¼Ÿ
- [ ] JOINæ¡ä»¶æ˜¯å¦åˆç†ï¼Ÿ

## æ€§èƒ½æ£€æŸ¥ âš¡


- [ ] æ‰§è¡Œè®¡åˆ’æ˜¯å¦åˆç†ï¼Ÿ
- [ ] æ˜¯å¦å­˜åœ¨å…¨è¡¨æ‰«æï¼Ÿ
- [ ] ç´¢å¼•ä½¿ç”¨ç‡å¦‚ä½•ï¼Ÿ
- [ ] é¢„ä¼°æŸ¥è¯¢æ—¶é—´ï¼Ÿ

## ä¸šåŠ¡æ£€æŸ¥ ğŸ¯


- [ ] é€»è¾‘æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] è¾¹ç•Œæƒ…å†µæ˜¯å¦è€ƒè™‘ï¼Ÿ
- [ ] æ•°æ®é‡å¢é•¿åæ˜¯å¦è¿˜èƒ½æ­£å¸¸ï¼Ÿ
```

**ğŸ” å®é™…å®¡æ ¸æµç¨‹**
```
æ­¥éª¤1ï¼šå¼€å‘æäº¤SQL â†’ è‡ªåŠ¨å·¥å…·åˆç­›
æ­¥éª¤2ï¼šäººå·¥å®¡æ ¸ â†’ æ£€æŸ¥æ€§èƒ½å’Œé€»è¾‘
æ­¥éª¤3ï¼šæµ‹è¯•éªŒè¯ â†’ å®é™…ç¯å¢ƒæµ‹è¯•
æ­¥éª¤4ï¼šé€šè¿‡å®¡æ ¸ â†’ å…è®¸ä¸Šçº¿éƒ¨ç½²
```

---

## 4. ğŸ§ª æ€§èƒ½æµ‹è¯•ç­–ç•¥



### 4.1 æµ‹è¯•ç¯å¢ƒæ­å»º



**ğŸ—ï¸ æµ‹è¯•ç¯å¢ƒè¦æ±‚**
```
ç¡¬ä»¶é…ç½®ï¼š
â€¢ CPUï¼šç”Ÿäº§ç¯å¢ƒçš„70%ä»¥ä¸Š
â€¢ å†…å­˜ï¼šç”Ÿäº§ç¯å¢ƒçš„70%ä»¥ä¸Š  
â€¢ ç£ç›˜ï¼šSSDï¼ŒIOPSä¸ä½äºç”Ÿäº§ç¯å¢ƒ

æ•°æ®å‡†å¤‡ï¼š
â€¢ æ•°æ®é‡ï¼šç”Ÿäº§ç¯å¢ƒçš„å®Œæ•´æ•°æ®æˆ–ç­‰æ¯”ä¾‹æ ·æœ¬
â€¢ æ•°æ®åˆ†å¸ƒï¼šä¿æŒä¸ç”Ÿäº§ç¯å¢ƒç›¸ä¼¼çš„æ•°æ®ç‰¹å¾
â€¢ ç´¢å¼•çŠ¶æ€ï¼šä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´
```

**ğŸ’¡ ä¸ºä»€ä¹ˆè¦è¿™æ ·åš**
> æµ‹è¯•ç¯å¢ƒå¤ªç®€å•ï¼Œæµ‹ä¸å‡ºçœŸå®æ€§èƒ½é—®é¢˜ã€‚æ¯”å¦‚100ä¸‡æ•°æ®æ²¡é—®é¢˜ï¼Œ1000ä¸‡æ•°æ®å°±å¡æ­»äº†ã€‚

### 4.2 æ€§èƒ½æµ‹è¯•æ–¹æ³•



**âš¡ å•SQLæ€§èƒ½æµ‹è¯•**
```sql
-- å¼€å¯æŸ¥è¯¢åˆ†æ
SET profiling = 1;

-- æ‰§è¡Œå¾…æµ‹è¯•çš„SQL
SELECT * FROM user_orders 
WHERE user_id = 12345 
  AND order_time >= '2023-01-01';

-- æŸ¥çœ‹æ‰§è¡Œæ—¶é—´
SHOW PROFILES;

-- è¯¦ç»†åˆ†æ
SHOW PROFILE FOR QUERY 1;
```

**ğŸ“Š åŸºå‡†æµ‹è¯•å·¥å…·**
```bash
# ä½¿ç”¨mysqlslapè¿›è¡Œå‹åŠ›æµ‹è¯•

mysqlslap \
  --host=localhost \
  --user=test \
  --password=test \
  --concurrency=50 \  # 50ä¸ªå¹¶å‘è¿æ¥
  --iterations=10 \   # æ‰§è¡Œ10è½®
  --number-of-queries=1000 \  # æ€»å…±1000ä¸ªæŸ¥è¯¢
  --query="SELECT * FROM user_orders WHERE user_id = 12345"
```

**ğŸ¯ æ€§èƒ½åŸºå‡†è®¾å®š**
```
å“åº”æ—¶é—´åŸºå‡†ï¼š
â€¢ ç®€å•æŸ¥è¯¢ï¼š< 10ms
â€¢ å¤æ‚æŸ¥è¯¢ï¼š< 100ms  
â€¢ æŠ¥è¡¨æŸ¥è¯¢ï¼š< 1s
â€¢ æ•°æ®å¯¼å‡ºï¼š< 10s

å¹¶å‘èƒ½åŠ›åŸºå‡†ï¼š
â€¢ å•è¡¨æŸ¥è¯¢ï¼š500 QPS
â€¢ å¤šè¡¨JOINï¼š200 QPS
â€¢ å¤æ‚ç»Ÿè®¡ï¼š50 QPS
```

---

## 5. ğŸ“ å®¹é‡è§„åˆ’æ–¹æ³•



### 5.1 æ•°æ®å¢é•¿é¢„ä¼°



**ğŸ“ˆ æ•°æ®å¢é•¿åˆ†æ**
```
å†å²æ•°æ®åˆ†æï¼š
â€¢ æŸ¥çœ‹è¿‡å»6ä¸ªæœˆçš„æ•°æ®å¢é•¿è¶‹åŠ¿
â€¢ è®¡ç®—å¹³å‡æ¯æ—¥æ–°å¢æ•°æ®é‡
â€¢ åˆ†æä¸šåŠ¡å³°å€¼æ—¶æ®µçš„æ•°æ®ç‰¹å¾

æœªæ¥å¢é•¿é¢„æµ‹ï¼š
å½“å‰ï¼š100ä¸‡è®¢å•/æœˆ
é¢„æµ‹ï¼šä¸šåŠ¡å¢é•¿50%ï¼Œæ•°æ®é‡å¢é•¿1.5å€
è®¡ç®—ï¼š100ä¸‡ Ã— 1.5 = 150ä¸‡è®¢å•/æœˆ

å®‰å…¨ç³»æ•°ï¼š
é¢„ä¼°å®¹é‡ Ã— 2 = å®é™…å‡†å¤‡å®¹é‡
ï¼ˆä¸ºçªå‘å¢é•¿ç•™å‡ºç¼“å†²ç©ºé—´ï¼‰
```

**ğŸ”¢ å®¹é‡è®¡ç®—å®ä¾‹**
```sql
-- è®¡ç®—å•è¡¨ç©ºé—´å ç”¨
SELECT 
    table_name,
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size_MB'
FROM information_schema.tables 
WHERE table_schema = 'your_database';

-- é¢„ä¼°6ä¸ªæœˆåçš„ç©ºé—´éœ€æ±‚
-- å½“å‰100MBï¼Œæœˆå¢é•¿20MB
-- 6ä¸ªæœˆåï¼š100 + 20*6 = 220MB
-- å®‰å…¨ç³»æ•°2å€ï¼š440MB
```

### 5.2 ç¡¬ä»¶èµ„æºè§„åˆ’



**ğŸ–¥ï¸ æœåŠ¡å™¨é…ç½®è§„åˆ’**

| æ•°æ®è§„æ¨¡ | **CPUé…ç½®** | **å†…å­˜é…ç½®** | **å­˜å‚¨é…ç½®** | **é€‚ç”¨åœºæ™¯** |
|---------|------------|-------------|-------------|-------------|
| å°å‹ < 10GB | 4æ ¸ | 8GB | SSD 100GB | åˆåˆ›ä¸šåŠ¡ |
| ä¸­å‹ 10-100GB | 8æ ¸ | 16GB | SSD 500GB | æˆé•¿æœŸä¸šåŠ¡ |
| å¤§å‹ 100GB-1TB | 16æ ¸ | 32GB | SSD 2TB | æˆç†Ÿä¸šåŠ¡ |
| è¶…å¤§å‹ > 1TB | 32æ ¸+ | 64GB+ | SSD é›†ç¾¤ | å¤§å‹ä¼ä¸š |

**ğŸ’¡ é…ç½®é€‰æ‹©åŸåˆ™**
```
CPUï¼šè®¡ç®—å¯†é›†å‹æŸ¥è¯¢å¤š â†’ é€‰æ‹©é«˜é¢‘ç‡CPU
å†…å­˜ï¼šçƒ­æ•°æ®ç¼“å­˜ â†’ å†…å­˜è¶Šå¤§è¶Šå¥½
å­˜å‚¨ï¼šIOPSè¦æ±‚é«˜ â†’ å¿…é¡»ç”¨SSD
ç½‘ç»œï¼šä¸»ä»å¤åˆ¶ â†’ åƒå…†ç½‘ç»œèµ·æ­¥
```

---

## 6. ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™



### 6.1 è¯»å†™åˆ†ç¦»æ¶æ„



**ğŸ”„ è¯»å†™åˆ†ç¦»ç¤ºæ„å›¾**
```
åº”ç”¨å±‚
   â†“
è´Ÿè½½å‡è¡¡å™¨
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å†™æ“ä½œ(Master)      â”‚ â† æ‰€æœ‰INSERT/UPDATE/DELETE
â”‚   ä¸»æ•°æ®åº“æœåŠ¡å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ æ•°æ®åŒæ­¥
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è¯»æ“ä½œ(Slave)       â”‚ â† æ‰€æœ‰SELECTæŸ¥è¯¢
â”‚   ä»æ•°æ®åº“æœåŠ¡å™¨        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âœ… è¯»å†™åˆ†ç¦»çš„å¥½å¤„**
```
æ€§èƒ½æå‡ï¼š
â€¢ å†™æ“ä½œåœ¨ä¸»åº“ï¼Œè¯»æ“ä½œåœ¨ä»åº“
â€¢ å‡å°‘ä¸»åº“å‹åŠ›ï¼Œæå‡æ•´ä½“æ€§èƒ½
â€¢ å¯ä»¥é…ç½®å¤šä¸ªä»åº“ï¼Œè¿›ä¸€æ­¥åˆ†æ•£è¯»å‹åŠ›

é«˜å¯ç”¨ï¼š
â€¢ ä¸»åº“æ•…éšœæ—¶ï¼Œä»åº“å¯ä»¥å‡çº§ä¸ºä¸»åº“
â€¢ è¯»æœåŠ¡ä¸å—å†™æœåŠ¡å½±å“
```

### 6.2 åˆ†åº“åˆ†è¡¨ç­–ç•¥



**ğŸ“Š ä½•æ—¶éœ€è¦åˆ†åº“åˆ†è¡¨**
```
åˆ†è¡¨æ—¶æœºï¼š
â€¢ å•è¡¨æ•°æ®é‡ > 1000ä¸‡è¡Œ
â€¢ å•è¡¨æ–‡ä»¶å¤§å° > 10GB
â€¢ æŸ¥è¯¢å“åº”æ—¶é—´ > 1ç§’

åˆ†åº“æ—¶æœºï¼š
â€¢ å•åº“è¿æ¥æ•° > 1000
â€¢ å•åº“QPS > 2000
â€¢ å•åº“ç£ç›˜ä½¿ç”¨ç‡ > 80%
```

**ğŸ”€ åˆ†è¡¨ç­–ç•¥é€‰æ‹©**
```sql
-- æŒ‰æ—¶é—´åˆ†è¡¨ï¼ˆé€‚åˆæ—¥å¿—ç±»æ•°æ®ï¼‰
user_orders_202301
user_orders_202302
user_orders_202303

-- æŒ‰IDèŒƒå›´åˆ†è¡¨ï¼ˆé€‚åˆå‡åŒ€åˆ†å¸ƒæ•°æ®ï¼‰
user_orders_1    # user_id 1-100ä¸‡
user_orders_2    # user_id 100-200ä¸‡
user_orders_3    # user_id 200-300ä¸‡

-- æŒ‰å“ˆå¸Œåˆ†è¡¨ï¼ˆé€‚åˆéšæœºåˆ†å¸ƒï¼‰
user_orders_0    # user_id % 4 = 0
user_orders_1    # user_id % 4 = 1
user_orders_2    # user_id % 4 = 2
user_orders_3    # user_id % 4 = 3
```

**ğŸ’¡ åˆ†è¡¨æŸ¥è¯¢ç¤ºä¾‹**
```java
// åº”ç”¨å±‚è·¯ç”±é€»è¾‘
public String getTableName(Long userId) {
    // æŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†è¡¨
    int tableIndex = userId.hashCode() % 4;
    return "user_orders_" + tableIndex;
}

// æŸ¥è¯¢æ—¶åŠ¨æ€é€‰æ‹©è¡¨
String tableName = getTableName(userId);
String sql = "SELECT * FROM " + tableName + " WHERE user_id = ?";
```

---

## 7. ğŸ‘ï¸ ä»£ç å®¡æŸ¥è¦ç‚¹



### 7.1 ORMæ¡†æ¶å®¡æŸ¥



**ğŸ” MyBatiså®¡æŸ¥é‡ç‚¹**
```xml
<!-- âœ… å¥½çš„å†™æ³• -->
<select id="getUserOrders" resultType="Order">
    SELECT id, user_id, amount, order_time
    FROM user_orders 
    WHERE user_id = #{userId}
      AND order_time >= #{startTime}
    LIMIT #{pageSize}
</select>

<!-- âŒ ä¸å¥½çš„å†™æ³• -->
<select id="getBadOrders" resultType="Order">
    SELECT * FROM user_orders 
    WHERE YEAR(order_time) = #{year}  <!-- å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ -->
</select>
```

**âš ï¸ MyBatiså¸¸è§é™·é˜±**
```xml
<!-- é™·é˜±1ï¼šåŠ¨æ€SQLå¯¼è‡´ç´¢å¼•å¤±æ•ˆ -->
<select id="searchOrders">
    SELECT * FROM user_orders 
    <where>
        <if test="userId != null">
            AND user_id = #{userId}
        </if>
        <if test="status != null">
            AND status = #{status}
        </if>
    </where>
</select>
<!-- é—®é¢˜ï¼šä¸åŒæ¡ä»¶ç»„åˆå¯èƒ½æ— æ³•ä½¿ç”¨å¤åˆç´¢å¼• -->

<!-- è§£å†³æ–¹æ¡ˆï¼šä¸ºä¸åŒæŸ¥è¯¢åœºæ™¯åˆ›å»ºä¸“é—¨çš„SQL -->
<select id="searchByUserId">
    SELECT * FROM user_orders 
    WHERE user_id = #{userId}
</select>
<select id="searchByUserIdAndStatus">
    SELECT * FROM user_orders 
    WHERE user_id = #{userId} AND status = #{status}
</select>
```

### 7.2 JPA/Hibernateå®¡æŸ¥



**ğŸ” JPAæ€§èƒ½å®¡æŸ¥**
```java
// âœ… å¥½çš„å†™æ³•
@Query("SELECT o FROM Order o WHERE o.userId = :userId")
List<Order> findByUserId(@Param("userId") Long userId);

// âŒ ä¸å¥½çš„å†™æ³• - N+1æŸ¥è¯¢é—®é¢˜
@OneToMany(mappedBy = "order")
private List<OrderItem> items;  // æ‡’åŠ è½½å¯¼è‡´N+1æŸ¥è¯¢

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨fetch join
@Query("SELECT o FROM Order o LEFT JOIN FETCH o.items WHERE o.userId = :userId")
List<Order> findByUserIdWithItems(@Param("userId") Long userId);
```

**ğŸ“‹ JPAå®¡æŸ¥æ¸…å•**
```markdown
## JPAæ€§èƒ½æ£€æŸ¥


- [ ] æ˜¯å¦å­˜åœ¨N+1æŸ¥è¯¢é—®é¢˜ï¼Ÿ
- [ ] æ‡’åŠ è½½é…ç½®æ˜¯å¦åˆç†ï¼Ÿ
- [ ] æ‰¹é‡æ“ä½œæ˜¯å¦ä½¿ç”¨batchï¼Ÿ
- [ ] æŸ¥è¯¢æ˜¯å¦æŒ‡å®šäº†å…·ä½“å­—æ®µï¼Ÿ
- [ ] åˆ†é¡µæŸ¥è¯¢æ˜¯å¦æœ‰æ€»æ•°ç»Ÿè®¡ï¼Ÿ
```

---

## 8. âœ… ä¸Šçº¿å‰æ€§èƒ½éªŒè¯



### 8.1 é¢„å‘å¸ƒç¯å¢ƒæµ‹è¯•



**ğŸ­ é¢„å‘å¸ƒç¯å¢ƒç‰¹ç‚¹**
```
ç¯å¢ƒé…ç½®ï¼š
â€¢ ä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´çš„ç¡¬ä»¶é…ç½®
â€¢ ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒçš„çœŸå®æ•°æ®ï¼ˆè„±æ•åï¼‰
â€¢ ç›¸åŒçš„ç½‘ç»œç¯å¢ƒå’Œå®‰å…¨é…ç½®

æµ‹è¯•å†…å®¹ï¼š
â€¢ åŠŸèƒ½éªŒè¯ï¼šæ–°åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
â€¢ æ€§èƒ½éªŒè¯ï¼šæŸ¥è¯¢å“åº”æ—¶é—´æ˜¯å¦è¾¾æ ‡
â€¢ å‹åŠ›æµ‹è¯•ï¼šé«˜å¹¶å‘ä¸‹æ˜¯å¦ç¨³å®š
â€¢ å…¼å®¹æ€§æµ‹è¯•ï¼šæ˜¯å¦å½±å“ç°æœ‰åŠŸèƒ½
```

### 8.2 ç°åº¦å‘å¸ƒç­–ç•¥



**ğŸ”„ ç°åº¦å‘å¸ƒæµç¨‹**
```
é˜¶æ®µ1ï¼šå†…éƒ¨éªŒè¯ï¼ˆ5%æµé‡ï¼‰
   â†“ è§‚å¯Ÿ24å°æ—¶ï¼Œæ— å¼‚å¸¸ç»§ç»­
é˜¶æ®µ2ï¼šå°èŒƒå›´éªŒè¯ï¼ˆ20%æµé‡ï¼‰  
   â†“ è§‚å¯Ÿ48å°æ—¶ï¼Œæ€§èƒ½ç¨³å®šç»§ç»­
é˜¶æ®µ3ï¼šå¤§èŒƒå›´éªŒè¯ï¼ˆ50%æµé‡ï¼‰
   â†“ è§‚å¯Ÿ72å°æ—¶ï¼Œå„é¡¹æŒ‡æ ‡æ­£å¸¸
é˜¶æ®µ4ï¼šå…¨é‡å‘å¸ƒï¼ˆ100%æµé‡ï¼‰
```

**ğŸ“Š ç°åº¦ç›‘æ§æŒ‡æ ‡**
```sql
-- ç›‘æ§æŸ¥è¯¢å“åº”æ—¶é—´
SELECT 
    ROUND(AVG(query_time), 4) as avg_time,
    COUNT(*) as query_count
FROM mysql.slow_log 
WHERE start_time >= NOW() - INTERVAL 1 HOUR
GROUP BY DATE_FORMAT(start_time, '%Y-%m-%d %H');

-- ç›‘æ§è¿æ¥æ•°å˜åŒ–
SHOW STATUS LIKE 'Threads_connected';

-- ç›‘æ§ç¼“å†²æ± å‘½ä¸­ç‡
SHOW STATUS LIKE 'Innodb_buffer_pool_read%';
```

---

## 9. ğŸ“ˆ é¢„é˜²æ€§ç›‘æ§éƒ¨ç½²



### 9.1 å…³é”®æŒ‡æ ‡ç›‘æ§



**âš¡ æ€§èƒ½æŒ‡æ ‡ç›‘æ§**
```bash
# ç›‘æ§æ…¢æŸ¥è¯¢æ•°é‡

mysql> SHOW STATUS LIKE 'Slow_queries';

# ç›‘æ§QPSï¼ˆæ¯ç§’æŸ¥è¯¢æ•°ï¼‰

mysql> SHOW STATUS LIKE 'Questions';

# ç›‘æ§è¿æ¥æ•°

mysql> SHOW STATUS LIKE 'Threads_connected';

# ç›‘æ§é”ç­‰å¾…

mysql> SHOW STATUS LIKE 'Table_locks_waited';
```

**ğŸ¯ ç›‘æ§é˜ˆå€¼è®¾å®š**
```yaml
# Prometheusç›‘æ§é…ç½®ç¤ºä¾‹

groups:
  - name: mysql_performance
    rules:
      - alert: SlowQueryHigh
        expr: increase(mysql_slow_queries[5m]) > 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "æ…¢æŸ¥è¯¢æ•°é‡å¼‚å¸¸å¢åŠ "
          
      - alert: ConnectionHigh  
        expr: mysql_threads_connected > 80
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜"
```

### 9.2 é¢„è­¦æœºåˆ¶è®¾è®¡



**ğŸš¨ å¤šå±‚æ¬¡é¢„è­¦ä½“ç³»**
```
ç¬¬ä¸€å±‚ï¼šæŒ‡æ ‡é¢„è­¦
â€¢ æ…¢æŸ¥è¯¢æ•°é‡ > 10/åˆ†é’Ÿ â†’ é»„è‰²å‘Šè­¦
â€¢ å¹³å‡å“åº”æ—¶é—´ > 1ç§’ â†’ æ©™è‰²å‘Šè­¦
â€¢ è¿æ¥æ•° > 80% â†’ çº¢è‰²å‘Šè­¦

ç¬¬äºŒå±‚ï¼šè¶‹åŠ¿é¢„è­¦  
â€¢ æ…¢æŸ¥è¯¢å¢é•¿ç‡ > 50% â†’ é¢„æµ‹æ€§å‘Šè­¦
â€¢ ç£ç›˜ä½¿ç”¨å¢é•¿è¿‡å¿« â†’ å®¹é‡å‘Šè­¦

ç¬¬ä¸‰å±‚ï¼šä¸šåŠ¡é¢„è­¦
â€¢ è®¢å•å¤„ç†æ—¶é—´å¼‚å¸¸ â†’ ä¸šåŠ¡å½±å“å‘Šè­¦
â€¢ ç”¨æˆ·æŠ•è¯‰å¢åŠ  â†’ ä½“éªŒå½±å“å‘Šè­¦
```

**ğŸ“± å‘Šè­¦é€šçŸ¥é…ç½®**
```json
{
  "alert_channels": {
    "warning": ["email", "é’‰é’‰ç¾¤"],
    "critical": ["ç”µè¯", "çŸ­ä¿¡", "å¾®ä¿¡"],
    "emergency": ["ç”µè¯è½®å‘¼", "å‡çº§åˆ°è´Ÿè´£äºº"]
  },
  "working_hours": {
    "normal": "09:00-18:00",
    "on_call": "18:00-09:00"
  },
  "escalation": {
    "level1": "å¼€å‘å·¥ç¨‹å¸ˆ",
    "level2": "æŠ€æœ¯è´Ÿè´£äºº", 
    "level3": "CTO"
  }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“



### 10.1 é¢„é˜²ç­–ç•¥è®°å¿†å£è¯€



```
ğŸ¯ æ…¢æŸ¥è¯¢é¢„é˜²å…«å­—è¯€ï¼š
è§„èŒƒå…ˆè¡Œï¼Œæµç¨‹æŠŠå…³ï¼Œæµ‹è¯•éªŒè¯ï¼Œç›‘æ§é¢„è­¦

ğŸ“ è¯¦ç»†è§£é‡Šï¼š
â€¢ è§„èŒƒå…ˆè¡Œï¼šåˆ¶å®šå¼€å‘è§„èŒƒï¼Œä»æºå¤´æ§åˆ¶
â€¢ æµç¨‹æŠŠå…³ï¼šå»ºç«‹å®¡æ ¸æœºåˆ¶ï¼Œäººå·¥+å·¥å…·åŒé‡ä¿éšœ  
â€¢ æµ‹è¯•éªŒè¯ï¼šä¸Šçº¿å‰å……åˆ†æµ‹è¯•ï¼Œå‘ç°é—®é¢˜æå‰è§£å†³
â€¢ ç›‘æ§é¢„è­¦ï¼šè¿è¡Œæ—¶æŒç»­ç›‘æ§ï¼Œé—®é¢˜æ—©å‘ç°æ—©å¤„ç†
```

### 10.2 å„é˜¶æ®µé‡ç‚¹æ£€æŸ¥é¡¹



**ğŸ”¸ å¼€å‘é˜¶æ®µé‡ç‚¹**
```
âœ… SQLç¼–å†™è§„èŒƒéµå¾ª
âœ… ç´¢å¼•è®¾è®¡åˆç†æ€§
âœ… æ•°æ®ç±»å‹é€‰æ‹©æ­£ç¡®
âœ… æŸ¥è¯¢é€»è¾‘ä¼˜åŒ–
```

**ğŸ”¸ å®¡æ ¸é˜¶æ®µé‡ç‚¹**
```  
âœ… è‡ªåŠ¨åŒ–å·¥å…·æ£€æŸ¥
âœ… äººå·¥ä»£ç å®¡æŸ¥
âœ… æ‰§è¡Œè®¡åˆ’åˆ†æ
âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
```

**ğŸ”¸ ä¸Šçº¿é˜¶æ®µé‡ç‚¹**
```
âœ… é¢„å‘å¸ƒç¯å¢ƒéªŒè¯
âœ… ç°åº¦å‘å¸ƒç­–ç•¥
âœ… å›æ»šé¢„æ¡ˆå‡†å¤‡
âœ… ç›‘æ§æŒ‡æ ‡æ­£å¸¸
```

**ğŸ”¸ è¿è¡Œé˜¶æ®µé‡ç‚¹**
```
âœ… å…³é”®æŒ‡æ ‡ç›‘æ§
âœ… é¢„è­¦æœºåˆ¶æœ‰æ•ˆ
âœ… å®šæœŸæ€§èƒ½æ£€æŸ¥
âœ… å®¹é‡è§„åˆ’è°ƒæ•´
```

### 10.3 å®æ–½å»ºè®®



**ğŸš€ åˆ†é˜¶æ®µå®æ–½è·¯å¾„**
```
ç¬¬ä¸€é˜¶æ®µï¼ˆåŸºç¡€å»ºè®¾ï¼‰ï¼š
â€¢ åˆ¶å®šSQLå¼€å‘è§„èŒƒ
â€¢ æ­å»ºåŸºç¡€ç›‘æ§
â€¢ å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹

ç¬¬äºŒé˜¶æ®µï¼ˆå·¥å…·å®Œå–„ï¼‰ï¼š
â€¢ éƒ¨ç½²è‡ªåŠ¨åŒ–å®¡æ ¸å·¥å…·
â€¢ å®Œå–„æµ‹è¯•ç¯å¢ƒ
â€¢ å»ºç«‹æ€§èƒ½åŸºå‡†

ç¬¬ä¸‰é˜¶æ®µï¼ˆæµç¨‹ä¼˜åŒ–ï¼‰ï¼š
â€¢ å®æ–½ç°åº¦å‘å¸ƒ
â€¢ ä¼˜åŒ–é¢„è­¦æœºåˆ¶  
â€¢ å»ºç«‹å®¹é‡è§„åˆ’æµç¨‹

ç¬¬å››é˜¶æ®µï¼ˆæŒç»­æ”¹è¿›ï¼‰ï¼š
â€¢ åˆ†æå†å²é—®é¢˜
â€¢ ä¼˜åŒ–é¢„é˜²ç­–ç•¥
â€¢ å»ºç«‹æœ€ä½³å®è·µåº“
```

**ğŸ’¡ æˆåŠŸå®æ–½å…³é”®å› ç´ **
```
æŠ€æœ¯å› ç´ ï¼š
â€¢ å·¥å…·é“¾å®Œæ•´æ€§
â€¢ ç›‘æ§è¦†ç›–ç‡
â€¢ è‡ªåŠ¨åŒ–ç¨‹åº¦

ç®¡ç†å› ç´ ï¼š  
â€¢ å›¢é˜Ÿæ‰§è¡ŒåŠ›
â€¢ æµç¨‹è§„èŒƒæ€§
â€¢ æŒç»­æ”¹è¿›æ„è¯†

æ–‡åŒ–å› ç´ ï¼š
â€¢ è´¨é‡ä¼˜å…ˆç†å¿µ
â€¢ é¢„é˜²èƒœäºæ²»ç–—
â€¢ å›¢é˜Ÿåä½œç²¾ç¥
```

### 10.4 é¢„é˜²æ•ˆæœè¯„ä¼°



**ğŸ“Š æ•ˆæœè¯„ä¼°æŒ‡æ ‡**
```
çŸ­æœŸæŒ‡æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰ï¼š
â€¢ æ…¢æŸ¥è¯¢æ•°é‡ä¸‹é™ > 50%
â€¢ çº¿ä¸Šæ€§èƒ½é—®é¢˜å‡å°‘ > 80%
â€¢ ç´§æ€¥ä¿®å¤æ¬¡æ•°å‡å°‘ > 70%

ä¸­æœŸæŒ‡æ ‡ï¼ˆ3-6ä¸ªæœˆï¼‰ï¼š
â€¢ ç³»ç»Ÿç¨³å®šæ€§æå‡
â€¢ ç”¨æˆ·æŠ•è¯‰å‡å°‘
â€¢ è¿ç»´å·¥ä½œé‡é™ä½

é•¿æœŸæŒ‡æ ‡ï¼ˆ6-12ä¸ªæœˆï¼‰ï¼š
â€¢ æŠ€æœ¯å€ºåŠ¡å‡å°‘
â€¢ å¼€å‘æ•ˆç‡æå‡
â€¢ ç³»ç»Ÿå¯æ‰©å±•æ€§å¢å¼º
```

**ğŸ† æœ€ç»ˆç›®æ ‡**
```
æŠ€æœ¯ç›®æ ‡ï¼š
â€¢ 99.9%çš„æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
â€¢ æ…¢æŸ¥è¯¢å æ¯” < 0.1%
â€¢ ç³»ç»Ÿå¯ç”¨æ€§ > 99.95%

ä¸šåŠ¡ç›®æ ‡ï¼š
â€¢ ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡
â€¢ è¿ç»´æˆæœ¬å¤§å¹…é™ä½
â€¢ ä¸šåŠ¡æ‰©å±•èƒ½åŠ›å¢å¼º
```

**ğŸ’ª æŒç»­æ”¹è¿›å»ºè®®**
```
å®šæœŸå›é¡¾ï¼š
â€¢ æ¯æœˆåˆ†æé¢„é˜²æ•ˆæœ
â€¢ æ€»ç»“ç»éªŒæ•™è®­
â€¢ ä¼˜åŒ–é¢„é˜²ç­–ç•¥

çŸ¥è¯†æ²‰æ·€ï¼š
â€¢ å»ºç«‹é—®é¢˜æ¡ˆä¾‹åº“
â€¢ åˆ¶å®šæœ€ä½³å®è·µæ–‡æ¡£
â€¢ å¼€å±•æŠ€æœ¯åˆ†äº«

å›¢é˜Ÿå»ºè®¾ï¼š
â€¢ æå‡å›¢é˜ŸæŠ€èƒ½
â€¢ åŸ¹å…»è´¨é‡æ„è¯†
â€¢ å»ºç«‹æ¿€åŠ±æœºåˆ¶
```

---

**æ ¸å¿ƒè®°å¿†**ï¼š
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œè§„èŒƒå…ˆäºå¼€å‘
- å¤šå±‚æ¬¡æŠŠå…³ï¼Œå·¥å…·äººå·¥ç»“åˆ
- æµ‹è¯•éªŒè¯å……åˆ†ï¼Œç›‘æ§é¢„è­¦åŠæ—¶
- æŒç»­æ”¹è¿›ä¼˜åŒ–ï¼Œå½¢æˆè‰¯æ€§å¾ªç¯