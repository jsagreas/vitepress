---
title: 20ã€ç´¢å¼•ä¼˜åŒ–ç­–ç•¥å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [ç´¢å¼•åŸºç¡€æ¦‚å¿µç†è§£](#1-ç´¢å¼•åŸºç¡€æ¦‚å¿µç†è§£)
2. [å•åˆ—ç´¢å¼•åˆ›å»ºç­–ç•¥](#2-å•åˆ—ç´¢å¼•åˆ›å»ºç­–ç•¥)
3. [å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™](#3-å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™)
4. [å‰ç¼€ç´¢å¼•ä¸å‡½æ•°ç´¢å¼•](#4-å‰ç¼€ç´¢å¼•ä¸å‡½æ•°ç´¢å¼•)
5. [ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§](#5-ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç´¢å¼•åŸºç¡€æ¦‚å¿µç†è§£


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®åº“ç´¢å¼•


**é€šä¿—ç†è§£**ï¼šç´¢å¼•å°±åƒä¹¦çš„ç›®å½•ï¼Œå¸®ä½ å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å†…å®¹

```
æ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢ï¼š
å°±åƒåœ¨æ²¡æœ‰ç›®å½•çš„åšä¹¦ä¸­é€é¡µç¿»æ‰¾æŸä¸ªä¸»é¢˜
éœ€è¦ä»ç¬¬1é¡µç¿»åˆ°æœ€å1é¡µï¼Œæ•ˆç‡æä½

æœ‰äº†ç´¢å¼•çš„æŸ¥è¯¢ï¼š
å°±åƒé€šè¿‡ç›®å½•ç›´æ¥è·³è½¬åˆ°å¯¹åº”é¡µç 
å‡ ç§’é’Ÿå°±èƒ½æ‰¾åˆ°éœ€è¦çš„å†…å®¹
```

**ç´¢å¼•çš„æœ¬è´¨**ï¼š
- **æ•°æ®ç»“æ„**ï¼šB+æ ‘ç»“æ„ï¼Œä¸“é—¨ç”¨äºå¿«é€ŸæŸ¥æ‰¾
- **å­˜å‚¨æ–¹å¼**ï¼šå•ç‹¬å­˜å‚¨ï¼ŒæŒ‡å‘å®é™…æ•°æ®è¡Œ
- **å·¥ä½œåŸç†**ï¼šé€šè¿‡ç´¢å¼•é”®å¿«é€Ÿå®šä½åˆ°æ•°æ®ä½ç½®
- **ç©ºé—´ä»£ä»·**ï¼šéœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´ç»´æŠ¤ç´¢å¼•ç»“æ„

### 1.2 ç´¢å¼•çš„å·¥ä½œæœºåˆ¶


**æŸ¥è¯¢è¿‡ç¨‹å¯¹æ¯”**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ— ç´¢å¼•æŸ¥è¯¢                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT * FROM users WHERE age = 25;                     â”‚
â”‚                                                         â”‚
â”‚ æ‰§è¡Œè¿‡ç¨‹ï¼š                                               â”‚
â”‚ 1. ä»ç¬¬ä¸€è¡Œå¼€å§‹é€è¡Œæ‰«æ                                   â”‚
â”‚ 2. æ£€æŸ¥æ¯è¡Œçš„ageå­—æ®µæ˜¯å¦ç­‰äº25                           â”‚
â”‚ 3. æ‰«æå®Œæ•´å¼ è¡¨æ‰èƒ½ç¡®ä¿æ‰¾åˆ°æ‰€æœ‰åŒ¹é…è®°å½•                   â”‚
â”‚ 4. æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œnä¸ºè¡¨ä¸­è®°å½•æ•°                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœ‰ç´¢å¼•æŸ¥è¯¢                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT * FROM users WHERE age = 25;                     â”‚
â”‚ (å‡è®¾ageå­—æ®µæœ‰ç´¢å¼•)                                      â”‚
â”‚                                                         â”‚
â”‚ æ‰§è¡Œè¿‡ç¨‹ï¼š                                               â”‚
â”‚ 1. åœ¨ageç´¢å¼•ä¸­æŸ¥æ‰¾å€¼ä¸º25çš„æ¡ç›®                           â”‚
â”‚ 2. é€šè¿‡ç´¢å¼•ç›´æ¥å®šä½åˆ°å¯¹åº”çš„æ•°æ®è¡Œ                         â”‚
â”‚ 3. åªéœ€è¦è¯»å–åŒ¹é…çš„æ•°æ®è¡Œ                                â”‚
â”‚ 4. æ—¶é—´å¤æ‚åº¦ï¼šO(log n)ï¼Œæ•ˆç‡æå‡å·¨å¤§                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ç´¢å¼•ç±»å‹ç®€ä»‹


| ç´¢å¼•ç±»å‹ | **ç”¨é€”è¯´æ˜** | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½ç‰¹ç‚¹** |
|---------|-------------|-------------|-------------|
| **ä¸»é”®ç´¢å¼•** | `å”¯ä¸€æ ‡è¯†æ¯è¡Œæ•°æ®` | `ä¸»é”®å­—æ®µ` | `æŸ¥è¯¢æœ€å¿«ï¼Œè‡ªåŠ¨åˆ›å»º` |
| **å”¯ä¸€ç´¢å¼•** | `ç¡®ä¿å­—æ®µå€¼å”¯ä¸€æ€§` | `ç”¨æˆ·åã€é‚®ç®±ç­‰` | `æŸ¥è¯¢å¿«ï¼Œä¿è¯å”¯ä¸€` |
| **æ™®é€šç´¢å¼•** | `åŠ é€Ÿå¸¸è§„æŸ¥è¯¢` | `ç»å¸¸æŸ¥è¯¢çš„å­—æ®µ` | `å¹³è¡¡æŸ¥è¯¢å’Œå­˜å‚¨` |
| **å¤åˆç´¢å¼•** | `å¤šå­—æ®µç»„åˆæŸ¥è¯¢` | `å¤šæ¡ä»¶æŸ¥è¯¢` | `è¦†ç›–æŸ¥è¯¢æ•ˆæœæœ€ä½³` |
| **å‰ç¼€ç´¢å¼•** | `èŠ‚çœå­˜å‚¨ç©ºé—´` | `é•¿å­—ç¬¦ä¸²å­—æ®µ` | `ç©ºé—´å°ï¼ŒæŸ¥è¯¢ç¨æ…¢` |

---

## 2. ğŸ”§ å•åˆ—ç´¢å¼•åˆ›å»ºç­–ç•¥


### 2.1 åˆ›å»ºå•åˆ—ç´¢å¼•çš„æ—¶æœº


**ä½•æ—¶éœ€è¦åˆ›å»ºç´¢å¼•**ï¼š

```sql
-- âœ… ç»å¸¸ä½œä¸ºWHEREæ¡ä»¶çš„å­—æ®µ
SELECT * FROM orders WHERE customer_id = 12345;
-- å»ºè®®ï¼šåœ¨customer_idä¸Šåˆ›å»ºç´¢å¼•

-- âœ… ç»å¸¸ç”¨äºORDER BYçš„å­—æ®µ  
SELECT * FROM articles ORDER BY created_at DESC;
-- å»ºè®®ï¼šåœ¨created_atä¸Šåˆ›å»ºç´¢å¼•

-- âœ… ç»å¸¸ç”¨äºJOINè¿æ¥çš„å­—æ®µ
SELECT u.name, o.total 
FROM users u JOIN orders o ON u.id = o.user_id;
-- å»ºè®®ï¼šåœ¨user_idä¸Šåˆ›å»ºç´¢å¼•
```

**ä¸é€‚åˆåˆ›å»ºç´¢å¼•çš„æƒ…å†µ**ï¼š

```sql
-- âŒ å¾ˆå°‘æŸ¥è¯¢çš„å­—æ®µ
SELECT * FROM users WHERE middle_name = 'John';
-- å¦‚æœmiddle_nameæŸ¥è¯¢å¾ˆå°‘ï¼Œä¸å»ºè®®åˆ›å»ºç´¢å¼•

-- âŒ æ•°æ®å˜åŒ–é¢‘ç¹çš„å­—æ®µ
UPDATE users SET login_count = login_count + 1 WHERE id = 123;
-- login_counté¢‘ç¹æ›´æ–°ï¼Œç´¢å¼•ç»´æŠ¤æˆæœ¬é«˜

-- âŒ æ•°æ®é‡å¤åº¦å¾ˆé«˜çš„å­—æ®µ
SELECT * FROM users WHERE status = 'active';
-- å¦‚æœstatusåªæœ‰2-3ä¸ªå€¼ï¼Œç´¢å¼•æ•ˆæœä¸ä½³
```

### 2.2 ç´¢å¼•åˆ›å»ºè¯­æ³•ä¸å®è·µ


**åŸºç¡€åˆ›å»ºè¯­æ³•**ï¼š

```sql
-- åˆ›å»ºæ™®é€šç´¢å¼•
CREATE INDEX idx_customer_id ON orders(customer_id);

-- åˆ›å»ºå”¯ä¸€ç´¢å¼•  
CREATE UNIQUE INDEX idx_email ON users(email);

-- åœ¨åˆ›å»ºè¡¨æ—¶åŒæ—¶åˆ›å»ºç´¢å¼•
CREATE TABLE products (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    category_id INT,
    price DECIMAL(10,2),
    INDEX idx_category (category_id),
    INDEX idx_price (price)
);
```

**ç´¢å¼•å‘½åè§„èŒƒ**ï¼š

```sql
-- æ¨èçš„å‘½åè§„èŒƒ
idx_è¡¨å_å­—æ®µå     -- æ™®é€šç´¢å¼•
uk_è¡¨å_å­—æ®µå      -- å”¯ä¸€ç´¢å¼•  
pk_è¡¨å            -- ä¸»é”®ç´¢å¼•

-- å®é™…ç¤ºä¾‹
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE UNIQUE INDEX uk_users_email ON users(email);
```

### 2.3 å•åˆ—ç´¢å¼•ä¼˜åŒ–æŠ€å·§


**é€‰æ‹©æ€§åˆ†æ**ï¼š

```sql
-- æ£€æŸ¥å­—æ®µçš„é€‰æ‹©æ€§ï¼ˆä¸é‡å¤å€¼çš„æ¯”ä¾‹ï¼‰
SELECT 
    COUNT(DISTINCT customer_id) / COUNT(*) as selectivity,
    COUNT(DISTINCT customer_id) as unique_values,
    COUNT(*) as total_rows
FROM orders;

-- é€‰æ‹©æ€§è¶Šæ¥è¿‘1ï¼Œç´¢å¼•æ•ˆæœè¶Šå¥½
-- é€‰æ‹©æ€§ > 0.1 é€šå¸¸å€¼å¾—åˆ›å»ºç´¢å¼•
-- é€‰æ‹©æ€§ < 0.01 ç´¢å¼•æ•ˆæœä¸ä½³
```

**æ•°æ®ç±»å‹ä¼˜åŒ–**ï¼š

```sql
-- âœ… ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹
CREATE INDEX idx_user_id ON orders(user_id);  -- INTç±»å‹ï¼Œ4å­—èŠ‚
-- æ¯”VARCHAR(50)ç±»å‹çš„ç´¢å¼•è¦å¿«å¾—å¤š

-- âœ… é¿å…è¿‡é•¿çš„å­—ç¬¦ä¸²ç´¢å¼•
CREATE INDEX idx_title_prefix ON articles(title(50));  -- åªç´¢å¼•å‰50ä¸ªå­—ç¬¦
-- è€Œä¸æ˜¯æ•´ä¸ªtitleå­—æ®µ
```

---

## 3. âš–ï¸ å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™


### 3.1 å¤åˆç´¢å¼•åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¤åˆç´¢å¼•**ï¼š
å¤åˆç´¢å¼•æ˜¯åœ¨å¤šä¸ªå­—æ®µä¸Šåˆ›å»ºçš„ç´¢å¼•ï¼Œç›¸å½“äºæŒ‰å¤šä¸ªæ¡ä»¶æ’åºçš„ç”µè¯ç°¿

```
å•åˆ—ç´¢å¼•åƒæŒ‰å§“æ°æ’åºï¼š
å¼ ä¸‰ã€å¼ äº”ã€æå››ã€æå…­ã€ç‹äºŒã€ç‹ä¸ƒ

å¤åˆç´¢å¼•åƒæŒ‰å§“æ°+å¹´é¾„æ’åºï¼š
å¼ ä¸‰(25)ã€å¼ äº”(30)ã€æå››(20)ã€æå…­(35)ã€ç‹äºŒ(28)ã€ç‹ä¸ƒ(22)

æŸ¥æ‰¾"å§“æä¸”å¹´é¾„30ä»¥ä¸Š"æ—¶ï¼Œå¤åˆç´¢å¼•èƒ½å¿«é€Ÿå®šä½åˆ°èŒƒå›´
```

### 3.2 æœ€å·¦å‰ç¼€åŸåˆ™


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šå¤åˆç´¢å¼•åªæœ‰ä»æœ€å·¦è¾¹çš„å­—æ®µå¼€å§‹ä½¿ç”¨æ‰èƒ½ç”Ÿæ•ˆ

```sql
-- åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_name_age_city ON users(name, age, city);

-- âœ… èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE name = 'John';                    -- ä½¿ç”¨name
SELECT * FROM users WHERE name = 'John' AND age = 25;       -- ä½¿ç”¨name,age  
SELECT * FROM users WHERE name = 'John' AND age = 25 AND city = 'NYC';  -- ä½¿ç”¨name,age,city

-- âŒ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE age = 25;                         -- è·³è¿‡äº†name
SELECT * FROM users WHERE city = 'NYC';                     -- è·³è¿‡äº†name,age
SELECT * FROM users WHERE age = 25 AND city = 'NYC';        -- è·³è¿‡äº†name
```

**æœ€å·¦å‰ç¼€åŸåˆ™å›¾è§£**ï¼š

```
å¤åˆç´¢å¼• (name, age, city)ï¼š

å¯ç”¨æƒ…å†µï¼š
name âœ“
name + age âœ“  
name + age + city âœ“

ä¸å¯ç”¨æƒ…å†µï¼š
age âœ—
city âœ—
age + city âœ—
name + city âœ— (è·³è¿‡äº†age)
```

### 3.3 å­—æ®µé¡ºåºä¼˜åŒ–ç­–ç•¥


**é¡ºåºé€‰æ‹©åŸåˆ™**ï¼š

> **å£è¯€è®°å¿†**ï¼šç­‰å€¼åœ¨å‰ï¼ŒèŒƒå›´åœ¨åï¼Œé€‰æ‹©æ€§é«˜çš„åœ¨å‰

```sql
-- å‡è®¾æœ‰æŸ¥è¯¢ï¼š
SELECT * FROM orders 
WHERE status = 'shipped' 
AND created_at BETWEEN '2024-01-01' AND '2024-12-31'
AND customer_id = 12345;

-- åˆ†æå­—æ®µç‰¹å¾ï¼š
-- status: ç­‰å€¼æŸ¥è¯¢ï¼Œé€‰æ‹©æ€§ä¸­ç­‰ (shipped/pending/cancelled)
-- customer_id: ç­‰å€¼æŸ¥è¯¢ï¼Œé€‰æ‹©æ€§é«˜ (æ¯ä¸ªå®¢æˆ·å”¯ä¸€)  
-- created_at: èŒƒå›´æŸ¥è¯¢

-- âœ… æ¨èç´¢å¼•é¡ºåº
CREATE INDEX idx_orders_opt ON orders(customer_id, status, created_at);
-- åŸå› ï¼šé«˜é€‰æ‹©æ€§ç­‰å€¼ â†’ ä½é€‰æ‹©æ€§ç­‰å€¼ â†’ èŒƒå›´æŸ¥è¯¢
```

**å­—æ®µé¡ºåºå†³ç­–æµç¨‹**ï¼š

```
æ­¥éª¤1ï¼šè¯†åˆ«æŸ¥è¯¢ç±»å‹
â”œâ”€â”€ ç­‰å€¼æŸ¥è¯¢ (=)
â”œâ”€â”€ èŒƒå›´æŸ¥è¯¢ (>, <, BETWEEN)  
â””â”€â”€ æ’åºæŸ¥è¯¢ (ORDER BY)

æ­¥éª¤2ï¼šåˆ†æå­—æ®µé€‰æ‹©æ€§
â”œâ”€â”€ é«˜é€‰æ‹©æ€§ï¼šæ¥è¿‘å”¯ä¸€å€¼ (ç”¨æˆ·IDã€è®¢å•å·)
â”œâ”€â”€ ä¸­é€‰æ‹©æ€§ï¼šæœ‰ä¸€å®šåŒºåˆ†åº¦ (çŠ¶æ€ã€ç±»åˆ«)
â””â”€â”€ ä½é€‰æ‹©æ€§ï¼šé‡å¤å€¼å¾ˆå¤š (æ€§åˆ«ã€æ˜¯å¦åˆ é™¤)

æ­¥éª¤3ï¼šç¡®å®šé¡ºåº
1. é«˜é€‰æ‹©æ€§ç­‰å€¼æŸ¥è¯¢å­—æ®µ
2. ä½é€‰æ‹©æ€§ç­‰å€¼æŸ¥è¯¢å­—æ®µ  
3. èŒƒå›´æŸ¥è¯¢å­—æ®µ
4. æ’åºå­—æ®µ
```

### 3.4 å¤åˆç´¢å¼•å®æˆ˜æ¡ˆä¾‹


**ç”µå•†è®¢å•æŸ¥è¯¢ä¼˜åŒ–**ï¼š

```sql
-- å¸¸è§æŸ¥è¯¢æ¨¡å¼
SELECT * FROM orders 
WHERE customer_id = ? 
AND status = 'shipped' 
AND created_at >= '2024-01-01'
ORDER BY created_at DESC;

-- å­—æ®µåˆ†æ
-- customer_id: ç­‰å€¼ï¼Œé«˜é€‰æ‹©æ€§ (100ä¸‡ç”¨æˆ·)
-- status: ç­‰å€¼ï¼Œä½é€‰æ‹©æ€§ (5ç§çŠ¶æ€)  
-- created_at: èŒƒå›´+æ’åºï¼Œè¿ç»­å€¼

-- âœ… æœ€ä¼˜ç´¢å¼•è®¾è®¡
CREATE INDEX idx_orders_customer_status_time 
ON orders(customer_id, status, created_at);
```

**è¦†ç›–ç´¢å¼•ä¼˜åŒ–**ï¼š

```sql
-- å¦‚æœæŸ¥è¯¢åªéœ€è¦ç‰¹å®šå­—æ®µ
SELECT order_id, total, created_at 
FROM orders 
WHERE customer_id = ? AND status = 'shipped';

-- å¯ä»¥åˆ›å»ºè¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨æŸ¥è¯¢
CREATE INDEX idx_orders_covering 
ON orders(customer_id, status, order_id, total, created_at);

-- æŸ¥è¯¢æ—¶ç›´æ¥ä»ç´¢å¼•è·å–æ‰€æœ‰éœ€è¦çš„æ•°æ®ï¼Œä¸ç”¨è®¿é—®åŸè¡¨
```

---

## 4. ğŸ¨ å‰ç¼€ç´¢å¼•ä¸å‡½æ•°ç´¢å¼•


### 4.1 å‰ç¼€ç´¢å¼•ä½¿ç”¨æ–¹æ³•


**ä»€ä¹ˆæ˜¯å‰ç¼€ç´¢å¼•**ï¼š
å¯¹å­—ç¬¦ä¸²å­—æ®µçš„å‰å‡ ä¸ªå­—ç¬¦åˆ›å»ºç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´

```sql
-- æ ‡å‡†ç´¢å¼• vs å‰ç¼€ç´¢å¼•å¯¹æ¯”
CREATE INDEX idx_email_full ON users(email);        -- ç´¢å¼•æ•´ä¸ªé‚®ç®±
CREATE INDEX idx_email_prefix ON users(email(10));  -- åªç´¢å¼•å‰10ä¸ªå­—ç¬¦

-- å­˜å‚¨ç©ºé—´å¯¹æ¯”ï¼š
-- é‚®ç®±å¹³å‡é•¿åº¦30å­—ç¬¦ï¼Œ100ä¸‡ç”¨æˆ·
-- å®Œæ•´ç´¢å¼•ï¼š30MB
-- å‰ç¼€ç´¢å¼•ï¼š10MBï¼ŒèŠ‚çœ67%ç©ºé—´
```

**å‰ç¼€é•¿åº¦é€‰æ‹©**ï¼š

```sql
-- åˆ†æå‰ç¼€é•¿åº¦çš„é€‰æ‹©æ€§
SELECT 
    LEFT(email, 5) as prefix_5,
    COUNT(*) as count,
    COUNT(*) / (SELECT COUNT(*) FROM users) as percentage
FROM users 
GROUP BY LEFT(email, 5)
ORDER BY count DESC
LIMIT 10;

-- è®¡ç®—ä¸åŒå‰ç¼€é•¿åº¦çš„å”¯ä¸€æ€§
SELECT 
    CHAR_LENGTH(email) as full_length,
    COUNT(DISTINCT LEFT(email, 5)) / COUNT(*) as prefix_5_selectivity,
    COUNT(DISTINCT LEFT(email, 10)) / COUNT(*) as prefix_10_selectivity,
    COUNT(DISTINCT email) / COUNT(*) as full_selectivity
FROM users;
```

**å‰ç¼€ç´¢å¼•æœ€ä½³å®è·µ**ï¼š

```sql
-- âœ… é€‚åˆå‰ç¼€ç´¢å¼•çš„åœºæ™¯
CREATE INDEX idx_url_prefix ON pages(url(50));
-- URLé€šå¸¸å‰é¢éƒ¨åˆ†åŒºåˆ†åº¦è¾ƒé«˜

CREATE INDEX idx_description_prefix ON products(description(100));  
-- å•†å“æè¿°çš„å‰100å­—ç¬¦é€šå¸¸åŒ…å«å…³é”®ä¿¡æ¯

-- âŒ ä¸é€‚åˆå‰ç¼€ç´¢å¼•çš„åœºæ™¯
CREATE INDEX idx_hash_prefix ON files(file_hash(10));
-- å“ˆå¸Œå€¼å‰é¢éƒ¨åˆ†åŒºåˆ†åº¦ä¸é«˜ï¼Œåº”è¯¥ç´¢å¼•å®Œæ•´å€¼
```

### 4.2 å‡½æ•°ç´¢å¼•åº”ç”¨åœºæ™¯


**ä»€ä¹ˆæ˜¯å‡½æ•°ç´¢å¼•**ï¼š
å¯¹å­—æ®µç»è¿‡å‡½æ•°å¤„ç†åçš„ç»“æœåˆ›å»ºç´¢å¼•

```sql
-- MySQL 8.0+ æ”¯æŒå‡½æ•°ç´¢å¼•
CREATE INDEX idx_email_domain ON users((SUBSTRING_INDEX(email, '@', -1)));

-- æŸ¥è¯¢é‚®ç®±åŸŸåæ—¶å¯ä»¥ä½¿ç”¨ç´¢å¼•
SELECT * FROM users 
WHERE SUBSTRING_INDEX(email, '@', -1) = 'gmail.com';
```

**å¸¸è§å‡½æ•°ç´¢å¼•åœºæ™¯**ï¼š

```sql
-- 1. å¤§å°å†™ä¸æ•æ„ŸæŸ¥è¯¢
CREATE INDEX idx_name_lower ON users((LOWER(name)));
SELECT * FROM users WHERE LOWER(name) = 'john';

-- 2. æ—¥æœŸå‡½æ•°ç´¢å¼•
CREATE INDEX idx_created_year ON orders((YEAR(created_at)));
SELECT * FROM orders WHERE YEAR(created_at) = 2024;

-- 3. JSONå­—æ®µç´¢å¼•
CREATE INDEX idx_json_city ON users((JSON_UNQUOTE(JSON_EXTRACT(profile, '$.city'))));
SELECT * FROM users WHERE JSON_UNQUOTE(JSON_EXTRACT(profile, '$.city')) = 'Beijing';
```

### 4.3 éƒ¨åˆ†ç´¢å¼•åˆ›å»ºæŠ€å·§


**æ¡ä»¶ç´¢å¼•**ï¼ˆPostgreSQLç‰¹æ€§ï¼ŒMySQLå¯ç”¨ç±»ä¼¼æ€è·¯ï¼‰ï¼š

```sql
-- åªä¸ºç¬¦åˆç‰¹å®šæ¡ä»¶çš„è®°å½•åˆ›å»ºç´¢å¼•
-- ä¾‹å¦‚ï¼šåªä¸ºæœ‰æ•ˆè®¢å•åˆ›å»ºç´¢å¼•ï¼Œå¿½ç•¥å·²åˆ é™¤è®¢å•

-- MySQLä¸­çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å¤åˆç´¢å¼•å®ç°ç±»ä¼¼æ•ˆæœ
CREATE INDEX idx_orders_valid ON orders(is_deleted, status, created_at);
-- æŸ¥è¯¢æ—¶å§‹ç»ˆåŒ…å«is_deleted = 0æ¡ä»¶
```

**ç¨€ç–æ•°æ®ç´¢å¼•ä¼˜åŒ–**ï¼š

```sql
-- å¯¹äºå¤§é‡NULLå€¼çš„å­—æ®µï¼ŒMySQLè‡ªåŠ¨ä¼˜åŒ–
CREATE INDEX idx_discount_code ON orders(discount_code);
-- NULLå€¼ä¸ä¼šè¢«ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´

-- åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ä¼˜åŒ–å­˜å‚¨
ALTER TABLE orders ADD COLUMN has_discount TINYINT AS (discount_code IS NOT NULL);
CREATE INDEX idx_has_discount ON orders(has_discount, discount_code);
```

---

## 5. ğŸ”§ ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§


### 5.1 ç´¢å¼•ç»´æŠ¤æœ€ä½³å®è·µ


**å®šæœŸåˆ†æç´¢å¼•ä½¿ç”¨æƒ…å†µ**ï¼š

```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SELECT 
    table_name,
    index_name,
    seq_in_index,
    column_name,
    cardinality
FROM information_schema.statistics 
WHERE table_schema = 'your_database'
ORDER BY table_name, index_name, seq_in_index;

-- æŸ¥çœ‹æœªä½¿ç”¨çš„ç´¢å¼•
SELECT 
    object_name,
    index_name
FROM sys.schema_unused_indexes
WHERE object_schema = 'your_database';
```

**ç´¢å¼•ç¢ç‰‡æ£€æµ‹ä¸å¤„ç†**ï¼š

```sql
-- æ£€æŸ¥è¡¨å’Œç´¢å¼•çš„ç¢ç‰‡æƒ…å†µ  
SELECT 
    table_name,
    data_length,
    index_length,
    data_free,
    (data_free / (data_length + index_length)) * 100 as fragmentation_percent
FROM information_schema.tables
WHERE table_schema = 'your_database'
AND data_free > 0
ORDER BY fragmentation_percent DESC;
```

### 5.2 ç´¢å¼•é‡å»ºæ“ä½œ


**ä½•æ—¶éœ€è¦é‡å»ºç´¢å¼•**ï¼š

```
è§¦å‘é‡å»ºçš„æƒ…å†µï¼š
â”œâ”€â”€ ç¢ç‰‡ç‡è¶…è¿‡30%
â”œâ”€â”€ å¤§é‡æ•°æ®åˆ é™¤å
â”œâ”€â”€ æ‰¹é‡æ•°æ®å¯¼å…¥å
â””â”€â”€ ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®æ—¶
```

**é‡å»ºç´¢å¼•çš„æ–¹æ³•**ï¼š

```sql
-- æ–¹æ³•1ï¼šåˆ é™¤é‡å»ºï¼ˆä¼šé”è¡¨ï¼‰
DROP INDEX idx_customer_id ON orders;
CREATE INDEX idx_customer_id ON orders(customer_id);

-- æ–¹æ³•2ï¼šOPTIMIZE TABLEï¼ˆæ¨èï¼‰
OPTIMIZE TABLE orders;

-- æ–¹æ³•3ï¼šALTER TABLEï¼ˆåœ¨çº¿é‡å»ºï¼ŒMySQL 5.6+ï¼‰
ALTER TABLE orders DROP INDEX idx_customer_id, ADD INDEX idx_customer_id(customer_id);
```

**é‡å»ºç´¢å¼•çš„æ³¨æ„äº‹é¡¹**ï¼š

> **âš ï¸ é‡è¦æé†’**
> 
> - é‡å»ºç´¢å¼•ä¼šæ¶ˆè€—å¤§é‡IOèµ„æº
> - å»ºè®®åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
> - å¤§è¡¨é‡å»ºå¯èƒ½éœ€è¦å‡ å°æ—¶æ—¶é—´
> - é‡å»ºæœŸé—´å¯èƒ½å½±å“æŸ¥è¯¢æ€§èƒ½

### 5.3 ç´¢å¼•ç›‘æ§æ–¹æ³•


**æ€§èƒ½ç›‘æ§æŒ‡æ ‡**ï¼š

```sql
-- ç›‘æ§æ…¢æŸ¥è¯¢ä¸­çš„ç´¢å¼•ä½¿ç”¨
SELECT 
    sql_text,
    rows_examined,
    rows_sent,
    query_time
FROM mysql.slow_log
WHERE rows_examined > rows_sent * 100  -- æ‰«æè¡Œæ•°è¿œå¤§äºè¿”å›è¡Œæ•°
ORDER BY query_time DESC;

-- ç›‘æ§ç´¢å¼•çš„é€‰æ‹©æ€§
SELECT 
    table_name,
    index_name,
    cardinality,
    (cardinality / table_rows) as selectivity
FROM information_schema.statistics s
JOIN information_schema.tables t ON s.table_name = t.table_name
WHERE s.table_schema = 'your_database'
AND t.table_schema = 'your_database'
ORDER BY selectivity DESC;
```

**ç´¢å¼•æ•ˆæœéªŒè¯**ï¼š

```sql
-- ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢è®¡åˆ’
EXPLAIN FORMAT=JSON
SELECT * FROM orders 
WHERE customer_id = 12345 AND status = 'shipped';

-- å…³é”®æŒ‡æ ‡è§£è¯»ï¼š
-- type: const > eq_ref > ref > range > index > ALL
-- possible_keys: å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•
-- key: å®é™…ä½¿ç”¨çš„ç´¢å¼•  
-- rows: é¢„ä¼°æ‰«æè¡Œæ•°
-- Extra: é¢å¤–ä¿¡æ¯ï¼ˆUsing indexè¡¨ç¤ºè¦†ç›–ç´¢å¼•ï¼‰
```

**å»ºç«‹ç›‘æ§å‘Šè­¦**ï¼š

```sql
-- åˆ›å»ºç›‘æ§è§†å›¾
CREATE VIEW v_index_performance AS
SELECT 
    table_name,
    index_name,
    cardinality,
    CASE 
        WHEN cardinality = 0 THEN 'UNUSED'
        WHEN cardinality < 10 THEN 'LOW_SELECTIVITY'  
        ELSE 'NORMAL'
    END as index_status
FROM information_schema.statistics
WHERE table_schema = 'your_database';

-- å®šæœŸæ£€æŸ¥ä½æ•ˆç´¢å¼•
SELECT * FROM v_index_performance 
WHERE index_status IN ('UNUSED', 'LOW_SELECTIVITY');
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç´¢å¼•æœ¬è´¨ï¼šæ•°æ®åº“çš„"ç›®å½•"ï¼Œç”¨B+æ ‘ç»“æ„åŠ é€ŸæŸ¥æ‰¾
ğŸ”¸ åˆ›å»ºåŸåˆ™ï¼šç»å¸¸æŸ¥è¯¢çš„å­—æ®µåˆ›å»ºï¼Œé¢‘ç¹æ›´æ–°çš„å­—æ®µæ…é‡
ğŸ”¸ å¤åˆç´¢å¼•ï¼šéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™ï¼Œå­—æ®µé¡ºåºå½±å“æ•ˆæœ
ğŸ”¸ å‰ç¼€ç´¢å¼•ï¼šèŠ‚çœç©ºé—´ä½†éœ€è¦å¹³è¡¡é•¿åº¦å’Œé€‰æ‹©æ€§
ğŸ”¸ ç»´æŠ¤ç›‘æ§ï¼šå®šæœŸæ£€æŸ¥ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶æ¸…ç†æ— æ•ˆç´¢å¼•
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç´¢å¼•ä¸æ˜¯ä¸‡èƒ½çš„**
```
ç´¢å¼•çš„ä»£ä»·ï¼š
- é¢å¤–å­˜å‚¨ç©ºé—´ï¼ˆé€šå¸¸20-30%ï¼‰
- å†™å…¥æ€§èƒ½ä¸‹é™ï¼ˆç»´æŠ¤ç´¢å¼•ç»“æ„ï¼‰
- å†…å­˜å ç”¨å¢åŠ 
- è¿‡å¤šç´¢å¼•åè€Œé™ä½æ€§èƒ½
```

**ğŸ”¹ å¤åˆç´¢å¼•è®¾è®¡æ€è·¯**
```
è®¾è®¡æ­¥éª¤ï¼š
1. åˆ†ææŸ¥è¯¢æ¨¡å¼ï¼Œæ‰¾å‡ºWHEREæ¡ä»¶
2. æŒ‰ç­‰å€¼æŸ¥è¯¢ä¼˜å…ˆçº§æ’åºå­—æ®µ
3. å°†èŒƒå›´æŸ¥è¯¢å­—æ®µæ”¾åœ¨æœ€å
4. è€ƒè™‘æ˜¯å¦éœ€è¦è¦†ç›–ç´¢å¼•ä¼˜åŒ–
```

**ğŸ”¹ ç´¢å¼•ä¼˜åŒ–çš„å¹³è¡¡è‰ºæœ¯**
```
éœ€è¦å¹³è¡¡çš„å› ç´ ï¼š
- æŸ¥è¯¢é€Ÿåº¦ vs å†™å…¥é€Ÿåº¦
- å­˜å‚¨ç©ºé—´ vs æŸ¥è¯¢æ€§èƒ½  
- ç´¢å¼•æ•°é‡ vs ç»´æŠ¤æˆæœ¬
- é€šç”¨æ€§ vs ä¸“é—¨ä¼˜åŒ–
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ç´¢å¼•è®¾è®¡æ£€æŸ¥æ¸…å•**ï¼š
- âœ… æ˜¯å¦åˆ†æäº†çœŸå®çš„æŸ¥è¯¢æ¨¡å¼ï¼Ÿ
- âœ… æ˜¯å¦éµå¾ªäº†æœ€å·¦å‰ç¼€åŸåˆ™ï¼Ÿ
- âœ… æ˜¯å¦è€ƒè™‘äº†å­—æ®µçš„é€‰æ‹©æ€§ï¼Ÿ
- âœ… æ˜¯å¦è¯„ä¼°äº†ç»´æŠ¤æˆæœ¬ï¼Ÿ
- âœ… æ˜¯å¦å»ºç«‹äº†ç›‘æ§æœºåˆ¶ï¼Ÿ

**å¸¸è§é”™è¯¯é¿å…**ï¼š
- âŒ ä¸ºæ¯ä¸ªå­—æ®µéƒ½åˆ›å»ºç´¢å¼•
- âŒ å¿½ç•¥å¤åˆç´¢å¼•çš„å­—æ®µé¡ºåº
- âŒ åœ¨é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸Šåˆ›å»ºè¿‡å¤šç´¢å¼•
- âŒ åˆ›å»ºåä¸ç›‘æ§ç´¢å¼•ä½¿ç”¨æ•ˆæœ
- âŒ ä¸åŠæ—¶æ¸…ç†æ— æ•ˆç´¢å¼•

### 6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®


**æ–°æ‰‹å…¥é—¨å»ºè®®**ï¼š
1. **ä»æ…¢æŸ¥è¯¢æ—¥å¿—å¼€å§‹**ï¼šæ‰¾åˆ°çœŸæ­£éœ€è¦ä¼˜åŒ–çš„æŸ¥è¯¢
2. **ä¸€æ¬¡ä¼˜åŒ–ä¸€ä¸ªæŸ¥è¯¢**ï¼šé¿å…è¿‡åº¦ä¼˜åŒ–
3. **æµ‹è¯•éªŒè¯æ•ˆæœ**ï¼šç”¨EXPLAINæ£€æŸ¥ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆ
4. **ç›‘æ§æ€§èƒ½å˜åŒ–**ï¼šè§‚å¯Ÿæ•´ä½“ç³»ç»Ÿæ€§èƒ½å½±å“

**è¿›é˜¶ä¼˜åŒ–ç­–ç•¥**ï¼š
1. **è¯»å†™åˆ†ç¦»åœºæ™¯**ï¼šä¸»åº“å°‘ç´¢å¼•ï¼Œä»åº“å¤šç´¢å¼•
2. **åˆ†åŒºè¡¨ç´¢å¼•**ï¼šç»“åˆåˆ†åŒºç­–ç•¥è®¾è®¡ç´¢å¼•
3. **å†…å­˜ä¼˜åŒ–**ï¼šè°ƒæ•´innodb_buffer_pool_size
4. **å¹¶å‘ä¼˜åŒ–**ï¼šè€ƒè™‘ç´¢å¼•é”çš„å½±å“

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ç´¢å¼•å¦‚ç›®å½•ï¼ŒæŸ¥æ‰¾å¿«å¦‚é£
- æœ€å·¦å‰ç¼€è®°å¿ƒå¤´ï¼Œé¡ºåºä¸å¯¹å…¨ç™½è´¹  
- ç­‰å€¼åœ¨å‰èŒƒå›´åï¼Œé€‰æ‹©æ€§é«˜æ•ˆæœå¥½
- ç»´æŠ¤ç›‘æ§ä¸èƒ½å¿˜ï¼Œæ— æ•ˆç´¢å¼•è¦æ¸…é™¤