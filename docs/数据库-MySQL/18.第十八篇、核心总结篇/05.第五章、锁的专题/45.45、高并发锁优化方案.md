---
title: 45ã€é«˜å¹¶å‘é”ä¼˜åŒ–æ–¹æ¡ˆ
---
## ðŸ“š ç›®å½•

1. [é«˜å¹¶å‘é”æŒ‘æˆ˜æ¦‚è¿°](#1-é«˜å¹¶å‘é”æŒ‘æˆ˜æ¦‚è¿°)
2. [æž¶æž„å±‚é¢ä¼˜åŒ–æ–¹æ¡ˆ](#2-æž¶æž„å±‚é¢ä¼˜åŒ–æ–¹æ¡ˆ)
3. [æ•°æ®åº“å±‚é¢ä¼˜åŒ–ç­–ç•¥](#3-æ•°æ®åº“å±‚é¢ä¼˜åŒ–ç­–ç•¥)
4. [åº”ç”¨å±‚é¢ä¼˜åŒ–æŠ€å·§](#4-åº”ç”¨å±‚é¢ä¼˜åŒ–æŠ€å·§)
5. [ç›‘æŽ§ä¸Žè°ƒä¼˜å®žæˆ˜](#5-ç›‘æŽ§ä¸Žè°ƒä¼˜å®žæˆ˜)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸš€ é«˜å¹¶å‘é”æŒ‘æˆ˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯é«˜å¹¶å‘é”é—®é¢˜


**ðŸ”¸ é«˜å¹¶å‘åœºæ™¯çš„æœ¬è´¨**
```
ç®€å•ç†è§£ï¼šå°±åƒç«è½¦ç«™ä¹°ç¥¨
- å•çª—å£ï¼šä¸€ä¸ªäººä¹°ç¥¨æ—¶ï¼Œå…¶ä»–äººå¿…é¡»ç­‰å¾…
- é«˜å³°æœŸï¼šå¤§é‡äººåŒæ—¶ä¹°ç¥¨ï¼ŒæŽ’é˜Ÿæ—¶é—´å¾ˆé•¿
- æ•°æ®åº“é”ï¼šå¤šä¸ªè¯·æ±‚åŒæ—¶æ“ä½œæ•°æ®æ—¶çš„"æŽ’é˜Ÿ"æœºåˆ¶
```

> **ðŸ’¡ æ ¸å¿ƒç†è§£**
> é«˜å¹¶å‘é”é—®é¢˜å°±æ˜¯å½“å¤§é‡ç”¨æˆ·åŒæ—¶è®¿é—®ç³»ç»Ÿæ—¶ï¼Œå› ä¸ºæ•°æ®åº“é”æœºåˆ¶å¯¼è‡´çš„æ€§èƒ½ç“¶é¢ˆå’Œç”¨æˆ·ä½“éªŒé—®é¢˜

**ðŸ”¸ å¸¸è§çš„é«˜å¹¶å‘é”åœºæ™¯**
- **ç§’æ€æ´»åŠ¨**ï¼šå¤§é‡ç”¨æˆ·åŒæ—¶æŠ¢è´­å•†å“
- **åº“å­˜æ‰£å‡**ï¼šå¤šä¸ªè®¢å•åŒæ—¶å‡å°‘å•†å“åº“å­˜  
- **è´¦æˆ·ä½™é¢**ï¼šå¹¶å‘è½¬è´¦ã€å……å€¼ã€æ¶ˆè´¹
- **ç§¯åˆ†ç³»ç»Ÿ**ï¼šåŒæ—¶å¢žå‡ç”¨æˆ·ç§¯åˆ†
- **è®¡æ•°å™¨æ›´æ–°**ï¼šè®¿é—®é‡ã€ç‚¹å‡»é‡ç»Ÿè®¡

### 1.2 é«˜å¹¶å‘å¸¦æ¥çš„å…·ä½“é—®é¢˜


**âš ï¸ æ€§èƒ½é—®é¢˜**
```
é—®é¢˜è¡¨çŽ°ï¼š
- å“åº”æ—¶é—´ä»Žå‡ æ¯«ç§’å˜æˆå‡ ç§’
- CPUä½¿ç”¨çŽ‡é£™å‡åˆ°80%ä»¥ä¸Š
- æ•°æ®åº“è¿žæŽ¥æ± è¢«è€—å°½
- ç”¨æˆ·ç•Œé¢å‡ºçŽ°"åŠ è½½ä¸­"å¾ˆä¹…

æ ¹æœ¬åŽŸå› ï¼š
å¤§é‡è¯·æ±‚åœ¨æ•°æ®åº“å±‚é¢"æŽ’é˜Ÿç­‰é”"
å°±åƒé«˜é€Ÿå…¬è·¯å µè½¦ï¼ŒåŽé¢çš„è½¦éƒ½èµ°ä¸äº†
```

**ðŸ”¸ ä¸šåŠ¡é—®é¢˜**
- **ç”¨æˆ·æµå¤±**ï¼šé¡µé¢å“åº”æ…¢ï¼Œç”¨æˆ·ç›´æŽ¥å…³é—­
- **é‡å¤æäº¤**ï¼šç”¨æˆ·ä»¥ä¸ºæ²¡æˆåŠŸï¼Œå¤šæ¬¡ç‚¹å‡»
- **æ•°æ®ä¸ä¸€è‡´**ï¼šé«˜å¹¶å‘ä¸‹å¯èƒ½å‡ºçŽ°æ•°æ®é”™è¯¯
- **ç³»ç»Ÿå´©æºƒ**ï¼šæžç«¯æƒ…å†µä¸‹æœåŠ¡å™¨å®•æœº

---

## 2. ðŸ—ï¸ æž¶æž„å±‚é¢ä¼˜åŒ–æ–¹æ¡ˆ


### 2.1 è¯»å†™åˆ†ç¦»ç­–ç•¥


**ðŸ”¸ è¯»å†™åˆ†ç¦»çš„åŸºæœ¬æ€è·¯**
```
ä¼ ç»Ÿæž¶æž„ï¼š                  è¯»å†™åˆ†ç¦»æž¶æž„ï¼š
åº”ç”¨ â†’ ä¸»æ•°æ®åº“             åº”ç”¨ â†’ ä¸»åº“ï¼ˆå†™æ“ä½œï¼‰
                                â†˜ ä»Žåº“1ï¼ˆè¯»æ“ä½œï¼‰
                                â†˜ ä»Žåº“2ï¼ˆè¯»æ“ä½œï¼‰

æ ¸å¿ƒæ€æƒ³ï¼šå†™æ“ä½œç”¨ä¸»åº“ï¼Œè¯»æ“ä½œç”¨ä»Žåº“
å°±åƒé“¶è¡Œï¼šå­˜å–æ¬¾æ‰¾æŸœå°ï¼ŒæŸ¥è¯¢ä½™é¢ç”¨ATM
```

**ðŸ’» è¯»å†™åˆ†ç¦»å®žçŽ°ç¤ºä¾‹**
```java
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    // å†™æ“ä½œï¼šå¼ºåˆ¶ä½¿ç”¨ä¸»åº“
    @Master
    public void updateUser(User user) {
        userMapper.updateUser(user);
    }
    
    // è¯»æ“ä½œï¼šè‡ªåŠ¨è·¯ç”±åˆ°ä»Žåº“
    @Slave
    public User getUserById(Long id) {
        return userMapper.selectById(id);
    }
}
```

**ðŸŽ¯ è¯»å†™åˆ†ç¦»çš„é€‚ç”¨åœºæ™¯**
- **è¯»å¤šå†™å°‘**ï¼šå¦‚æ–°é—»ç½‘ç«™ã€å•†å“å±•ç¤º
- **æŸ¥è¯¢åŽ‹åŠ›å¤§**ï¼šå¤§é‡ç”¨æˆ·åŒæ—¶æµè§ˆ
- **å¯¹å®žæ—¶æ€§è¦æ±‚ä¸é«˜**ï¼šå¯ä»¥æŽ¥å—å‡ ç§’çš„æ•°æ®å»¶è¿Ÿ

### 2.2 åˆ†åº“åˆ†è¡¨è§£å†³æ–¹æ¡ˆ


**ðŸ”¸ åˆ†åº“åˆ†è¡¨çš„æ ¸å¿ƒç†å¿µ**
```
å•è¡¨é—®é¢˜ï¼š                   åˆ†è¡¨è§£å†³ï¼š
ç”¨æˆ·è¡¨(1000ä¸‡æ¡)           ç”¨æˆ·è¡¨1(250ä¸‡) + ç”¨æˆ·è¡¨2(250ä¸‡)
æ‰€æœ‰ç”¨æˆ·æŠ¢ä¸€ä¸ªè¡¨            + ç”¨æˆ·è¡¨3(250ä¸‡) + ç”¨æˆ·è¡¨4(250ä¸‡)

å°±åƒï¼š
ä¸€ä¸ªæ”¶é“¶å°æŽ’é•¿é˜Ÿ    â†’    å››ä¸ªæ”¶é“¶å°åˆ†æµ
```

**ðŸ“Š åˆ†è¡¨ç­–ç•¥å¯¹æ¯”**

| åˆ†è¡¨æ–¹å¼ | **åŽŸç†** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|----------|----------|----------|-------------|
| **æŒ‰IDå–æ¨¡** | `ç”¨æˆ·ID % 4` | `ç®€å•å‡åŒ€` | `æ‰©å®¹å›°éš¾` | `ç”¨æˆ·é‡å›ºå®š` |
| **æŒ‰æ—¶é—´åˆ†ç‰‡** | `æŒ‰æœˆåˆ†è¡¨` | `ä¾¿äºŽç»´æŠ¤` | `çƒ­ç‚¹é›†ä¸­` | `æ—¶åºæ•°æ®` |
| **æŒ‰ä¸šåŠ¡åˆ†ç‰‡** | `æŒ‰åœ°åŒºåˆ†è¡¨` | `ä¸šåŠ¡æ¸…æ™°` | `æ•°æ®å€¾æ–œ` | `å¤šç§Ÿæˆ·ç³»ç»Ÿ` |

### 2.3 ç¼“å­˜ç­–ç•¥å‡å°‘æ•°æ®åº“åŽ‹åŠ›


**ðŸ”¸ ç¼“å­˜çš„ä½œç”¨æœºåˆ¶**
```
æ— ç¼“å­˜æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ æ•°æ®åº“ â†’ è¿”å›žæ•°æ®

æœ‰ç¼“å­˜æµç¨‹ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ åº”ç”¨æœåŠ¡å™¨ â†’ ç¼“å­˜(Redis) â†’ ç›´æŽ¥è¿”å›ž
                    â†“ (ç¼“å­˜æ²¡æœ‰æ—¶)
                   æ•°æ®åº“ â†’ è¿”å›žå¹¶ç¼“å­˜
```

**âš¡ å¸¸ç”¨ç¼“å­˜æ¨¡å¼**

**æ—è·¯ç¼“å­˜æ¨¡å¼ï¼ˆæœ€å¸¸ç”¨ï¼‰**
```java
public User getUserById(Long id) {
    // 1. å…ˆæŸ¥ç¼“å­˜
    User user = redisTemplate.opsForValue().get("user:" + id);
    
    if (user != null) {
        return user; // ç¼“å­˜å‘½ä¸­ï¼Œç›´æŽ¥è¿”å›ž
    }
    
    // 2. ç¼“å­˜æ²¡æœ‰ï¼ŒæŸ¥æ•°æ®åº“
    user = userMapper.selectById(id);
    
    // 3. æ”¾å…¥ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
    if (user != null) {
        redisTemplate.opsForValue().set("user:" + id, user, 300, TimeUnit.SECONDS);
    }
    
    return user;
}
```

---

## 3. ðŸ› ï¸ æ•°æ®åº“å±‚é¢ä¼˜åŒ–ç­–ç•¥


### 3.1 é”ç²’åº¦ä¼˜åŒ–


**ðŸ”¸ é€‰æ‹©åˆé€‚çš„é”çº§åˆ«**
```
è¡Œçº§é” vs è¡¨çº§é”çš„é€‰æ‹©ï¼š

è¡¨çº§é”ï¼š
- å°±åƒå°é”æ•´æ ‹æ¥¼ï¼Œåªèƒ½ä¸€ä¸ªäººè¿›å‡º
- é€‚åˆï¼šå¤§æ‰¹é‡æ“ä½œï¼Œå¦‚æ•°æ®å¯¼å…¥

è¡Œçº§é”ï¼š
- å°±åƒåªé”ä¸€ä¸ªæˆ¿é—´ï¼Œå…¶ä»–æˆ¿é—´æ­£å¸¸ä½¿ç”¨  
- é€‚åˆï¼šé«˜å¹¶å‘çš„ç²¾ç¡®æ“ä½œ
```

**ðŸ’¡ InnoDBé”ä¼˜åŒ–æŠ€å·§**
```sql
-- âŒ ä¸å¥½çš„åšæ³•ï¼šé”ä½æ•´å¼ è¡¨
LOCK TABLES users WRITE;
UPDATE users SET status = 1;
UNLOCK TABLES;

-- âœ… å¥½çš„åšæ³•ï¼šåªé”éœ€è¦çš„è¡Œ
UPDATE users SET status = 1 WHERE id = 12345;

-- âœ… æ›´å¥½çš„åšæ³•ï¼šä½¿ç”¨ç´¢å¼•é¿å…é”å‡çº§
UPDATE users SET status = 1 WHERE email = 'user@example.com';
-- å‰æï¼šemailå­—æ®µæœ‰ç´¢å¼•
```

### 3.2 ç´¢å¼•ä¼˜åŒ–å‡å°‘é”èŒƒå›´


**ðŸ”¸ ä¸ºä»€ä¹ˆç´¢å¼•èƒ½å‡å°‘é”å†²çª**
```
æ— ç´¢å¼•æƒ…å†µï¼š
SELECT * FROM products WHERE category = 'æ‰‹æœº'

MySQLéœ€è¦ï¼š
1. æ‰«ææ•´å¼ è¡¨ï¼ˆå…¨è¡¨æ‰«æï¼‰
2. å¯¹æ‰«æè¿‡ç¨‹åŠ é”ï¼ˆèŒƒå›´å¾ˆå¤§ï¼‰
3. å…¶ä»–æ“ä½œè¢«é˜»å¡žæ—¶é—´é•¿

æœ‰ç´¢å¼•æƒ…å†µï¼š
1. ç›´æŽ¥å®šä½åˆ°ç›¸å…³è¡Œï¼ˆç²¾å‡†æŸ¥æ‰¾ï¼‰
2. åªé”ä½å¿…è¦çš„è¡Œï¼ˆèŒƒå›´å¾ˆå°ï¼‰
3. å…¶ä»–æ“ä½œå‡ ä¹Žä¸å—å½±å“
```

**ðŸ“‹ ç´¢å¼•åˆ›å»ºæœ€ä½³å®žè·µ**
```sql
-- åŸºç¡€ç´¢å¼•ï¼šæé«˜æŸ¥è¯¢æ•ˆçŽ‡
CREATE INDEX idx_category ON products(category);

-- å¤åˆç´¢å¼•ï¼šå¤šæ¡ä»¶æŸ¥è¯¢
CREATE INDEX idx_category_price ON products(category, price);

-- å”¯ä¸€ç´¢å¼•ï¼šé˜²æ­¢é‡å¤ï¼Œæé«˜æ•ˆçŽ‡
CREATE UNIQUE INDEX idx_email ON users(email);
```

### 3.3 äº‹åŠ¡ä¼˜åŒ–ç­–ç•¥


**ðŸ”¸ ç¼©çŸ­äº‹åŠ¡æ‰§è¡Œæ—¶é—´**
```java
// âŒ ä¸å¥½çš„åšæ³•ï¼šäº‹åŠ¡æ—¶é—´å¤ªé•¿
@Transactional
public void processOrder(Order order) {
    // å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼ˆè€—æ—¶5ç§’ï¼‰
    calculateDiscount(order);
    checkInventory(order);
    
    // å‘é€é‚®ä»¶ï¼ˆè€—æ—¶3ç§’ï¼‰
    emailService.sendConfirmation(order);
    
    // æ•°æ®åº“æ“ä½œ
    orderMapper.insert(order);
}

// âœ… å¥½çš„åšæ³•ï¼šäº‹åŠ¡åªåŒ…å«æ•°æ®åº“æ“ä½œ
public void processOrder(Order order) {
    // äº‹åŠ¡å¤–å¤„ç†å¤æ‚é€»è¾‘
    calculateDiscount(order);
    checkInventory(order);
    
    // äº‹åŠ¡å†…åªåšæ•°æ®åº“æ“ä½œ
    saveOrderInTransaction(order);
    
    // äº‹åŠ¡åŽå‘é€é€šçŸ¥
    emailService.sendConfirmation(order);
}

@Transactional
private void saveOrderInTransaction(Order order) {
    orderMapper.insert(order);
}
```

---

## 4. ðŸ’¡ åº”ç”¨å±‚é¢ä¼˜åŒ–æŠ€å·§


### 4.1 é˜Ÿåˆ—åŒ–å¤„ç†


**ðŸ”¸ é˜Ÿåˆ—åŒ–çš„åŸºæœ¬æ€è·¯**
```
åŒæ­¥å¤„ç†é—®é¢˜ï¼š                é˜Ÿåˆ—åŒ–è§£å†³ï¼š
ç”¨æˆ·ç‚¹å‡» â†’ ç«‹å³å¤„ç† â†’ ç­‰å¾…     ç”¨æˆ·ç‚¹å‡» â†’ åŠ å…¥é˜Ÿåˆ— â†’ ç«‹å³å“åº”
         â†“                           â†“
    æ•°æ®åº“é”ç­‰å¾…               åŽå°é€ä¸ªå¤„ç†

å°±åƒï¼š
é“¶è¡ŒåŠžä¸šåŠ¡å–å·æŽ’é˜Ÿï¼Œå…ˆå–å·å†æ…¢æ…¢ç­‰
è€Œä¸æ˜¯éƒ½æŒ¤åœ¨æŸœå°å‰
```

**ðŸ“Š é˜Ÿåˆ—å¤„ç†æµç¨‹å›¾**
```
ç”¨æˆ·è¯·æ±‚                   æ¶ˆæ¯é˜Ÿåˆ—                 å¤„ç†æœåŠ¡å™¨
   |                         |                        |
   |--[1]æäº¤è®¢å•----------->|                        |
   |<-[2]è¿”å›ž"å¤„ç†ä¸­"---------|                        |
   |                         |--[3]å–å‡ºä»»åŠ¡---------->|
   |                         |<-[4]å¤„ç†å®Œæˆ-----------|
   |<-[5]æŽ¨é€ç»“æžœé€šçŸ¥---------|                        |
```

**ðŸ’» é˜Ÿåˆ—å®žçŽ°ç¤ºä¾‹**
```java
@RestController
public class OrderController {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    // ç”¨æˆ·æäº¤è®¢å•ï¼šå¿«é€Ÿå“åº”
    @PostMapping("/order")
    public ResponseEntity createOrder(@RequestBody Order order) {
        // ç”Ÿæˆè®¢å•å·
        String orderNo = generateOrderNo();
        
        // æ”¾å…¥å¤„ç†é˜Ÿåˆ—
        redisTemplate.opsForList().leftPush("order_queue", orderNo);
        
        // ç«‹å³è¿”å›ž
        return ResponseEntity.ok("è®¢å•å·²æäº¤ï¼Œæ­£åœ¨å¤„ç†ä¸­...");
    }
    
    // åŽå°å¤„ç†è®¢å•ï¼šæ…¢æ…¢å¤„ç†
    @Scheduled(fixedDelay = 1000)
    public void processOrders() {
        String orderNo = (String) redisTemplate.opsForList().rightPop("order_queue");
        
        if (orderNo != null) {
            // å¤„ç†è®¢å•é€»è¾‘
            processOrderLogic(orderNo);
        }
    }
}
```

### 4.2 å¼‚æ­¥å¤„ç†æ¨¡å¼


**ðŸ”¸ å¼‚æ­¥å¤„ç†çš„ä¼˜åŠ¿**
```
åŒæ­¥å¤„ç†ï¼š
ç”¨æˆ·æ“ä½œ â†’ ç­‰å¾…æ‰€æœ‰æ­¥éª¤å®Œæˆ â†’ è¿”å›žç»“æžœ
ç­‰å¾…æ—¶é—´ = æ­¥éª¤1 + æ­¥éª¤2 + æ­¥éª¤3

å¼‚æ­¥å¤„ç†ï¼š
ç”¨æˆ·æ“ä½œ â†’ è§¦å‘åŽå°ä»»åŠ¡ â†’ ç«‹å³è¿”å›ž
ç­‰å¾…æ—¶é—´ â‰ˆ 0ï¼ŒåŽå°æ…¢æ…¢å¤„ç†
```

**âš¡ å¼‚æ­¥å¤„ç†å®žçŽ°**
```java
@Service
public class OrderService {
    
    // åŒæ­¥æ–¹æ³•ï¼šç”¨äºŽå³æ—¶éœ€è¦ç»“æžœçš„æ“ä½œ
    public String createOrder(Order order) {
        String orderNo = generateOrderNo();
        
        // å¼‚æ­¥å¤„ç†å¤æ‚é€»è¾‘
        processOrderAsync(order, orderNo);
        
        return orderNo;
    }
    
    // å¼‚æ­¥æ–¹æ³•ï¼šå¤æ‚çš„ä¸šåŠ¡é€»è¾‘
    @Async
    public void processOrderAsync(Order order, String orderNo) {
        // æ£€æŸ¥åº“å­˜ï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰
        checkInventory(order);
        
        // è®¡ç®—ä»·æ ¼ï¼ˆå¯èƒ½å¾ˆæ…¢ï¼‰
        calculatePrice(order);
        
        // ä¿å­˜åˆ°æ•°æ®åº“
        saveOrder(order, orderNo);
        
        // å‘é€é€šçŸ¥
        sendNotification(orderNo);
    }
}
```

### 4.3 çƒ­ç‚¹æ•°æ®ç‰¹æ®Šå¤„ç†


**ðŸ”¸ ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®**
```
çƒ­ç‚¹æ•°æ®ç‰¹å¾ï¼š
- è¢«å¤§é‡ç”¨æˆ·åŒæ—¶è®¿é—®
- æ›´æ–°é¢‘ç¹ï¼Œè¯»å–æ›´é¢‘ç¹
- å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

å¸¸è§ä¾‹å­ï¼š
- ç§’æ€å•†å“çš„åº“å­˜
- çƒ­é—¨æ–‡ç« çš„ç‚¹èµžæ•°
- ç½‘çº¢ä¸»æ’­çš„å…³æ³¨æ•°
```

**ðŸŽ¯ çƒ­ç‚¹æ•°æ®ä¼˜åŒ–ç­–ç•¥**

**åˆ†å¸ƒå¼é” + ç¼“å­˜**
```java
@Service
public class HotDataService {
    
    @Autowired
    private RedisTemplate redisTemplate;
    
    // çƒ­ç‚¹æ•°æ®æ›´æ–°
    public boolean updateHotData(String key, int delta) {
        String lockKey = "lock:" + key;
        
        try {
            // èŽ·å–åˆ†å¸ƒå¼é”
            Boolean locked = redisTemplate.opsForValue()
                .setIfAbsent(lockKey, "1", 10, TimeUnit.SECONDS);
            
            if (!locked) {
                return false; // èŽ·å–é”å¤±è´¥ï¼Œæ”¾å¼ƒæ“ä½œ
            }
            
            // æ›´æ–°ç¼“å­˜
            redisTemplate.opsForValue().increment(key, delta);
            
            // å¼‚æ­¥æ›´æ–°æ•°æ®åº“
            updateDatabaseAsync(key, delta);
            
            return true;
            
        } finally {
            // é‡Šæ”¾é”
            redisTemplate.delete(lockKey);
        }
    }
}
```

---

## 5. ðŸ“Š ç›‘æŽ§ä¸Žè°ƒä¼˜å®žæˆ˜


### 5.1 æ€§èƒ½ç›‘æŽ§æŒ‡æ ‡


**ðŸ”¸ å…³é”®ç›‘æŽ§æŒ‡æ ‡**
```
æ•°æ®åº“å±‚é¢ï¼š
- é”ç­‰å¾…æ—¶é—´ï¼šå¹³å‡ç­‰å¾…å¤šé•¿æ—¶é—´èŽ·å–é”
- æ­»é”æ¬¡æ•°ï¼šæ¯å°æ—¶å‘ç”Ÿå¤šå°‘æ¬¡æ­»é”
- æ…¢æŸ¥è¯¢æ•°é‡ï¼šè¶…è¿‡1ç§’çš„æŸ¥è¯¢æœ‰å¤šå°‘
- è¿žæŽ¥æ± ä½¿ç”¨çŽ‡ï¼šæ•°æ®åº“è¿žæŽ¥æ˜¯å¦å¤Ÿç”¨

åº”ç”¨å±‚é¢ï¼š
- å“åº”æ—¶é—´ï¼šæŽ¥å£å¹³å‡å“åº”æ—¶é—´
- åžåé‡ï¼šæ¯ç§’å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚
- é”™è¯¯çŽ‡ï¼šå¤±è´¥è¯·æ±‚çš„æ¯”ä¾‹
- é˜Ÿåˆ—é•¿åº¦ï¼šå¾…å¤„ç†ä»»åŠ¡æ•°é‡
```

**ðŸ“‹ MySQLé”ç›‘æŽ§SQL**
```sql
-- æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    r.trx_query AS waiting_query,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    b.trx_query AS blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;

-- æŸ¥çœ‹æ­»é”åŽ†å²
SHOW ENGINE INNODB STATUS;
```

### 5.2 é—®é¢˜è¯Šæ–­æµç¨‹


**ðŸ”¸ æ€§èƒ½é—®é¢˜è¯Šæ–­æ­¥éª¤**
```
ç¬¬ä¸€æ­¥ï¼šç¡®è®¤é—®é¢˜
- ç”¨æˆ·åé¦ˆï¼šé¡µé¢å¾ˆæ…¢ã€æäº¤å¤±è´¥
- ç›‘æŽ§å‘Šè­¦ï¼šå“åº”æ—¶é—´è¶…è¿‡3ç§’

ç¬¬äºŒæ­¥ï¼šå®šä½ç“¶é¢ˆ
- æ£€æŸ¥åº”ç”¨æ—¥å¿—ï¼šæ˜¯å¦æœ‰å¼‚å¸¸
- æŸ¥çœ‹æ•°æ®åº“ç›‘æŽ§ï¼šé”ç­‰å¾…ã€æ…¢æŸ¥è¯¢
- åˆ†æžç³»ç»Ÿèµ„æºï¼šCPUã€å†…å­˜ä½¿ç”¨

ç¬¬ä¸‰æ­¥ï¼šåˆ†æžæ ¹å› 
- æ˜¯å¦æœ‰å¤§äº‹åŠ¡é•¿æ—¶é—´ä¸æäº¤
- æ˜¯å¦ç¼ºå°‘å¿…è¦çš„ç´¢å¼•
- æ˜¯å¦å­˜åœ¨çƒ­ç‚¹æ•°æ®ç«žäº‰

ç¬¬å››æ­¥ï¼šåˆ¶å®šæ–¹æ¡ˆ
- çŸ­æœŸè§£å†³ï¼šé‡å¯ã€æ€æŽ‰é•¿äº‹åŠ¡
- é•¿æœŸä¼˜åŒ–ï¼šåŠ ç´¢å¼•ã€æ”¹æž¶æž„
```

### 5.3 å®¹é‡è§„åˆ’


**ðŸ”¸ å®¹é‡è§„åˆ’çš„åŸºæœ¬æ€è·¯**
```
å®¹é‡è§„åˆ’å°±æ˜¯æå‰è®¡ç®—ï¼š
- ç³»ç»Ÿèƒ½æ‰¿å—å¤šå°‘å¹¶å‘ç”¨æˆ·
- æ•°æ®åº“èƒ½å¤„ç†å¤šå°‘TPS
- ä»€ä¹ˆæ—¶å€™éœ€è¦æ‰©å®¹

å°±åƒï¼š
- é¤åŽ…è¦ç®—èƒ½åå¤šå°‘äºº
- é«˜å³°æœŸéœ€è¦å‡ ä¸ªæœåŠ¡å‘˜
- ä»€ä¹ˆæ—¶å€™è¦å¼€åˆ†åº—
```

**ðŸ“Š å®¹é‡è®¡ç®—ç¤ºä¾‹**
```
å‡è®¾åœºæ™¯ï¼šç”µå•†ç³»ç»Ÿ
- æ³¨å†Œç”¨æˆ·ï¼š100ä¸‡
- æ—¥æ´»ç”¨æˆ·ï¼š10ä¸‡ï¼ˆ10%ï¼‰
- é«˜å³°æœŸç”¨æˆ·ï¼š3ä¸‡ï¼ˆ30%ï¼‰
- å¹³å‡æ“ä½œï¼šæ¯ç”¨æˆ·æ¯åˆ†é’Ÿ3æ¬¡æ“ä½œ

è®¡ç®—å…¬å¼ï¼š
é«˜å³°æœŸTPS = 30000 Ã— 3 Ã· 60 = 1500 TPS

MySQLå•æœºæžé™ï¼šçº¦2000-3000 TPS
ç»“è®ºï¼šå½“å‰é…ç½®åŸºæœ¬å¤Ÿç”¨ï¼Œä½†è¦è€ƒè™‘ï¼š
- æ•°æ®å¢žé•¿ï¼šæ˜Žå¹´å¯èƒ½ç¿»å€
- æ´»åŠ¨é«˜å³°ï¼šåŒ11å¯èƒ½5å€æµé‡
- æ•…éšœå®¹ç¾ï¼šè¦é¢„ç•™50%ä½™é‡

å»ºè®®ï¼šå‡†å¤‡è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ
```

---

## 6. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŽŒæ¡çš„ä¼˜åŒ–æ€è·¯


```
ðŸ”¸ åˆ†å±‚ä¼˜åŒ–ç­–ç•¥ï¼š
æž¶æž„å±‚ â†’ è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€ç¼“å­˜
æ•°æ®åº“å±‚ â†’ ç´¢å¼•ä¼˜åŒ–ã€é”ç²’åº¦ã€äº‹åŠ¡ä¼˜åŒ–  
åº”ç”¨å±‚ â†’ é˜Ÿåˆ—åŒ–ã€å¼‚æ­¥å¤„ç†ã€çƒ­ç‚¹å¤„ç†

ðŸ”¸ æ ¸å¿ƒä¼˜åŒ–åŽŸåˆ™ï¼š
èƒ½ç¼“å­˜çš„ä¸æŸ¥åº“ï¼Œèƒ½å¼‚æ­¥çš„ä¸åŒæ­¥
èƒ½åˆ†æ•£çš„ä¸é›†ä¸­ï¼Œèƒ½é¢„é˜²çš„ä¸æ²»ç†
```

### 6.2 å®žæˆ˜åº”ç”¨è¦ç‚¹


**ðŸ”¹ ä¼˜åŒ–ä¼˜å…ˆçº§**
```
ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šæž¶æž„ä¼˜åŒ–
- æ”¶ç›Šæœ€å¤§ï¼Œå½±å“æœ€æ·±è¿œ
- è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨

ç¬¬äºŒä¼˜å…ˆçº§ï¼šç¼“å­˜ä¼˜åŒ–  
- å¿«é€Ÿè§æ•ˆï¼Œæˆæœ¬è¾ƒä½Ž
- Redisç¼“å­˜ã€æœ¬åœ°ç¼“å­˜

ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šSQLä¼˜åŒ–
- é’ˆå¯¹æ€§å¼ºï¼ŒæŠ€æœ¯é—¨æ§›é«˜
- ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢é‡å†™
```

**ðŸ”¹ é€‰æ‹©æ ‡å‡†**
```
è¯»å¤šå†™å°‘ â†’ è¯»å†™åˆ†ç¦» + ç¼“å­˜
å†™å¤šè¯»å°‘ â†’ åˆ†åº“åˆ†è¡¨ + é˜Ÿåˆ—
çƒ­ç‚¹æ•°æ® â†’ ç¼“å­˜ + åˆ†å¸ƒå¼é”
å¤æ‚ä¸šåŠ¡ â†’ å¼‚æ­¥å¤„ç† + ç›‘æŽ§
```

### 6.3 é¿å…çš„å¸¸è§è¯¯åŒº


**âš ï¸ å¸¸è§é”™è¯¯åšæ³•**
- **è¿‡åº¦ä¼˜åŒ–**ï¼šæ²¡é—®é¢˜å°±å¼€å§‹åˆ†åº“åˆ†è¡¨
- **ç›²ç›®åˆ†ç‰‡**ï¼šä¸è€ƒè™‘ä¸šåŠ¡ç‰¹ç‚¹ä¹±åˆ†è¡¨  
- **å¿½è§†ç›‘æŽ§**ï¼šä¸Šäº†ä¼˜åŒ–æ–¹æ¡ˆä¸çœ‹æ•ˆæžœ
- **ä¸€æ­¥åˆ°ä½**ï¼šæƒ³ä¸€æ¬¡è§£å†³æ‰€æœ‰é—®é¢˜

**âœ… æ­£ç¡®çš„ä¼˜åŒ–æ€è·¯**
```
å¾ªåºæ¸è¿›çš„ä¼˜åŒ–è·¯å¾„ï¼š
å•æœºä¼˜åŒ– â†’ è¯»å†™åˆ†ç¦» â†’ åˆ†åº“åˆ†è¡¨ â†’ å¾®æœåŠ¡

æ¯ä¸ªé˜¶æ®µéƒ½è¦ï¼š
1. å…ˆç›‘æŽ§ï¼Œäº†è§£çŽ°çŠ¶
2. æ‰¾ç“¶é¢ˆï¼Œç¡®å®šé—®é¢˜  
3. é€‰æ–¹æ¡ˆï¼Œå°èŒƒå›´è¯•éªŒ
4. å…¨æŽ¨å¹¿ï¼ŒæŒç»­ç›‘æŽ§
```

**ðŸŽ¯ æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- é«˜å¹¶å‘é”ä¼˜åŒ–æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦å¤šå±‚æ¬¡é…åˆ
- ç¼“å­˜å’Œå¼‚æ­¥æ˜¯æœ€æœ‰æ•ˆçš„ä¸¤ä¸ªä¼˜åŒ–æ‰‹æ®µ
- ç›‘æŽ§æ˜¯ä¼˜åŒ–çš„åŸºç¡€ï¼Œæ²¡æœ‰ç›‘æŽ§å°±æ˜¯ç›²äººæ‘¸è±¡
- ä¼˜åŒ–è¦å¾ªåºæ¸è¿›ï¼Œä¸è¦æƒ³ç€ä¸€æ­¥åˆ°ä½

**å®žè·µå»ºè®®**ï¼šå…ˆä»Žç¼“å­˜å¼€å§‹ï¼Œå†è€ƒè™‘è¯»å†™åˆ†ç¦»ï¼Œæœ€åŽæ‰æ˜¯åˆ†åº“åˆ†è¡¨