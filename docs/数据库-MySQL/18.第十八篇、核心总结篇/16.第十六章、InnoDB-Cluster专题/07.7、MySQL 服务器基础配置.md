---
title: 7、MySQL 服务器基础配置
---
## 📚 目录

1. [MySQL 8.0 安装配置](#1-mysql-80-安装配置)
2. [配置文件优化](#2-配置文件优化)
3. [用户权限设置](#3-用户权限设置)
4. [网络参数配置](#4-网络参数配置)
5. [日志配置管理](#5-日志配置管理)
6. [性能参数调优](#6-性能参数调优)
7. [安全配置加固](#7-安全配置加固)
8. [服务启动配置](#8-服务启动配置)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🚀 MySQL 8.0 安装配置


### 1.1 什么是MySQL 8.0


**简单理解**：MySQL 8.0 是目前MySQL最新的主要版本，相比之前的版本有很多重要改进和新特性。

```
MySQL版本演进：
MySQL 5.7 → MySQL 8.0 (跨越式升级)
   ↓           ↓
 稳定版本    新一代版本
```

**🔸 MySQL 8.0 核心特点**
```
性能提升：
• 查询速度比5.7快2倍
• 更好的并发处理能力
• 优化的存储引擎

新功能特性：
• 窗口函数支持
• JSON数据类型增强
• 角色权限管理
• 原子DDL操作

安全性增强：
• 默认加密连接
• 密码验证组件
• 审计日志功能
```

### 1.2 安装前的环境准备


**💻 系统要求检查**

```bash
# 检查操作系统版本
cat /etc/os-release

# 检查可用内存(建议至少4GB)
free -h

# 检查磁盘空间(建议至少20GB)
df -h

# 检查网络连接
ping mysql.com -c 3
```

**🔧 必需的系统工具**
```bash
# CentOS/RHEL系统
yum update -y
yum install -y wget curl vim

# Ubuntu/Debian系统  
apt update
apt install -y wget curl vim
```

### 1.3 MySQL 8.0 安装步骤


#### 📦 方式一：官方RPM包安装(推荐)


```bash
# 1. 下载MySQL官方仓库
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm

# 2. 安装仓库配置
rpm -ivh mysql80-community-release-el7-3.noarch.rpm

# 3. 安装MySQL服务器
yum install -y mysql-community-server

# 4. 启动MySQL服务
systemctl start mysqld
systemctl enable mysqld
```

> 💡 **安装说明**：官方RPM包安装是最稳定可靠的方式，会自动处理依赖关系

#### 📦 方式二：二进制包安装


```bash
# 1. 创建mysql用户
useradd -r -s /bin/false mysql

# 2. 下载二进制包
cd /opt
wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.35-linux-glibc2.12-x86_64.tar.xz

# 3. 解压安装
tar xf mysql-8.0.35-linux-glibc2.12-x86_64.tar.xz
ln -s mysql-8.0.35-linux-glibc2.12-x86_64 mysql

# 4. 设置权限
chown -R mysql:mysql /opt/mysql
```

### 1.4 初始化配置


**🔑 获取初始密码**
```bash
# 查看临时密码(安装后自动生成)
grep 'temporary password' /var/log/mysqld.log

# 输出示例：
# 2024-01-17T10:30:45.123456Z 6 [Note] A temporary password is generated for root@localhost: kL#5tR9pX2nM
```

**🔐 首次登录配置**
```bash
# 使用临时密码登录
mysql -u root -p

# 修改root密码(必须先改密码才能执行其他操作)
ALTER USER 'root'@'localhost' IDENTIFIED BY 'YourNewPassword123!';

# 刷新权限
FLUSH PRIVILEGES;
```

> ⚠️ **密码要求**：MySQL 8.0 默认要求强密码(至少8位，包含大小写字母、数字、特殊字符)

---

## 2. ⚙️ 配置文件优化


### 2.1 MySQL配置文件位置


**📁 配置文件查找顺序**
```
Linux系统配置文件位置(按优先级)：
1. /etc/my.cnf          ← 全局配置文件
2. /etc/mysql/my.cnf    ← 系统配置文件  
3. ~/.my.cnf            ← 用户配置文件
4. --defaults-file      ← 命令行指定配置

Windows系统：
1. C:\my.ini
2. C:\my.cnf
3. WINDIR\my.ini
```

**🔍 查看当前使用的配置文件**
```bash
# 查看MySQL读取的配置文件位置
mysql --help | grep "Default options" -A 1

# 查看当前生效的配置
mysql -e "SHOW VARIABLES LIKE 'datadir';"
```

### 2.2 基础配置文件结构


**📋 my.cnf 文件基本结构**
```ini
# MySQL配置文件 - /etc/my.cnf

[client]
# 客户端相关配置
port = 3306
socket = /var/lib/mysql/mysql.sock

[mysql]  
# mysql命令行工具配置
default-character-set = utf8mb4

[mysqld]
# MySQL服务器核心配置
port = 3306
datadir = /var/lib/mysql
socket = /var/lib/mysql/mysql.sock
user = mysql

# 字符集配置
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

[mysqldump]
# 备份工具配置
single-transaction
routines
triggers
```

**🔸 配置段说明**
- **[client]**：影响所有MySQL客户端程序(mysql、mysqldump等)
- **[mysql]**：只影响mysql命令行客户端
- **[mysqld]**：MySQL服务器端配置(最重要)
- **[mysqldump]**：mysqldump备份工具配置

### 2.3 字符集配置优化


**🌐 字符集配置详解**

> 💡 **为什么要配置字符集**：确保数据库能正确存储和显示中文、emoji等多语言字符

```ini
[mysqld]
# 服务器字符集配置
character-set-server = utf8mb4        # 服务器默认字符集
collation-server = utf8mb4_unicode_ci # 默认排序规则

# 初始化配置
init_connect = 'SET NAMES utf8mb4'    # 客户端连接时自动设置字符集

[client]
default-character-set = utf8mb4       # 客户端默认字符集

[mysql]
default-character-set = utf8mb4       # mysql命令行工具字符集
```

**📊 字符集对比表**

| 字符集 | **占用空间** | **支持字符** | **推荐程度** |
|-------|------------|-------------|-------------|
| `latin1` | 1字节 | 西欧字符 | ❌ 不推荐 |
| `utf8` | 1-3字节 | 基本多语言 | ⚠️ 有限制 |
| `utf8mb4` | 1-4字节 | 完整Unicode | ✅ **强烈推荐** |

> 📝 **重要说明**：MySQL中的`utf8`实际上是`utf8mb3`，不能存储4字节字符(如emoji)，所以推荐使用`utf8mb4`

### 2.4 存储引擎配置


**🗄️ InnoDB引擎优化配置**
```ini
[mysqld]
# 默认存储引擎
default-storage-engine = InnoDB

# InnoDB缓冲池配置(重要性能参数)
innodb_buffer_pool_size = 1G          # 建议设为物理内存的70-80%
innodb_buffer_pool_instances = 4      # 缓冲池实例数

# 日志文件配置  
innodb_log_file_size = 256M           # 重做日志文件大小
innodb_log_files_in_group = 2         # 日志文件数量

# 文件格式配置
innodb_file_format = Barracuda        # 文件格式
innodb_file_per_table = ON            # 每个表单独文件
```

**💾 内存分配示例**
```
服务器总内存: 8GB
├── 系统占用: 1GB
├── InnoDB缓冲池: 5GB (62.5%)
├── 其他MySQL缓存: 1GB  
└── 预留内存: 1GB

计算公式:
innodb_buffer_pool_size = 服务器内存 × 70% (单实例)
innodb_buffer_pool_size = 服务器内存 × 50% (多实例)
```

---

## 3. 👥 用户权限设置


### 3.1 MySQL用户管理基础


**🔐 用户账号格式**
```
MySQL用户格式: '用户名'@'主机名'

示例：
'root'@'localhost'        # 只能本地登录的root用户
'app'@'192.168.1.%'      # 只能从192.168.1.x网段登录的app用户  
'backup'@'%'             # 可以从任何主机登录的backup用户
```

**📋 用户信息存储位置**
```sql
-- 查看所有用户
SELECT user, host, authentication_string FROM mysql.user;

-- 查看当前用户
SELECT USER(), CURRENT_USER();
```

### 3.2 创建和管理用户


**👤 创建普通应用用户**
```sql
-- 创建应用用户(推荐方式)
CREATE USER 'appuser'@'192.168.1.%' IDENTIFIED BY 'AppUser123!';

-- 授予数据库权限
GRANT SELECT, INSERT, UPDATE, DELETE ON myapp.* TO 'appuser'@'192.168.1.%';

-- 刷新权限表
FLUSH PRIVILEGES;
```

**👤 创建备份用户**
```sql
-- 创建专门的备份用户
CREATE USER 'backup'@'localhost' IDENTIFIED BY 'BackupUser123!';

-- 授予备份所需权限
GRANT SELECT, RELOAD, SHOW DATABASES, LOCK TABLES, REPLICATION CLIENT 
ON *.* TO 'backup'@'localhost';

FLUSH PRIVILEGES;
```

**👤 创建监控用户**
```sql  
-- 创建监控用户
CREATE USER 'monitor'@'localhost' IDENTIFIED BY 'MonitorUser123!';

-- 授予监控权限
GRANT SELECT, PROCESS, REPLICATION CLIENT ON *.* TO 'monitor'@'localhost';

FLUSH PRIVILEGES;
```

### 3.3 权限级别详解


**🏢 权限层级结构**
```
全局权限 (*.*)
    ↓
数据库权限 (database.*)  
    ↓
表权限 (database.table)
    ↓  
列权限 (database.table.column)
```

**📊 常用权限说明表**

| 权限类型 | **权限名称** | **作用说明** | **使用场景** |
|---------|-------------|-------------|-------------|
| **数据权限** | `SELECT` | 查询数据 | 应用读操作 |
|  | `INSERT` | 插入数据 | 应用写操作 |
|  | `UPDATE` | 修改数据 | 应用更新操作 |
|  | `DELETE` | 删除数据 | 应用删除操作 |
| **结构权限** | `CREATE` | 创建数据库/表 | 应用部署 |
|  | `ALTER` | 修改表结构 | 数据库升级 |
|  | `DROP` | 删除数据库/表 | 清理操作 |
| **管理权限** | `RELOAD` | 重载权限表 | 备份操作 |
|  | `PROCESS` | 查看进程列表 | 监控诊断 |
|  | `SUPER` | 超级用户权限 | 管理员操作 |

### 3.4 用户权限最佳实践


**🎯 权限分配原则**
```
最小权限原则：
• 应用用户：只授予必需的数据库操作权限
• 备份用户：只授予备份相关权限  
• 监控用户：只授予查看和监控权限
• 开发用户：限制在开发数据库范围内

用户分离原则：
• 生产环境：严格分离不同角色用户
• 测试环境：可以适当放宽权限
• 开发环境：便于开发但仍需基本安全
```

**🔒 安全配置检查清单**
- [x] 删除匿名用户
- [x] 删除test数据库
- [x] 禁用root远程登录
- [x] 设置强密码策略
- [x] 定期更换密码
- [x] 审计用户权限

```sql
-- 安全检查脚本
-- 1. 删除匿名用户
DELETE FROM mysql.user WHERE User='';

-- 2. 删除test数据库
DROP DATABASE IF EXISTS test;

-- 3. 禁用root远程登录(保留localhost)
DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');

FLUSH PRIVILEGES;
```

---

## 4. 🌐 网络参数配置


### 4.1 网络连接基础


**🔗 MySQL网络连接原理**
```
客户端连接过程：
客户端 → 网络 → MySQL端口(3306) → 连接验证 → 建立会话

连接方式：
1. TCP/IP连接：通过网络端口连接(默认3306)
2. Socket连接：本地套接字文件连接(更快)
3. 命名管道：Windows系统特有方式
```

### 4.2 端口和绑定配置


**🚪 端口配置详解**
```ini
[mysqld]
# 监听端口配置
port = 3306                    # MySQL服务端口(默认3306)

# 绑定地址配置
bind-address = 0.0.0.0        # 监听所有网络接口
# bind-address = 127.0.0.1    # 只监听本地连接  
# bind-address = 192.168.1.10 # 只监听指定IP

# Socket文件配置
socket = /var/lib/mysql/mysql.sock  # Unix socket文件位置
```

**📡 绑定地址选择指南**
```
生产环境建议：
• 内网服务：bind-address = 内网IP
• 集群环境：bind-address = 0.0.0.0  
• 单机应用：bind-address = 127.0.0.1

安全考虑：
• 避免暴露在公网
• 使用防火墙限制访问
• 配置SSL加密连接
```

### 4.3 连接数和超时配置


**👥 连接数控制配置**
```ini
[mysqld]
# 最大连接数配置
max_connections = 500              # 最大并发连接数
max_user_connections = 50          # 单个用户最大连接数
max_connect_errors = 100           # 连接错误后暂时阻止主机

# 连接超时配置
connect_timeout = 10               # 连接建立超时(秒)
interactive_timeout = 28800        # 交互式连接超时(8小时)
wait_timeout = 28800               # 非交互式连接超时(8小时)
```

**⏱️ 超时参数对比**

| 参数 | **作用范围** | **默认值** | **建议值** | **影响** |
|-----|-------------|-----------|-----------|---------|
| `connect_timeout` | 连接建立阶段 | 10秒 | 5-10秒 | 连接建立速度 |
| `wait_timeout` | 非交互连接 | 28800秒 | 3600秒 | 连接池管理 |
| `interactive_timeout` | 交互式连接 | 28800秒 | 28800秒 | 命令行操作 |

**📊 连接数规划计算**
```
连接数规划公式：
max_connections = 预期并发用户数 × 1.2 + 管理连接数

示例计算：
• Web应用预期：200并发用户
• 连接池大小：每个应用服务器20连接
• 应用服务器数量：5台
• 管理连接：20个

计算：max_connections = (5 × 20) + 20 + 20% = 120 + 20 = 140
推荐设置：max_connections = 200 (预留缓冲)
```

### 4.4 网络缓冲区配置


**📦 缓冲区大小调优**
```ini
[mysqld]
# 网络读取缓冲区
net_buffer_length = 16384         # 初始网络缓冲区(16KB)
max_allowed_packet = 64M          # 最大数据包大小

# 线程缓存配置
thread_cache_size = 8             # 线程缓存数量
thread_stack = 262144             # 每个线程栈大小(256KB)
```

**🔧 缓冲区调优指导**
```
max_allowed_packet 设置原则：
• 小数据应用：16M-32M
• 大数据应用：64M-128M  
• 有BLOB/TEXT：256M-512M

注意事项：
• 客户端和服务器端都要配置
• 过大会占用更多内存
• 过小会导致大查询失败
```

---

## 5. 📋 日志配置管理


### 5.1 MySQL日志类型概述


**📝 日志系统架构**
```
MySQL日志系统：
├── 错误日志 (Error Log)      ← 记录启动/运行错误
├── 查询日志 (General Log)    ← 记录所有SQL语句  
├── 慢查询日志 (Slow Log)     ← 记录执行慢的SQL
├── 二进制日志 (Binary Log)   ← 记录数据变更(主从复制)
└── 重做日志 (Redo Log)       ← InnoDB事务日志
```

**🎯 日志用途说明**
- **错误日志**：排查服务器启动和运行问题
- **查询日志**：审计和调试SQL语句
- **慢查询日志**：性能优化和问题诊断
- **二进制日志**：数据恢复和主从复制
- **重做日志**：事务持久性和崩溃恢复

### 5.2 错误日志配置


**❌ 错误日志设置**
```ini
[mysqld]
# 错误日志配置
log-error = /var/log/mysqld.log      # 错误日志文件位置
log_error_verbosity = 2              # 日志详细级别(1-3)

# 日志轮转配置(MySQL 8.0新特性)
log_error_services = 'log_filter_internal; log_sink_internal'
```

**📊 错误日志级别说明**

| 级别 | **数值** | **包含内容** | **适用场景** |
|-----|---------|------------|-------------|
| `Error` | 1 | 只记录错误信息 | 生产环境 |
| `Warning` | 2 | 错误+警告信息 | **推荐设置** |
| `Information` | 3 | 错误+警告+信息 | 调试环境 |

**🔍 错误日志分析技巧**
```bash
# 查看最新错误
tail -50 /var/log/mysqld.log

# 查找特定错误
grep -i "error" /var/log/mysqld.log

# 查看启动信息
grep -i "ready for connections" /var/log/mysqld.log
```

### 5.3 慢查询日志配置


**🐌 慢查询日志设置**
```ini
[mysqld]
# 开启慢查询日志
slow_query_log = ON                     # 启用慢查询日志
slow_query_log_file = /var/log/mysql-slow.log  # 慢查询日志文件

# 慢查询阈值配置
long_query_time = 2.0                   # 超过2秒的查询记录(可设置小数)
min_examined_row_limit = 100            # 至少检查100行才记录

# 记录选项
log_queries_not_using_indexes = ON      # 记录未使用索引的查询
log_slow_admin_statements = ON          # 记录慢的管理语句
```

**⏱️ 慢查询阈值设置指导**
```
环境类型建议：
• 开发环境：long_query_time = 0.5   (500毫秒)
• 测试环境：long_query_time = 1.0   (1秒)  
• 生产环境：long_query_time = 2.0   (2秒)

调优过程：
1. 初期设置较小值(0.5秒)发现问题
2. 优化后适当提高阈值(1-2秒)
3. 生产稳定后设为合理值(2-5秒)
```

**📈 慢查询日志分析**
```bash
# 使用mysqldumpslow分析慢查询
mysqldumpslow -s c -t 10 /var/log/mysql-slow.log

# 参数说明：
# -s c：按查询次数排序
# -s t：按查询时间排序  
# -t 10：显示前10条

# 分析输出示例：
# Count: 25  Time=5.32s (133s)  Lock=0.00s (0s)  Rows=1000.0 (25000), appuser[appuser]@[192.168.1.100]
# SELECT * FROM users WHERE created_at > 'S' ORDER BY id
```

### 5.4 二进制日志配置


**📂 二进制日志设置**
```ini
[mysqld]
# 二进制日志配置
log-bin = mysql-bin                     # 二进制日志文件前缀
binlog_format = ROW                     # 日志格式(ROW/STATEMENT/MIXED)
server-id = 1                           # 服务器ID(主从复制必需)

# 日志保留和清理
expire_logs_days = 7                    # 日志保留天数
max_binlog_size = 500M                  # 单个日志文件最大大小
binlog_cache_size = 32K                 # 二进制日志缓存大小
```

**📋 二进制日志格式对比**

| 格式 | **优点** | **缺点** | **适用场景** |
|-----|---------|---------|-------------|
| `STATEMENT` | 日志文件小 | 可能数据不一致 | 简单应用 |
| `ROW` | 数据一致性好 | 日志文件大 | **推荐使用** |
| `MIXED` | 自动选择 | 复杂度高 | 特殊需求 |

**🗑️ 日志清理和维护**
```sql
-- 查看二进制日志
SHOW BINARY LOGS;

-- 手动清理早期日志
PURGE BINARY LOGS BEFORE '2024-01-01 00:00:00';

-- 清理指定日志文件之前的日志
PURGE BINARY LOGS TO 'mysql-bin.000100';
```

---

## 6. 🚀 性能参数调优


### 6.1 内存相关参数


**🧠 内存分配原理**
```
MySQL内存使用分布：
├── 全局缓存 (所有连接共享)
│   ├── InnoDB缓冲池 (最重要)
│   ├── 查询缓存 (MySQL 8.0已移除)
│   └── 表缓存
└── 会话缓存 (每个连接独有)
    ├── 排序缓冲区
    ├── 连接缓冲区
    └── 读取缓冲区
```

**💾 核心内存参数配置**
```ini
[mysqld]
# InnoDB缓冲池(最重要的性能参数)
innodb_buffer_pool_size = 4G           # 建议为物理内存的70-80%
innodb_buffer_pool_instances = 4       # 缓冲池实例数(1GB对应1个实例)

# 表和索引缓存
table_open_cache = 4000                 # 表缓存数量
table_definition_cache = 2000           # 表定义缓存

# 会话级内存缓存
sort_buffer_size = 2M                   # 排序缓冲区大小
read_buffer_size = 128K                 # 顺序读缓冲区
read_rnd_buffer_size = 256K             # 随机读缓冲区
join_buffer_size = 256K                 # 连接缓冲区
```

**📊 内存参数调优指导**
```
服务器内存分配示例(8GB服务器)：
┌─────────────────────────────────┐
│ 系统内存: 8GB                    │
├─────────────────────────────────┤
│ 操作系统: 1.5GB (19%)           │
│ InnoDB缓冲池: 5GB (62%)         │  ← 最关键参数
│ 其他MySQL缓存: 1GB (12%)        │
│ 预留内存: 0.5GB (7%)            │
└─────────────────────────────────┘

计算公式：
innodb_buffer_pool_size = 服务器内存 × 70%
```

### 6.2 连接和线程参数


**🔗 连接线程优化**
```ini
[mysqld]
# 连接数配置
max_connections = 500                   # 最大连接数
max_user_connections = 100              # 单用户最大连接数

# 线程管理
thread_cache_size = 50                  # 线程缓存大小
thread_handling = pool-of-threads       # 线程处理方式(MySQL 8.0)
thread_pool_size = 16                   # 线程池大小

# 连接超时
wait_timeout = 3600                     # 连接超时(1小时)
interactive_timeout = 3600              # 交互超时
```

**⚡ 线程缓存调优方法**
```sql
-- 查看线程缓存命中率
SHOW STATUS LIKE 'Threads_created';
SHOW STATUS LIKE 'Connections';

-- 计算线程缓存命中率
-- 命中率 = (Connections - Threads_created) / Connections × 100%
-- 目标：命中率 > 90%

-- 如果命中率低，增加thread_cache_size
```

### 6.3 查询优化参数


**🔍 查询性能参数**
```ini
[mysqld]
# 查询缓存(MySQL 8.0已移除，此处为历史参考)
# query_cache_type = ON
# query_cache_size = 256M

# 临时表配置
tmp_table_size = 64M                    # 内存临时表最大大小
max_heap_table_size = 64M               # MEMORY引擎表最大大小

# 排序和分组优化
max_sort_length = 1024                  # 排序使用的字符数
group_concat_max_len = 1024             # GROUP_CONCAT最大长度

# 索引相关
key_buffer_size = 256M                  # MyISAM索引缓冲区(如果使用MyISAM)
```

**📈 查询优化策略**
```
查询性能优化步骤：
1. 启用慢查询日志 → 发现问题SQL
2. 使用EXPLAIN分析 → 了解执行计划  
3. 添加合适索引 → 提高查询效率
4. 优化SQL语句 → 减少资源消耗
5. 调整相关参数 → 提升整体性能

常见性能瓶颈：
• 缺少索引：查询全表扫描
• 排序操作：使用filesort
• 临时表：Using temporary
• 连接操作：没有使用索引连接
```

### 6.4 InnoDB存储引擎调优


**🗄️ InnoDB核心参数**
```ini
[mysqld]
# 事务日志配置
innodb_log_file_size = 512M             # 重做日志文件大小
innodb_log_files_in_group = 2           # 日志文件组数量  
innodb_log_buffer_size = 16M            # 日志缓冲区大小

# I/O配置
innodb_io_capacity = 2000               # I/O容量(SSD建议2000-5000)
innodb_io_capacity_max = 4000           # 最大I/O容量
innodb_read_io_threads = 8              # 读I/O线程数
innodb_write_io_threads = 8             # 写I/O线程数

# 刷新策略
innodb_flush_method = O_DIRECT          # 绕过操作系统缓存
innodb_flush_log_at_trx_commit = 1      # 事务提交时刷新日志
```

**💿 存储类型优化建议**
```
机械硬盘(HDD)配置：
innodb_io_capacity = 200
innodb_io_capacity_max = 400
innodb_flush_method = O_DIRECT

固态硬盘(SSD)配置：
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000  
innodb_flush_method = O_DIRECT

NVMe SSD配置：
innodb_io_capacity = 5000
innodb_io_capacity_max = 10000
innodb_flush_method = O_DIRECT_NO_FSYNC
```

---

## 7. 🔒 安全配置加固


### 7.1 用户账号安全


**👤 用户安全基础配置**
```sql
-- 1. 删除匿名用户
DELETE FROM mysql.user WHERE User = '';

-- 2. 删除默认test数据库
DROP DATABASE IF EXISTS test;
DELETE FROM mysql.db WHERE Db = 'test' OR Db = 'test\\_%';

-- 3. 限制root用户只能本地登录
DELETE FROM mysql.user WHERE User = 'root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');

-- 4. 刷新权限
FLUSH PRIVILEGES;
```

**🔐 密码策略配置**
```ini
[mysqld]
# 密码验证插件(MySQL 8.0默认启用)
plugin-load-add = validate_password.so

# 密码策略配置
validate_password.policy = MEDIUM          # 密码策略级别
validate_password.length = 8               # 最小密码长度
validate_password.number_count = 1         # 至少包含数字个数
validate_password.special_char_count = 1   # 至少包含特殊字符个数
validate_password.mixed_case_count = 1     # 至少包含大小写字母个数
```

**📋 密码策略级别说明**

| 策略级别 | **要求** | **适用场景** |
|---------|---------|-------------|
| `LOW` | 只检查长度 | 开发环境 |
| `MEDIUM` | 长度+数字+大小写+特殊字符 | **推荐设置** |
| `STRONG` | MEDIUM要求+字典检查 | 高安全环境 |

### 7.2 网络安全配置


**🌐 SSL/TLS加密配置**
```ini
[mysqld]
# SSL配置(MySQL 8.0默认启用)
ssl-ca = /var/lib/mysql/ca.pem             # CA证书
ssl-cert = /var/lib/mysql/server-cert.pem  # 服务器证书
ssl-key = /var/lib/mysql/server-key.pem    # 服务器私钥

# 强制SSL连接
require_secure_transport = ON              # 要求加密连接

# TLS版本控制
tls_version = TLSv1.2,TLSv1.3            # 支持的TLS版本
```

**🔒 创建SSL用户**
```sql
-- 创建要求SSL连接的用户
CREATE USER 'ssluser'@'%' IDENTIFIED BY 'SecurePassword123!' REQUIRE SSL;

-- 创建要求特定证书的用户  
CREATE USER 'certuser'@'%' IDENTIFIED BY 'CertPassword123!' 
REQUIRE X509;

-- 授权并刷新
GRANT SELECT ON myapp.* TO 'ssluser'@'%';
FLUSH PRIVILEGES;
```

### 7.3 访问控制配置


**🚪 网络访问限制**
```ini
[mysqld]
# 绑定特定IP(安全起见)
bind-address = 192.168.1.100              # 只绑定内网IP

# 连接限制
max_connections = 200                      # 限制总连接数
max_user_connections = 20                  # 限制单用户连接数
max_connect_errors = 10                    # 连接错误限制
```

**🛡️ 防火墙配置示例**
```bash
# CentOS/RHEL防火墙配置
# 只允许特定网段访问MySQL
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="3306" accept'

# 重载防火墙配置
firewall-cmd --reload

# Ubuntu/Debian使用ufw
ufw allow from 192.168.1.0/24 to any port 3306
```

### 7.4 审计和监控


**📊 审计日志配置**
```ini
[mysqld]
# 审计插件(企业版功能,社区版可用第三方插件)
plugin-load = audit_log.so
audit_log_file = /var/log/mysql-audit.log
audit_log_policy = ALL                     # 审计所有操作
audit_log_rotate_on_size = 100M           # 日志轮转大小
```

**👁️ 安全监控检查项**
- [x] 监控失败登录尝试
- [x] 监控权限变更操作
- [x] 监控异常查询行为
- [x] 定期检查用户权限
- [x] 监控慢查询日志
- [x] 检查SSL连接状态

```sql
-- 安全监控查询示例
-- 查看当前连接
SELECT user, host, db, command, time, state FROM information_schema.processlist;

-- 查看失败连接(需要开启相关日志)
SHOW STATUS LIKE 'Aborted_connects';

-- 查看SSL连接状态
SHOW STATUS LIKE 'Ssl_cipher';
```

---

## 8. 🚀 服务启动配置


### 8.1 系统服务管理


**⚙️ systemd服务配置**
```bash
# 查看MySQL服务状态
systemctl status mysqld

# 启动MySQL服务
systemctl start mysqld

# 停止MySQL服务  
systemctl stop mysqld

# 重启MySQL服务
systemctl restart mysqld

# 设置开机自启动
systemctl enable mysqld

# 取消开机自启动
systemctl disable mysqld
```

**📝 自定义systemd服务文件**
```ini
# /etc/systemd/system/mysqld.service
[Unit]
Description=MySQL Server
Documentation=man:mysqld(8)
Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html
After=network.target
After=syslog.target

[Install]
WantedBy=multi-user.target

[Service]
User=mysql
Group=mysql
Type=notify
TimeoutSec=0
PermissionsStartOnly=true
ExecStartPre=/usr/bin/mysqld_pre_systemd
ExecStart=/usr/sbin/mysqld --daemonize --pid-file=/var/run/mysqld/mysqld.pid $MYSQLD_OPTS
LimitNOFILE=10000
Restart=on-failure
RestartPreventExitStatus=1
Environment=MYSQLD_PARENT_PID=1
PrivateTmp=false
```

### 8.2 启动参数配置


**🔧 启动选项配置**
```ini
[mysqld_safe]
# mysqld_safe脚本配置
log-error = /var/log/mysqld.log           # 错误日志位置
pid-file = /var/run/mysqld/mysqld.pid     # PID文件位置

[mysqld]
# 基础启动配置
user = mysql                              # 运行用户
basedir = /usr                           # MySQL安装目录
datadir = /var/lib/mysql                 # 数据目录
socket = /var/lib/mysql/mysql.sock       # Socket文件
pid-file = /var/run/mysqld/mysqld.pid    # PID文件

# 安全启动选项
skip-symbolic-links                       # 禁用符号链接
skip-name-resolve                         # 跳过域名解析(提高性能)
```

### 8.3 环境变量配置


**🌍 MySQL环境变量**
```bash
# 在/etc/profile或~/.bashrc中添加
export PATH=$PATH:/usr/bin:/usr/sbin
export MYSQL_HOME=/usr
export MYSQL_USER=mysql

# 客户端连接环境变量
export MYSQL_HOST=localhost
export MYSQL_PORT=3306
export MYSQL_USER=root
```

**📁 文件权限设置**
```bash
# 设置MySQL数据目录权限
chown -R mysql:mysql /var/lib/mysql
chmod 750 /var/lib/mysql

# 设置配置文件权限
chown root:mysql /etc/my.cnf
chmod 644 /etc/my.cnf

# 设置日志文件权限
chown mysql:mysql /var/log/mysqld.log
chmod 640 /var/log/mysqld.log
```

### 8.4 开机自启动优化


**🏃 启动顺序优化**
```bash
# 设置MySQL在网络服务之后启动
systemctl edit mysqld

# 在编辑器中添加：
[Unit]
After=network-online.target
Wants=network-online.target

# 保存并重载systemd配置
systemctl daemon-reload
```

**⏱️ 启动超时配置**
```ini
# /etc/systemd/system/mysqld.service.d/timeout.conf
[Service]
TimeoutStartSec=300                       # 启动超时时间(5分钟)
TimeoutStopSec=120                        # 停止超时时间(2分钟)
```

**🔍 启动状态检查**
```bash
# 检查启动状态脚本
#!/bin/bash
echo "检查MySQL服务状态..."
systemctl is-active mysqld

echo "检查MySQL连接..."
mysql -e "SELECT 1" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "MySQL连接正常"
else
    echo "MySQL连接失败"
fi

echo "检查MySQL进程..."
ps aux | grep mysqld | grep -v grep
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心配置


**🎯 配置优先级**
```
关键配置项重要性排序：
1. 安全配置 → 用户权限、密码策略、SSL加密
2. 内存配置 → innodb_buffer_pool_size、连接数
3. 字符集配置 → utf8mb4字符集设置
4. 日志配置 → 错误日志、慢查询日志、二进制日志
5. 网络配置 → 端口绑定、连接超时
6. 性能配置 → InnoDB参数、缓存设置
```

### 9.2 配置文件最佳实践


**📝 配置管理建议**
```
配置文件组织：
• 使用模块化配置(分段管理)
• 添加详细注释说明
• 版本控制管理配置文件
• 环境隔离(开发/测试/生产)

配置变更流程：
1. 备份当前配置
2. 在测试环境验证
3. 分阶段部署到生产
4. 监控配置效果
5. 必要时回滚配置
```

**⚡ 性能优化重点**
```
内存优化核心：
innodb_buffer_pool_size = 物理内存 × 70%

连接优化核心：  
max_connections = 预期并发 × 1.2

日志优化核心：
• 错误日志：必须开启
• 慢查询日志：性能调优必备
• 二进制日志：数据安全必备
```

### 9.3 常见配置问题


**❌ 配置误区对照**

| 配置项 | **错误做法** | **正确做法** | **影响** |
|-------|-------------|-------------|---------|
| `innodb_buffer_pool_size` | 设置过小(256M) | 物理内存的70% | 性能严重影响 |
| `max_connections` | 设置过大(5000) | 根据实际需求设置 | 内存浪费 |
| `字符集` | 使用utf8 | 使用utf8mb4 | 无法存储emoji |
| `bind-address` | 绑定0.0.0.0 | 绑定内网IP | 安全风险 |
| `密码策略` | 关闭验证 | 启用强密码策略 | 安全风险 |

### 9.4 监控和维护


**📊 关键监控指标**
- **连接数**：当前连接/最大连接比例
- **缓冲池命中率**：> 99%为正常
- **慢查询数量**：趋势监控
- **错误日志**：异常信息监控
- **磁盘空间**：数据目录和日志目录
- **内存使用**：防止OOM

**🔧 定期维护任务**
- [x] 每日检查错误日志
- [x] 每周分析慢查询日志  
- [x] 每月清理过期二进制日志
- [x] 每季度检查用户权限
- [x] 每半年更新密码
- [x] 每年审查配置参数

**核心记忆要点**：
- MySQL配置文件是服务器性能和安全的基础
- 内存配置(特别是InnoDB缓冲池)是性能关键
- 用户权限和网络安全配置决定系统安全性
- 日志配置是排错和优化的重要工具
- 定期监控和维护确保系统稳定运行