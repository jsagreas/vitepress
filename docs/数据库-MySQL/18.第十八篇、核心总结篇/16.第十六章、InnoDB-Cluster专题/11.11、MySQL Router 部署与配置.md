---
title: 11ã€MySQL Router éƒ¨ç½²ä¸é…ç½®
---
## ğŸ“š ç›®å½•

1. [MySQL Router åŸºç¡€æ¦‚å¿µ](#1-mysql-router-åŸºç¡€æ¦‚å¿µ)
2. [Router å®‰è£…éƒ¨ç½²](#2-router-å®‰è£…éƒ¨ç½²)
3. [Bootstrap è‡ªåŠ¨é…ç½®](#3-bootstrap-è‡ªåŠ¨é…ç½®)
4. [é…ç½®æ–‡ä»¶è¯¦è§£](#4-é…ç½®æ–‡ä»¶è¯¦è§£)
5. [è·¯ç”±è§„åˆ™è®¾ç½®](#5-è·¯ç”±è§„åˆ™è®¾ç½®)
6. [è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡](#6-è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡)
7. [å¥åº·æ£€æŸ¥é…ç½®](#7-å¥åº·æ£€æŸ¥é…ç½®)
8. [å¯åŠ¨ä¸æœåŠ¡ç®¡ç†](#8-å¯åŠ¨ä¸æœåŠ¡ç®¡ç†)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒ MySQL Router åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MySQL Router


**é€šä¿—ç†è§£**ï¼šMySQL Routerå°±åƒæ˜¯ä¸€ä¸ª**æ™ºèƒ½äº¤é€šæŒ‡æŒ¥å‘˜**ï¼Œå¸®ä½ æŠŠæ•°æ®åº“è¿æ¥è¯·æ±‚åˆç†åˆ†é…åˆ°é›†ç¾¤ä¸­çš„å„ä¸ªMySQLæœåŠ¡å™¨ä¸Šã€‚

```
åº”ç”¨ç¨‹åº â†’ MySQL Router â†’ InnoDB Cluster
         (æ™ºèƒ½åˆ†å‘)     (ä¸»ä»é›†ç¾¤)

å°±åƒï¼š
å®¢æˆ· â†’ é¤å…æœåŠ¡å‘˜ â†’ ä¸åŒçš„å¨å¸ˆ
     (æ™ºèƒ½åˆ†é…)   (ä¸»å¨ã€å‰¯å¨)
```

### 1.2 Routerçš„æ ¸å¿ƒä½œç”¨


**ğŸ¯ ä¸»è¦åŠŸèƒ½**ï¼š
- **è¯»å†™åˆ†ç¦»**ï¼šè‡ªåŠ¨æŠŠå†™æ“ä½œå‘åˆ°ä¸»èŠ‚ç‚¹ï¼Œè¯»æ“ä½œå‘åˆ°ä»èŠ‚ç‚¹
- **è´Ÿè½½å‡è¡¡**ï¼šæŠŠå¤šä¸ªè¯»è¯·æ±‚å¹³å‡åˆ†é…ç»™å¤šä¸ªä»èŠ‚ç‚¹
- **æ•…éšœè½¬ç§»**ï¼šä¸»èŠ‚ç‚¹æŒ‚äº†è‡ªåŠ¨åˆ‡æ¢åˆ°æ–°ä¸»èŠ‚ç‚¹
- **è¿æ¥ä»£ç†**ï¼šåº”ç”¨åªéœ€è¿æ¥Routerï¼Œä¸ç”¨å…³å¿ƒåç«¯æœ‰å‡ ä¸ªæ•°æ®åº“

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šä½ è¦åƒé¥­ï¼Œéœ€è¦çŸ¥é“å“ªä¸ªå¨å¸ˆåœ¨å·¥ä½œï¼Œå“ªä¸ªå¨å¸ˆæ‰‹è‰ºå¥½
Routeræ–¹å¼ï¼šä½ åªéœ€è¦å‘Šè¯‰æœåŠ¡å‘˜è¦åƒä»€ä¹ˆï¼ŒæœåŠ¡å‘˜è‡ªåŠ¨å®‰æ’æœ€åˆé€‚çš„å¨å¸ˆ
```

### 1.3 Routeråœ¨é›†ç¾¤ä¸­çš„ä½ç½®


**ğŸ—ï¸ æ¶æ„ç¤ºæ„å›¾**ï¼š
```
åº”ç”¨å±‚    [App1] [App2] [App3]
           |      |      |
ä»£ç†å±‚        [MySQL Router]
           |              |
           |    è´Ÿè½½å‡è¡¡    |
           |              |
æ•°æ®å±‚  [Primary] [Secondary1] [Secondary2]
        (ä¸»èŠ‚ç‚¹)  (ä»èŠ‚ç‚¹1)   (ä»èŠ‚ç‚¹2)
```

---

## 2. ğŸ“¦ Router å®‰è£…éƒ¨ç½²


### 2.1 å®‰è£…å‰å‡†å¤‡


**ğŸ“‹ ç¯å¢ƒè¦æ±‚**ï¼š
- æ“ä½œç³»ç»Ÿï¼šCentOS 7+ã€Ubuntu 18+ã€Windows Server
- MySQLç‰ˆæœ¬ï¼š8.0.11+
- ç½‘ç»œï¼šRouterèƒ½è®¿é—®é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹
- æƒé™ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™å®‰è£…

**ğŸ” æ£€æŸ¥ç¯å¢ƒ**ï¼š
```bash
# æ£€æŸ¥æ“ä½œç³»ç»Ÿç‰ˆæœ¬
cat /etc/os-release

# æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping mysql-node1
ping mysql-node2
ping mysql-node3

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 6446
netstat -tlnp | grep 6447
```

### 2.2 å®‰è£…æ–¹å¼å¯¹æ¯”


| å®‰è£…æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ **YUM/APTåŒ…** | `ç®€å•å¿«é€Ÿï¼Œè‡ªåŠ¨ä¾èµ–` | `ç‰ˆæœ¬å¯èƒ½ä¸æ˜¯æœ€æ–°` | `ç”Ÿäº§ç¯å¢ƒæ¨è` |
| ğŸ’¿ **RPM/DEBåŒ…** | `ç‰ˆæœ¬å¯æ§ï¼Œç¦»çº¿å®‰è£…` | `éœ€æ‰‹åŠ¨å¤„ç†ä¾èµ–` | `å†…ç½‘ç¯å¢ƒ` |
| ğŸ“‚ **äºŒè¿›åˆ¶åŒ…** | `å…ç¼–è¯‘ï¼Œå³ç”¨` | `éœ€æ‰‹åŠ¨é…ç½®è·¯å¾„` | `å¿«é€Ÿæµ‹è¯•` |
| ğŸ”§ **æºç ç¼–è¯‘** | `è‡ªå®šä¹‰é€‰é¡¹å¤š` | `ç¼–è¯‘æ—¶é—´é•¿ï¼Œå¤æ‚` | `ç‰¹æ®Šéœ€æ±‚` |

### 2.3 YUMå®‰è£…ç¤ºä¾‹ï¼ˆæ¨èï¼‰


**ğŸ”§ CentOS/RHEL å®‰è£…æ­¥éª¤**ï¼š
```bash
# æ­¥éª¤1ï¼šæ·»åŠ MySQLå®˜æ–¹ä»“åº“
sudo yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm

# æ­¥éª¤2ï¼šå®‰è£…MySQL Router
sudo yum install -y mysql-router

# æ­¥éª¤3ï¼šéªŒè¯å®‰è£…
mysqlrouter --version
# MySQL Router v8.0.35 (2023-07-18)

# æ­¥éª¤4ï¼šæ£€æŸ¥å®‰è£…è·¯å¾„
which mysqlrouter
# /usr/bin/mysqlrouter
```

**ğŸ”§ Ubuntu/Debian å®‰è£…æ­¥éª¤**ï¼š
```bash
# æ­¥éª¤1ï¼šä¸‹è½½å¹¶å®‰è£…ä»“åº“é…ç½®
wget https://dev.mysql.com/get/mysql-apt-config_0.8.22-1_all.deb
sudo dpkg -i mysql-apt-config_0.8.22-1_all.deb

# æ­¥éª¤2ï¼šæ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# æ­¥éª¤3ï¼šå®‰è£…MySQL Router
sudo apt install -y mysql-router

# æ­¥éª¤4ï¼šéªŒè¯å®‰è£…
mysqlrouter --version
```

### 2.4 åˆ›å»ºRouterç”¨æˆ·


**ğŸ‘¤ ä¸ºä»€ä¹ˆéœ€è¦ä¸“é—¨çš„ç”¨æˆ·**ï¼š
Routeréœ€è¦ä¸€ä¸ªä¸“é—¨çš„ç³»ç»Ÿç”¨æˆ·æ¥è¿è¡Œï¼Œè¿™æ ·æ›´å®‰å…¨ï¼Œä¹Ÿä¾¿äºç®¡ç†ã€‚

```bash
# åˆ›å»ºmysqlç”¨æˆ·ç»„ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
sudo groupadd mysql

# åˆ›å»ºmysqlrouterç”¨æˆ·
sudo useradd -r -g mysql -s /bin/false mysqlrouter

# åˆ›å»ºå·¥ä½œç›®å½•
sudo mkdir -p /var/lib/mysqlrouter
sudo mkdir -p /var/log/mysqlrouter
sudo mkdir -p /etc/mysqlrouter

# è®¾ç½®ç›®å½•æƒé™
sudo chown -R mysqlrouter:mysql /var/lib/mysqlrouter
sudo chown -R mysqlrouter:mysql /var/log/mysqlrouter
sudo chown -R mysqlrouter:mysql /etc/mysqlrouter
```

---

## 3. ğŸš€ Bootstrap è‡ªåŠ¨é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯Bootstrap


**é€šä¿—è§£é‡Š**ï¼šBootstrapå°±æ˜¯**ä¸€é”®è‡ªåŠ¨é…ç½®**çš„æ„æ€ã€‚ä½ åªéœ€è¦å‘Šè¯‰Routerä½ çš„é›†ç¾¤åœ°å€ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„é…ç½®æ–‡ä»¶ã€‚

**ğŸ’¡ ç±»æ¯”**ï¼š
```
ä¼ ç»Ÿæ–¹å¼ï¼šè‡ªå·±æ‰‹å†™é…ç½®æ–‡ä»¶ï¼Œåƒæ‰‹å·¥åˆ¶ä½œä¸€ä»¶è¡£æœ
Bootstrapï¼šè‡ªåŠ¨ç”Ÿæˆé…ç½®ï¼Œåƒç”¨ç¼çº«æœºæ‰¹é‡ç”Ÿäº§
```

### 3.2 Bootstrapå‘½ä»¤è¯¦è§£


**ğŸ”¸ åŸºæœ¬è¯­æ³•**ï¼š
```bash
mysqlrouter --bootstrap [é›†ç¾¤è¿æ¥ä¿¡æ¯] [é€‰é¡¹]
```

**ğŸ“‹ å¸¸ç”¨å‚æ•°è¯´æ˜**ï¼š
- `--user`ï¼šæŒ‡å®šè¿è¡ŒRouterçš„ç”¨æˆ·
- `--directory`ï¼šæŒ‡å®šé…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•
- `--name`ï¼šç»™è¿™ä¸ªRouterå®ä¾‹èµ·ä¸ªåå­—
- `--conf-use-sockets`ï¼šä½¿ç”¨Unixå¥—æ¥å­—è¿æ¥ï¼ˆLinuxæ¨èï¼‰
- `--account`ï¼šåˆ›å»ºRouterä¸“ç”¨æ•°æ®åº“è´¦æˆ·

### 3.3 å®é™…Bootstrapæ“ä½œ


**ğŸ”§ å…¸å‹Bootstrapå‘½ä»¤**ï¼š
```bash
# åŸºç¡€é…ç½®ï¼ˆæœ€ç®€å•ï¼‰
sudo mysqlrouter --bootstrap clusteradmin@mysql-node1:3306 \
  --user=mysqlrouter

# å®Œæ•´é…ç½®ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
sudo mysqlrouter --bootstrap clusteradmin@mysql-node1:3306 \
  --directory=/etc/mysqlrouter \
  --user=mysqlrouter \
  --name=myrouter \
  --conf-use-sockets \
  --account=router_user \
  --account-host='%'
```

**ğŸ“ æ‰§è¡Œè¿‡ç¨‹è¯´æ˜**ï¼š
```
æ­£åœ¨æ‰§è¡ŒBootstrap...
æ­¥éª¤1: è¿æ¥åˆ°é›†ç¾¤å…ƒæ•°æ®æœåŠ¡å™¨ mysql-node1:3306
æ­¥éª¤2: è·å–é›†ç¾¤æ‹“æ‰‘ä¿¡æ¯
æ­¥éª¤3: åˆ›å»ºRouterä¸“ç”¨è´¦æˆ· 'router_user'@'%'
æ­¥éª¤4: ç”Ÿæˆé…ç½®æ–‡ä»¶ mysqlrouter.conf
æ­¥éª¤5: è®¾ç½®æ–‡ä»¶æƒé™
æ­¥éª¤6: åˆ›å»ºå¯åŠ¨è„šæœ¬

Bootstrapå®Œæˆï¼
```

### 3.4 BootstrapæˆåŠŸåçš„æ–‡ä»¶ç»“æ„


**ğŸ“‚ ç”Ÿæˆçš„ç›®å½•ç»“æ„**ï¼š
```
/etc/mysqlrouter/
â”œâ”€â”€ mysqlrouter.conf      # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ mysqlrouter.key       # Routerç§é’¥
â”œâ”€â”€ start.sh              # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.sh               # åœæ­¢è„šæœ¬
â””â”€â”€ data/                 # è¿è¡Œæ—¶æ•°æ®ç›®å½•
    â”œâ”€â”€ router.pid        # è¿›ç¨‹IDæ–‡ä»¶
    â”œâ”€â”€ router.sock       # Unixå¥—æ¥å­—æ–‡ä»¶
    â””â”€â”€ logs/             # æ—¥å¿—ç›®å½•
        â””â”€â”€ mysqlrouter.log
```

**ğŸ” æ£€æŸ¥Bootstrapç»“æœ**ï¼š
```bash
# æŸ¥çœ‹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶
sudo cat /etc/mysqlrouter/mysqlrouter.conf

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /etc/mysqlrouter/

# éªŒè¯Socketæ–‡ä»¶
ls -la /etc/mysqlrouter/data/
```

---

## 4. ğŸ“„ é…ç½®æ–‡ä»¶è¯¦è§£


### 4.1 é…ç½®æ–‡ä»¶åŸºæœ¬ç»“æ„


**ğŸ”¸ mysqlrouter.conf æ–‡ä»¶ç»„æˆ**ï¼š
```ini
[DEFAULT]              # å…¨å±€é»˜è®¤è®¾ç½®
[logger]               # æ—¥å¿—é…ç½®
[metadata_cache]       # å…ƒæ•°æ®ç¼“å­˜é…ç½®
[routing:primary]      # å†™å…¥è·¯ç”±é…ç½®
[routing:secondary]    # è¯»å–è·¯ç”±é…ç½®
```

### 4.2 DEFAULTèŠ‚é…ç½®è¯¦è§£


**ğŸ“‹ å…¨å±€é»˜è®¤é…ç½®**ï¼š
```ini
[DEFAULT]
# Routerè¿è¡Œç”¨æˆ·
user = mysqlrouter

# è¿›ç¨‹IDæ–‡ä»¶ä½ç½®
pid_file = /etc/mysqlrouter/data/router.pid

# é…ç½®æ–‡ä»¶ç›®å½•
config_folder = /etc/mysqlrouter

# è¿è¡Œæ—¶æ•°æ®ç›®å½•
runtime_folder = /etc/mysqlrouter/data

# æ—¥å¿—ç›®å½•
logging_folder = /etc/mysqlrouter/data/logs
```

### 4.3 æ—¥å¿—é…ç½®èŠ‚


**ğŸ“ loggerèŠ‚é…ç½®**ï¼š
```ini
[logger]
# æ—¥å¿—çº§åˆ«ï¼šDEBUG, INFO, WARNING, ERROR
level = INFO

# æ—¥å¿—è¾“å‡ºä½ç½®
sinks = filelog,consolelog

# æ–‡ä»¶æ—¥å¿—é…ç½®
[logger:filelog]
filename = mysqlrouter.log
# æ—¥å¿—è½®è½¬å¤§å°ï¼ˆ10MBï¼‰
max_size = 10485760
# ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
max_files = 5

# æ§åˆ¶å°æ—¥å¿—é…ç½®
[logger:consolelog]
# è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯
destination = stderr
```

### 4.4 å…ƒæ•°æ®ç¼“å­˜é…ç½®


**ğŸ—„ï¸ metadata_cacheèŠ‚**ï¼š
```ini
[metadata_cache:myrouter]
# é›†ç¾¤åç§°
cluster_type = gr
# è·¯ç”±å™¨å®ä¾‹å
router_id = 1

# é›†ç¾¤è¿æ¥ä¿¡æ¯
bootstrap_server_addresses = mysql-node1:3306,mysql-node2:3306,mysql-node3:3306

# æ•°æ®åº“è¿æ¥ç”¨æˆ·
user = router_user

# å…ƒæ•°æ®TTLï¼ˆç§’ï¼‰
metadata_cluster = myCluster

# è¿æ¥è¶…æ—¶æ—¶é—´
connect_timeout = 5
# è¯»å–è¶…æ—¶æ—¶é—´
read_timeout = 30
```

**ğŸ’¡ é…ç½®è¯´æ˜**ï¼š
- `cluster_type = gr`ï¼šè¡¨ç¤ºGroup Replicationé›†ç¾¤
- `router_id`ï¼šRouterå®ä¾‹çš„å”¯ä¸€æ ‡è¯†
- `bootstrap_server_addresses`ï¼šé›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨ï¼ŒRouterä¼šä»è¿™äº›èŠ‚ç‚¹è·å–é›†ç¾¤çŠ¶æ€
- `connect_timeout`ï¼šè¿æ¥è¶…æ—¶5ç§’ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…
- `read_timeout`ï¼šè¯»å–è¶…æ—¶30ç§’ï¼Œé€‚åˆå¤§å¤šæ•°æŸ¥è¯¢

---

## 5. ğŸ”€ è·¯ç”±è§„åˆ™è®¾ç½®


### 5.1 ä»€ä¹ˆæ˜¯è·¯ç”±è§„åˆ™


**é€šä¿—ç†è§£**ï¼šè·¯ç”±è§„åˆ™å°±æ˜¯å‘Šè¯‰Router**ä»€ä¹ˆæ ·çš„è¯·æ±‚å‘ç»™å“ªä¸ªæ•°æ®åº“èŠ‚ç‚¹**ï¼Œå°±åƒäº¤é€šè§„åˆ™å‘Šè¯‰è½¦è¾†è¯¥èµ°å“ªæ¡è·¯ã€‚

```
å†™è¯·æ±‚ï¼ˆINSERT/UPDATE/DELETEï¼‰ â†’ ä¸»èŠ‚ç‚¹
è¯»è¯·æ±‚ï¼ˆSELECTï¼‰              â†’ ä»èŠ‚ç‚¹
```

### 5.2 ä¸»èŠ‚ç‚¹è·¯ç”±é…ç½®


**ğŸ”¸ routing:primaryèŠ‚ï¼ˆå†™å…¥è·¯ç”±ï¼‰**ï¼š
```ini
[routing:primary]
# ç»‘å®šåœ°å€å’Œç«¯å£
bind_address = 0.0.0.0
bind_port = 6446

# ç›®æ ‡æœåŠ¡å™¨
destinations = metadata-cache://myrouter/default?role=PRIMARY

# è·¯ç”±ç­–ç•¥
routing_strategy = first-available

# åè®®ç±»å‹
protocol = classic

# è¿æ¥è¶…æ—¶
connect_timeout = 5
```

**ğŸ“‹ é…ç½®è¯¦è§£**ï¼š
- `bind_port = 6446`ï¼š**å†™å…¥ç«¯å£**ï¼Œåº”ç”¨è¿æ¥è¿™ä¸ªç«¯å£è¿›è¡Œå†™æ“ä½œ
- `role=PRIMARY`ï¼šåªè·¯ç”±åˆ°**ä¸»èŠ‚ç‚¹**
- `routing_strategy = first-available`ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨çš„ä¸»èŠ‚ç‚¹
- `protocol = classic`ï¼šä½¿ç”¨ä¼ ç»ŸMySQLåè®®

### 5.3 ä»èŠ‚ç‚¹è·¯ç”±é…ç½®


**ğŸ”¸ routing:secondaryèŠ‚ï¼ˆè¯»å–è·¯ç”±ï¼‰**ï¼š
```ini
[routing:secondary]
# ç»‘å®šåœ°å€å’Œç«¯å£
bind_address = 0.0.0.0
bind_port = 6447

# ç›®æ ‡æœåŠ¡å™¨
destinations = metadata-cache://myrouter/default?role=SECONDARY

# è·¯ç”±ç­–ç•¥
routing_strategy = round-robin

# åè®®ç±»å‹
protocol = classic

# æœ€å¤§è¿æ¥æ•°
max_connections = 512

# è¿æ¥è¶…æ—¶
connect_timeout = 5
```

**ğŸ“‹ é…ç½®è¯¦è§£**ï¼š
- `bind_port = 6447`ï¼š**è¯»å–ç«¯å£**ï¼Œåº”ç”¨è¿æ¥è¿™ä¸ªç«¯å£è¿›è¡Œè¯»æ“ä½œ
- `role=SECONDARY`ï¼šåªè·¯ç”±åˆ°**ä»èŠ‚ç‚¹**
- `routing_strategy = round-robin`ï¼š**è½®è¯¢**è´Ÿè½½å‡è¡¡
- `max_connections = 512`ï¼šæœ€å¤§512ä¸ªå¹¶å‘è¿æ¥

### 5.4 è·¯ç”±ç­–ç•¥è¯¦è§£


| ç­–ç•¥ç±»å‹ | **å·¥ä½œåŸç†** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|---------|-------------|-------------|-----------|
| ğŸ”„ **round-robin** | `è½®æµåˆ†é…è¯·æ±‚` | `è¯»è´Ÿè½½å‡è¡¡` | `ç®€å•å…¬å¹³ï¼Œä½†ä¸è€ƒè™‘æ€§èƒ½` |
| ğŸ¯ **first-available** | `ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹` | `å†™æ“ä½œè·¯ç”±` | `ç®€å•å¯é ï¼Œä½†è´Ÿè½½ä¸å‡` |
| ğŸ² **next-available** | `å¾ªç¯é€‰æ‹©å¯ç”¨èŠ‚ç‚¹` | `è¯»è´Ÿè½½å‡è¡¡` | `åˆ†å¸ƒå‡åŒ€ï¼Œé€‚åˆè¯»å¯†é›†` |

### 5.5 å®Œæ•´è·¯ç”±é…ç½®ç¤ºä¾‹


**ğŸ“„ å®é™…ç”Ÿäº§é…ç½®**ï¼š
```ini
# è¯»å†™åˆ†ç¦»å®Œæ•´é…ç½®
[routing:primary_rw]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://myrouter/default?role=PRIMARY
routing_strategy = first-available
protocol = classic
connect_timeout = 5
client_connect_timeout = 9

[routing:secondary_ro]
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://myrouter/default?role=SECONDARY
routing_strategy = round-robin
protocol = classic
max_connections = 1000
connect_timeout = 5
client_connect_timeout = 9

# è¯»å†™æ··åˆç«¯å£ï¼ˆè‡ªåŠ¨åˆ†å‘ï¼‰
[routing:primary_and_secondary]
bind_address = 0.0.0.0
bind_port = 6448
destinations = metadata-cache://myrouter/default?role=PRIMARY_AND_SECONDARY
routing_strategy = round-robin
protocol = classic
```

---

## 6. ğŸŠ è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡


### 6.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± 


**é€šä¿—ç†è§£**ï¼šè¿æ¥æ± å°±åƒ**åœè½¦åœº**ï¼Œé¢„å…ˆå‡†å¤‡å¥½ä¸€å®šæ•°é‡çš„æ•°æ®åº“è¿æ¥ï¼Œåº”ç”¨éœ€è¦æ—¶ç›´æ¥å–ç”¨ï¼Œç”¨å®Œå½’è¿˜ï¼Œé¿å…é¢‘ç¹å»ºç«‹å’Œå…³é—­è¿æ¥ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼š
åº”ç”¨ â†’ å»ºç«‹è¿æ¥ â†’ æŸ¥è¯¢ â†’ å…³é—­è¿æ¥ ï¼ˆæ¯æ¬¡éƒ½è¦æ¡æ‰‹ï¼‰

è¿æ¥æ± æ–¹å¼ï¼š
åº”ç”¨ â†’ ä»æ± ä¸­å–è¿æ¥ â†’ æŸ¥è¯¢ â†’ å½’è¿˜è¿æ¥ ï¼ˆå¤ç”¨è¿æ¥ï¼‰
```

### 6.2 è¿æ¥æ± é…ç½®å‚æ•°


**ğŸ”§ è¿æ¥æ± æ ¸å¿ƒå‚æ•°**ï¼š
```ini
[routing:secondary_ro]
# æœ€å¤§è¿æ¥æ•°
max_connections = 1000

# æœ€å¤§è¿æ¥ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
client_connect_timeout = 9

# æœåŠ¡å™¨è¿æ¥è¶…æ—¶ï¼ˆç§’ï¼‰
connect_timeout = 5

# ç©ºé—²è¿æ¥ä¿æŒæ—¶é—´
server_connect_timeout = 5
```

**ğŸ“Š å‚æ•°è¯´æ˜è¡¨**ï¼š
| å‚æ•° | **å«ä¹‰** | **æ¨èå€¼** | **å½±å“** |
|------|---------|-----------|---------|
| `max_connections` | **æœ€å¤§å¹¶å‘è¿æ¥æ•°** | `500-2000` | `å¤ªå°å½±å“å¹¶å‘ï¼Œå¤ªå¤§æ¶ˆè€—å†…å­˜` |
| `client_connect_timeout` | **å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶** | `5-10ç§’` | `å¤ªçŸ­è¿æ¥å¤±è´¥ï¼Œå¤ªé•¿å“åº”æ…¢` |
| `connect_timeout` | **åç«¯è¿æ¥è¶…æ—¶** | `3-5ç§’` | `åç«¯æ•°æ®åº“è¿æ¥æ—¶é—´` |

### 6.3 è´Ÿè½½å‡è¡¡ç®—æ³•


**ğŸ”„ Round-Robinï¼ˆè½®è¯¢ï¼‰**ï¼š
```
è¯·æ±‚åˆ†å‘é¡ºåºï¼š
è¯·æ±‚1 â†’ èŠ‚ç‚¹A
è¯·æ±‚2 â†’ èŠ‚ç‚¹B  
è¯·æ±‚3 â†’ èŠ‚ç‚¹C
è¯·æ±‚4 â†’ èŠ‚ç‚¹A ï¼ˆå¾ªç¯ï¼‰

ä¼˜ç‚¹ï¼šç®€å•å…¬å¹³ï¼Œæ¯ä¸ªèŠ‚ç‚¹è·å¾—ç›¸ç­‰è¯·æ±‚
ç¼ºç‚¹ï¼šä¸è€ƒè™‘èŠ‚ç‚¹æ€§èƒ½å·®å¼‚
```

**âš¡ First-Availableï¼ˆé¦–é€‰å¯ç”¨ï¼‰**ï¼š
```
èŠ‚ç‚¹é€‰æ‹©é€»è¾‘ï¼š
1. æ£€æŸ¥èŠ‚ç‚¹Aæ˜¯å¦å¯ç”¨ â†’ å¯ç”¨å°±ç”¨A
2. Aä¸å¯ç”¨ï¼Œæ£€æŸ¥èŠ‚ç‚¹B â†’ å¯ç”¨å°±ç”¨B  
3. Bä¹Ÿä¸å¯ç”¨ï¼Œæ£€æŸ¥èŠ‚ç‚¹C â†’ å¯ç”¨å°±ç”¨C

ä¼˜ç‚¹ï¼šç®€å•å¯é ï¼Œå»¶è¿Ÿæœ€ä½
ç¼ºç‚¹ï¼šå¯èƒ½å¯¼è‡´è´Ÿè½½ä¸å‡
```

### 6.4 è´Ÿè½½å‡è¡¡é…ç½®ç¤ºä¾‹


**ğŸ”§ è¯»èŠ‚ç‚¹è´Ÿè½½å‡è¡¡é…ç½®**ï¼š
```ini
[routing:read_load_balance]
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://myrouter/default?role=SECONDARY
routing_strategy = round-robin

# è¿æ¥æ± è®¾ç½®
max_connections = 800
max_connect_errors = 100

# å¥åº·æ£€æŸ¥
connect_timeout = 3
client_connect_timeout = 8

# æƒé‡è®¾ç½®ï¼ˆå¦‚æœæ”¯æŒï¼‰
server_weight = 1
```

### 6.5 æ€§èƒ½è°ƒä¼˜å»ºè®®


**âš¡ è¿æ¥æ± å¤§å°è®¡ç®—**ï¼š
```
è¿æ¥æ± å¤§å° = åº”ç”¨å¹¶å‘æ•° Ã— 1.2

ç¤ºä¾‹ï¼š
åº”ç”¨æœ‰500ä¸ªå¹¶å‘ç”¨æˆ·
æ¨èè¿æ¥æ± å¤§å° = 500 Ã— 1.2 = 600
```

**ğŸ¯ è°ƒä¼˜ç­–ç•¥**ï¼š
- **å°å‹åº”ç”¨**ï¼ˆ<100å¹¶å‘ï¼‰ï¼š`max_connections = 150`
- **ä¸­å‹åº”ç”¨**ï¼ˆ100-500å¹¶å‘ï¼‰ï¼š`max_connections = 600-800`
- **å¤§å‹åº”ç”¨**ï¼ˆ>500å¹¶å‘ï¼‰ï¼š`max_connections = 1000+`

---

## 7. ğŸ¥ å¥åº·æ£€æŸ¥é…ç½®


### 7.1 ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥


**é€šä¿—ç†è§£**ï¼šå¥åº·æ£€æŸ¥å°±åƒ**åŒ»ç”Ÿå®šæœŸä½“æ£€**ï¼ŒRouterä¼šå®šæœŸæ£€æŸ¥åç«¯æ•°æ®åº“èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå‘ç°é—®é¢˜åŠæ—¶å‰”é™¤æ•…éšœèŠ‚ç‚¹ã€‚

```
å¥åº·æ£€æŸ¥æµç¨‹ï¼š
Router â†’ å‘é€æ£€æŸ¥å‘½ä»¤ â†’ MySQLèŠ‚ç‚¹
       â† è¿”å›çŠ¶æ€ä¿¡æ¯ â† 

æ­£å¸¸ï¼šç»§ç»­æä¾›æœåŠ¡
å¼‚å¸¸ï¼šæš‚æ—¶å‰”é™¤ï¼Œç­‰å¾…æ¢å¤
```

### 7.2 å¥åº·æ£€æŸ¥ç±»å‹


**ğŸ” æ£€æŸ¥æ–¹å¼å¯¹æ¯”**ï¼š
| æ£€æŸ¥ç±»å‹ | **æ£€æŸ¥å†…å®¹** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|-------------|---------|---------|
| ğŸ”Œ **è¿æ¥æ£€æŸ¥** | `èƒ½å¦å»ºç«‹è¿æ¥` | `å¿«é€Ÿç®€å•` | `åªæ£€æŸ¥è¿é€šæ€§` |
| ğŸ“Š **æ€§èƒ½æ£€æŸ¥** | `å“åº”æ—¶é—´å»¶è¿Ÿ` | `åæ˜ çœŸå®æ€§èƒ½` | `æ£€æŸ¥å¼€é”€å¤§` |
| ğŸ—„ï¸ **çŠ¶æ€æ£€æŸ¥** | `èŠ‚ç‚¹è§’è‰²çŠ¶æ€` | `å‡†ç¡®åæ˜ é›†ç¾¤çŠ¶æ€` | `éœ€è¦ç‰¹æ®Šæƒé™` |

### 7.3 åŸºç¡€å¥åº·æ£€æŸ¥é…ç½®


**ğŸ”§ åœ¨è·¯ç”±é…ç½®ä¸­æ·»åŠ å¥åº·æ£€æŸ¥**ï¼š
```ini
[routing:secondary_ro]
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://myrouter/default?role=SECONDARY

# å¥åº·æ£€æŸ¥å‚æ•°
connect_timeout = 3          # è¿æ¥è¶…æ—¶3ç§’
client_connect_timeout = 8   # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶8ç§’
max_connect_errors = 20      # æœ€å¤§è¿æ¥é”™è¯¯æ¬¡æ•°

# å¤±è´¥å¤„ç†
server_connect_timeout = 5   # æœåŠ¡å™¨è¿æ¥è¶…æ—¶
read_timeout = 30           # è¯»å–è¶…æ—¶
```

### 7.4 é«˜çº§å¥åº·æ£€æŸ¥é…ç½®


**ğŸ” å…ƒæ•°æ®ç¼“å­˜å¥åº·æ£€æŸ¥**ï¼š
```ini
[metadata_cache:myrouter]
# å…ƒæ•°æ®åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
ttl = 0.5

# æ£€æŸ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰
auth_cache_refresh_interval = 2000

# è¿æ¥å¤±è´¥é‡è¯•é—´éš”
auth_cache_timeout = 5

# é›†ç¾¤çŠ¶æ€æ£€æŸ¥
cluster_type = gr
router_id = 1
```

**ğŸ“Š å‚æ•°å«ä¹‰è¯¦è§£**ï¼š
- `ttl = 0.5`ï¼šæ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çŠ¶æ€ï¼ˆé«˜é¢‘æ£€æŸ¥ï¼‰
- `auth_cache_refresh_interval = 2000`ï¼šæ¯2ç§’åˆ·æ–°è®¤è¯ç¼“å­˜
- `auth_cache_timeout = 5`ï¼šè®¤è¯è¶…æ—¶5ç§’

### 7.5 æ•…éšœè½¬ç§»é…ç½®


**ğŸ”„ è‡ªåŠ¨æ•…éšœè½¬ç§»æœºåˆ¶**ï¼š
```
æ•…éšœæ£€æµ‹æµç¨‹ï¼š
1. Routeræ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹å¼‚å¸¸
2. æ ‡è®°ä¸»èŠ‚ç‚¹ä¸ºä¸å¯ç”¨
3. ç­‰å¾…Group Replicationé€‰ä¸¾æ–°ä¸»èŠ‚ç‚¹
4. Routerè·å–æ–°çš„é›†ç¾¤æ‹“æ‰‘
5. è‡ªåŠ¨è·¯ç”±åˆ°æ–°ä¸»èŠ‚ç‚¹

æ—¶é—´çº¿ï¼š
æ•…éšœå‘ç”Ÿ â†’ æ£€æµ‹åˆ°æ•…éšœ(3ç§’) â†’ é€‰ä¸¾æ–°ä¸»(10-30ç§’) â†’ è·¯ç”±åˆ‡æ¢(1ç§’)
```

**âš ï¸ å…³é”®é…ç½®**ï¼š
```ini
[metadata_cache:myrouter]
# å¿«é€Ÿæ•…éšœæ£€æµ‹
ttl = 1

# è¿æ¥å¤±è´¥é˜ˆå€¼
connect_timeout = 2
max_connect_errors = 5

# å¿«é€Ÿé‡è¯•
bootstrap_server_addresses = node1:3306,node2:3306,node3:3306
```

### 7.6 ç›‘æ§å¥åº·æ£€æŸ¥çŠ¶æ€


**ğŸ“ˆ æŸ¥çœ‹RouterçŠ¶æ€**ï¼š
```bash
# æŸ¥çœ‹Routerè¿›ç¨‹çŠ¶æ€
sudo systemctl status mysqlrouter

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo tail -f /etc/mysqlrouter/data/logs/mysqlrouter.log

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep mysqlrouter
```

**ğŸ” åˆ†ææ—¥å¿—å…³é”®ä¿¡æ¯**ï¼š
```
# æ­£å¸¸æ—¥å¿—ç¤ºä¾‹
2024-01-22 10:30:15 INFO [routing] routing instance 'secondary_ro' started
2024-01-22 10:30:16 INFO [metadata_cache] Cluster metadata cache refreshed

# æ•…éšœæ—¥å¿—ç¤ºä¾‹  
2024-01-22 10:35:20 WARNING [routing] Can't connect to MySQL server on 'node2:3306'
2024-01-22 10:35:21 INFO [metadata_cache] Primary node changed from node2 to node1
```

---

## 8. ğŸš€ å¯åŠ¨ä¸æœåŠ¡ç®¡ç†


### 8.1 å¯åŠ¨æ–¹å¼å¯¹æ¯”


| å¯åŠ¨æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| ğŸ”§ **æ‰‹åŠ¨å¯åŠ¨** | `ç®€å•ç›´æ¥ï¼Œä¾¿äºè°ƒè¯•` | `è¿›ç¨‹ç®¡ç†éº»çƒ¦` | `å¼€å‘æµ‹è¯•` |
| ğŸ¤– **systemdæœåŠ¡** | `è‡ªåŠ¨é‡å¯ï¼Œå¼€æœºå¯åŠ¨` | `é…ç½®ç¨å¤æ‚` | `ç”Ÿäº§ç¯å¢ƒ` |
| ğŸ“œ **initè„šæœ¬** | `ä¼ ç»Ÿå…¼å®¹æ€§å¥½` | `åŠŸèƒ½æœ‰é™` | `è€ç‰ˆæœ¬ç³»ç»Ÿ` |

### 8.2 æ‰‹åŠ¨å¯åŠ¨Router


**ğŸ”§ åŸºæœ¬å¯åŠ¨å‘½ä»¤**ï¼š
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å¯åŠ¨
sudo mysqlrouter

# æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨
sudo mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf

# åå°è¿è¡Œ
sudo mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf &

# æŒ‡å®šç”¨æˆ·è¿è¡Œ
sudo -u mysqlrouter mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf
```

**ğŸ“ å¯åŠ¨è¿‡ç¨‹æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥å¯åŠ¨æ—¥å¿—
sudo tail -f /etc/mysqlrouter/data/logs/mysqlrouter.log

# éªŒè¯ç«¯å£ç›‘å¬
netstat -tlnp | grep 6446  # å†™ç«¯å£
netstat -tlnp | grep 6447  # è¯»ç«¯å£

# æ£€æŸ¥è¿›ç¨‹çŠ¶æ€
ps aux | grep mysqlrouter
```

### 8.3 åˆ›å»ºsystemdæœåŠ¡


**ğŸ“„ åˆ›å»ºæœåŠ¡æ–‡ä»¶**ï¼š
```bash
sudo vim /etc/systemd/system/mysqlrouter.service
```

**ğŸ”§ æœåŠ¡é…ç½®å†…å®¹**ï¼š
```ini
[Unit]
Description=MySQL Router
Documentation=man:mysqlrouter(1)
After=network.target
Wants=network.target

[Service]
Type=notify
User=mysqlrouter
Group=mysql

# æœåŠ¡å¯åŠ¨å‘½ä»¤
ExecStart=/usr/bin/mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf

# è¿›ç¨‹ç®¡ç†
Restart=always
RestartSec=3
TimeoutStopSec=60

# å®‰å…¨è®¾ç½®
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/etc/mysqlrouter/data
ReadWritePaths=/var/log/mysqlrouter

# èµ„æºé™åˆ¶
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
```

### 8.4 æœåŠ¡ç®¡ç†å‘½ä»¤


**ğŸ® systemdç®¡ç†å‘½ä»¤**ï¼š
```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start mysqlrouter

# åœæ­¢æœåŠ¡
sudo systemctl stop mysqlrouter

# é‡å¯æœåŠ¡
sudo systemctl restart mysqlrouter

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status mysqlrouter

# å¼€æœºè‡ªå¯åŠ¨
sudo systemctl enable mysqlrouter

# ç¦ç”¨å¼€æœºå¯åŠ¨
sudo systemctl disable mysqlrouter

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u mysqlrouter -f
```

### 8.5 éªŒè¯Routerå·¥ä½œçŠ¶æ€


**ğŸ” è¿æ¥æµ‹è¯•**ï¼š
```bash
# æµ‹è¯•å†™ç«¯å£è¿æ¥ï¼ˆä¸»èŠ‚ç‚¹ï¼‰
mysql -h 127.0.0.1 -P 6446 -u appuser -p

# æµ‹è¯•è¯»ç«¯å£è¿æ¥ï¼ˆä»èŠ‚ç‚¹ï¼‰
mysql -h 127.0.0.1 -P 6447 -u appuser -p

# åœ¨MySQLä¸­æŸ¥çœ‹å½“å‰è¿æ¥çš„èŠ‚ç‚¹
SELECT $$hostname, $$server_id;
```

**ğŸ“Š çŠ¶æ€ç›‘æ§**ï¼š
```bash
# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
sudo ss -tlnp | grep mysqlrouter

# ç›‘æ§èµ„æºä½¿ç”¨
top -p $(pgrep mysqlrouter)

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo grep ERROR /etc/mysqlrouter/data/logs/mysqlrouter.log
```

### 8.6 å¸¸è§å¯åŠ¨é—®é¢˜æ’æŸ¥


**ğŸ”§ é—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š

**é—®é¢˜1ï¼šç«¯å£è¢«å ç”¨**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 6446

# æ‰¾åˆ°å ç”¨è¿›ç¨‹å¹¶ç»ˆæ­¢
sudo kill -9 <PID>
```

**é—®é¢˜2ï¼šæƒé™é—®é¢˜**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /etc/mysqlrouter/

# ä¿®æ­£æƒé™
sudo chown -R mysqlrouter:mysql /etc/mysqlrouter/
sudo chmod 755 /etc/mysqlrouter/
sudo chmod 600 /etc/mysqlrouter/mysqlrouter.conf
```

**é—®é¢˜3ï¼šé…ç½®æ–‡ä»¶é”™è¯¯**
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --validate-config

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
sudo mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --verbose
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Routerä½œç”¨ï¼šæ™ºèƒ½ä»£ç†ï¼Œå®ç°è¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡
ğŸ”¸ Bootstrapï¼šä¸€é”®è‡ªåŠ¨é…ç½®ï¼Œè¿æ¥é›†ç¾¤ç”Ÿæˆé…ç½®æ–‡ä»¶
ğŸ”¸ è·¯ç”±è§„åˆ™ï¼š6446å†™ç«¯å£è¿ä¸»èŠ‚ç‚¹ï¼Œ6447è¯»ç«¯å£è¿ä»èŠ‚ç‚¹
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šround-robinè½®è¯¢åˆ†å‘ï¼Œfirst-availableé¦–é€‰å¯ç”¨
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šå®šæœŸæ£€æµ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»
ğŸ”¸ æœåŠ¡ç®¡ç†ï¼šsystemdç®¡ç†ï¼Œæ”¯æŒè‡ªåŠ¨é‡å¯å’Œå¼€æœºå¯åŠ¨
```

### 9.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ Bootstrapæœ€ä½³å®è·µ**ï¼š
```bash
# æ¨èçš„Bootstrapå‘½ä»¤
sudo mysqlrouter --bootstrap clusteradmin@node1:3306 \
  --directory=/etc/mysqlrouter \
  --user=mysqlrouter \
  --conf-use-sockets \
  --account=router_user
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®**ï¼š
```ini
# è¿æ¥æ± è®¾ç½®
max_connections = 1000
connect_timeout = 3
client_connect_timeout = 8

# å¥åº·æ£€æŸ¥
ttl = 1
max_connect_errors = 10

# æ—¥å¿—é…ç½®
level = INFO
max_size = 10485760
max_files = 10
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
- **é«˜å¯ç”¨æ€§**ï¼šä¸»èŠ‚ç‚¹æ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Œä¸šåŠ¡ä¸ä¸­æ–­
- **è¯»å†™åˆ†ç¦»**ï¼šå†™æ“ä½œå‘ä¸»èŠ‚ç‚¹ï¼Œè¯»æ“ä½œå‘ä»èŠ‚ç‚¹ï¼Œæå‡æ€§èƒ½
- **è´Ÿè½½å‡è¡¡**ï¼šå¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»å‹åŠ›ï¼Œå……åˆ†åˆ©ç”¨èµ„æº
- **ç®€åŒ–åº”ç”¨**ï¼šåº”ç”¨åªéœ€è¿æ¥Routerï¼Œæ— éœ€æ„ŸçŸ¥é›†ç¾¤æ‹“æ‰‘å˜åŒ–

**ğŸ”§ è¿ç»´å®è·µè¦ç‚¹**ï¼š
- **ç›‘æ§æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥Routeræ—¥å¿—ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
- **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®ä¸šåŠ¡è´Ÿè½½è°ƒæ•´è¿æ¥æ± å¤§å°
- **å¤‡ä»½é…ç½®**ï¼šé‡è¦é…ç½®æ–‡ä»¶è¦å¤‡ä»½ï¼Œä¾¿äºå¿«é€Ÿæ¢å¤
- **ç‰ˆæœ¬ç®¡ç†**ï¼šRouterç‰ˆæœ¬è¦ä¸MySQLç‰ˆæœ¬åŒ¹é…

**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Routeræ˜¯InnoDB Clusterçš„æ™ºèƒ½æµé‡åˆ†å‘å™¨
- Bootstrapä¸€é”®é…ç½®ï¼Œ6446å†™6447è¯»
- systemdç®¡ç†æœåŠ¡ï¼Œå¥åº·æ£€æŸ¥ä¿å¯ç”¨
- é…ç½®è°ƒä¼˜é‡è¦ï¼Œç›‘æ§æ—¥å¿—ä¸èƒ½å°‘