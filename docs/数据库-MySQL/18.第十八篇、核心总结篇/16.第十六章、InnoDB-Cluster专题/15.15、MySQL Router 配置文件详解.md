---
title: 15ã€MySQL Router é…ç½®æ–‡ä»¶è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [MySQL Router é…ç½®æ–‡ä»¶æ¦‚è¿°](#1-mysql-router-é…ç½®æ–‡ä»¶æ¦‚è¿°)
2. [mysqlrouter.conf æ–‡ä»¶ç»“æ„](#2-mysqlrouterconf-æ–‡ä»¶ç»“æ„)
3. [DEFAULT å…¨å±€é…ç½®è¯¦è§£](#3-default-å…¨å±€é…ç½®è¯¦è§£)
4. [routing è·¯ç”±é…ç½®è¯¦è§£](#4-routing-è·¯ç”±é…ç½®è¯¦è§£)
5. [logger æ—¥å¿—é…ç½®è¯¦è§£](#5-logger-æ—¥å¿—é…ç½®è¯¦è§£)
6. [æ ¸å¿ƒé…ç½®å‚æ•°æ·±å…¥è§£æ](#6-æ ¸å¿ƒé…ç½®å‚æ•°æ·±å…¥è§£æ)
7. [å®è·µé…ç½®ç¤ºä¾‹](#7-å®è·µé…ç½®ç¤ºä¾‹)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ MySQL Router é…ç½®æ–‡ä»¶æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯ MySQL Router é…ç½®æ–‡ä»¶


**åŸºæœ¬æ¦‚å¿µ**ï¼š
MySQL Router çš„é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ª **INI æ ¼å¼** çš„æ–‡æœ¬æ–‡ä»¶ï¼Œé€šå¸¸å‘½åä¸º `mysqlrouter.conf`ã€‚è¿™ä¸ªæ–‡ä»¶å‘Šè¯‰ MySQL Routerï¼š
- è¦è¿æ¥åˆ°å“ªäº› MySQL æœåŠ¡å™¨
- å¦‚ä½•åˆ†å‘å®¢æˆ·ç«¯è¯·æ±‚
- è®°å½•ä»€ä¹ˆæ ·çš„æ—¥å¿—ä¿¡æ¯
- ä½¿ç”¨ä»€ä¹ˆæ ·çš„è·¯ç”±ç­–ç•¥

**é€šä¿—ç†è§£**ï¼š
```
æƒ³è±¡ MySQL Router æ˜¯ä¸€ä¸ªæ™ºèƒ½çš„"äº¤é€šæŒ‡æŒ¥å‘˜"
é…ç½®æ–‡ä»¶å°±æ˜¯ç»™è¿™ä¸ªæŒ‡æŒ¥å‘˜çš„"å·¥ä½œæ‰‹å†Œ"
æ‰‹å†Œé‡Œå†™æ˜äº†ï¼š
- å“ªäº›è·¯å£éœ€è¦æŒ‡æŒ¥ï¼ˆbind_addressï¼‰
- è½¦è¾†è¦å»å“ªäº›ç›®çš„åœ°ï¼ˆdestinationsï¼‰
- ç”¨ä»€ä¹ˆè§„åˆ™åˆ†é…è½¦é“ï¼ˆrouting_strategyï¼‰
- æœ€å¤šèƒ½é€šè¿‡å¤šå°‘è½¦ï¼ˆmax_connectionsï¼‰
```

### 1.2 é…ç½®æ–‡ä»¶çš„ä½œç”¨


**ğŸ¯ æ ¸å¿ƒä½œç”¨**ï¼š
- **æœåŠ¡å‘ç°**ï¼šè‡ªåŠ¨å‘ç° InnoDB Cluster ä¸­çš„èŠ‚ç‚¹
- **è´Ÿè½½å‡è¡¡**ï¼šå°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„ MySQL å®ä¾‹
- **æ•…éšœè½¬ç§»**ï¼šå½“ä¸»èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨èŠ‚ç‚¹
- **è¿æ¥ç®¡ç†**ï¼šæ§åˆ¶è¿æ¥æ•°å’Œè¿æ¥è¡Œä¸º

**ğŸ“ æ–‡ä»¶ä½ç½®**ï¼š
```bash
# Linux ç³»ç»Ÿå¸¸è§ä½ç½®
/etc/mysqlrouter/mysqlrouter.conf
/usr/local/mysql-router/etc/mysqlrouter.conf

# Windows ç³»ç»Ÿå¸¸è§ä½ç½®
C:\Program Files\MySQL\MySQL Router\mysqlrouter.conf
```

---

## 2. ğŸ“‹ mysqlrouter.conf æ–‡ä»¶ç»“æ„


### 2.1 INI æ–‡ä»¶æ ¼å¼åŸºç¡€


**åŸºæœ¬è¯­æ³•**ï¼š
```ini
# è¿™æ˜¯æ³¨é‡Šè¡Œ
[section_name]          # æ®µè½åç§°
key = value             # é”®å€¼å¯¹é…ç½®
another_key = value     # å¦ä¸€ä¸ªé…ç½®é¡¹

[another_section]       # å¦ä¸€ä¸ªæ®µè½
option = setting
```

**é€šä¿—è§£é‡Š**ï¼š
- **æ–¹æ‹¬å·** `[]` é‡Œçš„æ˜¯ **æ®µè½åç§°**ï¼Œå°±åƒä¹¦çš„ç« èŠ‚æ ‡é¢˜
- **ç­‰å·** `=` å·¦è¾¹æ˜¯ **é…ç½®é¡¹åç§°**ï¼Œå³è¾¹æ˜¯ **é…ç½®å€¼**
- **äº•å·** `#` å¼€å¤´çš„æ˜¯ **æ³¨é‡Š**ï¼Œç¨‹åºä¸ä¼šè¯»å–

### 2.2 MySQL Router é…ç½®æ–‡ä»¶æ•´ä½“ç»“æ„


```
mysqlrouter.conf æ–‡ä»¶ç»“æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        [DEFAULT]                â”‚ â† å…¨å±€é»˜è®¤é…ç½®
â”‚  - logging_folder               â”‚
â”‚  - runtime_folder               â”‚
â”‚  - config_folder                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [logger]                   â”‚ â† æ—¥å¿—ç³»ç»Ÿé…ç½®
â”‚  - level = INFO                 â”‚
â”‚  - sinks = consolelog,filelog   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    [routing:è¯»å†™ç«¯å£]            â”‚ â† è¯»å†™è¯·æ±‚è·¯ç”±
â”‚  - bind_address = 0.0.0.0       â”‚
â”‚  - bind_port = 6446             â”‚
â”‚  - destinations = clusterèŠ‚ç‚¹    â”‚
â”‚  - mode = read-write            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    [routing:åªè¯»ç«¯å£]            â”‚ â† åªè¯»è¯·æ±‚è·¯ç”±
â”‚  - bind_address = 0.0.0.0       â”‚
â”‚  - bind_port = 6447             â”‚
â”‚  - destinations = clusterèŠ‚ç‚¹    â”‚
â”‚  - mode = read-only             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 ä¸»è¦é…ç½®æ®µè½è¯´æ˜


| æ®µè½åç§° | **ä½œç”¨** | **é‡è¦ç¨‹åº¦** |
|---------|----------|-------------|
| `[DEFAULT]` | **å…¨å±€é»˜è®¤é…ç½®**ï¼Œå½±å“æ•´ä¸ª Router | ğŸ”´ **å¿…éœ€** |
| `[logger]` | **æ—¥å¿—è®°å½•é…ç½®**ï¼Œæ§åˆ¶æ—¥å¿—è¾“å‡º | ğŸŸ¡ **é‡è¦** |
| `[routing:xxx]` | **è·¯ç”±è§„åˆ™é…ç½®**ï¼Œå®šä¹‰æµé‡åˆ†å‘ | ğŸ”´ **æ ¸å¿ƒ** |
| `[metadata_cache:xxx]` | **å…ƒæ•°æ®ç¼“å­˜é…ç½®**ï¼Œç”¨äºé›†ç¾¤å‘ç° | ğŸŸ¡ **é‡è¦** |

---

## 3. âš™ï¸ DEFAULT å…¨å±€é…ç½®è¯¦è§£


### 3.1 DEFAULT æ®µè½çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼š
`[DEFAULT]` æ®µè½å°±åƒæ˜¯ **"æ€»è®¾ç½®"**ï¼Œè¿™é‡Œçš„é…ç½®ä¼šå½±å“æ•´ä¸ª MySQL Router çš„è¿è¡Œã€‚ç±»ä¼¼äºæ‰‹æœºçš„ **"é€šç”¨è®¾ç½®"**ï¼Œä¼šå½±å“æ‰€æœ‰åº”ç”¨ã€‚

### 3.2 å¸¸ç”¨ DEFAULT é…ç½®é¡¹


**ğŸ“ ç›®å½•è·¯å¾„é…ç½®**ï¼š
```ini
[DEFAULT]
# æ—¥å¿—æ–‡ä»¶å­˜æ”¾ç›®å½•
logging_folder = /var/log/mysqlrouter

# è¿è¡Œæ—¶æ–‡ä»¶ç›®å½•ï¼ˆå¦‚PIDæ–‡ä»¶ï¼‰
runtime_folder = /var/run/mysqlrouter

# é…ç½®æ–‡ä»¶ç›®å½•
config_folder = /etc/mysqlrouter

# æ•°æ®ç›®å½•
data_folder = /var/lib/mysqlrouter
```

**ğŸ”§ è¿è¡Œå‚æ•°é…ç½®**ï¼š
```ini
[DEFAULT]
# Router è¿›ç¨‹ç”¨æˆ·
user = mysqlrouter

# æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡
max_total_connections = 512

# è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
connect_timeout = 15

# è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
read_timeout = 30
```

### 3.3 DEFAULT é…ç½®è¯¦ç»†è¯´æ˜


**ğŸ  `logging_folder`**ï¼š
- **å«ä¹‰**ï¼šæŒ‡å®šæ—¥å¿—æ–‡ä»¶å­˜æ”¾çš„ç›®å½•
- **é‡è¦æ€§**ï¼šå¿…é¡»ç¡®ä¿ MySQL Router æœ‰å†™å…¥æƒé™
- **ç¤ºä¾‹**ï¼š`logging_folder = /var/log/mysqlrouter`

**ğŸƒ `runtime_folder`**ï¼š
- **å«ä¹‰**ï¼šå­˜æ”¾è¿è¡Œæ—¶æ–‡ä»¶ï¼Œå¦‚è¿›ç¨‹IDæ–‡ä»¶ï¼ˆPIDï¼‰
- **ç”¨é€”**ï¼šç³»ç»Ÿç®¡ç†å·¥å…·ç”¨æ¥è·Ÿè¸ªè¿›ç¨‹çŠ¶æ€
- **ç¤ºä¾‹**ï¼š`runtime_folder = /var/run/mysqlrouter`

**ğŸ“š `config_folder`**ï¼š
- **å«ä¹‰**ï¼šé…ç½®æ–‡ä»¶çš„æœç´¢ç›®å½•
- **ç”¨é€”**ï¼šRouter ä¼šåœ¨è¿™ä¸ªç›®å½•æŸ¥æ‰¾é…ç½®æ–‡ä»¶
- **ç¤ºä¾‹**ï¼š`config_folder = /etc/mysqlrouter`

---

## 4. ğŸš¦ routing è·¯ç”±é…ç½®è¯¦è§£


### 4.1 routing æ®µè½çš„æ ¸å¿ƒä½œç”¨


**é€šä¿—ç†è§£**ï¼š
`[routing:åç§°]` æ®µè½å°±åƒæ˜¯ **"äº¤é€šè§„åˆ™"**ï¼Œå®šä¹‰äº†ï¼š
- å®¢æˆ·ç«¯ä»å“ªä¸ª **"å…¥å£"** è¿›æ¥ï¼ˆbind_address + bind_portï¼‰
- è¯·æ±‚è¦è½¬å‘åˆ°å“ªäº› **"ç›®çš„åœ°"**ï¼ˆdestinationsï¼‰
- ç”¨ä»€ä¹ˆ **"åˆ†é…ç­–ç•¥"** é€‰æ‹©ç›®çš„åœ°ï¼ˆrouting_strategyï¼‰

### 4.2 routing é…ç½®åŸºæœ¬ç»“æ„


```ini
[routing:primary]              # è·¯ç”±åç§°ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
bind_address = 0.0.0.0         # ç›‘å¬åœ°å€
bind_port = 6446               # ç›‘å¬ç«¯å£
destinations = 192.168.1.10:3306,192.168.1.11:3306
mode = read-write              # è·¯ç”±æ¨¡å¼
routing_strategy = round-robin  # è·¯ç”±ç­–ç•¥
max_connections = 100          # æœ€å¤§è¿æ¥æ•°
```

### 4.3 å…³é”®é…ç½®å‚æ•°è¯¦è§£


#### ğŸŒ bind_addressï¼ˆç»‘å®šåœ°å€ï¼‰


**å«ä¹‰**ï¼šæŒ‡å®š MySQL Router ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç½‘ç»œåœ°å€

**å¸¸ç”¨é…ç½®**ï¼š
```ini
# ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆæœ€å¸¸ç”¨ï¼‰
bind_address = 0.0.0.0

# åªç›‘å¬æœ¬åœ°è¿æ¥
bind_address = 127.0.0.1

# ç›‘å¬ç‰¹å®šç½‘ç»œæ¥å£
bind_address = 192.168.1.100
```

**é€šä¿—è§£é‡Š**ï¼š
- `0.0.0.0`ï¼š**"æ¥è€…ä¸æ‹’"**ï¼Œä»»ä½•ç½‘ç»œçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥è¿æ¥
- `127.0.0.1`ï¼š**"åªæ¥å¾…æœ¬åœ°å®¢æˆ·"**ï¼Œåªæœ‰æœ¬æœºç¨‹åºå¯ä»¥è¿æ¥
- å…·ä½“IPï¼š**"åªæ¥å¾…ç‰¹å®šç½‘ç»œçš„å®¢æˆ·"**ï¼Œåªæœ‰è¯¥ç½‘ç»œçš„å®¢æˆ·ç«¯å¯ä»¥è¿æ¥

#### ğŸšª bind_portï¼ˆç»‘å®šç«¯å£ï¼‰


**å«ä¹‰**ï¼šæŒ‡å®š MySQL Router ç›‘å¬çš„ç«¯å£å·

**æ ‡å‡†ç«¯å£çº¦å®š**ï¼š
```ini
# è¯»å†™ç«¯å£ï¼ˆPrimaryèŠ‚ç‚¹ï¼‰
bind_port = 6446

# åªè¯»ç«¯å£ï¼ˆSecondaryèŠ‚ç‚¹ï¼‰
bind_port = 6447

# è¯»å†™åˆ†ç¦»ç«¯å£ï¼ˆXåè®®ï¼‰
bind_port = 64460
bind_port = 64470
```

#### ğŸ¯ destinationsï¼ˆç›®æ ‡é…ç½®ï¼‰


**å«ä¹‰**ï¼šæŒ‡å®šè¯·æ±‚è¦è½¬å‘åˆ°çš„ MySQL æœåŠ¡å™¨åˆ—è¡¨

**é…ç½®æ ¼å¼**ï¼š
```ini
# é™æ€é…ç½®æ–¹å¼
destinations = 192.168.1.10:3306,192.168.1.11:3306,192.168.1.12:3306

# ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸»æœºå
destinations = mysql1.example.com:3306,mysql2.example.com:3306

# åŠ¨æ€å‘ç°æ–¹å¼ï¼ˆæ¨èï¼‰
destinations = metadata-cache://cluster_name/default?role=PRIMARY
```

**é€šä¿—è§£é‡Š**ï¼š
- **é™æ€é…ç½®**ï¼š**"æ‰‹åŠ¨æŒ‡å®šç›®çš„åœ°"**ï¼Œæ˜ç¡®å†™å‡ºæ¯ä¸ªæœåŠ¡å™¨çš„åœ°å€
- **åŠ¨æ€å‘ç°**ï¼š**"è‡ªåŠ¨å¯»æ‰¾ç›®çš„åœ°"**ï¼Œè®© Router è‡ªå·±å‘ç°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹

#### ğŸ”„ routing_strategyï¼ˆè·¯ç”±ç­–ç•¥ï¼‰


**å«ä¹‰**ï¼šå®šä¹‰å¦‚ä½•åœ¨å¤šä¸ªç›®æ ‡æœåŠ¡å™¨ä¹‹é—´åˆ†é…è¯·æ±‚

**å¯ç”¨ç­–ç•¥**ï¼š
```ini
# è½®è¯¢ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰
routing_strategy = round-robin

# ç¬¬ä¸€å¯ç”¨ç­–ç•¥
routing_strategy = first-available

# ä¸‹ä¸€å¯ç”¨ç­–ç•¥
routing_strategy = next-available
```

**ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ | **å·¥ä½œæ–¹å¼** | **é€‚ç”¨åœºæ™¯** |
|------|-------------|-------------|
| `round-robin` | **è½®æµåˆ†é…**ï¼Œ1â†’2â†’3â†’1... | è´Ÿè½½å‡è¡¡ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ€§èƒ½ç›¸è¿‘ |
| `first-available` | **ä¼˜å…ˆä½¿ç”¨ç¬¬ä¸€ä¸ª**ï¼Œæ•…éšœæ—¶åˆ‡æ¢ | ä¸»å¤‡æ¨¡å¼ï¼Œæœ‰æ˜ç¡®çš„ä¼˜å…ˆçº§ |
| `next-available` | **ä½¿ç”¨ä¸‹ä¸€ä¸ªå¯ç”¨çš„** | æ•…éšœè½¬ç§»ï¼Œç®€å•çš„é«˜å¯ç”¨ |

### 4.4 è·¯ç”±æ¨¡å¼ï¼ˆmodeï¼‰


**å«ä¹‰**ï¼šå®šä¹‰è·¯ç”±å¤„ç†çš„è¯·æ±‚ç±»å‹

**å¯ç”¨æ¨¡å¼**ï¼š
```ini
# è¯»å†™æ¨¡å¼ï¼ˆæ‰€æœ‰æ“ä½œï¼‰
mode = read-write

# åªè¯»æ¨¡å¼ï¼ˆSELECTæ“ä½œï¼‰
mode = read-only
```

**å…¸å‹é…ç½®ç»„åˆ**ï¼š
```ini
# ä¸»åº“è·¯ç”±é…ç½®
[routing:primary]
mode = read-write
bind_port = 6446
destinations = metadata-cache://mycluster/default?role=PRIMARY

# ä»åº“è·¯ç”±é…ç½®  
[routing:secondary]
mode = read-only
bind_port = 6447
destinations = metadata-cache://mycluster/default?role=SECONDARY
```

---

## 5. ğŸ“ logger æ—¥å¿—é…ç½®è¯¦è§£


### 5.1 logger é…ç½®çš„ä½œç”¨


**é€šä¿—ç†è§£**ï¼š
æ—¥å¿—å°±åƒæ˜¯ MySQL Router çš„ **"å·¥ä½œæ—¥è®°"**ï¼Œè®°å½•äº†ï¼š
- ä»€ä¹ˆæ—¶å€™å¤„ç†äº†ä»€ä¹ˆè¯·æ±‚
- å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯æˆ–è­¦å‘Š
- ç³»ç»Ÿè¿è¡Œçš„è¯¦ç»†ä¿¡æ¯

### 5.2 åŸºæœ¬æ—¥å¿—é…ç½®


```ini
[logger]
# æ—¥å¿—çº§åˆ«
level = INFO

# æ—¥å¿—è¾“å‡ºç›®æ ‡
sinks = consolelog,filelog

# æ—¥å¿—æ—¶é—´æˆ³æ ¼å¼
timestamp_precision = second
```

### 5.3 æ—¥å¿—çº§åˆ«è¯¦è§£


**å¯ç”¨çº§åˆ«**ï¼ˆä»è¯¦ç»†åˆ°ç®€ç•¥ï¼‰ï¼š
```ini
level = FATAL    # åªè®°å½•è‡´å‘½é”™è¯¯
level = ERROR    # è®°å½•é”™è¯¯ä¿¡æ¯
level = WARNING  # è®°å½•è­¦å‘Šä¿¡æ¯
level = INFO     # è®°å½•å¸¸è§„ä¿¡æ¯ï¼ˆæ¨èï¼‰
level = DEBUG    # è®°å½•è°ƒè¯•ä¿¡æ¯ï¼ˆè¯¦ç»†ï¼‰
```

**çº§åˆ«é€‰æ‹©å»ºè®®**ï¼š
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ `INFO` çº§åˆ«ï¼Œå¹³è¡¡ä¿¡æ¯é‡å’Œæ€§èƒ½
- **è°ƒè¯•é—®é¢˜**ï¼šä½¿ç”¨ `DEBUG` çº§åˆ«ï¼Œè·å¾—è¯¦ç»†ä¿¡æ¯
- **èµ„æºç´§å¼ **ï¼šä½¿ç”¨ `WARNING` çº§åˆ«ï¼Œåªè®°å½•é—®é¢˜

### 5.4 æ—¥å¿—è¾“å‡ºé…ç½®


**è¾“å‡ºç›®æ ‡ï¼ˆsinksï¼‰**ï¼š
```ini
# åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
sinks = consolelog,filelog

# åªè¾“å‡ºåˆ°æ–‡ä»¶
sinks = filelog

# åªè¾“å‡ºåˆ°æ§åˆ¶å°
sinks = consolelog
```

**æ–‡ä»¶æ—¥å¿—é…ç½®**ï¼š
```ini
[filelog]
# æ—¥å¿—æ–‡ä»¶å
filename = mysqlrouter.log

# æ—¥å¿—è½®è½¬å¤§å°ï¼ˆMBï¼‰
max_size = 100M

# ä¿ç•™çš„æ—¥å¿—æ–‡ä»¶æ•°é‡
max_files = 5
```

---

## 6. ğŸ” æ ¸å¿ƒé…ç½®å‚æ•°æ·±å…¥è§£æ


### 6.1 max_connectionsï¼ˆè¿æ¥é™åˆ¶ï¼‰


**å«ä¹‰**ï¼šé™åˆ¶å•ä¸ªè·¯ç”±çš„æœ€å¤§åŒæ—¶è¿æ¥æ•°

**é…ç½®ç¤ºä¾‹**ï¼š
```ini
[routing:primary]
max_connections = 100    # æœ€å¤š100ä¸ªå¹¶å‘è¿æ¥
```

**é€‰æ‹©å»ºè®®**ï¼š
```
å°å‹åº”ç”¨ï¼šmax_connections = 50-100
ä¸­å‹åº”ç”¨ï¼šmax_connections = 200-500  
å¤§å‹åº”ç”¨ï¼šmax_connections = 1000+

è®¡ç®—å…¬å¼ï¼š
åº”ç”¨è¿æ¥æ± å¤§å° Ã— åº”ç”¨å®ä¾‹æ•°é‡ Ã— 1.2ï¼ˆç¼“å†²ï¼‰
```

### 6.2 connect_timeoutï¼ˆè¿æ¥è¶…æ—¶ï¼‰


**å«ä¹‰**ï¼šè¿æ¥åˆ°åç«¯ MySQL æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´

**é…ç½®ç¤ºä¾‹**ï¼š
```ini
[routing:primary]
connect_timeout = 15     # 15ç§’è¿æ¥è¶…æ—¶
```

**è®¾ç½®åŸåˆ™**ï¼š
- **ç½‘ç»œè‰¯å¥½**ï¼š5-10ç§’
- **ç½‘ç»œä¸€èˆ¬**ï¼š15-20ç§’  
- **ç½‘ç»œè¾ƒå·®**ï¼š30ç§’ä»¥ä¸Š

### 6.3 åŠ¨æ€æœåŠ¡å‘ç°é…ç½®


**metadata_cache é…ç½®**ï¼š
```ini
[metadata_cache:mycluster]
# é›†ç¾¤è¿æ¥ä¿¡æ¯
router_id = 1
bootstrap_server_addresses = 192.168.1.10:3306,192.168.1.11:3306,192.168.1.12:3306

# å…ƒæ•°æ®åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
metadata_cluster = mycluster
ttl = 0.5

# é›†ç¾¤ç±»å‹
cluster_type = gr
```

**é€šä¿—è§£é‡Š**ï¼š
- `bootstrap_server_addresses`ï¼š**"è”ç³»äººåå•"**ï¼ŒRouter å¯åŠ¨æ—¶è”ç³»è¿™äº›æœåŠ¡å™¨è·å–é›†ç¾¤ä¿¡æ¯
- `ttl`ï¼š**"ä¿¡æ¯æ›´æ–°é¢‘ç‡"**ï¼Œå¤šä¹…æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çŠ¶æ€å˜åŒ–
- `cluster_type = gr`ï¼š**"é›†ç¾¤ç±»å‹"**ï¼Œgrè¡¨ç¤º Group Replication

---

## 7. ğŸ’¼ å®è·µé…ç½®ç¤ºä¾‹


### 7.1 åŸºç¡€å•é›†ç¾¤é…ç½®


```ini
# åŸºç¡€ MySQL Router é…ç½®ç¤ºä¾‹
[DEFAULT]
logging_folder = /var/log/mysqlrouter
runtime_folder = /var/run/mysqlrouter
config_folder = /etc/mysqlrouter

[logger]
level = INFO
sinks = filelog,consolelog

[metadata_cache:mycluster]
router_id = 1
bootstrap_server_addresses = 192.168.1.10:3306,192.168.1.11:3306,192.168.1.12:3306
metadata_cluster = mycluster
ttl = 0.5

# è¯»å†™ç«¯å£é…ç½®
[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://mycluster/default?role=PRIMARY
mode = read-write
routing_strategy = first-available
max_connections = 200

# åªè¯»ç«¯å£é…ç½®
[routing:secondary]  
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://mycluster/default?role=SECONDARY
mode = read-only
routing_strategy = round-robin
max_connections = 300
```

### 7.2 é«˜å¯ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®


```ini
[DEFAULT]
logging_folder = /var/log/mysqlrouter
runtime_folder = /var/run/mysqlrouter
config_folder = /etc/mysqlrouter
user = mysqlrouter
max_total_connections = 1024

[logger]
level = INFO
sinks = filelog
timestamp_precision = second

[filelog]
filename = mysqlrouter.log
max_size = 50M
max_files = 10

[metadata_cache:production_cluster]
router_id = 1
bootstrap_server_addresses = mysql1.prod.com:3306,mysql2.prod.com:3306,mysql3.prod.com:3306
metadata_cluster = production_cluster
ttl = 1
use_gr_notifications = 1

# åº”ç”¨è¯»å†™ç«¯å£
[routing:app_rw]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://production_cluster/default?role=PRIMARY
mode = read-write
routing_strategy = first-available
max_connections = 500
connect_timeout = 10
read_timeout = 30

# åº”ç”¨åªè¯»ç«¯å£
[routing:app_ro]
bind_address = 0.0.0.0  
bind_port = 6447
destinations = metadata-cache://production_cluster/default?role=SECONDARY
mode = read-only
routing_strategy = round-robin
max_connections = 800
connect_timeout = 10
read_timeout = 30

# ç®¡ç†ç«¯å£ï¼ˆè¾ƒå°‘è¿æ¥ï¼‰
[routing:admin]
bind_address = 127.0.0.1
bind_port = 6448
destinations = metadata-cache://production_cluster/default?role=PRIMARY
mode = read-write
routing_strategy = first-available
max_connections = 10
```

### 7.3 é…ç½®æ–‡ä»¶éªŒè¯


**è¯­æ³•æ£€æŸ¥å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --validate-config

# æ˜¾ç¤ºè§£æåçš„é…ç½®
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --show-config
```

**å¸¸è§é…ç½®é”™è¯¯**ï¼š
```bash
# âŒ é”™è¯¯ï¼šç«¯å£å†²çª
[routing:rw]
bind_port = 6446
[routing:ro] 
bind_port = 6446    # ä¸ä¸Šé¢é‡å¤

# âœ… æ­£ç¡®ï¼šä¸åŒç«¯å£
[routing:rw]
bind_port = 6446
[routing:ro]
bind_port = 6447

# âŒ é”™è¯¯ï¼šæ— æ•ˆçš„è·¯ç”±ç­–ç•¥
routing_strategy = invalid-strategy

# âœ… æ­£ç¡®ï¼šæœ‰æ•ˆçš„è·¯ç”±ç­–ç•¥
routing_strategy = round-robin
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šINIæ ¼å¼ï¼Œæ®µè½åŒ–ç®¡ç†ï¼Œæ¸…æ™°åˆ†å·¥
ğŸ”¸ DEFAULTæ®µè½ï¼šå…¨å±€é…ç½®ï¼Œå½±å“æ•´ä¸ªRouterè¿è¡Œ
ğŸ”¸ routingæ®µè½ï¼šè·¯ç”±è§„åˆ™ï¼Œå®šä¹‰æµé‡åˆ†å‘ç­–ç•¥
ğŸ”¸ loggeræ®µè½ï¼šæ—¥å¿—é…ç½®ï¼Œç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
ğŸ”¸ bind_addressï¼šç›‘å¬åœ°å€ï¼Œæ§åˆ¶å®¢æˆ·ç«¯è®¿é—®èŒƒå›´
ğŸ”¸ destinationsï¼šç›®æ ‡é…ç½®ï¼Œå®šä¹‰åç«¯æœåŠ¡å™¨åˆ—è¡¨
ğŸ”¸ routing_strategyï¼šè·¯ç”±ç­–ç•¥ï¼Œå†³å®šè´Ÿè½½å‡è¡¡æ–¹å¼
ğŸ”¸ max_connectionsï¼šè¿æ¥é™åˆ¶ï¼Œæ§åˆ¶å¹¶å‘è¿æ¥æ•°é‡
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„**ï¼š
```
å…¨å±€é…ç½®ï¼ˆDEFAULTï¼‰
    â†“
å…·ä½“åŠŸèƒ½é…ç½®ï¼ˆroutingã€loggerç­‰ï¼‰
    â†“
å‚æ•°ç»†èŠ‚é…ç½®ï¼ˆbind_addressã€destinationsç­‰ï¼‰
```

**ğŸ”¹ è·¯ç”±é…ç½®çš„æ ¸å¿ƒé€»è¾‘**ï¼š
```
å®¢æˆ·ç«¯è¿æ¥
    â†“
bind_address + bind_portï¼ˆå…¥å£ï¼‰
    â†“
routing_strategyï¼ˆåˆ†é…ç­–ç•¥ï¼‰
    â†“
destinationsï¼ˆç›®æ ‡é€‰æ‹©ï¼‰
    â†“
åç«¯MySQLæœåŠ¡å™¨
```

**ğŸ”¹ åŠ¨æ€ vs é™æ€é…ç½®**ï¼š
```
é™æ€é…ç½®ï¼šæ‰‹åŠ¨æŒ‡å®šæœåŠ¡å™¨åœ°å€ï¼Œç®€å•ä½†éœ€è¦æ‰‹åŠ¨ç»´æŠ¤
åŠ¨æ€é…ç½®ï¼šè‡ªåŠ¨å‘ç°é›†ç¾¤èŠ‚ç‚¹ï¼Œæ™ºèƒ½ä½†éœ€è¦å…ƒæ•°æ®ç¼“å­˜æ”¯æŒ
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“ é…ç½®æ–‡ä»¶ç¼–å†™æ­¥éª¤**ï¼š
1. **ç¡®å®šéœ€æ±‚**ï¼šè¯»å†™åˆ†ç¦»ï¼Ÿè´Ÿè½½å‡è¡¡ï¼Ÿé«˜å¯ç”¨ï¼Ÿ
2. **è®¾è®¡æ¶æ„**ï¼šå‡ ä¸ªç«¯å£ï¼Ÿä»€ä¹ˆè·¯ç”±ç­–ç•¥ï¼Ÿ
3. **ç¼–å†™é…ç½®**ï¼šä» DEFAULT å¼€å§‹ï¼Œé€æ­¥æ·»åŠ  routing æ®µè½
4. **æµ‹è¯•éªŒè¯**ï¼šè¯­æ³•æ£€æŸ¥ã€è¿æ¥æµ‹è¯•ã€æ•…éšœæ¨¡æ‹Ÿ

**ğŸ”§ ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- **ç«¯å£è§„åˆ’**ï¼š6446ï¼ˆè¯»å†™ï¼‰ã€6447ï¼ˆåªè¯»ï¼‰ã€6448ï¼ˆç®¡ç†ï¼‰
- **è¿æ¥æ•°è®¾ç½®**ï¼šåŸºäºåº”ç”¨éœ€æ±‚ï¼Œé¢„ç•™20%ç¼“å†²
- **æ—¥å¿—çº§åˆ«**ï¼šINFOçº§åˆ«ï¼Œå®šæœŸè½®è½¬
- **ç›‘æ§é…ç½®**ï¼šå¯ç”¨è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

**âš ï¸ å¸¸è§é—®é¢˜é¢„é˜²**ï¼š
- **ç«¯å£å†²çª**ï¼šç¡®ä¿æ¯ä¸ªè·¯ç”±ä½¿ç”¨ä¸åŒç«¯å£
- **æƒé™é—®é¢˜**ï¼šç¡®ä¿ Router å¯¹æ—¥å¿—ç›®å½•æœ‰å†™æƒé™
- **ç½‘ç»œè®¿é—®**ï¼šæ£€æŸ¥é˜²ç«å¢™å’Œ bind_address è®¾ç½®
- **é›†ç¾¤å‘ç°**ï¼šç¡®ä¿ bootstrap_server_addresses ä¸­è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ç”¨

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- MySQL Router é…ç½®æ–‡ä»¶æ˜¯ INI æ ¼å¼çš„"å·¥ä½œæ‰‹å†Œ"
- routing æ®µè½å®šä¹‰äº†"å…¥å£â†’ç­–ç•¥â†’ç›®æ ‡"çš„å®Œæ•´è·¯å¾„
- bind_address æ§åˆ¶"è°èƒ½è¿"ï¼Œdestinations æ§åˆ¶"è¿åˆ°å“ª"
- åŠ¨æ€é…ç½®æ¯”é™æ€é…ç½®æ›´æ™ºèƒ½ï¼Œä½†éœ€è¦é›†ç¾¤æ”¯æŒ
- åˆç†çš„è¿æ¥æ•°å’Œè¶…æ—¶è®¾ç½®æ˜¯ç¨³å®šè¿è¡Œçš„å…³é”®