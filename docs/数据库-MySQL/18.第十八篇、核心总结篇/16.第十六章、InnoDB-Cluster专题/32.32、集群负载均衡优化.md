---
title: 32ã€é›†ç¾¤è´Ÿè½½å‡è¡¡ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [MySQL Router è´Ÿè½½å‡è¡¡åŸºç¡€](#1-MySQL-Router-è´Ÿè½½å‡è¡¡åŸºç¡€)
2. [è¯»å†™åˆ†ç¦»ä¼˜åŒ–ç­–ç•¥](#2-è¯»å†™åˆ†ç¦»ä¼˜åŒ–ç­–ç•¥)
3. [è¿æ¥æ± ä¸è¿æ¥å¤ç”¨ä¼˜åŒ–](#3-è¿æ¥æ± ä¸è¿æ¥å¤ç”¨ä¼˜åŒ–)
4. [è·¯ç”±ç®—æ³•ä¸è´Ÿè½½åˆ†å¸ƒ](#4-è·¯ç”±ç®—æ³•ä¸è´Ÿè½½åˆ†å¸ƒ)
5. [å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»](#5-å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»)
6. [æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜å®è·µ](#6-æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ MySQL Router è´Ÿè½½å‡è¡¡åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯MySQL Routerè´Ÿè½½å‡è¡¡


**ç®€å•ç†è§£**ï¼š
```
æƒ³è±¡ä¸€ä¸ªé¤å…çš„è¿å®¾å‘˜ï¼š
- å®¢äººæ¥äº†ï¼Œè¿å®¾å‘˜å†³å®šå®‰æ’åˆ°å“ªä¸ªåŒ…é—´
- å¦‚æœæŸä¸ªåŒ…é—´å¤ªå¿™ï¼Œå°±å®‰æ’åˆ°å…¶ä»–åŒ…é—´
- å¦‚æœåŒ…é—´å‡ºæ•…éšœï¼Œç«‹å³æ¢åˆ°å¤‡ç”¨åŒ…é—´

MySQL Routerå°±æ˜¯è¿™ä¸ª"è¿å®¾å‘˜"ï¼š
- åº”ç”¨è¿æ¥è¿‡æ¥ï¼ŒRouterå†³å®šè¿åˆ°å“ªä¸ªMySQLèŠ‚ç‚¹
- å¦‚æœæŸä¸ªèŠ‚ç‚¹å¤ªå¿™ï¼Œå°±åˆ†é…åˆ°å…¶ä»–èŠ‚ç‚¹
- å¦‚æœèŠ‚ç‚¹æ•…éšœï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¥åº·èŠ‚ç‚¹
```

**æ ¸å¿ƒä½œç”¨**ï¼š
- **æµé‡åˆ†å‘**ï¼šæŠŠåº”ç”¨è¯·æ±‚åˆç†åˆ†é…ç»™å¤šä¸ªMySQLèŠ‚ç‚¹
- **æ•…éšœéš”ç¦»**ï¼šå±è”½åæ‰çš„èŠ‚ç‚¹ï¼Œåº”ç”¨æ— æ„ŸçŸ¥
- **è¯»å†™åˆ†ç¦»**ï¼šè¯»è¯·æ±‚å’Œå†™è¯·æ±‚åˆ†åˆ«å¤„ç†ï¼Œæå‡æ€§èƒ½

### 1.2 MySQL Router æ¶æ„åŸç†


```
åº”ç”¨ç¨‹åºæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webåº”ç”¨   â”‚    â”‚   APIæœåŠ¡   â”‚    â”‚  æ•°æ®åˆ†æ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ MySQL Router â”‚ â† ç»Ÿä¸€å…¥å£
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Primary Node â”‚    â”‚Secondary1   â”‚    â”‚Secondary2   â”‚
â”‚   (ä¸»èŠ‚ç‚¹)   â”‚    â”‚  (ä»èŠ‚ç‚¹1)   â”‚    â”‚  (ä»èŠ‚ç‚¹2)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Router æ ¸å¿ƒåŠŸèƒ½**ï¼š
```
ğŸ”¸ è¿æ¥è·¯ç”±ï¼šå†³å®šæ–°è¿æ¥åˆ†é…ç»™å“ªä¸ªèŠ‚ç‚¹
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šå¹³è¡¡å„èŠ‚ç‚¹çš„è¯·æ±‚å‹åŠ›
ğŸ”¸ è¯»å†™åˆ†ç¦»ï¼šå†™æ“ä½œåˆ°ä¸»èŠ‚ç‚¹ï¼Œè¯»æ“ä½œåˆ°ä»èŠ‚ç‚¹
ğŸ”¸ æ•…éšœæ£€æµ‹ï¼šæŒç»­ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶æ€
ğŸ”¸ è‡ªåŠ¨åˆ‡æ¢ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨æå‡ä»èŠ‚ç‚¹
```

### 1.3 è´Ÿè½½å‡è¡¡ç­–ç•¥ç±»å‹


**è½®è¯¢ç­–ç•¥ï¼ˆRound Robinï¼‰**ï¼š
```
å·¥ä½œåŸç†ï¼š
è¯·æ±‚1 â†’ èŠ‚ç‚¹A
è¯·æ±‚2 â†’ èŠ‚ç‚¹B  
è¯·æ±‚3 â†’ èŠ‚ç‚¹C
è¯·æ±‚4 â†’ èŠ‚ç‚¹Aï¼ˆå›åˆ°å¼€å§‹ï¼‰

é€‚ç”¨åœºæ™¯ï¼š
âœ… èŠ‚ç‚¹æ€§èƒ½ç›¸è¿‘
âœ… è¯·æ±‚å¤„ç†æ—¶é—´ç›¸ä¼¼
âŒ ä¸é€‚åˆèŠ‚ç‚¹æ€§èƒ½å·®å¼‚å¤§çš„æƒ…å†µ
```

**æœ€å°‘è¿æ¥ç­–ç•¥ï¼ˆLeast Connectionsï¼‰**ï¼š
```
å·¥ä½œåŸç†ï¼š
æ€»æ˜¯é€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹

ç¤ºä¾‹ï¼š
èŠ‚ç‚¹Aï¼šå½“å‰50ä¸ªè¿æ¥
èŠ‚ç‚¹Bï¼šå½“å‰30ä¸ªè¿æ¥  â† æ–°è¯·æ±‚åˆ†é…åˆ°è¿™é‡Œ
èŠ‚ç‚¹Cï¼šå½“å‰45ä¸ªè¿æ¥

é€‚ç”¨åœºæ™¯ï¼š
âœ… è¿æ¥ä¿æŒæ—¶é—´è¾ƒé•¿
âœ… èŠ‚ç‚¹å¤„ç†èƒ½åŠ›ç›¸è¿‘
âœ… å¸Œæœ›å‡åŒ€åˆ†å¸ƒè´Ÿè½½
```

---

## 2. ğŸ“– è¯»å†™åˆ†ç¦»ä¼˜åŒ–ç­–ç•¥


### 2.1 è¯»å†™åˆ†ç¦»çš„åŸºæœ¬æ¦‚å¿µ


**ä¸ºä»€ä¹ˆéœ€è¦è¯»å†™åˆ†ç¦»**ï¼š
```
æ•°æ®åº“çš„ç°å®æƒ…å†µï¼š
- å¤§å¤šæ•°åº”ç”¨çš„è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œï¼ˆé€šå¸¸8:2æˆ–9:1ï¼‰
- å†™æ“ä½œéœ€è¦ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œåªèƒ½åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œ
- è¯»æ“ä½œå¯ä»¥ä»å¤šä¸ªä»èŠ‚ç‚¹è·å–æ•°æ®ï¼Œåˆ†æ•£å‹åŠ›

å°±åƒå›¾ä¹¦é¦†ï¼š
- å€Ÿä¹¦ï¼ˆå†™ï¼‰ï¼šå¿…é¡»åœ¨æœåŠ¡å°åŠç†ï¼Œç¡®ä¿è®°å½•å‡†ç¡®
- çœ‹ä¹¦ï¼ˆè¯»ï¼‰ï¼šå¯ä»¥åœ¨å¤šä¸ªé˜…è§ˆå®¤è¿›è¡Œï¼Œä¸ç›¸äº’å½±å“
```

### 2.2 è¯»å†™åˆ†ç¦»é…ç½®å®è·µ


**Router é…ç½®ç¤ºä¾‹**ï¼š
```ini
[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://myCluster/default?role=PRIMARY
routing_strategy = first-available
protocol = classic

[routing:secondary]  
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://myCluster/default?role=SECONDARY
routing_strategy = round-robin-with-fallback
protocol = classic
```

**åº”ç”¨è¿æ¥é…ç½®**ï¼š
```python
# Python åº”ç”¨ç¤ºä¾‹
import mysql.connector

# å†™æ“ä½œè¿æ¥ï¼ˆè¿æ¥ä¸»èŠ‚ç‚¹ï¼‰
write_conn = mysql.connector.connect(
    host='router_host',
    port=6446,  # ä¸»èŠ‚ç‚¹ç«¯å£
    user='app_user',
    password='password',
    database='mydb'
)

# è¯»æ“ä½œè¿æ¥ï¼ˆè¿æ¥ä»èŠ‚ç‚¹ï¼‰
read_conn = mysql.connector.connect(
    host='router_host', 
    port=6447,  # ä»èŠ‚ç‚¹ç«¯å£
    user='app_user',
    password='password',
    database='mydb'
)

# ä½¿ç”¨ç¤ºä¾‹
def create_user(name, email):
    cursor = write_conn.cursor()  # å†™æ“ä½œç”¨ä¸»èŠ‚ç‚¹
    cursor.execute("INSERT INTO users (name, email) VALUES (%s, %s)", 
                   (name, email))
    write_conn.commit()

def get_user(user_id):
    cursor = read_conn.cursor()   # è¯»æ“ä½œç”¨ä»èŠ‚ç‚¹
    cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))
    return cursor.fetchone()
```

### 2.3 è¯»å†™åˆ†ç¦»ä¼˜åŒ–æŠ€å·§


**æ™ºèƒ½è·¯ç”±ç­–ç•¥**ï¼š
```
ğŸ”¸ äº‹åŠ¡ä¸€è‡´æ€§ï¼šåŒä¸€äº‹åŠ¡å†…çš„è¯»å†™éƒ½è·¯ç”±åˆ°ä¸»èŠ‚ç‚¹
ğŸ”¸ ä¼šè¯ä¸€è‡´æ€§ï¼šç”¨æˆ·åˆšå†™å…¥çš„æ•°æ®ï¼Œç«‹å³è¯»å–æ—¶ä»ä¸»èŠ‚ç‚¹è¯»
ğŸ”¸ æ—¶é—´çª—å£ï¼šå†™å…¥åçŸ­æ—¶é—´å†…çš„è¯»æ“ä½œè·¯ç”±åˆ°ä¸»èŠ‚ç‚¹
ğŸ”¸ æ ‡ç­¾è·¯ç”±ï¼šæ ¹æ®SQLæ³¨é‡Šæ ‡ç­¾å†³å®šè·¯ç”±ç›®æ ‡
```

**åº”ç”¨å±‚ä¼˜åŒ–**ï¼š
```python
class DatabaseManager:
    def __init__(self):
        self.write_pool = self.create_connection_pool(port=6446)
        self.read_pool = self.create_connection_pool(port=6447)
        self.recent_writes = {}  # è®°å½•æœ€è¿‘å†™æ“ä½œ
    
    def execute_write(self, sql, params):
        conn = self.write_pool.get_connection()
        cursor = conn.cursor()
        cursor.execute(sql, params)
        conn.commit()
        
        # è®°å½•å†™æ“ä½œæ—¶é—´ï¼Œç”¨äºè¯»ä¸€è‡´æ€§åˆ¤æ–­
        table = self.extract_table_name(sql)
        self.recent_writes[table] = time.time()
        
        return cursor.lastrowid
    
    def execute_read(self, sql, params):
        table = self.extract_table_name(sql)
        
        # å¦‚æœæœ€è¿‘æœ‰å†™æ“ä½œï¼Œä»ä¸»èŠ‚ç‚¹è¯»å–
        if (table in self.recent_writes and 
            time.time() - self.recent_writes[table] < 2):  # 2ç§’å†…
            conn = self.write_pool.get_connection()
        else:
            conn = self.read_pool.get_connection()
            
        cursor = conn.cursor()
        cursor.execute(sql, params)
        return cursor.fetchall()
```

---

## 3. ğŸ”Œ è¿æ¥æ± ä¸è¿æ¥å¤ç”¨ä¼˜åŒ–


### 3.1 è¿æ¥æ± çš„é‡è¦æ€§


**æ²¡æœ‰è¿æ¥æ± çš„é—®é¢˜**ï¼š
```
æ¯æ¬¡æŸ¥è¯¢éƒ½è¦ï¼š
1. å»ºç«‹TCPè¿æ¥
2. MySQLè®¤è¯
3. æ‰§è¡ŒæŸ¥è¯¢
4. å…³é—­è¿æ¥

å°±åƒæ¯æ¬¡ä¹°ä¸œè¥¿éƒ½è¦ï¼š
1. èµ°åˆ°å•†åº—
2. æ’é˜Ÿç­‰å¾…
3. è´­ä¹°å•†å“  
4. èµ°å›å®¶

æ•ˆç‡å¾ˆä½ï¼
```

**è¿æ¥æ± çš„ä¼˜åŠ¿**ï¼š
```
è¿æ¥æ± å°±åƒï¼š
- åœ¨å•†åº—é™„è¿‘ç§Ÿä¸ªæˆ¿å­ï¼ˆé¢„å…ˆå»ºç«‹è¿æ¥ï¼‰
- éœ€è¦ä¹°ä¸œè¥¿ç›´æ¥å»ï¼ˆå¤ç”¨è¿æ¥ï¼‰
- ä¸ç”¨æ¯æ¬¡éƒ½èµ°è¿œè·¯ï¼ˆé¿å…é‡å¤å»ºè¿ï¼‰

æ€§èƒ½æå‡ï¼š
- å‡å°‘è¿æ¥å»ºç«‹æ—¶é—´ï¼šä»å‡ åæ¯«ç§’é™åˆ°å¾®ç§’çº§
- é™ä½æ•°æ®åº“å‹åŠ›ï¼šé¿å…é¢‘ç¹è¿æ¥åˆ›å»ºé”€æ¯
- æé«˜å¹¶å‘èƒ½åŠ›ï¼šå¤ç”¨è¿æ¥æ”¯æŒæ›´å¤šå¹¶å‘è¯·æ±‚
```

### 3.2 Router è¿æ¥æ± é…ç½®


**è¿æ¥æ± å‚æ•°ä¼˜åŒ–**ï¼š
```ini
[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://myCluster/default?role=PRIMARY
routing_strategy = first-available
protocol = classic

# è¿æ¥æ± ç›¸å…³é…ç½®
max_connections = 500          # æœ€å¤§è¿æ¥æ•°
max_connect_errors = 100       # æœ€å¤§è¿æ¥é”™è¯¯æ•°
connect_timeout = 10           # è¿æ¥è¶…æ—¶æ—¶é—´
client_connect_timeout = 30    # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶

[connection_pool]
# è¿æ¥æ± å¤§å°é…ç½®
max_idle_server_connections = 64    # æœ€å¤§ç©ºé—²è¿æ¥æ•°
```

**åº”ç”¨å±‚è¿æ¥æ± é…ç½®**ï¼š
```python
import mysql.connector.pooling

# åˆ›å»ºè¿æ¥æ± 
config = {
    'user': 'app_user',
    'password': 'password',
    'host': 'router_host',
    'port': 6446,
    'database': 'mydb',
    'pool_name': 'web_pool',
    'pool_size': 20,              # è¿æ¥æ± å¤§å°
    'pool_reset_session': True,   # é‡ç½®ä¼šè¯çŠ¶æ€
    'autocommit': True,           # è‡ªåŠ¨æäº¤
    'pool_timeout': 10            # è·å–è¿æ¥è¶…æ—¶æ—¶é—´
}

connection_pool = mysql.connector.pooling.MySQLConnectionPool(**config)

class DatabaseHelper:
    @staticmethod
    def execute_query(sql, params=None):
        conn = None
        try:
            conn = connection_pool.get_connection()  # ä»æ± ä¸­è·å–è¿æ¥
            cursor = conn.cursor()
            cursor.execute(sql, params)
            
            if sql.strip().upper().startswith('SELECT'):
                return cursor.fetchall()
            else:
                conn.commit()
                return cursor.rowcount
                
        except Exception as e:
            if conn:
                conn.rollback()
            raise e
        finally:
            if conn:
                conn.close()  # å½’è¿˜åˆ°è¿æ¥æ± ï¼Œä¸æ˜¯çœŸæ­£å…³é—­
```

### 3.3 è¿æ¥å¤ç”¨æœºåˆ¶ä¼˜åŒ–


**è¿æ¥å¤ç”¨ç­–ç•¥**ï¼š
```
ğŸ”¸ è¿æ¥ä¿æ´»ï¼šå®šæœŸå‘é€å¿ƒè·³åŒ…ä¿æŒè¿æ¥æ´»è·ƒ
ğŸ”¸ è¿æ¥éªŒè¯ï¼šä½¿ç”¨å‰æ£€æŸ¥è¿æ¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
ğŸ”¸ è¿æ¥æ¸…ç†ï¼šå®šæœŸæ¸…ç†é•¿æ—¶é—´ç©ºé—²çš„è¿æ¥
ğŸ”¸ è¿æ¥é¢„çƒ­ï¼šç³»ç»Ÿå¯åŠ¨æ—¶é¢„å…ˆå»ºç«‹ä¸€å®šæ•°é‡çš„è¿æ¥
```

**ç›‘æ§è¿æ¥æ± çŠ¶æ€**ï¼š
```python
class ConnectionPoolMonitor:
    def __init__(self, pool):
        self.pool = pool
    
    def get_pool_stats(self):
        return {
            'pool_name': self.pool.pool_name,
            'pool_size': self.pool.pool_size,
            'connections_in_use': len([conn for conn in self.pool._cnx_queue._queue 
                                     if conn.is_connected()]),
            'free_connections': self.pool._cnx_queue.qsize(),
            'total_connections': self.pool.pool_size
        }
    
    def print_stats(self):
        stats = self.get_pool_stats()
        print(f"è¿æ¥æ± çŠ¶æ€:")
        print(f"  æ€»è¿æ¥æ•°: {stats['total_connections']}")
        print(f"  ä½¿ç”¨ä¸­: {stats['connections_in_use']}")
        print(f"  ç©ºé—²: {stats['free_connections']}")
        print(f"  ä½¿ç”¨ç‡: {stats['connections_in_use']/stats['total_connections']*100:.1f}%")
```

---

## 4. âš–ï¸ è·¯ç”±ç®—æ³•ä¸è´Ÿè½½åˆ†å¸ƒ


### 4.1 è·¯ç”±ç®—æ³•è¯¦è§£


**è½®è¯¢ç®—æ³•ï¼ˆRound Robinï¼‰**ï¼š
```
ç®—æ³•åŸç†ï¼šæŒ‰é¡ºåºè½®æµåˆ†é…è¯·æ±‚

å®ç°é€»è¾‘ï¼š
current_node = 0
nodes = ['node1', 'node2', 'node3']

def get_next_node():
    global current_node
    node = nodes[current_node]
    current_node = (current_node + 1) % len(nodes)
    return node

ä¼˜ç‚¹ï¼šç®€å•å…¬å¹³ï¼Œå®ç°å®¹æ˜“
ç¼ºç‚¹ï¼šä¸è€ƒè™‘èŠ‚ç‚¹å½“å‰è´Ÿè½½
```

**åŠ æƒè½®è¯¢ï¼ˆWeighted Round Robinï¼‰**ï¼š
```
ä½¿ç”¨åœºæ™¯ï¼šèŠ‚ç‚¹æ€§èƒ½ä¸åŒ

é…ç½®ç¤ºä¾‹ï¼š
node1: weight=3 (é«˜æ€§èƒ½æœåŠ¡å™¨)
node2: weight=2 (ä¸­ç­‰æ€§èƒ½)
node3: weight=1 (ä½æ€§èƒ½æœåŠ¡å™¨)

åˆ†é…ç»“æœï¼š
6ä¸ªè¯·æ±‚ä¸­ï¼Œnode1å¤„ç†3ä¸ªï¼Œnode2å¤„ç†2ä¸ªï¼Œnode3å¤„ç†1ä¸ª

Routeré…ç½®ï¼š
[routing:secondary]
destinations = node1:3306*3,node2:3306*2,node3:3306*1
routing_strategy = round-robin
```

**æœ€å°‘è¿æ¥ç®—æ³•ï¼ˆLeast Connectionsï¼‰**ï¼š
```
ç®—æ³•åŸç†ï¼šé€‰æ‹©å½“å‰è¿æ¥æ•°æœ€å°‘çš„èŠ‚ç‚¹

é€‚ç”¨åœºæ™¯ï¼š
âœ… é•¿è¿æ¥è¾ƒå¤šçš„åº”ç”¨
âœ… è¯·æ±‚å¤„ç†æ—¶é—´å·®å¼‚è¾ƒå¤§
âœ… å¸Œæœ›è´Ÿè½½å‡åŒ€åˆ†å¸ƒ

å®ç°é€»è¾‘ï¼š
def select_node():
    min_connections = float('inf')
    selected_node = None
    
    for node in healthy_nodes:
        if node.active_connections < min_connections:
            min_connections = node.active_connections
            selected_node = node
    
    return selected_node
```

### 4.2 è´Ÿè½½åˆ†å¸ƒåˆ†æä¸ç›‘æ§


**è´Ÿè½½æŒ‡æ ‡ç›‘æ§**ï¼š
```sql
-- æŸ¥çœ‹å„èŠ‚ç‚¹è¿æ¥æ•°åˆ†å¸ƒ
SELECT 
    SUBSTRING_INDEX(HOST, ':', 1) as node_ip,
    COUNT(*) as connection_count,
    USER,
    DB as database_name,
    STATE
FROM information_schema.PROCESSLIST 
WHERE USER != 'system user'
GROUP BY node_ip, USER, DB, STATE
ORDER BY connection_count DESC;

-- æŸ¥çœ‹èŠ‚ç‚¹è´Ÿè½½æƒ…å†µ
SELECT 
    $$hostname as node_name,
    $$port as port,
    (SELECT COUNT(*) FROM information_schema.PROCESSLIST 
     WHERE USER != 'system user') as active_connections,
    $$max_connections as max_connections,
    ROUND(
        (SELECT COUNT(*) FROM information_schema.PROCESSLIST 
         WHERE USER != 'system user') / $$max_connections * 100, 
        2
    ) as connection_usage_percent;
```

**è´Ÿè½½å‡è¡¡æ•ˆæœè¯„ä¼°**ï¼š
```python
class LoadBalanceAnalyzer:
    def __init__(self, nodes):
        self.nodes = nodes
        self.request_counts = {node: 0 for node in nodes}
    
    def record_request(self, node):
        self.request_counts[node] += 1
    
    def calculate_balance_score(self):
        """è®¡ç®—è´Ÿè½½å‡è¡¡åˆ†æ•°ï¼Œ100åˆ†è¡¨ç¤ºå®Œå…¨å‡è¡¡"""
        if not self.request_counts:
            return 0
            
        total_requests = sum(self.request_counts.values())
        expected_per_node = total_requests / len(self.nodes)
        
        # è®¡ç®—æ ‡å‡†å·®
        variance = sum((count - expected_per_node) ** 2 
                      for count in self.request_counts.values()) / len(self.nodes)
        std_dev = variance ** 0.5
        
        # è½¬æ¢ä¸ºåˆ†æ•°ï¼ˆæ ‡å‡†å·®è¶Šå°ï¼Œåˆ†æ•°è¶Šé«˜ï¼‰
        max_possible_std = expected_per_node  # æœ€åæƒ…å†µçš„æ ‡å‡†å·®
        balance_score = max(0, 100 * (1 - std_dev / max_possible_std))
        
        return round(balance_score, 2)
    
    def print_distribution(self):
        total = sum(self.request_counts.values())
        print("è´Ÿè½½åˆ†å¸ƒæƒ…å†µ:")
        for node, count in self.request_counts.items():
            percentage = (count / total * 100) if total > 0 else 0
            print(f"  {node}: {count} è¯·æ±‚ ({percentage:.1f}%)")
        print(f"å‡è¡¡åˆ†æ•°: {self.calculate_balance_score()}/100")
```

---

## 5. ğŸ” å¥åº·æ£€æŸ¥ä¸æ•…éšœè½¬ç§»


### 5.1 å¥åº·æ£€æŸ¥æœºåˆ¶


**ä»€ä¹ˆæ˜¯å¥åº·æ£€æŸ¥**ï¼š
```
å°±åƒåŒ»ç”Ÿå®šæœŸä½“æ£€ï¼š
- å®šæœŸæ£€æŸ¥ï¼šæ¯éš”å‡ ç§’æ£€æŸ¥ä¸€æ¬¡èŠ‚ç‚¹çŠ¶æ€
- å¤šé¡¹æŒ‡æ ‡ï¼šæ£€æŸ¥è¿æ¥ã€å“åº”æ—¶é—´ã€é”™è¯¯ç‡ç­‰
- åŠæ—¶å‘ç°ï¼šåœ¨é—®é¢˜ä¸¥é‡å‰å‘ç°å¼‚å¸¸
- è‡ªåŠ¨å¤„ç†ï¼šå‘ç°é—®é¢˜è‡ªåŠ¨ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤

å¥åº·æ£€æŸ¥çš„ç›®çš„ï¼š
- ç¡®ä¿åªæœ‰å¥åº·çš„èŠ‚ç‚¹æ¥æ”¶è¯·æ±‚
- åŠæ—¶å‘ç°æ•…éšœèŠ‚ç‚¹å¹¶éš”ç¦»
- è‡ªåŠ¨æ¢å¤ï¼šèŠ‚ç‚¹æ¢å¤åé‡æ–°åŠ å…¥
```

**Router å¥åº·æ£€æŸ¥é…ç½®**ï¼š
```ini
[metadata_cache:myCluster]
cluster_type = gr
router_id = 1
user = router_user
metadata_cluster = myCluster
connect_timeout = 5
read_timeout = 30

# å¥åº·æ£€æŸ¥é…ç½®
ttl = 0.5                    # ç¼“å­˜ç”Ÿå­˜æ—¶é—´(ç§’)
auth_cache_ttl = 2           # è®¤è¯ç¼“å­˜æ—¶é—´
auth_cache_refresh_interval = 2

[routing:primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://myCluster/default?role=PRIMARY
routing_strategy = first-available
protocol = classic

# å¥åº·æ£€æŸ¥å‚æ•°
connect_timeout = 10         # è¿æ¥è¶…æ—¶
max_connect_errors = 100     # æœ€å¤§è¿æ¥é”™è¯¯æ•°
client_connect_timeout = 30  # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶
```

### 5.2 æ•…éšœæ£€æµ‹ä¸è‡ªåŠ¨åˆ‡æ¢


**æ•…éšœæ£€æµ‹æŒ‡æ ‡**ï¼š
```
ğŸ”¸ è¿æ¥å¤±è´¥ï¼šæ— æ³•å»ºç«‹TCPè¿æ¥
ğŸ”¸ å“åº”è¶…æ—¶ï¼šæŸ¥è¯¢å“åº”æ—¶é—´è¿‡é•¿
ğŸ”¸ é”™è¯¯ç‡é«˜ï¼šè¿”å›é”™è¯¯çš„è¯·æ±‚æ¯”ä¾‹è¿‡é«˜
ğŸ”¸ ä¸»ä»å»¶è¿Ÿï¼šä»èŠ‚ç‚¹åŒæ­¥å»¶è¿Ÿè¿‡å¤§
ğŸ”¸ èµ„æºè€—å°½ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜
```

**è‡ªåŠ¨æ•…éšœè½¬ç§»æµç¨‹**ï¼š
```
æ•…éšœæ£€æµ‹æµç¨‹ï¼š
1. å¥åº·æ£€æŸ¥å¤±è´¥
2. é‡è¯•ç¡®è®¤(é¿å…è¯¯åˆ¤)
3. æ ‡è®°èŠ‚ç‚¹ä¸å¯ç”¨
4. ä»è´Ÿè½½å‡è¡¡ä¸­ç§»é™¤
5. é€šçŸ¥åº”ç”¨ç¨‹åº
6. å®šæœŸé‡è¯•æ£€æŸ¥æ¢å¤

ä¸»èŠ‚ç‚¹æ•…éšœè½¬ç§»ï¼š
æ£€æµ‹åˆ°ä¸»èŠ‚ç‚¹æ•…éšœ
       â†“
è§¦å‘ç»„å¤åˆ¶é€‰ä¸¾
       â†“
é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹
       â†“
æ›´æ–°Routeré…ç½®
       â†“
åº”ç”¨é€æ˜åˆ‡æ¢
```

**æ•…éšœè½¬ç§»é…ç½®**ï¼š
```python
class FailoverManager:
    def __init__(self, nodes):
        self.nodes = nodes
        self.healthy_nodes = set(nodes)
        self.failed_nodes = set()
        self.check_interval = 5  # æ£€æŸ¥é—´éš”ç§’æ•°
    
    def health_check(self, node):
        """æ£€æŸ¥å•ä¸ªèŠ‚ç‚¹å¥åº·çŠ¶æ€"""
        try:
            conn = mysql.connector.connect(
                host=node['host'],
                port=node['port'], 
                user='health_check_user',
                password='password',
                connect_timeout=3,
                autocommit=True
            )
            
            cursor = conn.cursor()
            cursor.execute("SELECT 1")
            cursor.fetchone()
            conn.close()
            return True
            
        except Exception as e:
            print(f"èŠ‚ç‚¹ {node['host']}:{node['port']} å¥åº·æ£€æŸ¥å¤±è´¥: {e}")
            return False
    
    def update_node_status(self):
        """æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€"""
        for node in self.nodes:
            if self.health_check(node):
                if node in self.failed_nodes:
                    print(f"èŠ‚ç‚¹ {node['host']}:{node['port']} å·²æ¢å¤")
                    self.failed_nodes.remove(node)
                    self.healthy_nodes.add(node)
            else:
                if node in self.healthy_nodes:
                    print(f"èŠ‚ç‚¹ {node['host']}:{node['port']} æ•…éšœï¼Œç§»é™¤")
                    self.healthy_nodes.remove(node)
                    self.failed_nodes.add(node)
    
    def get_healthy_nodes(self):
        return list(self.healthy_nodes)
```

### 5.3 æ•…éšœè½¬ç§»ä¼˜åŒ–ç­–ç•¥


**å‡å°‘æ•…éšœå½±å“**ï¼š
```
ğŸ”¸ è¿æ¥é¢„çƒ­ï¼šä¿æŒè¶³å¤Ÿçš„ç©ºé—²è¿æ¥
ğŸ”¸ å¿«é€Ÿæ£€æµ‹ï¼šç¼©çŸ­å¥åº·æ£€æŸ¥é—´éš”
ğŸ”¸ ä¼˜é›…é™çº§ï¼šéƒ¨åˆ†èŠ‚ç‚¹æ•…éšœæ—¶é™ä½æœåŠ¡è´¨é‡è€Œéå®Œå…¨ä¸­æ–­
ğŸ”¸ æ•…éšœéš”ç¦»ï¼šéš”ç¦»æ•…éšœèŠ‚ç‚¹ï¼Œé¿å…å½±å“å…¶ä»–èŠ‚ç‚¹
ğŸ”¸ è‡ªåŠ¨æ¢å¤ï¼šèŠ‚ç‚¹æ¢å¤åè‡ªåŠ¨é‡æ–°åŠ å…¥é›†ç¾¤
```

**æ•…éšœè½¬ç§»ç›‘æ§**ï¼š
```sql
-- ç›‘æ§ç»„å¤åˆ¶çŠ¶æ€
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE,
    MEMBER_VERSION
FROM performance_schema.replication_group_members;

-- æ£€æŸ¥ä¸»ä»å»¶è¿Ÿ
SELECT 
    CHANNEL_NAME,
    SERVICE_STATE,
    LAST_ERROR_MESSAGE,
    LAST_ERROR_TIMESTAMP
FROM performance_schema.replication_connection_status;
```

---

## 6. ğŸ“Š æ€§èƒ½ç›‘æ§ä¸è°ƒä¼˜å®è·µ


### 6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡ç›‘æ§


**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ”¸ QPS/TPSï¼šæ¯ç§’æŸ¥è¯¢æ•°å’Œäº‹åŠ¡æ•°
ğŸ”¸ å“åº”æ—¶é—´ï¼šè¯·æ±‚å¹³å‡å“åº”æ—¶é—´å’Œ99%å“åº”æ—¶é—´
ğŸ”¸ è¿æ¥æ•°ï¼šæ´»è·ƒè¿æ¥æ•°å’Œè¿æ¥æ± ä½¿ç”¨ç‡
ğŸ”¸ é”™è¯¯ç‡ï¼šè¯·æ±‚å¤±è´¥æ¯”ä¾‹
ğŸ”¸ ååé‡ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„æ•°æ®é‡
ğŸ”¸ èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ã€ç½‘ç»œã€ç£ç›˜ä½¿ç”¨ç‡
```

**ç›‘æ§SQLè¯­å¥**ï¼š
```sql
-- æŸ¥çœ‹å½“å‰QPS
SELECT 
    VARIABLE_VALUE as current_qps
FROM performance_schema.global_status 
WHERE VARIABLE_NAME = 'Queries';

-- æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
SELECT 
    CONNECTION_TYPE,
    CURRENT_CONNECTIONS,
    TOTAL_CONNECTIONS
FROM performance_schema.host_summary_by_statement_type;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢ç»Ÿè®¡
SELECT 
    DIGEST_TEXT,
    COUNT_STAR as exec_count,
    AVG_TIMER_WAIT/1000000000 as avg_time_sec,
    MAX_TIMER_WAIT/1000000000 as max_time_sec
FROM performance_schema.events_statements_summary_by_digest 
WHERE AVG_TIMER_WAIT > 1000000000  -- å¤§äº1ç§’çš„æŸ¥è¯¢
ORDER BY AVG_TIMER_WAIT DESC
LIMIT 10;
```

### 6.2 æ€§èƒ½è°ƒä¼˜å®è·µ


**Router æ€§èƒ½å‚æ•°è°ƒä¼˜**ï¼š
```ini
[DEFAULT]
# æ—¥å¿—çº§åˆ«ä¼˜åŒ–
logging_folder = /var/log/mysqlrouter
level = INFO

[routing:primary] 
# è¿æ¥ç›¸å…³ä¼˜åŒ–
max_connections = 1000           # æ ¹æ®åº”ç”¨éœ€æ±‚è°ƒæ•´
max_connect_errors = 10          # é™ä½ä»¥å¿«é€Ÿæ£€æµ‹æ•…éšœ
connect_timeout = 5              # è¿æ¥è¶…æ—¶æ—¶é—´
client_connect_timeout = 30      # å®¢æˆ·ç«¯è¶…æ—¶

# è·¯ç”±ç­–ç•¥ä¼˜åŒ–
routing_strategy = least-connections  # ä½¿ç”¨æœ€å°‘è¿æ¥ç­–ç•¥
protocol = classic               # ä½¿ç”¨ç»å…¸åè®®

[routing:secondary]
# è¯»èŠ‚ç‚¹ä¸“ç”¨ä¼˜åŒ–
max_connections = 2000           # è¯»èŠ‚ç‚¹å¯ä»¥è®¾ç½®æ›´å¤šè¿æ¥
routing_strategy = round-robin-with-fallback
client_connect_timeout = 15      # è¯»æ“ä½œè¶…æ—¶å¯ä»¥çŸ­ä¸€äº›
```

**åº”ç”¨å±‚æ€§èƒ½ä¼˜åŒ–**ï¼š
```python
class OptimizedDatabaseManager:
    def __init__(self):
        # è¯»å†™åˆ†ç¦»è¿æ¥æ± 
        self.write_pool = self.create_pool(port=6446, pool_size=50)
        self.read_pool = self.create_pool(port=6447, pool_size=100)
        
        # æ€§èƒ½ç›‘æ§
        self.stats = {
            'queries': 0,
            'slow_queries': 0,
            'errors': 0,
            'avg_response_time': 0
        }
    
    def execute_with_monitoring(self, sql, params=None, read_only=False):
        start_time = time.time()
        pool = self.read_pool if read_only else self.write_pool
        
        try:
            conn = pool.get_connection(timeout=5)
            cursor = conn.cursor(buffered=True)  # ä½¿ç”¨ç¼“å†²æ¸¸æ ‡æå‡æ€§èƒ½
            
            cursor.execute(sql, params)
            
            if sql.strip().upper().startswith('SELECT'):
                result = cursor.fetchall()
            else:
                conn.commit()
                result = cursor.rowcount
            
            # æ€§èƒ½ç»Ÿè®¡
            execution_time = time.time() - start_time
            self.update_stats(execution_time, False)
            
            return result
            
        except Exception as e:
            self.update_stats(time.time() - start_time, True)
            raise e
        finally:
            if 'conn' in locals():
                conn.close()
    
    def update_stats(self, execution_time, is_error):
        self.stats['queries'] += 1
        if execution_time > 1:  # æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’
            self.stats['slow_queries'] += 1
        if is_error:
            self.stats['errors'] += 1
        
        # æ›´æ–°å¹³å‡å“åº”æ—¶é—´
        total_time = self.stats['avg_response_time'] * (self.stats['queries'] - 1)
        self.stats['avg_response_time'] = (total_time + execution_time) / self.stats['queries']
    
    def get_performance_report(self):
        total = self.stats['queries']
        if total == 0:
            return "æš‚æ— æŸ¥è¯¢ç»Ÿè®¡"
        
        return f"""
æ€§èƒ½ç»Ÿè®¡æŠ¥å‘Š:
æ€»æŸ¥è¯¢æ•°: {total}
æ…¢æŸ¥è¯¢æ•°: {self.stats['slow_queries']} ({self.stats['slow_queries']/total*100:.2f}%)
é”™è¯¯æ•°: {self.stats['errors']} ({self.stats['errors']/total*100:.2f}%)
å¹³å‡å“åº”æ—¶é—´: {self.stats['avg_response_time']:.3f}ç§’
        """
```

### 6.3 æ€§èƒ½ç“¶é¢ˆè¯Šæ–­


**å¸¸è§æ€§èƒ½é—®é¢˜**ï¼š
```
ğŸ”¸ è¿æ¥æ•°ä¸å¤Ÿï¼šåº”ç”¨ç­‰å¾…è¿æ¥æ—¶é—´è¿‡é•¿
ğŸ”¸ è·¯ç”±ä¸å‡ï¼šæŸäº›èŠ‚ç‚¹è´Ÿè½½è¿‡é«˜ï¼Œå…¶ä»–ç©ºé—²
ğŸ”¸ æ…¢æŸ¥è¯¢ï¼šå•ä¸ªæŸ¥è¯¢è€—æ—¶è¿‡é•¿å½±å“æ•´ä½“æ€§èƒ½
ğŸ”¸ ç½‘ç»œå»¶è¿Ÿï¼šRouterä¸æ•°æ®åº“èŠ‚ç‚¹é—´ç½‘ç»œæ…¢
ğŸ”¸ èµ„æºä¸è¶³ï¼šCPUã€å†…å­˜ã€ç£ç›˜æˆä¸ºç“¶é¢ˆ
```

**è¯Šæ–­æ–¹æ³•**ï¼š
```sql
-- 1. æ£€æŸ¥è¿æ¥çŠ¶æ€
SHOW PROCESSLIST;

-- 2. æŸ¥çœ‹å½“å‰è´Ÿè½½
SHOW GLOBAL STATUS LIKE 'Threads_%';
SHOW GLOBAL STATUS LIKE 'Questions';

-- 3. åˆ†ææ…¢æŸ¥è¯¢
SELECT 
    sql_text,
    exec_count,
    avg_latency,
    max_latency
FROM sys.statements_with_runtimes_in_95th_percentile;

-- 4. æ£€æŸ¥é”ç­‰å¾…
SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread,
    b.trx_query blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ MySQL Routerï¼šMySQLé›†ç¾¤çš„è´Ÿè½½å‡è¡¡å™¨å’Œä»£ç†
ğŸ”¸ è¯»å†™åˆ†ç¦»ï¼šå†™æ“ä½œåˆ°ä¸»èŠ‚ç‚¹ï¼Œè¯»æ“ä½œåˆ†å‘åˆ°ä»èŠ‚ç‚¹
ğŸ”¸ è¿æ¥æ± ï¼šé¢„å…ˆå»ºç«‹è¿æ¥æ± ï¼Œé¿å…é¢‘ç¹å»ºè¿é”€æ¯
ğŸ”¸ è´Ÿè½½å‡è¡¡ï¼šåˆç†åˆ†é…è¯·æ±‚åˆ°ä¸åŒèŠ‚ç‚¹ï¼Œé¿å…çƒ­ç‚¹
ğŸ”¸ å¥åº·æ£€æŸ¥ï¼šè‡ªåŠ¨æ£€æµ‹èŠ‚ç‚¹çŠ¶æ€ï¼Œæ•…éšœæ—¶è‡ªåŠ¨éš”ç¦»
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨é€‰ä¸¾æ–°ä¸»èŠ‚ç‚¹
```

### 7.2 å…³é”®é…ç½®è¦ç‚¹


**Router é…ç½®æ ¸å¿ƒ**ï¼š
```
âœ… æ­£ç¡®è®¾ç½®è¯»å†™ç«¯å£ï¼šä¸»èŠ‚ç‚¹6446ï¼Œä»èŠ‚ç‚¹6447
âœ… é€‰æ‹©åˆé€‚çš„è·¯ç”±ç­–ç•¥ï¼šè½®è¯¢ã€æœ€å°‘è¿æ¥ã€åŠ æƒç­‰
âœ… é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼šè¿æ¥è¶…æ—¶ã€å®¢æˆ·ç«¯è¶…æ—¶
âœ… è®¾ç½®é€‚å½“çš„è¿æ¥æ•°é™åˆ¶ï¼šmax_connections
âœ… å¯ç”¨å¥åº·æ£€æŸ¥ï¼šttlã€connect_timeoutç­‰å‚æ•°
```

**åº”ç”¨å±‚ä¼˜åŒ–è¦ç‚¹**ï¼š
```
âœ… ä½¿ç”¨è¿æ¥æ± ï¼šé¿å…é¢‘ç¹å»ºç«‹è¿æ¥
âœ… è¯»å†™åˆ†ç¦»ï¼šä¸åŒç±»å‹æ“ä½œä½¿ç”¨ä¸åŒè¿æ¥
âœ… ç›‘æ§æ€§èƒ½ï¼šè®°å½•æŸ¥è¯¢æ—¶é—´ã€é”™è¯¯ç‡ç­‰æŒ‡æ ‡
âœ… æ•…éšœå¤„ç†ï¼šè®¾ç½®åˆç†çš„é‡è¯•å’Œè¶…æ—¶æœºåˆ¶
âœ… èµ„æºç®¡ç†ï¼šåŠæ—¶é‡Šæ”¾è¿æ¥å’Œæ¸¸æ ‡èµ„æº
```

### 7.3 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


**è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©**ï¼š
```
åœºæ™¯1ï¼šèŠ‚ç‚¹æ€§èƒ½ç›¸åŒï¼Œè¯·æ±‚å¤„ç†æ—¶é—´ç›¸è¿‘
æ¨èï¼šè½®è¯¢ç­–ç•¥ (Round Robin)

åœºæ™¯2ï¼šèŠ‚ç‚¹æ€§èƒ½ä¸åŒ
æ¨èï¼šåŠ æƒè½®è¯¢ (Weighted Round Robin)

åœºæ™¯3ï¼šé•¿è¿æ¥è¾ƒå¤šï¼Œå¤„ç†æ—¶é—´å·®å¼‚å¤§
æ¨èï¼šæœ€å°‘è¿æ¥ç­–ç•¥ (Least Connections)

åœºæ™¯4ï¼šéœ€è¦ä¼šè¯ç²˜æ€§
æ¨èï¼šåŸºäºIPå“ˆå¸Œçš„ç­–ç•¥
```

**ç›‘æ§æŒ‡æ ‡é‡ç‚¹**ï¼š
```
ğŸ”¸ è¿æ¥æ•°ç›‘æ§ï¼šç¡®ä¿è¿æ¥æ± å……è¶³ä½†ä¸æµªè´¹
ğŸ”¸ å“åº”æ—¶é—´ç›‘æ§ï¼šåŠæ—¶å‘ç°æ€§èƒ½é—®é¢˜
ğŸ”¸ é”™è¯¯ç‡ç›‘æ§ï¼šå¿«é€Ÿå®šä½æ•…éšœèŠ‚ç‚¹
ğŸ”¸ è´Ÿè½½åˆ†å¸ƒç›‘æ§ï¼šç¡®ä¿è´Ÿè½½å‡è¡¡æ•ˆæœ
ğŸ”¸ èµ„æºä½¿ç”¨ç›‘æ§ï¼šé¢„é˜²èµ„æºè€—å°½
```

### 7.4 æ•…éšœå¤„ç†æŒ‡å—


**å¸¸è§é—®é¢˜å¤„ç†**ï¼š
```
é—®é¢˜1ï¼šæŸä¸ªèŠ‚ç‚¹è¿æ¥æ•°è¿‡é«˜
è§£å†³ï¼šè°ƒæ•´è·¯ç”±ç­–ç•¥ä¸ºæœ€å°‘è¿æ¥ç®—æ³•

é—®é¢˜2ï¼šä¸»èŠ‚ç‚¹æ•…éšœæ— æ³•è‡ªåŠ¨åˆ‡æ¢
è§£å†³ï¼šæ£€æŸ¥ç»„å¤åˆ¶é…ç½®å’ŒRouterå¥åº·æ£€æŸ¥è®¾ç½®

é—®é¢˜3ï¼šè¯»å†™åˆ†ç¦»ä¸ç”Ÿæ•ˆ
è§£å†³ï¼šéªŒè¯ç«¯å£é…ç½®å’Œåº”ç”¨è¿æ¥é…ç½®

é—®é¢˜4ï¼šè¿æ¥æ± è€—å°½
è§£å†³ï¼šå¢å¤§è¿æ¥æ± å¤§å°æˆ–ä¼˜åŒ–æŸ¥è¯¢æ•ˆç‡

é—®é¢˜5ï¼šè´Ÿè½½ä¸å‡è¡¡
è§£å†³ï¼šæ£€æŸ¥èŠ‚ç‚¹æƒé‡é…ç½®å’Œè·¯ç”±ç­–ç•¥
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- MySQL Routeræ˜¯é›†ç¾¤æµé‡çš„"æ™ºèƒ½äº¤é€šæŒ‡æŒ¥å‘˜"
- è¯»å†™åˆ†ç¦»è®©ä¸»èŠ‚ç‚¹ä¸“æ³¨å†™å…¥ï¼Œä»èŠ‚ç‚¹åˆ†æ‹…è¯»å–å‹åŠ›
- è¿æ¥æ± æ˜¯æ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ï¼Œé¿å…é¢‘ç¹å»ºè¿
- å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»ä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§
- ç›‘æ§å’Œè°ƒä¼˜æ˜¯æŒç»­ä¼˜åŒ–çš„å…³é”®

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šè´Ÿè½½å‡è¡¡ä¸ä»…æ˜¯åˆ†å‘æµé‡ï¼Œæ›´æ˜¯è¦æ ¹æ®å®é™…æƒ…å†µæ™ºèƒ½è°ƒåº¦ï¼Œç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½èƒ½å‘æŒ¥æœ€ä½³æ€§èƒ½ï¼ŒåŒæ—¶ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨æ€§ã€‚