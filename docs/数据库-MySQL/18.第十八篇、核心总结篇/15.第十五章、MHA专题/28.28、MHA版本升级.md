---
title: 28ã€MHAç‰ˆæœ¬å‡çº§
---
## ðŸ“š ç›®å½•

1. [ç‰ˆæœ¬å…¼å®¹æ€§åˆ†æž](#1-ç‰ˆæœ¬å…¼å®¹æ€§åˆ†æž)
2. [å‡çº§è®¡åˆ’åˆ¶å®š](#2-å‡çº§è®¡åˆ’åˆ¶å®š)
3. [å‡çº§å‰æ£€æŸ¥](#3-å‡çº§å‰æ£€æŸ¥)
4. [åœ¨çº¿å‡çº§æ–¹æ³•](#4-åœ¨çº¿å‡çº§æ–¹æ³•)
5. [ç¦»çº¿å‡çº§æ–¹æ³•](#5-ç¦»çº¿å‡çº§æ–¹æ³•)
6. [é…ç½®æ–‡ä»¶è¿ç§»](#6-é…ç½®æ–‡ä»¶è¿ç§»)
7. [åŠŸèƒ½éªŒè¯æµ‹è¯•](#7-åŠŸèƒ½éªŒè¯æµ‹è¯•)
8. [æ€§èƒ½å¯¹æ¯”æµ‹è¯•](#8-æ€§èƒ½å¯¹æ¯”æµ‹è¯•)
9. [å›žæ»šæ–¹æ¡ˆ](#9-å›žæ»šæ–¹æ¡ˆ)
10. [å‡çº§æœ€ä½³å®žè·µ](#10-å‡çº§æœ€ä½³å®žè·µ)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ” ç‰ˆæœ¬å…¼å®¹æ€§åˆ†æž


### 1.1 ä»€ä¹ˆæ˜¯MHAç‰ˆæœ¬å…¼å®¹æ€§

**ç®€å•ç†è§£**ï¼šå°±åƒæ‰‹æœºAPPå‡çº§ä¸€æ ·ï¼Œæ–°ç‰ˆæœ¬çš„MHAèƒ½ä¸èƒ½åœ¨ä½ çŽ°æœ‰çš„MySQLçŽ¯å¢ƒä¸‹æ­£å¸¸å·¥ä½œã€‚

**ðŸ”¸ æ ¸å¿ƒå…¼å®¹æ€§è¦ç´ **
```
MHAç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ï¼š
æ•°æ®åº“ç‰ˆæœ¬ï¼šMySQL 5.6+ / MariaDB 10.0+
æ“ä½œç³»ç»Ÿï¼šCentOS/RHEL 6+ / Ubuntu 14.04+
Perlç‰ˆæœ¬ï¼š5.8.8+ (MHAæ˜¯ç”¨Perlå†™çš„)
ä¾èµ–åŒ…ï¼šDBD::mysql, Config::Tinyç­‰
```

### 1.2 ç‰ˆæœ¬å¯¹åº”å…³ç³»è¡¨


| **MHAç‰ˆæœ¬** | **æ”¯æŒçš„MySQLç‰ˆæœ¬** | **å…³é”®ç‰¹æ€§** | **å»ºè®®ä½¿ç”¨åœºæ™¯** |
|------------|-------------------|-------------|-----------------|
| **0.56** | `MySQL 5.5-5.7` | åŸºç¡€æ•…éšœè½¬ç§» | ä¼ ç»ŸMySQLçŽ¯å¢ƒ |
| **0.57** | `MySQL 5.6-8.0` | GTIDæ”¯æŒå¢žå¼º | çŽ°ä»£MySQLçŽ¯å¢ƒ |
| **0.58** | `MySQL 5.7-8.0` | å¹¶è¡Œå¤åˆ¶ä¼˜åŒ– | é«˜å¹¶å‘åœºæ™¯ |

ðŸ’¡ **æ–°æ‰‹æé†’**
> ç‰ˆæœ¬å…¼å®¹å°±åƒä¹°è¡£æœçœ‹å°ºç ï¼ŒMHAç‰ˆæœ¬å¿…é¡»"åˆèº«"ä½ çš„MySQLç‰ˆæœ¬ï¼Œå¦åˆ™ä¼šå‡ºé—®é¢˜ã€‚

### 1.3 å…¼å®¹æ€§æ£€æŸ¥å‘½ä»¤

```bash
# æ£€æŸ¥å½“å‰MHAç‰ˆæœ¬
masterha_check_repl --conf=/etc/mha/app1.cnf

# æ£€æŸ¥MySQLç‰ˆæœ¬å…¼å®¹æ€§
mysql -e "SELECT VERSION();"

# æ£€æŸ¥Perlæ¨¡å—ä¾èµ–
perl -MDBD::mysql -e "print 'DBD::mysql installed\n'"
```

---

## 2. ðŸ“‹ å‡çº§è®¡åˆ’åˆ¶å®š


### 2.1 ä¸ºä»€ä¹ˆéœ€è¦å‡çº§è®¡åˆ’

**é€šä¿—ç†è§£**ï¼šå‡çº§MHAå°±åƒæ¬å®¶ï¼Œéœ€è¦æå‰è§„åˆ’å¥½æ¯ä¸ªæ­¥éª¤ï¼Œé¿å…"ä¸œè¥¿ä¸¢äº†"æˆ–"æ–°å®¶ä½ä¸äº†"ã€‚

**ðŸŽ¯ å‡çº§è®¡åˆ’æ ¸å¿ƒè¦ç´ **
```
æ—¶é—´å®‰æŽ’ï¼šé€‰æ‹©ä¸šåŠ¡ä½Žå³°æœŸ
äººå‘˜é…ç½®ï¼šDBA + è¿ç»´ + å¼€å‘
èµ„æºå‡†å¤‡ï¼šæµ‹è¯•çŽ¯å¢ƒ + å¤‡ä»½ç©ºé—´
é£Žé™©è¯„ä¼°ï¼šå½±å“èŒƒå›´ + å›žæ»šæ—¶é—´
é€šçŸ¥æœºåˆ¶ï¼šä¸šåŠ¡æ–¹ + ç›‘æŽ§å‘Šè­¦
```

### 2.2 å‡çº§è®¡åˆ’æ¨¡æ¿


```
ðŸ—“ï¸ **MHAå‡çº§è®¡åˆ’è¡¨**
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¹ç›®ï¼šMHA 0.56 â†’ 0.58 å‡çº§      â”‚
â”‚ æ—¶é—´ï¼š2025-09-15 02:00-06:00    â”‚
â”‚ è´Ÿè´£äººï¼šå¼ ä¸‰(DBA) æŽå››(è¿ç»´)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é˜¶æ®µ1ï¼š02:00-02:30 å‡çº§å‡†å¤‡     â”‚
â”‚ é˜¶æ®µ2ï¼š02:30-03:30 æ‰§è¡Œå‡çº§     â”‚
â”‚ é˜¶æ®µ3ï¼š03:30-04:30 åŠŸèƒ½æµ‹è¯•     â”‚
â”‚ é˜¶æ®µ4ï¼š04:30-05:00 æ€§èƒ½éªŒè¯     â”‚
â”‚ é˜¶æ®µ5ï¼š05:00-06:00 å›žæ»šçª—å£     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å‡çº§é£Žé™©è¯„ä¼°


**âš ï¸ ä¸»è¦é£Žé™©ç‚¹**
```
é…ç½®ä¸å…¼å®¹ï¼šæ–°ç‰ˆæœ¬é…ç½®æ ¼å¼å˜åŒ–
æœåŠ¡ä¸­æ–­ï¼šå‡çº§è¿‡ç¨‹å¯èƒ½å½±å“ç›‘æŽ§
æ€§èƒ½å˜åŒ–ï¼šæ–°ç‰ˆæœ¬æ€§èƒ½ç‰¹æ€§è°ƒæ•´
å›žæ»šå¤æ‚ï¼šé™çº§æ¯”å‡çº§æ›´å›°éš¾
```

**ðŸ›¡ï¸ é£Žé™©æŽ§åˆ¶æŽªæ–½**
- æµ‹è¯•çŽ¯å¢ƒå®Œæ•´éªŒè¯
- é…ç½®æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†
- å®žæ—¶ç›‘æŽ§å…³é”®æŒ‡æ ‡
- å‡†å¤‡å¿«é€Ÿå›žæ»šæ–¹æ¡ˆ

---

## 3. âœ… å‡çº§å‰æ£€æŸ¥


### 3.1 æ£€æŸ¥æ¸…å•æ¦‚è§ˆ

**ç®€å•ç†è§£**ï¼šå°±åƒå¼€è½¦å‰æ£€æŸ¥æ²¹é‡ã€è½®èƒŽä¸€æ ·ï¼Œå‡çº§å‰è¦ç¡®ä¿æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³ã€‚

**ðŸ“ å‡çº§å‰æ£€æŸ¥æ¸…å•**
```
âœ… **çŽ¯å¢ƒæ£€æŸ¥**
- [ ] å½“å‰MHAçŠ¶æ€æ­£å¸¸
- [ ] MySQLå¤åˆ¶é“¾è·¯æ­£å¸¸
- [ ] ç£ç›˜ç©ºé—´å……è¶³(>10GB)
- [ ] ç½‘ç»œè¿žæŽ¥ç¨³å®š

âœ… **å¤‡ä»½æ£€æŸ¥**
- [ ] é…ç½®æ–‡ä»¶å·²å¤‡ä»½
- [ ] æ•°æ®åº“å·²å¤‡ä»½
- [ ] MHAæ—¥å¿—å·²å¤‡ä»½
- [ ] ç¨‹åºæ–‡ä»¶å·²å¤‡ä»½

âœ… **ä¾èµ–æ£€æŸ¥**
- [ ] Perlç‰ˆæœ¬ç¬¦åˆè¦æ±‚
- [ ] ä¾èµ–æ¨¡å—å·²å®‰è£…
- [ ] SSHå…å¯†ç™»å½•æ­£å¸¸
- [ ] æƒé™é…ç½®æ­£ç¡®
```

### 3.2 è¯¦ç»†æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# MHAå‡çº§å‰æ£€æŸ¥è„šæœ¬

echo "=== MHAå‡çº§å‰æ£€æŸ¥å¼€å§‹ ==="

# 1. æ£€æŸ¥å½“å‰MHAçŠ¶æ€
echo "1. æ£€æŸ¥MHAç®¡ç†å™¨çŠ¶æ€..."
masterha_check_status --conf=/etc/mha/app1.cnf

# 2. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
echo "2. æ£€æŸ¥MySQLå¤åˆ¶çŠ¶æ€..."
masterha_check_repl --conf=/etc/mha/app1.cnf

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "3. æ£€æŸ¥ç£ç›˜ç©ºé—´..."
df -h | grep -E "(/$|/opt|/var)"

# 4. æ£€æŸ¥SSHè¿žæŽ¥
echo "4. æ£€æŸ¥SSHå…å¯†ç™»å½•..."
masterha_check_ssh --conf=/etc/mha/app1.cnf

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

### 3.3 é—®é¢˜è§£å†³æŒ‡å—


**ðŸ”§ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ**
```
é—®é¢˜1ï¼šSSHè¿žæŽ¥å¤±è´¥
åŽŸå› ï¼šå¯†é’¥æ–‡ä»¶æƒé™æˆ–è·¯å¾„é—®é¢˜
è§£å†³ï¼šchmod 600 ~/.ssh/id_rsa

é—®é¢˜2ï¼šPerlæ¨¡å—ç¼ºå¤±
åŽŸå› ï¼šä¾èµ–åŒ…æœªå®‰è£…
è§£å†³ï¼šyum install perl-DBD-MySQL

é—®é¢˜3ï¼šç£ç›˜ç©ºé—´ä¸è¶³
åŽŸå› ï¼šæ—¥å¿—æ–‡ä»¶è¿‡å¤§
è§£å†³ï¼šæ¸…ç†æ—§æ—¥å¿—æˆ–æ‰©å®¹ç£ç›˜
```

---

## 4. ðŸ”„ åœ¨çº¿å‡çº§æ–¹æ³•


### 4.1 ä»€ä¹ˆæ˜¯åœ¨çº¿å‡çº§

**é€šä¿—ç†è§£**ï¼šå°±åƒä¸å…³æœºæ›´æ–°æ‰‹æœºAPPï¼ŒMHAåœ¨çº¿å‡çº§æ˜¯æŒ‡åœ¨ä¸åœæ­¢MySQLæœåŠ¡çš„æƒ…å†µä¸‹å‡çº§MHAç»„ä»¶ã€‚

**âš¡ åœ¨çº¿å‡çº§ç‰¹ç‚¹**
```
ä¼˜åŠ¿ï¼š
â€¢ ä¸šåŠ¡ä¸ä¸­æ–­
â€¢ æ•°æ®åº“æŒç»­æœåŠ¡
â€¢ ç”¨æˆ·æ— æ„ŸçŸ¥

é™åˆ¶ï¼š
â€¢ åªé€‚ç”¨äºŽå°ç‰ˆæœ¬å‡çº§
â€¢ é…ç½®å˜åŒ–ä¸èƒ½å¤ªå¤§
â€¢ éœ€è¦å…¼å®¹æ€§ä¿è¯
```

### 4.2 åœ¨çº¿å‡çº§æ­¥éª¤


**ðŸ”¸ ç¬¬ä¸€æ­¥ï¼šåœæ­¢MHAç®¡ç†å™¨**
```bash
# åœæ­¢MHAç®¡ç†å™¨(ä¸å½±å“MySQLæœåŠ¡)
masterha_stop --conf=/etc/mha/app1.cnf

# ç¡®è®¤ç®¡ç†å™¨å·²åœæ­¢
masterha_check_status --conf=/etc/mha/app1.cnf
```

**ðŸ”¸ ç¬¬äºŒæ­¥ï¼šå‡çº§MHAè½¯ä»¶åŒ…**
```bash
# ä¸‹è½½æ–°ç‰ˆæœ¬MHA
cd /opt/mha
wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.noarch.rpm

# å‡çº§ç®¡ç†å™¨ç»„ä»¶
rpm -Uvh mha4mysql-manager-0.58-0.el7.noarch.rpm

# åœ¨å„ä¸ªMySQLèŠ‚ç‚¹å‡çº§Nodeç»„ä»¶
ssh mysql-slave1 "rpm -Uvh mha4mysql-node-0.58-0.el7.noarch.rpm"
ssh mysql-slave2 "rpm -Uvh mha4mysql-node-0.58-0.el7.noarch.rpm"
```

**ðŸ”¸ ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å‡çº§ç»“æžœ**
```bash
# æ£€æŸ¥ç‰ˆæœ¬
masterha_manager --version

# æ£€æŸ¥é…ç½®å…¼å®¹æ€§
masterha_check_repl --conf=/etc/mha/app1.cnf

# é‡å¯MHAç®¡ç†å™¨
masterha_manager --conf=/etc/mha/app1.cnf --daemon
```

### 4.3 åœ¨çº¿å‡çº§ç›‘æŽ§

```bash
# å®žæ—¶ç›‘æŽ§è„šæœ¬
#!/bin/bash
while true; do
    echo "$(date): æ£€æŸ¥MHAçŠ¶æ€..."
    masterha_check_status --conf=/etc/mha/app1.cnf
    echo "$(date): æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ..."
    mysql -e "SHOW SLAVE STATUS\G" | grep Seconds_Behind_Master
    sleep 30
done
```

---

## 5. ðŸ”§ ç¦»çº¿å‡çº§æ–¹æ³•


### 5.1 ä»€ä¹ˆæ˜¯ç¦»çº¿å‡çº§

**é€šä¿—ç†è§£**ï¼šå°±åƒé‡è£…ç”µè„‘ç³»ç»Ÿï¼Œéœ€è¦å®Œå…¨åœæ­¢æœåŠ¡ï¼Œè¿›è¡Œå½»åº•çš„å‡çº§ï¼Œé€‚ç”¨äºŽå¤§ç‰ˆæœ¬å‡çº§æˆ–æž¶æž„è°ƒæ•´ã€‚

**ðŸŽ¯ ç¦»çº¿å‡çº§é€‚ç”¨åœºæ™¯**
```
å¤§ç‰ˆæœ¬è·¨è¶Šï¼š0.56 â†’ 0.58
æž¶æž„è°ƒæ•´ï¼šå•MHA â†’ å¤šMHA
é…ç½®é‡æž„ï¼šå‚æ•°å¤§å¹…å˜åŒ–
ç¡¬ä»¶å‡çº§ï¼šæœåŠ¡å™¨æ›´æ¢
```

### 5.2 ç¦»çº¿å‡çº§è¯¦ç»†æ­¥éª¤


**ðŸ›‘ ç¬¬ä¸€é˜¶æ®µï¼šæœåŠ¡åœæ­¢**
```bash
# 1. é€šçŸ¥åº”ç”¨åœæ­¢å†™å…¥
echo "åº”ç”¨å±‚é¢åœæ­¢å†™å…¥æ“ä½œ"

# 2. ç­‰å¾…å¤åˆ¶åŒæ­¥å®Œæˆ
mysql -e "SHOW SLAVE STATUS\G" | grep Seconds_Behind_Master

# 3. åœæ­¢MHAç®¡ç†å™¨
masterha_stop --conf=/etc/mha/app1.cnf

# 4. è®°å½•å½“å‰å¤åˆ¶ä½ç½®
mysql -e "SHOW MASTER STATUS\G" > /tmp/master_position_backup.txt
```

**ðŸ”„ ç¬¬äºŒé˜¶æ®µï¼šè½¯ä»¶å‡çº§**
```bash
# 1. å¤‡ä»½æ—§ç‰ˆæœ¬
cp -r /usr/local/bin/masterha_* /opt/backup/mha_old/

# 2. å¸è½½æ—§ç‰ˆæœ¬
rpm -e mha4mysql-manager-0.56
rpm -e mha4mysql-node-0.56

# 3. å®‰è£…æ–°ç‰ˆæœ¬
rpm -ivh mha4mysql-manager-0.58-0.el7.noarch.rpm
rpm -ivh mha4mysql-node-0.58-0.el7.noarch.rpm

# 4. éªŒè¯å®‰è£…
masterha_manager --version
```

**âš™ï¸ ç¬¬ä¸‰é˜¶æ®µï¼šé…ç½®è¿ç§»**
```bash
# 1. å¤‡ä»½æ—§é…ç½®
cp /etc/mha/app1.cnf /etc/mha/app1.cnf.bak

# 2. æ›´æ–°é…ç½®æ–‡ä»¶(æ ¹æ®æ–°ç‰ˆæœ¬è¦æ±‚è°ƒæ•´)
vi /etc/mha/app1.cnf

# 3. éªŒè¯é…ç½®è¯­æ³•
masterha_check_repl --conf=/etc/mha/app1.cnf
```

**ðŸš€ ç¬¬å››é˜¶æ®µï¼šæœåŠ¡æ¢å¤**
```bash
# 1. å¯åŠ¨MHAç®¡ç†å™¨
masterha_manager --conf=/etc/mha/app1.cnf --daemon

# 2. æ£€æŸ¥MHAçŠ¶æ€
masterha_check_status --conf=/etc/mha/app1.cnf

# 3. æ¢å¤åº”ç”¨å†™å…¥
echo "é€šçŸ¥åº”ç”¨å±‚å¯ä»¥æ¢å¤å†™å…¥"
```

### 5.3 ç¦»çº¿å‡çº§æ—¶é—´ä¼°ç®—

```
ðŸ“Š **æ—¶é—´è§„åˆ’å‚è€ƒ**
çŽ¯å¢ƒå‡†å¤‡ï¼š15åˆ†é’Ÿ
è½¯ä»¶å‡çº§ï¼š30åˆ†é’Ÿ  
é…ç½®è°ƒæ•´ï¼š20åˆ†é’Ÿ
åŠŸèƒ½æµ‹è¯•ï¼š45åˆ†é’Ÿ
æœåŠ¡æ¢å¤ï¼š10åˆ†é’Ÿ
æ€»è®¡ï¼šçº¦2å°æ—¶
```

---

## 6. ðŸ“ é…ç½®æ–‡ä»¶è¿ç§»


### 6.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®è¿ç§»

**é€šä¿—ç†è§£**ï¼šå°±åƒæ¬å®¶æ—¶ï¼Œæ—§å®¶çš„é’¥åŒ™å¯èƒ½ä¸é€‚ç”¨æ–°å®¶çš„é”ï¼ŒMHAæ–°ç‰ˆæœ¬çš„é…ç½®æ ¼å¼å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚

**ðŸ”¸ å¸¸è§é…ç½®å˜åŒ–**
```
å‚æ•°åç§°å˜åŒ–ï¼šold_param â†’ new_param
å‚æ•°æ ¼å¼è°ƒæ•´ï¼šIPåœ°å€ â†’ ä¸»æœºå
æ–°å¢žå¿…éœ€å‚æ•°ï¼šå®‰å…¨æ€§é…ç½®
åºŸå¼ƒå‚æ•°ï¼šè¿‡æ—¶åŠŸèƒ½ç§»é™¤
```

### 6.2 é…ç½®æ–‡ä»¶å¯¹æ¯”åˆ†æž


**æ—§ç‰ˆæœ¬é…ç½®ç¤ºä¾‹(0.56)**
```ini
[server default]
manager_workdir=/var/log/mha/app1
manager_log=/var/log/mha/app1/manager.log
master_binlog_dir=/var/lib/mysql
user=mha
password=mhapass
ping_interval=1
repl_user=repl
repl_password=replpass

[server1]
hostname=192.168.1.10
port=3306
candidate_master=1

[server2]
hostname=192.168.1.11
port=3306
candidate_master=1
```

**æ–°ç‰ˆæœ¬é…ç½®ç¤ºä¾‹(0.58)**
```ini
[server default]
# æ–°å¢žå®‰å…¨é…ç½®
ssh_user=mha
ssh_port=22
ssh_options="-o ConnectTimeout=5"

# åŽŸæœ‰é…ç½®ä¿æŒ
manager_workdir=/var/log/mha/app1
manager_log=/var/log/mha/app1/manager.log
master_binlog_dir=/var/lib/mysql
user=mha
password=mhapass
ping_interval=1
repl_user=repl
repl_password=replpass

# æ–°å¢žGTIDæ”¯æŒ
gtid_domain_id=1
use_gtid_for_failover=1

[server1]
hostname=mysql-master
port=3306
candidate_master=1
# æ–°å¢žæƒé‡é…ç½®
master_weight=100

[server2]
hostname=mysql-slave1  
port=3306
candidate_master=1
master_weight=90
```

### 6.3 é…ç½®è¿ç§»å·¥å…·è„šæœ¬

```bash
#!/bin/bash
# MHAé…ç½®æ–‡ä»¶è¿ç§»è„šæœ¬

OLD_CONFIG="/etc/mha/app1.cnf.bak"
NEW_CONFIG="/etc/mha/app1.cnf"

echo "å¼€å§‹é…ç½®æ–‡ä»¶è¿ç§»..."

# 1. åˆ›å»ºæ–°é…ç½®æ–‡ä»¶
cp $OLD_CONFIG $NEW_CONFIG

# 2. æ·»åŠ æ–°ç‰ˆæœ¬å¿…éœ€å‚æ•°
cat >> $NEW_CONFIG << EOF

# MHA 0.58æ–°å¢žé…ç½®
[server default]
ssh_user=mha
ssh_options="-o ConnectTimeout=5"
use_gtid_for_failover=1
gtid_domain_id=1
EOF

# 3. éªŒè¯é…ç½®æ–‡ä»¶
echo "éªŒè¯æ–°é…ç½®æ–‡ä»¶..."
masterha_check_repl --conf=$NEW_CONFIG

if [ $? -eq 0 ]; then
    echo "é…ç½®è¿ç§»æˆåŠŸ!"
else
    echo "é…ç½®éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®æ–‡ä»¶"
    exit 1
fi
```

---

## 7. âœ… åŠŸèƒ½éªŒè¯æµ‹è¯•


### 7.1 éªŒè¯æµ‹è¯•çš„é‡è¦æ€§

**é€šä¿—ç†è§£**ï¼šå°±åƒä¹°äº†æ–°è½¦è¦è¯•é©¾ï¼Œå‡çº§å®ŒMHAå¿…é¡»æµ‹è¯•å„ç§åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

**ðŸŽ¯ æµ‹è¯•èŒƒå›´**
```
åŸºç¡€åŠŸèƒ½ï¼šç›‘æŽ§ã€æ•…éšœæ£€æµ‹
æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨æ•…éšœè½¬ç§»  
ç®¡ç†åŠŸèƒ½ï¼šæ‰‹åŠ¨åˆ‡æ¢ã€åœ¨çº¿é…ç½®
ç›‘æŽ§åŠŸèƒ½ï¼šæ—¥å¿—è®°å½•ã€çŠ¶æ€æŸ¥è¯¢
```

### 7.2 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹


**ðŸ“ æµ‹è¯•ç”¨ä¾‹1ï¼šåŸºç¡€ç›‘æŽ§åŠŸèƒ½**
```bash
# æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯MHAèƒ½æ­£å¸¸ç›‘æŽ§MySQLå¤åˆ¶çŠ¶æ€
# æµ‹è¯•æ­¥éª¤ï¼š
echo "1. æ£€æŸ¥MHAç›‘æŽ§çŠ¶æ€"
masterha_check_status --conf=/etc/mha/app1.cnf

echo "2. æ£€æŸ¥å¤åˆ¶é“¾è·¯ç›‘æŽ§"
masterha_check_repl --conf=/etc/mha/app1.cnf

echo "3. æ£€æŸ¥SSHè¿žæŽ¥ç›‘æŽ§"  
masterha_check_ssh --conf=/etc/mha/app1.cnf

# é¢„æœŸç»“æžœï¼šæ‰€æœ‰æ£€æŸ¥éƒ½åº”è¯¥è¿”å›žOK
```

**ðŸ“ æµ‹è¯•ç”¨ä¾‹2ï¼šæ•…éšœè½¬ç§»åŠŸèƒ½**
```bash
# æµ‹è¯•ç›®æ ‡ï¼šæ¨¡æ‹Ÿä¸»åº“æ•…éšœï¼ŒéªŒè¯è‡ªåŠ¨åˆ‡æ¢
# è­¦å‘Šï¼šè¿™æ˜¯ç ´åæ€§æµ‹è¯•ï¼Œåªèƒ½åœ¨æµ‹è¯•çŽ¯å¢ƒæ‰§è¡Œï¼

echo "æ¨¡æ‹Ÿä¸»åº“æ•…éšœæµ‹è¯•(ä»…æµ‹è¯•çŽ¯å¢ƒ!)"
echo "1. è®°å½•å½“å‰ä¸»åº“ä¿¡æ¯"
mysql -h192.168.1.10 -e "SHOW MASTER STATUS\G"

echo "2. åœæ­¢ä¸»åº“MySQLæœåŠ¡(æ¨¡æ‹Ÿæ•…éšœ)"
ssh 192.168.1.10 "systemctl stop mysql"

echo "3. è§‚å¯ŸMHAè‡ªåŠ¨æ•…éšœè½¬ç§»"
tail -f /var/log/mha/app1/manager.log

echo "4. éªŒè¯æ–°ä¸»åº“çŠ¶æ€"
# ç­‰å¾…æ•…éšœè½¬ç§»å®ŒæˆåŽæ‰§è¡Œ
mysql -h192.168.1.11 -e "SHOW MASTER STATUS\G"
```

**ðŸ“ æµ‹è¯•ç”¨ä¾‹3ï¼šæ‰‹åŠ¨åˆ‡æ¢åŠŸèƒ½**
```bash
# æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯æ‰‹åŠ¨ä¸»ä»Žåˆ‡æ¢åŠŸèƒ½
echo "æ‰‹åŠ¨ä¸»ä»Žåˆ‡æ¢æµ‹è¯•"

echo "1. æ‰§è¡Œåœ¨çº¿ä¸»ä»Žåˆ‡æ¢"
masterha_master_switch \
  --conf=/etc/mha/app1.cnf \
  --master_state=alive \
  --new_master_host=192.168.1.11 \
  --interactive=0

echo "2. éªŒè¯åˆ‡æ¢ç»“æžœ"
masterha_check_status --conf=/etc/mha/app1.cnf
```

### 7.3 æµ‹è¯•ç»“æžœè®°å½•è¡¨


| **æµ‹è¯•é¡¹ç›®** | **æµ‹è¯•ç»“æžœ** | **å“åº”æ—¶é—´** | **å¤‡æ³¨** |
|-------------|-------------|-------------|---------|
| `ç›‘æŽ§åŠŸèƒ½` | âœ… é€šè¿‡ | 2ç§’ | çŠ¶æ€æ­£å¸¸ |
| `æ•…éšœæ£€æµ‹` | âœ… é€šè¿‡ | 5ç§’ | æ£€æµ‹åŠæ—¶ |
| `è‡ªåŠ¨åˆ‡æ¢` | âœ… é€šè¿‡ | 30ç§’ | åˆ‡æ¢æˆåŠŸ |
| `æ‰‹åŠ¨åˆ‡æ¢` | âœ… é€šè¿‡ | 15ç§’ | æ“ä½œæ­£å¸¸ |

---

## 8. ðŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•


### 8.1 ä¸ºä»€ä¹ˆè¦åšæ€§èƒ½æµ‹è¯•

**é€šä¿—ç†è§£**ï¼šå°±åƒä¹°è½¦è¦çœ‹æ²¹è€—ï¼Œå‡çº§MHAåŽè¦ç¡®ä¿æ€§èƒ½æ²¡æœ‰ä¸‹é™ï¼Œç”šè‡³æœ‰æ‰€æå‡ã€‚

**ðŸ”¸ æ€§èƒ½æµ‹è¯•å…³æ³¨ç‚¹**
```
æ•…éšœæ£€æµ‹æ—¶é—´ï¼šå‘çŽ°æ•…éšœçš„é€Ÿåº¦
åˆ‡æ¢å®Œæˆæ—¶é—´ï¼šæ¢å¤æœåŠ¡çš„é€Ÿåº¦  
èµ„æºæ¶ˆè€—ï¼šCPUã€å†…å­˜ä½¿ç”¨çŽ‡
ç›‘æŽ§ç²¾åº¦ï¼šè¯¯æŠ¥ã€æ¼æŠ¥æƒ…å†µ
```

### 8.2 æ€§èƒ½æµ‹è¯•æ–¹æ³•


**â±ï¸ æ•…éšœæ£€æµ‹æ—¶é—´æµ‹è¯•**
```bash
#!/bin/bash
# æ•…éšœæ£€æµ‹æ—¶é—´æµ‹è¯•è„šæœ¬

echo "å¼€å§‹æ•…éšœæ£€æµ‹æ—¶é—´æµ‹è¯•..."

# è®°å½•å¼€å§‹æ—¶é—´
START_TIME=$(date +%s)

# æ¨¡æ‹Ÿä¸»åº“æ•…éšœ
ssh 192.168.1.10 "systemctl stop mysql"

# ç›‘æŽ§MHAæ—¥å¿—ï¼Œç­‰å¾…æ£€æµ‹åˆ°æ•…éšœ
while true; do
    if grep -q "Master .* is down" /var/log/mha/app1/manager.log; then
        END_TIME=$(date +%s)
        DETECTION_TIME=$((END_TIME - START_TIME))
        echo "æ•…éšœæ£€æµ‹æ—¶é—´: ${DETECTION_TIME}ç§’"
        break
    fi
    sleep 1
done
```

**ðŸ’¾ èµ„æºæ¶ˆè€—ç›‘æŽ§**
```bash
#!/bin/bash
# MHAèµ„æºæ¶ˆè€—ç›‘æŽ§è„šæœ¬

echo "å¼€å§‹ç›‘æŽ§MHAèµ„æºæ¶ˆè€—..."

# èŽ·å–MHAè¿›ç¨‹ID
MHA_PID=$(ps aux | grep masterha_manager | grep -v grep | awk '{print $2}')

# æŒç»­ç›‘æŽ§èµ„æºä½¿ç”¨
while true; do
    if [ ! -z "$MHA_PID" ]; then
        CPU_USAGE=$(ps -p $MHA_PID -o %cpu --no-headers)
        MEM_USAGE=$(ps -p $MHA_PID -o %mem --no-headers)
        echo "$(date): CPU: ${CPU_USAGE}%, å†…å­˜: ${MEM_USAGE}%"
    fi
    sleep 10
done
```

### 8.3 æ€§èƒ½å¯¹æ¯”æ•°æ®


**ðŸ“ˆ ç‰ˆæœ¬æ€§èƒ½å¯¹æ¯”è¡¨**
```
æ€§èƒ½å¯¹æ¯”ï¼šMHA 0.56 vs 0.58
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡é¡¹ç›®    â”‚ v0.56  â”‚ v0.58   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•…éšœæ£€æµ‹    â”‚ 8ç§’    â”‚ 5ç§’     â”‚
â”‚ åˆ‡æ¢æ—¶é—´    â”‚ 45ç§’   â”‚ 30ç§’    â”‚
â”‚ CPUä½¿ç”¨çŽ‡   â”‚ 2.1%   â”‚ 1.8%    â”‚
â”‚ å†…å­˜å ç”¨    â”‚ 128MB  â”‚ 95MB    â”‚
â”‚ ç›‘æŽ§ç²¾åº¦    â”‚ 95%    â”‚ 98%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®ºï¼šæ–°ç‰ˆæœ¬åœ¨å„é¡¹æŒ‡æ ‡ä¸Šéƒ½æœ‰æ˜Žæ˜¾æå‡
```

---

## 9. ðŸ”™ å›žæ»šæ–¹æ¡ˆ


### 9.1 ä»€ä¹ˆæ—¶å€™éœ€è¦å›žæ»š

**é€šä¿—ç†è§£**ï¼šå°±åƒæ–°ä¹°çš„è¡£æœä¸åˆèº«è¦é€€è´§ï¼Œå¦‚æžœå‡çº§åŽå‘çŽ°é—®é¢˜ï¼Œéœ€è¦å¿«é€Ÿæ¢å¤åˆ°æ—§ç‰ˆæœ¬ã€‚

**âš ï¸ å›žæ»šè§¦å‘æ¡ä»¶**
```
åŠŸèƒ½å¼‚å¸¸ï¼šå…³é”®åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
æ€§èƒ½ä¸‹é™ï¼šå“åº”æ—¶é—´æ˜Žæ˜¾å˜æ…¢
å…¼å®¹æ€§é—®é¢˜ï¼šä¸ŽçŽ°æœ‰çŽ¯å¢ƒä¸å…¼å®¹
ç¨³å®šæ€§é—®é¢˜ï¼šé¢‘ç¹å‡ºçŽ°é”™è¯¯
```

### 9.2 å¿«é€Ÿå›žæ»šæ­¥éª¤


**ðŸ”¸ ç¬¬ä¸€æ­¥ï¼šç«‹å³åœæ­¢æ–°ç‰ˆæœ¬æœåŠ¡**
```bash
# 1. åœæ­¢MHAç®¡ç†å™¨
masterha_stop --conf=/etc/mha/app1.cnf

# 2. ç¡®è®¤æœåŠ¡å·²åœæ­¢
ps aux | grep masterha_manager
```

**ðŸ”¸ ç¬¬äºŒæ­¥ï¼šæ¢å¤æ—§ç‰ˆæœ¬è½¯ä»¶**
```bash
# 1. å¸è½½æ–°ç‰ˆæœ¬
rpm -e mha4mysql-manager-0.58
rpm -e mha4mysql-node-0.58

# 2. å®‰è£…æ—§ç‰ˆæœ¬(ä»Žå¤‡ä»½)
rpm -ivh /opt/backup/mha4mysql-manager-0.56-0.el6.noarch.rpm
rpm -ivh /opt/backup/mha4mysql-node-0.56-0.el6.noarch.rpm

# 3. éªŒè¯ç‰ˆæœ¬
masterha_manager --version
```

**ðŸ”¸ ç¬¬ä¸‰æ­¥ï¼šæ¢å¤é…ç½®æ–‡ä»¶**
```bash
# æ¢å¤æ—§ç‰ˆæœ¬é…ç½®
cp /etc/mha/app1.cnf.bak /etc/mha/app1.cnf

# éªŒè¯é…ç½®
masterha_check_repl --conf=/etc/mha/app1.cnf
```

**ðŸ”¸ ç¬¬å››æ­¥ï¼šé‡å¯æœåŠ¡éªŒè¯**
```bash
# é‡å¯MHAæœåŠ¡
masterha_manager --conf=/etc/mha/app1.cnf --daemon

# å…¨é¢åŠŸèƒ½æµ‹è¯•
masterha_check_status --conf=/etc/mha/app1.cnf
```

### 9.3 å›žæ»šéªŒè¯æ¸…å•

```
âœ… **å›žæ»šéªŒè¯æ£€æŸ¥**
- [ ] MHAç‰ˆæœ¬å·²å›žé€€åˆ°åŽŸç‰ˆæœ¬
- [ ] é…ç½®æ–‡ä»¶æ¢å¤æ­£å¸¸
- [ ] MHAç›‘æŽ§åŠŸèƒ½æ­£å¸¸
- [ ] MySQLå¤åˆ¶çŠ¶æ€æ­£å¸¸
- [ ] åº”ç”¨è¿žæŽ¥æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
```

### 9.4 å›žæ»šæ—¶é—´é¢„ä¼°

```
â° **å›žæ»šæ—¶é—´è§„åˆ’**
æœåŠ¡åœæ­¢ï¼š2åˆ†é’Ÿ
è½¯ä»¶å›žé€€ï¼š10åˆ†é’Ÿ
é…ç½®æ¢å¤ï¼š5åˆ†é’Ÿ  
æœåŠ¡éªŒè¯ï¼š15åˆ†é’Ÿ
æ€»è®¡ï¼šçº¦30åˆ†é’Ÿ
```

---

## 10. ðŸ† å‡çº§æœ€ä½³å®žè·µ


### 10.1 å‡çº§å‰å‡†å¤‡æœ€ä½³å®žè·µ

**ðŸ’¡ å‡†å¤‡å·¥ä½œé»„é‡‘æ³•åˆ™**
```
1. å……åˆ†æµ‹è¯•åŽŸåˆ™
   â€¢ æµ‹è¯•çŽ¯å¢ƒå®Œå…¨æ¨¡æ‹Ÿç”Ÿäº§
   â€¢ æ‰€æœ‰åŠŸèƒ½å¿…é¡»éªŒè¯é€šè¿‡
   â€¢ æ€§èƒ½æµ‹è¯•ç¡®è®¤æ— å›žé€€

2. å®Œæ•´å¤‡ä»½åŽŸåˆ™  
   â€¢ é…ç½®æ–‡ä»¶ã€ç¨‹åºæ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶
   â€¢ æ•°æ®åº“å…¨é‡å¤‡ä»½
   â€¢ å¤‡ä»½æ–‡ä»¶éªŒè¯å¯ç”¨æ€§

3. è¯¦ç»†æ–‡æ¡£åŽŸåˆ™
   â€¢ å‡çº§æ­¥éª¤è¯¦ç»†è®°å½•
   â€¢ å›žæ»šæ–¹æ¡ˆæå‰å‡†å¤‡
   â€¢ åº”æ€¥è”ç³»äººæ¸…å•
```

### 10.2 å‡çº§æ‰§è¡Œæœ€ä½³å®žè·µ


**âš¡ æ‰§è¡Œé˜¶æ®µå…³é”®è¦ç‚¹**
```
æ—¶é—´é€‰æ‹©ï¼š
â€¢ ä¸šåŠ¡ä½Žå³°æœŸæ‰§è¡Œ(å‡Œæ™¨2-6ç‚¹)
â€¢ é¿å¼€æœˆæœ«ã€å­£æœ«ç­‰å…³é”®æ—¶é—´
â€¢ ç¡®ä¿æœ‰è¶³å¤Ÿæ—¶é—´çª—å£

äººå‘˜é…ç½®ï¼š
â€¢ ä¸»æ“ä½œå‘˜ï¼šèµ„æ·±DBAè´Ÿè´£
â€¢ ååŠ©äººå‘˜ï¼šç†Ÿæ‚‰çŽ¯å¢ƒçš„è¿ç»´
â€¢ å¾…å‘½äººå‘˜ï¼šå¼€å‘å’Œä¸šåŠ¡è´Ÿè´£äºº

ç›‘æŽ§å‘Šè­¦ï¼š
â€¢ å‡çº§æœŸé—´åŠ å¼ºç›‘æŽ§
â€¢ å…³é”®æŒ‡æ ‡å®žæ—¶è·Ÿè¸ª
â€¢ å¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥
```

### 10.3 å‡çº§åŽç»´æŠ¤æœ€ä½³å®žè·µ


**ðŸ” å‡çº§åŽè§‚å¯ŸæœŸè¦ç‚¹**
```
7å¤©è§‚å¯ŸæœŸï¼š
â€¢ æ¯æ—¥æ£€æŸ¥MHAçŠ¶æ€
â€¢ ç›‘æŽ§æ€§èƒ½æŒ‡æ ‡å˜åŒ–
â€¢ å…³æ³¨é”™è¯¯æ—¥å¿—å†…å®¹
â€¢ æ”¶é›†ç”¨æˆ·åé¦ˆ

30å¤©ç¨³å®šæœŸï¼š
â€¢ weeklyæ€§èƒ½æŠ¥å‘Š
â€¢ æœˆåº¦ç¨³å®šæ€§åˆ†æž
â€¢ ä¼˜åŒ–é…ç½®å‚æ•°
â€¢ æ›´æ–°æ“ä½œæ–‡æ¡£
```

### 10.4 ç»éªŒæ€»ç»“ä¸Žå»ºè®®


**ðŸ“š å‡çº§ç»éªŒæ€»ç»“**
```
æˆåŠŸç»éªŒï¼š
âœ… æµ‹è¯•çŽ¯å¢ƒå…ˆè¡Œï¼Œç”Ÿäº§çŽ¯å¢ƒè·Ÿè¿›
âœ… å°æ­¥å¿«èµ°ï¼Œé€æ­¥å‡çº§
âœ… è¯¦ç»†è®°å½•ï¼Œä¾¿äºŽé—®é¢˜æŽ’æŸ¥
âœ… å……åˆ†æ²Ÿé€šï¼Œå‡å°‘æ„å¤–æƒ…å†µ

å¸¸è§è¯¯åŒºï¼š
âŒ è·³è¿‡æµ‹è¯•çŽ¯å¢ƒç›´æŽ¥ç”Ÿäº§å‡çº§
âŒ å¿½è§†é…ç½®æ–‡ä»¶å…¼å®¹æ€§æ£€æŸ¥  
âŒ å‡çº§çª—å£æ—¶é—´å®‰æŽ’è¿‡äºŽç´§å¼ 
âŒ ç¼ºå°‘å›žæ»šæ–¹æ¡ˆå’Œç»ƒä¹ 
```

**ðŸŽ¯ å‡çº§æˆåŠŸçŽ‡æå‡å»ºè®®**
```
æŠ€æœ¯å±‚é¢ï¼š
â€¢ å»ºç«‹æ ‡å‡†åŒ–å‡çº§æµç¨‹
â€¢ å¼€å‘è‡ªåŠ¨åŒ–å‡çº§è„šæœ¬
â€¢ å®Œå–„ç›‘æŽ§å’Œå‘Šè­¦æœºåˆ¶

ç®¡ç†å±‚é¢ï¼š  
â€¢ å»ºç«‹å‡çº§å®¡æ‰¹æµç¨‹
â€¢ å®šæœŸä¸¾è¡Œå‡çº§æ¼”ç»ƒ
â€¢ æŒç»­ä¼˜åŒ–å‡çº§æµç¨‹
```

---

## 11. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ðŸ”¸ ç‰ˆæœ¬å…¼å®¹æ€§ï¼šç¡®ä¿MHAç‰ˆæœ¬ä¸ŽMySQLç‰ˆæœ¬åŒ¹é…
ðŸ”¸ å‡çº§è®¡åˆ’ï¼šè¯¦ç»†è§„åˆ’æ—¶é—´ã€äººå‘˜ã€èµ„æºã€é£Žé™©
ðŸ”¸ å‡çº§æ–¹å¼ï¼šåœ¨çº¿å‡çº§é€‚ç”¨å°ç‰ˆæœ¬ï¼Œç¦»çº¿å‡çº§é€‚ç”¨å¤§ç‰ˆæœ¬
ðŸ”¸ é…ç½®è¿ç§»ï¼šæ–°ç‰ˆæœ¬é…ç½®æ ¼å¼å¯èƒ½å‘ç”Ÿå˜åŒ–
ðŸ”¸ åŠŸèƒ½éªŒè¯ï¼šå‡çº§åŽå¿…é¡»å…¨é¢æµ‹è¯•å„é¡¹åŠŸèƒ½
ðŸ”¸ æ€§èƒ½æµ‹è¯•ï¼šç¡®ä¿å‡çº§åŽæ€§èƒ½ä¸ä¸‹é™
ðŸ”¸ å›žæ»šæ–¹æ¡ˆï¼šå‡çº§å¤±è´¥æ—¶çš„å¿«é€Ÿæ¢å¤æ–¹æ³•
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ å‡çº§ä¸æ˜¯ç®€å•çš„è½¯ä»¶æ›¿æ¢**
```
å‡çº§æ¶‰åŠï¼š
â€¢ è½¯ä»¶ç‰ˆæœ¬æ›´æ–°
â€¢ é…ç½®æ–‡ä»¶è°ƒæ•´
â€¢ åŠŸèƒ½ç‰¹æ€§å˜åŒ–
â€¢ æ€§èƒ½ç‰¹æ€§ä¼˜åŒ–
â€¢ æ“ä½œä¹ æƒ¯æ”¹å˜

å› æ­¤éœ€è¦ï¼š
â€¢ å……åˆ†çš„å‡†å¤‡å’Œæµ‹è¯•
â€¢ è¯¦ç»†çš„è®¡åˆ’å’Œæ–‡æ¡£
â€¢ å®Œå–„çš„éªŒè¯å’Œå›žæ»š
```

**ðŸ”¹ é£Žé™©æŽ§åˆ¶æ˜¯å‡çº§æˆåŠŸçš„å…³é”®**
```
é£Žé™©æŽ§åˆ¶ç­–ç•¥ï¼š
â€¢ æµ‹è¯•å…ˆè¡Œï¼šå…ˆåœ¨æµ‹è¯•çŽ¯å¢ƒéªŒè¯
â€¢ å¤‡ä»½å®Œæ•´ï¼šç¡®ä¿å¯ä»¥å¿«é€Ÿæ¢å¤
â€¢ ç›‘æŽ§åŠ å¼ºï¼šå®žæ—¶è§‚å¯Ÿç³»ç»ŸçŠ¶æ€
â€¢ åˆ†æ­¥æ‰§è¡Œï¼šé¿å…ä¸€æ¬¡æ€§å¤§å¹…å˜æ›´
```

### 11.3 å®žé™…åº”ç”¨ä»·å€¼


**ðŸŽ¯ ä¸šåŠ¡ä»·å€¼**
- **æå‡å¯é æ€§**ï¼šæ–°ç‰ˆæœ¬é€šå¸¸ä¿®å¤äº†å·²çŸ¥é—®é¢˜
- **å¢žå¼ºåŠŸèƒ½**ï¼šèŽ·å¾—æ–°ç‰¹æ€§å’Œæ€§èƒ½ä¼˜åŒ–
- **å®‰å…¨åŠ å›º**ï¼šæ–°ç‰ˆæœ¬åŒ…å«å®‰å…¨æ€§æ”¹è¿›
- **æŠ€æœ¯å€ºåŠ¡**ï¼šé¿å…ç‰ˆæœ¬è¿‡åº¦è€åŒ–

**ðŸ”§ æŠ€æœ¯ä»·å€¼**
- **è¿ç»´æ•ˆçŽ‡**ï¼šæ–°ç‰ˆæœ¬é€šå¸¸æœ‰æ›´å¥½çš„è¿ç»´å·¥å…·
- **ç›‘æŽ§èƒ½åŠ›**ï¼šå¢žå¼ºçš„ç›‘æŽ§å’Œè¯Šæ–­åŠŸèƒ½
- **å…¼å®¹æ€§**ï¼šä¸Žæ–°ç‰ˆæœ¬MySQLçš„æ›´å¥½å…¼å®¹
- **ç¤¾åŒºæ”¯æŒ**ï¼šèŽ·å¾—æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ

### 11.4 æ³¨æ„äº‹é¡¹æé†’


**âš ï¸ å‡çº§è¿‡ç¨‹ä¸­çš„é‡è¦æé†’**
```
æ—¶é—´å®‰æŽ’ï¼š
â€¢ åŠ¡å¿…é€‰æ‹©ä¸šåŠ¡ä½Žå³°æœŸ
â€¢ é¢„ç•™å……è¶³çš„æ—¶é—´çª—å£
â€¢ è€ƒè™‘æ—¶åŒºå’Œå‡æœŸå› ç´ 

äººå‘˜é…ç½®ï¼š
â€¢ ç¡®ä¿å…³é”®äººå‘˜åœ¨åœº
â€¢ å‡†å¤‡åº”æ€¥è”ç³»æ–¹å¼  
â€¢ æ˜Žç¡®è´£ä»»åˆ†å·¥

æŠ€æœ¯è¦ç‚¹ï¼š
â€¢ ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ä¸å¯çœç•¥
â€¢ é…ç½®æ–‡ä»¶è¿ç§»è¦ä»”ç»†éªŒè¯
â€¢ åŠŸèƒ½æµ‹è¯•è¦è¦†ç›–æ‰€æœ‰åœºæ™¯
â€¢ å›žæ»šæ–¹æ¡ˆè¦æå‰æ¼”ç»ƒ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- MHAå‡çº§éœ€è°¨æ…Žï¼Œç‰ˆæœ¬å…¼å®¹æ˜¯å‰æ
- æµ‹è¯•å…ˆè¡Œç”Ÿäº§è·Ÿï¼Œå¤‡ä»½å›žæ»šä¸¤æ‰‹æŠ“  
- åŠŸèƒ½æ€§èƒ½åŒéªŒè¯ï¼Œç›‘æŽ§æ—¥å¿—è¦ç»†çœ‹
- å‡çº§æˆåŠŸé å‡†å¤‡ï¼Œé£Žé™©æŽ§åˆ¶ä¿å¹³å®‰

**æœ€ç»ˆå»ºè®®**ï¼šMHAç‰ˆæœ¬å‡çº§æ˜¯ä¸€é¡¹ç³»ç»Ÿå·¥ç¨‹ï¼ŒæˆåŠŸçš„å…³é”®åœ¨äºŽå……åˆ†çš„å‡†å¤‡ã€è¯¦ç»†çš„è®¡åˆ’ã€è°¨æ…Žçš„æ‰§è¡Œå’ŒæŒç»­çš„ç›‘æŽ§ã€‚è®°ä½ï¼šå®å¯æ…¢ä¸€ç‚¹ï¼Œä¹Ÿè¦ç¨³ä¸€ç‚¹ï¼