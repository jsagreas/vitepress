---
title: 12ã€å…‹éš†SSLå®‰å…¨é…ç½®
---
## ðŸ“š ç›®å½•

1. [å…‹éš†æ’ä»¶SSLåŠ å¯†æ¦‚è¿°](#1-å…‹éš†æ’ä»¶SSLåŠ å¯†æ¦‚è¿°)
2. [SSLè¯ä¹¦é…ç½®åŸºç¡€](#2-SSLè¯ä¹¦é…ç½®åŸºç¡€)
3. [å…‹éš†SSLå‚æ•°è¯¦è§£](#3-å…‹éš†SSLå‚æ•°è¯¦è§£)
4. [SSLè¿žæŽ¥éªŒè¯æœºåˆ¶](#4-SSLè¿žæŽ¥éªŒè¯æœºåˆ¶)
5. [å®‰å…¨ä¼ è¾“é…ç½®å®žæˆ˜](#5-å®‰å…¨ä¼ è¾“é…ç½®å®žæˆ˜)
6. [SSLæ•…éšœæŽ’æŸ¥æŒ‡å—](#6-SSLæ•…éšœæŽ’æŸ¥æŒ‡å—)
7. [å®‰å…¨æœ€ä½³å®žè·µ](#7-å®‰å…¨æœ€ä½³å®žè·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ” å…‹éš†æ’ä»¶SSLåŠ å¯†æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦SSLåŠ å¯†


**ä»€ä¹ˆæ˜¯å…‹éš†æ’ä»¶çš„SSLåŠ å¯†ï¼Ÿ**
ç®€å•è¯´ï¼Œå°±æ˜¯ç»™MySQLå…‹éš†æ•°æ®çš„è¿‡ç¨‹åŠ ä¸Šä¸€æŠŠ"å®‰å…¨é”"ã€‚å°±åƒä½ åœ¨ç½‘ä¸Šè´­ç‰©æ—¶ï¼Œæµè§ˆå™¨åœ°å€æ ä¼šæ˜¾ç¤ºä¸€ä¸ªå°é”å›¾æ ‡ï¼Œè¡¨ç¤ºæ•°æ®ä¼ è¾“æ˜¯å®‰å…¨çš„ä¸€æ ·ã€‚

```
æ²¡æœ‰SSLåŠ å¯†çš„å…‹éš†ï¼š
æºæœåŠ¡å™¨ â€”â€”â€”â€” æ˜Žæ–‡æ•°æ®ä¼ è¾“ â€”â€”â€”â€” ç›®æ ‡æœåŠ¡å™¨
         â†‘ å¯èƒ½è¢«çªƒå¬ã€ç¯¡æ”¹ â†‘

ä½¿ç”¨SSLåŠ å¯†çš„å…‹éš†ï¼š
æºæœåŠ¡å™¨ â€”â€”ðŸ”’åŠ å¯†éš§é“ðŸ”’â€”â€” ç›®æ ‡æœåŠ¡å™¨
         â†‘ æ•°æ®å®‰å…¨ä¼ è¾“ â†‘
```

**ä¸ºä»€ä¹ˆè¦åŠ å¯†å…‹éš†æ•°æ®ï¼Ÿ**
- **é˜²çªƒå¬**ï¼šé˜²æ­¢æ•æ„Ÿæ•°æ®åœ¨ç½‘ç»œä¼ è¾“æ—¶è¢«ç¬¬ä¸‰æ–¹æˆªèŽ·
- **é˜²ç¯¡æ”¹**ï¼šç¡®ä¿ä¼ è¾“çš„æ•°æ®æ²¡æœ‰è¢«æ¶æ„ä¿®æ”¹
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤è¿žæŽ¥çš„ç¡®å®žæ˜¯ç›®æ ‡æœåŠ¡å™¨ï¼Œä¸æ˜¯å†’å……è€…
- **åˆè§„è¦æ±‚**ï¼šå¾ˆå¤šä¼ä¸šå’Œæ³•è§„è¦æ±‚æ•°æ®ä¼ è¾“å¿…é¡»åŠ å¯†

### 1.2 å…‹éš†SSLçš„å·¥ä½œåŽŸç†


**SSLåŠ å¯†çš„åŸºæœ¬æµç¨‹**
```
æ­¥éª¤1: æ¡æ‰‹åå•†
å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨: "æˆ‘è¦å»ºç«‹å®‰å…¨è¿žæŽ¥"
æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯: "è¿™æ˜¯æˆ‘çš„æ•°å­—è¯ä¹¦"

æ­¥éª¤2: è¯ä¹¦éªŒè¯
å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦å¯ä¿¡

æ­¥éª¤3: å¯†é’¥äº¤æ¢
åŒæ–¹åå•†å‡ºä¸€ä¸ªå…±åŒçš„åŠ å¯†å¯†é’¥

æ­¥éª¤4: åŠ å¯†é€šä¿¡
ä½¿ç”¨åå•†å¥½çš„å¯†é’¥åŠ å¯†æ‰€æœ‰æ•°æ®ä¼ è¾“
```

### 1.3 å…‹éš†SSLçš„åº”ç”¨åœºæ™¯


**å¿…é¡»ä½¿ç”¨SSLçš„åœºæ™¯**
- è·¨å…¬ç½‘çš„è¿œç¨‹å…‹éš†
- ç”Ÿäº§çŽ¯å¢ƒä¹‹é—´çš„æ•°æ®åŒæ­¥
- åŒ…å«æ•æ„Ÿæ•°æ®çš„æ•°æ®åº“å…‹éš†
- æœ‰å®‰å…¨åˆè§„è¦æ±‚çš„çŽ¯å¢ƒ

**å¯é€‰ä½¿ç”¨SSLçš„åœºæ™¯**
- å†…ç½‘çŽ¯å¢ƒçš„å…‹éš†ï¼ˆä½†å»ºè®®ä½¿ç”¨ï¼‰
- å¼€å‘æµ‹è¯•çŽ¯å¢ƒï¼ˆæ ¹æ®å®‰å…¨ç­–ç•¥å†³å®šï¼‰

---

## 2. ðŸ“œ SSLè¯ä¹¦é…ç½®åŸºç¡€


### 2.1 SSLè¯ä¹¦çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯SSLè¯ä¹¦ï¼Ÿ**
SSLè¯ä¹¦å°±åƒèº«ä»½è¯ä¸€æ ·ï¼Œç”¨æ¥è¯æ˜ŽæœåŠ¡å™¨çš„èº«ä»½ã€‚å®ƒåŒ…å«ï¼š
- **å…¬é’¥**ï¼šç”¨äºŽåŠ å¯†æ•°æ®
- **æœåŠ¡å™¨ä¿¡æ¯**ï¼šæœåŠ¡å™¨çš„åŸŸåæˆ–IP
- **æ•°å­—ç­¾å**ï¼šè¯ä¹¦é¢å‘æœºæž„çš„ç­¾åï¼Œè¯æ˜Žè¯ä¹¦çš„çœŸå®žæ€§

### 2.2 è¯ä¹¦ç±»åž‹ä¸Žé€‰æ‹©


**CAè¯ä¹¦ï¼ˆCertificate Authorityï¼‰**
```bash
# CAè¯ä¹¦æ˜¯è¯ä¹¦é“¾çš„æ ¹ï¼Œç”¨æ¥éªŒè¯å…¶ä»–è¯ä¹¦
# å°±åƒæ”¿åºœæœºæž„é¢å‘èº«ä»½è¯ä¸€æ ·ï¼ŒCAæœºæž„é¢å‘æ•°å­—è¯ä¹¦

ca-cert.pem      # CAæ ¹è¯ä¹¦
ca-key.pem       # CAç§é’¥ï¼ˆéœ€è¦ä¸¥æ ¼ä¿æŠ¤ï¼‰
```

**æœåŠ¡å™¨è¯ä¹¦**
```bash
# æœåŠ¡å™¨è¯ä¹¦è¯æ˜ŽæœåŠ¡å™¨èº«ä»½
server-cert.pem  # æœåŠ¡å™¨å…¬é’¥è¯ä¹¦
server-key.pem   # æœåŠ¡å™¨ç§é’¥
```

**å®¢æˆ·ç«¯è¯ä¹¦ï¼ˆå¯é€‰ï¼‰**
```bash
# ç”¨äºŽåŒå‘è®¤è¯ï¼Œè¯æ˜Žå®¢æˆ·ç«¯èº«ä»½
client-cert.pem  # å®¢æˆ·ç«¯è¯ä¹¦
client-key.pem   # å®¢æˆ·ç«¯ç§é’¥
```

### 2.3 è¯ä¹¦ç”Ÿæˆä¸Žé…ç½®


**ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰**
```bash
# 1. ç”ŸæˆCAç§é’¥
openssl genrsa -out ca-key.pem 2048

# 2. ç”ŸæˆCAè¯ä¹¦
openssl req -new -x509 -key ca-key.pem -out ca-cert.pem -days 365

# 3. ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server-key.pem 2048

# 4. ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦ç­¾åè¯·æ±‚
openssl req -new -key server-key.pem -out server-req.pem

# 5. ä½¿ç”¨CAç­¾åç”ŸæˆæœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -in server-req.pem -CA ca-cert.pem -CAkey ca-key.pem \
  -CAcreateserial -out server-cert.pem -days 365
```

**è¯ä¹¦æ–‡ä»¶æƒé™è®¾ç½®**
```bash
# è¯ä¹¦æ–‡ä»¶åº”è¯¥åªæœ‰MySQLç”¨æˆ·å¯è¯»
chmod 644 *.pem          # è¯ä¹¦æ–‡ä»¶
chmod 600 *-key.pem     # ç§é’¥æ–‡ä»¶ï¼Œæ›´ä¸¥æ ¼çš„æƒé™
chown mysql:mysql *.pem # è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰è€…
```

---

## 3. âš™ï¸ å…‹éš†SSLå‚æ•°è¯¦è§£


### 3.1 æ ¸å¿ƒSSLå‚æ•°


**`clone_ssl_ca`å‚æ•°**
```sql
-- è®¾ç½®CAè¯ä¹¦è·¯å¾„
SET GLOBAL clone_ssl_ca = '/path/to/ca-cert.pem';

-- æŸ¥çœ‹å½“å‰è®¾ç½®
SHOW VARIABLES LIKE 'clone_ssl_ca';
```

**ä½œç”¨è¯´æ˜Ž**
- æŒ‡å®šç”¨äºŽéªŒè¯å¯¹ç«¯è¯ä¹¦çš„CAè¯ä¹¦æ–‡ä»¶
- è¿™æ˜¯SSLè¿žæŽ¥çš„ä¿¡ä»»æ ¹ï¼Œéžå¸¸é‡è¦
- å¦‚æžœä¸è®¾ç½®ï¼Œå°†æ— æ³•éªŒè¯å¯¹ç«¯è¯ä¹¦çš„çœŸå®žæ€§

**`clone_ssl_cert`å‚æ•°**
```sql
-- è®¾ç½®æœåŠ¡å™¨è¯ä¹¦è·¯å¾„
SET GLOBAL clone_ssl_cert = '/path/to/server-cert.pem';
```

**ä½œç”¨è¯´æ˜Ž**
- æŒ‡å®šæœ¬æœåŠ¡å™¨çš„SSLè¯ä¹¦æ–‡ä»¶
- ç”¨äºŽå‘å¯¹ç«¯è¯æ˜Žè‡ªå·±çš„èº«ä»½
- å¿…é¡»ä¸Žå¯¹åº”çš„ç§é’¥æ–‡ä»¶é…å¯¹ä½¿ç”¨

**`clone_ssl_key`å‚æ•°**
```sql
-- è®¾ç½®æœåŠ¡å™¨ç§é’¥è·¯å¾„
SET GLOBAL clone_ssl_key = '/path/to/server-key.pem';
```

**ä½œç”¨è¯´æ˜Ž**
- æŒ‡å®šä¸ŽæœåŠ¡å™¨è¯ä¹¦å¯¹åº”çš„ç§é’¥æ–‡ä»¶
- ç”¨äºŽè§£å¯†å’Œç­¾åæ“ä½œ
- å¿…é¡»ä¸¥æ ¼ä¿æŠ¤ï¼Œä¸èƒ½æ³„éœ²

### 3.2 é«˜çº§SSLå‚æ•°


**SSLæ¨¡å¼é…ç½®**
```sql
-- æŸ¥çœ‹SSLç›¸å…³çš„æ‰€æœ‰å‚æ•°
SHOW VARIABLES LIKE '%ssl%';

-- å¸¸ç”¨çš„SSLæ¨¡å¼
-- REQUIRED: å¼ºåˆ¶ä½¿ç”¨SSL
-- PREFERRED: ä¼˜å…ˆä½¿ç”¨SSLï¼Œä½†å…è®¸éžSSLè¿žæŽ¥
-- DISABLED: ç¦ç”¨SSL
```

**SSLç‰ˆæœ¬æŽ§åˆ¶**
```sql
-- æŸ¥çœ‹æ”¯æŒçš„SSLåè®®ç‰ˆæœ¬
SHOW VARIABLES LIKE 'tls_version';

-- é€šå¸¸æ”¯æŒ: TLSv1.2, TLSv1.3
-- å»ºè®®ç¦ç”¨è¾ƒè€çš„SSL/TLSç‰ˆæœ¬
```

### 3.3 å‚æ•°é…ç½®ç¤ºä¾‹


**å®Œæ•´çš„SSLé…ç½®**
```sql
-- è®¾ç½®å…‹éš†SSLè¯ä¹¦é…ç½®
SET GLOBAL clone_ssl_ca = '/etc/mysql/ssl/ca-cert.pem';
SET GLOBAL clone_ssl_cert = '/etc/mysql/ssl/server-cert.pem';
SET GLOBAL clone_ssl_key = '/etc/mysql/ssl/server-key.pem';

-- éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
SELECT $$clone_ssl_ca, $$clone_ssl_cert, $$clone_ssl_key;
```

**åœ¨é…ç½®æ–‡ä»¶ä¸­æŒä¹…åŒ–**
```ini
# /etc/mysql/mysql.conf.d/mysqld.cnf
[mysqld]
clone_ssl_ca = /etc/mysql/ssl/ca-cert.pem
clone_ssl_cert = /etc/mysql/ssl/server-cert.pem
clone_ssl_key = /etc/mysql/ssl/server-key.pem

# å…¶ä»–SSLç›¸å…³é…ç½®
ssl-ca = /etc/mysql/ssl/ca-cert.pem
ssl-cert = /etc/mysql/ssl/server-cert.pem
ssl-key = /etc/mysql/ssl/server-key.pem
```

---

## 4. ðŸ” SSLè¿žæŽ¥éªŒè¯æœºåˆ¶


### 4.1 è¯ä¹¦éªŒè¯æµç¨‹


**éªŒè¯æ­¥éª¤è¯¦è§£**
```
Step 1: è¯ä¹¦æ ¼å¼æ£€æŸ¥
â”œâ”€â”€ æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æ˜¯å¦å­˜åœ¨
â”œâ”€â”€ éªŒè¯è¯ä¹¦æ ¼å¼æ˜¯å¦æ­£ç¡®
â””â”€â”€ ç¡®è®¤è¯ä¹¦æ²¡æœ‰æŸå

Step 2: è¯ä¹¦æœ‰æ•ˆæ€§æ£€æŸ¥
â”œâ”€â”€ æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ
â”œâ”€â”€ éªŒè¯è¯ä¹¦ç­¾åæ˜¯å¦æ­£ç¡®
â””â”€â”€ ç¡®è®¤è¯ä¹¦é“¾æ˜¯å¦å®Œæ•´

Step 3: èº«ä»½éªŒè¯
â”œâ”€â”€ éªŒè¯è¯ä¹¦çš„CN(Common Name)æ˜¯å¦åŒ¹é…
â”œâ”€â”€ æ£€æŸ¥SAN(Subject Alternative Name)
â””â”€â”€ ç¡®è®¤è¯ä¹¦ç”¨é€”æ˜¯å¦æ­£ç¡®

Step 4: ä¿¡ä»»éªŒè¯
â”œâ”€â”€ æ£€æŸ¥CAè¯ä¹¦æ˜¯å¦å¯ä¿¡
â”œâ”€â”€ éªŒè¯æ•´ä¸ªè¯ä¹¦é“¾
â””â”€â”€ ç¡®è®¤æ²¡æœ‰è¢«åŠé”€
```

### 4.2 è¯ä¹¦æœ‰æ•ˆæ€§æ£€æŸ¥


**æ‰‹åŠ¨éªŒè¯è¯ä¹¦**
```bash
# æŸ¥çœ‹è¯ä¹¦è¯¦ç»†ä¿¡æ¯
openssl x509 -in server-cert.pem -text -noout

# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in server-cert.pem -noout -dates

# éªŒè¯è¯ä¹¦ä¸Žç§é’¥æ˜¯å¦åŒ¹é…
openssl x509 -noout -modulus -in server-cert.pem | openssl md5
openssl rsa -noout -modulus -in server-key.pem | openssl md5
# ä¸¤ä¸ªMD5å€¼åº”è¯¥ç›¸åŒ
```

**åœ¨MySQLä¸­éªŒè¯SSLçŠ¶æ€**
```sql
-- æŸ¥çœ‹å½“å‰è¿žæŽ¥çš„SSLçŠ¶æ€
SHOW STATUS LIKE 'Ssl%';

-- é‡è¦çš„çŠ¶æ€å˜é‡
-- Ssl_cipher: ä½¿ç”¨çš„åŠ å¯†ç®—æ³•
-- Ssl_version: SSL/TLSç‰ˆæœ¬
-- Ssl_verify_mode: éªŒè¯æ¨¡å¼
-- Ssl_verify_depth: è¯ä¹¦é“¾éªŒè¯æ·±åº¦
```

### 4.3 è¿žæŽ¥å»ºç«‹è¿‡ç¨‹


**SSLæ¡æ‰‹è¿‡ç¨‹**
```
å®¢æˆ·ç«¯                           æœåŠ¡å™¨
  |                               |
  |----ClientHello--------------->|
  |                               |
  |<---ServerHello, Certificate---|
  |                               |
  |----CertificateVerify--------->|
  |                               |
  |----ClientKeyExchange-------->|
  |                               |
  |----ChangeCipherSpec--------->|
  |                               |
  |<---ChangeCipherSpec----------|
  |                               |
  |====åŠ å¯†é€šä¿¡å¼€å§‹================|
```

---

## 5. ðŸ› ï¸ å®‰å…¨ä¼ è¾“é…ç½®å®žæˆ˜


### 5.1 æºæœåŠ¡å™¨SSLé…ç½®


**é…ç½®æºæœåŠ¡å™¨**
```sql
-- 1. å®‰è£…å¹¶å¯ç”¨å…‹éš†æ’ä»¶
INSTALL PLUGIN clone SONAME 'mysql_clone.so';

-- 2. é…ç½®SSLè¯ä¹¦
SET GLOBAL clone_ssl_ca = '/etc/mysql/ssl/ca-cert.pem';
SET GLOBAL clone_ssl_cert = '/etc/mysql/ssl/server-cert.pem';
SET GLOBAL clone_ssl_key = '/etc/mysql/ssl/server-key.pem';

-- 3. åˆ›å»ºå…‹éš†ç”¨æˆ·å¹¶æŽˆæƒ
CREATE USER 'clone_user'@'%' IDENTIFIED BY 'secure_password';
GRANT BACKUP_ADMIN ON *.* TO 'clone_user'@'%';

-- 4. éªŒè¯SSLé…ç½®
SELECT $$clone_ssl_ca, $$clone_ssl_cert, $$clone_ssl_key;
```

### 5.2 ç›®æ ‡æœåŠ¡å™¨SSLé…ç½®


**é…ç½®ç›®æ ‡æœåŠ¡å™¨**
```sql
-- 1. åŒæ ·é…ç½®SSLè¯ä¹¦
SET GLOBAL clone_ssl_ca = '/etc/mysql/ssl/ca-cert.pem';
SET GLOBAL clone_ssl_cert = '/etc/mysql/ssl/server-cert.pem';
SET GLOBAL clone_ssl_key = '/etc/mysql/ssl/server-key.pem';

-- 2. å®‰è£…å…‹éš†æ’ä»¶
INSTALL PLUGIN clone SONAME 'mysql_clone.so';

-- 3. è®¾ç½®å…‹éš†æœ‰æ•ˆæèµ è€…ï¼ˆå…è®¸ä»Žå“ªäº›æœåŠ¡å™¨å…‹éš†ï¼‰
SET GLOBAL clone_valid_donor_list = '192.168.1.100:3306';
```

### 5.3 æ‰§è¡ŒSSLå…‹éš†æ“ä½œ


**å‘èµ·åŠ å¯†å…‹éš†**
```sql
-- åœ¨ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œå…‹éš†å‘½ä»¤
CLONE INSTANCE FROM 'clone_user'@'192.168.1.100':3306 
IDENTIFIED BY 'secure_password'
REQUIRE SSL;  -- å¼ºåˆ¶ä½¿ç”¨SSLè¿žæŽ¥
```

**æ£€æŸ¥å…‹éš†è¿›åº¦å’ŒSSLçŠ¶æ€**
```sql
-- æŸ¥çœ‹å…‹éš†è¿›åº¦
SELECT STAGE, STATE, END_TIME 
FROM performance_schema.clone_progress;

-- æŸ¥çœ‹å…‹éš†è¿žæŽ¥çš„SSLçŠ¶æ€
SELECT * FROM performance_schema.clone_status;
```

### 5.4 éªŒè¯SSLè¿žæŽ¥


**éªŒè¯æ­¥éª¤**
```sql
-- 1. æ£€æŸ¥æ€§èƒ½æ¨¡å¼ä¸­çš„SSLä¿¡æ¯
SELECT EVENT_NAME, OBJECT_NAME, OBJECT_INSTANCE_BEGIN 
FROM performance_schema.events_waits_current 
WHERE EVENT_NAME LIKE '%ssl%';

-- 2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
-- æ£€æŸ¥MySQLé”™è¯¯æ—¥å¿—æ˜¯å¦æœ‰SSLç›¸å…³é”™è¯¯

-- 3. ä½¿ç”¨MySQLå®¢æˆ·ç«¯æµ‹è¯•SSLè¿žæŽ¥
```

```bash
# ä»Žå‘½ä»¤è¡Œæµ‹è¯•SSLè¿žæŽ¥
mysql -h 192.168.1.100 -u clone_user -p \
  --ssl-ca=/etc/mysql/ssl/ca-cert.pem \
  --ssl-cert=/etc/mysql/ssl/client-cert.pem \
  --ssl-key=/etc/mysql/ssl/client-key.pem \
  --ssl-mode=REQUIRED
```

---

## 6. ðŸ”§ SSLæ•…éšœæŽ’æŸ¥æŒ‡å—


### 6.1 å¸¸è§SSLé”™è¯¯


**è¯ä¹¦è·¯å¾„é”™è¯¯**
```
é”™è¯¯ä¿¡æ¯: "SSL certificate path does not exist"
```
**è§£å†³æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /etc/mysql/ssl/

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
chmod 644 /etc/mysql/ssl/*.pem
chmod 600 /etc/mysql/ssl/*-key.pem

# 3. æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…
chown mysql:mysql /etc/mysql/ssl/*.pem
```

**è¯ä¹¦è¿‡æœŸé”™è¯¯**
```
é”™è¯¯ä¿¡æ¯: "SSL certificate has expired"
```
**è§£å†³æ­¥éª¤ï¼š**
```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in server-cert.pem -noout -dates

# å¦‚æžœè¿‡æœŸï¼Œéœ€è¦é‡æ–°ç”Ÿæˆè¯ä¹¦
openssl req -new -x509 -key server-key.pem -out server-cert.pem -days 365
```

### 6.2 è¯ä¹¦åŒ¹é…é—®é¢˜


**è¯ä¹¦ä¸Žç§é’¥ä¸åŒ¹é…**
```bash
# éªŒè¯è¯ä¹¦å’Œç§é’¥æ˜¯å¦åŒ¹é…
cert_hash=$(openssl x509 -noout -modulus -in server-cert.pem | openssl md5)
key_hash=$(openssl rsa -noout -modulus -in server-key.pem | openssl md5)

if [ "$cert_hash" = "$key_hash" ]; then
    echo "è¯ä¹¦å’Œç§é’¥åŒ¹é…"
else
    echo "è¯ä¹¦å’Œç§é’¥ä¸åŒ¹é…"
fi
```

**ä¸»æœºåéªŒè¯å¤±è´¥**
```sql
-- æ£€æŸ¥è¯ä¹¦ä¸­çš„ä¸»æœºåä¿¡æ¯
SELECT SSL_GET_SERVER_CERTIFICATE();

-- æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
openssl x509 -in server-cert.pem -noout -subject -ext subjectAltName
```

### 6.3 SSLè¿žæŽ¥è°ƒè¯•


**å¯ç”¨SSLè°ƒè¯•**
```sql
-- è®¾ç½®SSLè°ƒè¯•çº§åˆ«
SET GLOBAL log_error_verbosity = 3;

-- æ£€æŸ¥SSLç›¸å…³çš„ç³»ç»Ÿå˜é‡
SHOW VARIABLES LIKE '%ssl%';
SHOW STATUS LIKE '%ssl%';
```

**æŠ“åŒ…åˆ†æžSSLæ¡æ‰‹**
```bash
# ä½¿ç”¨tcpdumpæŠ“å–SSLæ¡æ‰‹åŒ…
tcpdump -i eth0 -w ssl_handshake.pcap port 3306

# ä½¿ç”¨Wiresharkåˆ†æžSSLæ¡æ‰‹è¿‡ç¨‹
# æŸ¥çœ‹Certificateã€Client Key Exchangeç­‰æ¶ˆæ¯
```

### 6.4 æ—¥å¿—åˆ†æž


**MySQLé”™è¯¯æ—¥å¿—åˆ†æž**
```bash
# æŸ¥çœ‹SSLç›¸å…³é”™è¯¯
tail -f /var/log/mysql/error.log | grep -i ssl

# å¸¸è§é”™è¯¯æ¨¡å¼
grep "SSL certificate" /var/log/mysql/error.log
grep "SSL connection" /var/log/mysql/error.log
grep "SSL handshake" /var/log/mysql/error.log
```

**å…‹éš†æ“ä½œæ—¥å¿—**
```sql
-- æŸ¥çœ‹å…‹éš†æ“ä½œçš„è¯¦ç»†æ—¥å¿—
SELECT * FROM performance_schema.clone_status;
SELECT * FROM performance_schema.clone_progress;

-- æŸ¥çœ‹æ˜¯å¦æœ‰SSLç›¸å…³é”™è¯¯
SELECT * FROM performance_schema.error_log 
WHERE ERROR_CODE LIKE '%SSL%' 
ORDER BY LOGGED DESC LIMIT 10;
```

---

## 7. ðŸ›¡ï¸ å®‰å…¨æœ€ä½³å®žè·µ


### 7.1 è¯ä¹¦ç®¡ç†æœ€ä½³å®žè·µ


**è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†**
```
è¯ä¹¦è§„åˆ’é˜¶æ®µ:
â”œâ”€â”€ é€‰æ‹©åˆé€‚çš„è¯ä¹¦æœ‰æ•ˆæœŸï¼ˆé€šå¸¸1-2å¹´ï¼‰
â”œâ”€â”€ è§„åˆ’è¯ä¹¦æ›´æ–°æµç¨‹
â””â”€â”€ å»ºç«‹è¯ä¹¦åº“å­˜ç®¡ç†

è¯ä¹¦éƒ¨ç½²é˜¶æ®µ:
â”œâ”€â”€ ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ï¼ˆRSA 2048ä½ä»¥ä¸Šï¼‰
â”œâ”€â”€ è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
â””â”€â”€ éªŒè¯è¯ä¹¦é…ç½®

è¯ä¹¦ç»´æŠ¤é˜¶æ®µ:
â”œâ”€â”€ å®šæœŸæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
â”œâ”€â”€ åŠæ—¶æ›´æ–°å³å°†è¿‡æœŸçš„è¯ä¹¦
â””â”€â”€ ç›‘æŽ§è¯ä¹¦çŠ¶æ€
```

**è¯ä¹¦å®‰å…¨å­˜å‚¨**
```bash
# åˆ›å»ºä¸“é—¨çš„SSLç›®å½•
mkdir -p /etc/mysql/ssl
chmod 750 /etc/mysql/ssl

# è®¾ç½®ä¸¥æ ¼çš„æ–‡ä»¶æƒé™
chmod 644 /etc/mysql/ssl/ca-cert.pem      # CAè¯ä¹¦å¯è¯»
chmod 644 /etc/mysql/ssl/server-cert.pem  # æœåŠ¡å™¨è¯ä¹¦å¯è¯»
chmod 600 /etc/mysql/ssl/server-key.pem   # ç§é’¥ä¸¥æ ¼ä¿æŠ¤

# è®¾ç½®æ­£ç¡®çš„æ‰€æœ‰è€…
chown -R mysql:mysql /etc/mysql/ssl/
```

### 7.2 ç½‘ç»œå®‰å…¨é…ç½®


**é˜²ç«å¢™é…ç½®**
```bash
# åªå…è®¸ç‰¹å®šIPè®¿é—®MySQLç«¯å£
iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3306 -j ACCEPT
iptables -A INPUT -p tcp --dport 3306 -j DROP

# æˆ–ä½¿ç”¨firewalld
firewall-cmd --permanent --add-rich-rule='rule family="ipv4" \
  source address="192.168.1.0/24" port protocol="tcp" port="3306" accept'
```

**ç½‘ç»œéš”ç¦»**
```
ç”Ÿäº§çŽ¯å¢ƒç½‘ç»œéš”ç¦»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æºæ•°æ®åº“      â”‚    â”‚   ç›®æ ‡æ•°æ®åº“    â”‚
â”‚ (å†…ç½‘IP only)   â”‚    â”‚ (å†…ç½‘IP only)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€VPNéš§é“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               æˆ–ä¸“çº¿è¿žæŽ¥
```

### 7.3 è®¤è¯ä¸ŽæŽˆæƒ


**ç”¨æˆ·æƒé™æœ€å°åŒ–**
```sql
-- åˆ›å»ºä¸“ç”¨çš„å…‹éš†ç”¨æˆ·
CREATE USER 'clone_user'@'specific_ip' IDENTIFIED BY 'complex_password';

-- åªæŽˆäºˆå¿…è¦çš„æƒé™
GRANT BACKUP_ADMIN ON *.* TO 'clone_user'@'specific_ip';

-- ä¸è¦æŽˆäºˆä¸å¿…è¦çš„æƒé™ï¼Œå¦‚ï¼š
-- GRANT ALL PRIVILEGES - è¿‡äºŽå®½æ³›
-- GRANT SUPER - æƒé™è¿‡å¤§
```

**å¯†ç ç­–ç•¥åŠ å¼º**
```sql
-- å¯ç”¨å¯†ç éªŒè¯æ’ä»¶
INSTALL COMPONENT 'file://component_validate_password';

-- è®¾ç½®å¯†ç ç­–ç•¥
SET GLOBAL validate_password.policy = STRONG;
SET GLOBAL validate_password.length = 12;
SET GLOBAL validate_password.mixed_case_count = 1;
SET GLOBAL validate_password.number_count = 1;
SET GLOBAL validate_password.special_char_count = 1;
```

### 7.4 ç›‘æŽ§ä¸Žå®¡è®¡


**SSLè¿žæŽ¥ç›‘æŽ§**
```sql
-- åˆ›å»ºç›‘æŽ§è§†å›¾
CREATE VIEW ssl_connections AS
SELECT 
    PROCESSLIST_ID,
    PROCESSLIST_USER,
    PROCESSLIST_HOST,
    CONNECTION_TYPE,
    TLS_VERSION,
    SSL_CIPHER
FROM performance_schema.threads t
JOIN information_schema.processlist p ON t.PROCESSLIST_ID = p.ID
WHERE CONNECTION_TYPE = 'SSL/TLS';

-- å®šæœŸæ£€æŸ¥SSLè¿žæŽ¥çŠ¶æ€
SELECT * FROM ssl_connections;
```

**å®¡è®¡æ—¥å¿—é…ç½®**
```sql
-- å¯ç”¨å®¡è®¡æ—¥å¿—æ’ä»¶
INSTALL PLUGIN audit_log SONAME 'audit_log.so';

-- é…ç½®å®¡è®¡é€‰é¡¹
SET GLOBAL audit_log_policy = ALL;
SET GLOBAL audit_log_format = JSON;

-- è®°å½•å…‹éš†ç›¸å…³æ“ä½œ
SET GLOBAL audit_log_statement_policy = ALL;
```

### 7.5 å®šæœŸå®‰å…¨æ£€æŸ¥


**å®‰å…¨æ£€æŸ¥æ¸…å•**
```bash
#!/bin/bash
# SSLå®‰å…¨æ£€æŸ¥è„šæœ¬

echo "=== MySQL SSLå®‰å…¨æ£€æŸ¥ ==="

# 1. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
echo "1. æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ:"
openssl x509 -in /etc/mysql/ssl/server-cert.pem -noout -dates

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
echo "2. æ£€æŸ¥SSLæ–‡ä»¶æƒé™:"
ls -la /etc/mysql/ssl/

# 3. æ£€æŸ¥SSLé…ç½®
echo "3. æ£€æŸ¥MySQL SSLé…ç½®:"
mysql -e "SHOW VARIABLES LIKE '%ssl%';"

# 4. æ£€æŸ¥SSLè¿žæŽ¥çŠ¶æ€
echo "4. æ£€æŸ¥å½“å‰SSLè¿žæŽ¥:"
mysql -e "SHOW STATUS LIKE 'Ssl%';"

# 5. æ£€æŸ¥å…‹éš†SSLé…ç½®
echo "5. æ£€æŸ¥å…‹éš†SSLé…ç½®:"
mysql -e "SELECT $$clone_ssl_ca, $$clone_ssl_cert, $$clone_ssl_key;"
```

---

## 8. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ SSLåŠ å¯†æœ¬è´¨ï¼šä¸ºå…‹éš†æ•°æ®ä¼ è¾“æä¾›å®‰å…¨ä¿æŠ¤
ðŸ”¸ è¯ä¹¦ä½œç”¨ï¼šèº«ä»½éªŒè¯å’ŒåŠ å¯†é€šä¿¡çš„åŸºç¡€
ðŸ”¸ å…³é”®å‚æ•°ï¼šclone_ssl_caã€clone_ssl_certã€clone_ssl_key
ðŸ”¸ éªŒè¯æœºåˆ¶ï¼šè¯ä¹¦é“¾éªŒè¯ã€æœ‰æ•ˆæœŸæ£€æŸ¥ã€èº«ä»½ç¡®è®¤
ðŸ”¸ æ•…éšœæŽ’æŸ¥ï¼šè¯ä¹¦è·¯å¾„ã€æƒé™ã€åŒ¹é…æ€§ã€æœ‰æ•ˆæœŸ
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ SSLåŠ å¯†çš„å¿…è¦æ€§**
```
æ•°æ®å®‰å…¨ï¼š
- é˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®æ³„éœ²
- ç¡®ä¿æ•°æ®å®Œæ•´æ€§ä¸è¢«ç¯¡æ”¹
- éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½çœŸå®žæ€§

åˆè§„è¦æ±‚ï¼š
- æ»¡è¶³ä¼ä¸šå®‰å…¨ç­–ç•¥
- ç¬¦åˆè¡Œä¸šç›‘ç®¡è¦æ±‚
- ä¿æŠ¤å®¢æˆ·éšç§æ•°æ®
```

**ðŸ”¹ è¯ä¹¦é…ç½®çš„å…³é”®ç‚¹**
```
è¯ä¹¦ç®¡ç†ï¼š
- CAè¯ä¹¦æ˜¯ä¿¡ä»»æ ¹ï¼Œå¿…é¡»å¦¥å–„ä¿ç®¡
- æœåŠ¡å™¨è¯ä¹¦è¯æ˜Žèº«ä»½ï¼Œéœ€è¦ä¸Žç§é’¥é…å¯¹
- ç§é’¥æ–‡ä»¶æƒé™å¿…é¡»ä¸¥æ ¼æŽ§åˆ¶(600)

é…ç½®éªŒè¯ï¼š
- è¯ä¹¦è·¯å¾„å¿…é¡»æ­£ç¡®ä¸”å¯è®¿é—®
- è¯ä¹¦æœ‰æ•ˆæœŸéœ€è¦å®šæœŸæ£€æŸ¥
- è¯ä¹¦ä¸Žç§é’¥å¿…é¡»åŒ¹é…
```

**ðŸ”¹ æ•…éšœæŽ’æŸ¥çš„æ€è·¯**
```
é—®é¢˜å®šä½ï¼š
- å…ˆæ£€æŸ¥åŸºç¡€é…ç½®ï¼ˆè·¯å¾„ã€æƒé™ã€æ‰€æœ‰è€…ï¼‰
- å†éªŒè¯è¯ä¹¦æœ‰æ•ˆæ€§ï¼ˆæ ¼å¼ã€æœ‰æ•ˆæœŸã€åŒ¹é…æ€§ï¼‰
- æœ€åŽåˆ†æžè¿žæŽ¥è¿‡ç¨‹ï¼ˆæ¡æ‰‹ã€éªŒè¯ã€åŠ å¯†ï¼‰

æ—¥å¿—åˆ†æžï¼š
- MySQLé”™è¯¯æ—¥å¿—çœ‹åŸºç¡€é”™è¯¯
- æ€§èƒ½æ¨¡å¼è¡¨çœ‹è¿žæŽ¥çŠ¶æ€
- ç½‘ç»œæŠ“åŒ…çœ‹æ¡æ‰‹è¿‡ç¨‹
```

### 8.3 å®žé™…åº”ç”¨ä»·å€¼


**ç”Ÿäº§çŽ¯å¢ƒåº”ç”¨**
- **è·¨ç½‘ç»œå…‹éš†**ï¼šåœ¨ä¸åŒæ•°æ®ä¸­å¿ƒé—´å®‰å…¨ä¼ è¾“æ•°æ®
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³é‡‘èžã€åŒ»ç–—ç­‰è¡Œä¸šçš„æ•°æ®ä¿æŠ¤è¦æ±‚
- **å®‰å…¨åŠ å›º**ï¼šæå‡æ•´ä½“æ•°æ®åº“å®‰å…¨é˜²æŠ¤æ°´å¹³

**è¿ç»´å®žè·µ**
- **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šå°†SSLé…ç½®çº³å…¥è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
- **ç›‘æŽ§å‘Šè­¦**ï¼šå»ºç«‹è¯ä¹¦æœ‰æ•ˆæœŸç›‘æŽ§å’Œå‘Šè­¦æœºåˆ¶
- **åº”æ€¥å¤„ç†**ï¼šåˆ¶å®šSSLç›¸å…³æ•…éšœçš„åº”æ€¥å¤„ç†é¢„æ¡ˆ

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SSLä¸ºå…‹éš†æä¾›ä¸‰é‡ä¿æŠ¤ï¼šåŠ å¯†ã€å®Œæ•´æ€§ã€èº«ä»½éªŒè¯
- ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ç¼ºä¸€ä¸å¯ï¼šCAè¯ä¹¦ã€æœåŠ¡å™¨è¯ä¹¦ã€ç§é’¥
- è¯ä¹¦é…ç½®è¦ç‚¹ï¼šè·¯å¾„æ­£ç¡®ã€æƒé™åˆç†ã€æœ‰æ•ˆæœŸå……è¶³
- æ•…éšœæŽ’æŸ¥é¡ºåºï¼šåŸºç¡€é…ç½®â†’è¯ä¹¦éªŒè¯â†’è¿žæŽ¥åˆ†æž
- å®‰å…¨æœ€ä½³å®žè·µï¼šæœ€å°æƒé™ã€å®šæœŸæ£€æŸ¥ã€ç›‘æŽ§å‘Šè­¦