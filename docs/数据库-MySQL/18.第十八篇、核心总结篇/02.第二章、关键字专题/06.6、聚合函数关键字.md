---
title: 6、聚合函数关键字
---
## 📚 目录

1. [聚合函数基础概念](#1-聚合函数基础概念)
2. [基础计数聚合函数](#2-基础计数聚合函数)
3. [数值计算聚合函数](#3-数值计算聚合函数)
4. [统计分析聚合函数](#4-统计分析聚合函数)
5. [位运算聚合函数](#5-位运算聚合函数)
6. [JSON聚合函数](#6-json聚合函数)
7. [实际应用场景](#7-实际应用场景)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 聚合函数基础概念


### 1.1 什么是聚合函数


**🔸 通俗理解**
聚合函数就像是数据的"总结器"。想象你有一堆考试成绩，你想知道：
- 一共有多少人参加考试？(计数)
- 总分是多少？(求和) 
- 平均分是多少？(平均)
- 最高分和最低分是多少？(最值)

这些问题的答案都需要"聚合函数"来计算。

**🔸 技术定义**
聚合函数是对一组数据进行计算并返回单个值的函数。它把多行数据"聚合"成一个结果。

### 1.2 聚合函数的特点


```
多行输入 → 聚合函数处理 → 单行输出

示例数据表：
学号  姓名    分数
001   张三    85
002   李四    92
003   王五    78
004   赵六    88

使用COUNT()：4行数据 → 输出：4 (总人数)
使用AVG()：4行数据 → 输出：85.75 (平均分)
```

### 1.3 聚合函数的工作原理


**🔸 工作流程**
```
第1步：选取数据范围 (所有行或GROUP BY分组)
第2步：应用聚合函数进行计算
第3步：返回计算结果 (单个值)
```

**🔸 与普通函数的区别**

| 函数类型 | **输入** | **输出** | **举例** |
|---------|---------|---------|---------|
| 🔸 **普通函数** | `单个值` | `单个值` | `UPPER('hello') → 'HELLO'` |
| 🔸 **聚合函数** | `多行数据` | `单个值` | `COUNT(*) → 总行数` |

---

## 2. 📊 基础计数聚合函数


### 2.1 COUNT - 计数统计


**🔸 基本含义**
COUNT就是"数数"的功能，用来统计有多少条记录。就像你数班里有多少个同学一样简单。

**🔸 语法格式**
```sql
COUNT(*)           -- 统计所有行数(包括NULL)
COUNT(字段名)       -- 统计字段非NULL的行数  
COUNT(DISTINCT 字段名) -- 统计字段不重复的行数
```

**🔸 实用示例**

假设有学生表：
```sql
-- 示例数据
CREATE TABLE students (
    id INT,
    name VARCHAR(50),
    age INT,
    score DECIMAL(5,2)
);

INSERT INTO students VALUES 
(1, '张三', 20, 85.5),
(2, '李四', 21, 92.0),
(3, '王五', 20, NULL),
(4, '赵六', 22, 88.0);
```

```sql
-- 统计总学生数
SELECT COUNT(*) AS 总人数 FROM students;
-- 结果：4

-- 统计有分数的学生数
SELECT COUNT(score) AS 有分数人数 FROM students; 
-- 结果：3 (王五的NULL不计入)

-- 统计不同年龄的人数
SELECT COUNT(DISTINCT age) AS 年龄种类 FROM students;
-- 结果：3 (20岁、21岁、22岁)
```

**🔸 使用场景**
- 📈 **用户统计**：网站注册用户总数
- 📝 **订单统计**：今日订单数量  
- 👥 **分组统计**：各部门员工人数
- ✅ **数据验证**：检查数据导入是否完整

> 💡 **重要提醒**  
> COUNT(*)和COUNT(1)效果相同，都统计所有行；COUNT(字段名)会忽略NULL值

---

## 3. 🧮 数值计算聚合函数


### 3.1 SUM - 求和计算


**🔸 基本含义**
SUM就是"加法器"，把所有数字相加得到总和。比如计算班级总分、公司总销售额等。

**🔸 语法与示例**
```sql
-- 计算所有学生的总分
SELECT SUM(score) AS 班级总分 FROM students;
-- 结果：265.5 (85.5 + 92.0 + 88.0，NULL不参与计算)

-- 按年龄分组求和
SELECT age AS 年龄, SUM(score) AS 该年龄总分 
FROM students 
GROUP BY age;
```

**🔸 注意事项**
- ⚠️ NULL值会被忽略，不参与计算
- ⚠️ 如果所有值都是NULL，结果为NULL
- ⚠️ 只能用于数值类型字段

### 3.2 AVG - 平均值计算


**🔸 基本含义**
AVG计算平均值，相当于 总和÷个数。比如计算班级平均分、平均工资等。

**🔸 实用示例**
```sql
-- 计算班级平均分
SELECT AVG(score) AS 平均分 FROM students;
-- 结果：88.5 (265.5÷3，注意是3个非NULL值)

-- 各年龄段平均分
SELECT age, AVG(score) AS 平均分 
FROM students 
WHERE score IS NOT NULL
GROUP BY age;
```

> 🧠 **记忆技巧**  
> AVG = Average(平均)，就是把所有数加起来除以个数

### 3.3 MAX和MIN - 最值查找


**🔸 基本含义**
- MAX：找最大值，像找班里最高的同学
- MIN：找最小值，像找班里最矮的同学

**🔸 实用示例**
```sql
-- 找最高分和最低分
SELECT 
    MAX(score) AS 最高分,
    MIN(score) AS 最低分,
    MAX(score) - MIN(score) AS 分差
FROM students;
-- 结果：最高分92.0，最低分85.5，分差6.5

-- 找最年轻和最年长的学生
SELECT 
    MIN(age) AS 最小年龄,
    MAX(age) AS 最大年龄
FROM students;
```

**🔸 使用场景**
- 🏆 **排名分析**：最高销售额、最低成本
- 📊 **数据范围**：数据的上下边界
- 🎯 **异常检测**：找出极端值

---

## 4. 📈 统计分析聚合函数


### 4.1 GROUP_CONCAT - 字符串聚合


**🔸 基本含义**
GROUP_CONCAT把多行的字符串合并成一行，用指定符号分隔。就像把班里所有同学的名字用逗号连起来。

**🔸 语法格式**
```sql
GROUP_CONCAT(字段名 SEPARATOR '分隔符')
```

**🔸 实用示例**
```sql
-- 把所有学生姓名连成一串
SELECT GROUP_CONCAT(name) AS 全部学生 FROM students;
-- 结果：张三,李四,王五,赵六

-- 使用自定义分隔符
SELECT GROUP_CONCAT(name SEPARATOR ' | ') AS 学生列表 FROM students;
-- 结果：张三 | 李四 | 王五 | 赵六

-- 按年龄分组，显示每个年龄的学生
SELECT 
    age AS 年龄,
    GROUP_CONCAT(name) AS 该年龄学生
FROM students 
GROUP BY age;
```

**🔸 常用场景**
- 📝 **报表生成**：把相关数据合并显示
- 🏷️ **标签系统**：合并多个标签为一行
- 📋 **数据导出**：便于阅读的格式

### 4.2 标准差和方差函数


**🔸 基本概念**
这些函数用来衡量数据的"散布程度"：
- **标准差**：数据偏离平均值的程度
- **方差**：标准差的平方

**🔸 通俗理解**
想象班里同学的身高：
- 如果大家身高都差不多 → 标准差小 → 数据集中
- 如果身高差距很大 → 标准差大 → 数据分散

**🔸 函数对比**

| 函数名 | **含义** | **用途** |
|--------|---------|---------|
| `STD()`/`STDDEV()` | **标准差** | `衡量数据离散程度` |
| `VARIANCE()` | **方差** | `标准差的平方` |
| `VAR_POP()` | **总体方差** | `全部数据的方差` |
| `VAR_SAMP()` | **样本方差** | `样本数据的方差` |

**🔸 实用示例**
```sql
-- 分析分数的离散程度
SELECT 
    AVG(score) AS 平均分,
    STD(score) AS 标准差,
    VARIANCE(score) AS 方差
FROM students;
-- 帮助了解分数分布是否均匀
```

---

## 5. 🔢 位运算聚合函数


### 5.1 位运算基础概念


**🔸 什么是位运算**
位运算是直接对数字的二进制位进行操作。听起来复杂，但其实就是对0和1进行逻辑运算。

**🔸 二进制示例**
```
数字5的二进制：101
数字3的二进制：011
```

### 5.2 BIT_AND - 位与运算


**🔸 基本含义**
对所有数字进行"位与"运算，只有对应位都是1，结果才是1。

**🔸 运算规则**
```
1 AND 1 = 1
1 AND 0 = 0
0 AND 1 = 0  
0 AND 0 = 0
```

**🔸 实用示例**
```sql
-- 假设有权限表，数字代表权限位
CREATE TABLE permissions (
    user_id INT,
    permission INT  -- 用二进制位表示权限
);

INSERT INTO permissions VALUES 
(1, 7),  -- 二进制: 111 (读写执行权限都有)
(2, 5),  -- 二进制: 101 (读和执行权限)
(3, 6);  -- 二进制: 110 (写和执行权限)

-- 找出所有用户都拥有的权限
SELECT BIT_AND(permission) AS 共同权限 FROM permissions;
-- 结果: 4 (二进制100，表示都有执行权限)
```

### 5.3 BIT_OR和BIT_XOR


**🔸 BIT_OR - 位或运算**
只要有一个位是1，结果就是1
```sql
SELECT BIT_OR(permission) AS 所有权限 FROM permissions;
-- 结果显示所有可能的权限组合
```

**🔸 BIT_XOR - 位异或运算**  
两个位不同时结果为1，相同时结果为0
```sql
SELECT BIT_XOR(permission) AS 异或结果 FROM permissions;
-- 用于特殊的加密或校验场景
```

**🔸 实际应用场景**
- 🔐 **权限管理**：计算用户权限的交集、并集
- 🛡️ **状态标识**：多个状态位的逻辑运算
- 🔍 **数据校验**：简单的校验和计算

---

## 6. 📄 JSON聚合函数


### 6.1 JSON聚合概念


**🔸 什么是JSON聚合**
JSON聚合函数把多行数据组织成JSON格式。就像把散落的信息整理成一个结构化的文档。

**🔸 为什么需要JSON聚合**
传统的查询结果是表格形式，但现代应用往往需要JSON格式的数据来传输和处理。

### 6.2 JSON_ARRAYAGG - 数组聚合


**🔸 基本含义**
把多行数据合并成一个JSON数组，就像把多个苹果装进一个篮子里。

**🔸 实用示例**
```sql
-- 把所有学生姓名组成JSON数组
SELECT JSON_ARRAYAGG(name) AS 学生数组 FROM students;
-- 结果：["张三", "李四", "王五", "赵六"]

-- 把分数组成数组（自动过滤NULL）
SELECT JSON_ARRAYAGG(score) AS 分数数组 FROM students;
-- 结果：[85.5, 92.0, 88.0]

-- 按年龄分组
SELECT 
    age,
    JSON_ARRAYAGG(name) AS 该年龄学生
FROM students 
GROUP BY age;
```

### 6.3 JSON_OBJECTAGG - 对象聚合


**🔸 基本含义**
把键值对合并成JSON对象，就像制作一个通讯录，姓名是键，电话是值。

**🔸 实用示例**
```sql
-- 创建姓名->分数的映射对象
SELECT JSON_OBJECTAGG(name, score) AS 学生分数对照 FROM students;
-- 结果：{"张三": 85.5, "李四": 92.0, "王五": null, "赵六": 88.0}

-- 创建ID->姓名映射
SELECT JSON_OBJECTAGG(id, name) AS ID姓名对照 FROM students;
-- 结果：{"1": "张三", "2": "李四", "3": "王五", "4": "赵六"}
```

**🔸 JSON聚合的应用场景**
- 🌐 **API接口**：直接返回JSON格式给前端
- 📊 **报表系统**：生成结构化的数据报表
- 🔄 **数据同步**：在系统间传输结构化数据
- 📱 **移动应用**：为APP提供合适的数据格式

> 💡 **实用建议**  
> JSON聚合函数在MySQL 5.7+版本才支持，使用前请确认数据库版本

---

## 7. 🚀 实际应用场景


### 7.1 电商销售统计


**🔸 业务场景**
电商平台需要统计各种销售数据，这是聚合函数的典型应用场景。

```sql
-- 销售订单表示例
CREATE TABLE orders (
    order_id INT,
    product_name VARCHAR(100),
    quantity INT,
    price DECIMAL(10,2),
    order_date DATE,
    customer_id INT
);

-- 综合销售报表
SELECT 
    COUNT(*) AS 总订单数,
    SUM(quantity * price) AS 总销售额,
    AVG(quantity * price) AS 平均订单金额,
    MAX(quantity * price) AS 最大订单金额,
    MIN(quantity * price) AS 最小订单金额
FROM orders 
WHERE order_date >= '2024-01-01';
```

### 7.2 学生成绩分析系统


**🔸 教学场景应用**
```sql
-- 班级成绩统计
SELECT 
    '班级总体情况' AS 统计项目,
    COUNT(*) AS 总人数,
    COUNT(score) AS 有效成绩人数,
    AVG(score) AS 平均分,
    MAX(score) AS 最高分,
    MIN(score) AS 最低分,
    STDDEV(score) AS 成绩标准差
FROM students;

-- 各分数段人数统计
SELECT 
    CASE 
        WHEN score >= 90 THEN '优秀(90+)'
        WHEN score >= 80 THEN '良好(80-89)'  
        WHEN score >= 70 THEN '中等(70-79)'
        WHEN score >= 60 THEN '及格(60-69)'
        ELSE '不及格(<60)'
    END AS 成绩等级,
    COUNT(*) AS 人数,
    GROUP_CONCAT(name) AS 学生名单
FROM students 
WHERE score IS NOT NULL
GROUP BY 
    CASE 
        WHEN score >= 90 THEN '优秀(90+)'
        WHEN score >= 80 THEN '良好(80-89)'
        WHEN score >= 70 THEN '中等(70-79)' 
        WHEN score >= 60 THEN '及格(60-69)'
        ELSE '不及格(<60)'
    END;
```

### 7.3 用户行为分析


**🔸 网站分析场景**
```sql
-- 用户活跃度统计
SELECT 
    DATE(login_time) AS 日期,
    COUNT(DISTINCT user_id) AS 活跃用户数,
    COUNT(*) AS 总登录次数,
    AVG(session_duration) AS 平均会话时长,
    JSON_ARRAYAGG(user_id) AS 活跃用户列表
FROM user_sessions 
WHERE login_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY DATE(login_time)
ORDER BY 日期;
```

### 7.4 聚合函数组合使用技巧


**🔸 复合统计查询**
```sql
-- 多维度数据分析
SELECT 
    -- 基础统计
    COUNT(*) AS 记录总数,
    COUNT(DISTINCT customer_id) AS 客户数,
    
    -- 金额统计  
    SUM(amount) AS 总金额,
    AVG(amount) AS 平均金额,
    MAX(amount) AS 最大金额,
    MIN(amount) AS 最小金额,
    
    -- 离散程度分析
    STDDEV(amount) AS 金额标准差,
    VARIANCE(amount) AS 金额方差,
    
    -- 数据聚合
    GROUP_CONCAT(DISTINCT product_name) AS 涉及产品,
    JSON_ARRAYAGG(amount) AS 金额明细
FROM orders 
WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';
```

---

## 8. 📋 核心要点总结


### 8.1 聚合函数分类总结


**🔸 基础统计类**
- `COUNT()`: 计数统计，最常用的聚合函数
- `SUM()`: 数值求和，适用于金额、数量等
- `AVG()`: 平均值计算，反映数据中心趋势
- `MAX()`/`MIN()`: 最值查找，发现数据边界

**🔸 高级分析类**  
- `STD()`/`STDDEV()`: 标准差，衡量数据离散程度
- `VARIANCE()`: 方差，标准差的平方
- `VAR_POP()`/`VAR_SAMP()`: 总体/样本方差

**🔸 数据整合类**
- `GROUP_CONCAT()`: 字符串聚合，便于数据展示
- `JSON_ARRAYAGG()`: JSON数组聚合，适配现代应用
- `JSON_OBJECTAGG()`: JSON对象聚合，创建键值映射

**🔸 位运算类**
- `BIT_AND()`/`BIT_OR()`/`BIT_XOR()`: 位运算聚合，特殊场景使用

### 8.2 使用要点梳理


**🔹 数据处理规则**
```
✅ NULL值处理：大部分聚合函数自动忽略NULL值
✅ 分组使用：配合GROUP BY实现分组统计  
✅ 条件过滤：配合HAVING对聚合结果进行筛选
✅ 别名使用：为聚合结果起有意义的别名
```

**🔹 性能优化建议**
```
⚡ 索引优化：为经常聚合的字段建立索引
⚡ 数据筛选：先用WHERE过滤数据再聚合
⚡ 避免重复：合理使用DISTINCT避免不必要的去重
⚡ 分组优化：GROUP BY字段建立复合索引
```

### 8.3 常见应用场景


| 场景类型 | **常用函数** | **典型应用** | **注意事项** |
|---------|-------------|-------------|-------------|
| 🔸 **业务统计** | `COUNT, SUM, AVG` | `销售报表、用户统计` | `注意NULL值影响` |
| 🔸 **数据分析** | `STD, VARIANCE, MAX/MIN` | `质量分析、异常检测` | `理解统计含义` |
| 🔸 **报表生成** | `GROUP_CONCAT, JSON聚合` | `数据导出、API接口` | `考虑数据量大小` |
| 🔸 **权限管理** | `BIT_AND, BIT_OR` | `权限计算、状态管理` | `了解位运算逻辑` |

### 8.4 学习建议和实践要点


**🎯 学习路径建议**
```
第1阶段：掌握基础函数 COUNT, SUM, AVG, MAX, MIN
第2阶段：理解分组统计 GROUP BY + 聚合函数
第3阶段：学习高级函数 标准差、JSON聚合等
第4阶段：综合应用 解决实际业务问题
```

**📝 练习建议**
- 🔰 **入门练习**: 用学生表练习基础统计
- 🔸 **进阶练习**: 用订单表做销售分析
- ⭐ **高级练习**: 结合多表进行复合查询
- 🏆 **实战练习**: 完成完整的数据分析报告

**🧠 记忆口诀**
```
COUNT数个数，SUM来求和
AVG算平均，MAX MIN找边界
GROUP_CONCAT连字符串
JSON聚合很现代
统计分析用标准差
位运算较为特殊化
```

> 💡 **学习重点**  
> 聚合函数是SQL数据分析的核心工具，重点掌握基础函数的使用，理解NULL值处理规则，熟练配合GROUP BY进行分组统计

> 🚀 **实用价值**  
> 无论是业务报表、数据分析还是系统监控，聚合函数都是不可或缺的工具。掌握这些函数，就掌握了数据统计分析的核心技能