---
title: 9、日期函数关键字
---
## 📚 目录

1. [基础时间获取函数](#1-基础时间获取函数)
2. [时间戳转换函数](#2-时间戳转换函数)
3. [日期时间格式化函数](#3-日期时间格式化函数)
4. [日期时间运算函数](#4-日期时间运算函数)
5. [日期时间差值计算](#5-日期时间差值计算)
6. [日期时间部分提取](#6-日期时间部分提取)
7. [特殊日期计算函数](#7-特殊日期计算函数)
8. [时区转换函数](#8-时区转换函数)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🕒 基础时间获取函数


### 1.1 当前时间戳函数


#### NOW() - 当前完整时间戳

**概念含义**：获取当前的完整日期和时间，包含年月日时分秒信息。

```sql
-- 获取当前时间戳
SELECT NOW();
-- 结果: 2024-01-15 14:30:25
```

**核心特点**：
- ✅ **完整信息**：包含日期和时间的完整信息
- ✅ **常用基础**：最常用的时间获取函数
- ⚠️ **执行时确定**：在SQL执行时确定值，同一语句中多次调用返回相同值

#### CURRENT_TIMESTAMP - 标准当前时间戳

**概念含义**：与NOW()功能相同，是SQL标准的写法。

```sql
-- 两种写法效果相同
SELECT NOW(), CURRENT_TIMESTAMP;
-- 结果: 2024-01-15 14:30:25 | 2024-01-15 14:30:25
```

**使用场景**：
- 📝 记录数据创建时间
- 🔄 更新记录修改时间
- 📊 生成时间戳日志

### 1.2 当前日期函数


#### CURDATE() - 当前日期

**概念含义**：只获取当前日期，不包含时间部分，格式为YYYY-MM-DD。

```sql
-- 获取当前日期
SELECT CURDATE();
-- 结果: 2024-01-15
```

#### CURRENT_DATE - 标准当前日期

**概念含义**：与CURDATE()功能相同，是SQL标准的写法。

```sql
-- 两种写法效果相同
SELECT CURDATE(), CURRENT_DATE;
-- 结果: 2024-01-15 | 2024-01-15
```

**实际应用**：
```sql
-- 查询今天创建的订单
SELECT * FROM orders 
WHERE DATE(created_at) = CURDATE();

-- 统计今日销售额
SELECT SUM(amount) as today_sales 
FROM sales 
WHERE sale_date = CURDATE();
```

### 1.3 当前时间函数


#### CURTIME() - 当前时间

**概念含义**：只获取当前时间，不包含日期部分，格式为HH:MM:SS。

```sql
-- 获取当前时间
SELECT CURTIME();
-- 结果: 14:30:25
```

#### CURRENT_TIME - 标准当前时间

**概念含义**：与CURTIME()功能相同，是SQL标准的写法。

```sql
-- 两种写法效果相同
SELECT CURTIME(), CURRENT_TIME;
-- 结果: 14:30:25 | 14:30:25
```

**使用场景**：
```sql
-- 记录操作时间点
INSERT INTO user_actions (user_id, action, action_time)
VALUES (1001, 'login', CURTIME());

-- 查询工作时间内的记录
SELECT * FROM activities 
WHERE TIME(created_at) BETWEEN '09:00:00' AND '18:00:00';
```

### 1.4 系统时间函数


#### SYSDATE() - 系统时间

**概念含义**：获取系统当前时间，与NOW()的区别在于每次调用都重新获取时间。

```sql
-- 对比NOW()和SYSDATE()的区别
SELECT NOW(), SLEEP(2), NOW(), SYSDATE();
-- NOW()两次结果相同，SYSDATE()会更新
```

**重要区别**：
- `NOW()`：语句开始时确定，整个语句执行过程中保持不变
- `SYSDATE()`：每次调用都获取最新的系统时间

> ⚠️ **注意**：SYSDATE()可能影响主从复制的一致性，生产环境需谨慎使用。

### 1.5 世界协调时间函数


#### UTC_DATE - 世界协调时日期

**概念含义**：获取UTC（世界协调时）的当前日期，不受服务器时区影响。

```sql
-- 对比本地日期和UTC日期
SELECT CURDATE(), UTC_DATE();
-- 结果可能: 2024-01-15 | 2024-01-15 (时区相同时)
--         2024-01-16 | 2024-01-15 (跨日期时区时)
```

#### UTC_TIME - 世界协调时时间

**概念含义**：获取UTC的当前时间。

```sql
-- 对比本地时间和UTC时间
SELECT CURTIME(), UTC_TIME();
-- 结果可能: 22:30:25 | 14:30:25 (东8区示例)
```

#### UTC_TIMESTAMP - 世界协调时间戳

**概念含义**：获取UTC的完整时间戳。

```sql
-- 对比本地时间戳和UTC时间戳
SELECT NOW(), UTC_TIMESTAMP();
-- 结果可能: 2024-01-15 22:30:25 | 2024-01-15 14:30:25
```

**适用场景**：
- 🌍 **全球应用**：多时区应用的统一时间标准
- 📊 **数据同步**：跨时区数据库同步
- 🔄 **日志记录**：统一的时间基准

---

## 2. 🔢 时间戳转换函数


### 2.1 时间戳转换


#### UNIX_TIMESTAMP() - 获取Unix时间戳

**概念含义**：将日期时间转换为Unix时间戳（从1970-01-01 00:00:00 UTC开始的秒数）。

```sql
-- 获取当前Unix时间戳
SELECT UNIX_TIMESTAMP();
-- 结果: 1705336225

-- 将指定日期转换为时间戳
SELECT UNIX_TIMESTAMP('2024-01-15 14:30:25');
-- 结果: 1705336225

-- 将日期字段转换为时间戳
SELECT id, UNIX_TIMESTAMP(created_at) as timestamp
FROM users;
```

**核心用途**：
- 📊 **时间计算**：便于进行时间间隔计算
- 🔄 **系统交互**：与编程语言时间戳对接
- 📈 **性能优化**：数字比较比日期比较更快

#### FROM_UNIXTIME() - 时间戳转日期

**概念含义**：将Unix时间戳转换回可读的日期时间格式。

```sql
-- 将时间戳转换为日期时间
SELECT FROM_UNIXTIME(1705336225);
-- 结果: 2024-01-15 14:30:25

-- 转换时指定格式
SELECT FROM_UNIXTIME(1705336225, '%Y年%m月%d日 %H:%i:%s');
-- 结果: 2024年01月15日 14:30:25

-- 实际应用：处理存储为时间戳的字段
SELECT user_id, FROM_UNIXTIME(login_timestamp) as login_time
FROM user_sessions;
```

**实战示例**：
```sql
-- 时间戳的实际应用场景
CREATE TABLE events (
    id INT PRIMARY KEY,
    event_name VARCHAR(100),
    event_timestamp INT  -- 存储为时间戳
);

-- 插入数据时使用当前时间戳
INSERT INTO events VALUES 
(1, '用户登录', UNIX_TIMESTAMP()),
(2, '下单支付', UNIX_TIMESTAMP('2024-01-15 10:30:00'));

-- 查询时转换为可读格式
SELECT 
    event_name,
    FROM_UNIXTIME(event_timestamp) as event_time,
    FROM_UNIXTIME(event_timestamp, '%Y-%m-%d') as event_date
FROM events;
```

**时间戳转换流程图**：
```
日期时间格式                Unix时间戳              应用程序
2024-01-15 14:30:25  ←─→   1705336225      ←─→    JavaScript Date
       ↑                        ↑                      ↑
   FROM_UNIXTIME()        数值计算更快              程序处理
       ↑                        ↑                      ↑
   UNIX_TIMESTAMP()         数据库存储              接口传输
```

---

## 3. 🎨 日期时间格式化函数


### 3.1 日期格式化


#### DATE_FORMAT() - 格式化日期

**概念含义**：将日期时间按指定格式转换为字符串，是最灵活的格式化函数。

**常用格式符**：
| 格式符 | **含义** | **示例** |
|-------|---------|---------|
| `%Y` | 4位年份 | 2024 |
| `%y` | 2位年份 | 24 |
| `%m` | 月份(01-12) | 01 |
| `%c` | 月份(1-12) | 1 |
| `%M` | 月份名 | January |
| `%b` | 月份简称 | Jan |
| `%d` | 日期(01-31) | 15 |
| `%e` | 日期(1-31) | 15 |
| `%H` | 小时(00-23) | 14 |
| `%h` | 小时(01-12) | 02 |
| `%i` | 分钟(00-59) | 30 |
| `%s` | 秒(00-59) | 25 |
| `%W` | 星期名 | Monday |
| `%w` | 星期数(0-6) | 1 |

```sql
-- 基础格式化示例
SELECT DATE_FORMAT(NOW(), '%Y-%m-%d') as date_only;
-- 结果: 2024-01-15

SELECT DATE_FORMAT(NOW(), '%Y年%m月%d日') as chinese_date;
-- 结果: 2024年01月15日

SELECT DATE_FORMAT(NOW(), '%W, %M %d, %Y') as english_date;
-- 结果: Monday, January 15, 2024

-- 实际应用场景
SELECT 
    order_id,
    DATE_FORMAT(order_time, '%Y-%m') as order_month,
    DATE_FORMAT(order_time, '%Y-%m-%d %H:%i') as order_datetime
FROM orders
WHERE order_time >= '2024-01-01';
```

**业务应用示例**：
```sql
-- 生成报表友好格式
SELECT 
    DATE_FORMAT(created_at, '%Y年%m月') as month_label,
    COUNT(*) as user_count
FROM users
GROUP BY DATE_FORMAT(created_at, '%Y-%m')
ORDER BY created_at DESC;

-- 生成文件名格式
SELECT 
    CONCAT('backup_', DATE_FORMAT(NOW(), '%Y%m%d_%H%i%s'), '.sql') as backup_filename;
-- 结果: backup_20240115_143025.sql
```

#### TIME_FORMAT() - 格式化时间

**概念含义**：专门用于格式化时间部分，只能处理时分秒。

```sql
-- 时间格式化
SELECT TIME_FORMAT('14:30:25', '%H:%i') as simple_time;
-- 结果: 14:30

SELECT TIME_FORMAT('14:30:25', '%h:%i %p') as ampm_time;
-- 结果: 02:30 PM

-- 从完整时间戳中提取并格式化时间
SELECT 
    TIME_FORMAT(NOW(), '%H:%i') as current_time,
    TIME_FORMAT(NOW(), '%h:%i %p') as ampm_time;
```

### 3.2 字符串转日期


#### STR_TO_DATE() - 字符串转日期

**概念含义**：将字符串按指定格式解析为日期时间，与DATE_FORMAT()功能相反。

```sql
-- 基础字符串转日期
SELECT STR_TO_DATE('2024-01-15', '%Y-%m-%d') as parsed_date;
-- 结果: 2024-01-15

SELECT STR_TO_DATE('15/01/2024 14:30', '%d/%m/%Y %H:%i') as parsed_datetime;
-- 结果: 2024-01-15 14:30:00

-- 处理各种格式的日期字符串
SELECT STR_TO_DATE('2024年1月15日', '%Y年%m月%d日') as chinese_date;
-- 结果: 2024-01-15
```

**实际应用场景**：
```sql
-- 处理导入数据中的日期字符串
UPDATE temp_orders 
SET order_date = STR_TO_DATE(date_string, '%m/%d/%Y')
WHERE date_string IS NOT NULL;

-- 查询时解析特殊格式日期
SELECT * FROM logs 
WHERE STR_TO_DATE(log_date_str, '%Y%m%d') 
    BETWEEN '2024-01-01' AND '2024-01-31';
```

### 3.3 获取格式


#### GET_FORMAT() - 获取标准格式

**概念含义**：获取不同地区和用途的标准日期时间格式。

**格式类型**：
- `DATE`：日期格式
- `TIME`：时间格式  
- `DATETIME`：日期时间格式

**地区选项**：
- `'EUR'`：欧洲格式
- `'USA'`：美国格式
- `'JIS'`：日本工业标准格式
- `'ISO'`：ISO标准格式
- `'INTERNAL'`：MySQL内部格式

```sql
-- 获取各种标准格式
SELECT GET_FORMAT(DATE, 'USA');     -- %m.%d.%Y
SELECT GET_FORMAT(DATE, 'EUR');     -- %d.%m.%Y  
SELECT GET_FORMAT(DATE, 'ISO');     -- %Y-%m-%d

-- 结合DATE_FORMAT使用
SELECT DATE_FORMAT(NOW(), GET_FORMAT(DATE, 'USA')) as usa_date;
-- 结果: 01.15.2024

SELECT DATE_FORMAT(NOW(), GET_FORMAT(DATETIME, 'ISO')) as iso_datetime;
-- 结果: 2024-01-15 14:30:25
```

---

## 4. ⚡ 日期时间运算函数


### 4.1 日期加减法


#### DATE_ADD() - 日期加法

**概念含义**：在指定日期上增加一定的时间间隔，可以添加年、月、日、小时等。

**语法格式**：`DATE_ADD(date, INTERVAL value unit)`

**常用时间单位**：
| 单位 | **含义** | **示例** |
|-----|---------|---------|
| `YEAR` | 年 | `INTERVAL 1 YEAR` |
| `MONTH` | 月 | `INTERVAL 3 MONTH` |
| `DAY` | 天 | `INTERVAL 7 DAY` |
| `HOUR` | 小时 | `INTERVAL 2 HOUR` |
| `MINUTE` | 分钟 | `INTERVAL 30 MINUTE` |
| `SECOND` | 秒 | `INTERVAL 45 SECOND` |
| `WEEK` | 周 | `INTERVAL 2 WEEK` |

```sql
-- 基础日期加法
SELECT DATE_ADD(NOW(), INTERVAL 1 DAY) as tomorrow;
SELECT DATE_ADD(NOW(), INTERVAL 1 WEEK) as next_week;
SELECT DATE_ADD(NOW(), INTERVAL 1 MONTH) as next_month;
SELECT DATE_ADD(NOW(), INTERVAL 1 YEAR) as next_year;

-- 复合时间间隔
SELECT DATE_ADD(NOW(), INTERVAL '1 2:30:45' DAY_SECOND) as future_time;
-- 增加1天2小时30分钟45秒
```

**实际业务应用**：
```sql
-- 计算会员到期时间
UPDATE members 
SET expire_date = DATE_ADD(CURDATE(), INTERVAL 1 YEAR)
WHERE membership_type = 'annual';

-- 查询即将到期的订单（7天内）
SELECT * FROM subscriptions 
WHERE expire_date BETWEEN CURDATE() 
  AND DATE_ADD(CURDATE(), INTERVAL 7 DAY);

-- 生成未来的提醒时间
INSERT INTO reminders (user_id, remind_time, message)
SELECT 
    user_id,
    DATE_ADD(NOW(), INTERVAL 1 HOUR) as remind_time,
    '您的会议即将开始' as message
FROM meetings WHERE meeting_time > NOW();
```

#### ADDDATE() - 日期加法（简化版）

**概念含义**：DATE_ADD()的简化写法，功能完全相同。

```sql
-- 与DATE_ADD等效的写法
SELECT ADDDATE(NOW(), INTERVAL 1 DAY) as tomorrow;
SELECT ADDDATE(NOW(), 7) as week_later;  -- 简化写法，默认添加天数
```

#### DATE_SUB() - 日期减法  

**概念含义**：在指定日期上减去一定的时间间隔。

```sql
-- 基础日期减法
SELECT DATE_SUB(NOW(), INTERVAL 1 DAY) as yesterday;
SELECT DATE_SUB(NOW(), INTERVAL 1 MONTH) as last_month;
SELECT DATE_SUB(NOW(), INTERVAL 1 YEAR) as last_year;

-- 实际应用：查询历史数据
SELECT * FROM sales 
WHERE sale_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY);
-- 查询最近30天的销售记录

SELECT * FROM users 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 1 WEEK);
-- 查询最近一周注册的用户
```

#### SUBDATE() - 日期减法（简化版）

**概念含义**：DATE_SUB()的简化写法。

```sql
-- 与DATE_SUB等效
SELECT SUBDATE(NOW(), INTERVAL 1 DAY) as yesterday;
SELECT SUBDATE(NOW(), 7) as week_ago;
```

### 4.2 时间加减法


#### ADDTIME() - 时间加法

**概念含义**：在时间上添加指定的时间间隔，主要用于时分秒的计算。

```sql
-- 时间加法示例
SELECT ADDTIME(NOW(), '2:30:00') as future_time;
-- 当前时间增加2小时30分钟

SELECT ADDTIME('14:30:25', '1:15:30') as result_time;
-- 结果: 15:45:55

-- 负数表示减法
SELECT ADDTIME(NOW(), '-1:30:00') as past_time;
-- 当前时间减去1小时30分钟
```

**实际应用**：
```sql
-- 计算会议结束时间
SELECT 
    meeting_title,
    start_time,
    ADDTIME(start_time, duration) as end_time
FROM meetings;

-- 计算加班时间
SELECT 
    employee_id,
    ADDTIME(work_start, '8:00:00') as normal_end,
    actual_end,
    SUBTIME(actual_end, ADDTIME(work_start, '8:00:00')) as overtime
FROM work_records;
```

#### SUBTIME() - 时间减法

**概念含义**：从时间中减去指定的时间间隔。

```sql
-- 时间减法示例
SELECT SUBTIME(NOW(), '2:30:00') as past_time;
SELECT SUBTIME('14:30:25', '1:15:30') as result_time;
-- 结果: 13:14:55
```

---

## 5. 📏 日期时间差值计算


### 5.1 日期差值计算


#### DATEDIFF() - 计算日期差

**概念含义**：计算两个日期之间相差的天数，只考虑日期部分，忽略时间。

```sql
-- 基础日期差计算
SELECT DATEDIFF('2024-01-20', '2024-01-15') as day_diff;
-- 结果: 5

SELECT DATEDIFF(CURDATE(), '2024-01-01') as days_since_new_year;

-- 计算年龄（天数）
SELECT 
    name,
    birthday,
    DATEDIFF(CURDATE(), birthday) as age_in_days,
    FLOOR(DATEDIFF(CURDATE(), birthday) / 365) as age_in_years
FROM users;
```

**业务应用场景**：
```sql
-- 计算订单处理时间
SELECT 
    order_id,
    order_date,
    ship_date,
    DATEDIFF(ship_date, order_date) as processing_days
FROM orders
WHERE ship_date IS NOT NULL;

-- 查找超期订单
SELECT * FROM orders 
WHERE DATEDIFF(CURDATE(), order_date) > 7 
  AND status = 'pending';

-- 计算会员剩余天数
SELECT 
    user_id,
    expire_date,
    CASE 
        WHEN expire_date > CURDATE() 
        THEN DATEDIFF(expire_date, CURDATE())
        ELSE 0 
    END as remaining_days
FROM memberships;
```

### 5.2 时间差值计算


#### TIMEDIFF() - 计算时间差

**概念含义**：计算两个时间之间的差值，返回时间格式的结果。

```sql
-- 基础时间差计算
SELECT TIMEDIFF('14:30:25', '12:15:10') as time_diff;
-- 结果: 02:15:15

SELECT TIMEDIFF(NOW(), '09:00:00') as work_hours;

-- 计算会议持续时间
SELECT 
    meeting_name,
    start_time,
    end_time,
    TIMEDIFF(end_time, start_time) as duration
FROM meetings;
```

**时间差计算应用**：
```sql
-- 计算员工工作时长
SELECT 
    employee_id,
    work_date,
    clock_in,
    clock_out,
    TIMEDIFF(clock_out, clock_in) as work_duration,
    TIME_TO_SEC(TIMEDIFF(clock_out, clock_in)) / 3600 as hours_worked
FROM attendance
WHERE work_date = CURDATE();

-- 计算系统响应时间
SELECT 
    request_id,
    start_time,
    end_time,
    TIMEDIFF(end_time, start_time) as response_time,
    CASE 
        WHEN TIME_TO_SEC(TIMEDIFF(end_time, start_time)) > 5
        THEN '慢查询'
        ELSE '正常'
    END as status
FROM api_logs;
```

### 5.3 时间戳差值计算


#### TIMESTAMPDIFF() - 时间戳差值

**概念含义**：计算两个日期时间之间指定单位的差值，比DATEDIFF更灵活。

**语法**：`TIMESTAMPDIFF(unit, datetime1, datetime2)`

```sql
-- 计算不同单位的时间差
SELECT TIMESTAMPDIFF(YEAR, '1990-01-15', NOW()) as age_years;
SELECT TIMESTAMPDIFF(MONTH, '2023-01-15', NOW()) as months_diff;
SELECT TIMESTAMPDIFF(DAY, '2024-01-01', NOW()) as days_diff;
SELECT TIMESTAMPDIFF(HOUR, '2024-01-15 10:00:00', NOW()) as hours_diff;
SELECT TIMESTAMPDIFF(MINUTE, '2024-01-15 14:00:00', NOW()) as minutes_diff;
```

**精确年龄计算**：
```sql
-- 精确计算年龄
SELECT 
    name,
    birthday,
    TIMESTAMPDIFF(YEAR, birthday, CURDATE()) as exact_age,
    CONCAT(
        TIMESTAMPDIFF(YEAR, birthday, CURDATE()), '岁',
        TIMESTAMPDIFF(MONTH, 
            DATE_ADD(birthday, 
                INTERVAL TIMESTAMPDIFF(YEAR, birthday, CURDATE()) YEAR
            ), 
            CURDATE()
        ), '个月'
    ) as detailed_age
FROM users;
```

#### TIMESTAMPADD() - 时间戳加法

**概念含义**：在日期时间上增加指定单位的数值。

```sql
-- 时间戳加法示例
SELECT TIMESTAMPADD(YEAR, 1, NOW()) as next_year;
SELECT TIMESTAMPADD(MONTH, 3, NOW()) as three_months_later;
SELECT TIMESTAMPADD(DAY, 30, NOW()) as thirty_days_later;
SELECT TIMESTAMPADD(HOUR, 5, NOW()) as five_hours_later;

-- 批量更新到期时间
UPDATE subscriptions 
SET expire_date = TIMESTAMPADD(YEAR, 1, start_date)
WHERE subscription_type = 'annual';
```

---

## 6. 🔍 日期时间部分提取


### 6.1 基础提取函数


#### DATE() - 提取日期部分

**概念含义**：从日期时间中提取纯日期部分，去掉时间信息。

```sql
-- 提取日期部分
SELECT DATE(NOW()) as today_date;
-- 结果: 2024-01-15

SELECT DATE('2024-01-15 14:30:25') as date_only;
-- 结果: 2024-01-15

-- 按日期分组统计
SELECT 
    DATE(created_at) as create_date,
    COUNT(*) as daily_count
FROM orders
GROUP BY DATE(created_at)
ORDER BY create_date DESC;
```

#### TIME() - 提取时间部分

**概念含义**：从日期时间中提取纯时间部分，去掉日期信息。

```sql
-- 提取时间部分
SELECT TIME(NOW()) as current_time;
-- 结果: 14:30:25

-- 分析访问时间规律
SELECT 
    TIME(access_time) as access_hour,
    COUNT(*) as access_count
FROM website_logs
WHERE DATE(access_time) = CURDATE()
GROUP BY HOUR(access_time)
ORDER BY access_hour;
```

### 6.2 年月日提取


#### YEAR() - 提取年份

**概念含义**：从日期中提取4位年份数字。

```sql
-- 提取年份
SELECT YEAR(NOW()) as current_year;
-- 结果: 2024

-- 按年份统计数据
SELECT 
    YEAR(order_date) as order_year,
    COUNT(*) as yearly_orders,
    SUM(amount) as yearly_sales
FROM orders
GROUP BY YEAR(order_date)
ORDER BY order_year DESC;
```

#### MONTH() - 提取月份

**概念含义**：从日期中提取月份数字（1-12）。

```sql
-- 提取月份
SELECT MONTH(NOW()) as current_month;
-- 结果: 1

-- 月度销售分析
SELECT 
    YEAR(sale_date) as year,
    MONTH(sale_date) as month,
    SUM(amount) as monthly_sales
FROM sales
GROUP BY YEAR(sale_date), MONTH(sale_date)
ORDER BY year DESC, month DESC;
```

#### MONTHNAME() - 月份名称

**概念含义**：返回月份的英文名称。

```sql
-- 获取月份名称
SELECT MONTHNAME(NOW()) as month_name;
-- 结果: January

-- 生成友好的月份报表
SELECT 
    CONCAT(YEAR(created_at), '年', MONTHNAME(created_at)) as period,
    COUNT(*) as user_count
FROM users
GROUP BY YEAR(created_at), MONTH(created_at)
ORDER BY created_at DESC;
```

#### DAY() - 提取日期

**概念含义**：从日期中提取日期数字（1-31），与DAYOFMONTH()功能相同。

```sql
-- 提取日期
SELECT DAY(NOW()) as current_day;
-- 结果: 15

-- 分析每月各天的业务量
SELECT 
    DAY(order_date) as day_of_month,
    COUNT(*) as daily_orders
FROM orders
WHERE MONTH(order_date) = MONTH(NOW())
GROUP BY DAY(order_date)
ORDER BY day_of_month;
```

### 6.3 星期相关提取


#### DAYNAME() - 星期名称

**概念含义**：返回星期的英文名称。

```sql
-- 获取星期名称
SELECT DAYNAME(NOW()) as day_name;
-- 结果: Monday

-- 分析不同星期的业务模式
SELECT 
    DAYNAME(order_date) as weekday,
    COUNT(*) as order_count,
    AVG(amount) as avg_amount
FROM orders
GROUP BY DAYNAME(order_date), DAYOFWEEK(order_date)
ORDER BY DAYOFWEEK(order_date);
```

#### DAYOFWEEK() - 星期数字

**概念含义**：返回星期的数字表示（1=周日，2=周一，...，7=周六）。

```sql
-- 获取星期数字
SELECT DAYOFWEEK(NOW()) as weekday_num;
-- 结果: 2 (周一)

-- 工作日vs周末分析
SELECT 
    CASE 
        WHEN DAYOFWEEK(created_at) IN (1,7) THEN '周末'
        ELSE '工作日'
    END as day_type,
    COUNT(*) as user_count
FROM users
GROUP BY day_type;
```

#### WEEKDAY() - 工作日数字

**概念含义**：返回工作日的数字表示（0=周一，1=周二，...，6=周日）。

```sql
-- 获取工作日数字
SELECT WEEKDAY(NOW()) as workday_num;
-- 结果: 0 (周一)

-- 更符合国际惯例的星期分析
SELECT 
    CASE WEEKDAY(NOW())
        WHEN 0 THEN '周一'
        WHEN 1 THEN '周二'
        WHEN 2 THEN '周三'
        WHEN 3 THEN '周四'
        WHEN 4 THEN '周五'
        WHEN 5 THEN '周六'
        WHEN 6 THEN '周日'
    END as weekday_chinese;
```

### 6.4 特殊日期提取


#### DAYOFMONTH() - 月份中的日期

**概念含义**：返回该日期在当月中是第几天（1-31），与DAY()功能相同。

```sql
SELECT DAYOFMONTH(NOW()) as day_in_month;
-- 结果: 15
```

#### DAYOFYEAR() - 年份中的日期

**概念含义**：返回该日期在当年中是第几天（1-366）。

```sql
-- 获取年份中的第几天
SELECT DAYOFYEAR(NOW()) as day_in_year;
-- 结果: 15 (1月15日是今年第15天)

-- 分析业务的季节性规律
SELECT 
    FLOOR((DAYOFYEAR(sale_date) - 1) / 91) + 1 as season,
    SUM(amount) as seasonal_sales
FROM sales
WHERE YEAR(sale_date) = 2024
GROUP BY season
ORDER BY season;
```

### 6.5 时间部分提取


#### HOUR() - 提取小时

**概念含义**：提取时间中的小时部分（0-23）。

```sql
-- 提取小时
SELECT HOUR(NOW()) as current_hour;
-- 结果: 14

-- 分析每小时的访问量
SELECT 
    HOUR(access_time) as access_hour,
    COUNT(*) as hourly_visits
FROM access_logs
WHERE DATE(access_time) = CURDATE()
GROUP BY HOUR(access_time)
ORDER BY access_hour;
```

#### MINUTE() - 提取分钟

**概念含义**：提取时间中的分钟部分（0-59）。

```sql
-- 提取分钟
SELECT MINUTE(NOW()) as current_minute;
-- 结果: 30

-- 精确到分钟的时间分析
SELECT 
    CONCAT(HOUR(created_at), ':', 
           LPAD(MINUTE(created_at), 2, '0')) as time_slot,
    COUNT(*) as count
FROM events
WHERE DATE(created_at) = CURDATE()
GROUP BY HOUR(created_at), MINUTE(created_at)
ORDER BY time_slot;
```

#### SECOND() - 提取秒数

**概念含义**：提取时间中的秒数部分（0-59）。

```sql
-- 提取秒数
SELECT SECOND(NOW()) as current_second;
-- 结果: 25

-- 性能监控：分析响应时间分布
SELECT 
    SECOND(response_time) as response_second,
    COUNT(*) as count
FROM api_performance
GROUP BY SECOND(response_time)
ORDER BY response_second;
```

#### MICROSECOND() - 提取微秒

**概念含义**：提取时间中的微秒部分（0-999999）。

```sql
-- 提取微秒（需要高精度时间字段）
SELECT MICROSECOND('14:30:25.123456') as microseconds;
-- 结果: 123456

-- 高精度时间戳记录
SELECT 
    event_id,
    CONCAT(
        TIME(event_time), '.', 
        LPAD(MICROSECOND(event_time), 6, '0')
    ) as precise_time
FROM high_precision_events;
```

### 6.6 通用提取函数


#### EXTRACT() - 通用日期部分提取

**概念含义**：更标准的SQL写法，可以提取日期时间的任意部分。

**支持的单位**：
- `YEAR`, `MONTH`, `DAY`
- `HOUR`, `MINUTE`, `SECOND`, `MICROSECOND`
- `QUARTER`, `WEEK`
- `YEAR_MONTH`, `DAY_HOUR`, `DAY_MINUTE`, `DAY_SECOND`

```sql
-- 基础提取
SELECT EXTRACT(YEAR FROM NOW()) as current_year;
SELECT EXTRACT(MONTH FROM NOW()) as current_month;
SELECT EXTRACT(DAY FROM NOW()) as current_day;
SELECT EXTRACT(HOUR FROM NOW()) as current_hour;

-- 复合提取
SELECT EXTRACT(YEAR_MONTH FROM NOW()) as year_month;
-- 结果: 202401

-- 实际应用：季度报表
SELECT 
    EXTRACT(QUARTER FROM order_date) as quarter,
    EXTRACT(YEAR FROM order_date) as year,
    SUM(amount) as quarterly_sales
FROM orders
GROUP BY EXTRACT(YEAR FROM order_date), EXTRACT(QUARTER FROM order_date)
ORDER BY year DESC, quarter DESC;
```

---

## 7. 📅 特殊日期计算函数


### 7.1 周相关函数


#### WEEK() - 周数计算

**概念含义**：计算指定日期在当年中是第几周。

```sql
-- 获取当前是第几周
SELECT WEEK(NOW()) as current_week;
-- 结果: 3

SELECT WEEK(NOW(), 1) as current_week_monday;
-- 第二个参数指定周的起始：0=周日开始，1=周一开始

-- 按周统计业务数据
SELECT 
    CONCAT(YEAR(order_date), '年第', WEEK(order_date), '周') as week_label,
    COUNT(*) as weekly_orders
FROM orders
WHERE YEAR(order_date) = 2024
GROUP BY YEAR(order_date), WEEK(order_date)
ORDER BY YEAR(order_date), WEEK(order_date);
```

#### WEEKOFYEAR() - 年份周数

**概念含义**：计算指定日期在当年中是第几周，符合ISO 8601标准。

```sql
-- ISO标准周数
SELECT WEEKOFYEAR(NOW()) as iso_week;

-- 对比不同周数计算方法
SELECT 
    NOW() as current_date,
    WEEK(NOW()) as week_sunday,
    WEEK(NOW(), 1) as week_monday,
    WEEKOFYEAR(NOW()) as iso_week;
```

#### YEARWEEK() - 年份周组合

**概念含义**：返回年份和周数的组合，格式为YYYYWW。

```sql
-- 年份周组合
SELECT YEARWEEK(NOW()) as year_week;
-- 结果: 202403

-- 按年份周进行分组统计
SELECT 
    YEARWEEK(created_at) as year_week,
    COUNT(*) as weekly_registrations
FROM users
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 12 WEEK)
GROUP BY YEARWEEK(created_at)
ORDER BY year_week DESC;
```

### 7.2 季度函数


#### QUARTER() - 季度提取

**概念含义**：返回日期所属的季度（1-4）。

```sql
-- 获取当前季度
SELECT QUARTER(NOW()) as current_quarter;
-- 结果: 1 (第一季度)

-- 季度业务分析
SELECT 
    YEAR(sale_date) as year,
    QUARTER(sale_date) as quarter,
    COUNT(*) as quarterly_sales_count,
    SUM(amount) as quarterly_revenue
FROM sales
GROUP BY YEAR(sale_date), QUARTER(sale_date)
ORDER BY year DESC, quarter DESC;

-- 季度同比分析
SELECT 
    quarter,
    SUM(CASE WHEN year = 2024 THEN revenue ELSE 0 END) as revenue_2024,
    SUM(CASE WHEN year = 2023 THEN revenue ELSE 0 END) as revenue_2023,
    ROUND(
        (SUM(CASE WHEN year = 2024 THEN revenue ELSE 0 END) - 
         SUM(CASE WHEN year = 2023 THEN revenue ELSE 0 END)) / 
        SUM(CASE WHEN year = 2023 THEN revenue ELSE 0 END) * 100, 2
    ) as growth_rate
FROM (
    SELECT 
        YEAR(sale_date) as year,
        QUARTER(sale_date) as quarter,
        SUM(amount) as revenue
    FROM sales
    GROUP BY YEAR(sale_date), QUARTER(sale_date)
) quarterly_data
GROUP BY quarter
ORDER BY quarter;
```

### 7.3 月末和特殊日期


#### LAST_DAY() - 月末日期

**概念含义**：返回指定日期所在月份的最后一天。

```sql
-- 获取本月最后一天
SELECT LAST_DAY(NOW()) as month_end;
-- 结果: 2024-01-31

-- 计算月初和月末
SELECT 
    DATE_FORMAT(NOW(), '%Y-%m-01') as month_start,
    LAST_DAY(NOW()) as month_end,
    DAY(LAST_DAY(NOW())) as days_in_month;

-- 查询本月数据
SELECT * FROM orders 
WHERE order_date >= DATE_FORMAT(NOW(), '%Y-%m-01')
  AND order_date <= LAST_DAY(NOW());

-- 计算每月的工作日天数
SELECT 
    DATE_FORMAT(LAST_DAY(NOW()), '%Y-%m') as month,
    DAY(LAST_DAY(NOW())) as total_days,
    SUM(CASE 
        WHEN DAYOFWEEK(
            DATE_ADD(DATE_FORMAT(NOW(), '%Y-%m-01'), INTERVAL (days.day - 1) DAY)
        ) NOT IN (1,7) THEN 1 
        ELSE 0 
    END) as workdays
FROM (
    SELECT 1 as day UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 UNION SELECT 5
    UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9 UNION SELECT 10
    UNION SELECT 11 UNION SELECT 12 UNION SELECT 13 UNION SELECT 14 UNION SELECT 15
    UNION SELECT 16 UNION SELECT 17 UNION SELECT 18 UNION SELECT 19 UNION SELECT 20
    UNION SELECT 21 UNION SELECT 22 UNION SELECT 23 UNION SELECT 24 UNION SELECT 25
    UNION SELECT 26 UNION SELECT 27 UNION SELECT 28 UNION SELECT 29 UNION SELECT 30
    UNION SELECT 31
) days
WHERE days.day <= DAY(LAST_DAY(NOW()));
```

### 7.4 日期创建函数


#### MAKEDATE() - 创建日期

**概念含义**：根据年份和年份中的天数创建日期。

```sql
-- 创建指定年份的第100天
SELECT MAKEDATE(2024, 100) as day_100;
-- 结果: 2024-04-09

-- 计算某年的特定节点日期
SELECT 
    MAKEDATE(2024, 1) as new_year,
    MAKEDATE(2024, 32) as feb_1st,
    MAKEDATE(2024, 91) as quarter_end,
    MAKEDATE(2024, 365) as year_end;

-- 业务应用：生成财年日期
SELECT 
    MAKEDATE(YEAR(NOW()), 91) as q1_end,
    MAKEDATE(YEAR(NOW()), 182) as q2_end,
    MAKEDATE(YEAR(NOW()), 274) as q3_end,
    MAKEDATE(YEAR(NOW()), 365) as q4_end;
```

#### MAKETIME() - 创建时间

**概念含义**：根据小时、分钟、秒创建时间值。

```sql
-- 创建指定时间
SELECT MAKETIME(14, 30, 25) as custom_time;
-- 结果: 14:30:25

-- 创建工作时间范围
SELECT 
    MAKETIME(9, 0, 0) as work_start,
    MAKETIME(12, 0, 0) as lunch_start,
    MAKETIME(13, 0, 0) as lunch_end,
    MAKETIME(18, 0, 0) as work_end;

-- 计算时间间隔
SELECT 
    TIMEDIFF(MAKETIME(18, 0, 0), MAKETIME(9, 0, 0)) as total_work_time,
    TIMEDIFF(MAKETIME(13, 0, 0), MAKETIME(12, 0, 0)) as lunch_time,
    SUBTIME(
        TIMEDIFF(MAKETIME(18, 0, 0), MAKETIME(9, 0, 0)),
        TIMEDIFF(MAKETIME(13, 0, 0), MAKETIME(12, 0, 0))
    ) as actual_work_time;
```

### 7.5 特殊计算函数


#### PERIOD_ADD() - 期间加法

**概念含义**：在年月格式(YYYYMM)上增加指定月数。

```sql
-- 期间加法
SELECT PERIOD_ADD(202401, 3) as three_months_later;
-- 结果: 202404

-- 计算合同续期时间
SELECT 
    contract_id,
    start_period,
    PERIOD_ADD(start_period, contract_months) as end_period
FROM contracts;
```

#### PERIOD_DIFF() - 期间差值

**概念含义**：计算两个年月格式之间相差的月数。

```sql
-- 期间差值
SELECT PERIOD_DIFF(202404, 202401) as months_diff;
-- 结果: 3

-- 计算合同已执行月数
SELECT 
    contract_id,
    start_period,
    end_period,
    PERIOD_DIFF(end_period, start_period) as contract_months,
    PERIOD_DIFF(DATE_FORMAT(NOW(), '%Y%m'), start_period) as executed_months
FROM contracts;
```

### 7.6 时间单位转换


#### SEC_TO_TIME() - 秒转时间

**概念含义**：将秒数转换为时间格式(HH:MM:SS)。

```sql
-- 秒转时间格式
SELECT SEC_TO_TIME(3725) as time_format;
-- 结果: 01:02:05

-- 计算总工作时长
SELECT 
    employee_id,
    work_date,
    SUM(work_seconds) as total_seconds,
    SEC_TO_TIME(SUM(work_seconds)) as total_work_time
FROM work_sessions
GROUP BY employee_id, work_date;
```

#### TIME_TO_SEC() - 时间转秒

**概念含义**：将时间格式转换为总秒数。

```sql
-- 时间转秒数
SELECT TIME_TO_SEC('01:02:05') as total_seconds;
-- 结果: 3725

-- 计算平均响应时间（秒）
SELECT 
    api_name,
    AVG(TIME_TO_SEC(response_time)) as avg_response_seconds,
    SEC_TO_TIME(AVG(TIME_TO_SEC(response_time))) as avg_response_time
FROM api_logs
GROUP BY api_name;
```

#### TO_DAYS() - 转换为天数

**概念含义**：将日期转换为从公元0年开始的天数。

```sql
-- 日期转天数
SELECT TO_DAYS('2024-01-15') as days_since_zero;
SELECT TO_DAYS(NOW()) - TO_DAYS('2024-01-01') as days_since_new_year;
```

#### FROM_DAYS() - 天数转日期

**概念含义**：将天数转换回日期格式。

```sql
-- 天数转日期
SELECT FROM_DAYS(739244) as converted_date;

-- 计算N天后的日期
SELECT FROM_DAYS(TO_DAYS(NOW()) + 30) as thirty_days_later;
-- 等效于 DATE_ADD(NOW(), INTERVAL 30 DAY)
```

---

## 8. 🌍 时区转换函数


### 8.1 时区转换


#### CONVERT_TZ() - 时区转换

**概念含义**：将时间从一个时区转换到另一个时区，用于处理全球化应用的时间显示。

**语法**：`CONVERT_TZ(datetime, from_tz, to_tz)`

```sql
-- 基础时区转换
SELECT 
    NOW() as beijing_time,
    CONVERT_TZ(NOW(), '+08:00', '+00:00') as utc_time,
    CONVERT_TZ(NOW(), '+08:00', '-05:00') as new_york_time,
    CONVERT_TZ(NOW(), '+08:00', '+09:00') as tokyo_time;

-- 命名时区转换（需要时区表支持）
SELECT CONVERT_TZ(NOW(), 'Asia/Shanghai', 'America/New_York') as ny_time;
```

**实际应用场景**：
```sql
-- 全球用户的本地时间显示
SELECT 
    user_id,
    username,
    timezone,
    created_at as server_time,
    CONVERT_TZ(created_at, '+00:00', timezone) as local_time
FROM users u
JOIN user_preferences p ON u.id = p.user_id
WHERE u.id = 1001;

-- 不同时区的会议时间
SELECT 
    meeting_id,
    title,
    start_time as utc_time,
    CONVERT_TZ(start_time, '+00:00', '+08:00') as beijing_time,
    CONVERT_TZ(start_time, '+00:00', '-08:00') as los_angeles_time,
    CONVERT_TZ(start_time, '+00:00', '+01:00') as london_time
FROM meetings
WHERE DATE(start_time) = '2024-01-15';

-- 全球销售数据按本地时间统计
SELECT 
    region,
    DATE(CONVERT_TZ(order_time, '+00:00', region_timezone)) as local_date,
    COUNT(*) as daily_orders
FROM orders o
JOIN regions r ON o.region_id = r.id
WHERE order_time >= '2024-01-01'
GROUP BY region, local_date
ORDER BY region, local_date;
```

**时区转换应用架构**：
```
全球用户请求流程:
客户端本地时间 → 服务器UTC时间 → 数据库存储 → 显示时转换为用户时区

时区处理最佳实践:
1. 数据库统一存储UTC时间
2. 应用层处理时区转换
3. 前端显示用户本地时间

时区转换示例:
北京时间 2024-01-15 22:30:00 (+08:00)
    ↓ CONVERT_TZ(time, '+08:00', '+00:00')  
UTC时间  2024-01-15 14:30:00 (数据库存储)
    ↓ CONVERT_TZ(time, '+00:00', '-05:00')
纽约时间 2024-01-15 09:30:00 (-05:00)
```

### 8.2 时区相关查询


**时区处理的完整示例**：
```sql
-- 创建支持时区的表结构
CREATE TABLE global_events (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255),
    event_time_utc DATETIME,  -- 统一存储UTC时间
    timezone VARCHAR(50),     -- 事件发生的时区
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 插入不同时区的事件
INSERT INTO global_events (title, event_time_utc, timezone) VALUES
('北京会议', CONVERT_TZ('2024-01-15 14:00:00', '+08:00', '+00:00'), 'Asia/Shanghai'),
('纽约会议', CONVERT_TZ('2024-01-15 09:00:00', '-05:00', '+00:00'), 'America/New_York'),
('伦敦会议', CONVERT_TZ('2024-01-15 14:00:00', '+00:00', '+00:00'), 'Europe/London');

-- 查询时转换为各地本地时间
SELECT 
    title,
    event_time_utc,
    timezone,
    CASE timezone
        WHEN 'Asia/Shanghai' THEN 
            CONVERT_TZ(event_time_utc, '+00:00', '+08:00')
        WHEN 'America/New_York' THEN 
            CONVERT_TZ(event_time_utc, '+00:00', '-05:00') 
        WHEN 'Europe/London' THEN 
            CONVERT_TZ(event_time_utc, '+00:00', '+00:00')
    END as local_time
FROM global_events;
```

**夏令时处理注意事项**：
```sql
-- 夏令时转换可能导致的问题
SELECT 
    '美国夏令时期间' as period,
    CONVERT_TZ('2024-07-15 12:00:00', '+00:00', '-04:00') as edt_time,
    '美国标准时期间' as period2,
    CONVERT_TZ('2024-12-15 12:00:00', '+00:00', '-05:00') as est_time;
```

> 📝 **时区处理最佳实践**：
> - 数据库统一存储UTC时间
> - 应用层根据用户时区进行转换
> - 考虑夏令时的影响
> - 提供时区选择和显示功能

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心函数


```
🕒 基础时间获取：NOW(), CURDATE(), CURTIME()
🔢 时间戳处理：UNIX_TIMESTAMP(), FROM_UNIXTIME()
🎨 格式化转换：DATE_FORMAT(), STR_TO_DATE()
⚡ 日期运算：DATE_ADD(), DATE_SUB(), DATEDIFF()
🔍 部分提取：YEAR(), MONTH(), DAY(), HOUR()
📅 特殊计算：LAST_DAY(), QUARTER(), WEEK()
🌍 时区转换：CONVERT_TZ()
```

### 9.2 函数分类记忆


**按功能分类**：
```
获取类：NOW(), CURDATE(), CURTIME(), SYSDATE()
转换类：UNIX_TIMESTAMP(), FROM_UNIXTIME(), STR_TO_DATE()
格式化：DATE_FORMAT(), TIME_FORMAT(), GET_FORMAT()
计算类：DATE_ADD(), DATE_SUB(), ADDTIME(), SUBTIME()
差值类：DATEDIFF(), TIMEDIFF(), TIMESTAMPDIFF()
提取类：YEAR(), MONTH(), DAY(), HOUR(), MINUTE(), SECOND()
特殊类：LAST_DAY(), MAKEDATE(), QUARTER(), WEEK()
```

**按使用频率分类**：
```
🔥 高频必会：NOW(), DATE_FORMAT(), DATE_ADD(), DATEDIFF(), YEAR(), MONTH(), DAY()
⭐ 常用重要：CURDATE(), UNIX_TIMESTAMP(), FROM_UNIXTIME(), LAST_DAY()
💡 特殊场景：CONVERT_TZ(), QUARTER(), WEEK(), TIMESTAMPDIFF()
🔧 辅助函数：MAKEDATE(), MAKETIME(), SEC_TO_TIME(), TIME_TO_SEC()
```

### 9.3 关键应用场景


**📊 业务统计分析**：
```sql
-- 时间维度统计模板
SELECT 
    DATE_FORMAT(date_column, '%Y-%m') as month,
    COUNT(*) as count,
    SUM(amount) as total
FROM table_name
WHERE date_column >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
GROUP BY DATE_FORMAT(date_column, '%Y-%m')
ORDER BY month DESC;
```

**🕐 时间范围查询**：
```sql
-- 常用时间范围查询
-- 今天
WHERE DATE(created_at) = CURDATE()

-- 本月  
WHERE created_at >= DATE_FORMAT(NOW(), '%Y-%m-01')
  AND created_at <= LAST_DAY(NOW())

-- 最近30天
WHERE created_at >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)

-- 本年度
WHERE YEAR(created_at) = YEAR(NOW())
```

**⏰ 时间计算应用**：
```sql
-- 年龄计算
SELECT TIMESTAMPDIFF(YEAR, birthday, CURDATE()) as age;

-- 到期提醒（7天内）
SELECT * FROM subscriptions 
WHERE expire_date BETWEEN CURDATE() 
  AND DATE_ADD(CURDATE(), INTERVAL 7 DAY);

-- 工作日计算
SELECT DATEDIFF(end_date, start_date) - 
       (WEEK(end_date) - WEEK(start_date)) * 2 as workdays;
```

### 9.4 性能优化建议


**🚀 索引优化**：
- 对日期字段建立索引
- 使用日期范围查询时保持左边界
- 避免在WHERE条件中对日期字段使用函数

```sql
-- 推荐写法（能使用索引）
WHERE created_at >= '2024-01-01' 
  AND created_at < '2024-02-01'

-- 不推荐写法（无法使用索引）  
WHERE YEAR(created_at) = 2024 
  AND MONTH(created_at) = 1
```

**💾 存储建议**：
- 使用合适的日期时间类型
- 统一存储UTC时间
- 考虑使用TIMESTAMP自动更新

### 9.5 常见错误和注意事项


**⚠️ 时区问题**：
```sql
-- 注意：NOW()返回服务器时区时间
-- 如需UTC时间，使用UTC_TIMESTAMP()
SELECT NOW(), UTC_TIMESTAMP();
```

**⚠️ 日期格式问题**：
```sql
-- 推荐使用标准格式
'2024-01-15'        -- ✅ 推荐
'2024/01/15'        -- ⚠️ 可能有兼容性问题
'01/15/2024'        -- ❌ 避免使用
```

**⚠️ 空值处理**：
```sql
-- 日期函数遇到NULL返回NULL
SELECT DATE_ADD(NULL, INTERVAL 1 DAY);  -- 返回 NULL

-- 需要考虑空值处理
SELECT COALESCE(expire_date, DATE_ADD(NOW(), INTERVAL 1 YEAR)) as final_expire;
```

### 9.6 学习进阶路径


**📈 学习建议**：
1. **掌握基础**：NOW(), DATE_FORMAT(), DATE_ADD()等核心函数
2. **理解概念**：时间戳、时区、日期格式的含义
3. **实践应用**：结合实际业务场景练习
4. **性能优化**：学习索引和查询优化
5. **全球化**：掌握时区处理和国际化

**🔧 实战练习**：
- 实现用户生日提醒功能
- 制作销售数据的时间维度报表
- 开发支持多时区的会议系统
- 优化包含日期查询的慢SQL

**核心记忆口诀**：
- 获取用NOW三兄弟，格式化靠DATE_FORMAT
- 加减运算DATE_ADD/SUB，时间差值DATEDIFF算  
- 提取部分YEAR/MONTH/DAY，特殊日期LAST_DAY
- 时区转换CONVERT_TZ，时间戳用UNIX配对
- 索引优化别用函数，范围查询效率高

### 9.7 综合实战案例


#### 用户生日提醒系统

```sql
-- 创建用户表
CREATE TABLE users (
    id INT PRIMARY KEY,
    username VARCHAR(50),
    birthday DATE,
    timezone VARCHAR(50) DEFAULT '+08:00'
);

-- 查找今日生日用户
SELECT 
    username,
    birthday,
    TIMESTAMPDIFF(YEAR, birthday, CURDATE()) as age
FROM users 
WHERE MONTH(birthday) = MONTH(CURDATE()) 
  AND DAY(birthday) = DAY(CURDATE());

-- 查找本月生日用户（按日期排序）
SELECT 
    username,
    birthday,
    DAY(birthday) as birthday_day,
    CASE 
        WHEN DAY(birthday) = DAY(CURDATE()) THEN '今天生日！'
        WHEN DAY(birthday) > DAY(CURDATE()) THEN 
            CONCAT('还有', DAY(birthday) - DAY(CURDATE()), '天生日')
        ELSE '本月生日已过'
    END as birthday_status
FROM users 
WHERE MONTH(birthday) = MONTH(CURDATE())
ORDER BY DAY(birthday);
```

#### 销售数据时间维度分析

```sql
-- 多维度销售统计
SELECT 
    -- 时间维度
    YEAR(sale_date) as year,
    QUARTER(sale_date) as quarter,
    MONTHNAME(sale_date) as month_name,
    WEEK(sale_date) as week_num,
    
    -- 业务指标
    COUNT(*) as order_count,
    SUM(amount) as total_sales,
    AVG(amount) as avg_order_value,
    
    -- 同比分析
    LAG(SUM(amount), 4) OVER (ORDER BY YEAR(sale_date), QUARTER(sale_date)) as last_year_quarter
    
FROM sales 
WHERE sale_date >= DATE_SUB(CURDATE(), INTERVAL 2 YEAR)
GROUP BY YEAR(sale_date), QUARTER(sale_date)
ORDER BY year DESC, quarter DESC;

-- 工作日 vs 周末销售对比
SELECT 
    CASE 
        WHEN DAYOFWEEK(sale_date) IN (1, 7) THEN '周末'
        ELSE '工作日'
    END as day_type,
    YEAR(sale_date) as year,
    MONTH(sale_date) as month,
    COUNT(*) as order_count,
    SUM(amount) as total_sales
FROM sales
WHERE sale_date >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH)
GROUP BY day_type, YEAR(sale_date), MONTH(sale_date)
ORDER BY year DESC, month DESC, day_type;
```

#### 员工考勤系统

```sql
-- 员工考勤统计
CREATE TABLE attendance (
    id INT PRIMARY KEY,
    employee_id INT,
    work_date DATE,
    clock_in TIME,
    clock_out TIME
);

-- 计算工作时长和加班时间
SELECT 
    employee_id,
    work_date,
    clock_in,
    clock_out,
    
    -- 工作时长计算
    TIMEDIFF(clock_out, clock_in) as total_work_time,
    TIME_TO_SEC(TIMEDIFF(clock_out, clock_in)) / 3600 as work_hours,
    
    -- 加班时间计算（超过8小时算加班）
    CASE 
        WHEN TIME_TO_SEC(TIMEDIFF(clock_out, clock_in)) > 8 * 3600 
        THEN SEC_TO_TIME(TIME_TO_SEC(TIMEDIFF(clock_out, clock_in)) - 8 * 3600)
        ELSE '00:00:00'
    END as overtime,
    
    -- 迟到早退判断
    CASE 
        WHEN clock_in > '09:00:00' THEN 
            CONCAT('迟到', TIMEDIFF(clock_in, '09:00:00'))
        WHEN clock_out < '18:00:00' THEN 
            CONCAT('早退', TIMEDIFF('18:00:00', clock_out))
        ELSE '正常'
    END as attendance_status
    
FROM attendance 
WHERE work_date >= DATE_SUB(CURDATE(), INTERVAL 1 MONTH)
ORDER BY employee_id, work_date;

-- 月度考勤汇总
SELECT 
    employee_id,
    DATE_FORMAT(work_date, '%Y-%m') as work_month,
    COUNT(*) as work_days,
    SUM(TIME_TO_SEC(TIMEDIFF(clock_out, clock_in))) / 3600 as total_hours,
    AVG(TIME_TO_SEC(TIMEDIFF(clock_out, clock_in))) / 3600 as avg_daily_hours,
    SUM(CASE WHEN clock_in > '09:00:00' THEN 1 ELSE 0 END) as late_days
FROM attendance 
GROUP BY employee_id, DATE_FORMAT(work_date, '%Y-%m')
ORDER BY employee_id, work_month DESC;
```

#### 全球会议调度系统

```sql
-- 全球会议时间显示
CREATE TABLE meetings (
    id INT PRIMARY KEY,
    title VARCHAR(255),
    start_time_utc DATETIME,
    duration_minutes INT,
    timezone VARCHAR(50)
);

-- 多时区会议时间显示
SELECT 
    title,
    start_time_utc,
    
    -- 各时区时间显示
    CONVERT_TZ(start_time_utc, '+00:00', '+08:00') as beijing_time,
    CONVERT_TZ(start_time_utc, '+00:00', '+09:00') as tokyo_time,
    CONVERT_TZ(start_time_utc, '+00:00', '+00:00') as london_time,
    CONVERT_TZ(start_time_utc, '+00:00', '-05:00') as new_york_time,
    CONVERT_TZ(start_time_utc, '+00:00', '-08:00') as los_angeles_time,
    
    -- 结束时间计算
    ADDTIME(start_time_utc, SEC_TO_TIME(duration_minutes * 60)) as end_time_utc,
    
    -- 会议时长显示
    SEC_TO_TIME(duration_minutes * 60) as duration_display
    
FROM meetings 
WHERE DATE(start_time_utc) = CURDATE()
ORDER BY start_time_utc;

-- 寻找全球团队的最佳会议时间
SELECT 
    test_time,
    CONVERT_TZ(test_time, '+00:00', '+08:00') as beijing,
    CONVERT_TZ(test_time, '+00:00', '+00:00') as london,
    CONVERT_TZ(test_time, '+00:00', '-05:00') as new_york,
    
    -- 判断是否为工作时间
    CASE 
        WHEN HOUR(CONVERT_TZ(test_time, '+00:00', '+08:00')) BETWEEN 9 AND 18
         AND HOUR(CONVERT_TZ(test_time, '+00:00', '+00:00')) BETWEEN 9 AND 18  
         AND HOUR(CONVERT_TZ(test_time, '+00:00', '-05:00')) BETWEEN 9 AND 18
        THEN '✓ 全球工作时间'
        ELSE '✗ 部分非工作时间'
    END as feasibility
    
FROM (
    SELECT ADDTIME('2024-01-15 00:00:00', SEC_TO_TIME(hour * 3600)) as test_time
    FROM (SELECT 0 as hour UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
          UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9
          UNION SELECT 10 UNION SELECT 11 UNION SELECT 12 UNION SELECT 13 UNION SELECT 14
          UNION SELECT 15 UNION SELECT 16 UNION SELECT 17 UNION SELECT 18 UNION SELECT 19
          UNION SELECT 20 UNION SELECT 21 UNION SELECT 22 UNION SELECT 23) hours
) time_slots
ORDER BY test_time;
```

### 9.8 性能优化实践


#### 索引策略

```sql
-- 推荐的日期索引创建
-- 单列日期索引
CREATE INDEX idx_created_at ON orders(created_at);

-- 复合索引（状态+日期）
CREATE INDEX idx_status_date ON orders(status, order_date);

-- 函数索引（MySQL 8.0+）
CREATE INDEX idx_year_month ON sales((YEAR(sale_date)), (MONTH(sale_date)));
```

#### 查询优化对比

```sql
-- ❌ 低效查询（无法使用索引）
SELECT * FROM orders 
WHERE YEAR(order_date) = 2024 
  AND MONTH(order_date) = 1;

-- ✅ 高效查询（能够使用索引）
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-02-01';

-- ❌ 低效的日期函数查询
SELECT * FROM users 
WHERE DATE(created_at) = CURDATE();

-- ✅ 高效的范围查询
SELECT * FROM users 
WHERE created_at >= CURDATE() 
  AND created_at < DATE_ADD(CURDATE(), INTERVAL 1 DAY);
```

#### 批量操作优化

```sql
-- 批量更新过期状态
UPDATE subscriptions 
SET status = 'expired' 
WHERE expire_date < CURDATE() 
  AND status = 'active';

-- 使用临时表进行复杂时间计算
CREATE TEMPORARY TABLE date_ranges AS
SELECT 
    DATE_ADD('2024-01-01', INTERVAL n DAY) as date_value,
    DAYNAME(DATE_ADD('2024-01-01', INTERVAL n DAY)) as day_name,
    CASE WHEN DAYOFWEEK(DATE_ADD('2024-01-01', INTERVAL n DAY)) IN (1,7) 
         THEN 'weekend' ELSE 'weekday' END as day_type
FROM (
    SELECT a.n + b.n * 10 + c.n * 100 as n
    FROM (SELECT 0 as n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
          UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) a
    CROSS JOIN (SELECT 0 as n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3 UNION SELECT 4 
                UNION SELECT 5 UNION SELECT 6 UNION SELECT 7 UNION SELECT 8 UNION SELECT 9) b
    CROSS JOIN (SELECT 0 as n UNION SELECT 1 UNION SELECT 2 UNION SELECT 3) c
) numbers
WHERE n < 365;
```

### 9.9 常见问题解决方案


#### 时区问题处理

```sql
-- 检查当前时区设置
SELECT $$global.time_zone, $$session.time_zone;

-- 统一设置时区
SET time_zone = '+00:00';  -- 设置为UTC

-- 处理历史数据时区转换
UPDATE legacy_table 
SET utc_time = CONVERT_TZ(local_time, '+08:00', '+00:00')
WHERE utc_time IS NULL;
```

#### 日期格式兼容性

```sql
-- 处理不同格式的日期字符串
SELECT 
    original_date,
    CASE 
        WHEN original_date REGEXP '^[0-9]{4}-[0-9]{2}-[0-9]{2} 
        THEN STR_TO_DATE(original_date, '%Y-%m-%d')
        WHEN original_date REGEXP '^[0-9]{2}/[0-9]{2}/[0-9]{4} 
        THEN STR_TO_DATE(original_date, '%m/%d/%Y')
        WHEN original_date REGEXP '^[0-9]{2}-[0-9]{2}-[0-9]{4} 
        THEN STR_TO_DATE(original_date, '%m-%d-%Y')
    END as standardized_date
FROM import_data;
```

#### 性能监控查询

```sql
-- 监控慢查询中的日期函数使用
SELECT 
    DIGEST_TEXT,
    COUNT_STAR,
    AVG_TIMER_WAIT / 1000000000000 as avg_seconds
FROM performance_schema.events_statements_summary_by_digest 
WHERE DIGEST_TEXT LIKE '%DATE%' 
   OR DIGEST_TEXT LIKE '%TIME%'
ORDER BY AVG_TIMER_WAIT DESC
LIMIT 10;
```

**学习总结要点**：
- 日期函数是MySQL中最实用的功能之一
- 掌握核心函数比记住所有函数更重要  
- 性能优化和索引策略同样关键
- 时区处理是全球化应用的必备技能
- 实际项目中的综合应用才是最终目标

> **最终建议**：先熟练掌握常用的20个核心函数，再根据实际需求学习其他专门函数。记住：理解概念比死记语法更重要，实践应用比纸上谈兵更有价值。