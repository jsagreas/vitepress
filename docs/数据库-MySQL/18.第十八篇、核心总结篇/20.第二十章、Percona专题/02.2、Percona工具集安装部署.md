---
title: 2ã€Perconaå·¥å…·é›†å®‰è£…éƒ¨ç½²
---
## ğŸ“š ç›®å½•

1. [Perconaå·¥å…·é›†æ¦‚è¿°](#1-perconaå·¥å…·é›†æ¦‚è¿°)
2. [ç³»ç»Ÿç¯å¢ƒè¦æ±‚æ£€æŸ¥](#2-ç³»ç»Ÿç¯å¢ƒè¦æ±‚æ£€æŸ¥)
3. [åŒ…ç®¡ç†å™¨å®‰è£…æ–¹å¼](#3-åŒ…ç®¡ç†å™¨å®‰è£…æ–¹å¼)
4. [æºç ç¼–è¯‘å®‰è£…](#4-æºç ç¼–è¯‘å®‰è£…)
5. [Dockerå®¹å™¨åŒ–éƒ¨ç½²](#5-dockerå®¹å™¨åŒ–éƒ¨ç½²)
6. [ä¾èµ–åŒ…ç®¡ç†](#6-ä¾èµ–åŒ…ç®¡ç†)
7. [å®‰è£…éªŒè¯æµ‹è¯•](#7-å®‰è£…éªŒè¯æµ‹è¯•)
8. [å¤šç‰ˆæœ¬å¹¶å­˜ç®¡ç†](#8-å¤šç‰ˆæœ¬å¹¶å­˜ç®¡ç†)
9. [æƒé™é…ç½®è¦æ±‚](#9-æƒé™é…ç½®è¦æ±‚)
10. [å®‰è£…æ•…éšœæ’æŸ¥](#10-å®‰è£…æ•…éšœæ’æŸ¥)
11. [å‡çº§è¿ç§»ç­–ç•¥](#11-å‡çº§è¿ç§»ç­–ç•¥)
12. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#12-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ Perconaå·¥å…·é›†æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Perconaå·¥å…·é›†


**é€šä¿—è§£é‡Š**ï¼šPerconaå·¥å…·é›†å°±åƒæ˜¯MySQLæ•°æ®åº“çš„"ç‘å£«å†›åˆ€"ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šå®ç”¨çš„å°å·¥å…·ï¼Œå¸®ä½ ç®¡ç†ã€ç›‘æ§ã€å¤‡ä»½ã€æ¢å¤MySQLæ•°æ®åº“ã€‚

```
ç®€å•ç±»æ¯”ï¼š
å¦‚æœMySQLæ˜¯ä¸€è¾†æ±½è½¦ï¼Œé‚£ä¹ˆPerconaå·¥å…·é›†å°±æ˜¯ï¼š
ğŸ”§ ä¿®è½¦å·¥å…·ç®± - å„ç§ä¸“ä¸šå·¥å…·
ğŸ“Š ä»ªè¡¨ç›˜ - ç›‘æ§æ±½è½¦çŠ¶æ€  
ğŸ›¡ï¸ ä¿é™©ç®± - å¤‡ä»½é‡è¦æ•°æ®
âš¡ è°ƒè¯•å™¨ - ä¼˜åŒ–æ€§èƒ½é—®é¢˜
```

**æ ¸å¿ƒå·¥å…·ä»‹ç»**ï¼š
```
ä¸»è¦å·¥å…·åŒ…å«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Percona Toolkit (pt-*å·¥å…·)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ pt-query-digest  æŸ¥è¯¢åˆ†æ         â”‚
â”‚ â€¢ pt-online-schema-change åœ¨çº¿DDL   â”‚
â”‚ â€¢ pt-table-checksum æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥  â”‚
â”‚ â€¢ pt-archiver æ•°æ®å½’æ¡£              â”‚
â”‚ â€¢ pt-duplicate-key-finder é‡å¤ç´¢å¼•  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Percona XtraBackup ç‰©ç†å¤‡ä»½å·¥å…·     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ çƒ­å¤‡ä»½ - ä¸åœæœåŠ¡å¤‡ä»½æ•°æ®         â”‚
â”‚ â€¢ å¢é‡å¤‡ä»½ - åªå¤‡ä»½å˜åŒ–çš„éƒ¨åˆ†       â”‚
â”‚ â€¢ å‹ç¼©å¤‡ä»½ - èŠ‚çœå­˜å‚¨ç©ºé—´           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Percona Monitoring and Management   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ PMM Server ç›‘æ§æœåŠ¡ç«¯             â”‚
â”‚ â€¢ PMM Client ç›‘æ§å®¢æˆ·ç«¯             â”‚
â”‚ â€¢ å›¾å½¢åŒ–ç›‘æ§ç•Œé¢                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸ºä»€ä¹ˆé€‰æ‹©Perconaå·¥å…·é›†


**è§£å†³çš„æ ¸å¿ƒé—®é¢˜**ï¼š
```
ğŸ”¸ MySQLåŸç”Ÿå·¥å…·ä¸å¤Ÿç”¨
â€¢ åŸç”Ÿmysqldumpå¤‡ä»½æ…¢ã€é”è¡¨æ—¶é—´é•¿
â€¢ ç¼ºå°‘ä¸“ä¸šçš„æ€§èƒ½åˆ†æå·¥å…·
â€¢ åœ¨çº¿è¡¨ç»“æ„å˜æ›´å›°éš¾

ğŸ”¸ ç¬¬ä¸‰æ–¹å·¥å…·åˆ†æ•£ä¸”è´¨é‡å‚å·®ä¸é½
â€¢ éœ€è¦ä»ä¸åŒåœ°æ–¹ä¸‹è½½ä¸åŒå·¥å…·
â€¢ å…¼å®¹æ€§å’Œç¨³å®šæ€§éš¾ä»¥ä¿è¯
â€¢ å­¦ä¹ æˆæœ¬é«˜

ğŸ”¸ Perconaå·¥å…·é›†çš„ä¼˜åŠ¿
â€¢ ä¸“ä¸šå›¢é˜Ÿå¼€å‘ï¼Œè´¨é‡æœ‰ä¿è¯
â€¢ å·¥å…·é›†æˆåº¦é«˜ï¼Œé…åˆä½¿ç”¨æ•ˆæœå¥½
â€¢ å¼€æºå…è´¹ï¼Œç¤¾åŒºæ´»è·ƒ
â€¢ æ–‡æ¡£å®Œå–„ï¼Œå­¦ä¹ èµ„æºä¸°å¯Œ
```

---

## 2. ğŸ’» ç³»ç»Ÿç¯å¢ƒè¦æ±‚æ£€æŸ¥


### 2.1 æ“ä½œç³»ç»Ÿæ”¯æŒæƒ…å†µ


**æ”¯æŒçš„æ“ä½œç³»ç»Ÿ**ï¼š
```
Linuxå‘è¡Œç‰ˆæ”¯æŒæƒ…å†µï¼š
âœ… CentOS/RHEL 7/8/9
âœ… Ubuntu 18.04/20.04/22.04 LTS
âœ… Debian 9/10/11
âœ… SUSE Linux Enterprise 12/15
âœ… Amazon Linux 2

Windowsæ”¯æŒï¼š
âš ï¸  éƒ¨åˆ†å·¥å…·æ”¯æŒï¼ˆä¸»è¦æ˜¯Percona Toolkitï¼‰
âŒ XtraBackupä¸æ”¯æŒWindows

macOSæ”¯æŒï¼š
âœ… é€šè¿‡Homebrewå®‰è£…éƒ¨åˆ†å·¥å…·
âš ï¸  ä¸»è¦ç”¨äºå¼€å‘ç¯å¢ƒ
```

### 2.2 ç¡¬ä»¶èµ„æºè¦æ±‚


**æœ€ä½é…ç½®è¦æ±‚**ï¼š
```
CPUè¦æ±‚ï¼š
â€¢ æœ€ä½ï¼š1æ ¸å¿ƒ
â€¢ æ¨èï¼š2æ ¸å¿ƒä»¥ä¸Š
â€¢ è¯´æ˜ï¼šæŸäº›å·¥å…·ï¼ˆå¦‚å¤‡ä»½ï¼‰ä¼šæ¶ˆè€—è¾ƒå¤šCPU

å†…å­˜è¦æ±‚ï¼š
â€¢ æœ€ä½ï¼š512MBå¯ç”¨å†…å­˜
â€¢ æ¨èï¼š2GBä»¥ä¸Š
â€¢ è¯´æ˜ï¼šå¤§æ•°æ®é‡æ“ä½œéœ€è¦æ›´å¤šå†…å­˜

ç£ç›˜ç©ºé—´ï¼š
â€¢ å·¥å…·æœ¬èº«ï¼šçº¦100MB
â€¢ å·¥ä½œç©ºé—´ï¼šæ ¹æ®æ•°æ®é‡å†³å®š
â€¢ å¤‡ä»½ç©ºé—´ï¼šè‡³å°‘æ˜¯æ•°æ®åº“å¤§å°çš„1.5å€
```

### 2.3 ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥è„šæœ¬


**ä¸€é”®æ£€æŸ¥è„šæœ¬**ï¼š
```bash
#!/bin/bash
# Perconaå·¥å…·é›†ç¯å¢ƒæ£€æŸ¥è„šæœ¬

echo "=== Perconaå·¥å…·é›†ç¯å¢ƒæ£€æŸ¥ ==="

# æ£€æŸ¥æ“ä½œç³»ç»Ÿ
echo "1. æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼š"
cat /etc/os-release | grep -E "^(ID|VERSION_ID)="

# æ£€æŸ¥ç³»ç»Ÿæ¶æ„
echo -e "\n2. ç³»ç»Ÿæ¶æ„ï¼š"
uname -m

# æ£€æŸ¥å¯ç”¨å†…å­˜
echo -e "\n3. å†…å­˜ä¿¡æ¯ï¼š"
free -h

# æ£€æŸ¥ç£ç›˜ç©ºé—´
echo -e "\n4. ç£ç›˜ç©ºé—´ï¼š"
df -h

# æ£€æŸ¥ç½‘ç»œè¿æ¥
echo -e "\n5. ç½‘ç»œè¿æ¥æµ‹è¯•ï¼š"
ping -c 2 repo.percona.com > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… ç½‘ç»œè¿æ¥æ­£å¸¸"
else
    echo "âŒ æ— æ³•è¿æ¥Perconaå®˜æ–¹æº"
fi

# æ£€æŸ¥å¿…è¦çš„ä¾èµ–
echo -e "\n6. ç³»ç»Ÿä¾èµ–æ£€æŸ¥ï¼š"
for cmd in wget curl perl python3; do
    if command -v $cmd >/dev/null 2>&1; then
        echo "âœ… $cmd å·²å®‰è£…"
    else
        echo "âŒ $cmd æœªå®‰è£…"
    fi
done
```

---

## 3. ğŸ“¦ åŒ…ç®¡ç†å™¨å®‰è£…æ–¹å¼


### 3.1 é…ç½®Perconaå®˜æ–¹æº


**ä»€ä¹ˆæ˜¯è½¯ä»¶æº**ï¼š
> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šè½¯ä»¶æºå°±åƒæ˜¯ä¸€ä¸ª"åº”ç”¨å•†åº—"ï¼Œé‡Œé¢å­˜æ”¾ç€å„ç§è½¯ä»¶åŒ…ã€‚é…ç½®äº†Perconaå®˜æ–¹æºåï¼Œä½ å°±å¯ä»¥åƒå®‰è£…å…¶ä»–è½¯ä»¶ä¸€æ ·ï¼Œç›´æ¥ç”¨`yum`æˆ–`apt`å‘½ä»¤å®‰è£…Perconaå·¥å…·äº†ã€‚

**CentOS/RHELç³»ç»Ÿé…ç½®**ï¼š
```bash
# 1. å®‰è£…Perconaå®˜æ–¹æº
sudo yum install -y https://repo.percona.com/yum/percona-release-latest.noarch.rpm

# 2. å¯ç”¨æ‰€éœ€çš„ä»“åº“
sudo percona-release enable-only tools release

# 3. æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•
sudo yum update
```

**Ubuntu/Debianç³»ç»Ÿé…ç½®**ï¼š
```bash
# 1. å®‰è£…å¿…è¦çš„ä¾èµ–
sudo apt-get update
sudo apt-get install -y wget gnupg2 lsb-release curl

# 2. æ·»åŠ Percona GPGå¯†é’¥
wget https://repo.percona.com/apt/percona-release_latest.generic_all.deb
sudo dpkg -i percona-release_latest.generic_all.deb

# 3. å¯ç”¨å·¥å…·ä»“åº“
sudo percona-release enable-only tools release

# 4. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt-get update
```

### 3.2 å®‰è£…æ ¸å¿ƒå·¥å…·åŒ…


**å®‰è£…Percona Toolkit**ï¼š
```bash
# CentOS/RHELç³»ç»Ÿ
sudo yum install -y percona-toolkit

# Ubuntu/Debianç³»ç»Ÿ  
sudo apt-get install -y percona-toolkit

# éªŒè¯å®‰è£…
pt-summary --version
```

**å®‰è£…XtraBackup**ï¼š
```bash
# CentOS/RHELç³»ç»Ÿ
sudo yum install -y percona-xtrabackup-80

# Ubuntu/Debianç³»ç»Ÿ
sudo apt-get install -y percona-xtrabackup-80

# éªŒè¯å®‰è£…
xtrabackup --version
```

**ç‰ˆæœ¬é€‰æ‹©è¯´æ˜**ï¼š
```
XtraBackupç‰ˆæœ¬å¯¹åº”å…³ç³»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQLç‰ˆæœ¬       â”‚ XtraBackupç‰ˆæœ¬   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MySQL 5.7       â”‚ XtraBackup 2.4  â”‚
â”‚ MySQL 8.0       â”‚ XtraBackup 8.0  â”‚
â”‚ Percona Server  â”‚ å¯¹åº”ç‰ˆæœ¬        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®‰è£…å‘½ä»¤ç¤ºä¾‹ï¼š
# MySQL 5.7ç”¨æˆ·
sudo yum install percona-xtrabackup-24

# MySQL 8.0ç”¨æˆ·  
sudo yum install percona-xtrabackup-80
```

### 3.3 ä¸€é”®å®‰è£…è„šæœ¬


**å®Œæ•´å®‰è£…è„šæœ¬**ï¼š
```bash
#!/bin/bash
# Perconaå·¥å…·é›†ä¸€é”®å®‰è£…è„šæœ¬

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

# æ£€æµ‹æ“ä½œç³»ç»Ÿ
if [ -f /etc/redhat-release ]; then
    OS="centos"
elif [ -f /etc/debian_version ]; then
    OS="ubuntu"
else
    echo "âŒ ä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿ"
    exit 1
fi

echo "æ£€æµ‹åˆ°æ“ä½œç³»ç»Ÿ: $OS"

# å®‰è£…å‡½æ•°
install_centos() {
    echo "ğŸ”§ é…ç½®CentOS/RHELç¯å¢ƒ..."
    sudo yum install -y wget
    wget https://repo.percona.com/yum/percona-release-latest.noarch.rpm
    sudo yum install -y percona-release-latest.noarch.rpm
    sudo percona-release enable-only tools release
    sudo yum update -y
    
    echo "ğŸ“¦ å®‰è£…Perconaå·¥å…·..."
    sudo yum install -y percona-toolkit percona-xtrabackup-80
}

install_ubuntu() {
    echo "ğŸ”§ é…ç½®Ubuntu/Debianç¯å¢ƒ..."
    sudo apt-get update
    sudo apt-get install -y wget gnupg2 lsb-release
    wget https://repo.percona.com/apt/percona-release_latest.generic_all.deb
    sudo dpkg -i percona-release_latest.generic_all.deb
    sudo percona-release enable-only tools release
    sudo apt-get update
    
    echo "ğŸ“¦ å®‰è£…Perconaå·¥å…·..."
    sudo apt-get install -y percona-toolkit percona-xtrabackup-80
}

# æ ¹æ®ç³»ç»Ÿç±»å‹å®‰è£…
if [ "$OS" = "centos" ]; then
    install_centos
elif [ "$OS" = "ubuntu" ]; then
    install_ubuntu
fi

echo "âœ… å®‰è£…å®Œæˆï¼"
echo "ğŸ” éªŒè¯å®‰è£…ï¼š"
pt-summary --version
xtrabackup --version
```

---

## 4. ğŸ› ï¸ æºç ç¼–è¯‘å®‰è£…


### 4.1 ä»€ä¹ˆæ—¶å€™éœ€è¦æºç ç¼–è¯‘


**éœ€è¦ç¼–è¯‘å®‰è£…çš„åœºæ™¯**ï¼š
```
ğŸ”¸ å®˜æ–¹æ²¡æœ‰é€‚é…ä½ çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬
ğŸ”¸ éœ€è¦è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹
ğŸ”¸ éœ€è¦æœ€æ–°çš„å¼€å‘ç‰ˆæœ¬åŠŸèƒ½
ğŸ”¸ å¯¹å®‰å…¨æ€§æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆè‡ªå·±ç¼–è¯‘æ›´æ”¾å¿ƒï¼‰
ğŸ”¸ åµŒå…¥å¼ç³»ç»Ÿæˆ–ç‰¹æ®Šæ¶æ„
```

> âš ï¸ **æ³¨æ„**ï¼šæºç ç¼–è¯‘æ¯”è¾ƒå¤æ‚ï¼Œæ–°æ‰‹å»ºè®®ä¼˜å…ˆä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…ã€‚åªæœ‰åœ¨åŒ…ç®¡ç†å™¨æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæ‰è€ƒè™‘æºç ç¼–è¯‘ã€‚

### 4.2 ç¼–è¯‘ç¯å¢ƒå‡†å¤‡


**å®‰è£…ç¼–è¯‘ä¾èµ–**ï¼š
```bash
# CentOS/RHELç³»ç»Ÿ
sudo yum groupinstall -y "Development Tools"
sudo yum install -y perl-DBI perl-DBD-MySQL perl-Time-HiRes \
                     perl-IO-Socket-SSL cmake gcc-c++ \
                     openssl-devel zlib-devel

# Ubuntu/Debianç³»ç»Ÿ
sudo apt-get update
sudo apt-get install -y build-essential cmake \
                         libdbi-perl libdbd-mysql-perl \
                         libssl-dev zlib1g-dev \
                         libgcrypt20-dev
```

### 4.3 ç¼–è¯‘Percona Toolkit


**ä¸‹è½½å’Œç¼–è¯‘æ­¥éª¤**ï¼š
```bash
# 1. ä¸‹è½½æºç 
cd /tmp
wget https://github.com/percona/percona-toolkit/archive/v3.5.0.tar.gz
tar -xzf v3.5.0.tar.gz
cd percona-toolkit-3.5.0

# 2. æ£€æŸ¥ä¾èµ–
perl Makefile.PL

# 3. ç¼–è¯‘å’Œå®‰è£…
make
sudo make install

# 4. éªŒè¯å®‰è£…
pt-summary --version
```

### 4.4 ç¼–è¯‘XtraBackup


**ç¼–è¯‘XtraBackupæ¯”è¾ƒå¤æ‚**ï¼š
```bash
# 1. å…‹éš†æºç ä»“åº“
git clone https://github.com/percona/percona-xtrabackup.git
cd percona-xtrabackup

# 2. åˆ›å»ºç¼–è¯‘ç›®å½•
mkdir build
cd build

# 3. é…ç½®ç¼–è¯‘é€‰é¡¹
cmake .. -DBUILD_CONFIG=xtrabackup_release \
         -DCMAKE_INSTALL_PREFIX=/usr/local/xtrabackup

# 4. ç¼–è¯‘ï¼ˆè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ï¼‰
make -j$(nproc)

# 5. å®‰è£…
sudo make install

# 6. æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„
echo 'export PATH=/usr/local/xtrabackup/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

---

## 5. ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²


### 5.1 ä¸ºä»€ä¹ˆé€‰æ‹©Dockeréƒ¨ç½²


**Dockeréƒ¨ç½²çš„ä¼˜åŠ¿**ï¼š
```
ğŸ”¸ ç¯å¢ƒéš”ç¦» - ä¸ä¼šæ±¡æŸ“å®¿ä¸»æœºç³»ç»Ÿ
ğŸ”¸ å¿«é€Ÿéƒ¨ç½² - å‡ åˆ†é’Ÿå°±èƒ½æ­å»ºå®Œæ•´ç¯å¢ƒ  
ğŸ”¸ ç‰ˆæœ¬ç®¡ç† - å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªç‰ˆæœ¬
ğŸ”¸ æ˜“äºè¿ç§» - æ‰“åŒ…å¥½çš„ç¯å¢ƒåˆ°å¤„å¯ç”¨
ğŸ”¸ èµ„æºæ§åˆ¶ - å¯ä»¥é™åˆ¶CPUå’Œå†…å­˜ä½¿ç”¨
```

> ğŸ’¡ **é€‚ç”¨åœºæ™¯**ï¼šå¼€å‘æµ‹è¯•ç¯å¢ƒã€ä¸´æ—¶ä½¿ç”¨ã€å­¦ä¹ ç»ƒä¹ ã€å¤šç‰ˆæœ¬æµ‹è¯•

### 5.2 åŸºç¡€é•œåƒå‡†å¤‡


**åˆ›å»ºè‡ªå®šä¹‰Dockerfile**ï¼š
```dockerfile
# åŸºäºå®˜æ–¹CentOSé•œåƒ
FROM centos:8

# è®¾ç½®ç»´æŠ¤è€…ä¿¡æ¯
LABEL maintainer="your-email@example.com"

# å®‰è£…åŸºç¡€ä¾èµ–
RUN dnf update -y && \
    dnf install -y wget perl-DBI perl-DBD-MySQL && \
    dnf clean all

# å®‰è£…Perconaå®˜æ–¹æº
RUN wget https://repo.percona.com/yum/percona-release-latest.noarch.rpm && \
    rpm -ivh percona-release-latest.noarch.rpm && \
    percona-release enable-only tools release

# å®‰è£…Perconaå·¥å…·é›†
RUN dnf install -y percona-toolkit percona-xtrabackup-80

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /workspace

# å¯åŠ¨åä¿æŒå®¹å™¨è¿è¡Œ
CMD ["tail", "-f", "/dev/null"]
```

**æ„å»ºå’Œè¿è¡Œå®¹å™¨**ï¼š
```bash
# 1. æ„å»ºé•œåƒ
docker build -t percona-tools:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d --name percona-tools \
    -v /var/lib/mysql:/var/lib/mysql:ro \
    -v /backup:/backup \
    percona-tools:latest

# 3. è¿›å…¥å®¹å™¨ä½¿ç”¨å·¥å…·
docker exec -it percona-tools bash
```

### 5.3 Docker Composeéƒ¨ç½²


**åˆ›å»ºdocker-compose.yml**ï¼š
```yaml
version: '3.8'

services:
  # MySQLæœåŠ¡ï¼ˆç”¨äºæµ‹è¯•ï¼‰
  mysql:
    image: mysql:8.0
    container_name: mysql-test
    environment:
      MYSQL_ROOT_PASSWORD: password123
      MYSQL_DATABASE: testdb
    volumes:
      - mysql_data:/var/lib/mysql
    ports:
      - "3306:3306"
    networks:
      - percona-net

  # Perconaå·¥å…·å®¹å™¨
  percona-tools:
    build: .
    container_name: percona-tools
    volumes:
      - mysql_data:/var/lib/mysql:ro
      - ./backup:/backup
      - ./scripts:/scripts
    depends_on:
      - mysql
    networks:
      - percona-net

volumes:
  mysql_data:

networks:
  percona-net:
    driver: bridge
```

**ä¸€é”®å¯åŠ¨ç¯å¢ƒ**ï¼š
```bash
# å¯åŠ¨æ•´ä¸ªç¯å¢ƒ
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€  
docker-compose ps

# è¿›å…¥å·¥å…·å®¹å™¨
docker-compose exec percona-tools bash

# åœæ­¢ç¯å¢ƒ
docker-compose down
```

---

## 6. ğŸ“‹ ä¾èµ–åŒ…ç®¡ç†


### 6.1 æ ¸å¿ƒä¾èµ–è¯´æ˜


**Perlä¾èµ–æ¨¡å—**ï¼š
```
Percona Toolkitä¸»è¦ä¾èµ–Perlæ¨¡å—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—åç§°         â”‚ ä½œç”¨è¯´æ˜                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DBI              â”‚ æ•°æ®åº“è¿æ¥æ¥å£          â”‚
â”‚ DBD::mysql       â”‚ MySQLæ•°æ®åº“é©±åŠ¨         â”‚
â”‚ Time::HiRes      â”‚ é«˜ç²¾åº¦æ—¶é—´å‡½æ•°          â”‚
â”‚ Digest::MD5      â”‚ MD5å“ˆå¸Œè®¡ç®—             â”‚
â”‚ IO::Socket::SSL  â”‚ SSLè¿æ¥æ”¯æŒ             â”‚
â”‚ Term::ReadKey    â”‚ å¯†ç è¾“å…¥éšè—            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç³»ç»Ÿåº“ä¾èµ–**ï¼š
```
XtraBackupéœ€è¦çš„ç³»ç»Ÿåº“ï¼š
â€¢ libssl - SSL/TLSåŠ å¯†æ”¯æŒ
â€¢ zlib - æ•°æ®å‹ç¼©æ”¯æŒ  
â€¢ libgcrypt - åŠ å¯†ç®—æ³•åº“
â€¢ libaio - å¼‚æ­¥IOæ”¯æŒï¼ˆLinuxï¼‰
```

### 6.2 ä¾èµ–æ£€æŸ¥å’Œå®‰è£…


**æ£€æŸ¥Perlæ¨¡å—è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ£€æŸ¥Percona Toolkitä¾èµ–çš„Perlæ¨¡å—

echo "æ£€æŸ¥Perlæ¨¡å—ä¾èµ–..."

modules=(
    "DBI"
    "DBD::mysql" 
    "Time::HiRes"
    "Digest::MD5"
    "IO::Socket::SSL"
    "Term::ReadKey"
)

for module in "${modules[@]}"; do
    if perl -M"$module" -e 1 2>/dev/null; then
        echo "âœ… $module - å·²å®‰è£…"
    else
        echo "âŒ $module - æœªå®‰è£…"
        echo "   å®‰è£…å‘½ä»¤: sudo cpan install $module"
    fi
done
```

**ä½¿ç”¨CPANå®‰è£…ç¼ºå¤±æ¨¡å—**ï¼š
```bash
# é…ç½®CPANï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
sudo cpan

# åœ¨CPAN shellä¸­å®‰è£…æ¨¡å—
cpan> install DBI
cpan> install DBD::mysql
cpan> install Time::HiRes

# æˆ–è€…ç›´æ¥å‘½ä»¤è¡Œå®‰è£…
sudo cpan install DBI DBD::mysql Time::HiRes
```

### 6.3 ä¾èµ–é—®é¢˜è§£å†³


**å¸¸è§ä¾èµ–é—®é¢˜**ï¼š
```
é—®é¢˜1ï¼šDBD::mysqlå®‰è£…å¤±è´¥
åŸå› ï¼šç¼ºå°‘MySQLå¼€å‘åŒ…
è§£å†³ï¼šsudo yum install mysql-devel
     sudo apt-get install libmysqlclient-dev

é—®é¢˜2ï¼šSSLæ¨¡å—å®‰è£…å¤±è´¥  
åŸå› ï¼šç¼ºå°‘OpenSSLå¼€å‘åŒ…
è§£å†³ï¼šsudo yum install openssl-devel
     sudo apt-get install libssl-dev

é—®é¢˜3ï¼šæƒé™ä¸è¶³
åŸå› ï¼šç³»ç»Ÿè·¯å¾„å†™å…¥æƒé™é—®é¢˜
è§£å†³ï¼šä½¿ç”¨sudoæˆ–é…ç½®ç”¨æˆ·çº§åˆ«çš„Perlåº“è·¯å¾„
```

---

## 7. âœ… å®‰è£…éªŒè¯æµ‹è¯•


### 7.1 åŸºç¡€åŠŸèƒ½éªŒè¯


**éªŒè¯Percona Toolkit**ï¼š
```bash
# 1. æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯
pt-summary --version

# 2. æ£€æŸ¥æ‰€æœ‰å·¥å…·æ˜¯å¦å¯ç”¨
for tool in pt-summary pt-query-digest pt-table-checksum pt-online-schema-change; do
    if command -v $tool >/dev/null 2>&1; then
        echo "âœ… $tool - å¯ç”¨"
    else
        echo "âŒ $tool - ä¸å¯ç”¨"
    fi
done

# 3. ç®€å•åŠŸèƒ½æµ‹è¯•
pt-summary
```

**éªŒè¯XtraBackup**ï¼š
```bash
# 1. æ£€æŸ¥ç‰ˆæœ¬
xtrabackup --version

# 2. æ£€æŸ¥å¸®åŠ©ä¿¡æ¯
xtrabackup --help | head -10

# 3. æ£€æŸ¥æ”¯æŒçš„å­˜å‚¨å¼•æ“
xtrabackup --print-defaults
```

### 7.2 è¿æ¥æ•°æ®åº“æµ‹è¯•


**åˆ›å»ºæµ‹è¯•è„šæœ¬**ï¼š
```bash
#!/bin/bash
# æ•°æ®åº“è¿æ¥æµ‹è¯•è„šæœ¬

# æ•°æ®åº“è¿æ¥å‚æ•°
DB_HOST="localhost"
DB_PORT="3306"  
DB_USER="root"
DB_PASS="your_password"

echo "=== æ•°æ®åº“è¿æ¥æµ‹è¯• ==="

# æµ‹è¯•pt-summaryè¿æ¥æ•°æ®åº“
echo "1. æµ‹è¯•pt-summaryè¿æ¥ï¼š"
pt-summary --host=$DB_HOST --port=$DB_PORT --user=$DB_USER --password=$DB_PASS

# æµ‹è¯•xtrabackupè¿æ¥
echo -e "\n2. æµ‹è¯•xtrabackupè¿æ¥ï¼š"
xtrabackup --backup --target-dir=/tmp/test_backup \
           --host=$DB_HOST --port=$DB_PORT \
           --user=$DB_USER --password=$DB_PASS \
           --databases=mysql --dry-run

echo -e "\nâœ… è¿æ¥æµ‹è¯•å®Œæˆ"
```

### 7.3 å®Œæ•´æ€§éªŒè¯æ¸…å•


**éªŒè¯æ¸…å•**ï¼š
```markdown
å®‰è£…éªŒè¯æ¸…å•ï¼š

â–¡ è½¯ä»¶ç‰ˆæœ¬æ£€æŸ¥
  â–¡ pt-summary --version æ­£å¸¸è¾“å‡º
  â–¡ xtrabackup --version æ­£å¸¸è¾“å‡º
  
â–¡ åŸºç¡€åŠŸèƒ½æµ‹è¯•  
  â–¡ pt-summary èƒ½å¤Ÿæ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
  â–¡ pt-query-digest èƒ½å¤Ÿè§£ææ…¢æŸ¥è¯¢æ—¥å¿—
  â–¡ xtrabackup èƒ½å¤Ÿè¿æ¥æ•°æ®åº“
  
â–¡ æ•°æ®åº“è¿æ¥æµ‹è¯•
  â–¡ èƒ½å¤Ÿè¿æ¥æœ¬åœ°MySQL
  â–¡ èƒ½å¤Ÿè¿æ¥è¿œç¨‹MySQL
  â–¡ SSLè¿æ¥æµ‹è¯•ï¼ˆå¦‚æœéœ€è¦ï¼‰
  
â–¡ æƒé™éªŒè¯
  â–¡ æ™®é€šç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨å·¥å…·
  â–¡ å¤‡ä»½ç”¨æˆ·æƒé™é…ç½®æ­£ç¡®
  
â–¡ ä¾èµ–å®Œæ•´æ€§
  â–¡ æ‰€æœ‰Perlæ¨¡å—æ­£å¸¸åŠ è½½
  â–¡ ç³»ç»Ÿåº“é“¾æ¥æ­£ç¡®
```

---

## 8. ğŸ”„ å¤šç‰ˆæœ¬å¹¶å­˜ç®¡ç†


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦å¤šç‰ˆæœ¬ç®¡ç†


**å¤šç‰ˆæœ¬åœºæ™¯**ï¼š
```
ğŸ”¸ ä¸åŒé¡¹ç›®éœ€è¦ä¸åŒç‰ˆæœ¬
ğŸ”¸ æ–°ç‰ˆæœ¬æµ‹è¯•æœŸé—´ä¿ç•™æ—§ç‰ˆæœ¬
ğŸ”¸ å…¼å®¹æ€§æµ‹è¯•éœ€æ±‚
ğŸ”¸ æ¸è¿›å¼å‡çº§ç­–ç•¥
```

### 8.2 ç›®å½•éš”ç¦»æ–¹å¼


**æ‰‹åŠ¨ç›®å½•ç®¡ç†**ï¼š
```bash
# åˆ›å»ºç‰ˆæœ¬ç›®å½•ç»“æ„
sudo mkdir -p /opt/percona/{3.4.0,3.5.0}

# å®‰è£…ä¸åŒç‰ˆæœ¬åˆ°æŒ‡å®šç›®å½•
# ç‰ˆæœ¬3.4.0
./configure --prefix=/opt/percona/3.4.0
make && sudo make install

# ç‰ˆæœ¬3.5.0  
./configure --prefix=/opt/percona/3.5.0
make && sudo make install

# åˆ›å»ºè½¯é“¾æ¥åˆ‡æ¢ç‰ˆæœ¬
sudo ln -sf /opt/percona/3.5.0 /opt/percona/current
export PATH=/opt/percona/current/bin:$PATH
```

### 8.3 ç¯å¢ƒå˜é‡ç®¡ç†


**ç‰ˆæœ¬åˆ‡æ¢è„šæœ¬**ï¼š
```bash
#!/bin/bash
# Perconaå·¥å…·ç‰ˆæœ¬åˆ‡æ¢è„šæœ¬

PERCONA_HOME="/opt/percona"

# æ˜¾ç¤ºå¯ç”¨ç‰ˆæœ¬
list_versions() {
    echo "å¯ç”¨çš„Perconaç‰ˆæœ¬ï¼š"
    ls -1 $PERCONA_HOME/ | grep -E "^[0-9]" | nl
}

# åˆ‡æ¢ç‰ˆæœ¬
switch_version() {
    local version=$1
    if [ -z "$version" ]; then
        echo "ç”¨æ³•: switch_version <ç‰ˆæœ¬å·>"
        list_versions
        return 1
    fi
    
    if [ -d "$PERCONA_HOME/$version" ]; then
        sudo ln -sf "$PERCONA_HOME/$version" "$PERCONA_HOME/current"
        echo "å·²åˆ‡æ¢åˆ°ç‰ˆæœ¬: $version"
        echo "è¯·è¿è¡Œ: source ~/.bashrc"
    else
        echo "ç‰ˆæœ¬ $version ä¸å­˜åœ¨"
        list_versions
    fi
}

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ°~/.bashrcï¼‰
setup_env() {
    cat >> ~/.bashrc << 'EOF'
# Perconaå·¥å…·é›†ç¯å¢ƒå˜é‡
export PERCONA_HOME="/opt/percona"
export PATH="$PERCONA_HOME/current/bin:$PATH"
EOF
    echo "ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼Œè¯·è¿è¡Œ: source ~/.bashrc"
}

# ä¸»å‡½æ•°
case "$1" in
    "list")
        list_versions
        ;;
    "switch")
        switch_version $2
        ;;
    "setup")
        setup_env
        ;;
    *)
        echo "ç”¨æ³•: $0 {list|switch|setup}"
        echo "  list   - æ˜¾ç¤ºå¯ç”¨ç‰ˆæœ¬"
        echo "  switch - åˆ‡æ¢ç‰ˆæœ¬"
        echo "  setup  - è®¾ç½®ç¯å¢ƒå˜é‡"
        ;;
esac
```

### 8.4 Dockerå¤šç‰ˆæœ¬ç®¡ç†


**Dockeræ ‡ç­¾ç®¡ç†**ï¼š
```bash
# æ„å»ºä¸åŒç‰ˆæœ¬çš„é•œåƒ
docker build -t percona-tools:3.4.0 --build-arg VERSION=3.4.0 .
docker build -t percona-tools:3.5.0 --build-arg VERSION=3.5.0 .

# ä½¿ç”¨åˆ«ååˆ‡æ¢ç‰ˆæœ¬
alias pt34='docker run --rm -it percona-tools:3.4.0'
alias pt35='docker run --rm -it percona-tools:3.5.0'

# ä½¿ç”¨ç¤ºä¾‹
pt34 pt-summary --version
pt35 pt-summary --version
```

---

## 9. ğŸ” æƒé™é…ç½®è¦æ±‚


### 9.1 MySQLç”¨æˆ·æƒé™é…ç½®


**åˆ›å»ºä¸“ç”¨ç”¨æˆ·**ï¼š
```sql
-- åˆ›å»ºPerconaå·¥å…·ä¸“ç”¨ç”¨æˆ·
CREATE USER 'percona_user'@'localhost' IDENTIFIED BY 'strong_password';

-- åŸºç¡€æƒé™ï¼ˆé€‚ç”¨äºå¤§éƒ¨åˆ†å·¥å…·ï¼‰
GRANT SELECT, SHOW DATABASES, SHOW VIEW, PROCESS, REPLICATION CLIENT 
ON *.* TO 'percona_user'@'localhost';

-- å¤‡ä»½ä¸“ç”¨æƒé™ï¼ˆXtraBackupéœ€è¦ï¼‰
GRANT RELOAD, LOCK TABLES, REPLICATION CLIENT, CREATE TABLESPACE, 
PROCESS, SUPER, CREATE, INSERT, SELECT 
ON *.* TO 'percona_user'@'localhost';

-- åœ¨çº¿DDLæƒé™ï¼ˆpt-online-schema-changeéœ€è¦ï¼‰
GRANT ALTER, CREATE, DELETE, DROP, INDEX, INSERT, SELECT, UPDATE, 
TRIGGER ON database_name.* TO 'percona_user'@'localhost';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;
```

**æƒé™è¯´æ˜è¡¨**ï¼š
```
æƒé™è¯¦ç»†è¯´æ˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒé™åç§°        â”‚ ç”¨é€”è¯´æ˜                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT          â”‚ æŸ¥è¯¢æ•°æ®ï¼Œæ‰€æœ‰å·¥å…·éƒ½éœ€è¦     â”‚
â”‚ PROCESS         â”‚ æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼Œæ€§èƒ½åˆ†æéœ€è¦   â”‚
â”‚ REPLICATION     â”‚ è¯»å–binlogï¼Œå¤‡ä»½å’ŒåŒæ­¥éœ€è¦   â”‚
â”‚ CLIENT          â”‚                              â”‚
â”‚ RELOAD          â”‚ åˆ·æ–°æƒé™ï¼Œå¤‡ä»½æ—¶é”è¡¨éœ€è¦     â”‚
â”‚ LOCK TABLES     â”‚ é”å®šè¡¨ï¼Œä¸€è‡´æ€§å¤‡ä»½éœ€è¦       â”‚
â”‚ SUPER           â”‚ è¶…çº§ç”¨æˆ·æƒé™ï¼ŒæŸäº›æ“ä½œéœ€è¦   â”‚
â”‚ ALTER           â”‚ ä¿®æ”¹è¡¨ç»“æ„ï¼Œåœ¨çº¿DDLéœ€è¦      â”‚
â”‚ CREATE          â”‚ åˆ›å»ºå¯¹è±¡ï¼ŒæŸäº›å·¥å…·éœ€è¦       â”‚
â”‚ TRIGGER         â”‚ è§¦å‘å™¨æƒé™ï¼Œåœ¨çº¿DDLéœ€è¦      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ç³»ç»Ÿç”¨æˆ·æƒé™


**åˆ›å»ºç³»ç»Ÿç”¨æˆ·**ï¼š
```bash
# åˆ›å»ºä¸“ç”¨ç³»ç»Ÿç”¨æˆ·
sudo useradd -r -s /bin/bash -d /home/percona -m percona

# è®¾ç½®å¯†ç 
sudo passwd percona

# æ·»åŠ åˆ°mysqlç»„ï¼ˆå¦‚æœéœ€è¦è®¿é—®MySQLæ•°æ®æ–‡ä»¶ï¼‰
sudo usermod -a -G mysql percona

# é…ç½®sudoæƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
echo "percona ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart mysql" | \
sudo tee /etc/sudoers.d/percona
```

**æ–‡ä»¶æƒé™é…ç½®**ï¼š
```bash
# è®¾ç½®å¤‡ä»½ç›®å½•æƒé™
sudo mkdir -p /backup
sudo chown percona:percona /backup
sudo chmod 750 /backup

# è®¾ç½®é…ç½®æ–‡ä»¶æƒé™
sudo chmod 600 /home/percona/.my.cnf

# è®¾ç½®æ—¥å¿—ç›®å½•æƒé™
sudo mkdir -p /var/log/percona
sudo chown percona:percona /var/log/percona
```

### 9.3 å®‰å…¨é…ç½®æœ€ä½³å®è·µ


**é…ç½®æ–‡ä»¶å®‰å…¨**ï¼š
```bash
# åˆ›å»º.my.cnfæ–‡ä»¶å­˜å‚¨æ•°æ®åº“è¿æ¥ä¿¡æ¯
cat > /home/percona/.my.cnf << 'EOF'
[client]
user=percona_user
password=strong_password
host=localhost
port=3306

[mysql]
default-character-set=utf8mb4

[mysqldump]
single-transaction
routines
triggers
EOF

# è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 /home/percona/.my.cnf
```

**SSLè¿æ¥é…ç½®**ï¼š
```bash
# å¦‚æœä½¿ç”¨SSLè¿æ¥ï¼Œæ·»åŠ SSLé…ç½®
cat >> /home/percona/.my.cnf << 'EOF'

[client]
ssl-ca=/path/to/ca.pem
ssl-cert=/path/to/client-cert.pem  
ssl-key=/path/to/client-key.pem
EOF
```

---

## 10. ğŸš¨ å®‰è£…æ•…éšœæ’æŸ¥


### 10.1 å¸¸è§å®‰è£…é”™è¯¯


**ä¾èµ–åŒ…ç¼ºå¤±**ï¼š
```bash
# é”™è¯¯ä¿¡æ¯ç¤ºä¾‹
ERROR: Can't locate DBI.pm in @INC

# è§£å†³æ–¹æ³•
# CentOS/RHEL
sudo yum install perl-DBI perl-DBD-MySQL

# Ubuntu/Debian  
sudo apt-get install libdbi-perl libdbd-mysql-perl
```

**GPGå¯†é’¥éªŒè¯å¤±è´¥**ï¼š
```bash
# é”™è¯¯ä¿¡æ¯
GPG key retrieval failed

# è§£å†³æ–¹æ³•
# æ‰‹åŠ¨å¯¼å…¥GPGå¯†é’¥
wget https://repo.percona.com/apt/percona-release_latest.generic_all.deb
sudo dpkg -i percona-release_latest.generic_all.deb

# æˆ–è€…è·³è¿‡GPGéªŒè¯ï¼ˆä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
sudo yum install --nogpgcheck percona-toolkit
```

### 10.2 æƒé™ç›¸å…³é—®é¢˜


**æƒé™ä¸è¶³é”™è¯¯**ï¼š
```bash
# é”™è¯¯ä¿¡æ¯
Permission denied while trying to connect to MySQL

# æ£€æŸ¥æ­¥éª¤
1. ç¡®è®¤MySQLç”¨æˆ·æƒé™ï¼š
   SHOW GRANTS FOR 'percona_user'@'localhost';

2. æ£€æŸ¥è¿æ¥å‚æ•°ï¼š
   mysql -h localhost -u percona_user -p

3. æ£€æŸ¥é˜²ç«å¢™ï¼š
   sudo iptables -L | grep 3306
```

**æ–‡ä»¶æƒé™é—®é¢˜**ï¼š
```bash
# é”™è¯¯ä¿¡æ¯  
Can't write to backup directory

# è§£å†³æ–¹æ³•
sudo chown -R $(whoami):$(whoami) /backup
sudo chmod 755 /backup
```

### 10.3 æ•…éšœæ’æŸ¥å·¥å…·


**è¯Šæ–­è„šæœ¬**ï¼š
```bash
#!/bin/bash
# Perconaå·¥å…·å®‰è£…è¯Šæ–­è„šæœ¬

echo "=== Perconaå·¥å…·å®‰è£…è¯Šæ–­ ==="

# æ£€æŸ¥å®‰è£…çŠ¶æ€
echo "1. æ£€æŸ¥å·¥å…·å®‰è£…çŠ¶æ€ï¼š"
for tool in pt-summary pt-query-digest xtrabackup; do
    if command -v $tool >/dev/null 2>&1; then
        echo "âœ… $tool - å·²å®‰è£… ($(which $tool))"
        $tool --version | head -1
    else
        echo "âŒ $tool - æœªå®‰è£…"
    fi
done

# æ£€æŸ¥ä¾èµ–
echo -e "\n2. æ£€æŸ¥Perlæ¨¡å—ï¼š"
perl -MDBI -e 'print "âœ… DBI module OK\n"' 2>/dev/null || echo "âŒ DBI module missing"
perl -MDBD::mysql -e 'print "âœ… DBD::mysql module OK\n"' 2>/dev/null || echo "âŒ DBD::mysql module missing"

# æ£€æŸ¥MySQLè¿æ¥
echo -e "\n3. æ£€æŸ¥MySQLè¿æ¥ï¼š"
if mysql -e "SELECT VERSION();" >/dev/null 2>&1; then
    echo "âœ… MySQLè¿æ¥æ­£å¸¸"
    mysql -e "SELECT VERSION();"
else
    echo "âŒ MySQLè¿æ¥å¤±è´¥"
fi

# æ£€æŸ¥æƒé™
echo -e "\n4. æ£€æŸ¥æ–‡ä»¶æƒé™ï¼š"
ls -la $(which pt-summary 2>/dev/null) 2>/dev/null || echo "âŒ pt-summaryæƒé™æ£€æŸ¥å¤±è´¥"

echo -e "\n=== è¯Šæ–­å®Œæˆ ==="
```

### 10.4 æ—¥å¿—åˆ†æ


**æŸ¥çœ‹å®‰è£…æ—¥å¿—**ï¼š
```bash
# CentOS/RHELç³»ç»Ÿæ—¥å¿—
sudo tail -f /var/log/yum.log

# Ubuntu/Debianç³»ç»Ÿæ—¥å¿—  
sudo tail -f /var/log/dpkg.log

# æŸ¥çœ‹systemdæ—¥å¿—
sudo journalctl -u percona-toolkit
```

**å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š
```bash
# å¯ç”¨yumè¯¦ç»†æ—¥å¿—
sudo yum install -v percona-toolkit

# å¯ç”¨aptè¯¦ç»†æ—¥å¿—
sudo apt-get install -o Debug::pkgProblemResolver=yes percona-toolkit
```

---

## 11. ğŸ”„ å‡çº§è¿ç§»ç­–ç•¥


### 11.1 å‡çº§å‰å‡†å¤‡


**å‡çº§å‰æ£€æŸ¥æ¸…å•**ï¼š
```markdown
å‡çº§å‰å¿…åšæ£€æŸ¥ï¼š

â–¡ å¤‡ä»½å½“å‰é…ç½®
  â–¡ å¤‡ä»½.my.cnfé…ç½®æ–‡ä»¶
  â–¡ å¤‡ä»½è‡ªå®šä¹‰è„šæœ¬
  â–¡ è®°å½•å½“å‰ç‰ˆæœ¬ä¿¡æ¯
  
â–¡ å…¼å®¹æ€§æ£€æŸ¥
  â–¡ æŸ¥çœ‹æ–°ç‰ˆæœ¬å˜æ›´æ—¥å¿—
  â–¡ ç¡®è®¤MySQLç‰ˆæœ¬å…¼å®¹æ€§  
  â–¡ æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬è¦æ±‚
  
â–¡ ç¯å¢ƒå‡†å¤‡
  â–¡ é¢„ç•™è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
  â–¡ å‡†å¤‡å›æ»šæ–¹æ¡ˆ
  â–¡ é€šçŸ¥ç›¸å…³äººå‘˜
```

**å¤‡ä»½å½“å‰ç¯å¢ƒ**ï¼š
```bash
#!/bin/bash
# å‡çº§å‰ç¯å¢ƒå¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/percona-upgrade-$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

echo "=== å‡çº§å‰ç¯å¢ƒå¤‡ä»½ ==="

# å¤‡ä»½é…ç½®æ–‡ä»¶
echo "1. å¤‡ä»½é…ç½®æ–‡ä»¶..."
cp ~/.my.cnf $BACKUP_DIR/ 2>/dev/null || echo "æ— .my.cnfæ–‡ä»¶"
cp -r /etc/percona-toolkit/ $BACKUP_DIR/ 2>/dev/null || echo "æ— é…ç½®ç›®å½•"

# è®°å½•å½“å‰ç‰ˆæœ¬
echo "2. è®°å½•å½“å‰ç‰ˆæœ¬..."
pt-summary --version > $BACKUP_DIR/current_versions.txt 2>/dev/null
xtrabackup --version >> $BACKUP_DIR/current_versions.txt 2>/dev/null

# å¤‡ä»½è‡ªå®šä¹‰è„šæœ¬
echo "3. å¤‡ä»½è‡ªå®šä¹‰è„šæœ¬..."
find /home/$(whoami) -name "*pt-*" -type f > $BACKUP_DIR/custom_scripts.list

echo "âœ… å¤‡ä»½å®Œæˆï¼Œå¤‡ä»½ç›®å½•: $BACKUP_DIR"
```

### 11.2 å‡çº§æ‰§è¡Œæ–¹æ¡ˆ


**åœ¨çº¿å‡çº§ï¼ˆæ¨èï¼‰**ï¼š
```bash
# 1. æ£€æŸ¥å½“å‰ç‰ˆæœ¬
pt-summary --version

# 2. æ›´æ–°è½¯ä»¶æº
sudo yum update percona-release
sudo percona-release enable-only tools release

# 3. å‡çº§å·¥å…·åŒ…
sudo yum update percona-toolkit percona-xtrabackup-80

# 4. éªŒè¯å‡çº§ç»“æœ
pt-summary --version
xtrabackup --version
```

**ç¦»çº¿å‡çº§**ï¼š
```bash
# 1. ä¸‹è½½æ–°ç‰ˆæœ¬å®‰è£…åŒ…
wget https://repo.percona.com/yum/release/7/RPMS/x86_64/percona-toolkit-3.5.0-1.el7.x86_64.rpm

# 2. åœæ­¢ç›¸å…³æœåŠ¡ï¼ˆå¦‚æœåœ¨è¿è¡Œï¼‰
sudo systemctl stop percona-pmm-agent

# 3. å®‰è£…æ–°ç‰ˆæœ¬
sudo rpm -Uvh percona-toolkit-3.5.0-1.el7.x86_64.rpm

# 4. å¯åŠ¨æœåŠ¡
sudo systemctl start percona-pmm-agent
```

### 11.3 å›æ»šç­–ç•¥


**å¿«é€Ÿå›æ»šæ–¹æ¡ˆ**ï¼š
```bash
#!/bin/bash
# Perconaå·¥å…·å›æ»šè„šæœ¬

BACKUP_DIR="/backup/percona-upgrade-$(date +%Y%m%d)"

if [ ! -d "$BACKUP_DIR" ]; then
    echo "âŒ å¤‡ä»½ç›®å½•ä¸å­˜åœ¨: $BACKUP_DIR"
    exit 1
fi

echo "=== å¼€å§‹å›æ»šæ“ä½œ ==="

# 1. å¸è½½å½“å‰ç‰ˆæœ¬
echo "1. å¸è½½å½“å‰ç‰ˆæœ¬..."
sudo yum remove -y percona-toolkit percona-xtrabackup-80

# 2. å®‰è£…æ—§ç‰ˆæœ¬
echo "2. å®‰è£…æ—§ç‰ˆæœ¬..."
OLD_VERSION=$(grep "pt-summary" $BACKUP_DIR/current_versions.txt | awk '{print $2}')
sudo yum install -y percona-toolkit-$OLD_VERSION

# 3. æ¢å¤é…ç½®æ–‡ä»¶
echo "3. æ¢å¤é…ç½®æ–‡ä»¶..."
cp $BACKUP_DIR/.my.cnf ~/ 2>/dev/null || echo "æ— é…ç½®æ–‡ä»¶éœ€è¦æ¢å¤"

# 4. éªŒè¯å›æ»šç»“æœ
echo "4. éªŒè¯å›æ»šç»“æœ..."
pt-summary --version

echo "âœ… å›æ»šå®Œæˆ"
```

### 11.4 è¿ç§»åˆ°æ–°ç¯å¢ƒ


**ç¯å¢ƒè¿ç§»æ­¥éª¤**ï¼š
```bash
# 1. å¯¼å‡ºå½“å‰ç¯å¢ƒé…ç½®
cat > percona-config-export.sh << 'EOF'
#!/bin/bash
# é…ç½®å¯¼å‡ºè„šæœ¬

echo "=== é…ç½®å¯¼å‡º ==="

# å¯¼å‡ºç‰ˆæœ¬ä¿¡æ¯
echo "# Percona Tools Versions" > percona-config.txt
pt-summary --version >> percona-config.txt
xtrabackup --version >> percona-config.txt

# å¯¼å‡ºé…ç½®æ–‡ä»¶
echo -e "\n# MySQL Client Config" >> percona-config.txt
cat ~/.my.cnf >> percona-config.txt 2>/dev/null || echo "No .my.cnf found"

# å¯¼å‡ºç¯å¢ƒå˜é‡
echo -e "\n# Environment Variables" >> percona-config.txt
env | grep -i percona >> percona-config.txt

echo "âœ… é…ç½®å·²å¯¼å‡ºåˆ° percona-config.txt"
EOF

chmod +x percona-config-export.sh
./percona-config-export.sh
```

**æ–°ç¯å¢ƒéƒ¨ç½²**ï¼š
```bash
# 1. ä¼ è¾“é…ç½®æ–‡ä»¶åˆ°æ–°ç¯å¢ƒ
scp percona-config.txt user@new-server:/tmp/

# 2. åœ¨æ–°ç¯å¢ƒæ‰§è¡Œå®‰è£…
ssh user@new-server "bash -s" << 'EOF'
# æ ¹æ®é…ç½®æ–‡ä»¶å®‰è£…å¯¹åº”ç‰ˆæœ¬
sudo yum install -y percona-toolkit percona-xtrabackup-80

# æ¢å¤é…ç½®æ–‡ä»¶
grep -A 20 "MySQL Client Config" /tmp/percona-config.txt | tail -n +2 > ~/.my.cnf

# éªŒè¯å®‰è£…
pt-summary --version
xtrabackup --version
EOF
```

---

## 12. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 12.1 å¿…é¡»æŒæ¡çš„å®‰è£…è¦ç‚¹


```
ğŸ”¸ å®‰è£…æ–¹å¼é€‰æ‹©ï¼šä¼˜å…ˆåŒ…ç®¡ç†å™¨ > Docker > æºç ç¼–è¯‘
ğŸ”¸ ç¯å¢ƒè¦æ±‚ï¼šç¡®è®¤æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶èµ„æºã€ç½‘ç»œè¿æ¥
ğŸ”¸ ä¾èµ–ç®¡ç†ï¼šé‡ç‚¹å…³æ³¨Perlæ¨¡å—å’Œç³»ç»Ÿåº“ä¾èµ–
ğŸ”¸ æƒé™é…ç½®ï¼šæ•°æ®åº“ç”¨æˆ·æƒé™å’Œç³»ç»Ÿç”¨æˆ·æƒé™éƒ½è¦é…ç½®
ğŸ”¸ ç‰ˆæœ¬ç®¡ç†ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ç‰ˆæœ¬å›ºå®šï¼Œæµ‹è¯•ç¯å¢ƒå¯å¤šç‰ˆæœ¬å¹¶å­˜
```

### 12.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆæ¨èåŒ…ç®¡ç†å™¨å®‰è£…**ï¼š
```
ä¼˜åŠ¿åˆ†æï¼š
â€¢ ä¾èµ–å…³ç³»è‡ªåŠ¨å¤„ç†
â€¢ å®‰å…¨æ€§æ›´æœ‰ä¿éšœï¼ˆå®˜æ–¹ç­¾åï¼‰
â€¢ å‡çº§å’Œå¸è½½æ›´ç®€å•
â€¢ ä¸ç³»ç»Ÿé›†æˆæ›´å¥½
â€¢ å‡ºé—®é¢˜æœ‰å®˜æ–¹æ”¯æŒ
```

**ğŸ”¹ æƒé™é…ç½®çš„é‡è¦æ€§**ï¼š
```
å®‰å…¨åŸåˆ™ï¼š
â€¢ æœ€å°æƒé™åŸåˆ™ï¼šåªç»™éœ€è¦çš„æƒé™
â€¢ ä¸“ç”¨ç”¨æˆ·åŸåˆ™ï¼šä¸ä½¿ç”¨rootç­‰é«˜æƒé™ç”¨æˆ·
â€¢ ç½‘ç»œå®‰å…¨ï¼šé™åˆ¶è¿æ¥æ¥æºIP
â€¢ å¯†ç å®‰å…¨ï¼šä½¿ç”¨å¼ºå¯†ç å¹¶å®šæœŸæ›´æ¢
```

**ğŸ”¹ å¤šç‰ˆæœ¬ç®¡ç†çš„å¿…è¦æ€§**ï¼š
```
å®é™…éœ€æ±‚ï¼š
â€¢ ä¸åŒé¡¹ç›®çš„å…¼å®¹æ€§è¦æ±‚
â€¢ æ–°ç‰ˆæœ¬çš„ç¨³å®šæ€§éªŒè¯
â€¢ æ¸è¿›å¼å‡çº§ç­–ç•¥
â€¢ ç´§æ€¥å›æ»šéœ€æ±‚
```

### 12.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
- ä½¿ç”¨ç¨³å®šç‰ˆæœ¬ï¼Œé¿å…æœ€æ–°å¼€å‘ç‰ˆ
- å……åˆ†æµ‹è¯•åå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- å»ºç«‹å®Œå–„çš„å¤‡ä»½å’Œå›æ»šæœºåˆ¶
- å®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®‰å…¨é…ç½®

**ğŸ”§ å¼€å‘ç¯å¢ƒå»ºè®®**ï¼š
- å¯ä»¥ä½¿ç”¨Dockerå¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒ
- å°è¯•æ–°ç‰ˆæœ¬åŠŸèƒ½å’Œç‰¹æ€§
- ç»ƒä¹ å„ç§å®‰è£…å’Œé…ç½®æ–¹æ³•

**ğŸ“š å­¦ä¹ è·¯å¾„å»ºè®®**ï¼š
1. å…ˆæŒæ¡åŒ…ç®¡ç†å™¨å®‰è£…æ–¹æ³•
2. ç†è§£åŸºæœ¬çš„æƒé™é…ç½®
3. å­¦ä¼šåŸºç¡€çš„æ•…éšœæ’æŸ¥
4. é€æ­¥æŒæ¡é«˜çº§ç‰¹æ€§

**ğŸš¨ å¸¸è§é”™è¯¯é¿å…**ï¼š
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥æµ‹è¯•æ–°ç‰ˆæœ¬
- ä¸è¦å¿½ç•¥ä¾èµ–åŒ…çš„å®‰å…¨æ›´æ–°
- ä¸è¦ä½¿ç”¨è¿‡é«˜æƒé™çš„æ•°æ®åº“ç”¨æˆ·
- ä¸è¦å¿˜è®°å®šæœŸå¤‡ä»½é…ç½®å’Œæ•°æ®

### 12.4 æ‰©å±•å­¦ä¹ æ–¹å‘


**æ·±å…¥å­¦ä¹ å»ºè®®**ï¼š
- å­¦ä¹ MySQLæ€§èƒ½ä¼˜åŒ–ç†è®º
- æŒæ¡Linuxç³»ç»Ÿç®¡ç†æŠ€èƒ½
- äº†è§£Dockerå’Œå®¹å™¨åŒ–æŠ€æœ¯
- å­¦ä¹ è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·

**ç›¸å…³æŠ€æœ¯æ ˆ**ï¼š
- Ansible/Puppetè‡ªåŠ¨åŒ–éƒ¨ç½²
- Prometheus+Grafanaç›‘æ§
- Gitç‰ˆæœ¬æ§åˆ¶å’Œé…ç½®ç®¡ç†
- Shellè„šæœ¬å’ŒPythonè‡ªåŠ¨åŒ–

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
> åŒ…ç®¡ç†å™¨ä¼˜å…ˆé€‰ï¼Œä¾èµ–æƒé™è¦é…å…¨
> ç‰ˆæœ¬ç®¡ç†å¾ˆé‡è¦ï¼Œæ•…éšœæ’æŸ¥æœ‰æ–¹æ¡ˆ
> å‡çº§è¿ç§»è¦è°¨æ…ï¼Œå¤‡ä»½å›æ»šä¿å¹³å®‰
> ç”Ÿäº§ç¯å¢ƒæ±‚ç¨³å®šï¼Œæµ‹è¯•ç¯å¢ƒç»ƒæŠ€èƒ½