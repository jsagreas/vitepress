---
title: 21ã€pt-visual-explainæ‰§è¡Œè®¡åˆ’å¯è§†åŒ–
---
## ğŸ“š ç›®å½•

1. [pt-visual-explainå·¥å…·æ¦‚è¿°](#1-pt-visual-explainå·¥å…·æ¦‚è¿°)
2. [å¯è§†åŒ–åŸç†ä¸æœºåˆ¶](#2-å¯è§†åŒ–åŸç†ä¸æœºåˆ¶)
3. [æ‰§è¡Œè®¡åˆ’æ ‘å½¢å±•ç¤º](#3-æ‰§è¡Œè®¡åˆ’æ ‘å½¢å±•ç¤º)
4. [æˆæœ¬åˆ†æä¸æ€§èƒ½çƒ­ç‚¹](#4-æˆæœ¬åˆ†æä¸æ€§èƒ½çƒ­ç‚¹)
5. [å®é™…åº”ç”¨åœºæ™¯](#5-å®é™…åº”ç”¨åœºæ™¯)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” pt-visual-explainå·¥å…·æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯pt-visual-explain


**ğŸ’­ æ€è€ƒä¸€ä¸‹**ï¼šMySQLçš„`EXPLAIN`è¾“å‡ºç»“æœçœ‹èµ·æ¥åƒä¸€å¼ è¡¨æ ¼ï¼Œå¯¹äºå¤æ‚æŸ¥è¯¢æ¥è¯´ï¼Œå¾ˆéš¾çœ‹æ¸…æ¥šæ•°æ®çš„æµåŠ¨é¡ºåºå’Œå…³ç³»ï¼Œè¿™å°±åƒçœ‹ä¸€å¼ ç«è½¦æ—¶åˆ»è¡¨å´æä¸æ¸…æ¥šæ¢ä¹˜è·¯çº¿ä¸€æ ·ã€‚

ğŸ·ï¸ **ä¸“ä¸šæœ¯è¯­**ï¼š`pt-visual-explain` = MySQLæ‰§è¡Œè®¡åˆ’çš„**å¯è§†åŒ–å±•ç¤ºå·¥å…·**

**ğŸ”„ æ¢å¥è¯è¯´**ï¼šè¿™ä¸ªå·¥å…·æŠŠMySQLæ™¦æ¶©éš¾æ‡‚çš„EXPLAINç»“æœï¼Œè½¬æ¢æˆæ¸…æ™°çš„æ ‘çŠ¶å›¾ï¼Œè®©ä½ ä¸€çœ¼å°±èƒ½çœ‹å‡ºæŸ¥è¯¢æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚

```
ä¼ ç»ŸEXPLAINè¾“å‡ºï¼š
+----+-------+-------+------+--------+
| id | table | type  | key  | rows   |
+----+-------+-------+------+--------+
|  1 | user  | range | idx  | 1000   |
|  2 | order | ref   | fk   | 5      |
+----+-------+-------+------+--------+

pt-visual-explainè¾“å‡ºï¼š
1 SIMPLE
user
`- Nested loop
   `- Index range scan
       key: idx_user_status
       rows: 1000
   `- Index lookup
       table: order
       key: fk_user_id
       rows: 5 per loop
```

### 1.2 å·¥å…·çš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ å­¦ä¹ ç›®æ ‡**ï¼šç†è§£ä¸ºä»€ä¹ˆéœ€è¦å¯è§†åŒ–æ‰§è¡Œè®¡åˆ’

```
è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼š

âŒ å¸¸è§å›°æ‰°ï¼š
â€¢ EXPLAINç»“æœçœ‹ä¸æ‡‚æ‰§è¡Œé¡ºåº
â€¢ å¤æ‚JOINçš„æ•°æ®æµå‘ä¸æ¸…æ™°
â€¢ å­æŸ¥è¯¢åµŒå¥—å…³ç³»æ··ä¹±
â€¢ æ€§èƒ½ç“¶é¢ˆç‚¹éš¾ä»¥å®šä½

âœ… å¯è§†åŒ–å¸¦æ¥çš„å¥½å¤„ï¼š
â€¢ æ¸…æ™°çš„æ ‘çŠ¶ç»“æ„å±•ç¤º
â€¢ ç›´è§‚çš„æ•°æ®æµåŠ¨æ–¹å‘
â€¢ æ˜ç¡®çš„æˆæœ¬å¼€é”€æ ‡æ³¨
â€¢ å¿«é€Ÿçš„ç“¶é¢ˆç‚¹è¯†åˆ«
```

### 1.3 å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨


**ğŸ“š å‰ç½®çŸ¥è¯†**ï¼šéœ€è¦å®‰è£…Percona Toolkitå·¥å…·åŒ…

```bash
# å®‰è£…pt-visual-explain
# Ubuntu/Debian
sudo apt-get install percona-toolkit

# CentOS/RHEL
sudo yum install percona-toolkit

# éªŒè¯å®‰è£…
pt-visual-explain --version
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šæœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼

```bash
# æ–¹å¼ä¸€ï¼šç›´æ¥ä¼ å…¥SQL
mysql -e "EXPLAIN SELECT * FROM users WHERE status='active'" | pt-visual-explain

# æ–¹å¼äºŒï¼šä½¿ç”¨ç®¡é“
echo "EXPLAIN SELECT u.*, o.total FROM users u JOIN orders o ON u.id=o.user_id" | mysql | pt-visual-explain

# æ–¹å¼ä¸‰ï¼šä»æ–‡ä»¶è¯»å–
pt-visual-explain explain_output.txt
```

---

## 2. âš™ï¸ å¯è§†åŒ–åŸç†ä¸æœºåˆ¶


### 2.1 EXPLAINç»“æœè§£æåŸç†


**ğŸ¤” ä¸ºä»€ä¹ˆè¿™æ ·**ï¼šMySQLçš„EXPLAINç»“æœæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤çš„æè¿°è¡¨ï¼Œpt-visual-explainéœ€è¦é‡æ–°ç»„ç»‡è¿™äº›ä¿¡æ¯ã€‚

**ğŸ—ï¸ çŸ¥è¯†æ¶æ„**ï¼š
```
åŸå§‹EXPLAIN â†’ è§£æå™¨ â†’ å…³ç³»åˆ†æ â†’ æ ‘çŠ¶é‡æ„ â†’ å¯è§†åŒ–è¾“å‡º
    â†“           â†“        â†“         â†“         â†“
  è¡¨æ ¼æ•°æ®    æå–å­—æ®µ   å»ºç«‹ä¾èµ–   æ„å»ºæ ‘å½¢   æ ¼å¼åŒ–æ˜¾ç¤º
```

**ğŸ’¡ æ·±å…¥ç†è§£**ï¼šè§£æçš„å…³é”®æ­¥éª¤

```
æ­¥éª¤1ï¼šå­—æ®µæå–
â€¢ id: æ‰§è¡Œé¡ºåºæ ‡è¯†
â€¢ select_type: æŸ¥è¯¢ç±»å‹(SIMPLE, SUBQUERYç­‰)
â€¢ table: æ¶‰åŠçš„è¡¨å
â€¢ type: è®¿é—®ç±»å‹(index, rangeç­‰)
â€¢ key: ä½¿ç”¨çš„ç´¢å¼•
â€¢ rows: é¢„ä¼°æ‰«æè¡Œæ•°

æ­¥éª¤2ï¼šå…³ç³»åˆ†æ
â€¢ æ ¹æ®idå­—æ®µç¡®å®šæ‰§è¡Œé¡ºåº
â€¢ è¯†åˆ«JOINå…³ç³»å’Œé©±åŠ¨è¡¨
â€¢ åˆ†æå­æŸ¥è¯¢çš„åµŒå¥—å±‚æ¬¡
â€¢ ç¡®å®šæ•°æ®æµåŠ¨æ–¹å‘

æ­¥éª¤3ï¼šæ ‘çŠ¶é‡æ„
â€¢ ä»¥æœ€å¤–å±‚æŸ¥è¯¢ä¸ºæ ¹èŠ‚ç‚¹
â€¢ æŒ‰æ‰§è¡Œé¡ºåºæ„å»ºåˆ†æ”¯
â€¢ æ ‡æ³¨æ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œç±»å‹
â€¢ è®¡ç®—ç´¯ç§¯æˆæœ¬å’Œå½±å“
```

### 2.2 æ ‘å½¢å±•ç¤ºçš„æ„å»ºé€»è¾‘


**ğŸ” æ·±å…¥ç†è§£**ï¼šå¦‚ä½•ä»è¡¨æ ¼å˜æˆæ ‘å½¢ç»“æ„

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šå¤æ‚æŸ¥è¯¢çš„è½¬æ¢è¿‡ç¨‹

```sql
-- åŸå§‹SQL
SELECT u.name, 
       (SELECT COUNT(*) FROM orders o WHERE o.user_id = u.id) as order_count
FROM users u 
WHERE u.status = 'active' 
  AND u.created_at > '2024-01-01'
ORDER BY u.name;
```

**åŸå§‹EXPLAINè¾“å‡º**ï¼š
```
+----+--------------------+-------+-------+---------------+
| id | select_type        | table | type  | key           |
+----+--------------------+-------+-------+---------------+
|  1 | PRIMARY            | u     | range | idx_status    |
|  2 | DEPENDENT SUBQUERY | o     | ref   | idx_user_id   |
+----+--------------------+-------+-------+---------------+
```

**pt-visual-explainè½¬æ¢å**ï¼š
```
1 PRIMARY
u
`- Table scan
   rows: 1000
   filtered: 10%
   `- Using where
       condition: status='active' AND created_at>'2024-01-01'
   `- Subquery (DEPENDENT)
       table: orders (o)
       `- Index lookup
           key: idx_user_id
           condition: o.user_id = u.id
           rows: 5 per iteration
```

### 2.3 å¯è§†åŒ–è¾“å‡ºæ ¼å¼è¯¦è§£


**ğŸ“‹ çŸ¥è¯†æ¸…å•**ï¼špt-visual-explainæ”¯æŒçš„è¾“å‡ºæ ¼å¼

```
æ ¼å¼ç±»å‹ï¼š

1. æ ‘å½¢æ–‡æœ¬æ ¼å¼ï¼ˆé»˜è®¤ï¼‰
   â€¢ ä½¿ç”¨å­—ç¬¦ç”»è¡¨ç¤ºå±‚æ¬¡å…³ç³»
   â€¢ æ¸…æ™°çš„ç¼©è¿›å’Œè¿æ¥çº¿
   â€¢ é€‚åˆç»ˆç«¯æŸ¥çœ‹

2. ç´§å‡‘æ ¼å¼ï¼ˆ--compactï¼‰
   â€¢ å‡å°‘ç©ºç™½å’Œè£…é¥°å­—ç¬¦
   â€¢ é€‚åˆæ—¥å¿—è®°å½•
   â€¢ èŠ‚çœç©ºé—´

3. è¿æ¥æ ¼å¼ï¼ˆ--connectï¼‰
   â€¢ æ˜¾ç¤ºè¯¦ç»†çš„è¿æ¥ä¿¡æ¯
   â€¢ åŒ…å«è¿æ¥ç±»å‹å’Œæ¡ä»¶
   â€¢ ç”¨äºæ·±å…¥åˆ†æ
```

**ğŸ”§ è§£å†³æ–¹æ¡ˆ**ï¼šä¸åŒåœºæ™¯ä¸‹çš„æ ¼å¼é€‰æ‹©

```bash
# è¯¦ç»†åˆ†ææ¨¡å¼
pt-visual-explain --connect explain_output.txt

# ç®€æ´æŸ¥çœ‹æ¨¡å¼  
pt-visual-explain --compact explain_output.txt

# é»˜è®¤æ¨¡å¼ï¼ˆæ¨èæ–°æ‰‹ï¼‰
pt-visual-explain explain_output.txt
```

---

## 3. ğŸŒ³ æ‰§è¡Œè®¡åˆ’æ ‘å½¢å±•ç¤º


### 3.1 æ ‘å½¢ç»“æ„çš„é˜…è¯»æ–¹æ³•


**ğŸ“ å­¦ä¹ ç›®æ ‡**ï¼šæŒæ¡å¦‚ä½•è¯»æ‡‚å¯è§†åŒ–çš„æ‰§è¡Œè®¡åˆ’æ ‘

**ğŸ“ ä¸€å¥è¯æ€»ç»“**ï¼šæ‰§è¡Œè®¡åˆ’æ ‘ä»ä¸Šåˆ°ä¸‹çœ‹ï¼Œæ•°æ®ä»ä¸‹åˆ°ä¸ŠæµåŠ¨ã€‚

```
é˜…è¯»è§„åˆ™ï¼š

æ‰§è¡Œé¡ºåºï¼šğŸ“Š ä»ä¸Šåˆ°ä¸‹
â€¢ æ ¹èŠ‚ç‚¹ï¼šæœ€ç»ˆçš„SELECTæ“ä½œ
â€¢ å­èŠ‚ç‚¹ï¼šå„ç§ä¸­é—´æ“ä½œ
â€¢ å¶å­èŠ‚ç‚¹ï¼šåŸºç¡€çš„è¡¨æ‰«æ

æ•°æ®æµå‘ï¼šâ¬†ï¸ ä»ä¸‹åˆ°ä¸Š
â€¢ å¶å­èŠ‚ç‚¹äº§ç”ŸåŸå§‹æ•°æ®
â€¢ ä¸­é—´èŠ‚ç‚¹å¤„ç†å’Œè¿‡æ»¤æ•°æ®
â€¢ æ ¹èŠ‚ç‚¹è¿”å›æœ€ç»ˆç»“æœ

æˆæœ¬è®¡ç®—ï¼šğŸ“ˆ ä»ä¸‹åˆ°ä¸Šç´¯ç§¯
â€¢ æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„æˆæœ¬
â€¢ ä¸Šçº§èŠ‚ç‚¹åŒ…å«ä¸‹çº§æˆæœ¬
â€¢ æ ¹èŠ‚ç‚¹æ˜¯æ€»æˆæœ¬
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šJOINæŸ¥è¯¢çš„æ ‘å½¢å±•ç¤º

```
åŸå§‹SQLï¼š
SELECT u.name, p.title 
FROM users u 
JOIN posts p ON u.id = p.user_id 
WHERE u.status = 'active'

å¯è§†åŒ–ç»“æœï¼š
1 SIMPLE
u
`- Nested loop  â† è¿æ¥æ“ä½œ
   +- Index range scan  â† é©±åŠ¨è¡¨æ“ä½œ
   |  table: users (u)
   |  key: idx_status  
   |  condition: status='active'
   |  rows: 100
   |  cost: 20.5
   `- Index lookup  â† è¢«é©±åŠ¨è¡¨æ“ä½œ
      table: posts (p)
      key: idx_user_id
      condition: u.id = p.user_id  
      rows: 3 per loop
      cost: 1.2 per lookup
```

### 3.2 å¤æ‚æŸ¥è¯¢çš„åµŒå¥—å±•ç¤º


**ğŸ’­ æ€è€ƒä¸€ä¸‹**ï¼šå½“æŸ¥è¯¢åŒ…å«å­æŸ¥è¯¢ã€UNIONç­‰å¤æ‚ç»“æ„æ—¶ï¼Œå¦‚ä½•åœ¨æ ‘å½¢å›¾ä¸­è¡¨ç¤ºï¼Ÿ

**ğŸ” æ·±å…¥ç†è§£**ï¼šåµŒå¥—ç»“æ„çš„è¡¨ç¤ºæ–¹æ³•

```
1. å­æŸ¥è¯¢å±•ç¤ºï¼š
ä¸»æŸ¥è¯¢ (PRIMARY)
`- è¡¨æ‰«æ
   `- æ¡ä»¶è¿‡æ»¤
   `- å­æŸ¥è¯¢ (SUBQUERY)
      `- ç‹¬ç«‹çš„æ‰§è¡Œåˆ†æ”¯
      `- è¿”å›ç»“æœç»™ä¸»æŸ¥è¯¢

2. ç›¸å…³å­æŸ¥è¯¢ï¼š
ä¸»æŸ¥è¯¢ (PRIMARY)  
`- è¡¨æ‰«æ
   `- å¯¹æ¯è¡Œæ‰§è¡Œå­æŸ¥è¯¢ (DEPENDENT SUBQUERY)
      `- ä½¿ç”¨ä¸»æŸ¥è¯¢çš„å­—æ®µå€¼
      `- è¿”å›ç»“æœå‚ä¸æ¡ä»¶åˆ¤æ–­

3. UNIONæŸ¥è¯¢ï¼š
UNION
+- ç¬¬ä¸€ä¸ªSELECT (PRIMARY)
|  `- è¡¨æ‰«æ
|  `- ç»“æœé›†1
`- ç¬¬äºŒä¸ªSELECT (UNION)
   `- è¡¨æ‰«æ  
   `- ç»“æœé›†2
   `- åˆå¹¶å»é‡æ“ä½œ
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šå¤æ‚åµŒå¥—æŸ¥è¯¢çš„å®Œæ•´å±•ç¤º

```sql
-- å¤æ‚SQLç¤ºä¾‹
SELECT u.name,
       (SELECT COUNT(*) FROM posts WHERE user_id = u.id) as post_count,
       (SELECT AVG(rating) FROM reviews WHERE user_id = u.id) as avg_rating
FROM users u
WHERE u.id IN (SELECT user_id FROM orders WHERE total > 100)
  AND u.status = 'active'
ORDER BY u.name
```

**å¯¹åº”çš„å¯è§†åŒ–è¾“å‡º**ï¼š
```
1 PRIMARY
u 
`- Nested loop semi join  â† INå­æŸ¥è¯¢è½¬æ¢ä¸ºåŠè¿æ¥
   +- Index range scan
   |  table: users (u)
   |  key: idx_status
   |  condition: status='active'
   |  rows: 500
   |  
   +- Index lookup  â† INå­æŸ¥è¯¢çš„è¡¨
   |  table: orders
   |  key: idx_user_id  
   |  condition: orders.user_id = u.id AND total > 100
   |  rows: 2 per loop
   |
   `- Subqueries (DEPENDENT)
      +- COUNTå­æŸ¥è¯¢
      |  table: posts
      |  condition: user_id = u.id
      |  operation: COUNT(*)
      |  
      `- AVGå­æŸ¥è¯¢  
         table: reviews
         condition: user_id = u.id
         operation: AVG(rating)
```

### 3.3 JOINæ“ä½œçš„å¯è§†åŒ–è¡¨ç¤º


**ğŸ”„ æ¢å¥è¯è¯´**ï¼šJOINåœ¨æ ‘å½¢å›¾ä¸­å°±åƒæ˜¯ä¸¤æ¡æ²³æ±‡åˆï¼Œéœ€è¦æ¸…æ¥šåœ°è¡¨ç¤ºå‡ºæ•°æ®çš„æ±‡åˆæ–¹å¼ã€‚

**ğŸ“‹ çŸ¥è¯†æ¸…å•**ï¼šä¸åŒJOINç±»å‹çš„å¯è§†åŒ–ç‰¹ç‚¹

```
1. Nested Loop Joinï¼ˆåµŒå¥—å¾ªç¯è¿æ¥ï¼‰
é©±åŠ¨è¡¨
`- Nested loop
   +- å¤–å±‚å¾ªç¯ï¼šæ‰«æé©±åŠ¨è¡¨æ¯ä¸€è¡Œ
   `- å†…å±‚å¾ªç¯ï¼šå¯¹æ¯è¡ŒæŸ¥æ‰¾åŒ¹é…è®°å½•
      table: è¢«é©±åŠ¨è¡¨
      key: è¿æ¥ç´¢å¼•
      condition: è¿æ¥æ¡ä»¶

2. Hash Joinï¼ˆå“ˆå¸Œè¿æ¥ï¼‰
å°è¡¨
`- Hash join
   +- Build phaseï¼šæ„å»ºå“ˆå¸Œè¡¨
   |  table: å°è¡¨
   |  rows: 1000
   `- Probe phaseï¼šæ¢æµ‹åŒ¹é…
      table: å¤§è¡¨  
      hash_condition: è¿æ¥æ¡ä»¶

3. Sort Merge Joinï¼ˆæ’åºåˆå¹¶è¿æ¥ï¼‰
è¡¨1
`- Sort merge join
   +- Sortï¼šæ’åºç¬¬ä¸€ä¸ªè¡¨
   |  table: table1
   |  sort_key: è¿æ¥å­—æ®µ
   `- Mergeï¼šåˆå¹¶åŒ¹é…
      table: table2
      merge_condition: è¿æ¥æ¡ä»¶
```

**âš¡ å¿«é€Ÿå›é¡¾**ï¼šå¦‚ä½•åˆ¤æ–­JOINçš„æ€§èƒ½å¥½å

```
æ€§èƒ½åˆ¤æ–­æŒ‡æ ‡ï¼š

ğŸŸ¢ ä¼˜ç§€çš„JOINï¼š
â€¢ é©±åŠ¨è¡¨æ‰«æè¡Œæ•°å°‘
â€¢ è¢«é©±åŠ¨è¡¨æœ‰æœ‰æ•ˆç´¢å¼•
â€¢ è¿æ¥æ¡ä»¶é€‰æ‹©æ€§é«˜

ğŸŸ¡ ä¸€èˆ¬çš„JOINï¼š
â€¢ é©±åŠ¨è¡¨è¡Œæ•°é€‚ä¸­
â€¢ éƒ¨åˆ†ç´¢å¼•å¯ç”¨
â€¢ éœ€è¦é¢å¤–æ’åºæˆ–ä¸´æ—¶è¡¨

ğŸ”´ ç³Ÿç³•çš„JOINï¼š
â€¢ å…¨è¡¨æ‰«æä½œä¸ºé©±åŠ¨è¡¨
â€¢ è¢«é©±åŠ¨è¡¨æ— ç´¢å¼•
â€¢ äº§ç”Ÿç¬›å¡å°”ç§¯
```

---

## 4. ğŸ“Š æˆæœ¬åˆ†æä¸æ€§èƒ½çƒ­ç‚¹


### 4.1 æˆæœ¬ä¿¡æ¯çš„è§£è¯»


**ğŸ¯ å­¦ä¹ ç›®æ ‡**ï¼šç†è§£æ‰§è¡Œè®¡åˆ’ä¸­çš„æˆæœ¬æ•°æ®å«ä¹‰

**ğŸ·ï¸ ä¸“ä¸šæœ¯è¯­**ï¼š`æˆæœ¬(Cost)` = MySQLä¼˜åŒ–å™¨ä¼°ç®—çš„**èµ„æºæ¶ˆè€—é‡**ï¼ŒåŒ…æ‹¬CPUæ—¶é—´ã€IOæ“ä½œã€å†…å­˜ä½¿ç”¨ç­‰ç»¼åˆæŒ‡æ ‡

**ğŸ’¡ æ·±å…¥ç†è§£**ï¼šæˆæœ¬çš„è®¡ç®—é€»è¾‘

```
æˆæœ¬æ„æˆè¦ç´ ï¼š

1. IOæˆæœ¬
â€¢ è¯»å–æ•°æ®é¡µçš„ç£ç›˜IOå¼€é”€
â€¢ æ¯æ¬¡éšæœºIOçº¦ç­‰äº1ä¸ªæˆæœ¬å•ä½
â€¢ é¡ºåºIOçš„æˆæœ¬æ›´ä½

2. CPUæˆæœ¬  
â€¢ è®°å½•æ¯”è¾ƒå’Œè¿‡æ»¤çš„CPUå¼€é”€
â€¢ æ¯å¤„ç†ä¸€è¡Œè®°å½•çº¦0.2ä¸ªæˆæœ¬å•ä½
â€¢ å¤æ‚è®¡ç®—ä¼šå¢åŠ CPUæˆæœ¬

3. å†…å­˜æˆæœ¬
â€¢ æ’åºå’Œåˆ†ç»„ä½¿ç”¨çš„å†…å­˜
â€¢ ä¸´æ—¶è¡¨çš„åˆ›å»ºæˆæœ¬
â€¢ å“ˆå¸Œè¡¨æ„å»ºæˆæœ¬

æ€»æˆæœ¬ = IOæˆæœ¬ + CPUæˆæœ¬ + å†…å­˜æˆæœ¬
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šæˆæœ¬ä¿¡æ¯åœ¨å¯è§†åŒ–ä¸­çš„å±•ç¤º

```
å¯è§†åŒ–è¾“å‡ºä¸­çš„æˆæœ¬ä¿¡æ¯ï¼š

1 SIMPLE  
users
`- Index range scan
   key: idx_status
   rows: 1000          â† é¢„ä¼°æ‰«æè¡Œæ•°
   cost: 201.5         â† æ€»æˆæœ¬
   io_cost: 200.0      â† IOæˆæœ¬(è¯»å–æ•°æ®é¡µ)
   cpu_cost: 1.5       â† CPUæˆæœ¬(è¡Œå¤„ç†)
   filtered: 80%       â† è¿‡æ»¤åå‰©ä½™æ¯”ä¾‹
   
   `- Using index condition  â† ä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨
      condition: status='active'
      pushdown_cost: 0.8     â† ä¸‹æ¨èŠ‚çœçš„æˆæœ¬
```

### 4.2 æ€§èƒ½ç“¶é¢ˆèŠ‚ç‚¹è¯†åˆ«


**ğŸš¨ é‡è¦æé†’**ï¼šæˆæœ¬æœ€é«˜çš„èŠ‚ç‚¹å¾€å¾€å°±æ˜¯æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨

**ğŸ” æ·±å…¥ç†è§£**ï¼šå¦‚ä½•åœ¨å¯è§†åŒ–ç»“æœä¸­å¿«é€Ÿå®šä½ç“¶é¢ˆ

```
ç“¶é¢ˆè¯†åˆ«æ ‡å‡†ï¼š

ğŸ”´ é«˜é£é™©èŠ‚ç‚¹ï¼š
â€¢ æˆæœ¬å æ€»æˆæœ¬70%ä»¥ä¸Š
â€¢ æ‰«æè¡Œæ•°è¶…è¿‡é¢„æœŸ
â€¢ å‡ºç°"Using temporary"
â€¢ å‡ºç°"Using filesort"

ğŸŸ¡ ä¸­é£é™©èŠ‚ç‚¹ï¼š
â€¢ æˆæœ¬å æ€»æˆæœ¬30-70%
â€¢ æœªä½¿ç”¨æœ€ä¼˜ç´¢å¼•
â€¢ æ¡ä»¶è¿‡æ»¤ç‡ä½äº50%

ğŸŸ¢ ä½é£é™©èŠ‚ç‚¹ï¼š
â€¢ æˆæœ¬å æ€»æˆæœ¬30%ä»¥ä¸‹
â€¢ ä½¿ç”¨æœ‰æ•ˆç´¢å¼•
â€¢ æ¡ä»¶è¿‡æ»¤ç‡é«˜äº80%
```

**ğŸ› ï¸ å·¥å…·æ¨è**ï¼špt-visual-explainçš„ç“¶é¢ˆæ ‡æ³¨åŠŸèƒ½

```bash
# å¯ç”¨æ€§èƒ½çƒ­ç‚¹æ ‡è®°
pt-visual-explain --format=tree --show-cost explain_output.txt

# ç¤ºä¾‹è¾“å‡º
1 SIMPLE
orders
`- **HOT SPOT** Full table scan  ğŸ”¥ â† è‡ªåŠ¨æ ‡è®°çš„çƒ­ç‚¹
   table: orders  
   rows: 100000
   cost: 10525.0  (85% of total)  â† å æ€»æˆæœ¬æ¯”ä¾‹
   recommendation: Add index on status column
   
   `- Using where
      condition: status='pending' 
      filtered: 5%  â† è¿‡æ»¤ç‡å¾ˆä½ï¼Œéœ€è¦ä¼˜åŒ–
```

### 4.3 ä¼˜åŒ–å»ºè®®çš„ç”Ÿæˆé€»è¾‘


**ğŸ¤” ä¸ºä»€ä¹ˆè¿™æ ·**ï¼špt-visual-explainä¸ä»…æ˜¾ç¤ºé—®é¢˜ï¼Œè¿˜ä¼šç»™å‡ºä¼˜åŒ–å»ºè®®

**ğŸ“‹ çŸ¥è¯†æ¸…å•**ï¼šå¸¸è§çš„ä¼˜åŒ–å»ºè®®ç±»å‹

```
ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š

1. ç¼ºå¤±ç´¢å¼•
é—®é¢˜ï¼šFull table scan
å»ºè®®ï¼šCREATE INDEX idx_column ON table(column)
åŸå› ï¼šæ‰«æè¡Œæ•°è¿‡å¤šï¼Œéœ€è¦ç´¢å¼•åŠ é€Ÿ

2. ç´¢å¼•ä¸å¤Ÿä¼˜åŒ–
é—®é¢˜ï¼šIndex scan with high cost  
å»ºè®®ï¼šConsider composite index
åŸå› ï¼šå•åˆ—ç´¢å¼•é€‰æ‹©æ€§ä¸å¤Ÿ

3. ç´¢å¼•æœªè¢«ä½¿ç”¨
é—®é¢˜ï¼šKey not used
å»ºè®®ï¼šCheck WHERE condition or table statistics
åŸå› ï¼šç»Ÿè®¡ä¿¡æ¯è¿‡æœŸæˆ–æ¡ä»¶å†™æ³•æœ‰é—®é¢˜
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šå®Œæ•´çš„ä¼˜åŒ–å»ºè®®å±•ç¤º

```
åŸå§‹æŸ¥è¯¢é—®é¢˜ï¼š
SELECT * FROM orders 
WHERE status = 'pending' 
  AND created_at > '2024-01-01'
  AND user_id = 123
ORDER BY created_at DESC
LIMIT 10;

å¯è§†åŒ–è¾“å‡ºåŠå»ºè®®ï¼š
1 SIMPLE
orders
`- **PERFORMANCE ISSUE** Index range scan  ğŸ”´
   key: idx_status  
   rows: 50000 (filtered to 500)
   cost: 5200.0
   
   ğŸ’¡ Optimization suggestions:
   1. Create composite index: 
      CREATE INDEX idx_optimized ON orders(user_id, status, created_at)
      Estimated improvement: 90% faster
      
   2. Alternative approach:
      CREATE INDEX idx_user_time ON orders(user_id, created_at)  
      WHERE condition order: user_id first (highest selectivity)
      
   3. Query rewrite suggestion:
      Use covering index to avoid table lookup
      
   `- Using filesort  ğŸŸ¡
      sort: created_at DESC
      temp_table_size: 2MB
      suggestion: Include created_at in covering index
```

**âš¡ å¿«é€Ÿå›é¡¾**ï¼šä¼˜åŒ–å»ºè®®çš„å¯ä¿¡åº¦

```
å»ºè®®å¯ä¿¡åº¦è¯„ä¼°ï¼š

â­â­â­ é«˜å¯ä¿¡åº¦ï¼š
â€¢ åŸºäºæˆæœ¬è®¡ç®—çš„æ•°å€¼å»ºè®®
â€¢ æ˜æ˜¾çš„ç´¢å¼•ç¼ºå¤±é—®é¢˜
â€¢ æ ‡å‡†çš„æŸ¥è¯¢ä¼˜åŒ–æ¨¡å¼

â­â­ ä¸­å¯ä¿¡åº¦ï¼š
â€¢ éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯çš„å»ºè®®
â€¢ æ¶‰åŠè¡¨ç»“æ„è°ƒæ•´çš„å»ºè®®
â€¢ å¤æ‚æŸ¥è¯¢çš„é‡å†™å»ºè®®

â­ ä½å¯ä¿¡åº¦ï¼š
â€¢ éœ€è¦å¤§é‡æµ‹è¯•éªŒè¯çš„å»ºè®®
â€¢ å¯èƒ½å½±å“å…¶ä»–æŸ¥è¯¢çš„å»ºè®®
â€¢ ç¡¬ä»¶ç›¸å…³çš„è°ƒä¼˜å»ºè®®
```

---

## 5. ğŸš€ å®é™…åº”ç”¨åœºæ™¯


### 5.1 æ—¥å¸¸æŸ¥è¯¢ä¼˜åŒ–å·¥ä½œæµ


**ğŸ­ è§’è‰²æ‰®æ¼”**ï¼šæƒ³è±¡ä½ æ˜¯æ•°æ®åº“ä¼˜åŒ–å·¥ç¨‹å¸ˆï¼Œæ¯å¤©éœ€è¦å¤„ç†å„ç§æ…¢æŸ¥è¯¢é—®é¢˜

**ğŸ”¢ æ­¥éª¤åˆ†è§£**ï¼šä½¿ç”¨pt-visual-explainçš„æ ‡å‡†å·¥ä½œæµç¨‹

```
æ ‡å‡†ä¼˜åŒ–æµç¨‹ï¼š

ç¬¬1æ­¥ï¼šè·å–æ‰§è¡Œè®¡åˆ’
mysql> EXPLAIN FORMAT=JSON SELECT ... \G
æˆ–è€…
mysql> EXPLAIN SELECT ... ;

ç¬¬2æ­¥ï¼šå¯è§†åŒ–åˆ†æ
pt-visual-explain explain_output.txt > visual_plan.txt

ç¬¬3æ­¥ï¼šè¯†åˆ«ç“¶é¢ˆ
â€¢ æŸ¥çœ‹æˆæœ¬æœ€é«˜çš„èŠ‚ç‚¹  
â€¢ å…³æ³¨æ‰«æè¡Œæ•°å¼‚å¸¸çš„æ“ä½œ
â€¢ è¯†åˆ«ä¸´æ—¶è¡¨å’Œæ–‡ä»¶æ’åº

ç¬¬4æ­¥ï¼šåˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
â€¢ æ ¹æ®å»ºè®®æ·»åŠ ç´¢å¼•
â€¢ è°ƒæ•´æŸ¥è¯¢è¯­å¥ç»“æ„
â€¢ ä¼˜åŒ–WHEREæ¡ä»¶é¡ºåº

ç¬¬5æ­¥ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ
â€¢ é‡æ–°æ‰§è¡ŒEXPLAIN
â€¢ å¯¹æ¯”ä¼˜åŒ–å‰åçš„å¯è§†åŒ–ç»“æœ
â€¢ æµ‹è¯•å®é™…æŸ¥è¯¢æ€§èƒ½
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šçœŸå®çš„ä¼˜åŒ–æ¡ˆä¾‹

```sql
-- é—®é¢˜æŸ¥è¯¢
SELECT u.name, COUNT(o.id) as order_count
FROM users u
LEFT JOIN orders o ON u.id = o.user_id  
WHERE u.created_at > '2024-01-01'
  AND (o.status = 'completed' OR o.status IS NULL)
GROUP BY u.id, u.name
HAVING COUNT(o.id) > 5
ORDER BY order_count DESC;
```

**ä¼˜åŒ–å‰çš„å¯è§†åŒ–åˆ†æ**ï¼š
```
1 SIMPLE
u  
`- **MAJOR ISSUE** Full table scan  ğŸ”´
   table: users
   rows: 500000
   cost: 50125.0 (78% of total cost)
   
   `- Nested loop left join
      `- **MINOR ISSUE** Index scan  ğŸŸ¡
         table: orders (o)
         key: idx_user_id
         rows: 8 per loop  
         condition: u.id = o.user_id
         
         `- Using where
            condition: status='completed' OR status IS NULL
            filtered: 60%
            
      `- Using temporary; Using filesort  ğŸ”´
         group_by: u.id, u.name
         having: COUNT(o.id) > 5
         order_by: COUNT(o.id) DESC
         temp_table_size: 128MB

ğŸ’¡ Critical optimizations needed:
1. Add index on users.created_at
2. Add composite index on orders(user_id, status)  
3. Consider query rewrite to avoid large temporary table
```

**ä¼˜åŒ–åçš„ç»“æœ**ï¼š
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_created ON users(created_at);
CREATE INDEX idx_order_user_status ON orders(user_id, status);

-- ä¼˜åŒ–åçš„å¯è§†åŒ–
1 SIMPLE
u
`- Index range scan  ğŸŸ¢
   table: users  
   key: idx_user_created
   rows: 50000 (90% reduction!)
   cost: 5200.0
   
   `- Nested loop left join
      `- Index lookup  ğŸŸ¢
         table: orders (o)
         key: idx_order_user_status
         condition: u.id = o.user_id AND (status='completed' OR status IS NULL)
         rows: 3 per loop (60% reduction!)
         
      `- Using temporary; Using filesort  ğŸŸ¡
         temp_table_size: 12MB (90% reduction!)
         
âœ… Optimization successful:
â€¢ Query cost reduced by 85%
â€¢ Temporary table size reduced by 90%  
â€¢ Estimated execution time: <1 second
```

### 5.2 å¤æ‚æŸ¥è¯¢çš„è°ƒè¯•åˆ†æ


**ğŸ’­ æ€è€ƒä¸€ä¸‹**ï¼šå½“æŸ¥è¯¢åŒ…å«å¤šä¸ªå­æŸ¥è¯¢ã€å¤šè¡¨JOINæ—¶ï¼Œå¦‚ä½•ç³»ç»Ÿæ€§åœ°åˆ†ææ€§èƒ½é—®é¢˜ï¼Ÿ

**ğŸ—ï¸ çŸ¥è¯†æ¶æ„**ï¼šå¤æ‚æŸ¥è¯¢çš„åˆ†å±‚åˆ†ææ–¹æ³•

```
åˆ†æå±‚æ¬¡ï¼š

å±‚æ¬¡1ï¼šæ•´ä½“ç»“æ„åˆ†æ
â€¢ æŸ¥è¯¢ç±»å‹è¯†åˆ«(SIMPLE, UNION, SUBQUERY)
â€¢ è¡¨å…³è”å…³ç³»æ¢³ç†
â€¢ æ•°æ®æµå‘ç¡®è®¤

å±‚æ¬¡2ï¼šèŠ‚ç‚¹æˆæœ¬åˆ†æ
â€¢ å„èŠ‚ç‚¹æˆæœ¬å æ¯”
â€¢ ç“¶é¢ˆèŠ‚ç‚¹å®šä½
â€¢ ä¼˜åŒ–ä¼˜å…ˆçº§æ’åº

å±‚æ¬¡3ï¼šç»†èŠ‚ä¼˜åŒ–åˆ†æ
â€¢ ç´¢å¼•ä½¿ç”¨æƒ…å†µ
â€¢ æ¡ä»¶è¿‡æ»¤æ•ˆç‡
â€¢ ä¸´æ—¶è¡¨å’Œæ’åºå¼€é”€
```

**ğŸŒ° ä¸¾ä¸ªä¾‹å­**ï¼šåˆ†æä¸€ä¸ªå¤æ‚çš„æŠ¥è¡¨æŸ¥è¯¢

```sql
-- å¤æ‚æŠ¥è¡¨æŸ¥è¯¢
SELECT 
    d.name as department,
    u.name as manager,
    COUNT(DISTINCT e.id) as employee_count,
    AVG(s.amount) as avg_salary,
    (SELECT COUNT(*) FROM projects p WHERE p.department_id = d.id AND p.status = 'active') as active_projects
FROM departments d
JOIN users u ON d.manager_id = u.id
LEFT JOIN employees e ON d.id = e.department_id  
LEFT JOIN salaries s ON e.id = s.employee_id AND s.year = 2024
WHERE d.active = 1
  AND u.role = 'manager'
  AND (e.status = 'active' OR e.status IS NULL)
GROUP BY d.id, d.name, u.id, u.name
HAVING employee_count > 5
ORDER BY avg_salary DESC;
```

**åˆ†å±‚åˆ†æç»“æœ**ï¼š
```
=== æ•´ä½“ç»“æ„åˆ†æ ===
1 PRIMARY (Main query)
`- departments â†’ users â†’ employees â†’ salaries
`- Correlated subquery for active_projects

=== èŠ‚ç‚¹æˆæœ¬åˆ†æ ===  
Total cost: 12,500 units

departments scan: 125 units (1%)     ğŸŸ¢
users join: 50 units (0.4%)          ğŸŸ¢  
employees join: 8,500 units (68%)    ğŸ”´ BOTTLENECK
salaries join: 2,800 units (22%)     ğŸŸ¡
subquery: 1,025 units (8%)           ğŸŸ¡

=== è¯¦ç»†åˆ†æ ===
ğŸ”´ Critical issue: employees table
`- Full table scan
   rows: 500,000
   condition: status='active' OR status IS NULL
   recommendation: ADD INDEX idx_emp_dept_status ON employees(department_id, status)

ğŸŸ¡ Moderate issue: salaries aggregation  
`- Large temporary table for GROUP BY
   recommendation: Consider pre-aggregation or materialized view

ğŸŸ¡ Subquery efficiency
`- Executed once per department (correlated)
   recommendation: Convert to LEFT JOIN if possible
```

### 5.3 ç”Ÿäº§ç¯å¢ƒçš„ç›‘æ§åº”ç”¨


**ğŸ¯ å­¦ä¹ ç›®æ ‡**ï¼šäº†è§£å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç³»ç»Ÿæ€§åœ°ä½¿ç”¨pt-visual-explain

**ğŸ› ï¸ å·¥å…·æ¨è**ï¼šç»“åˆç›‘æ§ç³»ç»Ÿçš„è‡ªåŠ¨åŒ–åˆ†æ

```bash
# è„šæœ¬ç¤ºä¾‹ï¼šè‡ªåŠ¨åˆ†ææ…¢æŸ¥è¯¢
#!/bin/bash
# slow_query_analyzer.sh

# 1. æå–æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­çš„SQL
pt-query-digest /var/log/mysql/slow.log --print --no-report > slow_queries.sql

# 2. æ‰¹é‡ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
while IFS= read -r query; do
    echo "EXPLAIN $query" | mysql -u monitor -p > explain_tmp.txt
    
    # 3. å¯è§†åŒ–åˆ†æ
    pt-visual-explain explain_tmp.txt > "visual_$(date +%s).txt"
    
    # 4. æå–ä¼˜åŒ–å»ºè®®
    grep -A 5 "Optimization suggestions" "visual_$(date +%s).txt" >> daily_recommendations.txt
    
done < slow_queries.sql

# 5. ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š
echo "=== Daily Performance Analysis Report ===" > daily_report.txt
echo "Date: $(date)" >> daily_report.txt
echo "Critical issues found: $(grep -c "MAJOR ISSUE" visual_*.txt)" >> daily_report.txt
echo "Optimization opportunities: $(grep -c "suggestion" daily_recommendations.txt)" >> daily_report.txt
```

**ğŸ“Š æ•°æ®è¯´è¯**ï¼šç›‘æ§æŒ‡æ ‡çš„è®¾å®š

```
å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š

ğŸ”´ ç´§æ€¥æŒ‡æ ‡ (ç«‹å³å¤„ç†)ï¼š
â€¢ å•æŸ¥è¯¢æˆæœ¬ > 10,000 units
â€¢ æ‰«æè¡Œæ•° > 1,000,000 rows  
â€¢ ä¸´æ—¶è¡¨å¤§å° > 500MB
â€¢ æ‰§è¡Œæ—¶é—´ > 30 seconds

ğŸŸ¡ è­¦å‘ŠæŒ‡æ ‡ (ä¼˜åŒ–è®¡åˆ’)ï¼š
â€¢ å•æŸ¥è¯¢æˆæœ¬ 1,000-10,000 units
â€¢ æ‰«æè¡Œæ•° 100,000-1,000,000 rows
â€¢ æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
â€¢ é¢‘ç¹æ‰§è¡Œçš„ä½æ•ˆæŸ¥è¯¢

ğŸŸ¢ æ­£å¸¸æŒ‡æ ‡ (å®šæœŸæ£€æŸ¥)ï¼š
â€¢ å•æŸ¥è¯¢æˆæœ¬ < 1,000 units  
â€¢ ç´¢å¼•ä½¿ç”¨ç‡ > 90%
â€¢ æŸ¥è¯¢å“åº”æ—¶é—´ < 1 second
â€¢ ä¸´æ—¶è¡¨ä½¿ç”¨ < 10MB
```

**ğŸ¨ æ›´å¤šæ ·çš„ASCIIè£…é¥°**ï¼šæŠ¥å‘Šæ¨¡æ¿ç¤ºä¾‹

```
â”Œâ”€â”€â”€ MySQL Performance Analysis Report â”€â”€â”€â”
â”‚ Generated by pt-visual-explain          â”‚
â”‚ Date: 2024-09-11                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š Summary Statistics                   â”‚
â”‚ â€¢ Queries analyzed: 156                 â”‚
â”‚ â€¢ Critical issues: 8                    â”‚  
â”‚ â€¢ Optimization opportunities: 23        â”‚
â”‚ â€¢ Estimated time savings: 2.5 hours     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”¥ Top 3 Performance Issues            â”‚
â”‚ 1. User report query (cost: 45,000)     â”‚
â”‚ 2. Order analytics (cost: 32,000)       â”‚  
â”‚ 3. Inventory sync (cost: 28,000)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ Quick Wins (Easy optimizations)     â”‚
â”‚ â€¢ Add index on orders.status             â”‚
â”‚ â€¢ Update table statistics                â”‚
â”‚ â€¢ Rewrite user_count subquery           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ pt-visual-explainæœ¬è´¨ï¼šå°†MySQLçš„è¡¨æ ¼å¼EXPLAINè½¬æ¢ä¸ºç›´è§‚çš„æ ‘çŠ¶å›¾
ğŸ”¸ æ ¸å¿ƒä»·å€¼ï¼šå¿«é€Ÿè¯†åˆ«æŸ¥è¯¢æ‰§è¡Œé¡ºåºã€æ•°æ®æµå‘å’Œæ€§èƒ½ç“¶é¢ˆ
ğŸ”¸ å·¥ä½œåŸç†ï¼šè§£æEXPLAINç»“æœ â†’ åˆ†æå…³ç³» â†’ é‡æ„æ ‘å½¢ â†’ ç”Ÿæˆå»ºè®®
ğŸ”¸ ä½¿ç”¨åœºæ™¯ï¼šæ—¥å¸¸ä¼˜åŒ–ã€å¤æ‚æŸ¥è¯¢è°ƒè¯•ã€ç”Ÿäº§ç¯å¢ƒç›‘æ§
ğŸ”¸ è¾“å‡ºæ ¼å¼ï¼šæ ‘å½¢æ–‡æœ¬ã€ç´§å‡‘æ ¼å¼ã€è¿æ¥è¯¦æƒ…ç­‰å¤šç§é€‰æ‹©
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¯è§†åŒ–çš„çœŸæ­£ä»·å€¼**
```
ä¸åªæ˜¯å¥½çœ‹ï¼š
â€¢ é™ä½å­¦ä¹ é—¨æ§›ï¼šæ–°æ‰‹ä¹Ÿèƒ½çœ‹æ‡‚æ‰§è¡Œè®¡åˆ’
â€¢ æé«˜åˆ†ææ•ˆç‡ï¼šå¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨
â€¢ è¾…åŠ©å†³ç­–ï¼šåŸºäºå¯è§†åŒ–ç»“æœåˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
â€¢ ä¾¿äºäº¤æµï¼šå›¢é˜Ÿè®¨è®ºæ—¶æ›´ç›´è§‚
```

**ğŸ”¹ æˆæœ¬åˆ†æçš„å®ç”¨æ€§**
```
æˆæœ¬ä¸æ˜¯ç»å¯¹å€¼ï¼š
â€¢ ç›¸å¯¹æ¯”è¾ƒæ›´é‡è¦ï¼šæ‰¾å‡ºæˆæœ¬å æ¯”æœ€é«˜çš„æ“ä½œ
â€¢ ç»“åˆå®é™…æƒ…å†µï¼šå°è¡¨çš„é«˜æˆæœ¬å¯èƒ½æ— å…³ç´§è¦
â€¢ å…³æ³¨è¶‹åŠ¿å˜åŒ–ï¼šæˆæœ¬å¢é•¿è¶‹åŠ¿æ¯”ç»å¯¹å€¼æ›´å±é™©
â€¢ éªŒè¯ä¼˜åŒ–æ•ˆæœï¼šé€šè¿‡æˆæœ¬å¯¹æ¯”éªŒè¯ä¼˜åŒ–æ˜¯å¦æœ‰æ•ˆ
```

**ğŸ”¹ ç“¶é¢ˆè¯†åˆ«çš„æ–¹æ³•è®º**
```
ç³»ç»Ÿæ€§åˆ†æï¼š
â€¢ å…ˆçœ‹æ•´ä½“å†çœ‹å±€éƒ¨ï¼šæ€»ä½“æˆæœ¬åˆ†å¸ƒ â†’ å…·ä½“èŠ‚ç‚¹é—®é¢˜
â€¢ æŠ“ä¸»è¦çŸ›ç›¾ï¼šä¼˜å…ˆè§£å†³æˆæœ¬å æ¯”æœ€é«˜çš„é—®é¢˜
â€¢ è€ƒè™‘ä¼˜åŒ–éš¾åº¦ï¼šç®€å•ä¼˜åŒ–å…ˆåšï¼Œå¤æ‚æ”¹é€ ååš
â€¢ æŒç»­ç›‘æ§éªŒè¯ï¼šä¼˜åŒ–åè¦è·Ÿè¸ªæ•ˆæœå˜åŒ–
```

### 6.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ æœ€ä½³å®è·µ**ï¼š
- **å®šæœŸåˆ†æ**ï¼šå°†pt-visual-explainçº³å…¥æ—¥å¸¸SQL reviewæµç¨‹
- **è‡ªåŠ¨åŒ–ç›‘æ§**ï¼šç»“åˆè„šæœ¬å®ç°æ…¢æŸ¥è¯¢çš„è‡ªåŠ¨å¯è§†åŒ–åˆ†æ
- **å›¢é˜ŸåŸ¹è®­**ï¼šè®©å›¢é˜Ÿæˆå‘˜éƒ½ä¼šè¯»æ‡‚å¯è§†åŒ–ç»“æœ
- **å»ºç«‹æ ‡å‡†**ï¼šåˆ¶å®šåŸºäºæˆæœ¬çš„æŸ¥è¯¢æ€§èƒ½æ ‡å‡†

**ğŸ’¥ å®¹æ˜“å‡ºé”™**ï¼š
- **è¿‡åº¦ä¾èµ–å·¥å…·**ï¼šå¯è§†åŒ–ç»“æœä»éœ€ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯åˆ†æ
- **å¿½ç•¥æ•°æ®å˜åŒ–**ï¼šè¡¨æ•°æ®é‡å˜åŒ–ä¼šå½±å“æ‰§è¡Œè®¡åˆ’çš„å‡†ç¡®æ€§
- **ç›²ç›®ä¼˜åŒ–**ï¼šä¸æ˜¯æ‰€æœ‰å»ºè®®éƒ½é€‚åˆå½“å‰ç¯å¢ƒ
- **ç¼ºä¹éªŒè¯**ï¼šä¼˜åŒ–åå¿…é¡»é€šè¿‡å®é™…æµ‹è¯•éªŒè¯æ•ˆæœ

### 6.4 å·¥å…·ä½¿ç”¨æŠ€å·§


**âš¡ å¿«é€Ÿä¸Šæ‰‹**ï¼š
```bash
# æ–°æ‰‹æ¨èçš„ä½¿ç”¨æ–¹å¼
mysql -e "EXPLAIN SELECT ..." | pt-visual-explain --connect

# æ—¥å¸¸ç›‘æ§çš„ä½¿ç”¨æ–¹å¼  
pt-visual-explain --compact slow_query_explains.txt

# æ·±å…¥åˆ†æçš„ä½¿ç”¨æ–¹å¼
pt-visual-explain --format=tree --show-cost detailed_explain.txt
```

**ğŸ”‘ å…³é”®è¯æå–**ï¼š
- **å¯è§†åŒ–** - å°†æŠ½è±¡çš„æ‰§è¡Œè®¡åˆ’å˜æˆç›´è§‚çš„æ ‘çŠ¶å›¾
- **æˆæœ¬åˆ†æ** - é‡åŒ–æ¯ä¸ªæ“ä½œçš„èµ„æºæ¶ˆè€—
- **ç“¶é¢ˆè¯†åˆ«** - å¿«é€Ÿæ‰¾åˆ°æ€§èƒ½é—®é¢˜çš„æ ¹æº  
- **ä¼˜åŒ–å»ºè®®** - åŸºäºåˆ†æç»“æœæä¾›æ”¹è¿›æ–¹æ¡ˆ
- **è‡ªåŠ¨åŒ–ç›‘æ§** - æ‰¹é‡å¤„ç†å’ŒæŒç»­è·Ÿè¸ª

**ğŸª è®°å¿†æŠ€å·§**ï¼š
- **ä»ä¸Šåˆ°ä¸‹çœ‹æ‰§è¡Œï¼Œä»ä¸‹åˆ°ä¸Šçœ‹æ•°æ®æµ**
- **æˆæœ¬é«˜çš„åœ°æ–¹å°±æ˜¯ä¼˜åŒ–ç‚¹**  
- **æ ‘å½¢å›¾è®©å¤æ‚æŸ¥è¯¢å˜ç®€å•**
- **å·¥å…·ç»™å»ºè®®ï¼Œå®é™…æµ‹è¯•æ˜¯å…³é”®**

**ğŸ“ ä¸€å¥è¯æ€»ç»“**ï¼špt-visual-explainæ˜¯MySQLæŸ¥è¯¢ä¼˜åŒ–çš„æ”¾å¤§é•œï¼Œè®©æ€§èƒ½é—®é¢˜æ— å¤„è—èº«ï¼Œè®©ä¼˜åŒ–æ–¹å‘ä¸€ç›®äº†ç„¶ã€‚

**ğŸŒ å®é™…åº”ç”¨**ï¼š
- å¼€å‘é˜¶æ®µçš„SQL reviewå’Œä¼˜åŒ–
- ç”Ÿäº§ç¯å¢ƒçš„æ…¢æŸ¥è¯¢åˆ†æå’Œç›‘æ§  
- å›¢é˜ŸåŸ¹è®­å’ŒçŸ¥è¯†åˆ†äº«
- æ•°æ®åº“è¿ç§»å‰çš„æ€§èƒ½è¯„ä¼°

**ğŸ”„ çŸ¥è¯†ä¸²è”**ï¼š
- ä¸`EXPLAIN`å‘½ä»¤é…åˆä½¿ç”¨è·å–åŸå§‹æ•°æ®
- ä¸`pt-query-digest`ç»“åˆè¿›è¡Œæ…¢æŸ¥è¯¢æ‰¹é‡åˆ†æ
- ä¸ç›‘æ§ç³»ç»Ÿé›†æˆå®ç°è‡ªåŠ¨åŒ–æ€§èƒ½è¯Šæ–­
- ä¸ç´¢å¼•è®¾è®¡å’ŒæŸ¥è¯¢é‡å†™å½¢æˆå®Œæ•´ä¼˜åŒ–é“¾è·¯