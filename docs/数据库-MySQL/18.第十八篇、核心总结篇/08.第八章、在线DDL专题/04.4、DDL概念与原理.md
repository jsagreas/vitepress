---
title: 4ã€DDLæ¦‚å¿µä¸ŽåŽŸç†
---
## ðŸ“š ç›®å½•

1. [Online DDLåŸºç¡€æ¦‚å¿µ](#1-Online-DDLåŸºç¡€æ¦‚å¿µ)
2. [åœ¨çº¿è¡¨ç»“æž„å˜æ›´åŽŸç†](#2-åœ¨çº¿è¡¨ç»“æž„å˜æ›´åŽŸç†)
3. [DDLæ‰§è¡Œé˜¶æ®µè¯¦è§£](#3-DDLæ‰§è¡Œé˜¶æ®µè¯¦è§£)
4. [å…ƒæ•°æ®é”MDLæœºåˆ¶](#4-å…ƒæ•°æ®é”MDLæœºåˆ¶)
5. [æ•°æ®å¤„ç†æ ¸å¿ƒç®—æ³•](#5-æ•°æ®å¤„ç†æ ¸å¿ƒç®—æ³•)
6. [å¹¶å‘æŽ§åˆ¶ä¸Žä¸€è‡´æ€§ä¿è¯](#6-å¹¶å‘æŽ§åˆ¶ä¸Žä¸€è‡´æ€§ä¿è¯)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸš€ Online DDLåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Online DDL


**ðŸ“‹ æ ¸å¿ƒå®šä¹‰**
```
Online DDL = åœ¨çº¿æ•°æ®å®šä¹‰è¯­è¨€æ“ä½œ
æœ¬è´¨ï¼šåœ¨ä¸é˜»å¡žä¸šåŠ¡è¯»å†™çš„æƒ…å†µä¸‹ä¿®æ”¹è¡¨ç»“æž„
ç›®æ ‡ï¼šè®©æ•°æ®åº“è¡¨ç»“æž„å˜æ›´å¯¹ä¸šåŠ¡å½±å“æœ€å°åŒ–
```

**ðŸ”¸ ä¼ ç»ŸDDLçš„ç—›ç‚¹**
```
ä¼ ç»Ÿæ–¹å¼ï¼šä¿®æ”¹è¡¨ç»“æž„æ—¶å®Œå…¨é”è¡¨
é—®é¢˜è¡¨çŽ°ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡è¯·æ±‚é˜»å¡ž    â”‚ â† ç”¨æˆ·æ— æ³•è®¿é—®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ•°æ®åº“é”è¡¨      â”‚ â† è¡¨ç»“æž„ä¿®æ”¹ä¸­
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœåŠ¡ä¸å¯ç”¨      â”‚ â† å½±å“çº¿ä¸Šä¸šåŠ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½±å“ï¼šå¤§è¡¨ä¿®æ”¹å¯èƒ½éœ€è¦å‡ å°æ—¶ï¼Œä¸šåŠ¡å®Œå…¨åœæ­¢
```

**ðŸ’¡ Online DDLçš„ä¼˜åŠ¿**
```
åœ¨çº¿æ–¹å¼ï¼šè¾¹ä¿®æ”¹è¡¨ç»“æž„è¾¹æä¾›æœåŠ¡
ä¼˜åŠ¿å¯¹æ¯”ï¼š

ä¼ ç»ŸDDL                    Online DDL
   â†“                          â†“
ä¸šåŠ¡åœæ­¢ âŒ              ä¸šåŠ¡ç»§ç»­ âœ…
ç”¨æˆ·ç­‰å¾… âŒ              æ­£å¸¸è®¿é—® âœ…
é£Žé™©å¾ˆé«˜ âŒ              é£Žé™©å¯æŽ§ âœ…
```

### 1.2 Online DDLçš„é€‚ç”¨åœºæ™¯


**âœ… æ”¯æŒçš„æ“ä½œç±»åž‹**
```
ç»“æž„å˜æ›´ï¼š
â€¢ æ·»åŠ /åˆ é™¤åˆ—
â€¢ æ·»åŠ /åˆ é™¤ç´¢å¼•
â€¢ ä¿®æ”¹åˆ—å±žæ€§
â€¢ é‡å‘½åè¡¨/åˆ—

çº¦æŸå˜æ›´ï¼š
â€¢ æ·»åŠ /åˆ é™¤å¤–é”®
â€¢ æ·»åŠ /åˆ é™¤æ£€æŸ¥çº¦æŸ
â€¢ ä¿®æ”¹ä¸»é”®

åˆ†åŒºæ“ä½œï¼š
â€¢ æ·»åŠ /åˆ é™¤åˆ†åŒº
â€¢ é‡ç»„åˆ†åŒº
```

**âš ï¸ é™åˆ¶ä¸Žæ³¨æ„äº‹é¡¹**
```
ä¸æ”¯æŒçš„æ“ä½œï¼š
âŒ ä¿®æ”¹åˆ—æ•°æ®ç±»åž‹ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µï¼‰
âŒ åˆ é™¤ä¸»é”®åˆ—
âŒ æŸäº›å¤æ‚çš„è¡¨ç»“æž„è°ƒæ•´

æ€§èƒ½å½±å“ï¼š
âš¡ è™½ç„¶ä¸é˜»å¡žï¼Œä½†ä¼šæ¶ˆè€—é¢å¤–èµ„æº
âš¡ å¤§è¡¨æ“ä½œä»éœ€è°¨æ…Žè§„åˆ’
```

---

## 2. âš™ï¸ åœ¨çº¿è¡¨ç»“æž„å˜æ›´åŽŸç†


### 2.1 æ ¸å¿ƒåŽŸç†æ¦‚è¿°


**ðŸŽ¯ åŸºæœ¬æ€è·¯**
```
æ ¸å¿ƒç†å¿µï¼šåˆ›å»ºæ–°ç»“æž„ + æ•°æ®è¿ç§» + åŽŸå­åˆ‡æ¢

å·¥ä½œæµç¨‹ï¼š
åŽŸè¡¨ â†’ åˆ›å»ºæ–°è¡¨ â†’ æ•°æ®æ‹·è´ â†’ å¢žé‡åŒæ­¥ â†’ åŽŸå­æ›¿æ¢
  A        B          C         D         E

è¿‡ç¨‹è¯´æ˜Žï¼š
A: ä¿æŒåŽŸè¡¨æ­£å¸¸æœåŠ¡
B: æŒ‰æ–°ç»“æž„åˆ›å»ºä¸´æ—¶è¡¨
C: å°†åŽŸè¡¨æ•°æ®å¤åˆ¶åˆ°æ–°è¡¨
D: åŒæ­¥æœŸé—´çš„å¢žé‡å˜æ›´
E: ä¸€çž¬é—´å®Œæˆè¡¨çš„æ›¿æ¢
```

### 2.2 æŠ€æœ¯å®žçŽ°æž¶æž„


**ðŸ—ï¸ ç³»ç»Ÿæž¶æž„å›¾**
```
            ç”¨æˆ·åº”ç”¨å±‚
                â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     MySQL Server        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚   Online DDL    â”‚    â”‚
    â”‚  â”‚   æŽ§åˆ¶å™¨         â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚           â†“             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚   å…ƒæ•°æ®é”      â”‚    â”‚
    â”‚  â”‚   ç®¡ç†å™¨         â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚           â†“             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚  â”‚   å­˜å‚¨å¼•æ“Ž      â”‚    â”‚
    â”‚  â”‚   (InnoDB)      â”‚    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ðŸ”§ å…³é”®ç»„ä»¶åŠŸèƒ½**
```
Online DDLæŽ§åˆ¶å™¨ï¼š
â€¢ åè°ƒæ•´ä¸ªDDLæ‰§è¡Œè¿‡ç¨‹
â€¢ ç®¡ç†å„ä¸ªé˜¶æ®µçš„çŠ¶æ€è½¬æ¢
â€¢ å¤„ç†å¼‚å¸¸æƒ…å†µå’Œå›žæ»š

å…ƒæ•°æ®é”ç®¡ç†å™¨ï¼š
â€¢ æŽ§åˆ¶è¡¨ç»“æž„çš„è®¿é—®æƒé™
â€¢ åè°ƒè¯»å†™æ“ä½œä¸ŽDDLçš„å†²çª
â€¢ ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

å­˜å‚¨å¼•æ“Žï¼š
â€¢ å®žé™…çš„æ•°æ®æ“ä½œæ‰§è¡Œ
â€¢ ä¸´æ—¶è¡¨çš„åˆ›å»ºå’Œç®¡ç†
â€¢ æ•°æ®æ‹·è´å’Œå˜æ›´æ—¥å¿—è®°å½•
```

---

## 3. ðŸ“Š DDLæ‰§è¡Œé˜¶æ®µè¯¦è§£


### 3.1 ä¸‰å¤§æ‰§è¡Œé˜¶æ®µ


**â­ é˜¶æ®µæ¦‚è§ˆ**
```
æ‰§è¡Œæµç¨‹ï¼šå‡†å¤‡é˜¶æ®µ â†’ æ‰§è¡Œé˜¶æ®µ â†’ æäº¤é˜¶æ®µ
æ—¶é—´å æ¯”ï¼š   5%    â†’   90%   â†’   5%
é”å®šå½±å“ï¼š  çŸ­æš‚    â†’   æ— é”   â†’  çŸ­æš‚

é˜¶æ®µç‰¹ç‚¹ï¼š
å‡†å¤‡ï¼šçŸ­æ—¶é—´æŽ’ä»–é”ï¼Œæ£€æŸ¥å¯è¡Œæ€§
æ‰§è¡Œï¼šé•¿æ—¶é—´æ— é”ï¼Œå®Œæˆä¸»è¦å·¥ä½œ  
æäº¤ï¼šçŸ­æ—¶é—´æŽ’ä»–é”ï¼ŒåŽŸå­åˆ‡æ¢
```

### 3.2 å‡†å¤‡é˜¶æ®µæ“ä½œè¯¦è§£


**ðŸ”¸ å‡†å¤‡é˜¶æ®µæ ¸å¿ƒä»»åŠ¡**
```
ä»»åŠ¡æ¸…å•ï¼š
1ï¸âƒ£ èŽ·å–è¡¨çš„å…ƒæ•°æ®é”ï¼ˆMDLå†™é”ï¼‰
2ï¸âƒ£ æ£€æŸ¥DDLæ“ä½œçš„å¯è¡Œæ€§
3ï¸âƒ£ åˆ›å»ºä¸´æ—¶è¡¨ç»“æž„
4ï¸âƒ£ åˆå§‹åŒ–å˜æ›´æ—¥å¿—ç¼“å†²åŒº
5ï¸âƒ£ é‡Šæ”¾å…ƒæ•°æ®é”ï¼Œé™çº§ä¸ºè¯»é”

æ—¶é—´ç‰¹ç‚¹ï¼šé€šå¸¸å‡ æ¯«ç§’åˆ°å‡ ç§’
å½±å“èŒƒå›´ï¼šçŸ­æš‚é˜»å¡žæ–°çš„å†™æ“ä½œ
```

**ðŸ’¡ å¯è¡Œæ€§æ£€æŸ¥å†…å®¹**
```
æ£€æŸ¥é¡¹ç›®ï¼š
âœ… è¡¨ç»“æž„æ˜¯å¦æ”¯æŒOnline DDL
âœ… å­˜å‚¨å¼•æ“Žæ˜¯å¦å…¼å®¹
âœ… ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³
âœ… å¤–é”®çº¦æŸæ˜¯å¦å†²çª
âœ… è§¦å‘å™¨å½±å“è¯„ä¼°

æ£€æŸ¥å¤±è´¥ â†’ ç«‹å³ç»ˆæ­¢ï¼Œä¸å½±å“ä¸šåŠ¡
æ£€æŸ¥é€šè¿‡ â†’ è¿›å…¥æ‰§è¡Œé˜¶æ®µ
```

### 3.3 æ‰§è¡Œé˜¶æ®µå¤„ç†æœºåˆ¶


**ðŸš€ æ‰§è¡Œé˜¶æ®µæ ¸å¿ƒå·¥ä½œ**
```
ä¸»è¦ä»»åŠ¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®æ‹·è´      â”‚    â”‚   å¢žé‡æ—¥å¿—      â”‚
â”‚                 â”‚    â”‚                 â”‚
â”‚ åŽŸè¡¨ â†’ ä¸´æ—¶è¡¨   â”‚ +  â”‚ DMLæ“ä½œè®°å½•     â”‚
â”‚ æŒ‰æ–°ç»“æž„ç»„ç»‡    â”‚    â”‚ å®žæ—¶æ•èŽ·å˜æ›´    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                       â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        å¹¶è¡Œæ‰§è¡Œä¸å†²çª          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**âš¡ æ•°æ®æ‹·è´ç®—æ³•**
```
æ‹·è´ç­–ç•¥ï¼š
â€¢ æŒ‰ä¸»é”®é¡ºåºåˆ†æ‰¹æ‹·è´
â€¢ æ¯æ‰¹å¤„ç†å›ºå®šè¡Œæ•°ï¼ˆå¦‚1000è¡Œï¼‰
â€¢ æ‰¹æ¬¡é—´é‡Šæ”¾é”ï¼Œå…è®¸å…¶ä»–æ“ä½œ
â€¢ æ”¯æŒæ–­ç‚¹ç»­ä¼ å’Œè¿›åº¦ç›‘æŽ§

ä¼ªä»£ç é€»è¾‘ï¼š
while (è¿˜æœ‰æ•°æ®æœªæ‹·è´) {
    å¼€å§‹äº‹åŠ¡
    æ‹·è´ä¸€æ‰¹æ•°æ®åˆ°ä¸´æ—¶è¡¨
    æäº¤äº‹åŠ¡
    çŸ­æš‚ä¼‘æ¯ï¼ˆè®©å‡ºCPUï¼‰
}
```

### 3.4 æäº¤é˜¶æ®µæœºåˆ¶


**ðŸŽ¯ æäº¤é˜¶æ®µå…³é”®æ­¥éª¤**
```
æäº¤æµç¨‹ï¼š
1ï¸âƒ£ å†æ¬¡èŽ·å–å…ƒæ•°æ®å†™é”
2ï¸âƒ£ åº”ç”¨æ‰§è¡Œé˜¶æ®µçš„å¢žé‡å˜æ›´
3ï¸âƒ£ éªŒè¯æ•°æ®ä¸€è‡´æ€§
4ï¸âƒ£ åŽŸå­æ€§æ›¿æ¢è¡¨ç»“æž„
5ï¸âƒ£ æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—
6ï¸âƒ£ é‡Šæ”¾æ‰€æœ‰é”

æ—¶é—´è¦æ±‚ï¼šå¿…é¡»å°½å¯èƒ½å¿«ï¼ˆç§’çº§ï¼‰
å…³é”®ç‚¹ï¼šè¿™ä¸ªé˜¶æ®µå†³å®šDDLæˆè´¥
```

**ðŸ”„ åŽŸå­æ€§æ›¿æ¢è¿‡ç¨‹**
```
æ›¿æ¢æœºåˆ¶ï¼š
æ—§è¡¨å â†’ ä¸´æ—¶å¤‡ä»½å
æ–°è¡¨å â†’ æ­£å¼è¡¨å
ä¸´æ—¶è¡¨ â†’ åˆ é™¤

æ“ä½œç‰¹ç‚¹ï¼š
â€¢ åŽŸå­æ€§ï¼šè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥
â€¢ çž¬é—´å®Œæˆï¼šç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°åˆ‡æ¢è¿‡ç¨‹
â€¢ å¯å›žæ»šï¼šå‡ºé”™æ—¶è‡ªåŠ¨æ¢å¤åŽŸçŠ¶æ€
```

---

## 4. ðŸ”’ å…ƒæ•°æ®é”MDLæœºåˆ¶


### 4.1 MDLåŸºç¡€æ¦‚å¿µ


**ðŸ“‹ ä»€ä¹ˆæ˜¯å…ƒæ•°æ®é”**
```
MDL = Metadata Lockï¼ˆå…ƒæ•°æ®é”ï¼‰
ä½œç”¨ï¼šä¿æŠ¤è¡¨ç»“æž„å®šä¹‰ä¿¡æ¯çš„ä¸€è‡´æ€§
èŒƒå›´ï¼šè¡¨ç»“æž„ã€ç´¢å¼•å®šä¹‰ã€çº¦æŸä¿¡æ¯ç­‰

ç®€å•ç†è§£ï¼š
å…ƒæ•°æ® = æ•°æ®çš„æè¿°ä¿¡æ¯
å…ƒæ•°æ®é” = ä¿æŠ¤è¿™äº›æè¿°ä¿¡æ¯çš„é”
```

**ðŸ”¸ MDLé”çš„ç±»åž‹**
```
é”ç±»åž‹å±‚çº§ï¼š
MDL_INTENTION_EXCLUSIVE    â† æœ€é«˜çº§åˆ«
         â†‘
MDL_SHARED_WRITE          â† DMLå†™æ“ä½œ
         â†‘  
MDL_SHARED_READ           â† DMLè¯»æ“ä½œ
         â†‘
MDL_SHARED                â† æœ€ä½Žçº§åˆ«

å…¼å®¹æ€§è§„åˆ™ï¼š
âœ… å¤šä¸ªè¯»é”å¯ä»¥å…±å­˜
âœ… è¯»é”ä¸Žå†™é”å¯ä»¥å…±å­˜  
âŒ æŽ’ä»–é”ä¸Žä»»ä½•é”äº’æ–¥
```

### 4.2 MDLåœ¨Online DDLä¸­çš„ä½œç”¨


**ðŸŽ¯ é”çš„èŽ·å–æ—¶æœº**
```
DDLæ‰§è¡Œè¿‡ç¨‹ä¸­çš„é”å˜åŒ–ï¼š

å‡†å¤‡é˜¶æ®µï¼š
MDL_EXCLUSIVE â†’ æŽ’ä»–é”ï¼ŒçŸ­æš‚æŒæœ‰
ç”¨é€”ï¼šç¡®ä¿è¡¨ç»“æž„ç¨³å®šï¼Œåˆ›å»ºä¸´æ—¶è¡¨

æ‰§è¡Œé˜¶æ®µï¼š  
MDL_SHARED_READ â†’ å…±äº«è¯»é”ï¼Œé•¿æœŸæŒæœ‰
ç”¨é€”ï¼šå…è®¸DMLæ“ä½œï¼Œç¦æ­¢å…¶ä»–DDL

æäº¤é˜¶æ®µï¼š
MDL_EXCLUSIVE â†’ æŽ’ä»–é”ï¼ŒçŸ­æš‚æŒæœ‰  
ç”¨é€”ï¼šåŽŸå­æ€§å®Œæˆè¡¨ç»“æž„æ›¿æ¢
```

**âš–ï¸ é”å†²çªå¤„ç†æœºåˆ¶**
```
å†²çªåœºæ™¯ä¸Žå¤„ç†ï¼š

åœºæ™¯1ï¼šDDLç­‰å¾…å…¶ä»–äº‹åŠ¡é‡Šæ”¾é”
å¤„ç†ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ— é™ç­‰å¾…

åœºæ™¯2ï¼šDMLæ“ä½œè¢«DDLé˜»å¡ž
å¤„ç†ï¼šä¼˜åŒ–é”æŒæœ‰æ—¶é—´ï¼Œå¿«é€Ÿé‡Šæ”¾

åœºæ™¯3ï¼šå¤šä¸ªDDLæ“ä½œå†²çª
å¤„ç†ï¼šæŽ’é˜Ÿæœºåˆ¶ï¼Œä¸²è¡Œæ‰§è¡Œ
```

---

## 5. ðŸ’¾ æ•°æ®å¤„ç†æ ¸å¿ƒç®—æ³•


### 5.1 ä¸´æ—¶è¡¨åˆ›å»ºè¿‡ç¨‹


**ðŸ—ï¸ ä¸´æ—¶è¡¨åˆ›å»ºæµç¨‹**
```
åˆ›å»ºæ­¥éª¤ï¼š
1ï¸âƒ£ ç”Ÿæˆä¸´æ—¶è¡¨åï¼ˆé€šå¸¸å¸¦ç‰¹æ®Šå‰ç¼€ï¼‰
2ï¸âƒ£ æŒ‰ç…§ç›®æ ‡ç»“æž„å®šä¹‰è¡¨Schema
3ï¸âƒ£ åœ¨åŒä¸€è¡¨ç©ºé—´åˆ›å»ºä¸´æ—¶è¡¨
4ï¸âƒ£ è®¾ç½®ä¸´æ—¶è¡¨çš„è®¿é—®æƒé™
5ï¸âƒ£ å‡†å¤‡æ•°æ®æ‹·è´çš„æ˜ å°„å…³ç³»

ä¸´æ—¶è¡¨ç‰¹ç‚¹ï¼š
â€¢ å¯¹ç”¨æˆ·ä¸å¯è§
â€¢ ä¸ŽåŽŸè¡¨åœ¨åŒä¸€å­˜å‚¨ä½ç½®
â€¢ å…·æœ‰ç›®æ ‡çš„æ–°è¡¨ç»“æž„
â€¢ æ”¯æŒå¹¶å‘è®¿é—®æŽ§åˆ¶
```

**ðŸ“Š Schemaæ˜ å°„å¤„ç†**
```
å­—æ®µæ˜ å°„ç¤ºä¾‹ï¼š

åŽŸè¡¨ç»“æž„ï¼š               æ–°è¡¨ç»“æž„ï¼š
id INT                  id INT
name VARCHAR(50)   â†’    name VARCHAR(100)  â† æ‰©å±•é•¿åº¦
age INT                 age INT
                        email VARCHAR(100)  â† æ–°å¢žå­—æ®µ

æ˜ å°„è§„åˆ™ï¼š
â€¢ ç›¸åŒå­—æ®µï¼šç›´æŽ¥æ‹·è´
â€¢ ä¿®æ”¹å­—æ®µï¼šæŒ‰æ–°è§„åˆ™è½¬æ¢
â€¢ æ–°å¢žå­—æ®µï¼šå¡«å……é»˜è®¤å€¼
â€¢ åˆ é™¤å­—æ®µï¼šå¿½ç•¥æ•°æ®
```

### 5.2 æ•°æ®æ‹·è´ç®—æ³•è¯¦è§£


**âš¡ åˆ†æ‰¹æ‹·è´ç­–ç•¥**
```
æ‹·è´ç®—æ³•è®¾è®¡ï¼š

æ‰¹æ¬¡åˆ’åˆ†ï¼š
SELECT * FROM åŽŸè¡¨ 
WHERE id >= èµ·å§‹ID AND id < ç»“æŸID
ORDER BY id
LIMIT æ‰¹æ¬¡å¤§å°

ä¼˜åŠ¿åˆ†æžï¼š
âœ… å‡å°‘é”æŒæœ‰æ—¶é—´
âœ… å…è®¸å…¶ä»–æ“ä½œç©¿æ’æ‰§è¡Œ
âœ… æ”¯æŒè¿›åº¦ç›‘æŽ§å’Œæ¢å¤
âœ… é¿å…å†…å­˜ä½¿ç”¨è¿‡å¤š
```

**ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
```
ä¼˜åŒ–ç­–ç•¥ï¼š

1. æ‰¹æ¬¡å¤§å°è°ƒä¼˜ï¼š
   å°æ‰¹æ¬¡ï¼šé”ç«žäº‰å°‘ï¼Œä½†å¼€é”€å¤§
   å¤§æ‰¹æ¬¡ï¼šæ•ˆçŽ‡é«˜ï¼Œä½†é˜»å¡žé•¿
   ç»éªŒå€¼ï¼š1000-10000è¡Œ/æ‰¹æ¬¡

2. å¹¶è¡Œå¤„ç†ï¼š
   å¤šçº¿ç¨‹æ‹·è´ä¸åŒæ•°æ®æ®µ
   é¿å…çƒ­ç‚¹æ•°æ®ç«žäº‰

3. å†…å­˜ç¼“å†²ï¼š
   ä½¿ç”¨ç¼“å†²åŒºå‡å°‘ç£ç›˜IO
   æ‰¹é‡å†™å…¥æé«˜æ•ˆçŽ‡
```

### 5.3 å˜æ›´æ—¥å¿—è®°å½•æœºåˆ¶


**ðŸ“ å¢žé‡å˜æ›´æ•èŽ·**
```
æ—¥å¿—è®°å½•åŽŸç†ï¼š

æ‰§è¡Œé˜¶æ®µæœŸé—´çš„DMLæ“ä½œï¼š
INSERT/UPDATE/DELETE â†’ è®°å½•åˆ°å˜æ›´æ—¥å¿—

æ—¥å¿—å†…å®¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œç±»åž‹         â”‚ â† INSERT/UPDATE/DELETE
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ å½±å“çš„è¡Œæ•°æ®     â”‚ â† ä¸»é”®+å˜æ›´å†…å®¹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¶é—´æˆ³          â”‚ â† æ“ä½œæ—¶é—´åºåˆ—
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ äº‹åŠ¡ä¿¡æ¯        â”‚ â† ä¿è¯ä¸€è‡´æ€§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ðŸ”„ æ—¥å¿—å›žæ”¾æœºåˆ¶**
```
å›žæ”¾è¿‡ç¨‹ï¼š

æäº¤é˜¶æ®µæ—¶ï¼š
1ï¸âƒ£ æŒ‰æ—¶é—´é¡ºåºè¯»å–å˜æ›´æ—¥å¿—
2ï¸âƒ£ å°†å˜æ›´åº”ç”¨åˆ°ä¸´æ—¶è¡¨
3ï¸âƒ£ éªŒè¯æ•°æ®ä¸€è‡´æ€§
4ï¸âƒ£ ç¡®ä¿æ–°è¡¨æ•°æ®å®Œæ•´

å›žæ”¾ç‰¹ç‚¹ï¼š
â€¢ é¡ºåºæ‰§è¡Œï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ å¿«é€Ÿå¤„ç†ï¼šå°½é‡ç¼©çŸ­æäº¤æ—¶é—´
â€¢ æ”¯æŒå›žæ»šï¼šå‡ºé”™æ—¶æ¢å¤åŽŸçŠ¶
```

---

## 6. ðŸ”„ å¹¶å‘æŽ§åˆ¶ä¸Žä¸€è‡´æ€§ä¿è¯


### 6.1 å¹¶å‘DMLå¤„ç†æœºåˆ¶


**ðŸš€ å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶**
```
MVCCåœ¨Online DDLä¸­çš„åº”ç”¨ï¼š

è¯»æ“ä½œï¼š
â€¢ åŸºäºŽå¿«ç…§è¯»å–åŽŸè¡¨æ•°æ®
â€¢ ä¸å—DDLè¿›ç¨‹å½±å“
â€¢ ä¿è¯è¯»ä¸€è‡´æ€§

å†™æ“ä½œï¼š
â€¢ æ­£å¸¸å†™å…¥åŽŸè¡¨
â€¢ åŒæ—¶è®°å½•å˜æ›´æ—¥å¿—  
â€¢ å»¶è¿Ÿåº”ç”¨åˆ°æ–°è¡¨

å¹¶å‘ç¤ºæ„ï¼š
ç”¨æˆ·DML â”€â”€â”€â”€â†’ åŽŸè¡¨ â”€â”€â”€â”€â†’ å˜æ›´æ—¥å¿—
                â†“           â†“
            æŒç»­æœåŠ¡    æäº¤æ—¶å›žæ”¾
```

**âš–ï¸ é”åè°ƒæœºåˆ¶**
```
é”çš„åè°ƒç­–ç•¥ï¼š

DMLä¸ŽDDLçš„åè°ƒï¼š
â€¢ DMLèŽ·å–å…±äº«é”ï¼šæ­£å¸¸æ‰§è¡Œ
â€¢ DDLæŒæœ‰è¯»é”ï¼šä¸é˜»å¡žDML
â€¢ é¿å…æ­»é”ï¼šè®¾ç½®é”ç­‰å¾…è¶…æ—¶

èµ„æºç«žäº‰ç®¡ç†ï¼š
â€¢ CPUï¼šé™åˆ¶DDLè¿›ç¨‹ä¼˜å…ˆçº§
â€¢ å†…å­˜ï¼šæŽ§åˆ¶ç¼“å†²åŒºå¤§å°
â€¢ ç£ç›˜IOï¼šåˆ†æ•£IOè´Ÿè½½
```

### 6.2 åŽŸå­æ€§ä¿è¯æœºåˆ¶


**ðŸŽ¯ äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯**
```
åŽŸå­æ€§å®žçŽ°ï¼š

å…¨å±€äº‹åŠ¡è§†è§’ï¼š
å¼€å§‹DDL â”€â”€â†’ æ•°æ®æ‹·è´ â”€â”€â†’ å¢žé‡åŒæ­¥ â”€â”€â†’ åŽŸå­æäº¤
   â†“           â†“           â†“           â†“
  å¯å›žæ»š      å¯å›žæ»š      å¯å›žæ»š      ä¸å¯å›žæ»š

å…³é”®æ—¶åˆ»ï¼š
æäº¤é˜¶æ®µ = åŽŸå­æ€§è¾¹ç•Œ
æˆåŠŸï¼šæ–°è¡¨ç”Ÿæ•ˆï¼Œæ—§è¡¨åˆ é™¤
å¤±è´¥ï¼šå›žæ»šåˆ°åŽŸå§‹çŠ¶æ€
```

**ðŸ”’ ä¸€è‡´æ€§æ£€æŸ¥ç‚¹**
```
æ£€æŸ¥ç‚¹è®¾ç½®ï¼š

é˜¶æ®µæ€§éªŒè¯ï¼š
1ï¸âƒ£ å‡†å¤‡é˜¶æ®µï¼šç»“æž„å…¼å®¹æ€§æ£€æŸ¥
2ï¸âƒ£ æ‰§è¡Œé˜¶æ®µï¼šæ•°æ®å®Œæ•´æ€§ç›‘æŽ§  
3ï¸âƒ£ æäº¤é˜¶æ®µï¼šæœ€ç»ˆä¸€è‡´æ€§éªŒè¯

éªŒè¯å†…å®¹ï¼š
â€¢ è¡Œæ•°ä¸€è‡´æ€§ï¼šåŽŸè¡¨ vs æ–°è¡¨
â€¢ æ•°æ®æ ¡éªŒå’Œï¼šå…³é”®åˆ—çš„æ ¡éªŒ
â€¢ ç´¢å¼•ä¸€è‡´æ€§ï¼šç´¢å¼•æ•°æ®éªŒè¯
â€¢ çº¦æŸæ»¡è¶³ï¼šå¤–é”®ã€æ£€æŸ¥çº¦æŸ
```

---

## 7. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ Online DDLæœ¬è´¨ï¼šåœ¨ä¸åœæœºçš„æƒ…å†µä¸‹ä¿®æ”¹è¡¨ç»“æž„
ðŸ”¸ ä¸‰é˜¶æ®µæ¨¡åž‹ï¼šå‡†å¤‡ï¼ˆçŸ­é”ï¼‰â†’ æ‰§è¡Œï¼ˆæ— é”ï¼‰â†’ æäº¤ï¼ˆçŸ­é”ï¼‰
ðŸ”¸ MDLæœºåˆ¶ï¼šé€šè¿‡å…ƒæ•°æ®é”åè°ƒDDLä¸ŽDMLæ“ä½œ
ðŸ”¸ æ•°æ®å¤„ç†ï¼šä¸´æ—¶è¡¨ + æ•°æ®æ‹·è´ + å¢žé‡åŒæ­¥
ðŸ”¸ ä¸€è‡´æ€§ä¿è¯ï¼šMVCC + åŽŸå­æäº¤ + å›žæ»šæœºåˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ä¸ºä»€ä¹ˆOnline DDLèƒ½å·¥ä½œ**
```
æŠ€æœ¯åŸºç¡€ï¼š
â€¢ MVCCï¼šå¤šç‰ˆæœ¬æ”¯æŒå¹¶å‘è¯»å†™
â€¢ æ—¥å¿—æœºåˆ¶ï¼šæ•èŽ·å¢žé‡å˜æ›´
â€¢ åŽŸå­æ“ä½œï¼šç¡®ä¿åˆ‡æ¢çš„çž¬æ—¶æ€§
â€¢ é”åè°ƒï¼šå¹³è¡¡æ€§èƒ½ä¸Žä¸€è‡´æ€§

è®¾è®¡å“²å­¦ï¼š
ç©ºé—´æ¢æ—¶é—´ï¼šç”¨é¢å¤–å­˜å‚¨æ¢å–å¯ç”¨æ€§
æ—¶é—´æ¢é”ï¼šç”¨å¤„ç†æ—¶é—´æ¢å–é”æ—¶é—´
```

**ðŸ”¹ æ€§èƒ½å½±å“çš„æ¥æº**
```
èµ„æºæ¶ˆè€—ï¼š
â€¢ CPUï¼šæ•°æ®æ‹·è´å’Œè½¬æ¢è®¡ç®—
â€¢ å†…å­˜ï¼šå˜æ›´æ—¥å¿—å’Œç¼“å†²åŒº
â€¢ ç£ç›˜ï¼šä¸´æ—¶è¡¨å­˜å‚¨å’ŒIOæ“ä½œ
â€¢ ç½‘ç»œï¼šå¦‚æžœæ¶‰åŠä¸»ä»ŽåŒæ­¥

ä¼˜åŒ–åŽŸåˆ™ï¼š
â€¢ é€‰æ‹©ä¸šåŠ¡ä½Žå³°æœŸæ‰§è¡Œ
â€¢ ç›‘æŽ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
â€¢ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
â€¢ å‡†å¤‡å›žæ»šæ–¹æ¡ˆ
```

### 7.3 å®žé™…åº”ç”¨ä»·å€¼


**ðŸ“Š ä¸šåŠ¡ä»·å€¼**
```
æ ¸å¿ƒä¼˜åŠ¿ï¼š
âœ… ä¸šåŠ¡è¿žç»­æ€§ï¼šé¿å…æœåŠ¡ä¸­æ–­
âœ… ç”¨æˆ·ä½“éªŒï¼šæ— æ„ŸçŸ¥çš„è¡¨ç»“æž„å˜æ›´
âœ… è¿ç»´æ•ˆçŽ‡ï¼šé™ä½Žå˜æ›´çª—å£è¦æ±‚
âœ… é£Žé™©æŽ§åˆ¶ï¼šå¯æŽ§çš„å½±å“èŒƒå›´

é€‚ç”¨åœºæ™¯ï¼š
â€¢ å¤§è¡¨çš„ç´¢å¼•åˆ›å»º
â€¢ å­—æ®µçš„å¢žåŠ æˆ–ä¿®æ”¹
â€¢ çº¦æŸçš„æ·»åŠ æˆ–åˆ é™¤
â€¢ åˆ†åŒºè¡¨çš„è°ƒæ•´
```

**âš ï¸ æ³¨æ„äº‹é¡¹**
```
ä½¿ç”¨é™åˆ¶ï¼š
â€¢ ä¸æ˜¯æ‰€æœ‰DDLéƒ½æ”¯æŒOnlineæ¨¡å¼
â€¢ å¤§è¡¨æ“ä½œä»éœ€è¯„ä¼°èµ„æºå½±å“
â€¢ å¤æ‚å˜æ›´å¯èƒ½éœ€è¦åˆ†æ­¥æ‰§è¡Œ
â€¢ ä¸»ä»ŽçŽ¯å¢ƒéœ€è¦ç‰¹åˆ«è€ƒè™‘åŒæ­¥

æœ€ä½³å®žè·µï¼š
â€¢ å˜æ›´å‰åšå……åˆ†æµ‹è¯•
â€¢ ç›‘æŽ§DDLæ‰§è¡Œè¿›åº¦
â€¢ å‡†å¤‡å¿«é€Ÿå›žæ»šæ–¹æ¡ˆ
â€¢ è¯„ä¼°å¯¹ä¸šåŠ¡çš„å½±å“
```

**ðŸ’¡ æ ¸å¿ƒè®°å¿†**
- Online DDLè®©è¡¨ç»“æž„å˜æ›´ä¸å†æ˜¯ä¸šåŠ¡åœæ‘†çš„ç†ç”±
- ä¸‰é˜¶æ®µè®¾è®¡å·§å¦™å¹³è¡¡äº†æ€§èƒ½ã€ä¸€è‡´æ€§å’Œå¯ç”¨æ€§
- ç†è§£MDLå’ŒMVCCæ˜¯æŽŒæ¡åŽŸç†çš„å…³é”®
- åˆç†ä½¿ç”¨èƒ½å¤§å¤§æå‡æ•°æ®åº“è¿ç»´æ•ˆçŽ‡