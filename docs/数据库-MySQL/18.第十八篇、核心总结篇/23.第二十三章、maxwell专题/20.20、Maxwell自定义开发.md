---
title: 20ã€Maxwellè‡ªå®šä¹‰å¼€å‘
---
## ğŸ“š ç›®å½•

1. [Maxwellè‡ªå®šä¹‰å¼€å‘æ¦‚è¿°](#1-Maxwellè‡ªå®šä¹‰å¼€å‘æ¦‚è¿°)
2. [è‡ªå®šä¹‰Producerå¼€å‘](#2-è‡ªå®šä¹‰Producerå¼€å‘)
3. [æ•°æ®æ ¼å¼è‡ªå®šä¹‰](#3-æ•°æ®æ ¼å¼è‡ªå®šä¹‰)
4. [è¿‡æ»¤å™¨å¼€å‘](#4-è¿‡æ»¤å™¨å¼€å‘)
5. [æ’ä»¶å¼€å‘æœºåˆ¶](#5-æ’ä»¶å¼€å‘æœºåˆ¶)
6. [APIæ¥å£ä½¿ç”¨](#6-APIæ¥å£ä½¿ç”¨)
7. [æ‰©å±•ç‚¹è®¾è®¡ä¸å®ç°](#7-æ‰©å±•ç‚¹è®¾è®¡ä¸å®ç°)
8. [å¼€å‘è°ƒè¯•æ–¹æ³•](#8-å¼€å‘è°ƒè¯•æ–¹æ³•)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Maxwellè‡ªå®šä¹‰å¼€å‘æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯Maxwellè‡ªå®šä¹‰å¼€å‘


**Maxwellè‡ªå®šä¹‰å¼€å‘**å°±æ˜¯åœ¨åŸæœ‰MaxwellåŠŸèƒ½åŸºç¡€ä¸Šï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚ç¼–å†™ä»£ç æ¥æ‰©å±•Maxwellçš„èƒ½åŠ›ã€‚

```
MaxwellåŸæœ¬çš„åŠŸèƒ½ï¼š
MySQLæ•°æ®å˜åŒ– â†’ Maxwell â†’ Kafka/Redis/æ–‡ä»¶ç­‰

è‡ªå®šä¹‰å¼€å‘åï¼š
MySQLæ•°æ®å˜åŒ– â†’ Maxwell â†’ ä½ çš„è‡ªå®šä¹‰é€»è¾‘ â†’ ä»»ä½•ä½ æƒ³è¦çš„ç›®æ ‡ç³»ç»Ÿ
```

**ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å¼€å‘ï¼š**
- ğŸ“¤ **æ•°æ®è¾“å‡ºæ ¼å¼**ï¼šé»˜è®¤JSONæ ¼å¼å¯èƒ½ä¸æ»¡è¶³éœ€æ±‚
- ğŸ¯ **ç›®æ ‡ç³»ç»Ÿ**ï¼šéœ€è¦å‘é€åˆ°Maxwellä¸æ”¯æŒçš„ç³»ç»Ÿ
- ğŸ”„ **æ•°æ®å¤„ç†**ï¼šéœ€è¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­åŠ å·¥æ•°æ®
- ğŸ›¡ï¸ **å®‰å…¨è¦æ±‚**ï¼šéœ€è¦åŠ å¯†ã€è„±æ•ç­‰ç‰¹æ®Šå¤„ç†

### 1.2 Maxwellçš„æ‰©å±•æ¶æ„


```
                    Maxwellæ ¸å¿ƒæ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MySQL Binlog                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Binlog Reader                         â”‚
â”‚            (è¯»å–MySQLå˜æ›´)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Filter                               â”‚
â”‚           (è¿‡æ»¤å™¨é“¾ - å¯è‡ªå®šä¹‰)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Producer                              â”‚
â”‚          (è¾“å‡ºå¤„ç†å™¨ - å¯è‡ªå®šä¹‰)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯è‡ªå®šä¹‰çš„å…³é”®ç»„ä»¶ï¼š**
- **ğŸ” Filterï¼ˆè¿‡æ»¤å™¨ï¼‰**ï¼šå†³å®šå“ªäº›æ•°æ®å˜åŒ–éœ€è¦å¤„ç†
- **ğŸ“¤ Producerï¼ˆç”Ÿäº§è€…ï¼‰**ï¼šå†³å®šæ•°æ®å¦‚ä½•è¾“å‡ºåˆ°ç›®æ ‡ç³»ç»Ÿ
- **ğŸ”§ Pluginï¼ˆæ’ä»¶ï¼‰**ï¼šæ‰©å±•Maxwellçš„åŠŸèƒ½æ¨¡å—

---

## 2. ğŸ­ è‡ªå®šä¹‰Producerå¼€å‘


### 2.1 Produceræ˜¯ä»€ä¹ˆ


**Producerï¼ˆç”Ÿäº§è€…ï¼‰**å°±æ˜¯Maxwellä¸­è´Ÿè´£å°†æ•°æ®å˜åŒ–å‘é€åˆ°ç›®æ ‡ç³»ç»Ÿçš„ç»„ä»¶ã€‚

```
æ•°æ®æµå‘ï¼š
MySQLå˜åŒ– â†’ Maxwellè§£æ â†’ Producerå¤„ç† â†’ ç›®æ ‡ç³»ç»Ÿ

å†…ç½®Producerç¤ºä¾‹ï¼š
- KafkaProducerï¼šå‘é€åˆ°Kafka
- FileProducerï¼šå†™å…¥æ–‡ä»¶
- RedisProducerï¼šå‘é€åˆ°Redis
```

### 2.2 Produceræ¥å£å®ç°


**æ ¸å¿ƒæ¥å£ï¼š**Maxwellä¸­æ‰€æœ‰Produceréƒ½è¦å®ç°`AbstractProducer`æŠ½è±¡ç±»ã€‚

```java
// è‡ªå®šä¹‰Producerçš„åŸºæœ¬ç»“æ„
public class MyCustomProducer extends AbstractProducer {
    
    // æ„é€ å‡½æ•°ï¼šæ¥æ”¶Maxwellé…ç½®
    public MyCustomProducer(MaxwellContext context) {
        super(context);
        // åˆå§‹åŒ–ä½ çš„è¿æ¥ã€é…ç½®ç­‰
    }
    
    // æ ¸å¿ƒæ–¹æ³•ï¼šå¤„ç†æ¯ä¸€æ¡æ•°æ®å˜åŒ–
    @Override
    public void push(RowMap rowMap) throws Exception {
        // rowMapåŒ…å«äº†è¿™æ¬¡æ•°æ®åº“å˜åŒ–çš„æ‰€æœ‰ä¿¡æ¯
        
        // 1. è·å–åŸºæœ¬ä¿¡æ¯
        String database = rowMap.getDatabase();  // æ•°æ®åº“å
        String table = rowMap.getTable();       // è¡¨å
        String type = rowMap.getType();         // æ“ä½œç±»å‹ï¼šinsert/update/delete
        
        // 2. è·å–æ•°æ®å†…å®¹
        Map<String, Object> data = rowMap.getData();  // å˜åŒ–åçš„æ•°æ®
        Map<String, Object> old = rowMap.getOld();    // å˜åŒ–å‰çš„æ•°æ®ï¼ˆupdateæ—¶ï¼‰
        
        // 3. ä½ çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        processData(database, table, type, data, old);
    }
    
    // ä½ çš„å…·ä½“å¤„ç†é€»è¾‘
    private void processData(String database, String table, String type, 
                           Map<String, Object> data, Map<String, Object> old) {
        // è¿™é‡Œå†™ä½ çš„ä¸šåŠ¡é€»è¾‘
        // æ¯”å¦‚ï¼šå‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€å†™å…¥ESã€è°ƒç”¨APIç­‰
    }
}
```

### 2.3 å®é™…Producerå¼€å‘ç¤ºä¾‹


**ç¤ºä¾‹ï¼šå‘é€åˆ°ä¼ä¸šå¾®ä¿¡çš„Producer**

```java
public class WeChatProducer extends AbstractProducer {
    
    private String webhookUrl;
    private OkHttpClient httpClient;
    
    public WeChatProducer(MaxwellContext context) {
        super(context);
        // ä»é…ç½®ä¸­è¯»å–ä¼ä¸šå¾®ä¿¡webhookåœ°å€
        this.webhookUrl = context.getConfig().getString("wechat_webhook_url");
        this.httpClient = new OkHttpClient();
    }
    
    @Override
    public void push(RowMap rowMap) throws Exception {
        // åªå¤„ç†é‡è¦è¡¨çš„å˜åŒ–
        if (!isImportantTable(rowMap.getTable())) {
            return;
        }
        
        // æ„é€ æ¶ˆæ¯å†…å®¹
        String message = buildMessage(rowMap);
        
        // å‘é€åˆ°ä¼ä¸šå¾®ä¿¡
        sendToWeChat(message);
    }
    
    private boolean isImportantTable(String table) {
        // åªå…³æ³¨è®¢å•è¡¨å’Œç”¨æˆ·è¡¨
        return "orders".equals(table) || "users".equals(table);
    }
    
    private String buildMessage(RowMap rowMap) {
        return String.format("æ•°æ®åº“å˜åŒ–é€šçŸ¥ï¼š\n" +
                           "è¡¨ï¼š%s\n" +
                           "æ“ä½œï¼š%s\n" +
                           "æ—¶é—´ï¼š%s",
                           rowMap.getTable(),
                           rowMap.getType(),
                           new Date());
    }
    
    private void sendToWeChat(String message) throws Exception {
        // æ„é€ ä¼ä¸šå¾®ä¿¡æ¶ˆæ¯æ ¼å¼
        String json = String.format("{\"msgtype\":\"text\",\"text\":{\"content\":\"%s\"}}", message);
        
        RequestBody body = RequestBody.create(json, MediaType.get("application/json"));
        Request request = new Request.Builder()
                .url(webhookUrl)
                .post(body)
                .build();
                
        httpClient.newCall(request).execute();
    }
}
```

**é…ç½®ä½¿ç”¨è‡ªå®šä¹‰Producerï¼š**

```properties
# Maxwellé…ç½®æ–‡ä»¶
producer=com.yourcompany.WeChatProducer
wechat_webhook_url=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=ä½ çš„key
```

---

## 3. ğŸ“Š æ•°æ®æ ¼å¼è‡ªå®šä¹‰


### 3.1 ç†è§£RowMapæ•°æ®ç»“æ„


**RowMap**æ˜¯Maxwellä¸­è¡¨ç¤ºä¸€æ¬¡æ•°æ®åº“å˜åŒ–çš„å¯¹è±¡ï¼ŒåŒ…å«äº†è¿™æ¬¡å˜åŒ–çš„æ‰€æœ‰ä¿¡æ¯ã€‚

```java
// RowMapçš„ä¸»è¦å†…å®¹
{
    "database": "test_db",           // æ•°æ®åº“å
    "table": "users",                // è¡¨å
    "type": "insert",                // æ“ä½œç±»å‹
    "ts": 1639123456,               // æ—¶é—´æˆ³
    "xid": 12345,                   // äº‹åŠ¡ID
    "commit": true,                 // æ˜¯å¦æäº¤
    "data": {                       // æ–°æ•°æ®
        "id": 1,
        "name": "å¼ ä¸‰",
        "email": "zhangsan@test.com"
    },
    "old": {                        // æ—§æ•°æ®ï¼ˆupdateæ—¶æ‰æœ‰ï¼‰
        "name": "æå››"              // åªåŒ…å«å˜åŒ–çš„å­—æ®µ
    }
}
```

### 3.2 è‡ªå®šä¹‰æ•°æ®æ ¼å¼è½¬æ¢


**åœºæ™¯ï¼š**ä½ çš„ä¸‹æ¸¸ç³»ç»Ÿéœ€è¦ç‰¹å®šçš„æ•°æ®æ ¼å¼ï¼Œä¸æ˜¯Maxwellé»˜è®¤çš„JSONæ ¼å¼ã€‚

```java
public class CustomFormatProducer extends AbstractProducer {
    
    @Override
    public void push(RowMap rowMap) throws Exception {
        // æ ¹æ®ä¸åŒæ“ä½œç±»å‹ï¼Œç”Ÿæˆä¸åŒæ ¼å¼
        String customFormat = convertToCustomFormat(rowMap);
        
        // å‘é€åˆ°ä½ çš„ç›®æ ‡ç³»ç»Ÿ
        sendToTarget(customFormat);
    }
    
    private String convertToCustomFormat(RowMap rowMap) {
        String type = rowMap.getType();
        
        switch (type) {
            case "insert":
                return buildInsertFormat(rowMap);
            case "update":
                return buildUpdateFormat(rowMap);
            case "delete":
                return buildDeleteFormat(rowMap);
            default:
                return null;
        }
    }
    
    // è‡ªå®šä¹‰æ’å…¥æ ¼å¼ï¼šCSVæ ¼å¼
    private String buildInsertFormat(RowMap rowMap) {
        Map<String, Object> data = rowMap.getData();
        
        // å°†æ•°æ®è½¬æ¢ä¸ºCSVæ ¼å¼
        return String.join(",", 
            "INSERT",
            rowMap.getTable(),
            data.get("id").toString(),
            data.get("name").toString(),
            String.valueOf(System.currentTimeMillis())
        );
    }
    
    // è‡ªå®šä¹‰æ›´æ–°æ ¼å¼ï¼šåªåŒ…å«å˜åŒ–å­—æ®µ
    private String buildUpdateFormat(RowMap rowMap) {
        Map<String, Object> old = rowMap.getOld();
        Map<String, Object> data = rowMap.getData();
        
        StringBuilder changes = new StringBuilder();
        for (String field : old.keySet()) {
            changes.append(String.format("%s:%s->%s,", 
                field, old.get(field), data.get(field)));
        }
        
        return String.format("UPDATE:%s:ID=%s:CHANGES=[%s]",
            rowMap.getTable(),
            data.get("id"),
            changes.toString()
        );
    }
    
    // è‡ªå®šä¹‰åˆ é™¤æ ¼å¼
    private String buildDeleteFormat(RowMap rowMap) {
        Map<String, Object> data = rowMap.getData();
        
        return String.format("DELETE:%s:ID=%s:TIME=%d",
            rowMap.getTable(),
            data.get("id"),
            System.currentTimeMillis()
        );
    }
}
```

### 3.3 æ•°æ®è„±æ•å¤„ç†


**åœ¨è‡ªå®šä¹‰Producerä¸­è¿›è¡Œæ•°æ®è„±æ•ï¼š**

```java
public class MaskingProducer extends AbstractProducer {
    
    // éœ€è¦è„±æ•çš„å­—æ®µ
    private static final Set<String> SENSITIVE_FIELDS = Set.of(
        "phone", "email", "id_card", "password"
    );
    
    @Override
    public void push(RowMap rowMap) throws Exception {
        // è„±æ•å¤„ç†
        RowMap maskedRowMap = maskSensitiveData(rowMap);
        
        // å‘é€è„±æ•åçš„æ•°æ®
        String json = maskedRowMap.toJSON();
        sendToTarget(json);
    }
    
    private RowMap maskSensitiveData(RowMap rowMap) {
        // å¤„ç†å½“å‰æ•°æ®
        Map<String, Object> data = rowMap.getData();
        if (data != null) {
            maskMap(data);
        }
        
        // å¤„ç†æ—§æ•°æ®
        Map<String, Object> old = rowMap.getOld();
        if (old != null) {
            maskMap(old);
        }
        
        return rowMap;
    }
    
    private void maskMap(Map<String, Object> map) {
        for (String field : SENSITIVE_FIELDS) {
            if (map.containsKey(field)) {
                Object value = map.get(field);
                if (value != null) {
                    map.put(field, maskValue(value.toString()));
                }
            }
        }
    }
    
    private String maskValue(String value) {
        if (value.length() <= 3) {
            return "***";
        }
        // ä¿ç•™å‰3ä½ï¼Œå…¶ä»–ç”¨*ä»£æ›¿
        return value.substring(0, 3) + "***" + value.substring(value.length() - 2);
    }
}
```

---

## 4. ğŸ” è¿‡æ»¤å™¨å¼€å‘


### 4.1 è¿‡æ»¤å™¨çš„ä½œç”¨


**è¿‡æ»¤å™¨ï¼ˆFilterï¼‰**ç”¨æ¥å†³å®šå“ªäº›æ•°æ®åº“å˜åŒ–éœ€è¦å¤„ç†ï¼Œå“ªäº›å¯ä»¥å¿½ç•¥ã€‚è¿™æ ·å¯ä»¥ï¼š
- ğŸ¯ **å‡å°‘æ— ç”¨æ•°æ®**ï¼šåªå¤„ç†å…³å¿ƒçš„è¡¨å’Œå­—æ®µ
- âš¡ **æé«˜æ€§èƒ½**ï¼šé¿å…å¤„ç†ä¸éœ€è¦çš„æ•°æ®
- ğŸ›¡ï¸ **å®‰å…¨æ§åˆ¶**ï¼šè¿‡æ»¤æ•æ„Ÿæ•°æ®

```
æ•°æ®æµå‘ï¼š
MySQLå˜åŒ– â†’ è¿‡æ»¤å™¨åˆ¤æ–­ â†’ é€šè¿‡ï¼šç»§ç»­å¤„ç† / æ‹’ç»ï¼šç›´æ¥ä¸¢å¼ƒ
```

### 4.2 è‡ªå®šä¹‰è¿‡æ»¤å™¨å®ç°


**åŸºç¡€è¿‡æ»¤å™¨æ¥å£ï¼š**

```java
// å®ç°Filteræ¥å£
public class MyCustomFilter implements Filter {
    
    // æ ¸å¿ƒæ–¹æ³•ï¼šåˆ¤æ–­æ˜¯å¦è¦å¤„ç†è¿™æ¡è®°å½•
    @Override
    public boolean isMatch(RowMap rowMap) {
        // è¿”å›trueï¼šéœ€è¦å¤„ç†
        // è¿”å›falseï¼šå¿½ç•¥è¿™æ¡è®°å½•
        
        String database = rowMap.getDatabase();
        String table = rowMap.getTable();
        String type = rowMap.getType();
        
        // ä½ çš„è¿‡æ»¤é€»è¾‘
        return shouldProcess(database, table, type, rowMap);
    }
    
    private boolean shouldProcess(String database, String table, String type, RowMap rowMap) {
        // ç¤ºä¾‹è¿‡æ»¤è§„åˆ™
        
        // 1. åªå¤„ç†ç‰¹å®šæ•°æ®åº“
        if (!"production_db".equals(database)) {
            return false;
        }
        
        // 2. åªå¤„ç†ç‰¹å®šè¡¨
        if (!Arrays.asList("users", "orders", "products").contains(table)) {
            return false;
        }
        
        // 3. åªå¤„ç†ç‰¹å®šæ“ä½œç±»å‹
        if (!"insert".equals(type) && !"update".equals(type)) {
            return false;
        }
        
        // 4. åŸºäºæ•°æ®å†…å®¹è¿‡æ»¤
        if ("users".equals(table)) {
            Map<String, Object> data = rowMap.getData();
            // åªå¤„ç†VIPç”¨æˆ·çš„å˜åŒ–
            return "VIP".equals(data.get("user_type"));
        }
        
        return true;
    }
}
```

### 4.3 åŸºäºä¸šåŠ¡è§„åˆ™çš„è¿‡æ»¤å™¨


**å®é™…åœºæ™¯ï¼š**è®¢å•ç³»ç»Ÿä¸­ï¼Œåªå…³å¿ƒé‡è¦è®¢å•çš„å˜åŒ–ã€‚

```java
public class ImportantOrderFilter implements Filter {
    
    @Override
    public boolean isMatch(RowMap rowMap) {
        // åªå¤„ç†è®¢å•è¡¨
        if (!"orders".equals(rowMap.getTable())) {
            return false;
        }
        
        Map<String, Object> data = rowMap.getData();
        
        // é‡è¦è®¢å•çš„åˆ¤æ–­æ¡ä»¶
        return isImportantOrder(data);
    }
    
    private boolean isImportantOrder(Map<String, Object> orderData) {
        // æ¡ä»¶1ï¼šè®¢å•é‡‘é¢å¤§äº1000
        Object amountObj = orderData.get("amount");
        if (amountObj != null) {
            double amount = Double.parseDouble(amountObj.toString());
            if (amount > 1000) {
                return true;
            }
        }
        
        // æ¡ä»¶2ï¼šVIPå®¢æˆ·çš„è®¢å•
        Object customerType = orderData.get("customer_type");
        if ("VIP".equals(customerType)) {
            return true;
        }
        
        // æ¡ä»¶3ï¼šç‰¹å®šå•†å“ç±»åˆ«
        Object category = orderData.get("product_category");
        if ("electronics".equals(category) || "luxury".equals(category)) {
            return true;
        }
        
        return false;
    }
}
```

### 4.4 ç»„åˆè¿‡æ»¤å™¨


**å¤šä¸ªè¿‡æ»¤æ¡ä»¶çš„ç»„åˆï¼š**

```java
public class CompositeFilter implements Filter {
    
    private List<Filter> filters;
    private FilterLogic logic;  // AND æˆ– OR
    
    public CompositeFilter(FilterLogic logic, Filter... filters) {
        this.logic = logic;
        this.filters = Arrays.asList(filters);
    }
    
    @Override
    public boolean isMatch(RowMap rowMap) {
        if (logic == FilterLogic.AND) {
            // æ‰€æœ‰è¿‡æ»¤å™¨éƒ½é€šè¿‡æ‰ç®—é€šè¿‡
            return filters.stream().allMatch(filter -> filter.isMatch(rowMap));
        } else {
            // ä»»ä¸€è¿‡æ»¤å™¨é€šè¿‡å°±ç®—é€šè¿‡
            return filters.stream().anyMatch(filter -> filter.isMatch(rowMap));
        }
    }
    
    public enum FilterLogic {
        AND, OR
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Filter tableFilter = new TableFilter("users", "orders");  // è¡¨è¿‡æ»¤å™¨
Filter operationFilter = new OperationFilter("insert", "update");  // æ“ä½œè¿‡æ»¤å™¨
Filter businessFilter = new ImportantOrderFilter();  // ä¸šåŠ¡è¿‡æ»¤å™¨

// ç»„åˆï¼šå¿…é¡»æ˜¯æŒ‡å®šè¡¨ AND æŒ‡å®šæ“ä½œ AND é‡è¦è®¢å•
Filter compositeFilter = new CompositeFilter(FilterLogic.AND, 
    tableFilter, operationFilter, businessFilter);
```

---

## 5. ğŸ”§ æ’ä»¶å¼€å‘æœºåˆ¶


### 5.1 æ’ä»¶æœºåˆ¶æ¦‚è¿°


**Maxwellæ’ä»¶æœºåˆ¶**å…è®¸ä½ åœ¨Maxwellçš„å¤„ç†æµç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹Maxwellçš„æ ¸å¿ƒä»£ç ã€‚

```
Maxwellå¤„ç†æµç¨‹ä¸­çš„æ’ä»¶æ‰©å±•ç‚¹ï¼š
 
è¯»å–Binlog â†’ [æ’ä»¶1] â†’ è§£ææ•°æ® â†’ [æ’ä»¶2] â†’ è¿‡æ»¤æ•°æ® â†’ [æ’ä»¶3] â†’ è¾“å‡ºæ•°æ®
           å¯åŠ¨æ’ä»¶        æ•°æ®è½¬æ¢æ’ä»¶       è¾“å‡ºå‰å¤„ç†æ’ä»¶
```

### 5.2 æ’ä»¶æ¥å£è®¾è®¡


**åŸºç¡€æ’ä»¶æ¥å£ï¼š**

```java
public interface MaxwellPlugin {
    
    // æ’ä»¶åç§°
    String getName();
    
    // æ’ä»¶åˆå§‹åŒ–
    void initialize(MaxwellContext context) throws Exception;
    
    // å¤„ç†æ•°æ®ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
    RowMap process(RowMap rowMap) throws Exception;
    
    // æ’ä»¶å…³é—­
    void shutdown() throws Exception;
}
```

### 5.3 æ•°æ®å¢å¼ºæ’ä»¶ç¤ºä¾‹


**åœºæ™¯ï¼š**åœ¨åŸå§‹æ•°æ®ä¸­æ·»åŠ é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚æ·»åŠ æ“ä½œæ—¶é—´ã€æ“ä½œæ¥æºç­‰ã€‚

```java
public class DataEnhancementPlugin implements MaxwellPlugin {
    
    private String serverName;
    
    @Override
    public String getName() {
        return "DataEnhancementPlugin";
    }
    
    @Override
    public void initialize(MaxwellContext context) throws Exception {
        // ä»é…ç½®ä¸­è¯»å–æœåŠ¡å™¨åç§°
        this.serverName = context.getConfig().getString("server_name", "unknown");
        System.out.println("æ•°æ®å¢å¼ºæ’ä»¶å¯åŠ¨ï¼ŒæœåŠ¡å™¨ï¼š" + serverName);
    }
    
    @Override
    public RowMap process(RowMap rowMap) throws Exception {
        // åœ¨åŸå§‹æ•°æ®ä¸­å¢åŠ é¢å¤–å­—æ®µ
        Map<String, Object> data = rowMap.getData();
        if (data != null) {
            // æ·»åŠ æœåŠ¡å™¨ä¿¡æ¯
            data.put("_server_name", serverName);
            
            // æ·»åŠ å¤„ç†æ—¶é—´
            data.put("_processed_at", System.currentTimeMillis());
            
            // æ·»åŠ æ•°æ®æ¥æºæ ‡è¯†
            data.put("_source", "maxwell");
            
            // å¦‚æœæ˜¯ç”¨æˆ·è¡¨ï¼Œæ·»åŠ é¢å¤–çš„ç”¨æˆ·ä¿¡æ¯
            if ("users".equals(rowMap.getTable())) {
                enhanceUserData(data);
            }
        }
        
        return rowMap;
    }
    
    private void enhanceUserData(Map<String, Object> userData) {
        // ä¸ºç”¨æˆ·æ•°æ®æ·»åŠ ç‰¹æ®Šå­—æ®µ
        Object userId = userData.get("id");
        if (userId != null) {
            // ç”Ÿæˆç”¨æˆ·æ ‡è¯†
            userData.put("_user_hash", generateUserHash(userId.toString()));
            
            // åˆ¤æ–­ç”¨æˆ·ç­‰çº§
            userData.put("_user_level", calculateUserLevel(userData));
        }
    }
    
    private String generateUserHash(String userId) {
        // ç®€å•çš„hashç”Ÿæˆï¼ˆå®é™…é¡¹ç›®ä¸­ç”¨æ›´å®‰å…¨çš„ç®—æ³•ï¼‰
        return "USER_" + userId.hashCode();
    }
    
    private String calculateUserLevel(Map<String, Object> userData) {
        // æ ¹æ®ç”¨æˆ·æ•°æ®åˆ¤æ–­ç­‰çº§
        Object userType = userData.get("type");
        return "VIP".equals(userType) ? "HIGH" : "NORMAL";
    }
    
    @Override
    public void shutdown() throws Exception {
        System.out.println("æ•°æ®å¢å¼ºæ’ä»¶å…³é—­");
    }
}
```

### 5.4 æ•°æ®éªŒè¯æ’ä»¶


**åœºæ™¯ï¼š**éªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’Œåˆæ³•æ€§ã€‚

```java
public class DataValidationPlugin implements MaxwellPlugin {
    
    private static final Logger logger = LoggerFactory.getLogger(DataValidationPlugin.class);
    
    @Override
    public String getName() {
        return "DataValidationPlugin";
    }
    
    @Override
    public void initialize(MaxwellContext context) throws Exception {
        logger.info("æ•°æ®éªŒè¯æ’ä»¶åˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public RowMap process(RowMap rowMap) throws Exception {
        String table = rowMap.getTable();
        Map<String, Object> data = rowMap.getData();
        
        // æ ¹æ®ä¸åŒè¡¨è¿›è¡Œä¸åŒéªŒè¯
        switch (table) {
            case "users":
                validateUserData(data);
                break;
            case "orders":
                validateOrderData(data);
                break;
        }
        
        return rowMap;
    }
    
    private void validateUserData(Map<String, Object> data) throws Exception {
        // éªŒè¯å¿…å¡«å­—æ®µ
        if (data.get("id") == null) {
            throw new Exception("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
        }
        
        if (data.get("email") == null) {
            throw new Exception("ç”¨æˆ·é‚®ç®±ä¸èƒ½ä¸ºç©º");
        }
        
        // éªŒè¯é‚®ç®±æ ¼å¼
        String email = data.get("email").toString();
        if (!email.contains("@")) {
            throw new Exception("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®ï¼š" + email);
        }
        
        logger.debug("ç”¨æˆ·æ•°æ®éªŒè¯é€šè¿‡ï¼š" + data.get("id"));
    }
    
    private void validateOrderData(Map<String, Object> data) throws Exception {
        // éªŒè¯è®¢å•é‡‘é¢
        Object amountObj = data.get("amount");
        if (amountObj == null) {
            throw new Exception("è®¢å•é‡‘é¢ä¸èƒ½ä¸ºç©º");
        }
        
        double amount = Double.parseDouble(amountObj.toString());
        if (amount <= 0) {
            throw new Exception("è®¢å•é‡‘é¢å¿…é¡»å¤§äº0ï¼š" + amount);
        }
        
        // éªŒè¯å®¢æˆ·ID
        if (data.get("customer_id") == null) {
            throw new Exception("å®¢æˆ·IDä¸èƒ½ä¸ºç©º");
        }
        
        logger.debug("è®¢å•æ•°æ®éªŒè¯é€šè¿‡ï¼š" + data.get("id"));
    }
    
    @Override
    public void shutdown() throws Exception {
        logger.info("æ•°æ®éªŒè¯æ’ä»¶å…³é—­");
    }
}
```

---

## 6. ğŸŒ APIæ¥å£ä½¿ç”¨


### 6.1 Maxwell HTTP API


**Maxwellæä¾›HTTP API**æ¥æŸ¥çœ‹è¿è¡ŒçŠ¶æ€å’Œè¿›è¡Œç®€å•æ§åˆ¶ã€‚

```bash
# æŸ¥çœ‹MaxwellçŠ¶æ€
GET http://localhost:8080/api/status

# å“åº”ç¤ºä¾‹ï¼š
{
    "status": "running",
    "position": {
        "binlog_file": "mysql-bin.000123",
        "binlog_position": 12345678
    },
    "lag": 0,
    "filters": ["table1", "table2"]
}
```

### 6.2 ç¨‹åºåŒ–APIä½¿ç”¨


**åœ¨ä½ çš„Javaç¨‹åºä¸­è°ƒç”¨Maxwell APIï¼š**

```java
public class MaxwellAPIClient {
    
    private String maxwellHost;
    private int maxwellPort;
    private OkHttpClient httpClient;
    
    public MaxwellAPIClient(String host, int port) {
        this.maxwellHost = host;
        this.maxwellPort = port;
        this.httpClient = new OkHttpClient();
    }
    
    // è·å–MaxwellçŠ¶æ€
    public MaxwellStatus getStatus() throws Exception {
        String url = String.format("http://%s:%d/api/status", maxwellHost, maxwellPort);
        
        Request request = new Request.Builder()
                .url(url)
                .get()
                .build();
                
        try (Response response = httpClient.newCall(request).execute()) {
            String json = response.body().string();
            return parseStatus(json);
        }
    }
    
    // è·å–å½“å‰binlogä½ç½®
    public BinlogPosition getCurrentPosition() throws Exception {
        MaxwellStatus status = getStatus();
        return status.getPosition();
    }
    
    // æ£€æŸ¥Maxwellæ˜¯å¦å¥åº·
    public boolean isHealthy() {
        try {
            MaxwellStatus status = getStatus();
            return "running".equals(status.getStatus()) && status.getLag() < 10000;
        } catch (Exception e) {
            return false;
        }
    }
    
    private MaxwellStatus parseStatus(String json) {
        // è§£æJSONå“åº”ï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        // å®é™…é¡¹ç›®ä¸­ä½¿ç”¨Jacksonæˆ–Gson
        return new MaxwellStatus(json);
    }
}

// çŠ¶æ€å¯¹è±¡
class MaxwellStatus {
    private String status;
    private BinlogPosition position;
    private long lag;
    
    // æ„é€ å‡½æ•°ã€getterç­‰...
}

class BinlogPosition {
    private String binlogFile;
    private long binlogPosition;
    
    // æ„é€ å‡½æ•°ã€getterç­‰...
}
```

### 6.3 ç›‘æ§é›†æˆ


**å°†MaxwellçŠ¶æ€é›†æˆåˆ°ç›‘æ§ç³»ç»Ÿï¼š**

```java
public class MaxwellMonitor {
    
    private MaxwellAPIClient apiClient;
    private ScheduledExecutorService scheduler;
    
    public MaxwellMonitor(String host, int port) {
        this.apiClient = new MaxwellAPIClient(host, port);
        this.scheduler = Executors.newScheduledThreadPool(1);
    }
    
    // å¯åŠ¨ç›‘æ§
    public void startMonitoring() {
        scheduler.scheduleAtFixedRate(this::checkMaxwellHealth, 0, 30, TimeUnit.SECONDS);
    }
    
    private void checkMaxwellHealth() {
        try {
            MaxwellStatus status = apiClient.getStatus();
            
            // æ£€æŸ¥è¿è¡ŒçŠ¶æ€
            if (!"running".equals(status.getStatus())) {
                sendAlert("MaxwellçŠ¶æ€å¼‚å¸¸ï¼š" + status.getStatus());
                return;
            }
            
            // æ£€æŸ¥å»¶è¿Ÿ
            if (status.getLag() > 60000) {  // å»¶è¿Ÿè¶…è¿‡1åˆ†é’Ÿ
                sendAlert("Maxwellå»¶è¿Ÿè¿‡é«˜ï¼š" + status.getLag() + "ms");
                return;
            }
            
            // è®°å½•æ­£å¸¸çŠ¶æ€
            logNormalStatus(status);
            
        } catch (Exception e) {
            sendAlert("Maxwell APIè°ƒç”¨å¤±è´¥ï¼š" + e.getMessage());
        }
    }
    
    private void sendAlert(String message) {
        // å‘é€å‘Šè­¦åˆ°ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ç­‰
        System.err.println("ALERT: " + message);
        
        // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šè°ƒç”¨å‘Šè­¦æ¥å£
        // alertService.sendAlert(message);
    }
    
    private void logNormalStatus(MaxwellStatus status) {
        System.out.println("Maxwellè¿è¡Œæ­£å¸¸ï¼Œä½ç½®ï¼š" + 
                         status.getPosition().getBinlogFile() + ":" + 
                         status.getPosition().getBinlogPosition());
    }
}
```

---

## 7. ğŸ¨ æ‰©å±•ç‚¹è®¾è®¡ä¸å®ç°


### 7.1 æ‰©å±•ç‚¹è®¾è®¡åŸåˆ™


**æ‰©å±•ç‚¹**æ˜¯é¢„ç•™åœ¨ç³»ç»Ÿä¸­çš„é’©å­ï¼Œå…è®¸æ’å…¥è‡ªå®šä¹‰é€»è¾‘è€Œä¸ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚

```
è‰¯å¥½æ‰©å±•ç‚¹çš„ç‰¹å¾ï¼š
ğŸ”Œ æ¥å£æ¸…æ™°ï¼šæ‰©å±•ç‚¹çš„è¾“å…¥è¾“å‡ºå®šä¹‰æ˜ç¡®
ğŸ”„ èŒè´£å•ä¸€ï¼šæ¯ä¸ªæ‰©å±•ç‚¹åªè´Ÿè´£ä¸€ä¸ªå…·ä½“åŠŸèƒ½
âš¡ æ€§èƒ½å‹å¥½ï¼šæ‰©å±•é€»è¾‘ä¸åº”å½±å“ä¸»æµç¨‹æ€§èƒ½
ğŸ›¡ï¸ å¼‚å¸¸å®‰å…¨ï¼šæ‰©å±•ç‚¹å¼‚å¸¸ä¸åº”å½±å“æ•´ä½“ç³»ç»Ÿ
```

### 7.2 æ‰©å±•ç‚¹ç®¡ç†å™¨


**è®¾è®¡ä¸€ä¸ªæ‰©å±•ç‚¹ç®¡ç†å™¨æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ‰©å±•ï¼š**

```java
public class ExtensionManager {
    
    // å­˜å‚¨ä¸åŒç±»å‹çš„æ‰©å±•ç‚¹
    private Map<ExtensionType, List<Extension>> extensions = new HashMap<>();
    private MaxwellContext context;
    
    public ExtensionManager(MaxwellContext context) {
        this.context = context;
    }
    
    // æ³¨å†Œæ‰©å±•
    public void registerExtension(ExtensionType type, Extension extension) {
        extensions.computeIfAbsent(type, k -> new ArrayList<>()).add(extension);
        
        // åˆå§‹åŒ–æ‰©å±•
        try {
            extension.initialize(context);
            System.out.println("æ‰©å±•æ³¨å†ŒæˆåŠŸï¼š" + extension.getName());
        } catch (Exception e) {
            System.err.println("æ‰©å±•åˆå§‹åŒ–å¤±è´¥ï¼š" + extension.getName() + ", " + e.getMessage());
        }
    }
    
    // æ‰§è¡ŒæŒ‡å®šç±»å‹çš„æ‰€æœ‰æ‰©å±•
    public RowMap executeExtensions(ExtensionType type, RowMap rowMap) {
        List<Extension> typeExtensions = extensions.get(type);
        if (typeExtensions == null) {
            return rowMap;
        }
        
        RowMap result = rowMap;
        for (Extension extension : typeExtensions) {
            try {
                result = extension.process(result);
                if (result == null) {
                    // å¦‚æœæ‰©å±•è¿”å›nullï¼Œè¡¨ç¤ºè¦è¿‡æ»¤æ‰è¿™æ¡è®°å½•
                    break;
                }
            } catch (Exception e) {
                System.err.println("æ‰©å±•æ‰§è¡Œå¤±è´¥ï¼š" + extension.getName() + ", " + e.getMessage());
                // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œå…¶ä»–æ‰©å±•
                if (isStrictMode()) {
                    throw new RuntimeException("æ‰©å±•æ‰§è¡Œå¤±è´¥", e);
                }
            }
        }
        
        return result;
    }
    
    private boolean isStrictMode() {
        // ä»é…ç½®ä¸­è¯»å–æ˜¯å¦å¯ç”¨ä¸¥æ ¼æ¨¡å¼
        return context.getConfig().getBoolean("extension_strict_mode", false);
    }
    
    // æ‰©å±•ç±»å‹æšä¸¾
    public enum ExtensionType {
        BEFORE_FILTER,    // è¿‡æ»¤å‰
        AFTER_FILTER,     // è¿‡æ»¤å
        BEFORE_OUTPUT,    // è¾“å‡ºå‰
        AFTER_OUTPUT      // è¾“å‡ºå
    }
}

// åŸºç¡€æ‰©å±•æ¥å£
interface Extension {
    String getName();
    void initialize(MaxwellContext context) throws Exception;
    RowMap process(RowMap rowMap) throws Exception;
    void shutdown() throws Exception;
}
```

### 7.3 å®é™…æ‰©å±•ç‚¹åº”ç”¨


**æ•°æ®ç»Ÿè®¡æ‰©å±•ï¼š**

```java
public class DataStatisticsExtension implements Extension {
    
    private Map<String, AtomicLong> tableCounters = new ConcurrentHashMap<>();
    private Map<String, AtomicLong> operationCounters = new ConcurrentHashMap<>();
    private ScheduledExecutorService scheduler;
    
    @Override
    public String getName() {
        return "DataStatisticsExtension";
    }
    
    @Override
    public void initialize(MaxwellContext context) throws Exception {
        scheduler = Executors.newScheduledThreadPool(1);
        
        // æ¯åˆ†é’Ÿè¾“å‡ºä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯
        scheduler.scheduleAtFixedRate(this::printStatistics, 1, 1, TimeUnit.MINUTES);
    }
    
    @Override
    public RowMap process(RowMap rowMap) throws Exception {
        // ç»Ÿè®¡è¡¨æ“ä½œæ¬¡æ•°
        String table = rowMap.getTable();
        tableCounters.computeIfAbsent(table, k -> new AtomicLong(0)).incrementAndGet();
        
        // ç»Ÿè®¡æ“ä½œç±»å‹æ¬¡æ•°
        String operation = rowMap.getType();
        operationCounters.computeIfAbsent(operation, k -> new AtomicLong(0)).incrementAndGet();
        
        return rowMap;  // ä¸ä¿®æ”¹æ•°æ®ï¼Œåªæ˜¯ç»Ÿè®¡
    }
    
    private void printStatistics() {
        System.out.println("=== Maxwellæ•°æ®ç»Ÿè®¡ ===");
        
        System.out.println("è¡¨æ“ä½œç»Ÿè®¡ï¼š");
        tableCounters.forEach((table, count) -> 
            System.out.println("  " + table + ": " + count.get()));
            
        System.out.println("æ“ä½œç±»å‹ç»Ÿè®¡ï¼š");
        operationCounters.forEach((operation, count) -> 
            System.out.println("  " + operation + ": " + count.get()));
            
        System.out.println("========================");
    }
    
    @Override
    public void shutdown() throws Exception {
        if (scheduler != null) {
            scheduler.shutdown();
        }
    }
}
```

**æ•°æ®ç¼“å­˜æ‰©å±•ï¼š**

```java
public class DataCacheExtension implements Extension {
    
    private Cache<String, Object> cache;
    
    @Override
    public String getName() {
        return "DataCacheExtension";
    }
    
    @Override
    public void initialize(MaxwellContext context) throws Exception {
        // åˆå§‹åŒ–ç¼“å­˜ï¼ˆä½¿ç”¨Caffeineï¼‰
        this.cache = Caffeine.newBuilder()
                .maximumSize(10000)
                .expireAfterWrite(10, TimeUnit.MINUTES)
                .build();
    }
    
    @Override
    public RowMap process(RowMap rowMap) throws Exception {
        String table = rowMap.getTable();
        Map<String, Object> data = rowMap.getData();
        
        // å¯¹é‡è¦è¡¨è¿›è¡Œç¼“å­˜
        if ("users".equals(table) || "products".equals(table)) {
            Object id = data.get("id");
            if (id != null) {
                String cacheKey = table + ":" + id;
                
                if ("delete".equals(rowMap.getType())) {
                    // åˆ é™¤æ“ä½œï¼šä»ç¼“å­˜ä¸­ç§»é™¤
                    cache.invalidate(cacheKey);
                } else {
                    // æ’å…¥/æ›´æ–°æ“ä½œï¼šæ›´æ–°ç¼“å­˜
                    cache.put(cacheKey, data);
                }
            }
        }
        
        return rowMap;
    }
    
    // æä¾›æŸ¥è¯¢ç¼“å­˜çš„æ–¹æ³•
    public Object getCachedData(String table, Object id) {
        return cache.getIfPresent(table + ":" + id);
    }
    
    @Override
    public void shutdown() throws Exception {
        if (cache != null) {
            cache.invalidateAll();
        }
    }
}
```

---

## 8. ğŸ› å¼€å‘è°ƒè¯•æ–¹æ³•


### 8.1 æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º


**æ­¥éª¤1ï¼šå‡†å¤‡å¼€å‘ç¯å¢ƒ**

```bash
# 1. å®‰è£…MySQLå¹¶å¯ç”¨binlog
# åœ¨MySQLé…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š
[mysqld]
server-id = 1
log-bin = mysql-bin
binlog-format = ROW
binlog-row-image = FULL

# 2. åˆ›å»ºMaxwellç”¨æˆ·
CREATE USER 'maxwell'@'%' IDENTIFIED BY 'maxwell123';
GRANT ALL PRIVILEGES ON *.* TO 'maxwell'@'%';
GRANT REPLICATION SLAVE ON *.* TO 'maxwell'@'%';

# 3. åˆ›å»ºæµ‹è¯•æ•°æ®åº“å’Œè¡¨
CREATE DATABASE test_db;
USE test_db;

CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100),
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**æ­¥éª¤2ï¼šåˆ›å»ºå¼€å‘é¡¹ç›®**

```xml
<!-- Mavenä¾èµ– -->
<dependencies>
    <dependency>
        <groupId>com.zendesk</groupId>
        <artifactId>maxwell</artifactId>
        <version>1.29.2</version>
    </dependency>
    
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.33</version>
    </dependency>
    
    <dependency>
        <groupId>org.slf4j</groupId>
        <artifactId>slf4j-simple</artifactId>
        <version>1.7.32</version>
    </dependency>
</dependencies>
```

### 8.2 è°ƒè¯•æŠ€å·§


**è°ƒè¯•è‡ªå®šä¹‰Producerï¼š**

```java
public class DebugProducer extends AbstractProducer {
    
    private static final Logger logger = LoggerFactory.getLogger(DebugProducer.class);
    
    public DebugProducer(MaxwellContext context) {
        super(context);
        logger.info("DebugProduceråˆå§‹åŒ–å®Œæˆ");
    }
    
    @Override
    public void push(RowMap rowMap) throws Exception {
        // è¯¦ç»†æ—¥å¿—è®°å½•
        logger.info("æ”¶åˆ°æ•°æ®å˜åŒ–ï¼š");
        logger.info("  æ•°æ®åº“ï¼š{}", rowMap.getDatabase());
        logger.info("  è¡¨åï¼š{}", rowMap.getTable());
        logger.info("  æ“ä½œç±»å‹ï¼š{}", rowMap.getType());
        logger.info("  æ—¶é—´æˆ³ï¼š{}", rowMap.getTimestamp());
        
        // æ‰“å°æ•°æ®å†…å®¹
        if (rowMap.getData() != null) {
            logger.info("  æ–°æ•°æ®ï¼š{}", rowMap.getData());
        }
        
        if (rowMap.getOld() != null) {
            logger.info("  æ—§æ•°æ®ï¼š{}", rowMap.getOld());
        }
        
        // æ¨¡æ‹Ÿå¤„ç†
        try {
            processData(rowMap);
            logger.info("æ•°æ®å¤„ç†æˆåŠŸ");
        } catch (Exception e) {
            logger.error("æ•°æ®å¤„ç†å¤±è´¥ï¼š{}", e.getMessage(), e);
            throw e;
        }
    }
    
    private void processData(RowMap rowMap) {
        // ä½ çš„å¤„ç†é€»è¾‘
        String json = rowMap.toJSON();
        System.out.println("JSONæ ¼å¼ï¼š" + json);
    }
}
```

### 8.3 å•å…ƒæµ‹è¯•


**ä¸ºè‡ªå®šä¹‰ç»„ä»¶ç¼–å†™å•å…ƒæµ‹è¯•ï¼š**

```java
public class MyProducerTest {
    
    @Test
    public void testProducerWithInsertData() throws Exception {
        // åˆ›å»ºæµ‹è¯•ç”¨çš„RowMap
        RowMap rowMap = createTestRowMap("insert");
        
        // åˆ›å»ºProducerå®ä¾‹
        MaxwellContext context = createTestContext();
        MyCustomProducer producer = new MyCustomProducer(context);
        
        // æ‰§è¡Œæµ‹è¯•
        assertDoesNotThrow(() -> producer.push(rowMap));
        
        // éªŒè¯ç»“æœ
        // ...
    }
    
    @Test
    public void testFilterLogic() throws Exception {
        MyCustomFilter filter = new MyCustomFilter();
        
        // æµ‹è¯•åº”è¯¥é€šè¿‡çš„æ•°æ®
        RowMap validRowMap = createTestRowMap("insert");
        assertTrue(filter.isMatch(validRowMap));
        
        // æµ‹è¯•åº”è¯¥è¢«è¿‡æ»¤çš„æ•°æ®
        RowMap invalidRowMap = createTestRowMap("delete");
        assertFalse(filter.isMatch(invalidRowMap));
    }
    
    private RowMap createTestRowMap(String operation) {
        // åˆ›å»ºæµ‹è¯•ç”¨çš„RowMapå¯¹è±¡
        RowMap rowMap = new RowMap();
        rowMap.setDatabase("test_db");
        rowMap.setTable("users");
        rowMap.setType(operation);
        
        Map<String, Object> data = new HashMap<>();
        data.put("id", 1);
        data.put("name", "æµ‹è¯•ç”¨æˆ·");
        data.put("email", "test@example.com");
        rowMap.setData(data);
        
        return rowMap;
    }
    
    private MaxwellContext createTestContext() {
        // åˆ›å»ºæµ‹è¯•ç”¨çš„Maxwellä¸Šä¸‹æ–‡
        MaxwellConfig config = new MaxwellConfig();
        return new MaxwellContext(config);
    }
}
```

### 8.4 æ€§èƒ½æµ‹è¯•


**æµ‹è¯•è‡ªå®šä¹‰ç»„ä»¶çš„æ€§èƒ½ï¼š**

```java
public class PerformanceTest {
    
    @Test
    public void testProducerPerformance() throws Exception {
        MyCustomProducer producer = new MyCustomProducer(createTestContext());
        
        int recordCount = 10000;
        long startTime = System.currentTimeMillis();
        
        for (int i = 0; i < recordCount; i++) {
            RowMap rowMap = createTestRowMap("insert");
            producer.push(rowMap);
        }
        
        long endTime = System.currentTimeMillis();
        long duration = endTime - startTime;
        
        double throughput = recordCount * 1000.0 / duration;
        
        System.out.printf("å¤„ç†%dæ¡è®°å½•è€—æ—¶%dmsï¼Œååé‡ï¼š%.2fè®°å½•/ç§’%n", 
                         recordCount, duration, throughput);
        
        // éªŒè¯æ€§èƒ½è¦æ±‚
        assertTrue(throughput > 1000, "ååé‡åº”è¯¥å¤§äº1000è®°å½•/ç§’");
    }
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è‡ªå®šä¹‰Producerï¼šå®ç°AbstractProducerç±»ï¼Œå¤„ç†æ•°æ®è¾“å‡ºé€»è¾‘
ğŸ”¸ æ•°æ®æ ¼å¼è½¬æ¢ï¼šåœ¨Producerä¸­è‡ªå®šä¹‰æ•°æ®æ ¼å¼ï¼Œæ»¡è¶³ä¸‹æ¸¸ç³»ç»Ÿéœ€æ±‚
ğŸ”¸ è¿‡æ»¤å™¨å¼€å‘ï¼šå®ç°Filteræ¥å£ï¼Œæ§åˆ¶å“ªäº›æ•°æ®éœ€è¦å¤„ç†
ğŸ”¸ æ’ä»¶æœºåˆ¶ï¼šé€šè¿‡æ’ä»¶æ‰©å±•MaxwellåŠŸèƒ½ï¼Œä¸ä¿®æ”¹æ ¸å¿ƒä»£ç 
ğŸ”¸ APIæ¥å£ï¼šä½¿ç”¨HTTP APIç›‘æ§MaxwellçŠ¶æ€
ğŸ”¸ æ‰©å±•ç‚¹è®¾è®¡ï¼šé¢„ç•™é’©å­ç‚¹ï¼Œå…è®¸æ’å…¥è‡ªå®šä¹‰é€»è¾‘
ğŸ”¸ è°ƒè¯•æ–¹æ³•ï¼šæœ¬åœ°ç¯å¢ƒæ­å»ºã€å•å…ƒæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰å¼€å‘**
```
æ•°æ®è¾“å‡ºéœ€æ±‚ï¼š
- é»˜è®¤æ ¼å¼ä¸æ»¡è¶³ä¸‹æ¸¸ç³»ç»Ÿè¦æ±‚
- éœ€è¦å‘é€åˆ°Maxwellä¸åŸç”Ÿæ”¯æŒçš„ç³»ç»Ÿ
- éœ€è¦åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¿›è¡Œæ•°æ®åŠ å·¥

ä¸šåŠ¡é€»è¾‘éœ€æ±‚ï¼š
- æ•°æ®è„±æ•ã€åŠ å¯†ç­‰å®‰å…¨å¤„ç†
- æ•°æ®éªŒè¯ã€ç»Ÿè®¡ç­‰ä¸šåŠ¡é€»è¾‘
- ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆéœ€æ±‚
```

**ğŸ”¹ å¼€å‘çš„æ ¸å¿ƒåŸåˆ™**
```
èŒè´£å•ä¸€ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªå…·ä½“åŠŸèƒ½
æ¥å£æ¸…æ™°ï¼šè¾“å…¥è¾“å‡ºå®šä¹‰æ˜ç¡®ï¼Œä¾¿äºæµ‹è¯•
å¼‚å¸¸å®‰å…¨ï¼šç»„ä»¶å¼‚å¸¸ä¸èƒ½å½±å“Maxwellä¸»æµç¨‹
æ€§èƒ½å‹å¥½ï¼šè‡ªå®šä¹‰é€»è¾‘ä¸åº”æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
```

**ğŸ”¹ å¸¸è§çš„å¼€å‘åœºæ™¯**
```
æ•°æ®è½¬æ¢ï¼šJSONè½¬CSVã€XMLç­‰æ ¼å¼
ç³»ç»Ÿé›†æˆï¼šå‘é€åˆ°ESã€HBaseã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰
æ•°æ®å¤„ç†ï¼šè„±æ•ã€æ ¡éªŒã€ç»Ÿè®¡ã€ç¼“å­˜
ç›‘æ§å‘Šè­¦ï¼šçŠ¶æ€ç›‘æ§ã€å¼‚å¸¸å‘Šè­¦
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ å¼€å‘æµç¨‹å»ºè®®**
1. **éœ€æ±‚åˆ†æ** - æ˜ç¡®è¦è§£å†³ä»€ä¹ˆé—®é¢˜
2. **æ¥å£è®¾è®¡** - å®šä¹‰æ¸…æ™°çš„è¾“å…¥è¾“å‡ºæ¥å£  
3. **æ ¸å¿ƒå®ç°** - å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
4. **å•å…ƒæµ‹è¯•** - ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
5. **é›†æˆæµ‹è¯•** - åœ¨çœŸå®ç¯å¢ƒä¸­æµ‹è¯•
6. **æ€§èƒ½ä¼˜åŒ–** - æ ¹æ®æµ‹è¯•ç»“æœä¼˜åŒ–æ€§èƒ½
7. **éƒ¨ç½²ä¸Šçº¿** - ç°åº¦å‘å¸ƒï¼Œé€æ­¥å…¨é‡

**ğŸ›¡ï¸ å¼€å‘æ³¨æ„äº‹é¡¹**
```
å¼‚å¸¸å¤„ç†ï¼š
- æ‰€æœ‰å¼‚å¸¸éƒ½è¦å¦¥å–„å¤„ç†
- ä¸èƒ½å› ä¸ºè‡ªå®šä¹‰é€»è¾‘å¯¼è‡´Maxwellå´©æºƒ
- æä¾›é™çº§æœºåˆ¶

æ€§èƒ½è€ƒè™‘ï¼š
- é¿å…é˜»å¡æ“ä½œ
- åˆç†ä½¿ç”¨çº¿ç¨‹æ± 
- æ³¨æ„å†…å­˜ä½¿ç”¨

æ—¥å¿—è®°å½•ï¼š
- è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- å…³é”®æ“ä½œçš„å®¡è®¡æ—¥å¿—
- æ€§èƒ½ç›‘æ§æŒ‡æ ‡
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Maxwellè‡ªå®šä¹‰å¼€å‘ä¸»è¦å›´ç»•Producerã€Filterã€Pluginä¸‰å¤§ç»„ä»¶
- æ‰€æœ‰è‡ªå®šä¹‰ç»„ä»¶éƒ½è¦å®ç°å¯¹åº”æ¥å£ï¼Œéµå¾ªMaxwellçš„è§„èŒƒ
- å¼€å‘æ—¶è¦å……åˆ†è€ƒè™‘å¼‚å¸¸å¤„ç†å’Œæ€§èƒ½å½±å“
- é€šè¿‡æ‰©å±•ç‚¹æœºåˆ¶å¯ä»¥åœ¨ä¸ä¿®æ”¹æ ¸å¿ƒä»£ç çš„æƒ…å†µä¸‹å¢å¼ºåŠŸèƒ½