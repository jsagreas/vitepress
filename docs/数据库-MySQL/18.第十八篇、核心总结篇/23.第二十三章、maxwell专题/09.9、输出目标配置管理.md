---
title: 9ã€è¾“å‡ºç›®æ ‡é…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [Maxwellè¾“å‡ºç›®æ ‡æ¦‚è§ˆ](#1-Maxwellè¾“å‡ºç›®æ ‡æ¦‚è§ˆ)
2. [Kafka Produceré…ç½®](#2-Kafka-Produceré…ç½®)
3. [Redisè¾“å‡ºé…ç½®](#3-Redisè¾“å‡ºé…ç½®)
4. [Fileæ–‡ä»¶è¾“å‡º](#4-Fileæ–‡ä»¶è¾“å‡º)
5. [Stdoutæ ‡å‡†è¾“å‡º](#5-Stdoutæ ‡å‡†è¾“å‡º)
6. [Kinesisè¾“å‡ºé…ç½®](#6-Kinesisè¾“å‡ºé…ç½®)
7. [SQSé˜Ÿåˆ—è¾“å‡º](#7-SQSé˜Ÿåˆ—è¾“å‡º)
8. [è‡ªå®šä¹‰Producerå¼€å‘](#8-è‡ªå®šä¹‰Producerå¼€å‘)
9. [è¾“å‡ºæ ¼å¼é…ç½®](#9-è¾“å‡ºæ ¼å¼é…ç½®)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Maxwellè¾“å‡ºç›®æ ‡æ¦‚è§ˆ


### 1.1 ä»€ä¹ˆæ˜¯Maxwellè¾“å‡ºç›®æ ‡


**Maxwellè¾“å‡ºç›®æ ‡**å°±æ˜¯æŒ‡å®šMaxwellæŠŠæ•è·åˆ°çš„MySQLæ•°æ®å˜æ›´å‘é€åˆ°å“ªé‡Œå»ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒä½ å†™ä¿¡è¦é€‰æ‹©é‚®å¯„æ–¹å¼ä¸€æ ·ï¼ŒMaxwellæ•è·åˆ°æ•°æ®å˜åŒ–åï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ª"æŠ•é€’æ–¹å¼"æŠŠè¿™äº›å˜åŒ–ä¿¡æ¯é€åˆ°ç›®çš„åœ°ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
MySQLæ•°æ®å˜æ›´ â†’ Maxwellæ•è· â†’ è¾“å‡ºç›®æ ‡ â†’ æ•°æ®æ¶ˆè´¹æ–¹

æ•°æ®æµå‘ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL     â”‚â”€â”€â”€â†’â”‚   Maxwell   â”‚â”€â”€â”€â†’â”‚  è¾“å‡ºç›®æ ‡    â”‚
â”‚  (æ•°æ®å˜æ›´)  â”‚    â”‚  (æ•°æ®æ•è·)  â”‚    â”‚ (Kafka/Redis)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ”¯æŒçš„è¾“å‡ºç›®æ ‡ç±»å‹


**Maxwellä¸»è¦æ”¯æŒçš„è¾“å‡ºç›®æ ‡**ï¼š

| è¾“å‡ºç±»å‹ | **ç”¨é€”è¯´æ˜** | **é€‚ç”¨åœºæ™¯** | **é…ç½®å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|
| ğŸ”¥ **Kafka** | `æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé«˜ååé‡` | `ç”Ÿäº§ç¯å¢ƒä¸»æµé€‰æ‹©` | `â­â­â­` |
| ğŸ—„ï¸ **Redis** | `å†…å­˜æ•°æ®åº“ï¼Œå¿«é€Ÿè®¿é—®` | `å®æ—¶ç¼“å­˜æ›´æ–°` | `â­â­` |
| ğŸ“ **File** | `æœ¬åœ°æ–‡ä»¶å­˜å‚¨` | `æµ‹è¯•ç¯å¢ƒã€æ—¥å¿—å½’æ¡£` | `â­` |
| ğŸ–¥ï¸ **Stdout** | `æ§åˆ¶å°è¾“å‡º` | `å¼€å‘è°ƒè¯•` | `â­` |
| â˜ï¸ **Kinesis** | `AWSäº‘æœåŠ¡` | `AWSç¯å¢ƒæ•°æ®æµ` | `â­â­â­â­` |
| ğŸ“® **SQS** | `AWSæ¶ˆæ¯é˜Ÿåˆ—` | `AWSç¯å¢ƒå¼‚æ­¥å¤„ç†` | `â­â­â­` |

### 1.3 é€‰æ‹©è¾“å‡ºç›®æ ‡çš„è€ƒè™‘å› ç´ 


**é€‰æ‹©æ ‡å‡†**ï¼š
```
ğŸ”¸ æ•°æ®é‡å¤§å°
â€¢ å°æ•°æ®é‡ï¼šFileã€Stdout
â€¢ å¤§æ•°æ®é‡ï¼šKafkaã€Kinesis

ğŸ”¸ æ€§èƒ½è¦æ±‚  
â€¢ é«˜æ€§èƒ½ï¼šKafkaã€Redis
â€¢ ä¸€èˆ¬æ€§èƒ½ï¼šFileã€SQS

ğŸ”¸ æ¶æ„ç¯å¢ƒ
â€¢ æœ¬åœ°ç¯å¢ƒï¼šFileã€Stdoutã€Redis
â€¢ åˆ†å¸ƒå¼ç¯å¢ƒï¼šKafka
â€¢ AWSäº‘ç¯å¢ƒï¼šKinesisã€SQS

ğŸ”¸ ä½¿ç”¨ç›®çš„
â€¢ å¼€å‘è°ƒè¯•ï¼šStdout
â€¢ å®æ—¶ç¼“å­˜ï¼šRedis  
â€¢ æ•°æ®æµå¤„ç†ï¼šKafkaã€Kinesis
â€¢ å¼‚æ­¥é˜Ÿåˆ—ï¼šSQS
```

---

## 2. ğŸ”¥ Kafka Produceré…ç½®


### 2.1 ä¸ºä»€ä¹ˆé€‰æ‹©Kafka


**Kafkaçš„æ ¸å¿ƒä¼˜åŠ¿**ï¼š
```
âœ… é«˜ååé‡ï¼šå•èŠ‚ç‚¹æ¯ç§’å¤„ç†ç™¾ä¸‡çº§æ¶ˆæ¯
âœ… åˆ†å¸ƒå¼ï¼šé›†ç¾¤éƒ¨ç½²ï¼Œé«˜å¯ç”¨æ€§
âœ… æŒä¹…åŒ–ï¼šæ•°æ®å¯é å­˜å‚¨ä¸ä¸¢å¤±
âœ… ç”Ÿæ€ä¸°å¯Œï¼šä¸å¤§æ•°æ®å·¥å…·æ— ç¼é›†æˆ
```

> ğŸ“– **æ¦‚å¿µè§£é‡Š**ï¼šKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå°±åƒä¸€ä¸ªè¶…å¤§å®¹é‡çš„é‚®å±€ï¼Œå¯ä»¥æ¥æ”¶å¤§é‡é‚®ä»¶å¹¶åˆ†ç±»å­˜å‚¨ï¼Œè®©ä¸åŒçš„æ”¶ä»¶äººæŒ‰éœ€é¢†å–ã€‚

### 2.2 åŸºç¡€Kafkaé…ç½®


**é…ç½®æ–‡ä»¶ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - KafkaåŸºç¡€é…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°Kafka
producer=kafka

# Kafkaé›†ç¾¤åœ°å€ï¼ˆå¿…éœ€ï¼‰
kafka.bootstrap.servers=localhost:9092,kafka2:9092,kafka3:9092

# é»˜è®¤Topicåç§°
kafka_topic=maxwell

# åˆ†åŒºç­–ç•¥
kafka.partition_key=database
```

**æ ¸å¿ƒé…ç½®è¯´æ˜**ï¼š

| é…ç½®é¡¹ | **å«ä¹‰** | **ç¤ºä¾‹å€¼** | **è¯´æ˜** |
|-------|---------|-----------|---------|
| `producer` | `è¾“å‡ºç±»å‹` | `kafka` | `æŒ‡å®šä½¿ç”¨Kafkaä½œä¸ºè¾“å‡º` |
| `kafka.bootstrap.servers` | `KafkaæœåŠ¡å™¨åœ°å€` | `localhost:9092` | `å¯ä»¥é…ç½®å¤šä¸ªï¼Œé€—å·åˆ†éš”` |
| `kafka_topic` | `é»˜è®¤Topicåç§°` | `maxwell` | `æ•°æ®å‘é€åˆ°çš„ä¸»é¢˜` |
| `kafka.partition_key` | `åˆ†åŒºé”®` | `database` | `å†³å®šæ•°æ®å‘é€åˆ°å“ªä¸ªåˆ†åŒº` |

### 2.3 é«˜çº§Kafkaé…ç½®


**æ€§èƒ½ä¼˜åŒ–é…ç½®**ï¼š
```properties
# ğŸ“ config.properties - Kafkaé«˜çº§é…ç½®

# æ‰¹é‡å‘é€ä¼˜åŒ–
kafka.batch.size=16384
kafka.linger.ms=5

# å‹ç¼©é…ç½®
kafka.compression.type=gzip

# é‡è¯•é…ç½®
kafka.retries=3
kafka.retry.backoff.ms=1000

# å¯é æ€§é…ç½®
kafka.acks=all
kafka.enable.idempotence=true

# ç¼“å†²åŒºé…ç½®
kafka.buffer.memory=33554432
kafka.max.block.ms=60000
```

**åˆ†åŒºç­–ç•¥é…ç½®**ï¼š
```properties
# æŒ‰æ•°æ®åº“åˆ†åŒº
kafka.partition_key=database

# æŒ‰è¡¨åˆ†åŒº  
kafka.partition_key=table

# æŒ‰ä¸»é”®åˆ†åŒº
kafka.partition_key=primary_key

# è‡ªå®šä¹‰åˆ†åŒºå‡½æ•°
kafka.partition_hash=murmur3
```

### 2.4 Topicç®¡ç†é…ç½®


**åŠ¨æ€Topicé…ç½®**ï¼š
```properties
# åŸºäºæ•°æ®åº“çš„Topic
kafka_topic=maxwell_%{database}

# åŸºäºè¡¨çš„Topic  
kafka_topic=maxwell_%{database}_%{table}

# åŸºäºæ“ä½œç±»å‹çš„Topic
kafka_topic=maxwell_%{type}

# Topicæ˜ å°„é…ç½®
include_tables=db1.users,db1.orders
kafka_topic=user_data
```

**Topicåˆ›å»ºå‚æ•°**ï¼š
```bash
# åˆ›å»ºMaxwell Topic
kafka-topics.sh --create \
  --topic maxwell \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 2 \
  --config retention.ms=604800000
```

---

## 3. ğŸ—„ï¸ Redisè¾“å‡ºé…ç½®


### 3.1 Redisè¾“å‡ºçš„ä½¿ç”¨åœºæ™¯


**é€‚ç”¨åœºæ™¯**ï¼š
```
ğŸ”¸ å®æ—¶ç¼“å­˜æ›´æ–°
â€¢ æ•°æ®åº“å˜æ›´åç«‹å³æ›´æ–°Redisç¼“å­˜
â€¢ ä¿æŒç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥

ğŸ”¸ å®æ—¶è®¡æ•°ç»Ÿè®¡
â€¢ ç”¨æˆ·è¡Œä¸ºå®æ—¶è®¡æ•°
â€¢ å•†å“åº“å­˜å®æ—¶æ›´æ–°

ğŸ”¸ æ¶ˆæ¯é€šçŸ¥
â€¢ æ•°æ®å˜æ›´å®æ—¶é€šçŸ¥
â€¢ è§¦å‘ä¸šåŠ¡é€»è¾‘
```

> ğŸ’¡ **å®é™…åº”ç”¨**ï¼šæ¯”å¦‚ç”µå•†ç³»ç»Ÿä¸­ï¼Œå½“å•†å“ä»·æ ¼åœ¨MySQLä¸­å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒMaxwellå¯ä»¥ç«‹å³å°†è¿™ä¸ªå˜åŒ–æ¨é€åˆ°Redisï¼Œç¡®ä¿ç”¨æˆ·çœ‹åˆ°çš„ä»·æ ¼æ˜¯æœ€æ–°çš„ã€‚

### 3.2 åŸºç¡€Redisé…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - RedisåŸºç¡€é…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°Redis
producer=redis

# RedisæœåŠ¡å™¨é…ç½®
redis_host=localhost
redis_port=6379
redis_auth=your_password
redis_database=0

# è¿æ¥æ± é…ç½®
redis_pool_size=20
```

**Redisè¾“å‡ºæ ¼å¼**ï¼š
```json
// Redisä¸­å­˜å‚¨çš„æ•°æ®æ ¼å¼
{
  "database": "shop_db",
  "table": "products", 
  "type": "update",
  "ts": 1578530172,
  "xid": 123456,
  "data": {
    "id": 1,
    "name": "iPhone 12",
    "price": 6999.00
  },
  "old": {
    "price": 7999.00
  }
}
```

### 3.3 Redis Keyç­–ç•¥é…ç½®


**Keyå‘½åç­–ç•¥**ï¼š
```properties
# åŸºäºè¡¨çš„Keyç­–ç•¥
redis_key=maxwell:%{database}:%{table}:%{primary_key}

# åŸºäºæ“ä½œç±»å‹çš„Keyç­–ç•¥  
redis_key=maxwell:%{type}:%{database}:%{table}

# è‡ªå®šä¹‰Keyç­–ç•¥
redis_key=data_sync:%{database}_%{table}_%{id}
```

**Keyç¤ºä¾‹**ï¼š
```
# ç”¨æˆ·è¡¨æ›´æ–°
maxwell:shop_db:users:1001

# è®¢å•è¡¨æ’å…¥
maxwell:insert:shop_db:orders

# å•†å“è¡¨åˆ é™¤
data_sync:shop_db_products_1234
```

### 3.4 Redisé«˜çº§åŠŸèƒ½é…ç½®


**å‘å¸ƒè®¢é˜…æ¨¡å¼**ï¼š
```properties
# å¯ç”¨Rediså‘å¸ƒè®¢é˜…
redis_pub_channel=maxwell_changes

# åŸºäºè¡¨çš„é¢‘é“
redis_pub_channel=changes_%{database}_%{table}

# åŸºäºæ“ä½œçš„é¢‘é“
redis_pub_channel=db_changes_%{type}
```

**è¿‡æœŸæ—¶é—´é…ç½®**ï¼š
```properties
# è®¾ç½®Keyè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
redis_expire=3600

# ä¸åŒè¡¨è®¾ç½®ä¸åŒè¿‡æœŸæ—¶é—´
redis_expire_users=86400
redis_expire_logs=3600
```

---

## 4. ğŸ“ Fileæ–‡ä»¶è¾“å‡º


### 4.1 Fileè¾“å‡ºçš„ä½¿ç”¨åœºæ™¯


**é€‚ç”¨åœºæ™¯**ï¼š
```
ğŸ”¸ å¼€å‘æµ‹è¯•ç¯å¢ƒ
â€¢ æœ¬åœ°å¼€å‘æ—¶æŸ¥çœ‹æ•°æ®å˜æ›´
â€¢ æµ‹è¯•Maxwellé…ç½®æ˜¯å¦æ­£ç¡®

ğŸ”¸ æ•°æ®å®¡è®¡å½’æ¡£
â€¢ é•¿æœŸä¿å­˜æ•°æ®å˜æ›´è®°å½•
â€¢ åˆè§„æ€§è¦æ±‚çš„å®¡è®¡æ—¥å¿—

ğŸ”¸ ç¦»çº¿æ•°æ®åˆ†æ
â€¢ æ‰¹é‡å¤„ç†å†å²å˜æ›´æ•°æ®
â€¢ æ•°æ®æŒ–æ˜å’Œåˆ†æ
```

### 4.2 åŸºç¡€Fileé…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - FileåŸºç¡€é…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°æ–‡ä»¶
producer=file

# è¾“å‡ºæ–‡ä»¶è·¯å¾„
file=/var/log/maxwell/maxwell.log

# æ–‡ä»¶è¾“å‡ºæ ¼å¼
output_format=json
```

**è¾“å‡ºæ–‡ä»¶å†…å®¹ç¤ºä¾‹**ï¼š
```json
{"database":"shop_db","table":"users","type":"insert","ts":1578530172,"xid":123456,"commit":true,"data":{"id":1001,"name":"å¼ ä¸‰","email":"zhangsan@example.com"}}
{"database":"shop_db","table":"products","type":"update","ts":1578530173,"xid":123457,"commit":true,"data":{"id":1,"name":"iPhone 12","price":6999.00},"old":{"price":7999.00}}
```

### 4.3 æ–‡ä»¶è½®è½¬é…ç½®


**æ—¥å¿—è½®è½¬ç­–ç•¥**ï¼š
```properties
# æŒ‰å¤§å°è½®è½¬
file=/var/log/maxwell/maxwell.log
file_max_size=100MB

# æŒ‰æ—¶é—´è½®è½¬
file=/var/log/maxwell/maxwell-%Y%m%d.log

# ä¿ç•™æ–‡ä»¶æ•°é‡
file_max_age=7days
file_max_count=30
```

**è½®è½¬æ–‡ä»¶ç¤ºä¾‹**ï¼š
```
/var/log/maxwell/
â”œâ”€â”€ maxwell-20231201.log
â”œâ”€â”€ maxwell-20231202.log  
â”œâ”€â”€ maxwell-20231203.log
â””â”€â”€ maxwell.log (å½“å‰)
```

### 4.4 æ–‡ä»¶æ ¼å¼é…ç½®


**è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼**ï¼š
```properties
# JSONæ ¼å¼ï¼ˆé»˜è®¤ï¼‰
output_format=json

# CSVæ ¼å¼
output_format=csv
csv_header=true
csv_delimiter=,

# è‡ªå®šä¹‰æ ¼å¼
output_format=template
template=%{database}.%{table}: %{type} %{data}
```

---

## 5. ğŸ–¥ï¸ Stdoutæ ‡å‡†è¾“å‡º


### 5.1 Stdoutè¾“å‡ºçš„ç”¨é€”


**ä¸»è¦ç”¨é€”**ï¼š
```
ğŸ”¸ å¼€å‘è°ƒè¯•
â€¢ å®æ—¶æŸ¥çœ‹Maxwellæ•è·çš„æ•°æ®
â€¢ éªŒè¯è¿‡æ»¤è§„åˆ™æ˜¯å¦æ­£ç¡®

ğŸ”¸ æµ‹è¯•éªŒè¯
â€¢ æµ‹è¯•Maxwellé…ç½®
â€¢ éªŒè¯æ•°æ®æ ¼å¼æ˜¯å¦ç¬¦åˆé¢„æœŸ

ğŸ”¸ ç®¡é“å¤„ç†
â€¢ ä¸å…¶ä»–å‘½ä»¤è¡Œå·¥å…·é…åˆ
â€¢ Shellè„šæœ¬ä¸­çš„æ•°æ®å¤„ç†
```

> ğŸ’¡ **å®é™…ä½¿ç”¨**ï¼šå°±åƒç¨‹åºå‘˜è°ƒè¯•ä»£ç æ—¶ç”¨`console.log`ä¸€æ ·ï¼ŒStdoutè¾“å‡ºè®©ä½ èƒ½ç›´æ¥åœ¨ç»ˆç«¯çœ‹åˆ°Maxwellæ•è·çš„æ¯ä¸€æ¡æ•°æ®å˜æ›´ã€‚

### 5.2 StdoutåŸºç¡€é…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - Stdouté…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
producer=stdout

# è¾“å‡ºæ ¼å¼
output_format=json

# ç¾åŒ–è¾“å‡º
json_pretty_print=true
```

**è¿è¡Œæ•ˆæœ**ï¼š
```bash
# å¯åŠ¨Maxwell
bin/maxwell --config=config.properties

# æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹
{
  "database" : "shop_db",
  "table" : "users", 
  "type" : "insert",
  "ts" : 1578530172,
  "xid" : 123456,
  "data" : {
    "id" : 1001,
    "name" : "å¼ ä¸‰",
    "email" : "zhangsan@example.com"
  }
}
```

### 5.3 ç»“åˆShellä½¿ç”¨


**ç®¡é“å¤„ç†ç¤ºä¾‹**ï¼š
```bash
# å°†è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶
bin/maxwell --config=config.properties > maxwell.log

# è¿‡æ»¤ç‰¹å®šè¡¨çš„å˜æ›´
bin/maxwell --config=config.properties | grep "users"

# å®æ—¶ç»Ÿè®¡å˜æ›´æ•°é‡
bin/maxwell --config=config.properties | wc -l

# ç»“åˆjqå¤„ç†JSON
bin/maxwell --config=config.properties | jq '.data.name'
```

---

## 6. â˜ï¸ Kinesisè¾“å‡ºé…ç½®


### 6.1 AWS Kinesisç®€ä»‹


**Kinesisæ ¸å¿ƒæ¦‚å¿µ**ï¼š
```
AWS Kinesisï¼šäºšé©¬é€Šäº‘çš„å®æ—¶æ•°æ®æµæœåŠ¡
ä½œç”¨ï¼šå¤„ç†å¤§è§„æ¨¡å®æ—¶æ•°æ®æµ
ä¼˜åŠ¿ï¼šä¸AWSç”Ÿæ€ç³»ç»Ÿæ·±åº¦é›†æˆ
```

> ğŸ“– **é€šä¿—ç†è§£**ï¼šKinesiså°±åƒä¸€æ¡é«˜é€Ÿä¼ é€å¸¦ï¼Œå¯ä»¥å®æ—¶ä¼ è¾“å¤§é‡æ•°æ®åˆ°AWSäº‘ç«¯è¿›è¡Œå¤„ç†å’Œåˆ†æã€‚

**Kinesisæ¶æ„å›¾**ï¼š
```
MySQL â†’ Maxwell â†’ Kinesis â†’ Lambda/Analytics/S3
                     â†“
                  å®æ—¶åˆ†æ/å­˜å‚¨
```

### 6.2 KinesisåŸºç¡€é…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - Kinesisé…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°Kinesis
producer=kinesis

# AWSåŒºåŸŸé…ç½®
kinesis_stream=maxwell-stream
aws_region=us-east-1

# AWSè®¤è¯é…ç½®
aws_access_key_id=your_access_key
aws_secret_access_key=your_secret_key

# åˆ†åŒºé”®é…ç½®
kinesis_partition_key=database
```

### 6.3 AWSè®¤è¯é…ç½®


**å¤šç§è®¤è¯æ–¹å¼**ï¼š
```properties
# æ–¹å¼1ï¼šç›´æ¥é…ç½®å¯†é’¥
aws_access_key_id=AKIAXXXXXXXXXXXXXXXX
aws_secret_access_key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# æ–¹å¼2ï¼šä½¿ç”¨IAMè§’è‰²
# åœ¨EC2å®ä¾‹ä¸Šè¿è¡Œæ—¶è‡ªåŠ¨è·å–IAMè§’è‰²æƒé™

# æ–¹å¼3ï¼šä½¿ç”¨AWSå‡­è¯æ–‡ä»¶
# ~/.aws/credentials æ–‡ä»¶é…ç½®
```

**IAMæƒé™è¦æ±‚**ï¼š
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "kinesis:PutRecord",
        "kinesis:PutRecords"
      ],
      "Resource": "arn:aws:kinesis:us-east-1:account-id:stream/maxwell-stream"
    }
  ]
}
```

### 6.4 Kinesisæ€§èƒ½ä¼˜åŒ–


**æ‰¹é‡å‘é€é…ç½®**ï¼š
```properties
# æ‰¹é‡å¤§å°é…ç½®
kinesis_max_batch_size=500
kinesis_batch_timeout=1000

# é‡è¯•é…ç½®
kinesis_retry_attempts=3
kinesis_retry_delay=1000

# ç¼“å†²é…ç½®
kinesis_buffer_size=1000
```

---

## 7. ğŸ“® SQSé˜Ÿåˆ—è¾“å‡º


### 7.1 AWS SQSç®€ä»‹


**SQSæ ¸å¿ƒç‰¹ç‚¹**ï¼š
```
AWS SQSï¼šäºšé©¬é€Šäº‘çš„æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡
ç‰¹ç‚¹ï¼šå®Œå…¨æ‰˜ç®¡çš„æ¶ˆæ¯é˜Ÿåˆ—
ä¼˜åŠ¿ï¼šæ— éœ€è¿ç»´ï¼ŒæŒ‰ä½¿ç”¨ä»˜è´¹
ç±»å‹ï¼šæ ‡å‡†é˜Ÿåˆ— vs FIFOé˜Ÿåˆ—
```

> ğŸ’¡ **å®é™…åº”ç”¨**ï¼šSQSå°±åƒä¸€ä¸ªé‚®ç®±ç³»ç»Ÿï¼ŒMaxwellæŠŠæ•°æ®å˜æ›´å½“ä½œ"é‚®ä»¶"æŠ•é€’åˆ°SQS"é‚®ç®±"ä¸­ï¼Œå…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥ä»é‚®ç®±ä¸­å–å‡ºå¤„ç†ã€‚

### 7.2 SQSåŸºç¡€é…ç½®


**é…ç½®ç¤ºä¾‹**ï¼š
```properties
# ğŸ“ config.properties - SQSé…ç½®

# æŒ‡å®šè¾“å‡ºåˆ°SQS
producer=sqs

# SQSé˜Ÿåˆ—é…ç½®
sqs_queue_uri=https://sqs.us-east-1.amazonaws.com/123456789/maxwell-queue
aws_region=us-east-1

# AWSè®¤è¯
aws_access_key_id=your_access_key
aws_secret_access_key=your_secret_key

# æ¶ˆæ¯å±æ€§
sqs_message_group_id=maxwell
```

### 7.3 é˜Ÿåˆ—ç±»å‹é€‰æ‹©


**æ ‡å‡†é˜Ÿåˆ— vs FIFOé˜Ÿåˆ—**ï¼š

| ç‰¹æ€§ | **æ ‡å‡†é˜Ÿåˆ—** | **FIFOé˜Ÿåˆ—** |
|-----|-------------|-------------|
| **ååé‡** | `å‡ ä¹æ— é™åˆ¶` | `300æ¶ˆæ¯/ç§’` |
| **æ¶ˆæ¯é¡ºåº** | `å°½åŠ›ä¿è¯` | `ä¸¥æ ¼æœ‰åº` |
| **é‡å¤æ¶ˆæ¯** | `å¶å°”é‡å¤` | `ç²¾ç¡®ä¸€æ¬¡` |
| **é€‚ç”¨åœºæ™¯** | `é«˜ååé‡åº”ç”¨` | `ä¸¥æ ¼é¡ºåºè¦æ±‚` |

**FIFOé˜Ÿåˆ—é…ç½®**ï¼š
```properties
# FIFOé˜Ÿåˆ—é…ç½®
sqs_queue_uri=https://sqs.us-east-1.amazonaws.com/123456789/maxwell-queue.fifo
sqs_message_group_id=maxwell_%{database}
sqs_message_deduplication_id=%{xid}_%{ts}
```

### 7.4 SQSæ¶ˆæ¯å±æ€§


**è‡ªå®šä¹‰æ¶ˆæ¯å±æ€§**ï¼š
```properties
# æ·»åŠ æ¶ˆæ¯å±æ€§
sqs_message_attributes=true

# å±æ€§æ˜ å°„é…ç½®
sqs_attribute_database=%{database}
sqs_attribute_table=%{table}
sqs_attribute_operation=%{type}
```

---

## 8. ğŸ”§ è‡ªå®šä¹‰Producerå¼€å‘


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªå®šä¹‰Producer


**ä½¿ç”¨åœºæ™¯**ï¼š
```
ğŸ”¸ ç‰¹æ®Šè¾“å‡ºç›®æ ‡
â€¢ Maxwellé»˜è®¤ä¸æ”¯æŒçš„ç³»ç»Ÿ
â€¢ ä¼ä¸šå†…éƒ¨è‡ªç ”ç³»ç»Ÿ

ğŸ”¸ å¤æ‚ä¸šåŠ¡é€»è¾‘
â€¢ æ•°æ®å˜æ›´è§¦å‘å¤æ‚å¤„ç†
â€¢ å¤šç³»ç»Ÿåè°ƒæ›´æ–°

ğŸ”¸ è‡ªå®šä¹‰æ ¼å¼
â€¢ ç‰¹æ®Šçš„æ•°æ®æ ¼å¼è¦æ±‚
â€¢ å¤æ‚çš„æ•°æ®è½¬æ¢é€»è¾‘
```

### 8.2 Produceræ¥å£ä»‹ç»


**æ ¸å¿ƒæ¥å£**ï¼š
```java
// Maxwell Produceræ¥å£
public abstract class AbstractProducer {
    
    // æ¨é€æ•°æ®æ–¹æ³•
    public abstract void push(RowMap r) throws Exception;
    
    // åˆå§‹åŒ–æ–¹æ³•
    public void startup() throws Exception {}
    
    // å…³é—­æ–¹æ³•  
    public void shutdown() throws Exception {}
}
```

**RowMapæ•°æ®ç»“æ„**ï¼š
```java
// RowMapåŒ…å«çš„æ•°æ®
public class RowMap {
    private String database;    // æ•°æ®åº“å
    private String table;       // è¡¨å  
    private String type;        // æ“ä½œç±»å‹ï¼šinsert/update/delete
    private Long timestamp;     // æ—¶é—´æˆ³
    private Map<String, Object> data;  // æ–°æ•°æ®
    private Map<String, Object> old;   // æ—§æ•°æ®(updateæ—¶)
}
```

### 8.3 è‡ªå®šä¹‰Producerç¤ºä¾‹


**HTTP POST Producerç¤ºä¾‹**ï¼š
```java
public class HttpProducer extends AbstractProducer {
    
    private String endpoint;
    private HttpClient client;
    
    // åˆå§‹åŒ–
    @Override
    public void startup() throws Exception {
        this.endpoint = context.getConfig().getString("http_endpoint");
        this.client = HttpClient.newHttpClient();
    }
    
    // æ¨é€æ•°æ®
    @Override 
    public void push(RowMap rowMap) throws Exception {
        // æ„é€ JSONæ•°æ®
        String json = rowMap.toJSON();
        
        // å‘é€HTTPè¯·æ±‚
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(endpoint))
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(json))
            .build();
            
        HttpResponse<String> response = client.send(request, 
            HttpResponse.BodyHandlers.ofString());
            
        if (response.statusCode() != 200) {
            throw new Exception("HTTP push failed: " + response.statusCode());
        }
    }
}
```

### 8.4 ç¼–è¯‘å’Œéƒ¨ç½²è‡ªå®šä¹‰Producer


**ç¼–è¯‘æ­¥éª¤**ï¼š
```bash
# 1. åˆ›å»ºMavené¡¹ç›®
mvn archetype:generate -DgroupId=com.example \
    -DartifactId=maxwell-http-producer

# 2. æ·»åŠ Maxwellä¾èµ–
<dependency>
    <groupId>com.zendesk</groupId>
    <artifactId>maxwell</artifactId>
    <version>1.29.2</version>
</dependency>

# 3. ç¼–è¯‘æ‰“åŒ…
mvn clean package

# 4. å¤åˆ¶JARåˆ°Maxwell libç›®å½•
cp target/maxwell-http-producer-1.0.jar /opt/maxwell/lib/
```

**é…ç½®ä½¿ç”¨**ï¼š
```properties
# ğŸ“ config.properties
producer=http
producer_class=com.example.HttpProducer
http_endpoint=http://localhost:8080/api/data-change
```

---

## 9. ğŸ“Š è¾“å‡ºæ ¼å¼é…ç½®


### 9.1 è¾“å‡ºæ ¼å¼ç±»å‹


**æ”¯æŒçš„æ ¼å¼ç±»å‹**ï¼š
```
ğŸ”¸ JSONæ ¼å¼ï¼ˆé»˜è®¤ï¼‰
â€¢ æ ‡å‡†JSONç»“æ„
â€¢ æ˜“äºè§£æå’Œå¤„ç†

ğŸ”¸ Avroæ ¼å¼  
â€¢ äºŒè¿›åˆ¶æ ¼å¼ï¼Œé«˜æ•ˆå‹ç¼©
â€¢ Schemaè¿›åŒ–æ”¯æŒ

ğŸ”¸ è‡ªå®šä¹‰æ¨¡æ¿
â€¢ çµæ´»çš„æ ¼å¼å®šåˆ¶
â€¢ é€‚é…å„ç§ç³»ç»Ÿè¦æ±‚
```

### 9.2 JSONæ ¼å¼é…ç½®


**æ ‡å‡†JSONæ ¼å¼**ï¼š
```json
{
  "database": "shop_db",
  "table": "users",
  "type": "insert", 
  "ts": 1578530172,
  "xid": 123456,
  "commit": true,
  "data": {
    "id": 1001,
    "name": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "created_at": "2023-12-01 10:30:00"
  }
}
```

**JSONæ ¼å¼å®šåˆ¶**ï¼š
```properties
# åŒ…å«å­—æ®µé…ç½®
output_format=json
include_column_values=true
include_old_values=true  
include_server_id=true

# æ’é™¤å­—æ®µé…ç½®  
exclude_columns=password,secret_token

# ç¾åŒ–è¾“å‡º
json_pretty_print=true
```

### 9.3 è‡ªå®šä¹‰æ¨¡æ¿æ ¼å¼


**æ¨¡æ¿é…ç½®ç¤ºä¾‹**ï¼š
```properties
# å¯ç”¨æ¨¡æ¿æ ¼å¼
output_format=template

# è‡ªå®šä¹‰æ¨¡æ¿
template=%{database}.%{table}|%{type}|%{data.id}|%{data.name}

# CSVæ¨¡æ¿  
template=%{ts},%{database},%{table},%{type},%{data.id},%{data.name}

# SQLæ¨¡æ¿
template=INSERT INTO log_table VALUES ('%{database}', '%{table}', '%{type}', '%{ts}');
```

**æ¨¡æ¿å˜é‡è¯´æ˜**ï¼š

| å˜é‡ | **å«ä¹‰** | **ç¤ºä¾‹** |
|-----|---------|---------|
| `%{database}` | `æ•°æ®åº“å` | `shop_db` |
| `%{table}` | `è¡¨å` | `users` |
| `%{type}` | `æ“ä½œç±»å‹` | `insert/update/delete` |
| `%{ts}` | `æ—¶é—´æˆ³` | `1578530172` |
| `%{data.å­—æ®µå}` | `æ–°æ•°æ®å­—æ®µå€¼` | `%{data.name}` |
| `%{old.å­—æ®µå}` | `æ—§æ•°æ®å­—æ®µå€¼` | `%{old.price}` |

### 9.4 Avroæ ¼å¼é…ç½®


**Avroæ ¼å¼ä¼˜åŠ¿**ï¼š
```
âœ… äºŒè¿›åˆ¶æ ¼å¼ï¼Œä¼ è¾“æ•ˆç‡é«˜
âœ… Schemaè¿›åŒ–ï¼Œå‘åå…¼å®¹
âœ… å‹ç¼©ç‡é«˜ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
âœ… ç±»å‹å®‰å…¨ï¼Œæ•°æ®æ ¡éªŒä¸¥æ ¼
```

**Avroé…ç½®ç¤ºä¾‹**ï¼š
```properties
# å¯ç”¨Avroæ ¼å¼
output_format=avro

# Schemaæ³¨å†Œä¸­å¿ƒ
kafka.value.serializer=io.confluent.kafka.serializers.KafkaAvroSerializer
kafka.schema.registry.url=http://localhost:8081

# Schemaé…ç½®
avro_schema_file=/opt/maxwell/schema/maxwell.avsc
```

**Avro Schemaç¤ºä¾‹**ï¼š
```json
{
  "type": "record",
  "name": "MaxwellRecord",
  "fields": [
    {"name": "database", "type": "string"},
    {"name": "table", "type": "string"},
    {"name": "type", "type": "string"},
    {"name": "ts", "type": "long"},
    {"name": "data", "type": {"type": "map", "values": "string"}}
  ]
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¾“å‡ºç›®æ ‡é€‰æ‹©ï¼šæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„è¾“å‡ºæ–¹å¼
ğŸ”¸ Kafkaé…ç½®ï¼šç”Ÿäº§ç¯å¢ƒçš„ä¸»æµé€‰æ‹©ï¼Œé‡ç‚¹æŒæ¡
ğŸ”¸ é…ç½®ä¼˜åŒ–ï¼šæ€§èƒ½å’Œå¯é æ€§çš„å¹³è¡¡é…ç½®
ğŸ”¸ æ ¼å¼å®šåˆ¶ï¼šæ»¡è¶³ä¸åŒç³»ç»Ÿçš„æ•°æ®æ ¼å¼è¦æ±‚
ğŸ”¸ è‡ªå®šä¹‰å¼€å‘ï¼šæ‰©å±•MaxwellåŠŸèƒ½çš„æ ¸å¿ƒæŠ€èƒ½
```

### 10.2 å…³é”®é…ç½®è¦ç‚¹


**ğŸ”¹ Kafkaé…ç½®æ ¸å¿ƒ**ï¼š
```
æœåŠ¡å™¨åœ°å€ï¼škafka.bootstrap.servers
ä¸»é¢˜é…ç½®ï¼škafka_topic  
åˆ†åŒºç­–ç•¥ï¼škafka.partition_key
æ€§èƒ½ä¼˜åŒ–ï¼šbatch.size, linger.ms, compression.type
å¯é æ€§ï¼šacks=all, enable.idempotence=true
```

**ğŸ”¹ Redisé…ç½®æ ¸å¿ƒ**ï¼š
```
è¿æ¥é…ç½®ï¼šredis_host, redis_port, redis_auth
Keyç­–ç•¥ï¼šredis_keyæ¨¡æ¿é…ç½®
é«˜çº§åŠŸèƒ½ï¼šå‘å¸ƒè®¢é˜…ã€è¿‡æœŸæ—¶é—´
```

**ğŸ”¹ æ–‡ä»¶è¾“å‡ºé…ç½®**ï¼š
```
æ–‡ä»¶è·¯å¾„ï¼šfileé…ç½®
è½®è½¬ç­–ç•¥ï¼šæŒ‰å¤§å°æˆ–æ—¶é—´è½®è½¬
æ ¼å¼é€‰æ‹©ï¼šJSONã€CSVã€è‡ªå®šä¹‰æ¨¡æ¿
```

### 10.3 å®é™…åº”ç”¨å»ºè®®


**é€‰æ‹©å»ºè®®**ï¼š
- **å¼€å‘æµ‹è¯•**ï¼šä½¿ç”¨Stdoutæˆ–Fileï¼Œæ–¹ä¾¿è°ƒè¯•
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé¦–é€‰Kafkaï¼Œå¤‡é€‰Redis
- **AWSç¯å¢ƒ**ï¼šä½¿ç”¨Kinesisæˆ–SQS
- **ç‰¹æ®Šéœ€æ±‚**ï¼šå¼€å‘è‡ªå®šä¹‰Producer

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- **æ‰¹é‡é…ç½®**ï¼šåˆç†è®¾ç½®batch.sizeå’Œlinger.ms
- **å‹ç¼©é…ç½®**ï¼šå¯ç”¨gzipæˆ–snappyå‹ç¼©
- **åˆ†åŒºç­–ç•¥**ï¼šåˆç†é€‰æ‹©åˆ†åŒºé”®é¿å…çƒ­ç‚¹
- **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®ç”Ÿäº§è€…ç›‘æ§å’Œå‘Šè­¦

**æ ¸å¿ƒè®°å¿†**ï¼š
- Maxwellè¾“å‡ºç›®æ ‡æ˜¯æ•°æ®æµå‘çš„å…³é”®é…ç½®
- Kafkaæ˜¯ç”Ÿäº§ç¯å¢ƒçš„ä¸»æµé€‰æ‹©ï¼Œé…ç½®æœ€å¤æ‚ä½†åŠŸèƒ½æœ€å¼º
- ä¸åŒè¾“å‡ºç›®æ ‡é€‚ç”¨äºä¸åŒåœºæ™¯ï¼Œè¦æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©
- è‡ªå®šä¹‰Produceræ˜¯æ‰©å±•MaxwellåŠŸèƒ½çš„é‡è¦æ‰‹æ®µ
- è¾“å‡ºæ ¼å¼é…ç½®è¦å…¼é¡¾æ•ˆç‡å’Œå…¼å®¹æ€§