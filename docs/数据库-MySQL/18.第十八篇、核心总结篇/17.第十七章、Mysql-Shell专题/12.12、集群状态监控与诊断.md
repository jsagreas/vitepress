---
title: 12ã€é›†ç¾¤çŠ¶æ€ç›‘æ§ä¸è¯Šæ–­
---
## ğŸ“š ç›®å½•

1. [é›†ç¾¤çŠ¶æ€æŸ¥è¯¢åŸºç¡€](#1-é›†ç¾¤çŠ¶æ€æŸ¥è¯¢åŸºç¡€)
2. [é›†ç¾¤å¥åº·æ£€æŸ¥è¯¦è§£](#2-é›†ç¾¤å¥åº·æ£€æŸ¥è¯¦è§£)
3. [æˆå‘˜çŠ¶æ€åˆ†æ](#3-æˆå‘˜çŠ¶æ€åˆ†æ)
4. [å¤åˆ¶å»¶è¿Ÿç›‘æ§](#4-å¤åˆ¶å»¶è¿Ÿç›‘æ§)
5. [ç½‘ç»œè¿æ¥è¯Šæ–­](#5-ç½‘ç»œè¿æ¥è¯Šæ–­)
6. [æ€§èƒ½æŒ‡æ ‡ç›‘æ§](#6-æ€§èƒ½æŒ‡æ ‡ç›‘æ§)
7. [é”™è¯¯æ—¥å¿—åˆ†æ](#7-é”™è¯¯æ—¥å¿—åˆ†æ)
8. [é›†ç¾¤æ‹“æ‰‘ç®¡ç†](#8-é›†ç¾¤æ‹“æ‰‘ç®¡ç†)
9. [å¸¸ç”¨è¯Šæ–­å‘½ä»¤](#9-å¸¸ç”¨è¯Šæ–­å‘½ä»¤)
10. [é—®é¢˜å®šä½å®æˆ˜](#10-é—®é¢˜å®šä½å®æˆ˜)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” é›†ç¾¤çŠ¶æ€æŸ¥è¯¢åŸºç¡€


### 1.1 cluster.status()æ ¸å¿ƒæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯cluster.status()**
ç®€å•æ¥è¯´ï¼Œ`cluster.status()`å°±åƒæ˜¯ç»™MySQLé›†ç¾¤åš"ä½“æ£€"çš„å‘½ä»¤ã€‚å°±åƒæˆ‘ä»¬å»åŒ»é™¢ä½“æ£€ä¼šå¾—åˆ°ä¸€ä»½è¯¦ç»†çš„å¥åº·æŠ¥å‘Šä¸€æ ·ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå‘Šè¯‰ä½ é›†ç¾¤ä¸­æ¯ä¸ªæ•°æ®åº“èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€‚

**åŸºæœ¬ç”¨æ³•**
```javascript
// æœ€ç®€å•çš„çŠ¶æ€æŸ¥è¯¢
var cluster = dba.getCluster();
cluster.status();

// è·å–æ‰©å±•ä¿¡æ¯
cluster.status({extended: true});

// æŸ¥è¯¢ç‰¹å®šæŸ¥è¯¢ç»Ÿè®¡
cluster.status({queryMembers: true});
```

### 1.2 çŠ¶æ€ä¿¡æ¯è§£è¯»


**çŠ¶æ€æŠ¥å‘Šçš„ç»„æˆ**
```
é›†ç¾¤çŠ¶æ€æŠ¥å‘ŠåŒ…å«ï¼š
â”œâ”€â”€ é›†ç¾¤åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€æ¨¡å¼ï¼‰
â”œâ”€â”€ é»˜è®¤å‰¯æœ¬é›†çŠ¶æ€
â”‚   â”œâ”€â”€ ä¸»èŠ‚ç‚¹ä¿¡æ¯
â”‚   â”œâ”€â”€ ä»èŠ‚ç‚¹åˆ—è¡¨
â”‚   â””â”€â”€ æ•´ä½“å¥åº·çŠ¶æ€
â””â”€â”€ é›†ç¾¤æ‹“æ‰‘ç»“æ„
```

**å…³é”®çŠ¶æ€å­—æ®µå«ä¹‰**
```javascript
{
  "clusterName": "myCluster",           // é›†ç¾¤åç§°
  "defaultReplicaSet": {                // é»˜è®¤å‰¯æœ¬é›†
    "name": "default",                  
    "primary": "node1:3306",            // ä¸»èŠ‚ç‚¹
    "ssl": "REQUIRED",                  // SSLçŠ¶æ€
    "status": "OK",                     // æ•´ä½“çŠ¶æ€
    "statusText": "Cluster is ONLINE",  // çŠ¶æ€æè¿°
    "topology": {                       // æ‹“æ‰‘ç»“æ„
      "node1:3306": {
        "address": "node1:3306",
        "mode": "R/W",                  // è¯»å†™æ¨¡å¼
        "readReplicas": {},
        "role": "HA",                   // é«˜å¯ç”¨è§’è‰²
        "status": "ONLINE"              // èŠ‚ç‚¹çŠ¶æ€
      }
    }
  }
}
```

### 1.3 çŠ¶æ€å€¼è¯¦è§£


**èŠ‚ç‚¹çŠ¶æ€ç±»å‹**
| çŠ¶æ€ | å«ä¹‰ | è¯´æ˜ |
|------|------|------|
| `ONLINE` | **åœ¨çº¿æ­£å¸¸** | èŠ‚ç‚¹è¿è¡Œæ­£å¸¸ï¼Œå¯ä»¥å¤„ç†è¯·æ±‚ |
| `OFFLINE` | **ç¦»çº¿** | èŠ‚ç‚¹ä¸å¯è¾¾æˆ–å·²åœæ­¢ |
| `RECOVERING` | **æ¢å¤ä¸­** | èŠ‚ç‚¹æ­£åœ¨ä»å…¶ä»–èŠ‚ç‚¹åŒæ­¥æ•°æ® |
| `UNREACHABLE` | **ä¸å¯è¾¾** | ç½‘ç»œé—®é¢˜å¯¼è‡´æ— æ³•è¿æ¥ |
| `ERROR` | **é”™è¯¯çŠ¶æ€** | èŠ‚ç‚¹å‡ºç°ä¸¥é‡é”™è¯¯ |

**é›†ç¾¤æ•´ä½“çŠ¶æ€**
- ğŸŸ¢ **OK**: æ‰€æœ‰èŠ‚ç‚¹æ­£å¸¸å·¥ä½œ
- ğŸŸ¡ **OK_PARTIAL**: éƒ¨åˆ†èŠ‚ç‚¹æœ‰é—®é¢˜ä½†é›†ç¾¤ä»å¯ç”¨
- ğŸ”´ **NO_QUORUM**: å¤±å»å¤šæ•°èŠ‚ç‚¹ï¼Œé›†ç¾¤ä¸å¯å†™
- âš« **OFFLINE**: é›†ç¾¤å®Œå…¨ä¸å¯ç”¨

---

## 2. ğŸ¥ é›†ç¾¤å¥åº·æ£€æŸ¥è¯¦è§£


### 2.1 checkInstanceState()å®ä¾‹æ£€æŸ¥


**æ£€æŸ¥å•ä¸ªå®ä¾‹çŠ¶æ€**
```javascript
// æ£€æŸ¥æŒ‡å®šå®ä¾‹
dba.checkInstanceState("node1:3306");

// æ£€æŸ¥å½“å‰è¿æ¥çš„å®ä¾‹
dba.checkInstanceState();
```

**æ£€æŸ¥ç»“æœè§£è¯»**
```javascript
{
  "reason": "new",                    // å®ä¾‹çŠ¶æ€åŸå› 
  "state": "ok"                      // å®ä¾‹çŠ¶æ€
}
```

**stateçŠ¶æ€å«ä¹‰**
- `ok`: å®ä¾‹çŠ¶æ€æ­£å¸¸
- `error`: å®ä¾‹é…ç½®æœ‰é—®é¢˜
- `warning`: æœ‰è­¦å‘Šä½†å¯ä»¥ä½¿ç”¨

### 2.2 é›†ç¾¤å®Œæ•´æ€§æ£€æŸ¥


**æ£€æŸ¥é›†ç¾¤é…ç½®**
```javascript
var cluster = dba.getCluster();

// æ£€æŸ¥é›†ç¾¤æ•´ä½“å¥åº·
cluster.checkInstanceState();

// éªŒè¯é›†ç¾¤é…ç½®æ˜¯å¦æ­£ç¡®
cluster.rescan();
```

### 2.3 è‡ªåŠ¨åŒ–å¥åº·æ£€æŸ¥è„šæœ¬


**ç®€å•çš„å¥åº·æ£€æŸ¥è„šæœ¬**
```javascript
function checkClusterHealth() {
    try {
        var cluster = dba.getCluster();
        var status = cluster.status();
        
        print("=== é›†ç¾¤å¥åº·æ£€æŸ¥æŠ¥å‘Š ===");
        print("é›†ç¾¤åç§°: " + status.clusterName);
        print("æ•´ä½“çŠ¶æ€: " + status.defaultReplicaSet.status);
        
        // æ£€æŸ¥æ¯ä¸ªèŠ‚ç‚¹
        var topology = status.defaultReplicaSet.topology;
        for (var node in topology) {
            var nodeInfo = topology[node];
            print("èŠ‚ç‚¹ " + node + ": " + nodeInfo.status);
            
            if (nodeInfo.status !== "ONLINE") {
                print("âš ï¸  è­¦å‘Š: èŠ‚ç‚¹ " + node + " çŠ¶æ€å¼‚å¸¸!");
            }
        }
        
    } catch(e) {
        print("âŒ æ£€æŸ¥å¤±è´¥: " + e.message);
    }
}

// è¿è¡Œæ£€æŸ¥
checkClusterHealth();
```

---

## 3. ğŸ‘¥ æˆå‘˜çŠ¶æ€åˆ†æ


### 3.1 èŠ‚ç‚¹è§’è‰²ç†è§£


**èŠ‚ç‚¹è§’è‰²ç±»å‹**
```
Primary (ä¸»èŠ‚ç‚¹):
â”œâ”€â”€ è´Ÿè´£å¤„ç†å†™æ“ä½œ
â”œâ”€â”€ æ¥æ”¶å®¢æˆ·ç«¯çš„å¢åˆ æ”¹è¯·æ±‚
â””â”€â”€ å‘SecondaryèŠ‚ç‚¹å¤åˆ¶æ•°æ®

Secondary (ä»èŠ‚ç‚¹):
â”œâ”€â”€ å¤„ç†åªè¯»æŸ¥è¯¢
â”œâ”€â”€ ä»Primaryæ¥æ”¶æ•°æ®å¤åˆ¶
â””â”€â”€ å¯ä»¥æå‡ä¸ºPrimary

Arbiters (ä»²è£è€…):
â”œâ”€â”€ ä¸å­˜å‚¨æ•°æ®
â”œâ”€â”€ ä»…å‚ä¸é€‰ä¸¾æŠ•ç¥¨
â””â”€â”€ èŠ‚çœå­˜å‚¨ç©ºé—´
```

### 3.2 èŠ‚ç‚¹æ¨¡å¼åˆ†æ


**è¯»å†™æ¨¡å¼è§£é‡Š**
```javascript
// æŸ¥çœ‹è¯¦ç»†çš„èŠ‚ç‚¹æ¨¡å¼ä¿¡æ¯
cluster.status({extended: 1});
```

**æ¨¡å¼ç±»å‹è¯´æ˜**
- `R/W`: **è¯»å†™æ¨¡å¼** - ä¸»èŠ‚ç‚¹ï¼Œå¯ä»¥å¤„ç†æ‰€æœ‰æ“ä½œ
- `R/O`: **åªè¯»æ¨¡å¼** - ä»èŠ‚ç‚¹ï¼Œåªèƒ½å¤„ç†æŸ¥è¯¢
- `n/a`: **ä¸å¯ç”¨** - èŠ‚ç‚¹ç¦»çº¿æˆ–æœ‰é—®é¢˜

### 3.3 æˆå‘˜å˜æ›´æ£€æµ‹


**æ£€æµ‹æˆå‘˜å˜åŒ–**
```javascript
// é‡æ–°æ‰«æé›†ç¾¤æ‹“æ‰‘
cluster.rescan();

// å¦‚æœå‘ç°æœªæ³¨å†Œçš„å®ä¾‹
cluster.rescan({addInstances: "auto"});

// å¦‚æœéœ€è¦ç§»é™¤å¤±æ•ˆå®ä¾‹
cluster.rescan({removeInstances: "auto"});
```

**å¸¸è§æˆå‘˜çŠ¶æ€é—®é¢˜**
```
é—®é¢˜ç±»å‹åŠè§£å†³æ€è·¯:

1. èŠ‚ç‚¹OFFLINE:
   â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥
   â†’ æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
   â†’ æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. èŠ‚ç‚¹RECOVERING:
   â†’ æ­£å¸¸æƒ…å†µï¼Œç­‰å¾…åŒæ­¥å®Œæˆ
   â†’ æ£€æŸ¥åŒæ­¥è¿›åº¦
   â†’ ç¡®è®¤ç½‘ç»œå¸¦å®½è¶³å¤Ÿ

3. èŠ‚ç‚¹UNREACHABLE:
   â†’ æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   â†’ éªŒè¯ç«¯å£æ˜¯å¦å¼€æ”¾
   â†’ æµ‹è¯•ç½‘ç»œè¿é€šæ€§
```

---

## 4. â±ï¸ å¤åˆ¶å»¶è¿Ÿç›‘æ§


### 4.1 å¤åˆ¶å»¶è¿Ÿæ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¤åˆ¶å»¶è¿Ÿ**
å¤åˆ¶å»¶è¿Ÿå°±åƒ"ä¿¡æ¯ä¼ é€’çš„æ—¶é—´å·®"ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸»èŠ‚ç‚¹å°±åƒè€å¸ˆåœ¨é»‘æ¿ä¸Šå†™å­—ï¼Œä»èŠ‚ç‚¹å°±åƒå­¦ç”Ÿåœ¨æŠ„ç¬”è®°ã€‚å¦‚æœå­¦ç”ŸæŠ„å†™é€Ÿåº¦è·Ÿä¸ä¸Šè€å¸ˆçš„ä¹¦å†™é€Ÿåº¦ï¼Œå°±ä¼šäº§ç”Ÿ"å»¶è¿Ÿ"ã€‚

**å»¶è¿Ÿäº§ç”Ÿçš„åŸå› **
```
å¸¸è§å»¶è¿ŸåŸå› :
â”œâ”€â”€ ç½‘ç»œå¸¦å®½ä¸è¶³
â”œâ”€â”€ ä»èŠ‚ç‚¹æ€§èƒ½è¾ƒå·®
â”œâ”€â”€ å¤§é‡å†™æ“ä½œçªå‘
â”œâ”€â”€ ç£ç›˜IOæ€§èƒ½ç“¶é¢ˆ
â””â”€â”€ å¤åˆ¶çº¿ç¨‹é˜»å¡
```

### 4.2 å»¶è¿Ÿç›‘æ§æ–¹æ³•


**æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿ**
```javascript
// è·å–è¯¦ç»†çŠ¶æ€åŒ…å«å»¶è¿Ÿä¿¡æ¯
cluster.status({extended: 2});
```

**æ‰‹åŠ¨æ£€æŸ¥å»¶è¿Ÿ**
```sql
-- åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ
SHOW SLAVE STATUS\G

-- å…³æ³¨è¿™äº›å…³é”®æŒ‡æ ‡
Seconds_Behind_Master: 0    -- å»¶è¿Ÿç§’æ•°
Master_Log_File:           -- ä¸»èŠ‚ç‚¹æ—¥å¿—æ–‡ä»¶
Read_Master_Log_Pos:       -- è¯»å–ä½ç½®
Relay_Log_File:            -- ä¸­ç»§æ—¥å¿—æ–‡ä»¶
Exec_Master_Log_Pos:       -- æ‰§è¡Œä½ç½®
```

### 4.3 å»¶è¿Ÿé˜ˆå€¼è®¾ç½®


**è®¾ç½®å»¶è¿ŸæŠ¥è­¦**
```javascript
function checkReplicationLag() {
    var cluster = dba.getCluster();
    var status = cluster.status({extended: 2});
    
    var topology = status.defaultReplicaSet.topology;
    
    for (var node in topology) {
        var nodeInfo = topology[node];
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å»¶è¿Ÿä¿¡æ¯
        if (nodeInfo.replication && nodeInfo.replication.applierWorkerThreads) {
            var lag = nodeInfo.replication.applierWorkerThreads;
            
            // è®¾ç½®å»¶è¿Ÿé˜ˆå€¼ï¼ˆæ¯”å¦‚30ç§’ï¼‰
            if (lag > 30) {
                print("âš ï¸  èŠ‚ç‚¹ " + node + " å¤åˆ¶å»¶è¿Ÿ: " + lag + " ç§’");
            }
        }
    }
}
```

---

## 5. ğŸŒ ç½‘ç»œè¿æ¥è¯Šæ–­


### 5.1 è¿æ¥çŠ¶æ€æ£€æŸ¥


**ç½‘ç»œè¿æ¥æµ‹è¯•**
```javascript
// æµ‹è¯•åˆ°æŒ‡å®šå®ä¾‹çš„è¿æ¥
dba.checkInstanceConfiguration("node2:3306");

// æ£€æŸ¥å½“å‰é›†ç¾¤çš„æ‰€æœ‰è¿æ¥
var cluster = dba.getCluster();
cluster.status({queryMembers: true});
```

### 5.2 ç½‘ç»œé—®é¢˜è¯Šæ–­


**å¸¸è§ç½‘ç»œé—®é¢˜æ’æŸ¥**
```
ç½‘ç»œè¯Šæ–­æ­¥éª¤:

1. åŸºæœ¬è¿é€šæ€§æµ‹è¯•:
   ping node2
   telnet node2 3306

2. MySQLè¿æ¥æµ‹è¯•:
   mysql -h node2 -P 3306 -u root -p

3. é˜²ç«å¢™æ£€æŸ¥:
   # CentOS/RHEL
   firewall-cmd --list-ports
   
   # Ubuntu
   ufw status

4. ç«¯å£ç›‘å¬æ£€æŸ¥:
   netstat -tlnp | grep 3306
   ss -tlnp | grep 3306
```

### 5.3 ç½‘ç»œé…ç½®éªŒè¯


**é›†ç¾¤ç½‘ç»œè¦æ±‚**
```javascript
// éªŒè¯æ‰€æœ‰èŠ‚ç‚¹é—´çš„ç½‘ç»œè¿æ¥
function validateNetworkConnectivity() {
    var cluster = dba.getCluster();
    var status = cluster.status();
    
    var nodes = Object.keys(status.defaultReplicaSet.topology);
    
    print("=== ç½‘ç»œè¿æ¥éªŒè¯ ===");
    
    for (var i = 0; i < nodes.length; i++) {
        try {
            var session = mysql.getSession(nodes[i]);
            print("âœ… " + nodes[i] + " è¿æ¥æ­£å¸¸");
            session.close();
        } catch(e) {
            print("âŒ " + nodes[i] + " è¿æ¥å¤±è´¥: " + e.message);
        }
    }
}
```

---

## 6. ğŸ“Š æ€§èƒ½æŒ‡æ ‡ç›‘æ§


### 6.1 å…³é”®æ€§èƒ½æŒ‡æ ‡


**é›†ç¾¤æ€§èƒ½æŒ‡æ ‡æ¦‚è§ˆ**
```
æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡:
â”œâ”€â”€ QPS (æ¯ç§’æŸ¥è¯¢æ•°)
â”œâ”€â”€ TPS (æ¯ç§’äº‹åŠ¡æ•°)  
â”œâ”€â”€ è¿æ¥æ•°ç»Ÿè®¡
â”œâ”€â”€ å¤åˆ¶å»¶è¿Ÿæ—¶é—´
â”œâ”€â”€ é”ç­‰å¾…æƒ…å†µ
â””â”€â”€ ç¼“å†²æ± å‘½ä¸­ç‡
```

### 6.2 æ€§èƒ½æ•°æ®æ”¶é›†


**æ”¶é›†æ€§èƒ½ç»Ÿè®¡**
```sql
-- æŸ¥çœ‹å…¨å±€çŠ¶æ€å˜é‡
SHOW GLOBAL STATUS LIKE 'Questions';
SHOW GLOBAL STATUS LIKE 'Com_%';

-- æŸ¥çœ‹è¿æ¥ä¿¡æ¯
SHOW GLOBAL STATUS LIKE 'Connections';
SHOW GLOBAL STATUS LIKE 'Threads_connected';

-- æŸ¥çœ‹InnoDBçŠ¶æ€
SHOW ENGINE INNODB STATUS;
```

### 6.3 æ€§èƒ½ç›‘æ§è„šæœ¬


**è‡ªåŠ¨åŒ–æ€§èƒ½æ”¶é›†**
```javascript
function collectPerformanceMetrics() {
    var cluster = dba.getCluster();
    var status = cluster.status();
    
    var topology = status.defaultReplicaSet.topology;
    
    print("=== æ€§èƒ½æŒ‡æ ‡æŠ¥å‘Š ===");
    
    for (var node in topology) {
        try {
            var session = mysql.getSession(node);
            
            // è·å–QPS
            var result = session.runSql("SHOW GLOBAL STATUS LIKE 'Questions'");
            var questions = result.fetchOne()[1];
            
            // è·å–è¿æ¥æ•°
            result = session.runSql("SHOW GLOBAL STATUS LIKE 'Threads_connected'");
            var connections = result.fetchOne()[1];
            
            print("èŠ‚ç‚¹: " + node);
            print("  æŸ¥è¯¢æ€»æ•°: " + questions);
            print("  å½“å‰è¿æ¥: " + connections);
            
            session.close();
            
        } catch(e) {
            print("âŒ æ— æ³•è·å– " + node + " çš„æ€§èƒ½æ•°æ®");
        }
    }
}
```

---

## 7. ğŸ“‹ é”™è¯¯æ—¥å¿—åˆ†æ


### 7.1 æ—¥å¿—ä½ç½®è¯†åˆ«


**MySQLé”™è¯¯æ—¥å¿—ä½ç½®**
```sql
-- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä½ç½®
SHOW VARIABLES LIKE 'log_error';

-- æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ç›¸å…³é…ç½®
SHOW VARIABLES LIKE '%log%';
```

**å¸¸è§æ—¥å¿—è·¯å¾„**
```
Linuxç³»ç»Ÿå¸¸è§è·¯å¾„:
â”œâ”€â”€ /var/log/mysql/error.log
â”œâ”€â”€ /var/lib/mysql/hostname.err
â”œâ”€â”€ /usr/local/mysql/data/hostname.err
â””â”€â”€ è‡ªå®šä¹‰è·¯å¾„ï¼ˆæŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼‰
```

### 7.2 å…³é”®é”™è¯¯æ¨¡å¼


**é›†ç¾¤ç›¸å…³é”™è¯¯è¯†åˆ«**
```
é‡è¦é”™è¯¯å…³é”®å­—:
â”œâ”€â”€ "Connection refused"     â†’ è¿æ¥è¢«æ‹’ç»
â”œâ”€â”€ "Access denied"          â†’ æƒé™é—®é¢˜
â”œâ”€â”€ "Slave lag"             â†’ å¤åˆ¶å»¶è¿Ÿ
â”œâ”€â”€ "Duplicate entry"       â†’ æ•°æ®å†²çª
â”œâ”€â”€ "Lost connection"       â†’ è¿æ¥ä¸¢å¤±
â””â”€â”€ "Lock wait timeout"     â†’ é”ç­‰å¾…è¶…æ—¶
```

### 7.3 æ—¥å¿—åˆ†æè„šæœ¬


**æ—¥å¿—ç›‘æ§è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# MySQLé›†ç¾¤æ—¥å¿—ç›‘æ§è„šæœ¬

LOG_FILE="/var/log/mysql/error.log"
ALERT_KEYWORDS="ERROR|FATAL|Connection refused|Access denied"

# æ£€æŸ¥æœ€è¿‘çš„é”™è¯¯
echo "=== æœ€è¿‘çš„é”™è¯¯æ—¥å¿— ==="
tail -n 100 $LOG_FILE | grep -E "$ALERT_KEYWORDS" | tail -n 10

# ç»Ÿè®¡é”™è¯¯é¢‘ç‡
echo "=== é”™è¯¯ç»Ÿè®¡ ==="
echo "è¿æ¥é”™è¯¯: $(grep -c "Connection refused" $LOG_FILE)"
echo "æƒé™é”™è¯¯: $(grep -c "Access denied" $LOG_FILE)"
echo "è‡´å‘½é”™è¯¯: $(grep -c "FATAL" $LOG_FILE)"
```

---

## 8. ğŸ—ºï¸ é›†ç¾¤æ‹“æ‰‘ç®¡ç†


### 8.1 æ‹“æ‰‘ç»“æ„ç†è§£


**é›†ç¾¤æ‹“æ‰‘æ¦‚å¿µ**
é›†ç¾¤æ‹“æ‰‘å°±åƒæ˜¯ä¸€å¼ "å®¶æ—å…³ç³»å›¾"ï¼Œæ˜¾ç¤ºäº†å„ä¸ªæ•°æ®åº“èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»å’Œå±‚çº§ç»“æ„ã€‚

```
æ ‡å‡†é›†ç¾¤æ‹“æ‰‘ç¤ºä¾‹:
       Primary (ä¸»èŠ‚ç‚¹)
      /       |        \
Secondary1  Secondary2  Secondary3
 (ä»èŠ‚ç‚¹1)   (ä»èŠ‚ç‚¹2)   (ä»èŠ‚ç‚¹3)
```

### 8.2 æ‹“æ‰‘æŸ¥çœ‹å‘½ä»¤


**è¯¦ç»†æ‹“æ‰‘ä¿¡æ¯**
```javascript
// æŸ¥çœ‹åŸºæœ¬æ‹“æ‰‘
cluster.describe();

// æŸ¥çœ‹è¯¦ç»†æ‹“æ‰‘
cluster.status({extended: 1});

// æŸ¥çœ‹è¿æ¥è¯¦æƒ…
cluster.status({queryMembers: true});
```

### 8.3 æ‹“æ‰‘å˜æ›´æ“ä½œ


**æ·»åŠ èŠ‚ç‚¹**
```javascript
// æ·»åŠ æ–°çš„ä»èŠ‚ç‚¹
cluster.addInstance("node4:3306");

// è®¾ç½®æ¢å¤æ–¹æ³•
cluster.addInstance("node4:3306", {recoveryMethod: "clone"});
```

**ç§»é™¤èŠ‚ç‚¹**
```javascript
// æ­£å¸¸ç§»é™¤èŠ‚ç‚¹
cluster.removeInstance("node4:3306");

// å¼ºåˆ¶ç§»é™¤ï¼ˆèŠ‚ç‚¹å·²ç¦»çº¿ï¼‰
cluster.removeInstance("node4:3306", {force: true});
```

---

## 9. ğŸ› ï¸ å¸¸ç”¨è¯Šæ–­å‘½ä»¤


### 9.1 AdminAPIè¯Šæ–­å‘½ä»¤é›†


**åŸºç¡€è¯Šæ–­å‘½ä»¤**
```javascript
// é›†ç¾¤çŠ¶æ€ç›¸å…³
dba.getCluster().status()                    // æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
dba.getCluster().status({extended: 1})       // è¯¦ç»†çŠ¶æ€
dba.getCluster().describe()                  // é›†ç¾¤æè¿°
dba.getCluster().rescan()                   // é‡æ–°æ‰«æ

// å®ä¾‹æ£€æŸ¥ç›¸å…³  
dba.checkInstanceConfiguration("node:3306")  // æ£€æŸ¥å®ä¾‹é…ç½®
dba.checkInstanceState("node:3306")         // æ£€æŸ¥å®ä¾‹çŠ¶æ€
dba.configureInstance("node:3306")          // é…ç½®å®ä¾‹

// é›†ç¾¤æ“ä½œç›¸å…³
dba.rebootClusterFromCompleteOutage()       // å®Œå…¨å®•æœºåé‡å¯
dba.upgradeMetadata()                       // å‡çº§å…ƒæ•°æ®
```

### 9.2 MySQLåŸç”Ÿè¯Šæ–­å‘½ä»¤


**å¤åˆ¶çŠ¶æ€æ£€æŸ¥**
```sql
-- æŸ¥çœ‹ä¸»ä»çŠ¶æ€
SHOW MASTER STATUS;
SHOW SLAVE STATUS\G

-- æŸ¥çœ‹å¤åˆ¶ç›¸å…³å˜é‡
SHOW VARIABLES LIKE '%replica%';
SHOW VARIABLES LIKE '%slave%';

-- æŸ¥çœ‹å½“å‰è¿æ¥
SHOW PROCESSLIST;
```

**æ€§èƒ½è¯Šæ–­å‘½ä»¤**
```sql
-- æŸ¥çœ‹é”ç­‰å¾…
SELECT * FROM performance_schema.data_locks;
SELECT * FROM performance_schema.data_lock_waits;

-- æŸ¥çœ‹å½“å‰äº‹åŠ¡
SELECT * FROM information_schema.innodb_trx;

-- æŸ¥çœ‹è¡¨ç»Ÿè®¡ä¿¡æ¯
SELECT * FROM information_schema.tables 
WHERE table_schema = 'your_database';
```

### 9.3 ç³»ç»Ÿçº§è¯Šæ–­å‘½ä»¤


**èµ„æºä½¿ç”¨æƒ…å†µ**
```bash
# CPUä½¿ç”¨ç‡
top -p $(pgrep mysqld)

# å†…å­˜ä½¿ç”¨
free -h
ps aux | grep mysqld

# ç£ç›˜IO
iostat -x 1
iotop -p $(pgrep mysqld)

# ç½‘ç»œè¿æ¥
netstat -an | grep 3306
ss -tuln | grep 3306
```

---

## 10. ğŸ”§ é—®é¢˜å®šä½å®æˆ˜


### 10.1 å¸¸è§é—®é¢˜åˆ†ç±»


**é—®é¢˜ç±»å‹åˆ†æ**
```
é›†ç¾¤é—®é¢˜åˆ†ç±»:
â”œâ”€â”€ è¿æ¥é—®é¢˜
â”‚   â”œâ”€â”€ ç½‘ç»œä¸é€š
â”‚   â”œâ”€â”€ é˜²ç«å¢™é˜»æŒ¡
â”‚   â””â”€â”€ æƒé™é…ç½®é”™è¯¯
â”œâ”€â”€ æ€§èƒ½é—®é¢˜  
â”‚   â”œâ”€â”€ å¤åˆ¶å»¶è¿Ÿè¿‡å¤§
â”‚   â”œâ”€â”€ æŸ¥è¯¢å“åº”æ…¢
â”‚   â””â”€â”€ è¿æ¥æ•°è¿‡å¤š
â”œâ”€â”€ æ•°æ®é—®é¢˜
â”‚   â”œâ”€â”€ æ•°æ®ä¸ä¸€è‡´
â”‚   â”œâ”€â”€ ä¸»ä»æ•°æ®å·®å¼‚
â”‚   â””â”€â”€ äº‹åŠ¡å†²çª
â””â”€â”€ æ•…éšœé—®é¢˜
    â”œâ”€â”€ èŠ‚ç‚¹å®•æœº
    â”œâ”€â”€ ç½‘ç»œåˆ†åŒº
    â””â”€â”€ ç¡¬ä»¶æ•…éšœ
```

### 10.2 é—®é¢˜å®šä½æµç¨‹


**æ ‡å‡†è¯Šæ–­æµç¨‹**
```
é—®é¢˜å®šä½å…­æ­¥æ³•:

1. æ”¶é›†ç—‡çŠ¶ä¿¡æ¯
   â”œâ”€â”€ ç”¨æˆ·åé¦ˆçš„é—®é¢˜ç°è±¡
   â”œâ”€â”€ é—®é¢˜å‘ç”Ÿçš„æ—¶é—´
   â””â”€â”€ å½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦

2. æ£€æŸ¥é›†ç¾¤çŠ¶æ€
   â”œâ”€â”€ cluster.status()æŸ¥çœ‹æ•´ä½“çŠ¶æ€
   â”œâ”€â”€ è¯†åˆ«å¼‚å¸¸èŠ‚ç‚¹
   â””â”€â”€ åˆ†æé”™è¯¯ä¿¡æ¯

3. åˆ†æç³»ç»Ÿèµ„æº
   â”œâ”€â”€ CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡
   â”œâ”€â”€ ç½‘ç»œè¿æ¥çŠ¶æ€
   â””â”€â”€ MySQLè¿›ç¨‹çŠ¶æ€

4. æŸ¥çœ‹ç›¸å…³æ—¥å¿—
   â”œâ”€â”€ MySQLé”™è¯¯æ—¥å¿—
   â”œâ”€â”€ ç³»ç»Ÿæ—¥å¿—
   â””â”€â”€ åº”ç”¨æ—¥å¿—

5. æ·±å…¥åˆ†æåŸå› 
   â”œâ”€â”€ å¤ç°é—®é¢˜åœºæ™¯
   â”œâ”€â”€ åˆ†ææ ¹æœ¬åŸå› 
   â””â”€â”€ åˆ¶å®šè§£å†³æ–¹æ¡ˆ

6. éªŒè¯è§£å†³æ•ˆæœ
   â”œâ”€â”€ å®æ–½è§£å†³æ–¹æ¡ˆ
   â”œâ”€â”€ ç›‘æ§ç³»ç»ŸçŠ¶æ€
   â””â”€â”€ ç¡®è®¤é—®é¢˜è§£å†³
```

### 10.3 å®æˆ˜æ¡ˆä¾‹åˆ†æ


**æ¡ˆä¾‹1: èŠ‚ç‚¹OFFLINEé—®é¢˜**
```javascript
// é—®é¢˜ç°è±¡
cluster.status();
// æ˜¾ç¤ºæŸä¸ªèŠ‚ç‚¹çŠ¶æ€ä¸ºOFFLINE

// è¯Šæ–­æ­¥éª¤
// 1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
// ping node2
// telnet node2 3306

// 2. æ£€æŸ¥MySQLæœåŠ¡
// systemctl status mysql

// 3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
// tail -f /var/log/mysql/error.log

// 4. å°è¯•é‡æ–°è¿æ¥
dba.checkInstanceState("node2:3306");

// 5. å¦‚æœæœåŠ¡æ­£å¸¸ï¼Œé‡æ–°åŠ å…¥é›†ç¾¤
cluster.rejoinInstance("node2:3306");
```

**æ¡ˆä¾‹2: å¤åˆ¶å»¶è¿Ÿé—®é¢˜**
```javascript
// é—®é¢˜ç°è±¡
cluster.status({extended: 2});
// æ˜¾ç¤ºæŸä¸ªèŠ‚ç‚¹å¤åˆ¶å»¶è¿Ÿå¾ˆå¤§

// è¯Šæ–­æ­¥éª¤
// 1. æ£€æŸ¥ç½‘ç»œå¸¦å®½
// iperf3 -c primary_node

// 2. æ£€æŸ¥ç£ç›˜IO
// iostat -x 1

// 3. æ£€æŸ¥å¤åˆ¶çŠ¶æ€
var session = mysql.getSession("slow_node:3306");
session.runSql("SHOW SLAVE STATUS\\G");

// 4. ä¼˜åŒ–å¤åˆ¶å‚æ•°
session.runSql("SET GLOBAL slave_parallel_workers = 4");
session.runSql("SET GLOBAL slave_parallel_type = 'LOGICAL_CLOCK'");
```

**æ¡ˆä¾‹3: é›†ç¾¤è„‘è£‚é—®é¢˜**
```javascript
// é—®é¢˜ç°è±¡
// å¤šä¸ªèŠ‚ç‚¹éƒ½è®¤ä¸ºè‡ªå·±æ˜¯Primary

// è¯Šæ–­æ­¥éª¤
// 1. æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
cluster.status();

// 2. æŸ¥çœ‹Group ReplicationçŠ¶æ€
session.runSql("SELECT * FROM performance_schema.replication_group_members");

// 3. å¦‚æœç¡®å®å‘ç”Ÿè„‘è£‚ï¼Œåœæ­¢é›†ç¾¤
cluster.dissolve();

// 4. é‡æ–°å¯åŠ¨é›†ç¾¤
dba.rebootClusterFromCompleteOutage();
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```javascript
// åŸºç¡€çŠ¶æ€æŸ¥è¯¢
cluster.status()                    // åŸºæœ¬çŠ¶æ€
cluster.status({extended: 1})       // è¯¦ç»†çŠ¶æ€
cluster.status({queryMembers: true}) // åŒ…å«æŸ¥è¯¢ç»Ÿè®¡

// å¥åº·æ£€æŸ¥
dba.checkInstanceState()           // æ£€æŸ¥å®ä¾‹çŠ¶æ€
cluster.rescan()                   // é‡æ–°æ‰«ææ‹“æ‰‘

// é—®é¢˜å¤„ç†
cluster.rejoinInstance()           // é‡æ–°åŠ å…¥èŠ‚ç‚¹
cluster.removeInstance()           // ç§»é™¤èŠ‚ç‚¹
dba.rebootClusterFromCompleteOutage() // ç¾éš¾æ¢å¤
```

### 11.2 å…³é”®ç›‘æ§æŒ‡æ ‡


**ä¼˜å…ˆç›‘æ§çš„æŒ‡æ ‡**
```
å¿…ç›‘æ§æŒ‡æ ‡:
âœ… èŠ‚ç‚¹åœ¨çº¿çŠ¶æ€ (ONLINE/OFFLINE)
âœ… é›†ç¾¤æ•´ä½“çŠ¶æ€ (OK/NO_QUORUM)  
âœ… å¤åˆ¶å»¶è¿Ÿæ—¶é—´ (ç§’)
âœ… ç½‘ç»œè¿æ¥çŠ¶æ€
âœ… é”™è¯¯æ—¥å¿—å¼‚å¸¸

é‡è¦æŒ‡æ ‡:
ğŸ“Š QPS/TPSæ€§èƒ½æŒ‡æ ‡
ğŸ“Š è¿æ¥æ•°ç»Ÿè®¡
ğŸ“Š é”ç­‰å¾…æƒ…å†µ
ğŸ“Š ç¼“å†²æ± å‘½ä¸­ç‡
```

### 11.3 é—®é¢˜å¤„ç†åŸåˆ™


**å¤„ç†ä¼˜å…ˆçº§**
```
ç´§æ€¥é—®é¢˜ (ç«‹å³å¤„ç†):
ğŸ”´ é›†ç¾¤æ— æ³•å†™å…¥ (NO_QUORUM)
ğŸ”´ PrimaryèŠ‚ç‚¹å®•æœº
ğŸ”´ æ•°æ®ä¸¢å¤±æˆ–æŸå

é‡è¦é—®é¢˜ (å°½å¿«å¤„ç†):
ğŸŸ¡ èŠ‚ç‚¹OFFLINEä½†é›†ç¾¤å¯ç”¨
ğŸŸ¡ å¤åˆ¶å»¶è¿Ÿè¿‡å¤§
ğŸŸ¡ æ€§èƒ½æ˜æ˜¾ä¸‹é™

ä¸€èˆ¬é—®é¢˜ (è®¡åˆ’å¤„ç†):
ğŸŸ¢ é…ç½®ä¼˜åŒ–å»ºè®®
ğŸŸ¢ æ—¥å¿—æ¸…ç†
ğŸŸ¢ ç›‘æ§æ”¹è¿›
```

### 11.4 æœ€ä½³å®è·µå»ºè®®


**æ—¥å¸¸ç»´æŠ¤è¦ç‚¹**
```
é¢„é˜²æªæ–½:
â”œâ”€â”€ å®šæœŸæ‰§è¡Œå¥åº·æ£€æŸ¥
â”œâ”€â”€ ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡
â”œâ”€â”€ åŠæ—¶æ¸…ç†å’Œåˆ†ææ—¥å¿—
â”œâ”€â”€ ä¿æŒé…ç½®æ–‡æ¡£æ›´æ–°
â””â”€â”€ åˆ¶å®šåº”æ€¥å“åº”é¢„æ¡ˆ

ç›‘æ§è‡ªåŠ¨åŒ–:
â”œâ”€â”€ è®¾ç½®çŠ¶æ€æ£€æŸ¥è„šæœ¬
â”œâ”€â”€ é…ç½®æŠ¥è­¦é˜ˆå€¼
â”œâ”€â”€ å»ºç«‹ç›‘æ§çœ‹æ¿
â”œâ”€â”€ å®šæœŸå¤‡ä»½é…ç½®
â””â”€â”€ æ¼”ç»ƒæ•…éšœæ¢å¤æµç¨‹
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**
- `cluster.status()`æ˜¯é›†ç¾¤ç›‘æ§çš„æ ¸å¿ƒå‘½ä»¤ï¼Œè¦ç†Ÿç»ƒæŒæ¡å„ç§å‚æ•°
- èŠ‚ç‚¹çŠ¶æ€ONLINEæ˜¯æ­£å¸¸ï¼ŒOFFLINEéœ€è¦ç«‹å³å…³æ³¨
- å¤åˆ¶å»¶è¿Ÿæ˜¯æ€§èƒ½ç›‘æ§çš„é‡è¦æŒ‡æ ‡ï¼Œè¦è®¾ç½®åˆç†é˜ˆå€¼
- ç½‘ç»œè¿æ¥é—®é¢˜æ˜¯é›†ç¾¤æ•…éšœçš„å¸¸è§åŸå› ï¼Œè¦é‡ç‚¹æ’æŸ¥
- é”™è¯¯æ—¥å¿—æ˜¯é—®é¢˜å®šä½çš„é‡è¦çº¿ç´¢ï¼Œè¦å…»æˆå®šæœŸæŸ¥çœ‹çš„ä¹ æƒ¯
- é—®é¢˜å®šä½è¦éµå¾ªç³»ç»ŸåŒ–çš„æµç¨‹ï¼Œä»ç—‡çŠ¶åˆ°æ ¹å› é€æ­¥åˆ†æ