---
title: 15ã€Router Bootstrapè‡ªåŠ¨é…ç½®
---
## ðŸ“š ç›®å½•

1. [BootstrapåŸºæœ¬æ¦‚å¿µ](#1-BootstrapåŸºæœ¬æ¦‚å¿µ)
2. [è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¯¦è§£](#2-è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¯¦è§£)
3. [é›†ç¾¤å…ƒæ•°æ®è¯»å–æœºåˆ¶](#3-é›†ç¾¤å…ƒæ•°æ®è¯»å–æœºåˆ¶)
4. [é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ](#4-é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ)
5. [ç”¨æˆ·è´¦æˆ·ä¸Žæƒé™ç®¡ç†](#5-ç”¨æˆ·è´¦æˆ·ä¸Žæƒé™ç®¡ç†)
6. [è·¯ç”±ç«¯å£åˆ†é…ç­–ç•¥](#6-è·¯ç”±ç«¯å£åˆ†é…ç­–ç•¥)
7. [SSLè¯ä¹¦é…ç½®](#7-SSLè¯ä¹¦é…ç½®)
8. [é…ç½®ç›®å½•ç»“æž„è¯¦è§£](#8-é…ç½®ç›®å½•ç»“æž„è¯¦è§£)
9. [Bootstrapå‚æ•°é€‰é¡¹](#9-Bootstrapå‚æ•°é€‰é¡¹)
10. [é…ç½®æ›´æ–°æœºåˆ¶](#10-é…ç½®æ›´æ–°æœºåˆ¶)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸš€ BootstrapåŸºæœ¬æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯Bootstrap


**Bootstrap**æ˜¯MySQL Routerçš„**è‡ªåŠ¨é…ç½®åŠŸèƒ½**ï¼Œå®ƒèƒ½å¤Ÿï¼š
- **è‡ªåŠ¨å‘çŽ°**InnoDB Clusterçš„æ‹“æ‰‘ç»“æž„
- **è‡ªåŠ¨ç”Ÿæˆ**Routeré…ç½®æ–‡ä»¶
- **è‡ªåŠ¨åˆ›å»º**Routerä¸“ç”¨çš„MySQLç”¨æˆ·è´¦æˆ·
- **è‡ªåŠ¨åˆ†é…**åˆé€‚çš„è·¯ç”±ç«¯å£

```
ç®€å•ç†è§£ï¼š
ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹å·¥ç¼–å†™å¤æ‚çš„é…ç½®æ–‡ä»¶ âŒ
Bootstrapæ–¹å¼ï¼šä¸€æ¡å‘½ä»¤è‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½® âœ…

å°±åƒå®‰è£…è½¯ä»¶æ—¶çš„"ä¸€é”®å®‰è£…"åŠŸèƒ½
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦Bootstrap


**ä¼ ç»Ÿæ‰‹å·¥é…ç½®çš„é—®é¢˜**ï¼š
```
âŒ é…ç½®å¤æ‚ï¼šéœ€è¦äº†è§£å¤§é‡é…ç½®å‚æ•°
âŒ å®¹æ˜“å‡ºé”™ï¼šæ‰‹å·¥é…ç½®å®¹æ˜“å†™é”™
âŒ ç»´æŠ¤å›°éš¾ï¼šé›†ç¾¤å˜åŒ–æ—¶éœ€è¦æ‰‹åŠ¨æ›´æ–°
âŒ æƒé™ç®¡ç†ï¼šéœ€è¦æ‰‹åŠ¨åˆ›å»ºç”¨æˆ·å’ŒæŽˆæƒ
```

**Bootstrapçš„ä¼˜åŠ¿**ï¼š
```
âœ… ç®€å•æ˜“ç”¨ï¼šä¸€æ¡å‘½ä»¤å®Œæˆé…ç½®
âœ… è‡ªåŠ¨å‘çŽ°ï¼šè‡ªåŠ¨è¯†åˆ«é›†ç¾¤ç»“æž„
âœ… åŠ¨æ€æ›´æ–°ï¼šé›†ç¾¤å˜åŒ–æ—¶è‡ªåŠ¨è°ƒæ•´
âœ… å®‰å…¨å¯é ï¼šè‡ªåŠ¨å¤„ç†ç”¨æˆ·æƒé™
```

### 1.3 Bootstrapå·¥ä½œåŽŸç†


```
Bootstrapå·¥ä½œæµç¨‹ï¼š

å®¢æˆ·ç«¯                    é›†ç¾¤èŠ‚ç‚¹                   Routeré…ç½®
   |                         |                          |
   |--[1]æ‰§è¡Œbootstrap------>|                          |
   |                         |<--[2]è¯»å–é›†ç¾¤å…ƒæ•°æ®------|
   |                         |                          |
   |<--[3]ç”Ÿæˆé…ç½®æ–‡ä»¶-------|                          |
   |                         |--[4]åˆ›å»ºç”¨æˆ·è´¦æˆ·------->|
   |                         |<--[5]é…ç½®SSLè¯ä¹¦--------|
   |                         |                          |
   |<--[6]å®Œæˆé…ç½®-----------|                          |
```

---

## 2. âš™ï¸ è‡ªåŠ¨é…ç½®è¿‡ç¨‹è¯¦è§£


### 2.1 Bootstrapæ‰§è¡Œæ­¥éª¤


**ç¬¬ä¸€æ­¥ï¼šè¿žæŽ¥éªŒè¯**
```bash
# Bootstrapå‘½ä»¤åŸºæœ¬æ ¼å¼
mysqlrouter --bootstrap username@hostname:port

# ç³»ç»Ÿä¼šï¼š
1. éªŒè¯è¿žæŽ¥å‚æ•°æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç”¨æˆ·æƒé™æ˜¯å¦è¶³å¤Ÿ
3. ç¡®è®¤ç›®æ ‡æ˜¯InnoDB Cluster
```

**ç¬¬äºŒæ­¥ï¼šé›†ç¾¤å‘çŽ°**
```
Bootstrapä¼šè‡ªåŠ¨ï¼š
â€¢ è¯»å–é›†ç¾¤å…ƒæ•°æ®è¡¨
â€¢ è¯†åˆ«Primaryå’ŒSecondaryèŠ‚ç‚¹
â€¢ èŽ·å–é›†ç¾¤åç§°å’Œé…ç½®ä¿¡æ¯
â€¢ æ£€æµ‹é›†ç¾¤å¥åº·çŠ¶æ€
```

**ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç”Ÿæˆ**
```
è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®åŒ…æ‹¬ï¼š
â€¢ è¯»å†™è·¯ç”±é…ç½®ï¼ˆè¿žæŽ¥Primaryï¼‰
â€¢ åªè¯»è·¯ç”±é…ç½®ï¼ˆè¿žæŽ¥Secondaryï¼‰
â€¢ ç«¯å£åˆ†é…
â€¢ è¿žæŽ¥æ± è®¾ç½®
â€¢ æ•…éšœè½¬ç§»é…ç½®
```

### 2.2 é…ç½®è¿‡ç¨‹ç¤ºä¾‹


```bash
# å®žé™…Bootstrapæ‰§è¡Œç¤ºä¾‹
$ mysqlrouter --bootstrap root@192.168.1.10:3306

# è¾“å‡ºè¿‡ç¨‹ï¼š
Bootstrapping MySQL Router instance at '/var/lib/mysqlrouter'...

# æ­¥éª¤1ï¼šéªŒè¯è¿žæŽ¥
Checking for existing Router instance...
Creating account(s) (only those that don't exist)...

# æ­¥éª¤2ï¼šå‘çŽ°é›†ç¾¤
Fetching Cluster metadata from cluster 'myCluster'...
  - Target cluster has 3 members
  - Primary: 192.168.1.10:3306
  - Secondary: 192.168.1.11:3306, 192.168.1.12:3306

# æ­¥éª¤3ï¼šç”Ÿæˆé…ç½®
Creating configuration file...
  - Read-Write port: 6446
  - Read-Only port: 6447
  - X Protocol port: 6448

# æ­¥éª¤4ï¼šåˆ›å»ºç”¨æˆ·
Creating Router user account...
  - mysql_router1_abc123@%

Configuration file created: /var/lib/mysqlrouter/mysqlrouter.conf
```

### 2.3 å¼‚å¸¸å¤„ç†æœºåˆ¶


```
å¸¸è§å¼‚å¸¸æƒ…å†µå¤„ç†ï¼š

è¿žæŽ¥å¤±è´¥ï¼š
â€¢ æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
â€¢ éªŒè¯ç”¨æˆ·åå¯†ç 
â€¢ ç¡®è®¤ç«¯å£æ˜¯å¦æ­£ç¡®

æƒé™ä¸è¶³ï¼š
â€¢ éœ€è¦SUPERæƒé™æˆ–routerä¸“ç”¨æƒé™
â€¢ æ£€æŸ¥ç”¨æˆ·æƒé™è®¾ç½®

é›†ç¾¤çŠ¶æ€å¼‚å¸¸ï¼š
â€¢ é›†ç¾¤æœªå®Œå…¨å¯åŠ¨
â€¢ èŠ‚ç‚¹æ•…éšœå¯¼è‡´å…ƒæ•°æ®ä¸ä¸€è‡´
â€¢ è‡ªåŠ¨ç­‰å¾…é›†ç¾¤æ¢å¤
```

---

## 3. ðŸ“Š é›†ç¾¤å…ƒæ•°æ®è¯»å–æœºåˆ¶


### 3.1 å…ƒæ•°æ®å­˜å‚¨ä½ç½®


MySQL InnoDB Clusterçš„å…ƒæ•°æ®å­˜å‚¨åœ¨ä¸“é—¨çš„ç³»ç»Ÿè¡¨ä¸­ï¼š

```
å…ƒæ•°æ®è¡¨ç»“æž„ï¼š

mysql_innodb_cluster_metadataæ•°æ®åº“
â”œâ”€â”€ clusters                    # é›†ç¾¤åŸºæœ¬ä¿¡æ¯
â”œâ”€â”€ instances                   # å®žä¾‹è¯¦ç»†ä¿¡æ¯  
â”œâ”€â”€ routers                     # Routerå®žä¾‹è®°å½•
â”œâ”€â”€ router_rest_accounts        # Router REST APIè´¦æˆ·
â””â”€â”€ schema_version              # å…ƒæ•°æ®ç‰ˆæœ¬ä¿¡æ¯
```

**clustersè¡¨**ï¼šè®°å½•é›†ç¾¤çš„åŸºæœ¬ä¿¡æ¯
```sql
SELECT cluster_id, cluster_name, description, cluster_type 
FROM mysql_innodb_cluster_metadata.clusters;

# å…¸åž‹è¾“å‡ºï¼š
cluster_id: d10c2c8f-1234-5678-9abc-def012345678
cluster_name: myCluster
cluster_type: gr (Group Replication)
```

### 3.2 å®žä¾‹ä¿¡æ¯è¯»å–


**instancesè¡¨**ï¼šå­˜å‚¨æ¯ä¸ªMySQLå®žä¾‹çš„è¯¦ç»†ä¿¡æ¯
```sql
-- Bootstrapè¯»å–çš„å…³é”®ä¿¡æ¯
SELECT 
    instance_name,
    mysql_server_uuid,
    address,
    xport,
    role
FROM mysql_innodb_cluster_metadata.instances;
```

**å®žä¾‹è§’è‰²è¯†åˆ«**ï¼š
```
Primaryè§’è‰²ï¼š
â€¢ è´Ÿè´£è¯»å†™æ“ä½œ
â€¢ Group Replicationä¸­çš„Primaryæˆå‘˜
â€¢ Bootstrapä¼šè‡ªåŠ¨è¯†åˆ«å¹¶é…ç½®è¯»å†™è·¯ç”±

Secondaryè§’è‰²ï¼š
â€¢ è´Ÿè´£åªè¯»æ“ä½œ  
â€¢ Group Replicationä¸­çš„Secondaryæˆå‘˜
â€¢ Bootstrapé…ç½®åªè¯»è·¯ç”±æŒ‡å‘è¿™äº›èŠ‚ç‚¹
```

### 3.3 åŠ¨æ€å…ƒæ•°æ®æ›´æ–°


```
å…ƒæ•°æ®æ›´æ–°è§¦å‘æ¡ä»¶ï¼š

èŠ‚ç‚¹æ•…éšœï¼š
â”œâ”€â”€ Primaryæ•…éšœ â†’ è‡ªåŠ¨æå‡Secondaryä¸ºPrimary
â”œâ”€â”€ Secondaryæ•…éšœ â†’ ä»Žè·¯ç”±åˆ—è¡¨ä¸­ç§»é™¤
â””â”€â”€ èŠ‚ç‚¹æ¢å¤ â†’ é‡æ–°åŠ å…¥è·¯ç”±åˆ—è¡¨

é›†ç¾¤æ‰©å®¹ï¼š
â”œâ”€â”€ æ·»åŠ æ–°èŠ‚ç‚¹ â†’ å…ƒæ•°æ®è¡¨è‡ªåŠ¨æ›´æ–°
â”œâ”€â”€ Routerå®šæœŸæ£€æŸ¥ â†’ å‘çŽ°æ–°èŠ‚ç‚¹
â””â”€â”€ åŠ¨æ€æ›´æ–°è·¯ç”± â†’ æ— éœ€é‡å¯Router

é›†ç¾¤ç¼©å®¹ï¼š
â”œâ”€â”€ ç§»é™¤èŠ‚ç‚¹ â†’ ä»Žå…ƒæ•°æ®è¡¨åˆ é™¤
â”œâ”€â”€ Routeræ£€æµ‹åˆ°å˜åŒ– â†’ ç§»é™¤å¤±æ•ˆè·¯ç”±
â””â”€â”€ è‡ªåŠ¨è´Ÿè½½é‡æ–°åˆ†é…
```

---

## 4. ðŸ“„ é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ


### 4.1 é…ç½®æ–‡ä»¶ç»“æž„


Bootstrapè‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶**mysqlrouter.conf**åŒ…å«ä»¥ä¸‹ä¸»è¦éƒ¨åˆ†ï¼š

```ini
# è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ç»“æž„

[DEFAULT]
# å…¨å±€é»˜è®¤é…ç½®
user = mysqlrouter
logging_folder = /var/log/mysqlrouter
plugin_folder = /usr/lib/x86_64-linux-gnu/mysqlrouter
config_folder = /etc/mysqlrouter
runtime_folder = /run/mysqlrouter

[metadata_cache:myCluster]
# å…ƒæ•°æ®ç¼“å­˜é…ç½®
router_id = 1
user = mysql_router1_abc123
metadata_cluster = myCluster
ttl = 0.5
auth_cache_ttl = 2
auth_cache_refresh_interval = 2

[routing:myCluster_rw]
# è¯»å†™è·¯ç”±é…ç½®ï¼ˆè¿žæŽ¥Primaryï¼‰
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://myCluster/default?role=PRIMARY
routing_strategy = first-available
protocol = classic

[routing:myCluster_ro]  
# åªè¯»è·¯ç”±é…ç½®ï¼ˆè¿žæŽ¥Secondaryï¼‰
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://myCluster/default?role=SECONDARY
routing_strategy = round-robin
protocol = classic
```

### 4.2 å…³é”®é…ç½®æ®µè§£æž


**metadata_cacheæ®µ**ï¼š
```ini
[metadata_cache:myCluster]
router_id = 1                    # Routerå®žä¾‹å”¯ä¸€æ ‡è¯†
user = mysql_router1_abc123      # è¿žæŽ¥é›†ç¾¤çš„ä¸“ç”¨ç”¨æˆ·
metadata_cluster = myCluster     # ç›®æ ‡é›†ç¾¤åç§°
ttl = 0.5                       # å…ƒæ•°æ®ç¼“å­˜ç”Ÿå­˜æ—¶é—´(ç§’)
```

**é‡è¦æ¦‚å¿µè§£é‡Š**ï¼š
- **router_id**ï¼šæ¯ä¸ªRouterå®žä¾‹éƒ½æœ‰å”¯ä¸€IDï¼Œç”¨äºŽåœ¨é›†ç¾¤ä¸­æ ‡è¯†
- **ttl**ï¼šå…ƒæ•°æ®ç¼“å­˜æ—¶é—´ï¼Œè®¾ç½®ä¸º0.5ç§’è¡¨ç¤ºæ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡é›†ç¾¤çŠ¶æ€å˜åŒ–
- **ä¸“ç”¨ç”¨æˆ·**ï¼šBootstrapè‡ªåŠ¨åˆ›å»ºçš„ç”¨æˆ·ï¼Œåªæœ‰å¿…éœ€çš„æœ€å°æƒé™

**routingæ®µé…ç½®**ï¼š
```ini
[routing:myCluster_rw]
destinations = metadata-cache://myCluster/default?role=PRIMARY
routing_strategy = first-available    # è¯»å†™ç”¨first-available
protocol = classic                   # ä½¿ç”¨ä¼ ç»ŸMySQLåè®®

[routing:myCluster_ro]
destinations = metadata-cache://myCluster/default?role=SECONDARY  
routing_strategy = round-robin       # åªè¯»ç”¨round-robinè´Ÿè½½å‡è¡¡
```

### 4.3 é…ç½®è‡ªåŠ¨ä¼˜åŒ–


Bootstrapä¼šæ ¹æ®é›†ç¾¤è§„æ¨¡è‡ªåŠ¨ä¼˜åŒ–é…ç½®ï¼š

```
å°è§„æ¨¡é›†ç¾¤ (3èŠ‚ç‚¹)ï¼š
â”œâ”€â”€ è¿žæŽ¥æ± è¾ƒå°
â”œâ”€â”€ æ£€æŸ¥é¢‘çŽ‡è¾ƒä½Ž
â””â”€â”€ ç®€å•çš„è´Ÿè½½å‡è¡¡ç­–ç•¥

å¤§è§„æ¨¡é›†ç¾¤ (7+èŠ‚ç‚¹)ï¼š
â”œâ”€â”€ è¿žæŽ¥æ± è¾ƒå¤§
â”œâ”€â”€ æ£€æŸ¥é¢‘çŽ‡è¾ƒé«˜  
â””â”€â”€ å¤æ‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥

é«˜å¯ç”¨çŽ¯å¢ƒï¼š
â”œâ”€â”€ æ›´çŸ­çš„TTLæ—¶é—´
â”œâ”€â”€ æ›´æ¿€è¿›çš„æ•…éšœæ£€æµ‹
â””â”€â”€ å¿«é€Ÿæ•…éšœè½¬ç§»é…ç½®
```

---

## 5. ðŸ‘¤ ç”¨æˆ·è´¦æˆ·ä¸Žæƒé™ç®¡ç†


### 5.1 Routerä¸“ç”¨ç”¨æˆ·åˆ›å»º


Bootstrapä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª**ä¸“ç”¨çš„MySQLç”¨æˆ·**ï¼Œè¿™ä¸ªç”¨æˆ·åªæœ‰Routerè¿è¡Œæ‰€éœ€çš„æœ€å°æƒé™ã€‚

**ç”¨æˆ·å‘½åè§„åˆ™**ï¼š
```
æ ¼å¼ï¼šmysql_router{instance_id}_{random_string}@host

ç¤ºä¾‹ï¼š
mysql_router1_h8k9p2@%          # ç¬¬1ä¸ªRouterå®žä¾‹
mysql_router2_m3n7q1@%          # ç¬¬2ä¸ªRouterå®žä¾‹  
mysql_router1_x5y2z8@localhost  # æœ¬åœ°è®¿é—®é™åˆ¶
```

**ç”¨æˆ·åˆ›å»ºè¿‡ç¨‹**ï¼š
```sql
-- Bootstrapè‡ªåŠ¨æ‰§è¡Œçš„SQLè¯­å¥

-- 1. åˆ›å»ºç”¨æˆ·
CREATE USER 'mysql_router1_h8k9p2'@'%' 
IDENTIFIED WITH mysql_native_password AS '*hash';

-- 2. æŽˆäºˆå¿…éœ€æƒé™
GRANT SELECT ON mysql_innodb_cluster_metadata.* 
TO 'mysql_router1_h8k9p2'@'%';

GRANT SELECT ON performance_schema.replication_group_members 
TO 'mysql_router1_h8k9p2'@'%';

GRANT SELECT ON performance_schema.replication_group_member_stats 
TO 'mysql_router1_h8k9p2'@'%';

-- 3. æ’å…¥Routeræ³¨å†Œä¿¡æ¯
INSERT INTO mysql_innodb_cluster_metadata.routers 
(router_name, product_name, address, version) 
VALUES ('::1', 'MySQL Router', '192.168.1.100', '8.0.32');
```

### 5.2 æƒé™æœ€å°åŒ–åŽŸåˆ™


Routerç”¨æˆ·**åªè¢«æŽˆäºˆå¿…éœ€çš„æœ€å°æƒé™**ï¼š

```
âœ… å¿…éœ€æƒé™ï¼š
â”œâ”€â”€ mysql_innodb_cluster_metadata.* çš„SELECTæƒé™
â”‚   â””â”€â”€ è¯»å–é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯
â”œâ”€â”€ performance_schema.replication_group_members çš„SELECTæƒé™  
â”‚   â””â”€â”€ æŸ¥çœ‹Group Replicationæˆå‘˜çŠ¶æ€
â””â”€â”€ performance_schema.replication_group_member_stats çš„SELECTæƒé™
    â””â”€â”€ èŽ·å–æˆå‘˜ç»Ÿè®¡ä¿¡æ¯

âŒ ä¸æŽˆäºˆçš„æƒé™ï¼š
â”œâ”€â”€ ä»»ä½•æ•°æ®åº“çš„INSERT/UPDATE/DELETEæƒé™
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†æƒé™
â”œâ”€â”€ ç³»ç»Ÿç®¡ç†æƒé™
â””â”€â”€ å…¶ä»–æ•æ„Ÿæƒé™
```

**å®‰å…¨ä¼˜åŠ¿**ï¼š
- **æƒé™éš”ç¦»**ï¼šå³ä½¿Routerè¢«æ”»å‡»ï¼Œå½±å“èŒƒå›´ä¹Ÿå¾ˆæœ‰é™
- **å®¡è®¡å‹å¥½**ï¼šRouterçš„æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½å¯ä»¥è¿½è¸ª
- **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³æœ€å°æƒé™åŽŸåˆ™çš„å®‰å…¨è§„èŒƒ

### 5.3 ç”¨æˆ·ç®¡ç†æœ€ä½³å®žè·µ


```bash
# æŸ¥çœ‹Routerç”¨æˆ·
SELECT user, host FROM mysql.user WHERE user LIKE 'mysql_router%';

# æŸ¥çœ‹Routerç”¨æˆ·æƒé™
SHOW GRANTS FOR 'mysql_router1_h8k9p2'@'%';

# å¦‚æžœéœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰
DROP USER 'mysql_router1_h8k9p2'@'%';
DELETE FROM mysql_innodb_cluster_metadata.routers 
WHERE router_name = '::1';
```

---

## 6. ðŸ”Œ è·¯ç”±ç«¯å£åˆ†é…ç­–ç•¥


### 6.1 é»˜è®¤ç«¯å£åˆ†é…


Bootstrapä½¿ç”¨**å›ºå®šçš„ç«¯å£åˆ†é…ç­–ç•¥**ï¼Œç¡®ä¿ä¸åŒç±»åž‹çš„è¿žæŽ¥ä½¿ç”¨ä¸åŒç«¯å£ï¼š

```
é»˜è®¤ç«¯å£åˆ†é…ï¼š
â”œâ”€â”€ 6446: è¯»å†™è·¯ç”±ç«¯å£ (Read-Write)
â”œâ”€â”€ 6447: åªè¯»è·¯ç”±ç«¯å£ (Read-Only)  
â”œâ”€â”€ 6448: X Protocolè¯»å†™ç«¯å£
â””â”€â”€ 6449: X Protocolåªè¯»ç«¯å£

ç«¯å£ç”¨é€”è¯´æ˜Žï¼š
â€¢ 6446 â†’ è¿žæŽ¥PrimaryèŠ‚ç‚¹ï¼Œå¤„ç†è¯»å†™æ“ä½œ
â€¢ 6447 â†’ è¿žæŽ¥SecondaryèŠ‚ç‚¹ï¼Œå¤„ç†åªè¯»æŸ¥è¯¢
â€¢ 6448/6449 â†’ æ”¯æŒMySQL X Protocol (æ–‡æ¡£æ•°æ®åº“åŠŸèƒ½)
```

### 6.2 ç«¯å£å†²çªå¤„ç†


å¦‚æžœé»˜è®¤ç«¯å£è¢«å ç”¨ï¼ŒBootstrapä¼š**è‡ªåŠ¨å¯»æ‰¾å¯ç”¨ç«¯å£**ï¼š

```bash
# ç«¯å£å†²çªæ—¶çš„å¤„ç†è¿‡ç¨‹
$ mysqlrouter --bootstrap root@192.168.1.10:3306

WARNING: Port 6446 is already in use
Looking for alternative port...
Using port 6450 for read-write connections
Using port 6451 for read-only connections

# æœ€ç»ˆé…ç½®ï¼š
Read-Write port: 6450  (instead of 6446)
Read-Only port: 6451   (instead of 6447)
```

**ç«¯å£é€‰æ‹©é€»è¾‘**ï¼š
```
1. å°è¯•é»˜è®¤ç«¯å£ (6446, 6447)
2. å¦‚æžœå ç”¨ï¼Œä»Ž6450å¼€å§‹ä¾æ¬¡å°è¯•
3. æ‰¾åˆ°è¿žç»­å¯ç”¨çš„ç«¯å£
4. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£è®¾ç½®
```

### 6.3 è‡ªå®šä¹‰ç«¯å£é…ç½®


å¯ä»¥åœ¨Bootstrapæ—¶æŒ‡å®šè‡ªå®šä¹‰ç«¯å£ï¼š

```bash
# ä½¿ç”¨--directoryé€‰é¡¹æŒ‡å®šé…ç½®ç›®å½•ï¼Œç„¶åŽæ‰‹åŠ¨ä¿®æ”¹ç«¯å£
mysqlrouter --bootstrap root@192.168.1.10:3306 \
  --directory /custom/router/config

# ä¿®æ”¹ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£
[routing:myCluster_rw]
bind_port = 7446    # è‡ªå®šä¹‰è¯»å†™ç«¯å£

[routing:myCluster_ro]  
bind_port = 7447    # è‡ªå®šä¹‰åªè¯»ç«¯å£
```

### 6.4 ç«¯å£å®‰å…¨è€ƒè™‘


```
ç«¯å£å®‰å…¨æœ€ä½³å®žè·µï¼š

é˜²ç«å¢™é…ç½®ï¼š
â”œâ”€â”€ åªå¼€æ”¾Routerç«¯å£ (6446, 6447)
â”œâ”€â”€ é™åˆ¶æ•°æ®åº“ç«¯å£ (3306) çš„ç›´æŽ¥è®¿é—®
â””â”€â”€ ä½¿ç”¨iptablesæˆ–äº‘å®‰å…¨ç»„

ç½‘ç»œéš”ç¦»ï¼š
â”œâ”€â”€ Routerå’Œå®¢æˆ·ç«¯åœ¨åŒä¸€ç½‘æ®µ
â”œâ”€â”€ æ•°æ®åº“æœåŠ¡å™¨åœ¨ç‹¬ç«‹çš„å†…ç½‘
â””â”€â”€ é€šè¿‡Routerè¿›è¡Œæ‰€æœ‰æ•°æ®åº“è®¿é—®

ç›‘æŽ§å‘Šè­¦ï¼š
â”œâ”€â”€ ç›‘æŽ§ç«¯å£è¿žæŽ¥æ•°
â”œâ”€â”€ å¼‚å¸¸è¿žæŽ¥å‘Šè­¦
â””â”€â”€ ç«¯å£æ‰«ææ£€æµ‹
```

---

## 7. ðŸ”’ SSLè¯ä¹¦é…ç½®


### 7.1 SSLè‡ªåŠ¨é…ç½®


Bootstrapä¼š**è‡ªåŠ¨å¤„ç†SSLé…ç½®**ï¼Œç¡®ä¿Routerä¸ŽMySQLé›†ç¾¤ä¹‹é—´çš„è¿žæŽ¥å®‰å…¨ï¼š

**SSLé…ç½®æ£€æµ‹è¿‡ç¨‹**ï¼š
```
1. æ£€æŸ¥é›†ç¾¤æ˜¯å¦å¯ç”¨SSL
2. èŽ·å–é›†ç¾¤çš„SSLè¯ä¹¦ä¿¡æ¯
3. é…ç½®Routerçš„SSLå®¢æˆ·ç«¯è®¾ç½®
4. éªŒè¯SSLè¿žæŽ¥æ˜¯å¦æ­£å¸¸
```

**è‡ªåŠ¨ç”Ÿæˆçš„SSLé…ç½®**ï¼š
```ini
[metadata_cache:myCluster]
# SSLç›¸å…³é…ç½®è‡ªåŠ¨æ·»åŠ 
ssl_mode = PREFERRED          # SSLè¿žæŽ¥æ¨¡å¼
ssl_cipher = ""              # é»˜è®¤å¯†ç å¥—ä»¶
ssl_ca = /path/to/ca.pem     # CAè¯ä¹¦è·¯å¾„(å¦‚æžœå¯ç”¨)
ssl_cert = ""                # å®¢æˆ·ç«¯è¯ä¹¦(å¦‚æžœéœ€è¦)
ssl_key = ""                 # å®¢æˆ·ç«¯ç§é’¥(å¦‚æžœéœ€è¦)
```

### 7.2 SSLæ¨¡å¼è¯´æ˜Ž


Bootstrapä¼šæ ¹æ®é›†ç¾¤SSLé…ç½®è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„SSLæ¨¡å¼ï¼š

```
SSLæ¨¡å¼ç±»åž‹ï¼š

DISABLEDï¼š
â€¢ å®Œå…¨ç¦ç”¨SSL
â€¢ é€‚ç”¨äºŽå†…ç½‘çŽ¯å¢ƒï¼Œæ€§èƒ½ä¼˜å…ˆ

PREFERRED (é»˜è®¤)ï¼š
â€¢ ä¼˜å…ˆå°è¯•SSLè¿žæŽ¥
â€¢ SSLå¤±è´¥æ—¶é™çº§åˆ°æ™®é€šè¿žæŽ¥
â€¢ å¹³è¡¡å®‰å…¨æ€§å’Œå…¼å®¹æ€§

REQUIREDï¼š
â€¢ å¼ºåˆ¶è¦æ±‚SSLè¿žæŽ¥
â€¢ SSLå¤±è´¥æ—¶æ‹’ç»è¿žæŽ¥
â€¢ é«˜å®‰å…¨æ€§è¦æ±‚çŽ¯å¢ƒ

VERIFY_CAï¼š
â€¢ éªŒè¯æœåŠ¡å™¨è¯ä¹¦é“¾
â€¢ ç¡®ä¿è¿žæŽ¥åˆ°å¯ä¿¡çš„æœåŠ¡å™¨

VERIFY_IDENTITYï¼š
â€¢ æœ€ä¸¥æ ¼çš„éªŒè¯æ¨¡å¼
â€¢ éªŒè¯è¯ä¹¦å’Œä¸»æœºååŒ¹é…
```

### 7.3 SSLè¯ä¹¦ç®¡ç†


**è¯ä¹¦æ–‡ä»¶å¤„ç†**ï¼š
```bash
# Bootstrapæ£€æŸ¥è¯ä¹¦æ–‡ä»¶ä½ç½®
Default certificate locations:
â”œâ”€â”€ /etc/mysql/certs/        # ç³»ç»Ÿè¯ä¹¦ç›®å½•
â”œâ”€â”€ /var/lib/mysql/          # MySQLæ•°æ®ç›®å½•
â””â”€â”€ /usr/share/mysql/        # MySQLå…±äº«ç›®å½•

# å¦‚æžœæ‰¾åˆ°æœ‰æ•ˆè¯ä¹¦ï¼Œè‡ªåŠ¨é…ç½®è·¯å¾„
ssl_ca = /etc/mysql/certs/ca.pem
ssl_cert = /etc/mysql/certs/client-cert.pem  
ssl_key = /etc/mysql/certs/client-key.pem
```

**è¯ä¹¦éªŒè¯è¿‡ç¨‹**ï¼š
```
Bootstrap SSLéªŒè¯æ­¥éª¤ï¼š

1. è¯ä¹¦æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
   â””â”€â”€ éªŒè¯ca.pem, client-cert.pem, client-key.pem

2. è¯ä¹¦æœ‰æ•ˆæ€§éªŒè¯
   â””â”€â”€ æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸã€æ ¼å¼æ˜¯å¦æ­£ç¡®

3. è¿žæŽ¥æµ‹è¯•
   â””â”€â”€ ä½¿ç”¨SSLé…ç½®æµ‹è¯•è¿žæŽ¥é›†ç¾¤

4. é…ç½®å†™å…¥
   â””â”€â”€ å°†éªŒè¯é€šè¿‡çš„SSLé…ç½®å†™å…¥é…ç½®æ–‡ä»¶
```

---

## 8. ðŸ“ é…ç½®ç›®å½•ç»“æž„è¯¦è§£


### 8.1 é»˜è®¤ç›®å½•ç»“æž„


Bootstrapä¼šåˆ›å»º**æ ‡å‡†çš„é…ç½®ç›®å½•ç»“æž„**ï¼š

```
é»˜è®¤Routerç›®å½•ç»“æž„ï¼š

/var/lib/mysqlrouter/          # ä¸»é…ç½®ç›®å½•
â”œâ”€â”€ mysqlrouter.conf          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ mysqlrouter.key           # Routerå®žä¾‹å¯†é’¥
â”œâ”€â”€ data/                     # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ router.pid           # è¿›ç¨‹IDæ–‡ä»¶
â”‚   â””â”€â”€ keyring              # å¯†é’¥çŽ¯æ–‡ä»¶
â”œâ”€â”€ log/                     # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ mysqlrouter.log      # ä¸»æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ error.log            # é”™è¯¯æ—¥å¿—
â””â”€â”€ run/                     # è¿è¡Œæ—¶ç›®å½•
    â””â”€â”€ mysqlrouter.sock     # Unix Socketæ–‡ä»¶
```

### 8.2 é…ç½®æ–‡ä»¶è¯¦è§£


**ä¸»é…ç½®æ–‡ä»¶mysqlrouter.conf**ï¼š
```ini
# è¿™æ˜¯Bootstrapè‡ªåŠ¨ç”Ÿæˆçš„å®Œæ•´é…ç½®æ–‡ä»¶

[DEFAULT]
# å…¨å±€é…ç½®æ®µ
user = mysqlrouter                          # è¿è¡Œç”¨æˆ·
logging_folder = /var/lib/mysqlrouter/log   # æ—¥å¿—ç›®å½•
plugin_folder = /usr/lib/mysqlrouter        # æ’ä»¶ç›®å½•
config_folder = /var/lib/mysqlrouter        # é…ç½®ç›®å½•
runtime_folder = /var/lib/mysqlrouter/run   # è¿è¡Œæ—¶ç›®å½•

[logger]
# æ—¥å¿—é…ç½®
level = INFO                               # æ—¥å¿—çº§åˆ«
sinks = filelog                           # æ—¥å¿—è¾“å‡ºæ–¹å¼

[metadata_cache:bootstrap]
# å…ƒæ•°æ®ç¼“å­˜é…ç½® - Bootstrapè‡ªåŠ¨ç”Ÿæˆ
router_id = 1
user = mysql_router1_abc123
metadata_cluster = myCluster  
ttl = 0.5

[routing:bootstrap_rw]
# è¯»å†™è·¯ç”± - Bootstrapè‡ªåŠ¨ç”Ÿæˆ
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://bootstrap/default?role=PRIMARY
routing_strategy = first-available

[routing:bootstrap_ro]
# åªè¯»è·¯ç”± - Bootstrapè‡ªåŠ¨ç”Ÿæˆ  
bind_address = 0.0.0.0
bind_port = 6447
destinations = metadata-cache://bootstrap/default?role=SECONDARY
routing_strategy = round-robin
```

### 8.3 ç›®å½•æƒé™ç®¡ç†


Bootstrapä¼š**è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„ç›®å½•æƒé™**ï¼š

```bash
# Bootstrapåˆ›å»ºçš„ç›®å½•æƒé™
drwxr-x--- mysqlrouter mysqlrouter /var/lib/mysqlrouter/
-rw-r----- mysqlrouter mysqlrouter mysqlrouter.conf
-rw------- mysqlrouter mysqlrouter mysqlrouter.key
drwxr-x--- mysqlrouter mysqlrouter data/
drwxr-x--- mysqlrouter mysqlrouter log/
drwxr-x--- mysqlrouter mysqlrouter run/
```

**æƒé™è¯´æ˜Ž**ï¼š
- **é…ç½®ç›®å½•**ï¼š750æƒé™ï¼Œåªæœ‰mysqlrouterç”¨æˆ·å’Œç»„å¯ä»¥è®¿é—®
- **é…ç½®æ–‡ä»¶**ï¼š640æƒé™ï¼Œç¡®ä¿æ•æ„Ÿä¿¡æ¯å®‰å…¨
- **å¯†é’¥æ–‡ä»¶**ï¼š600æƒé™ï¼Œæœ€ä¸¥æ ¼çš„æƒé™æŽ§åˆ¶
- **æ—¥å¿—ç›®å½•**ï¼š750æƒé™ï¼Œä¾¿äºŽæ—¥å¿—ç®¡ç†å’ŒæŸ¥çœ‹

### 8.4 è‡ªå®šä¹‰ç›®å½•é…ç½®


```bash
# æŒ‡å®šè‡ªå®šä¹‰é…ç½®ç›®å½•
mysqlrouter --bootstrap root@192.168.1.10:3306 \
  --directory /custom/path/router \
  --conf-use-sockets      # ä½¿ç”¨Unix Socket
  --conf-skip-tcp         # è·³è¿‡TCPé…ç½®
  --conf-base-port 7000   # æŒ‡å®šèµ·å§‹ç«¯å£

# ç”Ÿæˆçš„è‡ªå®šä¹‰ç›®å½•ç»“æž„
/custom/path/router/
â”œâ”€â”€ mysqlrouter.conf     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data/               # æ•°æ®ç›®å½•  
â”œâ”€â”€ log/                # æ—¥å¿—ç›®å½•
â””â”€â”€ run/                # è¿è¡Œæ—¶ç›®å½•
```

---

## 9. âš™ï¸ Bootstrapå‚æ•°é€‰é¡¹


### 9.1 åŸºæœ¬å‚æ•°é€‰é¡¹


Bootstrapå‘½ä»¤æ”¯æŒå¤šç§å‚æ•°æ¥å®šåˆ¶é…ç½®è¿‡ç¨‹ï¼š

```bash
# åŸºæœ¬Bootstrapè¯­æ³•
mysqlrouter --bootstrap [options] URI

# URIæ ¼å¼ï¼š
[username[:password]@]hostname[:port]
```

**å¸¸ç”¨åŸºæœ¬å‚æ•°**ï¼š
```bash
--directory DIR          # æŒ‡å®šé…ç½®ç›®å½•
--conf-use-sockets      # å¯ç”¨Unix Socketè¿žæŽ¥
--conf-skip-tcp         # ç¦ç”¨TCPè¿žæŽ¥  
--conf-base-port PORT   # æŒ‡å®šèµ·å§‹ç«¯å£å·
--account USER          # æŒ‡å®šRouterç”¨æˆ·å
--account-host HOST     # æŒ‡å®šç”¨æˆ·ä¸»æœºé™åˆ¶
--force                 # å¼ºåˆ¶è¦†ç›–çŽ°æœ‰é…ç½®
```

### 9.2 è¯¦ç»†å‚æ•°è¯´æ˜Ž


**ç›®å½•å’Œæ–‡ä»¶é€‰é¡¹**ï¼š
```bash
# æŒ‡å®šé…ç½®ç›®å½•
--directory /opt/mysqlrouter
# æ•ˆæžœï¼šæ‰€æœ‰é…ç½®æ–‡ä»¶å°†åˆ›å»ºåœ¨æŒ‡å®šç›®å½•ä¸‹

# æŒ‡å®šé…ç½®æ–‡ä»¶å
--name myrouter
# æ•ˆæžœï¼šé…ç½®æ®µåç§°å°†ä½¿ç”¨è‡ªå®šä¹‰åç§°

# å¼ºåˆ¶è¦†ç›–çŽ°æœ‰é…ç½®
--force  
# æ•ˆæžœï¼šå³ä½¿ç›®å½•å·²å­˜åœ¨ä¹Ÿä¼šè¦†ç›–é‡æ–°é…ç½®
```

**ç½‘ç»œé…ç½®é€‰é¡¹**ï¼š
```bash
# ç«¯å£é…ç½®
--conf-base-port 7000
# æ•ˆæžœï¼šè¯»å†™ç«¯å£7000ï¼Œåªè¯»ç«¯å£7001

# ç»‘å®šåœ°å€é…ç½®
--conf-bind-address 192.168.1.100
# æ•ˆæžœï¼šRouteråªç›‘å¬æŒ‡å®šIPåœ°å€

# ä½¿ç”¨Unix Socket
--conf-use-sockets  
# æ•ˆæžœï¼šåŒæ—¶æä¾›TCPå’ŒSocketè¿žæŽ¥æ–¹å¼
```

**ç”¨æˆ·è´¦æˆ·é€‰é¡¹**ï¼š
```bash
# è‡ªå®šä¹‰Routerç”¨æˆ·å
--account myrouter_user
# æ•ˆæžœï¼šä½¿ç”¨è‡ªå®šä¹‰ç”¨æˆ·åè€Œéžè‡ªåŠ¨ç”Ÿæˆ

# é™åˆ¶ç”¨æˆ·ä¸»æœº
--account-host 'localhost'  
# æ•ˆæžœï¼šRouterç”¨æˆ·åªèƒ½ä»Žlocalhostè¿žæŽ¥

# åˆ›å»ºç”¨æˆ·ä½†ä¸æŽˆæƒï¼ˆæ‰‹åŠ¨æŽˆæƒï¼‰
--account-create-defer-auth
# æ•ˆæžœï¼šåˆ›å»ºç”¨æˆ·ä½†éœ€è¦æ‰‹åŠ¨æ‰§è¡ŒGRANTè¯­å¥
```

### 9.3 é«˜çº§é…ç½®é€‰é¡¹


**SSLå’Œå®‰å…¨é€‰é¡¹**ï¼š
```bash
# SSLé…ç½®
--conf-ssl-mode REQUIRED     # å¼ºåˆ¶SSLè¿žæŽ¥
--conf-ssl-cert /path/cert   # æŒ‡å®šSSLè¯ä¹¦
--conf-ssl-key /path/key     # æŒ‡å®šSSLç§é’¥
--conf-ssl-ca /path/ca       # æŒ‡å®šCAè¯ä¹¦

# å®‰å…¨é€‰é¡¹
--password-retries 3         # å¯†ç é‡è¯•æ¬¡æ•°
--connect-timeout 30         # è¿žæŽ¥è¶…æ—¶æ—¶é—´
```

**é›†ç¾¤é…ç½®é€‰é¡¹**ï¼š
```bash
# é›†ç¾¤åç§°ï¼ˆé€šå¸¸è‡ªåŠ¨æ£€æµ‹ï¼‰
--conf-cluster-name myCluster

# å…ƒæ•°æ®TTLé…ç½®
--conf-ttl 1.0              # å…ƒæ•°æ®ç¼“å­˜1ç§’

# åªè¯»å®žä¾‹é…ç½®
--conf-read-only-targets secondary   # åªè¯»è·¯ç”±ç›®æ ‡
```

### 9.4 å®žé™…ä½¿ç”¨ç¤ºä¾‹


**ç”Ÿäº§çŽ¯å¢ƒBootstrap**ï¼š
```bash
# ç”Ÿäº§çŽ¯å¢ƒçš„å®Œæ•´Bootstrapå‘½ä»¤
mysqlrouter --bootstrap root@db-cluster-vip:3306 \
  --directory /opt/mysqlrouter/prod \
  --conf-base-port 6446 \
  --conf-bind-address 0.0.0.0 \
  --account mysqlrouter_prod \
  --account-host '%' \
  --conf-ssl-mode REQUIRED \
  --force

# è¿™ä¸ªå‘½ä»¤ä¼šï¼š
# 1. åœ¨/opt/mysqlrouter/prodç›®å½•åˆ›å»ºé…ç½®
# 2. ä½¿ç”¨6446èµ·å§‹ç«¯å£
# 3. ç›‘å¬æ‰€æœ‰IPåœ°å€  
# 4. åˆ›å»ºmysqlrouter_prodç”¨æˆ·
# 5. å…è®¸ä»Žä»»ä½•ä¸»æœºè¿žæŽ¥
# 6. å¼ºåˆ¶ä½¿ç”¨SSL
# 7. è¦†ç›–çŽ°æœ‰é…ç½®
```

**å¼€å‘çŽ¯å¢ƒBootstrap**ï¼š
```bash
# å¼€å‘çŽ¯å¢ƒçš„ç®€åŒ–é…ç½®
mysqlrouter --bootstrap dev_user@localhost:3306 \
  --directory /tmp/router_dev \
  --conf-use-sockets \
  --conf-skip-tcp

# è¿™ä¸ªå‘½ä»¤ä¼šï¼š
# 1. åœ¨ä¸´æ—¶ç›®å½•åˆ›å»ºé…ç½®
# 2. åªä½¿ç”¨Unix Socketè¿žæŽ¥
# 3. è·³è¿‡TCPç«¯å£é…ç½®
# 4. é€‚åˆæœ¬åœ°å¼€å‘æµ‹è¯•
```

---

## 10. ðŸ”„ é…ç½®æ›´æ–°æœºåˆ¶


### 10.1 åŠ¨æ€é…ç½®æ›´æ–°


MySQL Routerå…·å¤‡**åŠ¨æ€é…ç½®æ›´æ–°èƒ½åŠ›**ï¼Œæ— éœ€é‡å¯å³å¯é€‚åº”é›†ç¾¤å˜åŒ–ï¼š

**æ›´æ–°è§¦å‘æ¡ä»¶**ï¼š
```
é›†ç¾¤æ‹“æ‰‘å˜åŒ–ï¼š
â”œâ”€â”€ PrimaryèŠ‚ç‚¹æ•…éšœè½¬ç§»
â”œâ”€â”€ SecondaryèŠ‚ç‚¹åŠ å…¥/ç§»é™¤  
â”œâ”€â”€ èŠ‚ç‚¹çŠ¶æ€å˜åŒ– (ONLINE/OFFLINE)
â””â”€â”€ ç½‘ç»œåˆ†åŒºæ¢å¤

å…ƒæ•°æ®å˜åŒ–æ£€æµ‹ï¼š
â”œâ”€â”€ TTLè¶…æ—¶è§¦å‘æ£€æŸ¥
â”œâ”€â”€ è¿žæŽ¥å¤±è´¥è§¦å‘ç«‹å³æ£€æŸ¥
â”œâ”€â”€ å®šæœŸå¿ƒè·³æ£€æµ‹
â””â”€â”€ ç®¡ç†å‘½ä»¤è§¦å‘æ›´æ–°
```

### 10.2 æ›´æ–°è¿‡ç¨‹è¯¦è§£


**æ­¥éª¤1ï¼šå˜åŒ–æ£€æµ‹**
```
Routerå®šæœŸæ‰§è¡Œï¼š
1. æŸ¥è¯¢ performance_schema.replication_group_members
2. å¯¹æ¯”å½“å‰æ‹“æ‰‘ä¸Žç¼“å­˜çš„æ‹“æ‰‘
3. è¯†åˆ«æ–°å¢žã€ç§»é™¤ã€çŠ¶æ€å˜åŒ–çš„èŠ‚ç‚¹
4. è§¦å‘é…ç½®æ›´æ–°æµç¨‹
```

**æ­¥éª¤2ï¼šé…ç½®é‡æ–°è®¡ç®—**
```
é‡æ–°è®¡ç®—è·¯ç”±ç›®æ ‡ï¼š
â€¢ Primaryè·¯ç”±ï¼šæŒ‡å‘å½“å‰çš„PrimaryèŠ‚ç‚¹
â€¢ Secondaryè·¯ç”±ï¼šæŒ‡å‘æ‰€æœ‰ONLINEçš„SecondaryèŠ‚ç‚¹
â€¢ æƒé‡åˆ†é…ï¼šæ ¹æ®èŠ‚ç‚¹æ€§èƒ½å’Œè´Ÿè½½è°ƒæ•´
â€¢ è¿žæŽ¥æ± ï¼šæ ¹æ®æ–°æ‹“æ‰‘è°ƒæ•´è¿žæŽ¥æ•°
```

**æ­¥éª¤3ï¼šæ— ç¼åˆ‡æ¢**
```
å¹³æ»‘æ›´æ–°è¿‡ç¨‹ï¼š
1. æ–°å»ºè¿žæŽ¥ä½¿ç”¨æ–°çš„è·¯ç”±é…ç½®
2. çŽ°æœ‰è¿žæŽ¥ç»§ç»­ä½¿ç”¨æ—§é…ç½®
3. æ—§è¿žæŽ¥è‡ªç„¶ç»“æŸåŽé‡Šæ”¾
4. é€æ­¥å®Œæˆé…ç½®åˆ‡æ¢
```

### 10.3 æ›´æ–°ç›‘æŽ§


**é…ç½®æ›´æ–°æ—¥å¿—ç¤ºä¾‹**ï¼š
```
# Routeræ—¥å¿—ä¸­çš„æ›´æ–°è¿‡ç¨‹
2024-09-11 15:30:15 INFO [routing:bootstrap_rw] 
Topology change detected: Primary changed from 192.168.1.10 to 192.168.1.11

2024-09-11 15:30:16 INFO [metadata_cache:bootstrap] 
Updated metadata: 3 available destinations for 'PRIMARY'

2024-09-11 15:30:16 INFO [routing:bootstrap_ro] 
Updated read-only destinations: [192.168.1.10:3306, 192.168.1.12:3306]

2024-09-11 15:30:17 INFO [metadata_cache:bootstrap] 
Configuration update completed successfully
```

**ç›‘æŽ§æŒ‡æ ‡**ï¼š
```bash
# æŸ¥çœ‹RouterçŠ¶æ€
mysqlrouter --help --config /path/to/mysqlrouter.conf

# æ£€æŸ¥è·¯ç”±çŠ¶æ€
curl http://localhost:8443/api/20190715/routes
```

### 10.4 æ‰‹åŠ¨æ›´æ–°é…ç½®


æœ‰æ—¶éœ€è¦æ‰‹åŠ¨è§¦å‘é…ç½®æ›´æ–°ï¼š

**é‡æ–°Bootstrapï¼ˆå®Œå…¨æ›´æ–°ï¼‰**ï¼š
```bash
# åœæ­¢Router
systemctl stop mysqlrouter

# é‡æ–°æ‰§è¡ŒBootstrap
mysqlrouter --bootstrap root@cluster:3306 \
  --directory /var/lib/mysqlrouter \
  --force

# å¯åŠ¨Router  
systemctl start mysqlrouter
```

**éƒ¨åˆ†é…ç½®ä¿®æ”¹**ï¼š
```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶
vim /var/lib/mysqlrouter/mysqlrouter.conf

# é‡æ–°åŠ è½½é…ç½®ï¼ˆå‘é€SIGHUPä¿¡å·ï¼‰
kill -HUP $(cat /var/lib/mysqlrouter/data/router.pid)

# æˆ–ä½¿ç”¨systemctlé‡æ–°åŠ è½½
systemctl reload mysqlrouter
```

**é…ç½®éªŒè¯**ï¼š
```bash
# éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
mysqlrouter --config /var/lib/mysqlrouter/mysqlrouter.conf --validate

# æµ‹è¯•è¿žæŽ¥
mysql -h 127.0.0.1 -P 6446 -u testuser -p
mysql -h 127.0.0.1 -P 6447 -u testuser -p
```

---

## 11. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ Bootstrapæœ¬è´¨ï¼šMySQL Routerçš„ä¸€é”®è‡ªåŠ¨é…ç½®åŠŸèƒ½
ðŸ”¸ å·¥ä½œåŽŸç†ï¼šè¿žæŽ¥é›†ç¾¤â†’è¯»å–å…ƒæ•°æ®â†’ç”Ÿæˆé…ç½®â†’åˆ›å»ºç”¨æˆ·â†’å¯åŠ¨æœåŠ¡
ðŸ”¸ è‡ªåŠ¨åŒ–ä¼˜åŠ¿ï¼šå…åŽ»æ‰‹å·¥é…ç½®çš„å¤æ‚æ€§å’Œé”™è¯¯é£Žé™©
ðŸ”¸ åŠ¨æ€æ›´æ–°ï¼šé›†ç¾¤å˜åŒ–æ—¶è‡ªåŠ¨è°ƒæ•´è·¯ç”±é…ç½®
ðŸ”¸ å®‰å…¨æœºåˆ¶ï¼šæœ€å°æƒé™åŽŸåˆ™ï¼Œä¸“ç”¨ç”¨æˆ·è´¦æˆ·
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ Bootstrapçš„ä»·å€¼**
```
ä¼ ç»Ÿé…ç½®çš„ç—›ç‚¹ï¼š
âŒ æ‰‹å·¥ç¼–å†™å¤æ‚é…ç½®æ–‡ä»¶
âŒ å®¹æ˜“å‡ºé”™ä¸”éš¾ä»¥ç»´æŠ¤  
âŒ é›†ç¾¤å˜åŒ–éœ€è¦æ‰‹åŠ¨æ›´æ–°
âŒ ç”¨æˆ·æƒé™ç®¡ç†ç¹ç

Bootstrapçš„è§£å†³æ–¹æ¡ˆï¼š
âœ… ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰é…ç½®
âœ… è‡ªåŠ¨å‘çŽ°é›†ç¾¤æ‹“æ‰‘
âœ… åŠ¨æ€é€‚åº”é›†ç¾¤å˜åŒ–
âœ… è‡ªåŠ¨åŒ–ç”¨æˆ·å’Œæƒé™ç®¡ç†
```

**ðŸ”¹ é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆé€»è¾‘**
```
é…ç½®ç”Ÿæˆè§„åˆ™ï¼š
â€¢ è¯»å†™è·¯ç”± â†’ è¿žæŽ¥PRIMARYè§’è‰²èŠ‚ç‚¹
â€¢ åªè¯»è·¯ç”± â†’ è¿žæŽ¥SECONDARYè§’è‰²èŠ‚ç‚¹
â€¢ ç«¯å£åˆ†é… â†’ 6446(rw), 6447(ro)
â€¢ SSLè®¾ç½® â†’ è‡ªåŠ¨æ£€æµ‹é›†ç¾¤SSLé…ç½®
â€¢ ç”¨æˆ·æƒé™ â†’ åªæŽˆäºˆå¿…éœ€çš„æœ€å°æƒé™
```

**ðŸ”¹ å…ƒæ•°æ®é©±åŠ¨çš„åŠ¨æ€æ›´æ–°**
```
æ›´æ–°æœºåˆ¶åŽŸç†ï¼š
1. Routerå®šæœŸæŸ¥è¯¢é›†ç¾¤å…ƒæ•°æ®è¡¨
2. æ£€æµ‹æ‹“æ‰‘å˜åŒ–ï¼ˆèŠ‚ç‚¹å¢žå‡ã€è§’è‰²å˜æ›´ï¼‰
3. é‡æ–°è®¡ç®—è·¯ç”±ç›®æ ‡
4. æ— ç¼æ›´æ–°è·¯ç”±é…ç½®
5. è®°å½•æ›´æ–°æ—¥å¿—ä¾¿äºŽç›‘æŽ§
```

### 11.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ç”Ÿäº§çŽ¯å¢ƒæœ€ä½³å®žè·µ**ï¼š
```
éƒ¨ç½²å»ºè®®ï¼š
âœ… ä½¿ç”¨ä¸“é—¨çš„é…ç½®ç›®å½•
âœ… è®¾ç½®åˆé€‚çš„SSLå®‰å…¨çº§åˆ«
âœ… é…ç½®ç›‘æŽ§å’Œæ—¥å¿—
âœ… å®šæœŸå¤‡ä»½é…ç½®æ–‡ä»¶
âœ… æµ‹è¯•æ•…éšœè½¬ç§»åœºæ™¯

å®‰å…¨è€ƒè™‘ï¼š
âœ… é™åˆ¶Routerç”¨æˆ·çš„ä¸»æœºè®¿é—®
âœ… ä½¿ç”¨é˜²ç«å¢™ä¿æŠ¤Routerç«¯å£
âœ… å¯ç”¨SSLåŠ å¯†è¿žæŽ¥
âœ… å®šæœŸæ›´æ–°Routerç‰ˆæœ¬
âœ… ç›‘æŽ§å¼‚å¸¸è¿žæŽ¥æ´»åŠ¨
```

**æ•…éšœæŽ’æŸ¥è¦ç‚¹**ï¼š
```
å¸¸è§é—®é¢˜ï¼š
â€¢ Bootstrapå¤±è´¥ â†’ æ£€æŸ¥ç”¨æˆ·æƒé™å’Œç½‘ç»œè¿žæŽ¥
â€¢ é…ç½®æ›´æ–°ä¸åŠæ—¶ â†’ è°ƒæ•´TTLå‚æ•°
â€¢ è¿žæŽ¥è·¯ç”±é”™è¯¯ â†’ éªŒè¯é›†ç¾¤çŠ¶æ€å’Œå…ƒæ•°æ®
â€¢ SSLè¿žæŽ¥é—®é¢˜ â†’ æ£€æŸ¥è¯ä¹¦é…ç½®å’Œæœ‰æ•ˆæ€§

è°ƒè¯•æ–¹æ³•ï¼š
â€¢ æŸ¥çœ‹Routeræ—¥å¿—æ–‡ä»¶
â€¢ éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
â€¢ æµ‹è¯•æ•°æ®åº“è¿žæŽ¥
â€¢ æ£€æŸ¥é›†ç¾¤å…ƒæ•°æ®è¡¨
```

### 11.4 è¿›é˜¶å­¦ä¹ æ–¹å‘


```
æ·±å…¥å­¦ä¹ å»ºè®®ï¼š
ðŸ“š Routeræ’ä»¶å¼€å‘
ðŸ“š è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥
ðŸ“š Router REST APIä½¿ç”¨
ðŸ“š å¤šé›†ç¾¤Routeré…ç½®
ðŸ“š Routeræ€§èƒ½è°ƒä¼˜
ðŸ“š å®¹å™¨åŒ–Routeréƒ¨ç½²
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- Bootstrapæ˜¯Routeré…ç½®çš„è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆ
- é€šè¿‡è¯»å–é›†ç¾¤å…ƒæ•°æ®å®žçŽ°åŠ¨æ€é…ç½®æ›´æ–°
- éµå¾ªæœ€å°æƒé™åŽŸåˆ™ç¡®ä¿å®‰å…¨æ€§
- æ”¯æŒä¸°å¯Œçš„å‚æ•°é€‰é¡¹æ»¡è¶³ä¸åŒéœ€æ±‚
- ç”Ÿäº§çŽ¯å¢ƒä½¿ç”¨éœ€è¦è€ƒè™‘å®‰å…¨å’Œç›‘æŽ§