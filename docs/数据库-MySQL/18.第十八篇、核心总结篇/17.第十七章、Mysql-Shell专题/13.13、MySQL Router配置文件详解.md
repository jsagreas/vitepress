---
title: 13ã€MySQL Routeré…ç½®æ–‡ä»¶è¯¦è§£
---
## ğŸ“š ç›®å½•

1. [MySQL Routeré…ç½®æ¦‚è¿°](#1-mysql-routeré…ç½®æ¦‚è¿°)
2. [é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£](#2-é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£)
3. [DEFAULTæ®µæ ¸å¿ƒé…ç½®](#3-defaultæ®µæ ¸å¿ƒé…ç½®)
4. [routingæ®µè·¯ç”±è®¾ç½®](#4-routingæ®µè·¯ç”±è®¾ç½®)
5. [æ—¥å¿—ä¸ç¼“å­˜é…ç½®](#5-æ—¥å¿—ä¸ç¼“å­˜é…ç½®)
6. [é«˜çº§ç‰¹æ€§é…ç½®](#6-é«˜çº§ç‰¹æ€§é…ç½®)
7. [é…ç½®éªŒè¯ä¸è°ƒä¼˜](#7-é…ç½®éªŒè¯ä¸è°ƒä¼˜)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ MySQL Routeré…ç½®æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯MySQL Router


**ç®€å•ç†è§£**ï¼šMySQL Routeræ˜¯MySQLå®˜æ–¹æä¾›çš„è½»é‡çº§ä¸­é—´ä»¶ï¼Œè´Ÿè´£åœ¨åº”ç”¨ç¨‹åºå’ŒMySQLæœåŠ¡å™¨ä¹‹é—´è½¬å‘è¿æ¥

```
åº”ç”¨ç¨‹åºè¿æ¥æ¶æ„ï¼š

ä¼ ç»Ÿç›´è¿æ–¹å¼ï¼š
Application â†’ MySQL Server
ç¼ºç‚¹ï¼šå•ç‚¹æ•…éšœï¼Œæ— æ³•è´Ÿè½½å‡è¡¡

ä½¿ç”¨Routeræ–¹å¼ï¼š
Application â†’ MySQL Router â†’ MySQL Cluster
          â†— Primary Server
          â†˜ Secondary Server(s)
ä¼˜ç‚¹ï¼šé«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€é€æ˜æ•…éšœè½¬ç§»
```

**Routerçš„æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸ¯ **é«˜å¯ç”¨æ€§** - è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œé¿å…æœåŠ¡ä¸­æ–­
- âš–ï¸ **è´Ÿè½½å‡è¡¡** - è¯»å†™åˆ†ç¦»ï¼Œåˆ†æ•£æ•°æ®åº“å‹åŠ›
- ğŸ”„ **é€æ˜ä»£ç†** - åº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹ä»£ç 
- ğŸ“Š **è¿æ¥æ± ** - å‡å°‘è¿æ¥å¼€é”€ï¼Œæå‡æ€§èƒ½

### 1.2 é…ç½®æ–‡ä»¶çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆé…ç½®æ–‡ä»¶å¦‚æ­¤å…³é”®**ï¼š
```
Routerçš„è¡Œä¸ºå®Œå…¨ç”±é…ç½®æ–‡ä»¶å†³å®šï¼š
â”œâ”€ ç›‘å¬å“ªäº›ç«¯å£
â”œâ”€ è¿æ¥åˆ°å“ªäº›MySQLæœåŠ¡å™¨
â”œâ”€ ä½¿ç”¨ä»€ä¹ˆè·¯ç”±ç­–ç•¥
â”œâ”€ å¦‚ä½•å¤„ç†æ•…éšœè½¬ç§»
â”œâ”€ æ—¥å¿—è®°å½•çº§åˆ«
â””â”€ å®‰å…¨è®¤è¯æ–¹å¼
```

**é…ç½®æ–‡ä»¶ä½ç½®**ï¼š
- **Linux**: `/etc/mysqlrouter/mysqlrouter.conf`
- **Windows**: `C:\ProgramData\MySQL\MySQL Router\mysqlrouter.conf`
- **è‡ªå®šä¹‰**: `mysqlrouter --config=/path/to/config.conf`

---

## 2. ğŸ“‹ é…ç½®æ–‡ä»¶ç»“æ„è¯¦è§£


### 2.1 é…ç½®æ–‡ä»¶åŸºæœ¬æ ¼å¼


**INIæ ¼å¼ç»“æ„**ï¼š
```ini
# MySQL Routeré…ç½®æ–‡ä»¶é‡‡ç”¨INIæ ¼å¼
# æ³¨é‡Šä»¥#æˆ–;å¼€å¤´

[DEFAULT]
# å…¨å±€é»˜è®¤é…ç½®

[routing:primary]
# ä¸»æœåŠ¡å™¨è·¯ç”±é…ç½®

[routing:secondary]  
# ä»æœåŠ¡å™¨è·¯ç”±é…ç½®

[logger]
# æ—¥å¿—é…ç½®

[metadata_cache]
# å…ƒæ•°æ®ç¼“å­˜é…ç½®
```

### 2.2 é…ç½®æ®µï¼ˆSectionï¼‰è¯´æ˜


**æ ¸å¿ƒé…ç½®æ®µç»“æ„å›¾**ï¼š
```
MySQL Routeré…ç½®æ–‡ä»¶ç»“æ„
â”œâ”€ [DEFAULT]           â† å…¨å±€é»˜è®¤å‚æ•°
â”œâ”€ [routing:name]      â† è·¯ç”±å®ä¾‹é…ç½®ï¼ˆå¯å¤šä¸ªï¼‰
â”œâ”€ [logger]            â† æ—¥å¿—ç³»ç»Ÿé…ç½®
â”œâ”€ [metadata_cache]    â† å…ƒæ•°æ®ç¼“å­˜é…ç½®
â”œâ”€ [keepalive]         â† è¿æ¥ä¿æ´»é…ç½®
â””â”€ [plugin:name]       â† æ’ä»¶ç‰¹å®šé…ç½®
```

### 2.3 é…ç½®ä¼˜å…ˆçº§


**å‚æ•°è¦†ç›–è§„åˆ™**ï¼š
```
é…ç½®ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. å‘½ä»¤è¡Œå‚æ•°
2. å…·ä½“æ®µé…ç½®ï¼ˆå¦‚[routing:primary]ï¼‰
3. [DEFAULT]æ®µé…ç½®
4. å†…ç½®é»˜è®¤å€¼

ç¤ºä¾‹ï¼š
[DEFAULT]
bind_port = 7001

[routing:primary]
bind_port = 6446    â† æ­¤å€¼ä¼šè¦†ç›–DEFAULTä¸­çš„è®¾ç½®
```

---

## 3. âš™ï¸ DEFAULTæ®µæ ¸å¿ƒé…ç½®


### 3.1 åŸºç¡€æœåŠ¡é…ç½®


**ğŸ”¸ è¿›ç¨‹è¿è¡Œé…ç½®**
```ini
[DEFAULT]
# ç”¨æˆ·èº«ä»½ï¼ˆLinuxï¼‰
user = mysqlrouter

# è¿›ç¨‹IDæ–‡ä»¶
pid_file = /var/run/mysqlrouter/mysqlrouter.pid

# è¿è¡Œæ—¶æ•°æ®ç›®å½•
runtime_folder = /var/run/mysqlrouter

# é…ç½®æ–‡ä»¶ç›®å½•
config_folder = /etc/mysqlrouter

# æ—¥å¿—ç›®å½•
logging_folder = /var/log/mysqlrouter
```

> ğŸ’¡ **æç¤º**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ä¸“é—¨çš„ç”¨æˆ·è¿è¡ŒRouteræœåŠ¡ï¼Œè€Œä¸æ˜¯rootç”¨æˆ·

### 3.2 ç½‘ç»œåŸºç¡€é…ç½®


**ğŸ”¸ é»˜è®¤ç½‘ç»œå‚æ•°**
```ini
[DEFAULT]
# é»˜è®¤ç»‘å®šåœ°å€ï¼ˆ0.0.0.0è¡¨ç¤ºæ‰€æœ‰ç½‘å¡ï¼‰
bind_address = 0.0.0.0

# é»˜è®¤ç«¯å£ï¼ˆä¼šè¢«å…·ä½“routingæ®µè¦†ç›–ï¼‰
bind_port = 6446

# è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
connect_timeout = 15

# è¯»å–è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
read_timeout = 30

# æœ€å¤§è¿æ¥æ•°
max_connections = 512
```

**ç½‘ç»œé…ç½®è¯´æ˜**ï¼š
- ğŸ”¸ **bind_address**: æŒ‡å®šRouterç›‘å¬çš„ç½‘ç»œæ¥å£
- ğŸ”¸ **bind_port**: é»˜è®¤ç›‘å¬ç«¯å£ï¼Œé€šå¸¸ä¼šåœ¨routingæ®µä¸­å…·ä½“æŒ‡å®š
- ğŸ”¸ **è¶…æ—¶é…ç½®**: é˜²æ­¢é•¿æ—¶é—´æ— å“åº”çš„è¿æ¥å ç”¨èµ„æº

### 3.3 SSLé»˜è®¤é…ç½®


**ğŸ”¸ SSLåŸºç¡€è®¾ç½®**
```ini
[DEFAULT]
# å®¢æˆ·ç«¯SSLæ¨¡å¼ï¼ˆDISABLED/PREFERRED/REQUIREDï¼‰
client_ssl_mode = PREFERRED

# æœåŠ¡ç«¯SSLæ¨¡å¼
server_ssl_mode = PREFERRED

# SSLè¯ä¹¦æ–‡ä»¶è·¯å¾„
ssl_cert = /etc/mysqlrouter/ssl/router-cert.pem
ssl_key = /etc/mysqlrouter/ssl/router-key.pem
ssl_ca = /etc/mysqlrouter/ssl/ca.pem

# SSLåŠ å¯†å¥—ä»¶
ssl_cipher = HIGH:!aNULL:!MD5
```

**SSLæ¨¡å¼è§£é‡Š**ï¼š
- ğŸ”¸ **DISABLED**: ç¦ç”¨SSLè¿æ¥
- ğŸ”¸ **PREFERRED**: ä¼˜å…ˆä½¿ç”¨SSLï¼Œä½†å…è®¸éSSLè¿æ¥
- ğŸ”¸ **REQUIRED**: å¼ºåˆ¶è¦æ±‚SSLè¿æ¥

---

## 4. ğŸš routingæ®µè·¯ç”±è®¾ç½®


### 4.1 routingæ®µåŸºæœ¬ç»“æ„


**routingæ®µçš„å‘½åå’Œä½œç”¨**ï¼š
```ini
# å‘½åè§„åˆ™ï¼š[routing:å®ä¾‹å]
[routing:primary_rw]     # è¯»å†™è·¯ç”±å®ä¾‹
[routing:secondary_ro]   # åªè¯»è·¯ç”±å®ä¾‹
[routing:admin]          # ç®¡ç†è¿æ¥å®ä¾‹
```

### 4.2 æ ¸å¿ƒè·¯ç”±å‚æ•°


**ğŸ”¸ åŸºæœ¬è·¯ç”±é…ç½®**
```ini
[routing:primary_rw]
# ç»‘å®šåœ°å€å’Œç«¯å£
bind_address = 0.0.0.0
bind_port = 6446

# ç›®æ ‡æœåŠ¡å™¨åˆ—è¡¨
destinations = mysql-primary:3306,mysql-secondary1:3306,mysql-secondary2:3306

# è·¯ç”±ç­–ç•¥
routing_strategy = first-available

# è·¯ç”±æ¨¡å¼ï¼ˆè¯»å†™æ¨¡å¼ï¼‰
mode = read-write

# åè®®ç±»å‹
protocol = classic
```

**ğŸ”¸ è·¯ç”±ç­–ç•¥è¯¦è§£**

| ç­–ç•¥åç§° | **å·¥ä½œåŸç†** | **é€‚ç”¨åœºæ™¯** |
|----------|-------------|-------------|
| ğŸ”¸ **first-available** | `æŒ‰é¡ºåºé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨æœåŠ¡å™¨` | `ä¸»ä»æ¶æ„ï¼Œæ˜ç¡®çš„ä¸»å¤‡å…³ç³»` |
| ğŸ”¸ **round-robin** | `è½®è¯¢æ‰€æœ‰å¯ç”¨æœåŠ¡å™¨` | `å¤šä¸ªç­‰ä»·æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡` |
| ğŸ”¸ **round-robin-with-fallback** | `è½®è¯¢+æ•…éšœå›é€€` | `ä¸»æœåŠ¡å™¨ç¾¤+å¤‡ç”¨æœåŠ¡å™¨` |

### 4.3 è¯»å†™åˆ†ç¦»é…ç½®


**å…¸å‹çš„è¯»å†™åˆ†ç¦»é…ç½®ç¤ºä¾‹**ï¼š
```ini
# å†™æ“ä½œè·¯ç”±ï¼ˆä¸»æœåŠ¡å™¨ï¼‰
[routing:primary_rw]
bind_address = 0.0.0.0
bind_port = 6446
destinations = mysql-primary:3306
routing_strategy = first-available
mode = read-write
max_connections = 256

# è¯»æ“ä½œè·¯ç”±ï¼ˆä»æœåŠ¡å™¨ï¼‰
[routing:secondary_ro]
bind_address = 0.0.0.0
bind_port = 6447
destinations = mysql-secondary1:3306,mysql-secondary2:3306,mysql-secondary3:3306
routing_strategy = round-robin
mode = read-only
max_connections = 512
```

**åº”ç”¨ç¨‹åºè¿æ¥æ–¹å¼**ï¼š
```java
// Javaåº”ç”¨ç¨‹åºç¤ºä¾‹
// å†™æ“ä½œè¿æ¥ä¸»åº“
DataSource writeDS = new HikariDataSource();
writeDS.setJdbcUrl("jdbc:mysql://router-host:6446/mydb");

// è¯»æ“ä½œè¿æ¥ä»åº“
DataSource readDS = new HikariDataSource();  
readDS.setJdbcUrl("jdbc:mysql://router-host:6447/mydb");
```

### 4.4 è¿æ¥æ± å‚æ•°


**ğŸ”¸ è¿æ¥ç®¡ç†é…ç½®**
```ini
[routing:primary_rw]
# æœ€å¤§è¿æ¥æ•°
max_connections = 256

# æœ€å¤§è¿æ¥æ´»è·ƒæ—¶é—´ï¼ˆç§’ï¼‰
max_connect_errors = 100

# è¿æ¥è¶…æ—¶æ—¶é—´
connect_timeout = 15

# å®¢æˆ·ç«¯è¿æ¥ç©ºé—²è¶…æ—¶
client_connect_timeout = 9

# æœåŠ¡å™¨è¿æ¥ç©ºé—²è¶…æ—¶  
server_connect_timeout = 9
```

**è¿æ¥æ± è°ƒä¼˜å»ºè®®**ï¼š
```
è¿æ¥æ•°è§„åˆ’ï¼š
â”œâ”€ åº”ç”¨è¿æ¥æ•°ï¼šæ ¹æ®åº”ç”¨å¹¶å‘é‡è®¾ç½®
â”œâ”€ Routerè¿æ¥æ•°ï¼šåº”ç”¨è¿æ¥æ•° Ã— 1.2-1.5
â”œâ”€ MySQLæœ€å¤§è¿æ¥æ•°ï¼šRouterè¿æ¥æ•° Ã— è·¯ç”±å®ä¾‹æ•° + 100
â””â”€ ç›‘æ§è¿æ¥ä½¿ç”¨ç‡ï¼ŒåŠæ—¶è°ƒæ•´
```

---

## 5. ğŸ“Š æ—¥å¿—ä¸ç¼“å­˜é…ç½®


### 5.1 loggeræ—¥å¿—é…ç½®


**ğŸ”¸ æ—¥å¿—åŸºæœ¬è®¾ç½®**
```ini
[logger]
# æ—¥å¿—çº§åˆ«ï¼ˆDEBUG/INFO/WARNING/ERROR/FATALï¼‰
level = INFO

# æ—¥å¿—è¾“å‡ºç›®æ ‡
sinks = filelog,consolelog

# æ–‡ä»¶æ—¥å¿—é…ç½®
[logger.filelog]
# æ—¥å¿—æ–‡ä»¶è·¯å¾„
filename = /var/log/mysqlrouter/mysqlrouter.log

# æ—¥å¿—è½®è½¬å¤§å°ï¼ˆMBï¼‰
max_size = 100MB

# ä¿ç•™æ—¥å¿—æ–‡ä»¶æ•°é‡
max_files = 10

# æ§åˆ¶å°æ—¥å¿—é…ç½®
[logger.consolelog]
# è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º
destination = stdout
```

**ğŸ”¸ æ—¥å¿—çº§åˆ«è¯´æ˜**

| çº§åˆ« | **åŒ…å«å†…å®¹** | **ç”Ÿäº§ç¯å¢ƒå»ºè®®** |
|------|-------------|----------------|
| ğŸ”¸ **DEBUG** | `è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼Œæ€§èƒ½æ•°æ®` | `ä»…æ•…éšœæ’æŸ¥æ—¶ä½¿ç”¨` |
| ğŸ”¸ **INFO** | `ä¸€èˆ¬ä¿¡æ¯ï¼Œè¿æ¥çŠ¶æ€å˜åŒ–` | `æ¨èè®¾ç½®` |
| ğŸ”¸ **WARNING** | `è­¦å‘Šä¿¡æ¯ï¼Œéè‡´å‘½é”™è¯¯` | `ç”Ÿäº§ç¯å¢ƒæœ€ä½çº§åˆ«` |
| ğŸ”¸ **ERROR** | `é”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨` | `é—®é¢˜ç¯å¢ƒä½¿ç”¨` |

### 5.2 metadata_cacheç¼“å­˜é…ç½®


**ğŸ”¸ å…ƒæ•°æ®ç¼“å­˜è®¾ç½®**
```ini
[metadata_cache:cluster_metadata]
# é›†ç¾¤ç±»å‹ï¼ˆgrè¡¨ç¤ºGroup Replicationï¼‰
cluster_type = gr

# BootstrapæœåŠ¡å™¨åˆ—è¡¨
bootstrap_server_addresses = mysql1:3306,mysql2:3306,mysql3:3306

# ç”¨æˆ·è®¤è¯ä¿¡æ¯
user = router_user
# å¯†ç é€šå¸¸é€šè¿‡keyringè·å–
metadata_cluster = mycluster

# ç¼“å­˜åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
ttl = 0.5

# ä½¿ç”¨SSLè¿æ¥å…ƒæ•°æ®æœåŠ¡å™¨
use_gr_notifications = 1
```

**ç¼“å­˜å‚æ•°è¯¦è§£**ï¼š
```
TTLè®¾ç½®å»ºè®®ï¼š
â”œâ”€ å¼€å‘ç¯å¢ƒï¼šttl = 5ï¼ˆ5ç§’åˆ·æ–°ï¼‰
â”œâ”€ æµ‹è¯•ç¯å¢ƒï¼šttl = 2ï¼ˆ2ç§’åˆ·æ–°ï¼‰  
â”œâ”€ ç”Ÿäº§ç¯å¢ƒï¼šttl = 0.5ï¼ˆ0.5ç§’åˆ·æ–°ï¼‰
â””â”€ æ³¨æ„ï¼šTTLè¿‡å°å¢åŠ å…ƒæ•°æ®æœåŠ¡å™¨è´Ÿè½½

use_gr_notifications = 1ï¼š
â”œâ”€ å¯ç”¨Group Replicationäº‹ä»¶é€šçŸ¥
â”œâ”€ æ›´å¿«çš„æ•…éšœæ£€æµ‹å’Œåˆ‡æ¢
â””â”€ å‡å°‘ä¸å¿…è¦çš„å…ƒæ•°æ®æŸ¥è¯¢
```

### 5.3 keepaliveè¿æ¥ä¿æ´»


**ğŸ”¸ è¿æ¥ä¿æ´»é…ç½®**
```ini
[keepalive]
# å¯ç”¨TCP Keep-Alive
interval = 60

# Keep-Aliveæ¢æµ‹é—´éš”ï¼ˆç§’ï¼‰
time = 600

# æ¢æµ‹é‡è¯•æ¬¡æ•°
count = 3
```

---

## 6. ğŸ”§ é«˜çº§ç‰¹æ€§é…ç½®


### 6.1 SSLé«˜çº§é…ç½®


**ğŸ”¸ å®Œæ•´SSLé…ç½®ç¤ºä¾‹**
```ini
[routing:secure_primary]
bind_address = 0.0.0.0
bind_port = 6446
destinations = mysql-primary:3306

# å®¢æˆ·ç«¯SSLè¦æ±‚
client_ssl_mode = REQUIRED
client_ssl_cert = /etc/mysqlrouter/ssl/client-cert.pem
client_ssl_key = /etc/mysqlrouter/ssl/client-key.pem
client_ssl_ca = /etc/mysqlrouter/ssl/client-ca.pem

# æœåŠ¡ç«¯SSLè®¾ç½®
server_ssl_mode = REQUIRED  
server_ssl_verify = VERIFY_CA
server_ssl_ca = /etc/mysqlrouter/ssl/server-ca.pem

# SSLåè®®ç‰ˆæœ¬
tls_version = TLSv1.2,TLSv1.3
```

**SSLéªŒè¯æ¨¡å¼**ï¼š
- ğŸ”¸ **VERIFY_CA**: éªŒè¯æœåŠ¡å™¨è¯ä¹¦æ˜¯å¦ç”±å¯ä¿¡CAç­¾å‘
- ğŸ”¸ **VERIFY_IDENTITY**: é¢å¤–éªŒè¯æœåŠ¡å™¨ä¸»æœºåæ˜¯å¦åŒ¹é…è¯ä¹¦

### 6.2 ç›‘æ§ç«¯å£è®¾ç½®


**ğŸ”¸ REST APIç›‘æ§é…ç½®**
```ini
[http_server]
# å¯ç”¨HTTPæœåŠ¡å™¨
port = 8443

# ç»‘å®šåœ°å€
bind_address = 127.0.0.1

# SSLé…ç½®ï¼ˆå¯é€‰ï¼‰
ssl = 1
ssl_cert = /etc/mysqlrouter/ssl/http-cert.pem
ssl_key = /etc/mysqlrouter/ssl/http-key.pem

[http_auth_realm:default_auth_realm]
# è®¤è¯æ–¹å¼
backend = default_auth_backend
method = basic

[http_auth_backend:default_auth_backend]
# è®¤è¯åç«¯ç±»å‹
backend = file
filename = /etc/mysqlrouter/mysqlrouter.passwd
```

**ç›‘æ§æ¥å£ä½¿ç”¨**ï¼š
```bash
# æŸ¥çœ‹RouterçŠ¶æ€
curl -u admin:password http://localhost:8443/api/20190715/swagger.json

# æŸ¥çœ‹è·¯ç”±çŠ¶æ€
curl -u admin:password http://localhost:8443/api/20190715/routes

# æŸ¥çœ‹è¿æ¥ä¿¡æ¯
curl -u admin:password http://localhost:8443/api/20190715/connections
```

### 6.3 æ’ä»¶é…ç½®


**ğŸ”¸ è‡ªå®šä¹‰æ’ä»¶é…ç½®**
```ini
[plugin:custom_plugin]
# æ’ä»¶åº“æ–‡ä»¶è·¯å¾„
library = /usr/lib/mysqlrouter/libcustom_plugin.so

# æ’ä»¶ç‰¹å®šé…ç½®
plugin_config_param1 = value1
plugin_config_param2 = value2
```

---

## 7. âœ… é…ç½®éªŒè¯ä¸è°ƒä¼˜


### 7.1 é…ç½®æ–‡ä»¶éªŒè¯


**ğŸ”¸ è¯­æ³•éªŒè¯å‘½ä»¤**
```bash
# éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
mysqlrouter --validate-config --config=/etc/mysqlrouter/mysqlrouter.conf

# è¯¦ç»†éªŒè¯è¾“å‡º
mysqlrouter --validate-config --config=/etc/mysqlrouter/mysqlrouter.conf --verbose

# æµ‹è¯•å¯åŠ¨ï¼ˆä¸å®é™…å¯åŠ¨æœåŠ¡ï¼‰
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --dry-run
```

### 7.2 å¸¸è§é…ç½®é”™è¯¯


**ğŸ”¸ å…¸å‹é…ç½®é—®é¢˜åŠè§£å†³**

```ini
# âŒ é”™è¯¯ï¼šç«¯å£å†²çª
[routing:service1]
bind_port = 6446

[routing:service2]  
bind_port = 6446    # ä¸ä¸Šé¢å†²çª

# âœ… æ­£ç¡®ï¼šä½¿ç”¨ä¸åŒç«¯å£
[routing:service1]
bind_port = 6446

[routing:service2]
bind_port = 6447
```

```ini
# âŒ é”™è¯¯ï¼šç›®æ ‡æœåŠ¡å™¨æ ¼å¼é”™è¯¯
destinations = mysql-server1,mysql-server2:3306

# âœ… æ­£ç¡®ï¼šç»Ÿä¸€æ ¼å¼
destinations = mysql-server1:3306,mysql-server2:3306
```

### 7.3 æ€§èƒ½è°ƒä¼˜é…ç½®


**ğŸ”¸ é«˜æ€§èƒ½é…ç½®æ¨¡æ¿**
```ini
[DEFAULT]
# å¢åŠ æœ€å¤§è¿æ¥æ•°
max_connections = 2048

# ä¼˜åŒ–è¶…æ—¶è®¾ç½®
connect_timeout = 10
read_timeout = 600

[routing:high_performance]
bind_address = 0.0.0.0
bind_port = 6446

# ç›®æ ‡æœåŠ¡å™¨ï¼ˆä½¿ç”¨IPé¿å…DNSè§£æï¼‰
destinations = 192.168.1.10:3306,192.168.1.11:3306

# é«˜æ€§èƒ½è·¯ç”±ç­–ç•¥
routing_strategy = round-robin
max_connections = 1024

# è¿æ¥æ± ä¼˜åŒ–
client_connect_timeout = 5
server_connect_timeout = 5

[metadata_cache:perf_cluster]
# å¿«é€Ÿæ•…éšœæ£€æµ‹
ttl = 0.5
use_gr_notifications = 1

[logger]
# ç”Ÿäº§ç¯å¢ƒå‡å°‘æ—¥å¿—
level = WARNING
```

### 7.4 é…ç½®æ¨¡æ¿ç¤ºä¾‹


**ğŸ”¸ ç”Ÿäº§ç¯å¢ƒå®Œæ•´é…ç½®**
```ini
[DEFAULT]
user = mysqlrouter
logging_folder = /var/log/mysqlrouter
runtime_folder = /var/run/mysqlrouter
config_folder = /etc/mysqlrouter
max_connections = 2048
connect_timeout = 15

# è¯»å†™è·¯ç”±
[routing:primary_rw]
bind_address = 0.0.0.0
bind_port = 6446
destinations = metadata-cache://mycluster/default?role=PRIMARY
routing_strategy = first-available
mode = read-write
max_connections = 512

# åªè¯»è·¯ç”±
[routing:secondary_ro]
bind_address = 0.0.0.0  
bind_port = 6447
destinations = metadata-cache://mycluster/default?role=SECONDARY
routing_strategy = round-robin
mode = read-only
max_connections = 1024

# å…ƒæ•°æ®ç¼“å­˜
[metadata_cache:mycluster]
cluster_type = gr
bootstrap_server_addresses = mysql1:3306,mysql2:3306,mysql3:3306
user = router_user
metadata_cluster = mycluster
ttl = 0.5
use_gr_notifications = 1

# æ—¥å¿—é…ç½®
[logger]
level = INFO
sinks = filelog

[logger.filelog]
filename = /var/log/mysqlrouter/mysqlrouter.log
max_size = 100MB
max_files = 10

# ç›‘æ§ç«¯å£
[http_server]
port = 8443
bind_address = 127.0.0.1

# è¿æ¥ä¿æ´»
[keepalive]
interval = 60
time = 600
count = 3
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é…ç½®æ–‡ä»¶ç»“æ„ï¼šINIæ ¼å¼ï¼Œåˆ†æ®µé…ç½®ï¼Œä¼˜å…ˆçº§è¦†ç›–
ğŸ”¸ æ ¸å¿ƒé…ç½®æ®µï¼šDEFAULTå…¨å±€è®¾ç½®ï¼Œroutingè·¯ç”±é…ç½®ï¼Œloggeræ—¥å¿—
ğŸ”¸ è·¯ç”±ç­–ç•¥ï¼šfirst-availableä¸»ä»ï¼Œround-robinè´Ÿè½½å‡è¡¡
ğŸ”¸ è¿æ¥ç®¡ç†ï¼šmax_connectionsè¿æ¥æ•°ï¼Œè¶…æ—¶é…ç½®ï¼Œè¿æ¥æ± è°ƒä¼˜
ğŸ”¸ é«˜å¯ç”¨é…ç½®ï¼šmetadata_cacheå…ƒæ•°æ®ç¼“å­˜ï¼Œæ•…éšœæ£€æµ‹TTL
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é…ç½®æ–‡ä»¶çš„å±‚æ¬¡ç»“æ„**
```
é…ç½®ä¼˜å…ˆçº§ç†è§£ï¼š
å‘½ä»¤è¡Œå‚æ•° > å…·ä½“æ®µé…ç½® > DEFAULTæ®µ > å†…ç½®é»˜è®¤å€¼

å®é™…åº”ç”¨ï¼š
â”œâ”€ DEFAULTæ®µï¼šè®¾ç½®é€šç”¨å‚æ•°
â”œâ”€ routingæ®µï¼šé…ç½®å…·ä½“è·¯ç”±å®ä¾‹  
â”œâ”€ loggeræ®µï¼šé…ç½®æ—¥å¿—è¡Œä¸º
â””â”€ å…¶ä»–æ®µï¼šç‰¹å®šåŠŸèƒ½é…ç½®
```

**ğŸ”¹ ç”Ÿäº§ç¯å¢ƒé…ç½®è¦ç‚¹**
```
å®‰å…¨æ€§è€ƒè™‘ï¼š
â”œâ”€ ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·è¿è¡ŒæœåŠ¡
â”œâ”€ å¯ç”¨SSLåŠ å¯†ä¼ è¾“
â”œâ”€ é™åˆ¶ç›‘æ§ç«¯å£è®¿é—®
â””â”€ å®šæœŸæ›´æ–°è®¤è¯å¯†ç 

æ€§èƒ½ä¼˜åŒ–ï¼š
â”œâ”€ åˆç†è®¾ç½®è¿æ¥æ•°é™åˆ¶
â”œâ”€ ä¼˜åŒ–è¶…æ—¶å‚æ•°  
â”œâ”€ ä½¿ç”¨IPåœ°å€é¿å…DNSè§£æ
â””â”€ è°ƒæ•´å…ƒæ•°æ®ç¼“å­˜TTL
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”¸ é…ç½®å¼€å‘æµç¨‹**
```bash
# 1. åˆ›å»ºåŸºç¡€é…ç½®
sudo cp /usr/share/mysqlrouter/mysqlrouter.conf.sample /etc/mysqlrouter/

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vim /etc/mysqlrouter/mysqlrouter.conf

# 3. éªŒè¯é…ç½®è¯­æ³•
mysqlrouter --validate-config

# 4. æµ‹è¯•å¯åŠ¨
mysqlrouter --config=/etc/mysqlrouter/mysqlrouter.conf --dry-run

# 5. æ­£å¼å¯åŠ¨æœåŠ¡
sudo systemctl start mysqlrouter
sudo systemctl enable mysqlrouter
```

**ğŸ”¸ æ•…éšœæ’æŸ¥æ­¥éª¤**
```bash
# 1. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
mysqlrouter --validate-config --verbose

# 2. æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯
tail -f /var/log/mysqlrouter/mysqlrouter.log

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status mysqlrouter

# 4. æµ‹è¯•è¿æ¥
mysql -h localhost -P 6446 -u testuser -p

# 5. æŸ¥çœ‹ç›‘æ§ä¿¡æ¯
curl -u admin:password http://localhost:8443/api/20190715/routes
```

**ğŸ”¸ é…ç½®æœ€ä½³å®è·µ**
```
é…ç½®ç®¡ç†å»ºè®®ï¼š
â”œâ”€ ç‰ˆæœ¬æ§åˆ¶ï¼šå°†é…ç½®æ–‡ä»¶çº³å…¥Gitç®¡ç†
â”œâ”€ ç¯å¢ƒéš”ç¦»ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ä½¿ç”¨ä¸åŒé…ç½®
â”œâ”€ å®šæœŸå¤‡ä»½ï¼šé‡è¦é…ç½®æ–‡ä»¶å®šæœŸå¤‡ä»½  
â”œâ”€ æ–‡æ¡£è®°å½•ï¼šé…ç½®ä¿®æ”¹è¦æœ‰è¯¦ç»†è®°å½•
â””â”€ ç›‘æ§å‘Šè­¦ï¼šé…ç½®RouterçŠ¶æ€ç›‘æ§
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- Routeré…ç½®æ–‡ä»¶é‡‡ç”¨INIæ ¼å¼ï¼Œåˆ†æ®µç®¡ç†ä¸åŒåŠŸèƒ½
- routingæ®µæ˜¯æ ¸å¿ƒï¼Œå®šä¹‰äº†æµé‡å¦‚ä½•è·¯ç”±åˆ°åç«¯æœåŠ¡å™¨
- å…ƒæ•°æ®ç¼“å­˜é…ç½®å†³å®šäº†æ•…éšœæ£€æµ‹å’Œåˆ‡æ¢çš„é€Ÿåº¦
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»è€ƒè™‘å®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§
- é…ç½®éªŒè¯å’Œæµ‹è¯•æ˜¯éƒ¨ç½²å‰çš„å¿…è¦æ­¥éª¤