---
title: 8ã€MySQL Shell Pythonæ¨¡å¼ç¼–ç¨‹
---
## ğŸ“š ç›®å½•

1. [Pythonæ¨¡å¼åŸºç¡€æ¦‚å¿µ](#1-Pythonæ¨¡å¼åŸºç¡€æ¦‚å¿µ)
2. [Pythonè¯­æ³•æ”¯æŒä¸ç‰¹æ€§](#2-Pythonè¯­æ³•æ”¯æŒä¸ç‰¹æ€§)
3. [æ•°æ®ç±»å‹æ“ä½œè¯¦è§£](#3-æ•°æ®ç±»å‹æ“ä½œè¯¦è§£)
4. [å­—å…¸åˆ—è¡¨å¤„ç†æŠ€å·§](#4-å­—å…¸åˆ—è¡¨å¤„ç†æŠ€å·§)
5. [æ–‡ä»¶æ“ä½œä¸I/Oå¤„ç†](#5-æ–‡ä»¶æ“ä½œä¸IOå¤„ç†)
6. [æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨](#6-æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨)
7. [é”™è¯¯å¼‚å¸¸å¤„ç†æœºåˆ¶](#7-é”™è¯¯å¼‚å¸¸å¤„ç†æœºåˆ¶)
8. [æ¨¡å—å¼•ç”¨ä¸æ‰©å±•](#8-æ¨¡å—å¼•ç”¨ä¸æ‰©å±•)
9. [æ•°æ®åˆ†ææ“ä½œå®æˆ˜](#9-æ•°æ®åˆ†ææ“ä½œå®æˆ˜)
10. [è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™](#10-è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ Pythonæ¨¡å¼åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MySQL Shell Pythonæ¨¡å¼


**ç®€å•ç†è§£**ï¼šMySQL Shellçš„Pythonæ¨¡å¼å°±æ˜¯åœ¨MySQLç®¡ç†å·¥å…·ä¸­é›†æˆäº†Pythonç¼–ç¨‹ç¯å¢ƒï¼Œè®©ä½ å¯ä»¥ç”¨Pythonè¯­è¨€æ¥æ“ä½œæ•°æ®åº“ã€‚

```
ä¼ ç»Ÿæ–¹å¼ï¼šåªèƒ½ç”¨SQLè¯­å¥æ“ä½œæ•°æ®åº“
Pythonæ¨¡å¼ï¼šSQL + Pythonç¼–ç¨‹èƒ½åŠ› = æ›´å¼ºå¤§çš„æ•°æ®åº“æ“ä½œ
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- ğŸ”¸ **ç¼–ç¨‹çµæ´»æ€§**ï¼šç”¨Pythoné€»è¾‘å¤„ç†å¤æ‚ä¸šåŠ¡
- ğŸ”¸ **æ•°æ®å¤„ç†èƒ½åŠ›**ï¼šå¼ºå¤§çš„æ•°æ®åˆ†æå’Œè½¬æ¢åŠŸèƒ½
- ğŸ”¸ **è‡ªåŠ¨åŒ–æ”¯æŒ**ï¼šç¼–å†™è„šæœ¬å®ç°è‡ªåŠ¨åŒ–è¿ç»´
- ğŸ”¸ **ç”Ÿæ€ä¸°å¯Œ**ï¼šå¯ä»¥ä½¿ç”¨Pythonä¸°å¯Œçš„ç¬¬ä¸‰æ–¹åº“

### 1.2 è¿›å…¥Pythonæ¨¡å¼


**å¯åŠ¨æ–¹å¼**ï¼š
```bash
# ç›´æ¥ä»¥Pythonæ¨¡å¼å¯åŠ¨
mysqlsh --py

# åœ¨Shellä¸­åˆ‡æ¢åˆ°Pythonæ¨¡å¼
MySQL > \py
Switching to Python mode...
```

**æ¨¡å¼æ ‡è¯†**ï¼š
```
MySQL  JS > \py     # ä»JavaScriptæ¨¡å¼åˆ‡æ¢
MySQL  Py >         # å½“å‰å¤„äºPythonæ¨¡å¼
```

### 1.3 Pythonæ¨¡å¼çš„å·¥ä½œåŸç†


**è¿è¡Œæœºåˆ¶**ï¼š
```
MySQL Shell Pythonæ¨¡å¼æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Pythonè§£é‡Šå™¨ç¯å¢ƒ        â”‚ â† æ‰§è¡ŒPythonä»£ç 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     MySQL Shell API        â”‚ â† æ•°æ®åº“æ“ä½œæ¥å£
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     MySQL Xåè®®            â”‚ â† é€šä¿¡åè®®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     MySQLæœåŠ¡å™¨            â”‚ â† æ•°æ®å­˜å‚¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸æ ‡å‡†Pythonçš„åŒºåˆ«**ï¼š
- âœ… **å†…ç½®MySQL API**ï¼šç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…é©±åŠ¨
- âœ… **äº¤äº’å¼ç¯å¢ƒ**ï¼šå³å†™å³æ‰§è¡Œï¼Œä¾¿äºè°ƒè¯•
- âœ… **é›†æˆç®¡ç†åŠŸèƒ½**ï¼šç»“åˆMySQLç®¡ç†ç‰¹æ€§

---

## 2. ğŸ”§ Pythonè¯­æ³•æ”¯æŒä¸ç‰¹æ€§


### 2.1 åŸºæœ¬è¯­æ³•æ”¯æŒ


**å®Œæ•´Pythonè¯­æ³•**ï¼šMySQL Shellæ”¯æŒæ ‡å‡†Python 3.xè¯­æ³•

```python
# å˜é‡å®šä¹‰å’ŒåŸºæœ¬æ“ä½œ
name = "MySQL"
version = 8.0
is_running = True

# å­—ç¬¦ä¸²æ“ä½œ
greeting = f"Welcome to {name} {version}"
print(greeting)

# æ¡ä»¶åˆ¤æ–­
if version >= 8.0:
    print("æ”¯æŒæ–°ç‰¹æ€§")
else:
    print("å»ºè®®å‡çº§")
```

### 2.2 æ•°æ®ç»“æ„æ”¯æŒ


**åˆ—è¡¨æ“ä½œ**ï¼š
```python
# å®šä¹‰æ•°æ®åº“åˆ—è¡¨
databases = ['mysql', 'information_schema', 'performance_schema']

# åˆ—è¡¨æ“ä½œ
databases.append('test_db')
print(f"æ•°æ®åº“æ•°é‡: {len(databases)}")

# åˆ—è¡¨æ¨å¯¼å¼
active_dbs = [db for db in databases if db != 'test']
```

**å­—å…¸æ“ä½œ**ï¼š
```python
# ç”¨æˆ·ä¿¡æ¯å­—å…¸
user_info = {
    'username': 'admin',
    'host': 'localhost',
    'privileges': ['SELECT', 'INSERT', 'UPDATE']
}

# è®¿é—®å’Œä¿®æ”¹
print(user_info['username'])
user_info['last_login'] = '2025-09-11'
```

### 2.3 å‡½æ•°å®šä¹‰ä¸ä½¿ç”¨


**è‡ªå®šä¹‰å‡½æ•°**ï¼š
```python
def check_connection_status(session):
    """æ£€æŸ¥æ•°æ®åº“è¿æ¥çŠ¶æ€"""
    try:
        result = session.run_sql("SELECT 1")
        return "è¿æ¥æ­£å¸¸"
    except Exception as e:
        return f"è¿æ¥å¼‚å¸¸: {str(e)}"

# ä½¿ç”¨å‡½æ•°
status = check_connection_status(session)
print(status)
```

---

## 3. ğŸ“Š æ•°æ®ç±»å‹æ“ä½œè¯¦è§£


### 3.1 åŸºæœ¬æ•°æ®ç±»å‹å¤„ç†


**æ•°å€¼ç±»å‹æ“ä½œ**ï¼š
```python
# æ•´æ•°å’Œæµ®ç‚¹æ•°
user_count = 1000
avg_salary = 5500.75

# æ•°å€¼è®¡ç®—
total_cost = user_count * avg_salary
print(f"æ€»æˆæœ¬: {total_cost:,.2f}")

# ç±»å‹è½¬æ¢
str_number = "123"
int_number = int(str_number)
```

**å­—ç¬¦ä¸²ç±»å‹æ“ä½œ**ï¼š
```python
# å­—ç¬¦ä¸²å®šä¹‰
table_name = "user_info"
sql_template = "SELECT * FROM {table} WHERE id = {user_id}"

# å­—ç¬¦ä¸²æ ¼å¼åŒ–
sql_query = sql_template.format(table=table_name, user_id=100)

# å­—ç¬¦ä¸²æ–¹æ³•
if table_name.startswith("user"):
    print("è¿™æ˜¯ç”¨æˆ·ç›¸å…³è¡¨")
```

### 3.2 å¤æ‚æ•°æ®ç±»å‹


**æ—¥æœŸæ—¶é—´å¤„ç†**ï¼š
```python
from datetime import datetime, timedelta

# å½“å‰æ—¶é—´
now = datetime.now()
print(f"å½“å‰æ—¶é—´: {now.strftime('%Y-%m-%d %H:%M:%S')}")

# æ—¶é—´è®¡ç®—
one_week_ago = now - timedelta(days=7)
date_filter = one_week_ago.strftime('%Y-%m-%d')
```

**Noneç±»å‹å¤„ç†**ï¼š
```python
def safe_get_value(data, key, default=None):
    """å®‰å…¨è·å–å­—å…¸å€¼"""
    return data.get(key, default)

# ä½¿ç”¨ç¤ºä¾‹
config = {'host': 'localhost'}
port = safe_get_value(config, 'port', 3306)
```

---

## 4. ğŸ—‚ï¸ å­—å…¸åˆ—è¡¨å¤„ç†æŠ€å·§


### 4.1 æŸ¥è¯¢ç»“æœå¤„ç†


**ç»“æœé›†è½¬æ¢**ï¼š
```python
# æ‰§è¡ŒæŸ¥è¯¢
result = session.run_sql("SELECT id, name, email FROM users LIMIT 5")

# è½¬æ¢ä¸ºå­—å…¸åˆ—è¡¨
users = []
for row in result.fetch_all():
    user_dict = {
        'id': row[0],
        'name': row[1], 
        'email': row[2]
    }
    users.append(user_dict)

print(f"æŸ¥è¯¢åˆ° {len(users)} ä¸ªç”¨æˆ·")
```

### 4.2 æ•°æ®ç­›é€‰å’Œè½¬æ¢


**åˆ—è¡¨æ¨å¯¼å¼åº”ç”¨**ï¼š
```python
# ç­›é€‰æ´»è·ƒç”¨æˆ·
active_users = [user for user in users if user['email']]

# æå–ç”¨æˆ·ååˆ—è¡¨
usernames = [user['name'] for user in users]

# æ•°æ®è½¬æ¢
user_emails = {user['id']: user['email'] for user in users}
```

**å­—å…¸åˆå¹¶æ“ä½œ**ï¼š
```python
# åŸºç¡€ä¿¡æ¯
base_info = {'id': 1, 'name': 'John'}

# æ‰©å±•ä¿¡æ¯
ext_info = {'email': 'john@example.com', 'role': 'admin'}

# åˆå¹¶å­—å…¸
full_info = {**base_info, **ext_info}
print(full_info)
```

### 4.3 æ•°æ®åˆ†ç»„å’Œç»Ÿè®¡


**æŒ‰æ¡ä»¶åˆ†ç»„**ï¼š
```python
# æŒ‰è§’è‰²åˆ†ç»„ç”¨æˆ·
def group_users_by_role(users):
    groups = {}
    for user in users:
        role = user.get('role', 'unknown')
        if role not in groups:
            groups[role] = []
        groups[role].append(user)
    return groups

# ä½¿ç”¨åˆ†ç»„
role_groups = group_users_by_role(users)
for role, user_list in role_groups.items():
    print(f"{role}: {len(user_list)} ä¸ªç”¨æˆ·")
```

---

## 5. ğŸ“ æ–‡ä»¶æ“ä½œä¸I/Oå¤„ç†


### 5.1 åŸºæœ¬æ–‡ä»¶è¯»å†™


**è¯»å–é…ç½®æ–‡ä»¶**ï¼š
```python
# è¯»å–æ–‡æœ¬æ–‡ä»¶
def read_config_file(filename):
    try:
        with open(filename, 'r', encoding='utf-8') as file:
            content = file.read()
            return content
    except FileNotFoundError:
        print(f"é…ç½®æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return None

# ä½¿ç”¨ç¤ºä¾‹
config_content = read_config_file('mysql_config.txt')
```

**å†™å…¥æ—¥å¿—æ–‡ä»¶**ï¼š
```python
def write_log(message, log_file='mysql_shell.log'):
    """å†™å…¥æ“ä½œæ—¥å¿—"""
    from datetime import datetime
    
    timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    log_entry = f"[{timestamp}] {message}\n"
    
    with open(log_file, 'a', encoding='utf-8') as file:
        file.write(log_entry)

# è®°å½•æ“ä½œæ—¥å¿—
write_log("ç”¨æˆ·ç™»å½•æˆåŠŸ")
```

### 5.2 CSVæ–‡ä»¶å¤„ç†


**å¯¼å‡ºæŸ¥è¯¢ç»“æœåˆ°CSV**ï¼š
```python
import csv

def export_to_csv(result_set, filename):
    """å¯¼å‡ºæŸ¥è¯¢ç»“æœåˆ°CSVæ–‡ä»¶"""
    with open(filename, 'w', newline='', encoding='utf-8') as csvfile:
        writer = csv.writer(csvfile)
        
        # å†™å…¥è¡¨å¤´
        if result_set.columns:
            headers = [col.column_name for col in result_set.columns]
            writer.writerow(headers)
        
        # å†™å…¥æ•°æ®
        for row in result_set.fetch_all():
            writer.writerow(row)

# ä½¿ç”¨ç¤ºä¾‹
result = session.run_sql("SELECT * FROM users")
export_to_csv(result, 'users_export.csv')
```

**ä»CSVå¯¼å…¥æ•°æ®**ï¼š
```python
def import_from_csv(filename, table_name):
    """ä»CSVæ–‡ä»¶å¯¼å…¥æ•°æ®"""
    with open(filename, 'r', encoding='utf-8') as csvfile:
        reader = csv.DictReader(csvfile)
        
        for row in reader:
            # æ„å»ºINSERTè¯­å¥
            columns = ', '.join(row.keys())
            values = ', '.join([f"'{v}'" for v in row.values()])
            sql = f"INSERT INTO {table_name} ({columns}) VALUES ({values})"
            
            session.run_sql(sql)
```

---

## 6. ğŸ” æ­£åˆ™è¡¨è¾¾å¼åº”ç”¨


### 6.1 æ•°æ®éªŒè¯


**é‚®ç®±æ ¼å¼éªŒè¯**ï¼š
```python
import re

def validate_email(email):
    """éªŒè¯é‚®ç®±æ ¼å¼"""
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email) is not None

# æ‰¹é‡éªŒè¯
emails = ['user@example.com', 'invalid-email', 'test@domain.org']
for email in emails:
    status = "æœ‰æ•ˆ" if validate_email(email) else "æ— æ•ˆ"
    print(f"{email}: {status}")
```

**æ‰‹æœºå·æ ¼å¼æ£€æŸ¥**ï¼š
```python
def validate_phone(phone):
    """éªŒè¯ä¸­å›½æ‰‹æœºå·æ ¼å¼"""
    pattern = r'^1[3-9]\d{9}$'
    return re.match(pattern, phone) is not None

# æ¸…ç†æ— æ•ˆæ‰‹æœºå·
phone_list = ['13812345678', '12345678901', '15987654321']
valid_phones = [phone for phone in phone_list if validate_phone(phone)]
```

### 6.2 æ•°æ®æ¸…æ´—


**æå–å…³é”®ä¿¡æ¯**ï¼š
```python
def extract_sql_tables(sql_text):
    """ä»SQLè¯­å¥ä¸­æå–è¡¨å"""
    # åŒ¹é…FROMå’ŒJOINåçš„è¡¨å
    pattern = r'(?:FROM|JOIN)\s+(\w+)'
    tables = re.findall(pattern, sql_text, re.IGNORECASE)
    return list(set(tables))  # å»é‡

# ç¤ºä¾‹ä½¿ç”¨
sql = "SELECT * FROM users u JOIN orders o ON u.id = o.user_id"
tables = extract_sql_tables(sql)
print(f"æ¶‰åŠçš„è¡¨: {tables}")
```

**æ•°æ®æ ¼å¼ç»Ÿä¸€**ï¼š
```python
def normalize_phone_format(phone):
    """ç»Ÿä¸€æ‰‹æœºå·æ ¼å¼"""
    # ç§»é™¤æ‰€æœ‰éæ•°å­—å­—ç¬¦
    digits_only = re.sub(r'\D', '', phone)
    
    # æ ¼å¼åŒ–ä¸º xxx-xxxx-xxxx
    if len(digits_only) == 11:
        return f"{digits_only[:3]}-{digits_only[3:7]}-{digits_only[7:]}"
    return phone

# æ‰¹é‡å¤„ç†
raw_phones = ['138 1234 5678', '139-8765-4321', '15012345678']
formatted = [normalize_phone_format(phone) for phone in raw_phones]
```

---

## 7. âš ï¸ é”™è¯¯å¼‚å¸¸å¤„ç†æœºåˆ¶


### 7.1 æ•°æ®åº“å¼‚å¸¸å¤„ç†


**è¿æ¥å¼‚å¸¸å¤„ç†**ï¼š
```python
def safe_connect(uri):
    """å®‰å…¨è¿æ¥æ•°æ®åº“"""
    try:
        session = mysql.get_session(uri)
        print("æ•°æ®åº“è¿æ¥æˆåŠŸ")
        return session
    except mysql.Error as e:
        print(f"è¿æ¥å¤±è´¥: {e}")
        return None
    except Exception as e:
        print(f"æœªçŸ¥é”™è¯¯: {e}")
        return None

# ä½¿ç”¨ç¤ºä¾‹
session = safe_connect('root@localhost:3306')
if session:
    # æ‰§è¡Œæ•°æ®åº“æ“ä½œ
    pass
```

**SQLæ‰§è¡Œå¼‚å¸¸å¤„ç†**ï¼š
```python
def safe_execute_sql(session, sql):
    """å®‰å…¨æ‰§è¡ŒSQLè¯­å¥"""
    try:
        result = session.run_sql(sql)
        return {"success": True, "result": result}
    except mysql.Error as db_error:
        return {
            "success": False, 
            "error": f"æ•°æ®åº“é”™è¯¯: {db_error}",
            "error_code": db_error.errno
        }
    except Exception as e:
        return {
            "success": False,
            "error": f"æ‰§è¡Œé”™è¯¯: {str(e)}"
        }

# ä½¿ç”¨ç¤ºä¾‹
result = safe_execute_sql(session, "SELECT COUNT(*) FROM users")
if result["success"]:
    print("æŸ¥è¯¢æˆåŠŸ")
else:
    print(result["error"])
```

### 7.2 æ–‡ä»¶æ“ä½œå¼‚å¸¸


**æ–‡ä»¶è¯»å†™å¼‚å¸¸å¤„ç†**ï¼š
```python
def safe_file_operation(filename, operation='read', data=None):
    """å®‰å…¨çš„æ–‡ä»¶æ“ä½œ"""
    try:
        if operation == 'read':
            with open(filename, 'r', encoding='utf-8') as f:
                return f.read()
        elif operation == 'write':
            with open(filename, 'w', encoding='utf-8') as f:
                f.write(data)
                return True
    except FileNotFoundError:
        print(f"æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
    except PermissionError:
        print(f"æ²¡æœ‰æƒé™è®¿é—®æ–‡ä»¶ {filename}")
    except Exception as e:
        print(f"æ–‡ä»¶æ“ä½œå¤±è´¥: {e}")
    
    return None

# ä½¿ç”¨ç¤ºä¾‹
content = safe_file_operation('config.txt', 'read')
if content:
    print("æ–‡ä»¶è¯»å–æˆåŠŸ")
```

### 7.3 è‡ªå®šä¹‰å¼‚å¸¸ç±»


**ä¸šåŠ¡å¼‚å¸¸å®šä¹‰**ï¼š
```python
class DatabaseOperationError(Exception):
    """æ•°æ®åº“æ“ä½œå¼‚å¸¸"""
    def __init__(self, message, error_code=None):
        self.message = message
        self.error_code = error_code
        super().__init__(self.message)

def batch_insert_users(session, users):
    """æ‰¹é‡æ’å…¥ç”¨æˆ·"""
    try:
        for user in users:
            if not user.get('email'):
                raise DatabaseOperationError(
                    f"ç”¨æˆ· {user.get('name', 'Unknown')} ç¼ºå°‘é‚®ç®±ä¿¡æ¯",
                    error_code=1001
                )
            
            sql = f"INSERT INTO users (name, email) VALUES ('{user['name']}', '{user['email']}')"
            session.run_sql(sql)
            
    except DatabaseOperationError as e:
        print(f"ä¸šåŠ¡é”™è¯¯: {e.message}, é”™è¯¯ç : {e.error_code}")
    except Exception as e:
        print(f"ç³»ç»Ÿé”™è¯¯: {e}")
```

---

## 8. ğŸ“¦ æ¨¡å—å¼•ç”¨ä¸æ‰©å±•


### 8.1 å†…ç½®æ¨¡å—ä½¿ç”¨


**å¸¸ç”¨å†…ç½®æ¨¡å—**ï¼š
```python
# æ—¶é—´æ—¥æœŸæ¨¡å—
from datetime import datetime, timedelta
import time

# æ–‡ä»¶è·¯å¾„æ¨¡å—
import os
import pathlib

# æ•°æ®å¤„ç†æ¨¡å—
import json
import csv
import re

# ç³»ç»Ÿç›¸å…³æ¨¡å—
import sys
import platform
```

**å®é™…åº”ç”¨ç¤ºä¾‹**ï¼š
```python
# è·å–ç³»ç»Ÿä¿¡æ¯
def get_system_info():
    """è·å–ç³»ç»Ÿä¿¡æ¯"""
    info = {
        'platform': platform.system(),
        'python_version': sys.version,
        'current_time': datetime.now().isoformat(),
        'working_directory': os.getcwd()
    }
    return info

system_info = get_system_info()
print(json.dumps(system_info, indent=2, ensure_ascii=False))
```

### 8.2 MySQL Shell APIä½¿ç”¨


**ä¼šè¯ç®¡ç†**ï¼š
```python
# è·å–å½“å‰ä¼šè¯
current_session = shell.get_session()

# ä¼šè¯ä¿¡æ¯
if current_session:
    print(f"è¿æ¥URI: {current_session.uri}")
    print(f"è¿æ¥çŠ¶æ€: {'å·²è¿æ¥' if current_session.is_open() else 'æœªè¿æ¥'}")
```

**é›†ç¾¤æ“ä½œ**ï¼š
```python
# è¿æ¥åˆ°InnoDB Cluster
cluster = dba.get_cluster()

if cluster:
    # æŸ¥çœ‹é›†ç¾¤çŠ¶æ€
    status = cluster.status()
    print("é›†ç¾¤çŠ¶æ€:")
    print(json.dumps(status, indent=2, ensure_ascii=False))
```

### 8.3 è‡ªå®šä¹‰æ¨¡å—å°è£…


**æ•°æ®åº“å·¥å…·æ¨¡å—**ï¼š
```python
# åˆ›å»º db_utils.py æ¨¡å—
class DatabaseUtils:
    """æ•°æ®åº“å·¥å…·ç±»"""
    
    def __init__(self, session):
        self.session = session
    
    def get_table_info(self, table_name):
        """è·å–è¡¨ä¿¡æ¯"""
        sql = f"DESCRIBE {table_name}"
        result = self.session.run_sql(sql)
        
        columns = []
        for row in result.fetch_all():
            columns.append({
                'field': row[0],
                'type': row[1],
                'null': row[2],
                'key': row[3],
                'default': row[4]
            })
        return columns
    
    def backup_table_structure(self, table_name):
        """å¤‡ä»½è¡¨ç»“æ„"""
        sql = f"SHOW CREATE TABLE {table_name}"
        result = self.session.run_sql(sql)
        
        if result:
            row = result.fetch_one()
            return row[1]  # è¿”å›CREATE TABLEè¯­å¥
        return None

# ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—
db_utils = DatabaseUtils(session)
table_info = db_utils.get_table_info('users')
```

---

## 9. ğŸ“ˆ æ•°æ®åˆ†ææ“ä½œå®æˆ˜


### 9.1 æ•°æ®ç»Ÿè®¡åˆ†æ


**ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼š
```python
def analyze_user_behavior():
    """åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®"""
    # æŸ¥è¯¢ç”¨æˆ·ç™»å½•æ•°æ®
    sql = """
    SELECT 
        DATE(login_time) as login_date,
        COUNT(*) as login_count,
        COUNT(DISTINCT user_id) as unique_users
    FROM user_login_log 
    WHERE login_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)
    GROUP BY DATE(login_time)
    ORDER BY login_date
    """
    
    result = session.run_sql(sql)
    
    # æ•°æ®å¤„ç†
    daily_stats = []
    for row in result.fetch_all():
        daily_stats.append({
            'date': str(row[0]),
            'total_logins': row[1],
            'unique_users': row[2],
            'avg_logins_per_user': round(row[1] / row[2], 2) if row[2] > 0 else 0
        })
    
    return daily_stats

# æ‰§è¡Œåˆ†æ
stats = analyze_user_behavior()
for stat in stats[-7:]:  # æ˜¾ç¤ºæœ€è¿‘7å¤©
    print(f"{stat['date']}: {stat['unique_users']}ä¸ªç”¨æˆ·, {stat['total_logins']}æ¬¡ç™»å½•")
```

### 9.2 æ•°æ®è´¨é‡æ£€æŸ¥


**æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**ï¼š
```python
def check_data_quality(table_name):
    """æ£€æŸ¥æ•°æ®è´¨é‡"""
    checks = {}
    
    # 1. æ£€æŸ¥ç©ºå€¼æ¯”ä¾‹
    null_check_sql = f"""
    SELECT 
        column_name,
        SUM(CASE WHEN {table_name}.column_name IS NULL THEN 1 ELSE 0 END) as null_count,
        COUNT(*) as total_count
    FROM information_schema.columns 
    WHERE table_name = '{table_name}'
    """
    
    # 2. æ£€æŸ¥é‡å¤æ•°æ®
    duplicate_sql = f"""
    SELECT COUNT(*) - COUNT(DISTINCT id) as duplicate_count
    FROM {table_name}
    """
    
    duplicate_result = session.run_sql(duplicate_sql)
    duplicate_count = duplicate_result.fetch_one()[0]
    
    checks['duplicates'] = duplicate_count
    checks['has_duplicates'] = duplicate_count > 0
    
    return checks

# ä½¿ç”¨ç¤ºä¾‹
quality_report = check_data_quality('users')
print(f"æ•°æ®è´¨é‡æŠ¥å‘Š: {quality_report}")
```

### 9.3 æ€§èƒ½åˆ†æ


**æŸ¥è¯¢æ€§èƒ½åˆ†æ**ï¼š
```python
def analyze_query_performance(sql_query):
    """åˆ†ææŸ¥è¯¢æ€§èƒ½"""
    import time
    
    # æ‰§è¡ŒEXPLAIN
    explain_sql = f"EXPLAIN FORMAT=JSON {sql_query}"
    explain_result = session.run_sql(explain_sql)
    explain_data = json.loads(explain_result.fetch_one()[0])
    
    # æµ‹é‡æ‰§è¡Œæ—¶é—´
    start_time = time.time()
    result = session.run_sql(sql_query)
    result.fetch_all()  # è·å–æ‰€æœ‰ç»“æœ
    execution_time = time.time() - start_time
    
    # æ€§èƒ½æŠ¥å‘Š
    performance_report = {
        'execution_time_seconds': round(execution_time, 4),
        'explain_plan': explain_data,
        'query': sql_query
    }
    
    return performance_report

# ä½¿ç”¨ç¤ºä¾‹
query = "SELECT * FROM users WHERE created_at > '2025-01-01'"
perf_report = analyze_query_performance(query)
print(f"æŸ¥è¯¢è€—æ—¶: {perf_report['execution_time_seconds']} ç§’")
```

---

## 10. ğŸ¤– è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™


### 10.1 æ•°æ®åº“å¤‡ä»½è‡ªåŠ¨åŒ–


**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**ï¼š
```python
def auto_backup_database(database_name, backup_dir='/tmp/backups'):
    """è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“"""
    from datetime import datetime
    import os
    
    # åˆ›å»ºå¤‡ä»½ç›®å½•
    if not os.path.exists(backup_dir):
        os.makedirs(backup_dir)
    
    # ç”Ÿæˆå¤‡ä»½æ–‡ä»¶å
    timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
    backup_filename = f"{database_name}_backup_{timestamp}.sql"
    backup_path = os.path.join(backup_dir, backup_filename)
    
    try:
        # ä½¿ç”¨mysqldumpè¿›è¡Œå¤‡ä»½
        dump_cmd = f"mysqldump -u{session.uri.split('@')[0]} -p {database_name} > {backup_path}"
        
        # è®°å½•å¤‡ä»½æ—¥å¿—
        log_message = f"æ•°æ®åº“ {database_name} å¤‡ä»½å®Œæˆ: {backup_filename}"
        write_log(log_message)
        
        return {
            'success': True,
            'backup_file': backup_path,
            'message': log_message
        }
        
    except Exception as e:
        error_message = f"å¤‡ä»½å¤±è´¥: {str(e)}"
        write_log(error_message)
        return {
            'success': False,
            'error': error_message
        }

# æ‰§è¡Œå¤‡ä»½
backup_result = auto_backup_database('test_db')
if backup_result['success']:
    print(backup_result['message'])
else:
    print(backup_result['error'])
```

### 10.2 æ•°æ®ç›‘æ§è‡ªåŠ¨åŒ–


**æ•°æ®åº“çŠ¶æ€ç›‘æ§**ï¼š
```python
def monitor_database_status():
    """ç›‘æ§æ•°æ®åº“çŠ¶æ€"""
    monitoring_data = {}
    
    # 1. è¿æ¥æ•°ç›‘æ§
    conn_sql = "SHOW STATUS LIKE 'Threads_connected'"
    conn_result = session.run_sql(conn_sql)
    current_connections = int(conn_result.fetch_one()[1])
    
    # 2. æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡
    cache_sql = """
    SHOW STATUS WHERE Variable_name IN 
    ('Qcache_hits', 'Qcache_inserts', 'Qcache_not_cached')
    """
    cache_result = session.run_sql(cache_sql)
    
    # 3. æ…¢æŸ¥è¯¢ç»Ÿè®¡
    slow_sql = "SHOW STATUS LIKE 'Slow_queries'"
    slow_result = session.run_sql(slow_sql)
    slow_queries = int(slow_result.fetch_one()[1])
    
    # æ•´ç†ç›‘æ§æ•°æ®
    monitoring_data = {
        'timestamp': datetime.now().isoformat(),
        'connections': current_connections,
        'slow_queries': slow_queries,
        'status': 'æ­£å¸¸' if current_connections < 100 else 'è­¦å‘Š'
    }
    
    # å¦‚æœçŠ¶æ€å¼‚å¸¸ï¼Œè®°å½•å‘Šè­¦
    if monitoring_data['status'] == 'è­¦å‘Š':
        alert_message = f"æ•°æ®åº“è¿æ¥æ•°è¿‡é«˜: {current_connections}"
        write_log(f"ALERT: {alert_message}")
    
    return monitoring_data

# å®šæœŸç›‘æ§
status = monitor_database_status()
print(f"æ•°æ®åº“çŠ¶æ€: {status['status']}, å½“å‰è¿æ¥: {status['connections']}")
```

### 10.3 æ‰¹é‡æ•°æ®å¤„ç†


**æ‰¹é‡ç”¨æˆ·æ•°æ®å¤„ç†**ï¼š
```python
def batch_process_users(batch_size=1000):
    """æ‰¹é‡å¤„ç†ç”¨æˆ·æ•°æ®"""
    
    # è·å–éœ€è¦å¤„ç†çš„ç”¨æˆ·æ€»æ•°
    count_sql = "SELECT COUNT(*) FROM users WHERE status = 'pending'"
    total_users = session.run_sql(count_sql).fetch_one()[0]
    
    processed_count = 0
    batch_count = 0
    
    print(f"å¼€å§‹å¤„ç† {total_users} ä¸ªå¾…å¤„ç†ç”¨æˆ·...")
    
    while processed_count < total_users:
        batch_count += 1
        
        # åˆ†æ‰¹æŸ¥è¯¢ç”¨æˆ·
        batch_sql = f"""
        SELECT id, name, email FROM users 
        WHERE status = 'pending' 
        LIMIT {batch_size} OFFSET {processed_count}
        """
        
        batch_result = session.run_sql(batch_sql)
        batch_users = batch_result.fetch_all()
        
        if not batch_users:
            break
        
        # å¤„ç†å½“å‰æ‰¹æ¬¡
        for user in batch_users:
            user_id, name, email = user
            
            try:
                # æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®å¤„ç†ï¼ˆä¾‹å¦‚ï¼šå‘é€æ¬¢è¿é‚®ä»¶ï¼‰
                process_single_user(user_id, name, email)
                
                # æ›´æ–°ç”¨æˆ·çŠ¶æ€
                update_sql = f"UPDATE users SET status = 'processed' WHERE id = {user_id}"
                session.run_sql(update_sql)
                
            except Exception as e:
                error_log = f"å¤„ç†ç”¨æˆ· {user_id} å¤±è´¥: {str(e)}"
                write_log(error_log)
        
        processed_count += len(batch_users)
        progress = (processed_count / total_users) * 100
        print(f"æ‰¹æ¬¡ {batch_count} å®Œæˆ, è¿›åº¦: {progress:.1f}%")
    
    print(f"æ‰¹é‡å¤„ç†å®Œæˆï¼Œå…±å¤„ç† {processed_count} ä¸ªç”¨æˆ·")

def process_single_user(user_id, name, email):
    """å¤„ç†å•ä¸ªç”¨æˆ·"""
    # è¿™é‡Œå®ç°å…·ä½“çš„ç”¨æˆ·å¤„ç†é€»è¾‘
    # ä¾‹å¦‚ï¼šæ•°æ®éªŒè¯ã€æ ¼å¼åŒ–ã€å‘é€é€šçŸ¥ç­‰
    if validate_email(email):
        print(f"ç”¨æˆ· {name} ({email}) å¤„ç†å®Œæˆ")
    else:
        raise Exception(f"é‚®ç®±æ ¼å¼æ— æ•ˆ: {email}")

# æ‰§è¡Œæ‰¹é‡å¤„ç†
batch_process_users(500)
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ Pythonæ¨¡å¼æœ¬è´¨ï¼šMySQL Shell + Pythonç¼–ç¨‹ç¯å¢ƒçš„ç»“åˆ
ğŸ”¸ æ ¸å¿ƒä¼˜åŠ¿ï¼šç¼–ç¨‹çµæ´»æ€§ + æ•°æ®åº“æ“ä½œèƒ½åŠ› + è‡ªåŠ¨åŒ–æ”¯æŒ
ğŸ”¸ åŸºæœ¬è¯­æ³•ï¼šå®Œæ•´æ”¯æŒPython 3.xæ ‡å‡†è¯­æ³•
ğŸ”¸ æ•°æ®å¤„ç†ï¼šå¼ºå¤§çš„å­—å…¸ã€åˆ—è¡¨æ“ä½œèƒ½åŠ›
ğŸ”¸ å¼‚å¸¸å¤„ç†ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•æœºåˆ¶
ğŸ”¸ æ¨¡å—æ‰©å±•ï¼šå†…ç½®æ¨¡å— + MySQL API + è‡ªå®šä¹‰å°è£…
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Pythonæ¨¡å¼çš„ä»·å€¼**
```
ä¼ ç»ŸSQLçš„å±€é™æ€§ï¼š
- åªèƒ½æ‰§è¡Œå•ä¸€æŸ¥è¯¢
- é€»è¾‘å¤„ç†èƒ½åŠ›æœ‰é™
- éš¾ä»¥å®ç°å¤æ‚ä¸šåŠ¡

Pythonæ¨¡å¼çš„ä¼˜åŠ¿ï¼š
- ç¼–ç¨‹é€»è¾‘ + æ•°æ®åº“æ“ä½œ
- ä¸°å¯Œçš„æ•°æ®å¤„ç†èƒ½åŠ›
- è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™
- ç¬¬ä¸‰æ–¹åº“ç”Ÿæ€æ”¯æŒ
```

**ğŸ”¹ å®é™…åº”ç”¨åœºæ™¯**
```
æ•°æ®åˆ†æï¼š
- å¤æ‚ç»Ÿè®¡è®¡ç®—
- æ•°æ®è´¨é‡æ£€æŸ¥
- æ€§èƒ½åˆ†ææŠ¥å‘Š

è‡ªåŠ¨åŒ–è¿ç»´ï¼š
- å®šæ—¶å¤‡ä»½è„šæœ¬
- ç›‘æ§å‘Šè­¦ç³»ç»Ÿ
- æ‰¹é‡æ•°æ®å¤„ç†

æ•°æ®è¿ç§»ï¼š
- ETLæ•°æ®è½¬æ¢
- æ ¼å¼åŒ–å¤„ç†
- æ•°æ®éªŒè¯æ¸…æ´—
```

### 11.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ”§ ä»£ç ç¼–å†™è§„èŒƒ**
```python
# 1. ä½¿ç”¨å¼‚å¸¸å¤„ç†
try:
    result = session.run_sql(sql)
except Exception as e:
    print(f"æ‰§è¡Œå¤±è´¥: {e}")

# 2. å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆé¿å…SQLæ³¨å…¥ï¼‰
sql = "SELECT * FROM users WHERE id = ?"
result = session.run_sql(sql, [user_id])

# 3. èµ„æºæ¸…ç†
try:
    # æ•°æ®åº“æ“ä½œ
    pass
finally:
    if session:
        session.close()
```

**ğŸ“ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
```
æ‰¹é‡æ“ä½œï¼š
- åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
- é¿å…ä¸€æ¬¡æ€§åŠ è½½è¿‡å¤šè®°å½•
- ä½¿ç”¨äº‹åŠ¡æé«˜æ•ˆç‡

å†…å­˜ç®¡ç†ï¼š
- åŠæ—¶é‡Šæ”¾å¤§å‹ç»“æœé›†
- ä½¿ç”¨ç”Ÿæˆå™¨å¤„ç†å¤§æ•°æ®
- é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶

è¿æ¥ç®¡ç†ï¼š
- å¤ç”¨æ•°æ®åº“è¿æ¥
- åˆç†è®¾ç½®è¿æ¥è¶…æ—¶
- åŠæ—¶å…³é—­ä¸ç”¨çš„è¿æ¥
```

### 11.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š è¿›é˜¶å­¦ä¹ é¡ºåº**
```
åŸºç¡€é˜¶æ®µï¼š
1. æŒæ¡PythonåŸºæœ¬è¯­æ³•
2. äº†è§£MySQL Shell API
3. ç»ƒä¹ ç®€å•æ•°æ®åº“æ“ä½œ

ä¸­çº§é˜¶æ®µï¼š
4. å­¦ä¹ å¼‚å¸¸å¤„ç†æœºåˆ¶
5. æŒæ¡æ–‡ä»¶å’Œæ•°æ®å¤„ç†
6. ç¼–å†™ç®€å•è‡ªåŠ¨åŒ–è„šæœ¬

é«˜çº§é˜¶æ®µï¼š
7. æ·±å…¥æ•°æ®åˆ†ææŠ€å·§
8. å¤æ‚è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘
9. æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§ç³»ç»Ÿ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- MySQL Shell Pythonæ¨¡å¼ = æ•°æ®åº“æ“ä½œ + Pythonç¼–ç¨‹èƒ½åŠ›
- é‡ç‚¹åœ¨äºæ•°æ®å¤„ç†ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€å¼‚å¸¸å¤„ç†
- å®é™…åº”ç”¨ä»·å€¼ï¼šæ•°æ®åˆ†æã€è¿ç»´è‡ªåŠ¨åŒ–ã€ETLå¤„ç†
- å­¦ä¹ å…³é”®ï¼šå¤šç»ƒä¹ ã€é‡å®æˆ˜ã€æ³¨é‡é”™è¯¯å¤„ç†