---
title: 44ã€å¤šç¯å¢ƒé…ç½®ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [å¤šç¯å¢ƒé…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ](#1-å¤šç¯å¢ƒé…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ)
2. [å¼€å‘ç¯å¢ƒé…ç½®ç­–ç•¥](#2-å¼€å‘ç¯å¢ƒé…ç½®ç­–ç•¥)
3. [æµ‹è¯•ç¯å¢ƒé…ç½®ç®¡ç†](#3-æµ‹è¯•ç¯å¢ƒé…ç½®ç®¡ç†)
4. [é¢„å‘å¸ƒç¯å¢ƒé…ç½®](#4-é¢„å‘å¸ƒç¯å¢ƒé…ç½®)
5. [ç”Ÿäº§ç¯å¢ƒé…ç½®è§„èŒƒ](#5-ç”Ÿäº§ç¯å¢ƒé…ç½®è§„èŒƒ)
6. [é…ç½®ç¯å¢ƒéš”ç¦»æœºåˆ¶](#6-é…ç½®ç¯å¢ƒéš”ç¦»æœºåˆ¶)
7. [é…ç½®æ¨¡æ¿åŒ–ç®¡ç†](#7-é…ç½®æ¨¡æ¿åŒ–ç®¡ç†)
8. [é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²](#8-é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ å¤šç¯å¢ƒé…ç½®ç®¡ç†åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¤šç¯å¢ƒé…ç½®ç®¡ç†


**ç®€å•ç†è§£**ï¼šå°±åƒæˆ‘ä»¬å¼€å‘è½¯ä»¶éœ€è¦åœ¨ä¸åŒçš„"é˜¶æ®µ"æµ‹è¯•ä¸€æ ·ï¼ŒMySQLæ•°æ®åº“ä¹Ÿéœ€è¦åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚

```
ç°å®ç±»æ¯”ï¼š
å°±åƒä¸€è¾†æ±½è½¦ï¼š
ğŸš— æµ‹è¯•åœºåœ°ï¼šå®‰å…¨ç¬¬ä¸€ï¼Œé€Ÿåº¦ä¸é‡è¦
ğŸ èµ›è½¦åœºï¼šæ€§èƒ½ç¬¬ä¸€ï¼Œè¿½æ±‚æé™
ğŸ›£ï¸ æ—¥å¸¸é“è·¯ï¼šå¹³è¡¡å®‰å…¨å’Œæ€§èƒ½

MySQLç¯å¢ƒä¹Ÿç±»ä¼¼ï¼š
ğŸ’» å¼€å‘ç¯å¢ƒï¼šæ–¹ä¾¿è°ƒè¯•ï¼Œæ€§èƒ½è¦æ±‚ä½
ğŸ§ª æµ‹è¯•ç¯å¢ƒï¼šæ¨¡æ‹ŸçœŸå®ï¼Œç¨³å®šå¯é 
ğŸš€ ç”Ÿäº§ç¯å¢ƒï¼šé«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨
```

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦å¤šç¯å¢ƒé…ç½®


**æ ¸å¿ƒé—®é¢˜**ï¼šä¸åŒç¯å¢ƒçš„éœ€æ±‚å®Œå…¨ä¸åŒ

```
ğŸ”¸ å¼€å‘ç¯å¢ƒéœ€æ±‚ï¼š
- å¿«é€Ÿé‡å¯MySQL
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- å®½æ¾çš„å®‰å…¨è®¾ç½®
- å°çš„å†…å­˜å ç”¨

ğŸ”¸ ç”Ÿäº§ç¯å¢ƒéœ€æ±‚ï¼š
- æœ€ä¼˜æ€§èƒ½é…ç½®
- ä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶
- å¤§ç¼“å­˜æ± è®¾ç½®
- å®Œå–„çš„ç›‘æ§æ—¥å¿—
```

### 1.3 ç¯å¢ƒåˆ†ç±»ä¸ç‰¹ç‚¹


```
ç¯å¢ƒç±»å‹å¯¹æ¯”ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç¯å¢ƒ     â”‚  ä¸»è¦ç›®çš„  â”‚  æ€§èƒ½è¦æ±‚  â”‚  å®‰å…¨è¦æ±‚  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼€å‘(DEV)   â”‚ åŠŸèƒ½å¼€å‘   â”‚    ä½      â”‚    ä½      â”‚
â”‚ æµ‹è¯•(TEST)  â”‚ åŠŸèƒ½éªŒè¯   â”‚    ä¸­      â”‚    ä¸­      â”‚
â”‚ é¢„å‘(UAT)   â”‚ ä¸Šçº¿éªŒè¯   â”‚    é«˜      â”‚    é«˜      â”‚
â”‚ ç”Ÿäº§(PROD)  â”‚ æ­£å¼æœåŠ¡   â”‚   æé«˜     â”‚   æé«˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ’» å¼€å‘ç¯å¢ƒé…ç½®ç­–ç•¥


### 2.1 å¼€å‘ç¯å¢ƒçš„æ ¸å¿ƒç‰¹ç‚¹


**è®¾è®¡æ€è·¯**ï¼šä¼˜å…ˆè€ƒè™‘å¼€å‘æ•ˆç‡ï¼Œè€Œä¸æ˜¯æ€§èƒ½

```
å¼€å‘ç¯å¢ƒå°±åƒä½ çš„ç§äººå·¥ä½œå°ï¼š
- å¯ä»¥éšæ„è°ƒæ•´
- å‡ºé”™äº†å¯ä»¥å¿«é€Ÿé‡æ¥
- é‡ç‚¹æ˜¯æ–¹ä¾¿è°ƒè¯•
- ä¸éœ€è¦è€ƒè™‘é«˜å¹¶å‘
```

### 2.2 å¼€å‘ç¯å¢ƒé…ç½®å‚æ•°


**ğŸ“‹ å¼€å‘ç¯å¢ƒmy.cnfæ ¸å¿ƒé…ç½®**

```ini
[mysqld]
# === åŸºç¡€è®¾ç½® ===
port = 3306
bind-address = 127.0.0.1  # åªå…è®¸æœ¬åœ°è¿æ¥

# === æ€§èƒ½è®¾ç½®(åå‘å¿«é€Ÿå¯åŠ¨) ===
innodb_buffer_pool_size = 128M     # å¼€å‘æœºå†…å­˜æœ‰é™
innodb_log_file_size = 32M         # å°æ—¥å¿—æ–‡ä»¶ï¼Œå¿«é€Ÿå¯åŠ¨
innodb_flush_log_at_trx_commit = 2 # ä¸å¼ºåˆ¶åˆ·ç›˜ï¼Œæå‡æ€§èƒ½

# === è°ƒè¯•è®¾ç½® ===
log_error = /var/log/mysql/error.log
general_log = ON                    # å¼€å¯é€šç”¨æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•
general_log_file = /var/log/mysql/general.log
slow_query_log = ON                 # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 1                 # 1ç§’ä»¥ä¸Šç®—æ…¢æŸ¥è¯¢

# === å¼€å‘å‹å¥½è®¾ç½® ===
sql_mode = ''                       # å®½æ¾æ¨¡å¼ï¼Œå…¼å®¹æ€§å¥½
max_connections = 50                # å¤Ÿç”¨å³å¯
wait_timeout = 300                  # 5åˆ†é’Ÿè¶…æ—¶
```

### 2.3 å¼€å‘ç¯å¢ƒé…ç½®è¦ç‚¹


**ğŸ¯ é…ç½®åŸåˆ™**

```markdown
âœ… **ä¼˜å…ˆçº§æ’åº**
1. æ–¹ä¾¿è°ƒè¯• > æ€§èƒ½ä¼˜åŒ–
2. å¿«é€Ÿé‡å¯ > æ•°æ®å®‰å…¨
3. è¯¦ç»†æ—¥å¿— > ç£ç›˜ç©ºé—´
4. å®½æ¾æ¨¡å¼ > ä¸¥æ ¼æ£€æŸ¥

âš ï¸ **æ³¨æ„äº‹é¡¹**
- å¯†ç å¯ä»¥ç®€å•ï¼Œä½†ä¸èƒ½ä¸ºç©º
- æ—¥å¿—è¦è¯¦ç»†ï¼Œä½†å®šæœŸæ¸…ç†
- å†…å­˜è®¾ç½®è¦é€‚ä¸­ï¼Œåˆ«æŠŠå¼€å‘æœºå¡æ­»
```

**ğŸ’¡ å¼€å‘ç¯å¢ƒå°æŠ€å·§**

```ini
# å¼€å‘æ—¶ç»å¸¸éœ€è¦é‡ç½®æ•°æ®
[mysqld]
# è·³è¿‡å¤–é”®æ£€æŸ¥ï¼Œæ–¹ä¾¿åˆ é™¤æµ‹è¯•æ•°æ®
foreign_key_checks = 0

# å…è®¸ä»ä»»æ„ä½ç½®å¯¼å…¥æ•°æ®
secure_file_priv = ""

# å¤§åŒ…å¯¼å…¥è®¾ç½®
max_allowed_packet = 64M
```

---

## 3. ğŸ§ª æµ‹è¯•ç¯å¢ƒé…ç½®ç®¡ç†


### 3.1 æµ‹è¯•ç¯å¢ƒçš„å®šä½


**æ ¸å¿ƒä½œç”¨**ï¼šæ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒï¼ŒéªŒè¯åŠŸèƒ½æ­£ç¡®æ€§

```
æµ‹è¯•ç¯å¢ƒå°±åƒæ±½è½¦çš„è¯•é©¾ï¼š
ğŸš— è¦å°½å¯èƒ½æ¥è¿‘çœŸå®é©¾é©¶ç¯å¢ƒ
ğŸ›£ï¸ è¦æµ‹è¯•å„ç§è·¯å†µå’Œæƒ…å†µ
ğŸ” è¦ä»”ç»†æ£€æŸ¥æ¯ä¸ªåŠŸèƒ½
âš ï¸ å‘ç°é—®é¢˜è¦åŠæ—¶ä¿®å¤
```

### 3.2 æµ‹è¯•ç¯å¢ƒé…ç½®ç‰¹ç‚¹


**ğŸ”¸ é…ç½®ç­–ç•¥**

```ini
[mysqld]
# === åŸºç¡€è®¾ç½® ===
port = 3306
bind-address = 0.0.0.0              # å…è®¸æµ‹è¯•å›¢é˜Ÿè¿æ¥

# === æ€§èƒ½è®¾ç½®(æ¥è¿‘ç”Ÿäº§) ===
innodb_buffer_pool_size = 512M      # é€‚ä¸­çš„ç¼“å­˜
innodb_log_file_size = 128M         
innodb_flush_log_at_trx_commit = 1  # ä¸¥æ ¼æ¨¡å¼

# === æµ‹è¯•ä¸“ç”¨è®¾ç½® ===
log_bin = mysql-bin                 # å¼€å¯binlogæµ‹è¯•
binlog_format = ROW                 # è¡Œæ ¼å¼ï¼Œä¾¿äºæ•°æ®å¯¹æ¯”
expire_logs_days = 3                # æ—¥å¿—ä¿ç•™3å¤©

# === ç›‘æ§è®¾ç½® ===
performance_schema = ON             # å¼€å¯æ€§èƒ½ç›‘æ§
slow_query_log = ON
long_query_time = 2                 # 2ç§’ç®—æ…¢æŸ¥è¯¢

# === å®‰å…¨è®¾ç½®(ä¸­ç­‰ä¸¥æ ¼) ===
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO
max_connections = 200
```

### 3.3 æµ‹è¯•ç¯å¢ƒæ•°æ®ç®¡ç†


**ğŸ“Š æµ‹è¯•æ•°æ®ç­–ç•¥**

```
æµ‹è¯•æ•°æ®ç”Ÿå‘½å‘¨æœŸï¼š

å‡†å¤‡é˜¶æ®µ          æ‰§è¡Œé˜¶æ®µ          æ¸…ç†é˜¶æ®µ
    â†“                â†“                â†“
å¯¼å…¥åŸºç¡€æ•°æ®  â†’  æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹  â†’  é‡ç½®ç¯å¢ƒæ•°æ®
    â†“                â†“                â†“
æ ‡å‡†æ•°æ®é›†      ä¸šåŠ¡åœºæ™¯æµ‹è¯•      æ¢å¤åˆå§‹çŠ¶æ€
```

**ğŸ”§ æµ‹è¯•ç¯å¢ƒé‡ç½®è„šæœ¬**

```bash
#!/bin/bash
# test_env_reset.sh - æµ‹è¯•ç¯å¢ƒé‡ç½®è„šæœ¬

echo "å¼€å§‹é‡ç½®æµ‹è¯•ç¯å¢ƒ..."

# 1. åœæ­¢åº”ç”¨æœåŠ¡
systemctl stop app-service

# 2. å¤‡ä»½å½“å‰æ•°æ®(å¯é€‰)
mysqldump -u root -p test_db > /backup/test_db_$(date +%Y%m%d_%H%M%S).sql

# 3. é‡ç½®æ•°æ®åº“
mysql -u root -p << EOF
DROP DATABASE IF EXISTS test_db;
CREATE DATABASE test_db CHARACTER SET utf8mb4;
USE test_db;
SOURCE /data/test_base_data.sql;
EOF

# 4. é‡å¯æœåŠ¡
systemctl start mysql
systemctl start app-service

echo "æµ‹è¯•ç¯å¢ƒé‡ç½®å®Œæˆï¼"
```

---

## 4. ğŸ­ é¢„å‘å¸ƒç¯å¢ƒé…ç½®


### 4.1 é¢„å‘å¸ƒç¯å¢ƒçš„é‡è¦æ€§


**å…³é”®ä½œç”¨**ï¼šæœ€åä¸€é“"è´¨é‡å…³"ï¼Œç¡®ä¿ä¸Šçº¿ä¸‡æ— ä¸€å¤±

```
é¢„å‘å¸ƒç¯å¢ƒå°±åƒæœ€åçš„å½©æ’ï¼š
ğŸ­ æ¼”å‘˜ã€é“å…·ã€ç¯å…‰éƒ½è¦å’Œæ­£å¼æ¼”å‡ºä¸€æ¨¡ä¸€æ ·
ğŸ¬ è¦æ¨¡æ‹ŸçœŸå®è§‚ä¼—çš„ååº”
ğŸ” å‘ç°ä»»ä½•é—®é¢˜éƒ½è¦ç«‹å³ä¿®å¤
âœ… åªæœ‰å½©æ’å®Œç¾ï¼Œæ‰èƒ½æ­£å¼ä¸Šå°
```

### 4.2 é¢„å‘å¸ƒç¯å¢ƒé…ç½®è¦æ±‚


**ğŸ”¸ æ ¸å¿ƒåŸåˆ™ï¼šä¸ç”Ÿäº§ç¯å¢ƒé«˜åº¦ä¸€è‡´**

```ini
[mysqld]
# === ä¸ç”Ÿäº§ç¯å¢ƒå®Œå…¨ä¸€è‡´çš„é…ç½® ===
port = 3306
bind-address = 0.0.0.0

# === å†…å­˜é…ç½®(æŒ‰ç”Ÿäº§ç¯å¢ƒæ¯”ä¾‹ç¼©å‡) ===
innodb_buffer_pool_size = 2G        # ç”Ÿäº§ç¯å¢ƒçš„50-70%
innodb_log_file_size = 256M         # ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
innodb_flush_log_at_trx_commit = 1  # ä¸¥æ ¼æ¨¡å¼

# === å¤åˆ¶é…ç½®(å¦‚æœéœ€è¦) ===
log_bin = mysql-bin
binlog_format = ROW
sync_binlog = 1

# === å®‰å…¨é…ç½®(ä¸ç”Ÿäº§ä¸€è‡´) ===
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ZERO_DATE,NO_ZERO_IN_DATE
max_connections = 500               # ç•¥ä½äºç”Ÿäº§ç¯å¢ƒ

# === ç›‘æ§é…ç½® ===
performance_schema = ON
slow_query_log = ON
long_query_time = 1                 # æ¯”ç”Ÿäº§ç¯å¢ƒæ›´æ•æ„Ÿ
```

### 4.3 é¢„å‘å¸ƒç¯å¢ƒéªŒè¯æ¸…å•


**âœ… ä¸Šçº¿å‰æ£€æŸ¥é¡¹ç›®**

```markdown
ğŸ“‹ **æ€§èƒ½éªŒè¯**
- [ ] æŸ¥è¯¢å“åº”æ—¶é—´ç¬¦åˆé¢„æœŸ
- [ ] å†…å­˜ä½¿ç”¨ç‡åœ¨å®‰å…¨èŒƒå›´
- [ ] ç£ç›˜IOæ€§èƒ½æ»¡è¶³éœ€æ±‚
- [ ] è¿æ¥æ•°èƒ½å¤Ÿæ”¯æ’‘é¢„æœŸè´Ÿè½½

ğŸ“‹ **åŠŸèƒ½éªŒè¯**
- [ ] ä¸»è¦ä¸šåŠ¡æµç¨‹æ­£å¸¸
- [ ] æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡
- [ ] å¤‡ä»½æ¢å¤åŠŸèƒ½æ­£å¸¸
- [ ] ç›‘æ§å‘Šè­¦åŠŸèƒ½æœ‰æ•ˆ

ğŸ“‹ **å®‰å…¨éªŒè¯**
- [ ] ç”¨æˆ·æƒé™è®¾ç½®æ­£ç¡®
- [ ] ç½‘ç»œè®¿é—®æ§åˆ¶æœ‰æ•ˆ
- [ ] æ•æ„Ÿæ•°æ®åŠ å¯†æ­£å¸¸
- [ ] å®¡è®¡æ—¥å¿—è®°å½•å®Œæ•´
```

---

## 5. ğŸš€ ç”Ÿäº§ç¯å¢ƒé…ç½®è§„èŒƒ


### 5.1 ç”Ÿäº§ç¯å¢ƒé…ç½®åŸåˆ™


**æ ¸å¿ƒç†å¿µ**ï¼šç¨³å®šæ€§å’Œæ€§èƒ½å¹¶é‡ï¼Œå®‰å…¨æ€§ä¼˜å…ˆ

```
ç”Ÿäº§ç¯å¢ƒå°±åƒèˆªç©ºå…¬å¸çš„å®¢æœºï¼š
âœˆï¸ å®‰å…¨æ˜¯ç¬¬ä¸€è¦åŠ¡ï¼Œä¸èƒ½å‡ºä»»ä½•å·®é”™
âš¡ æ€§èƒ½è¦è¶³å¤Ÿå¥½ï¼Œæ»¡è¶³ä¹˜å®¢éœ€æ±‚
ğŸ”§ æ‰€æœ‰ç³»ç»Ÿéƒ½è¦æœ‰å¤‡ä»½å’Œå†—ä½™
ğŸ“Š å®æ—¶ç›‘æ§æ¯ä¸€ä¸ªæŒ‡æ ‡
```

### 5.2 ç”Ÿäº§ç¯å¢ƒæ ‡å‡†é…ç½®


**ğŸ”¸ é«˜æ€§èƒ½ç”Ÿäº§é…ç½®æ¨¡æ¿**

```ini
[mysqld]
# === åŸºç¡€é…ç½® ===
port = 3306
bind-address = 0.0.0.0
socket = /var/lib/mysql/mysql.sock
pid-file = /var/lib/mysql/mysql.pid

# === å†…å­˜é…ç½®(æ ¸å¿ƒä¼˜åŒ–) ===
innodb_buffer_pool_size = 8G        # ç‰©ç†å†…å­˜çš„70-80%
innodb_buffer_pool_instances = 8    # å¤šå®ä¾‹æå‡å¹¶å‘
innodb_log_file_size = 512M         # å¤§æ—¥å¿—æ–‡ä»¶
innodb_log_buffer_size = 16M        # å¤§æ—¥å¿—ç¼“å†²

# === ä¸¥æ ¼æ•°æ®å®‰å…¨ ===
innodb_flush_log_at_trx_commit = 1  # æ¯æ¬¡äº‹åŠ¡éƒ½åˆ·ç›˜
sync_binlog = 1                     # åŒæ­¥binlog
innodb_doublewrite = ON             # åŒå†™ç¼“å†²

# === è¿æ¥é…ç½® ===
max_connections = 1000              # æ”¯æŒé«˜å¹¶å‘
max_connect_errors = 1000000        # é˜²æ­¢è¯¯å°IP
wait_timeout = 600                  # 10åˆ†é’Ÿè¶…æ—¶
interactive_timeout = 600

# === æŸ¥è¯¢ä¼˜åŒ– ===
query_cache_type = OFF              # å…³é—­æŸ¥è¯¢ç¼“å­˜(5.7+æ¨è)
tmp_table_size = 64M
max_heap_table_size = 64M

# === æ—¥å¿—é…ç½® ===
log_bin = /var/log/mysql/mysql-bin
binlog_format = ROW
expire_logs_days = 7
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# === å®‰å…¨é…ç½® ===
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
local_infile = OFF                  # ç¦æ­¢æœ¬åœ°æ–‡ä»¶å¯¼å…¥
```

### 5.3 ç”Ÿäº§ç¯å¢ƒå®‰å…¨è®¾ç½®


**ğŸ”’ å®‰å…¨é…ç½®è¦ç‚¹**

```ini
# === ç”¨æˆ·æƒé™æ§åˆ¶ ===
[mysqld]
# ç¦ç”¨å±é™©åŠŸèƒ½
local_infile = OFF
secure_file_priv = "/var/lib/mysql-files/"

# ç½‘ç»œå®‰å…¨
bind-address = å†…ç½‘IP               # ä¸è¦ä½¿ç”¨0.0.0.0
skip-networking = OFF              # éœ€è¦ç½‘ç»œè¿æ¥æ—¶

# å¯†ç ç­–ç•¥(MySQL 8.0+)
validate_password.policy = STRONG
validate_password.length = 12
```

**ğŸ‘¤ ç”¨æˆ·æƒé™æœ€ä½³å®è·µ**

```sql
-- åº”ç”¨ç¨‹åºç”¨æˆ·(æœ€å°æƒé™åŸåˆ™)
CREATE USER 'app_user'@'%' IDENTIFIED BY 'strong_password_123!';
GRANT SELECT, INSERT, UPDATE, DELETE ON app_db.* TO 'app_user'@'%';

-- åªè¯»ç”¨æˆ·(ç”¨äºæŠ¥è¡¨æŸ¥è¯¢)
CREATE USER 'readonly_user'@'%' IDENTIFIED BY 'readonly_pass_456!';
GRANT SELECT ON app_db.* TO 'readonly_user'@'%';

-- å¤‡ä»½ç”¨æˆ·
CREATE USER 'backup_user'@'localhost' IDENTIFIED BY 'backup_pass_789!';
GRANT SELECT, LOCK TABLES, SHOW VIEW, EVENT, TRIGGER ON *.* TO 'backup_user'@'localhost';
```

---

## 6. ğŸ”§ é…ç½®ç¯å¢ƒéš”ç¦»æœºåˆ¶


### 6.1 ä»€ä¹ˆæ˜¯é…ç½®ç¯å¢ƒéš”ç¦»


**ç®€å•ç†è§£**ï¼šè®©ä¸åŒç¯å¢ƒçš„é…ç½®äº’ä¸å¹²æ‰°ï¼Œå°±åƒä½åœ¨ä¸åŒæˆ¿é—´çš„äººå„è‡ªç®¡ç†è‡ªå·±çš„ç‰©å“

```
éš”ç¦»æœºåˆ¶çš„ä½œç”¨ï¼š

ğŸ  ç‰©ç†éš”ç¦»ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æœåŠ¡å™¨
ğŸ“‚ é€»è¾‘éš”ç¦»ï¼šç›¸åŒæœåŠ¡å™¨ä¸Šä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶
ğŸ” æƒé™éš”ç¦»ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ç”¨æˆ·æƒé™
ğŸ“¦ æ•°æ®éš”ç¦»ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ•°æ®åº“å®ä¾‹
```

### 6.2 é…ç½®æ–‡ä»¶éš”ç¦»ç­–ç•¥


**ğŸ“ æ–‡ä»¶ç»„ç»‡ç»“æ„**

```
é…ç½®æ–‡ä»¶ç›®å½•ç»“æ„ï¼š
/etc/mysql/
â”œâ”€â”€ my.cnf                          # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ conf.d/                         # é€šç”¨é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ base.cnf                    # åŸºç¡€é…ç½®
â”‚   â””â”€â”€ security.cnf                # å®‰å…¨é…ç½®
â””â”€â”€ environments/                   # ç¯å¢ƒç‰¹å®šé…ç½®
    â”œâ”€â”€ dev.cnf                     # å¼€å‘ç¯å¢ƒ
    â”œâ”€â”€ test.cnf                    # æµ‹è¯•ç¯å¢ƒ
    â”œâ”€â”€ uat.cnf                     # é¢„å‘å¸ƒç¯å¢ƒ
    â””â”€â”€ prod.cnf                    # ç”Ÿäº§ç¯å¢ƒ
```

**ğŸ”¸ ä¸»é…ç½®æ–‡ä»¶ç¤ºä¾‹**

```ini
# /etc/mysql/my.cnf
[mysqld]
# å¼•å…¥åŸºç¡€é…ç½®
!includedir /etc/mysql/conf.d/

# æ ¹æ®ç¯å¢ƒå˜é‡å¼•å…¥å¯¹åº”é…ç½®
# åœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®ï¼šexport MYSQL_ENV=prod
!include /etc/mysql/environments/${MYSQL_ENV}.cnf
```

### 6.3 ç¯å¢ƒåˆ‡æ¢æœºåˆ¶


**ğŸ”„ é…ç½®åˆ‡æ¢è„šæœ¬**

```bash
#!/bin/bash
# switch_env.sh - MySQLç¯å¢ƒé…ç½®åˆ‡æ¢è„šæœ¬

MYSQL_CONFIG_DIR="/etc/mysql"
ENVIRONMENT=$1

if [ -z "$ENVIRONMENT" ]; then
    echo "ç”¨æ³•: $0 [dev|test|uat|prod]"
    exit 1
fi

# æ£€æŸ¥ç¯å¢ƒé…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "${MYSQL_CONFIG_DIR}/environments/${ENVIRONMENT}.cnf" ]; then
    echo "é”™è¯¯: ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸å­˜åœ¨: ${ENVIRONMENT}.cnf"
    exit 1
fi

# å¤‡ä»½å½“å‰é…ç½®
cp ${MYSQL_CONFIG_DIR}/my.cnf ${MYSQL_CONFIG_DIR}/my.cnf.backup

# ç”Ÿæˆæ–°çš„ä¸»é…ç½®æ–‡ä»¶
cat > ${MYSQL_CONFIG_DIR}/my.cnf << EOF
[mysqld]
# åŸºç¡€é…ç½®
!includedir ${MYSQL_CONFIG_DIR}/conf.d/

# å½“å‰ç¯å¢ƒ: ${ENVIRONMENT}
!include ${MYSQL_CONFIG_DIR}/environments/${ENVIRONMENT}.cnf
EOF

echo "å·²åˆ‡æ¢åˆ°${ENVIRONMENT}ç¯å¢ƒé…ç½®"
echo "è¯·é‡å¯MySQLæœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ: systemctl restart mysql"
```

### 6.4 é…ç½®å‚æ•°ç¯å¢ƒå·®å¼‚


**ğŸ“Š å…³é”®å‚æ•°ç¯å¢ƒå¯¹æ¯”**

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | é¢„å‘å¸ƒç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|------------|----------|
| `innodb_buffer_pool_size` | 128M | 512M | 2G | 8G |
| `max_connections` | 50 | 200 | 500 | 1000 |
| `slow_query_time` | 1 | 2 | 1 | 2 |
| `log_level` | è¯¦ç»† | æ ‡å‡† | æ ‡å‡† | è­¦å‘Š+ |
| `sql_mode` | å®½æ¾ | æ ‡å‡† | ä¸¥æ ¼ | ä¸¥æ ¼ |

**ğŸ’¡ å‚æ•°å·®å¼‚åŒ–ç®¡ç†**

```ini
# environments/dev.cnf
[mysqld]
innodb_buffer_pool_size = 128M
general_log = ON
sql_mode = ''
long_query_time = 1

# environments/prod.cnf  
[mysqld]
innodb_buffer_pool_size = 8G
general_log = OFF
sql_mode = STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO
long_query_time = 2
```

---

## 7. ğŸ“ é…ç½®æ¨¡æ¿åŒ–ç®¡ç†


### 7.1 ä»€ä¹ˆæ˜¯é…ç½®æ¨¡æ¿åŒ–


**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæŠŠé…ç½®æ–‡ä»¶å˜æˆ"æ¨¡æ¿"ï¼Œé€šè¿‡å˜é‡æ¥é€‚åº”ä¸åŒç¯å¢ƒ

```
æ¨¡æ¿åŒ–å°±åƒåˆ¶ä½œè¡£æœçš„çº¸æ ·ï¼š
ğŸ‘” ä¸€ä¸ªçº¸æ ·å¯ä»¥åšå‡ºä¸åŒå°ºç çš„è¡£æœ
ğŸ“ é€šè¿‡è°ƒæ•´å‚æ•°é€‚åº”ä¸åŒçš„éœ€æ±‚
ğŸ­ æ ‡å‡†åŒ–ç”Ÿäº§ï¼Œå‡å°‘å‡ºé”™
â™»ï¸ å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œæé«˜æ•ˆç‡
```

### 7.2 é…ç½®æ¨¡æ¿è®¾è®¡


**ğŸ”¸ æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹**

```ini
# my.cnf.template - MySQLé…ç½®æ¨¡æ¿
[mysqld]
# === åŸºç¡€é…ç½® ===
port = {{MYSQL_PORT|default:3306}}
bind-address = {{MYSQL_BIND_ADDRESS|default:127.0.0.1}}
datadir = {{MYSQL_DATADIR|default:/var/lib/mysql}}

# === æ€§èƒ½é…ç½® ===
innodb_buffer_pool_size = {{INNODB_BUFFER_POOL_SIZE|default:128M}}
innodb_log_file_size = {{INNODB_LOG_FILE_SIZE|default:64M}}
max_connections = {{MAX_CONNECTIONS|default:100}}

# === æ—¥å¿—é…ç½® ===
slow_query_log = {{SLOW_QUERY_LOG|default:ON}}
long_query_time = {{LONG_QUERY_TIME|default:2}}
log_error = {{LOG_ERROR_PATH|default:/var/log/mysql/error.log}}

# === å®‰å…¨é…ç½® ===
sql_mode = {{SQL_MODE|default:STRICT_TRANS_TABLES}}
```

### 7.3 ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶


**ğŸ”¸ ä¸åŒç¯å¢ƒçš„å˜é‡å®šä¹‰**

```bash
# config/dev.env - å¼€å‘ç¯å¢ƒå˜é‡
MYSQL_PORT=3306
MYSQL_BIND_ADDRESS=127.0.0.1
INNODB_BUFFER_POOL_SIZE=128M
MAX_CONNECTIONS=50
SLOW_QUERY_LOG=ON
LONG_QUERY_TIME=1
SQL_MODE=""

# config/prod.env - ç”Ÿäº§ç¯å¢ƒå˜é‡  
MYSQL_PORT=3306
MYSQL_BIND_ADDRESS=0.0.0.0
INNODB_BUFFER_POOL_SIZE=8G
MAX_CONNECTIONS=1000
SLOW_QUERY_LOG=ON
LONG_QUERY_TIME=2
SQL_MODE="STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO"
```

### 7.4 æ¨¡æ¿æ¸²æŸ“è„šæœ¬


**ğŸ”§ é…ç½®ç”Ÿæˆå·¥å…·**

```python
#!/usr/bin/env python3
# generate_config.py - é…ç½®æ–‡ä»¶ç”Ÿæˆå·¥å…·

import os
import sys
from string import Template

def load_env_file(env_file):
    """åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶"""
    env_vars = {}
    with open(env_file, 'r') as f:
        for line in f:
            line = line.strip()
            if line and not line.startswith('#'):
                key, value = line.split('=', 1)
                env_vars[key] = value
    return env_vars

def render_template(template_file, env_vars, output_file):
    """æ¸²æŸ“é…ç½®æ¨¡æ¿"""
    with open(template_file, 'r') as f:
        template_content = f.read()
    
    # ä½¿ç”¨Pythonçš„Templateè¿›è¡Œå˜é‡æ›¿æ¢
    template = Template(template_content)
    
    # å¤„ç†é»˜è®¤å€¼
    rendered_content = template_content
    for key, value in env_vars.items():
        rendered_content = rendered_content.replace(f'{{{{{key}}}}}', value)
    
    with open(output_file, 'w') as f:
        f.write(rendered_content)
    
    print(f"é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: {output_file}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("ç”¨æ³•: python3 generate_config.py [ç¯å¢ƒå]")
        sys.exit(1)
    
    env_name = sys.argv[1]
    template_file = "my.cnf.template"
    env_file = f"config/{env_name}.env"
    output_file = f"output/my.cnf.{env_name}"
    
    if not os.path.exists(env_file):
        print(f"é”™è¯¯: ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸å­˜åœ¨: {env_file}")
        sys.exit(1)
    
    env_vars = load_env_file(env_file)
    render_template(template_file, env_vars, output_file)
```

### 7.5 é…ç½®å‚æ•°ç»§æ‰¿æœºåˆ¶


**ğŸ”¸ åˆ†å±‚é…ç½®è®¾è®¡**

```
é…ç½®ç»§æ‰¿å±‚æ¬¡ï¼š

åŸºç¡€å±‚(base.cnf)
    â†“ ç»§æ‰¿
ç¯å¢ƒå±‚(env.cnf)  
    â†“ ç»§æ‰¿
åº”ç”¨å±‚(app.cnf)
    â†“ ç»§æ‰¿
å®ä¾‹å±‚(instance.cnf)
```

**ğŸ’¡ ç»§æ‰¿é…ç½®ç¤ºä¾‹**

```ini
# base.cnf - åŸºç¡€é…ç½®
[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
default-time-zone = '+08:00'

# env-prod.cnf - ç”Ÿäº§ç¯å¢ƒé…ç½®(ç»§æ‰¿base.cnf)
!include base.cnf
[mysqld]
innodb_buffer_pool_size = 8G
max_connections = 1000

# app-web.cnf - Webåº”ç”¨é…ç½®(ç»§æ‰¿env-prod.cnf)  
!include env-prod.cnf
[mysqld]
wait_timeout = 300
interactive_timeout = 300
```

---

## 8. ğŸ¤– é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²


### 8.1 ä¸ºä»€ä¹ˆéœ€è¦è‡ªåŠ¨åŒ–éƒ¨ç½²


**æ ¸å¿ƒä»·å€¼**ï¼šå‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡å’Œä¸€è‡´æ€§

```
æ‰‹å·¥éƒ¨ç½²çš„é—®é¢˜ï¼š
ğŸ˜° å®¹æ˜“å‡ºé”™ï¼šå¤åˆ¶ç²˜è´´é…ç½®æ—¶å¯èƒ½æ¼æ‰æŸäº›è®¾ç½®
â° æ•ˆç‡ä½ï¼šæ¯æ¬¡éƒ¨ç½²éƒ½è¦é‡å¤ç›¸åŒçš„æ­¥éª¤
ğŸ”€ ä¸ä¸€è‡´ï¼šä¸åŒäººéƒ¨ç½²å¯èƒ½å‡ºç°å·®å¼‚
ğŸ“ éš¾è¿½è¸ªï¼šæ— æ³•è®°å½•æ¯æ¬¡å˜æ›´çš„å…·ä½“å†…å®¹

è‡ªåŠ¨åŒ–éƒ¨ç½²çš„å¥½å¤„ï¼š
âœ… æ ‡å‡†åŒ–ï¼šæ¯æ¬¡éƒ¨ç½²éƒ½ä½¿ç”¨ç›¸åŒçš„æµç¨‹
âš¡ é«˜æ•ˆç‡ï¼šä¸€é”®éƒ¨ç½²ï¼ŒèŠ‚çœæ—¶é—´
ğŸ” å¯è¿½è¸ªï¼šæ‰€æœ‰å˜æ›´éƒ½æœ‰è®°å½•
ğŸ”’ å¯å›æ»šï¼šå‡ºé—®é¢˜å¯ä»¥å¿«é€Ÿæ¢å¤
```

### 8.2 Ansibleè‡ªåŠ¨åŒ–éƒ¨ç½²


**ğŸ”¸ Ansible Playbookç¤ºä¾‹**

```yaml
# mysql-config-deploy.yml
---
- name: MySQLå¤šç¯å¢ƒé…ç½®éƒ¨ç½²
  hosts: mysql_servers
  become: yes
  vars:
    mysql_config_dir: /etc/mysql
    backup_dir: /backup/mysql-config
    
  tasks:
    # 1. å¤‡ä»½å½“å‰é…ç½®
    - name: å¤‡ä»½å½“å‰MySQLé…ç½®
      copy:
        src: "{{ mysql_config_dir }}/my.cnf"
        dest: "{{ backup_dir }}/my.cnf.{{ ansible_date_time.epoch }}"
        backup: yes
      
    # 2. æ ¹æ®ç¯å¢ƒç”Ÿæˆé…ç½®æ–‡ä»¶
    - name: ç”ŸæˆMySQLé…ç½®æ–‡ä»¶
      template:
        src: "templates/my.cnf.j2"
        dest: "{{ mysql_config_dir }}/my.cnf"
        owner: mysql
        group: mysql
        mode: '0644'
      notify: restart mysql
      
    # 3. éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
    - name: éªŒè¯MySQLé…ç½®æ–‡ä»¶è¯­æ³•
      command: mysqld --help --verbose
      changed_when: false
      failed_when: false
      register: config_check
      
    # 4. é‡å¯MySQLæœåŠ¡
    - name: é‡å¯MySQLæœåŠ¡
      systemd:
        name: mysql
        state: restarted
      when: config_check.rc == 0
      
  handlers:
    - name: restart mysql
      systemd:
        name: mysql
        state: restarted
```

**ğŸ”¸ é…ç½®æ¨¡æ¿æ–‡ä»¶**

```jinja2
{# templates/my.cnf.j2 #}
[mysqld]
# === åŸºç¡€é…ç½® ===
port = {{ mysql_port | default(3306) }}
bind-address = {{ mysql_bind_address | default('127.0.0.1') }}
datadir = {{ mysql_datadir | default('/var/lib/mysql') }}

# === æ€§èƒ½é…ç½®(æ ¹æ®ç¯å¢ƒè°ƒæ•´) ===
{% if environment == 'prod' %}
innodb_buffer_pool_size = {{ (ansible_memtotal_mb * 0.7) | int }}M
max_connections = 1000
{% elif environment == 'uat' %}
innodb_buffer_pool_size = {{ (ansible_memtotal_mb * 0.5) | int }}M
max_connections = 500
{% else %}
innodb_buffer_pool_size = 128M
max_connections = 100
{% endif %}

# === æ—¥å¿—é…ç½® ===
slow_query_log = ON
long_query_time = {{ slow_query_time | default(2) }}
{% if environment in ['dev', 'test'] %}
general_log = ON
{% endif %}
```

### 8.3 Dockerå®¹å™¨åŒ–éƒ¨ç½²


**ğŸ³ Docker Composeé…ç½®**

```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql-dev:
    image: mysql:8.0
    container_name: mysql-dev
    environment:
      MYSQL_ROOT_PASSWORD: dev_password
      MYSQL_DATABASE: dev_db
    volumes:
      - ./config/dev/my.cnf:/etc/mysql/conf.d/my.cnf
      - mysql_dev_data:/var/lib/mysql
    ports:
      - "3306:3306"
    profiles: ["dev"]
    
  mysql-test:
    image: mysql:8.0
    container_name: mysql-test
    environment:
      MYSQL_ROOT_PASSWORD: test_password
      MYSQL_DATABASE: test_db
    volumes:
      - ./config/test/my.cnf:/etc/mysql/conf.d/my.cnf
      - mysql_test_data:/var/lib/mysql
    ports:
      - "3307:3306"
    profiles: ["test"]

volumes:
  mysql_dev_data:
  mysql_test_data:
```

**ğŸ”§ éƒ¨ç½²è„šæœ¬**

```bash
#!/bin/bash
# deploy.sh - Dockerç¯å¢ƒéƒ¨ç½²è„šæœ¬

ENVIRONMENT=$1
if [ -z "$ENVIRONMENT" ]; then
    echo "ç”¨æ³•: $0 [dev|test|uat|prod]"
    exit 1
fi

echo "å¼€å§‹éƒ¨ç½²MySQL ${ENVIRONMENT}ç¯å¢ƒ..."

# 1. å‡†å¤‡é…ç½®æ–‡ä»¶
echo "ç”Ÿæˆ${ENVIRONMENT}ç¯å¢ƒé…ç½®æ–‡ä»¶..."
python3 generate_config.py $ENVIRONMENT

# 2. æ‹·è´é…ç½®æ–‡ä»¶åˆ°å¯¹åº”ç›®å½•
cp output/my.cnf.$ENVIRONMENT config/$ENVIRONMENT/my.cnf

# 3. å¯åŠ¨å¯¹åº”ç¯å¢ƒçš„å®¹å™¨
echo "å¯åŠ¨${ENVIRONMENT}ç¯å¢ƒå®¹å™¨..."
docker-compose --profile $ENVIRONMENT up -d

# 4. ç­‰å¾…MySQLå¯åŠ¨
echo "ç­‰å¾…MySQLå¯åŠ¨..."
sleep 30

# 5. éªŒè¯éƒ¨ç½²
echo "éªŒè¯éƒ¨ç½²ç»“æœ..."
docker-compose --profile $ENVIRONMENT exec mysql-$ENVIRONMENT mysql -u root -p -e "SELECT $$version;"

echo "${ENVIRONMENT}ç¯å¢ƒéƒ¨ç½²å®Œæˆï¼"
```

### 8.4 é…ç½®å˜æ›´ç¯å¢ƒä¼ æ’­


**ğŸ”„ é…ç½®åŒæ­¥æµç¨‹**

```
é…ç½®å˜æ›´ä¼ æ’­æµç¨‹ï¼š

å¼€å‘ç¯å¢ƒ     æµ‹è¯•ç¯å¢ƒ     é¢„å‘å¸ƒç¯å¢ƒ    ç”Ÿäº§ç¯å¢ƒ
    â†“            â†“            â†“           â†“
 é…ç½®ä¿®æ”¹  â†’  åŒæ­¥æµ‹è¯•  â†’   åŒæ­¥éªŒè¯  â†’  åŒæ­¥ä¸Šçº¿
    â†“            â†“            â†“           â†“
 æœ¬åœ°éªŒè¯      åŠŸèƒ½æµ‹è¯•      æ€§èƒ½æµ‹è¯•     ç”Ÿäº§ç›‘æ§
```

**ğŸ”¸ é…ç½®åŒæ­¥è„šæœ¬**

```bash
#!/bin/bash
# sync_config.sh - é…ç½®ç¯å¢ƒé—´åŒæ­¥è„šæœ¬

SOURCE_ENV=$1
TARGET_ENV=$2

if [ -z "$SOURCE_ENV" ] || [ -z "$TARGET_ENV" ]; then
    echo "ç”¨æ³•: $0 [æºç¯å¢ƒ] [ç›®æ ‡ç¯å¢ƒ]"
    echo "ä¾‹å¦‚: $0 dev test"
    exit 1
fi

# é…ç½®æ–‡ä»¶è·¯å¾„
SOURCE_CONFIG="config/${SOURCE_ENV}.env"
TARGET_CONFIG="config/${TARGET_ENV}.env"

echo "å¼€å§‹ä»${SOURCE_ENV}åŒæ­¥é…ç½®åˆ°${TARGET_ENV}..."

# 1. å¤‡ä»½ç›®æ ‡ç¯å¢ƒé…ç½®
cp $TARGET_CONFIG ${TARGET_CONFIG}.backup.$(date +%Y%m%d_%H%M%S)

# 2. é€‰æ‹©æ€§åŒæ­¥é…ç½®é¡¹
echo "è¯·é€‰æ‹©è¦åŒæ­¥çš„é…ç½®é¡¹:"
echo "1) å…¨éƒ¨åŒæ­¥"
echo "2) ä»…åŒæ­¥åº”ç”¨é…ç½®(ä¸åŒ…æ‹¬æ€§èƒ½å‚æ•°)"
echo "3) è‡ªå®šä¹‰é€‰æ‹©"

read -p "è¯·é€‰æ‹©(1-3): " choice

case $choice in
    1)
        # å…¨éƒ¨åŒæ­¥(ä½†ä¿ç•™ç¯å¢ƒç‰¹å®šçš„æ€§èƒ½å‚æ•°)
        grep -v -E "(INNODB_BUFFER_POOL_SIZE|MAX_CONNECTIONS)" $SOURCE_CONFIG > temp_config
        grep -E "(INNODB_BUFFER_POOL_SIZE|MAX_CONNECTIONS)" $TARGET_CONFIG >> temp_config
        mv temp_config $TARGET_CONFIG
        ;;
    2)
        # ä»…åŒæ­¥åº”ç”¨é…ç½®
        grep -v -E "(INNODB_|MAX_CONNECTIONS|BUFFER)" $SOURCE_CONFIG > temp_config
        grep -E "(INNODB_|MAX_CONNECTIONS|BUFFER)" $TARGET_CONFIG >> temp_config
        mv temp_config $TARGET_CONFIG
        ;;
    3)
        echo "è¯·æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶: $TARGET_CONFIG"
        ${EDITOR:-vim} $TARGET_CONFIG
        ;;
esac

echo "é…ç½®åŒæ­¥å®Œæˆï¼"
echo "è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶:"
echo "python3 generate_config.py $TARGET_ENV"
```

### 8.5 ç¯å¢ƒé…ç½®ä¸€è‡´æ€§æ£€æŸ¥


**ğŸ” ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬**

```bash
#!/bin/bash
# check_consistency.sh - é…ç½®ä¸€è‡´æ€§æ£€æŸ¥

echo "MySQLå¤šç¯å¢ƒé…ç½®ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š"
echo "========================================"

ENVIRONMENTS=("dev" "test" "uat" "prod")

# æ£€æŸ¥å…³é”®é…ç½®é¡¹
check_config_item() {
    local config_item=$1
    echo "æ£€æŸ¥é…ç½®é¡¹: $config_item"
    
    for env in "${ENVIRONMENTS[@]}"; do
        if [ -f "config/${env}.env" ]; then
            value=$(grep "^${config_item}=" config/${env}.env | cut -d'=' -f2)
            printf "  %-10s: %s\n" $env "$value"
        fi
    done
    echo
}

# æ£€æŸ¥é‡è¦é…ç½®é¡¹
echo "=== åŸºç¡€é…ç½® ==="
check_config_item "MYSQL_PORT"
check_config_item "MYSQL_BIND_ADDRESS"

echo "=== æ€§èƒ½é…ç½® ==="
check_config_item "INNODB_BUFFER_POOL_SIZE"
check_config_item "MAX_CONNECTIONS"

echo "=== å®‰å…¨é…ç½® ==="
check_config_item "SQL_MODE"

echo "=== æ—¥å¿—é…ç½® ==="
check_config_item "SLOW_QUERY_LOG"
check_config_item "LONG_QUERY_TIME"

# æ£€æŸ¥é…ç½®æ–‡ä»¶å®Œæ•´æ€§
echo "=== é…ç½®æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥ ==="
for env in "${ENVIRONMENTS[@]}"; do
    if [ -f "config/${env}.env" ]; then
        missing_count=$(comm -23 <(grep -v '^#' config/base.env | cut -d'=' -f1 | sort) <(grep -v '^#' config/${env}.env | cut -d'=' -f1 | sort) | wc -l)
        if [ $missing_count -eq 0 ]; then
            echo "âœ… ${env}ç¯å¢ƒé…ç½®å®Œæ•´"
        else
            echo "âŒ ${env}ç¯å¢ƒç¼ºå°‘ $missing_count ä¸ªé…ç½®é¡¹"
        fi
    else
        echo "âŒ ${env}ç¯å¢ƒé…ç½®æ–‡ä»¶ä¸å­˜åœ¨"
    fi
done
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ å¤šç¯å¢ƒç®¡ç†ï¼šå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç”Ÿäº§ç¯å¢ƒçš„ä¸åŒéœ€æ±‚
ğŸ”¸ é…ç½®éš”ç¦»ï¼šç¡®ä¿ä¸åŒç¯å¢ƒçš„é…ç½®äº’ä¸å¹²æ‰°
ğŸ”¸ æ¨¡æ¿åŒ–ç®¡ç†ï¼šä½¿ç”¨æ¨¡æ¿å’Œå˜é‡å®ç°é…ç½®æ ‡å‡†åŒ–
ğŸ”¸ è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šå‡å°‘äººä¸ºé”™è¯¯ï¼Œæé«˜éƒ¨ç½²æ•ˆç‡
ğŸ”¸ ä¸€è‡´æ€§æ£€æŸ¥ï¼šç¡®ä¿ç¯å¢ƒé—´é…ç½®çš„æ­£ç¡®ä¼ æ’­
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç¯å¢ƒé…ç½®çš„æ ¸å¿ƒå·®å¼‚**
```
æ€§èƒ½å‚æ•°ï¼š
- å¼€å‘ç¯å¢ƒï¼šå†…å­˜å°ï¼Œå¯åŠ¨å¿«
- æµ‹è¯•ç¯å¢ƒï¼šé€‚ä¸­é…ç½®ï¼Œæ¥è¿‘çœŸå®
- ç”Ÿäº§ç¯å¢ƒï¼šå¤§å†…å­˜ï¼Œé«˜æ€§èƒ½

å®‰å…¨è¦æ±‚ï¼š
- å¼€å‘ç¯å¢ƒï¼šå®½æ¾æ¨¡å¼ï¼Œæ–¹ä¾¿è°ƒè¯•
- æµ‹è¯•ç¯å¢ƒï¼šæ ‡å‡†å®‰å…¨ï¼ŒåŠŸèƒ½éªŒè¯
- ç”Ÿäº§ç¯å¢ƒï¼šä¸¥æ ¼å®‰å…¨ï¼Œæ•°æ®ä¿æŠ¤

æ—¥å¿—è®¾ç½®ï¼š
- å¼€å‘ç¯å¢ƒï¼šè¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- æµ‹è¯•ç¯å¢ƒï¼šæ ‡å‡†æ—¥å¿—ï¼Œæ€§èƒ½æµ‹è¯•
- ç”Ÿäº§ç¯å¢ƒï¼šå…³é”®æ—¥å¿—ï¼Œæ€§èƒ½ä¼˜å…ˆ
```

**ğŸ”¹ é…ç½®ç®¡ç†çš„æœ€ä½³å®è·µ**
```
æ ‡å‡†åŒ–åŸåˆ™ï¼š
- ä½¿ç”¨é…ç½®æ¨¡æ¿ç»Ÿä¸€æ ¼å¼
- é€šè¿‡å˜é‡æ§åˆ¶ç¯å¢ƒå·®å¼‚
- å»ºç«‹é…ç½®ç»§æ‰¿æœºåˆ¶

è‡ªåŠ¨åŒ–åŸåˆ™ï¼š
- é…ç½®ç”Ÿæˆè‡ªåŠ¨åŒ–
- éƒ¨ç½²æµç¨‹è‡ªåŠ¨åŒ–
- ä¸€è‡´æ€§æ£€æŸ¥è‡ªåŠ¨åŒ–

å®‰å…¨åŸåˆ™ï¼š
- é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- å˜æ›´å®¡è®¡å’Œå›æ»š
```

### 9.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ è§£å†³çš„æ ¸å¿ƒé—®é¢˜**
- **é…ç½®æ··ä¹±**ï¼šç»Ÿä¸€ç®¡ç†å¤šç¯å¢ƒé…ç½®ï¼Œé¿å…æ‰‹å·¥ç»´æŠ¤
- **éƒ¨ç½²é”™è¯¯**ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²å‡å°‘äººä¸ºé”™è¯¯
- **ç¯å¢ƒä¸ä¸€è‡´**ï¼šæ¨¡æ¿åŒ–ç¡®ä¿ç¯å¢ƒé—´é…ç½®çš„ä¸€è‡´æ€§
- **å˜æ›´é£é™©**ï¼šé…ç½®ç‰ˆæœ¬æ§åˆ¶å’Œå›æ»šæœºåˆ¶é™ä½é£é™©

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**
- **æ•ˆç‡æå‡**ï¼šä¸€é”®éƒ¨ç½²ï¼Œå¿«é€Ÿç¯å¢ƒåˆ‡æ¢
- **é”™è¯¯å‡å°‘**ï¼šæ ‡å‡†åŒ–æµç¨‹ï¼Œè‡ªåŠ¨æ£€æŸ¥
- **å¯ç»´æŠ¤æ€§**ï¼šé…ç½®æ¨¡æ¿åŒ–ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- **å¯è¿½æº¯æ€§**ï¼šæ‰€æœ‰å˜æ›´éƒ½æœ‰è®°å½•å’Œå®¡è®¡

**æ ¸å¿ƒè®°å¿†**ï¼š
- å¤šç¯å¢ƒé…ç½®è¦å› åœ°åˆ¶å®œï¼Œå¼€å‘æ±‚å¿«ã€ç”Ÿäº§æ±‚ç¨³
- æ¨¡æ¿åŒ–ç®¡ç†æ˜¯è§„æ¨¡åŒ–è¿ç»´çš„åŸºç¡€
- è‡ªåŠ¨åŒ–éƒ¨ç½²æ˜¯å‡å°‘é”™è¯¯çš„å…³é”®æ‰‹æ®µ
- ä¸€è‡´æ€§æ£€æŸ¥æ˜¯è´¨é‡ä¿è¯çš„é‡è¦ç¯èŠ‚
- é…ç½®å³ä»£ç ï¼Œè¦åƒç®¡ç†ä»£ç ä¸€æ ·ç®¡ç†é…ç½®