---
title: 33ã€MGRç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¡ˆä¾‹
---
## ğŸ“š ç›®å½•

1. [ç”Ÿäº§ç¯å¢ƒè§„åˆ’](#1-ç”Ÿäº§ç¯å¢ƒè§„åˆ’)
2. [ç¡¬ä»¶é…ç½®æ–¹æ¡ˆ](#2-ç¡¬ä»¶é…ç½®æ–¹æ¡ˆ)
3. [ç½‘ç»œæ¶æ„è®¾è®¡](#3-ç½‘ç»œæ¶æ„è®¾è®¡)
4. [å®‰å…¨ç­–ç•¥å®æ–½](#4-å®‰å…¨ç­–ç•¥å®æ–½)
5. [éƒ¨ç½²æ­¥éª¤è¯¦è§£](#5-éƒ¨ç½²æ­¥éª¤è¯¦è§£)
6. [éªŒè¯æµ‹è¯•æ–¹æ³•](#6-éªŒè¯æµ‹è¯•æ–¹æ³•)
7. [æ€§èƒ½åŸºå‡†æµ‹è¯•](#7-æ€§èƒ½åŸºå‡†æµ‹è¯•)
8. [ç›‘æ§ä½“ç³»å»ºè®¾](#8-ç›‘æ§ä½“ç³»å»ºè®¾)
9. [è¿ç»´æµç¨‹åˆ¶å®š](#9-è¿ç»´æµç¨‹åˆ¶å®š)
10. [é—®é¢˜å¤„ç†è®°å½•](#10-é—®é¢˜å¤„ç†è®°å½•)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç”Ÿäº§ç¯å¢ƒè§„åˆ’


### 1.1 MGRåŸºæœ¬æ¦‚å¿µå›é¡¾


**ä»€ä¹ˆæ˜¯MySQL Group Replicationï¼ˆMGRï¼‰**
```
ç®€å•ç†è§£ï¼šMGRå°±åƒä¸€ä¸ª"æ•°æ®åº“å°ç»„"ï¼Œå‡ å°æœåŠ¡å™¨ç»„æˆä¸€ä¸ªå›¢é˜Ÿ
â€¢ æ¯ä¸ªæˆå‘˜éƒ½æœ‰å®Œæ•´çš„æ•°æ®å‰¯æœ¬
â€¢ å½“æœ‰æ•°æ®å˜æ›´æ—¶ï¼Œæ‰€æœ‰æˆå‘˜éƒ½è¦"æŠ•ç¥¨åŒæ„"
â€¢ è¶…è¿‡åŠæ•°åŒæ„æ‰èƒ½æ‰§è¡Œï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
â€¢ å¦‚æœæŸä¸ªæˆå‘˜å‡ºé—®é¢˜ï¼Œå…¶ä»–æˆå‘˜ç»§ç»­å·¥ä½œ
```

**ä¸ºä»€ä¹ˆè¦ç”¨MGR**
- **é«˜å¯ç”¨æ€§**ï¼šä¸€å°æœºå™¨åäº†ï¼Œå…¶ä»–æœºå™¨ç»§ç»­æä¾›æœåŠ¡
- **æ•°æ®ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æœºå™¨çš„æ•°æ®éƒ½æ˜¯åŒæ­¥çš„ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼šä¸éœ€è¦äººå·¥å¹²é¢„ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†æ•…éšœ

### 1.2 ç”Ÿäº§ç¯å¢ƒè§„åˆ’è¦ç´ 


**ğŸ”¸ ä¸šåŠ¡éœ€æ±‚åˆ†æ**
```
å…³é”®é—®é¢˜ï¼š
â€¢ é¢„æœŸå¹¶å‘ç”¨æˆ·æ•°é‡ï¼Ÿï¼ˆæ¯”å¦‚ï¼š1000ä¸ªç”¨æˆ·åŒæ—¶åœ¨çº¿ï¼‰
â€¢ æ•°æ®é‡å¤§å°ï¼Ÿï¼ˆæ¯”å¦‚ï¼šæ¯å¤©æ–°å¢10ä¸‡æ¡è®°å½•ï¼‰
â€¢ å¯æ¥å—çš„åœæœºæ—¶é—´ï¼Ÿï¼ˆæ¯”å¦‚ï¼šæ¯å¹´ä¸è¶…è¿‡4å°æ—¶ï¼‰
â€¢ æ•°æ®å®‰å…¨çº§åˆ«è¦æ±‚ï¼Ÿï¼ˆæ¯”å¦‚ï¼šé‡‘èçº§ï¼Œç»ä¸èƒ½ä¸¢æ•°æ®ï¼‰
```

**ğŸ”¸ éƒ¨ç½²æ¨¡å¼é€‰æ‹©**
```
å•ä¸»æ¨¡å¼ï¼ˆSingle-Primaryï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»èŠ‚ç‚¹   â”‚â”€â”€â”€â”€â”‚ ä»èŠ‚ç‚¹1  â”‚â”€â”€â”€â”€â”‚ ä»èŠ‚ç‚¹2  â”‚
â”‚(å¯å†™)   â”‚    â”‚(åªè¯»)   â”‚    â”‚(åªè¯»)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€‚ç”¨åœºæ™¯ï¼šä¼ ç»Ÿåº”ç”¨ï¼Œå†™æ“ä½œé›†ä¸­

å¤šä¸»æ¨¡å¼ï¼ˆMulti-Primaryï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»èŠ‚ç‚¹1  â”‚â”€â”€â”€â”€â”‚ ä¸»èŠ‚ç‚¹2  â”‚â”€â”€â”€â”€â”‚ ä¸»èŠ‚ç‚¹3  â”‚
â”‚(å¯è¯»å†™) â”‚    â”‚(å¯è¯»å†™) â”‚    â”‚(å¯è¯»å†™) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é€‚ç”¨åœºæ™¯ï¼šåˆ†å¸ƒå¼åº”ç”¨ï¼Œéœ€è¦å¤šç‚¹å†™å…¥
```

**ğŸ”¸ èŠ‚ç‚¹æ•°é‡è§„åˆ’**
```
æœ€å°‘3ä¸ªèŠ‚ç‚¹ï¼š
â€¢ ä¸ºä»€ä¹ˆæ˜¯3ä¸ªï¼Ÿå› ä¸ºéœ€è¦"è¿‡åŠåŸåˆ™"
â€¢ 2ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¸€ä¸ªåäº†å°±æ²¡æœ‰è¿‡åŠæ•°ï¼Œæ•´ä¸ªé›†ç¾¤åœæ­¢å·¥ä½œ
â€¢ 3ä¸ªèŠ‚ç‚¹æ—¶ï¼Œåæ‰1ä¸ªè¿˜æœ‰2ä¸ªï¼Œè¶…è¿‡åŠæ•°ï¼Œé›†ç¾¤æ­£å¸¸

æ¨èé…ç½®ï¼š
â€¢ å°å‹åº”ç”¨ï¼š3ä¸ªèŠ‚ç‚¹
â€¢ ä¸­å‹åº”ç”¨ï¼š5ä¸ªèŠ‚ç‚¹ï¼ˆå¯å®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœï¼‰
â€¢ å¤§å‹åº”ç”¨ï¼š7ä¸ªèŠ‚ç‚¹ï¼ˆå¯å®¹å¿3ä¸ªèŠ‚ç‚¹æ•…éšœï¼‰
```

### 1.3 å®é™…æ¡ˆä¾‹è§„åˆ’


**æ¡ˆä¾‹èƒŒæ™¯**ï¼šç”µå•†ç½‘ç«™ç”¨æˆ·ç³»ç»Ÿ
- ç”¨æˆ·é‡ï¼š50ä¸‡æ³¨å†Œç”¨æˆ·ï¼Œæ—¥æ´»è·ƒ5ä¸‡
- å¹¶å‘é‡ï¼šå³°å€¼1000å¹¶å‘è¯»ï¼Œ100å¹¶å‘å†™
- å¯ç”¨æ€§è¦æ±‚ï¼š99.9%ï¼ˆæ¯å¹´åœæœºä¸è¶…è¿‡8.76å°æ—¶ï¼‰

**è§„åˆ’æ–¹æ¡ˆ**ï¼š
```
èŠ‚ç‚¹é…ç½®ï¼š5ä¸ªèŠ‚ç‚¹çš„MGRé›†ç¾¤
éƒ¨ç½²æ¨¡å¼ï¼šå•ä¸»æ¨¡å¼ï¼ˆç®€åŒ–è¿ç»´ï¼‰
åœ°ç†åˆ†å¸ƒï¼š3ä¸ªèŠ‚ç‚¹åœ¨ä¸»æœºæˆ¿ï¼Œ2ä¸ªèŠ‚ç‚¹åœ¨å¤‡æœºæˆ¿

ä¸»æœºæˆ¿ï¼ˆ3èŠ‚ç‚¹ï¼‰ï¼š
â”œâ”€ Node1: Primaryï¼ˆä¸»å†™èŠ‚ç‚¹ï¼‰
â”œâ”€ Node2: Secondaryï¼ˆè¯»èŠ‚ç‚¹ï¼‰
â””â”€ Node3: Secondaryï¼ˆè¯»èŠ‚ç‚¹ï¼‰

å¤‡æœºæˆ¿ï¼ˆ2èŠ‚ç‚¹ï¼‰ï¼š
â”œâ”€ Node4: Secondaryï¼ˆè¯»èŠ‚ç‚¹ï¼‰
â””â”€ Node5: Secondaryï¼ˆè¯»èŠ‚ç‚¹ï¼‰
```

---

## 2. ğŸ–¥ï¸ ç¡¬ä»¶é…ç½®æ–¹æ¡ˆ


### 2.1 ç¡¬ä»¶é€‰å‹åŸåˆ™


**ğŸ”¸ CPUé€‰å‹**
```
MGRå¯¹CPUçš„è¦æ±‚ï¼š
â€¢ ä¸»è¦ç”¨äºæ•°æ®å¤åˆ¶çš„åŠ å¯†è§£å¯†
â€¢ äº‹åŠ¡å†²çªæ£€æµ‹å’Œåè°ƒ
â€¢ ç½‘ç»œé€šä¿¡å¤„ç†

æ¨èé…ç½®ï¼š
â€¢ å°å‹ç¯å¢ƒï¼š8æ ¸CPUï¼ˆIntel i7æˆ–åŒç­‰ï¼‰
â€¢ ä¸­å‹ç¯å¢ƒï¼š16æ ¸CPUï¼ˆIntel Xeon E5ç³»åˆ—ï¼‰
â€¢ å¤§å‹ç¯å¢ƒï¼š32æ ¸CPUï¼ˆIntel Xeon Goldç³»åˆ—ï¼‰

å®é™…è€ƒè™‘ï¼š
CPUæ€§èƒ½æ¯”æ ¸å¿ƒæ•°æ›´é‡è¦ï¼Œé€‰æ‹©ä¸»é¢‘è¾ƒé«˜çš„å‹å·
```

**ğŸ”¸ å†…å­˜é…ç½®**
```
å†…å­˜ç”¨é€”åˆ†æï¼š
â€¢ InnoDB Buffer Poolï¼šå­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ˆæœ€é‡è¦ï¼‰
â€¢ MGRç¼“å†²åŒºï¼šå­˜å‚¨å¤åˆ¶ç›¸å…³æ•°æ®
â€¢ æ“ä½œç³»ç»Ÿç¼“å­˜ï¼šæ–‡ä»¶ç³»ç»Ÿç¼“å­˜

è®¡ç®—å…¬å¼ï¼š
æ€»å†…å­˜ = æ•°æ®åº“å†…å­˜ + ç³»ç»Ÿé¢„ç•™å†…å­˜
æ•°æ®åº“å†…å­˜ = Buffer Pool + å…¶ä»–MySQLå†…å­˜
Buffer Pool = çƒ­ç‚¹æ•°æ®å¤§å° Ã— 1.2ï¼ˆé¢„ç•™ç©ºé—´ï¼‰

å®ä¾‹è®¡ç®—ï¼š
å‡è®¾çƒ­ç‚¹æ•°æ®50GB
Buffer Pool = 50GB Ã— 1.2 = 60GB
MySQLæ€»å†…å­˜ = 60GB + 8GBï¼ˆå…¶ä»–ï¼‰ = 68GB
ç³»ç»Ÿé¢„ç•™ = 68GB Ã— 0.2 = 14GB
æ€»å†…å­˜éœ€æ±‚ = 68GB + 14GB = 82GB
æ¨èé…ç½®ï¼š96GBæˆ–128GB
```

**ğŸ”¸ å­˜å‚¨é…ç½®**
```
å­˜å‚¨æ€§èƒ½è¦æ±‚ï¼š
â€¢ æ•°æ®ç›®å½•ï¼šé«˜IOPSï¼Œä½å»¶è¿Ÿï¼ˆSSDå¿…éœ€ï¼‰
â€¢ æ—¥å¿—ç›®å½•ï¼šé«˜ååé‡ï¼Œå¯é æ€§
â€¢ å¤‡ä»½ç›®å½•ï¼šå¤§å®¹é‡ï¼Œæˆæœ¬è€ƒè™‘

æ¨èé…ç½®ï¼š
æ•°æ®ç›˜ï¼š
â”œâ”€ ç±»å‹ï¼šNVMe SSD
â”œâ”€ å®¹é‡ï¼šæ•°æ®é‡ Ã— 3ï¼ˆè€ƒè™‘å¢é•¿å’Œç´¢å¼•ï¼‰
â”œâ”€ IOPSï¼šâ‰¥10000
â””â”€ RAIDï¼šRAID10ï¼ˆæ€§èƒ½+å®‰å…¨ï¼‰

æ—¥å¿—ç›˜ï¼š
â”œâ”€ ç±»å‹ï¼šSATA SSD
â”œâ”€ å®¹é‡ï¼šæ•°æ®ç›˜çš„20%
â””â”€ RAIDï¼šRAID1ï¼ˆå¯é æ€§ä¼˜å…ˆï¼‰

ç¤ºä¾‹é…ç½®ï¼š
æ•°æ®ç›˜ï¼š4 Ã— 1TB NVMe SSD RAID10 = 2TBå¯ç”¨
æ—¥å¿—ç›˜ï¼š2 Ã— 512GB SATA SSD RAID1 = 512GBå¯ç”¨
```

### 2.2 å…·ä½“ç¡¬ä»¶é…ç½®æ¸…å•


**ğŸ”¸ å°å‹ç¯å¢ƒé…ç½®**
```
æœåŠ¡å™¨è§„æ ¼ï¼š
CPU: Intel Xeon E-2288G 8æ ¸3.7GHz
å†…å­˜: 64GB DDR4 ECC
å­˜å‚¨: 
  â”œâ”€ ç³»ç»Ÿç›˜ï¼š2 Ã— 256GB SSD RAID1
  â”œâ”€ æ•°æ®ç›˜ï¼š2 Ã— 1TB NVMe SSD RAID1
  â””â”€ æ—¥å¿—ç›˜ï¼šç‹¬ç«‹åˆ†åŒºåœ¨æ•°æ®ç›˜ä¸Š
ç½‘ç»œ: åŒåƒå…†ç½‘å¡ï¼Œé“¾è·¯èšåˆ
ç”µæº: å†—ä½™ç”µæº

é¢„ç®—ï¼šå•å°çº¦2ä¸‡å…ƒ
é€‚ç”¨ï¼šå°å‹ç”µå•†ã€ä¼ä¸šå†…éƒ¨ç³»ç»Ÿ
```

**ğŸ”¸ ä¸­å‹ç¯å¢ƒé…ç½®**
```
æœåŠ¡å™¨è§„æ ¼ï¼š
CPU: Intel Xeon Silver 4214R 12æ ¸2.4GHz Ã— 2
å†…å­˜: 128GB DDR4 ECC
å­˜å‚¨:
  â”œâ”€ ç³»ç»Ÿç›˜ï¼š2 Ã— 512GB SSD RAID1
  â”œâ”€ æ•°æ®ç›˜ï¼š4 Ã— 2TB NVMe SSD RAID10
  â””â”€ æ—¥å¿—ç›˜ï¼š2 Ã— 1TB SATA SSD RAID1
ç½‘ç»œ: åŒä¸‡å…†ç½‘å¡
ç”µæº: å†—ä½™ç”µæº

é¢„ç®—ï¼šå•å°çº¦5ä¸‡å…ƒ
é€‚ç”¨ï¼šä¸­å‹ç”µå•†ã€é‡‘èç³»ç»Ÿ
```

### 2.3 ç½‘ç»œå¸¦å®½è§„åˆ’


**ğŸ”¸ å¸¦å®½éœ€æ±‚è®¡ç®—**
```
MGRç½‘ç»œæµé‡ç»„æˆï¼š
â€¢ æ•°æ®å¤åˆ¶æµé‡ï¼šæ‰€æœ‰å†™æ“ä½œéƒ½è¦å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹
â€¢ å¿ƒè·³æ£€æµ‹æµé‡ï¼šèŠ‚ç‚¹é—´å®šæœŸå¿ƒè·³åŒ…
â€¢ åº”ç”¨è®¿é—®æµé‡ï¼šå®¢æˆ·ç«¯è¿æ¥äº§ç”Ÿçš„æµé‡

è®¡ç®—ç¤ºä¾‹ï¼š
å†™æ“ä½œTPSï¼š1000/ç§’
å¹³å‡æ¯ä¸ªäº‹åŠ¡ï¼š2KB
å¤åˆ¶åˆ°4ä¸ªèŠ‚ç‚¹ï¼š2KB Ã— 4 = 8KB
æ€»å¤åˆ¶æµé‡ï¼š1000 Ã— 8KB = 8MB/ç§’
åŠ ä¸Šå¿ƒè·³å’Œå…¶ä»–ï¼š8MB Ã— 1.5 = 12MB/ç§’
æ¨èå¸¦å®½ï¼šâ‰¥100Mbpsï¼ˆç•™æœ‰ä½™é‡ï¼‰

å®é™…é…ç½®ï¼š
â€¢ èŠ‚ç‚¹é—´ä¸“ç”¨ç½‘ç»œï¼šåƒå…†ä»¥ä¸Š
â€¢ åº”ç”¨è®¿é—®ç½‘ç»œï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚
â€¢ å»ºè®®ä½¿ç”¨ä¸“ç”¨ç½‘ç»œï¼Œé¿å…ä¸ä¸šåŠ¡æµé‡æ··åˆ
```

---

## 3. ğŸŒ ç½‘ç»œæ¶æ„è®¾è®¡


### 3.1 ç½‘ç»œæ‹“æ‰‘ç»“æ„


**ğŸ”¸ ç½‘ç»œåˆ†å±‚è®¾è®¡**
```
ç½‘ç»œæ¶æ„å›¾ï¼š

åº”ç”¨å±‚ç½‘ç»œï¼ˆä¸šåŠ¡è®¿é—®ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           è´Ÿè½½å‡è¡¡å™¨                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ App1    â”‚ App2    â”‚ App3    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
              â”‚
         ä¸šåŠ¡ç½‘ç»œæ®µ
    192.168.10.0/24
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            MGRèŠ‚ç‚¹å±‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Node1  â”‚  â”‚Node2  â”‚  â”‚Node3  â”‚       â”‚
â”‚  â”‚Primaryâ”‚  â”‚Second â”‚  â”‚Second â”‚       â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
         ç®¡ç†ç½‘ç»œæ®µ
    192.168.20.0/24
              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MGRå¤åˆ¶ç½‘ç»œ                    â”‚
â”‚     é«˜é€Ÿã€ä½å»¶è¿Ÿä¸“ç”¨ç½‘ç»œ                   â”‚
â”‚        10.10.10.0/24                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ ç½‘ç»œéš”ç¦»ç­–ç•¥**
```
ä¸‰å±‚ç½‘ç»œéš”ç¦»ï¼š

ä¸šåŠ¡ç½‘ç»œï¼ˆå‰ç«¯ï¼‰ï¼š
â€¢ ç”¨é€”ï¼šåº”ç”¨æœåŠ¡å™¨è®¿é—®æ•°æ®åº“
â€¢ ç½‘æ®µï¼š192.168.10.0/24
â€¢ å®‰å…¨ç­–ç•¥ï¼šåªå…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®3306ç«¯å£

ç®¡ç†ç½‘ç»œï¼ˆä¸­å±‚ï¼‰ï¼š
â€¢ ç”¨é€”ï¼šæ•°æ®åº“ç®¡ç†ã€ç›‘æ§ã€å¤‡ä»½
â€¢ ç½‘æ®µï¼š192.168.20.0/24
â€¢ å®‰å…¨ç­–ç•¥ï¼šåªå…è®¸ç®¡ç†å‘˜å’Œç›‘æ§ç³»ç»Ÿè®¿é—®

å¤åˆ¶ç½‘ç»œï¼ˆåç«¯ï¼‰ï¼š
â€¢ ç”¨é€”ï¼šMGRèŠ‚ç‚¹é—´æ•°æ®å¤åˆ¶
â€¢ ç½‘æ®µï¼š10.10.10.0/24
â€¢ å®‰å…¨ç­–ç•¥ï¼šåªå…è®¸MGRèŠ‚ç‚¹é—´é€šä¿¡ï¼ŒåŠ å¯†ä¼ è¾“
```

### 3.2 ç½‘ç»œé…ç½®å®ä¾‹


**ğŸ”¸ èŠ‚ç‚¹ç½‘ç»œé…ç½®**
```bash
# Node1ç½‘ç»œé…ç½®ç¤ºä¾‹
# ä¸šåŠ¡ç½‘ç»œæ¥å£
auto eth0
iface eth0 inet static
address 192.168.10.101
netmask 255.255.255.0
gateway 192.168.10.1

# ç®¡ç†ç½‘ç»œæ¥å£
auto eth1
iface eth1 inet static
address 192.168.20.101
netmask 255.255.255.0

# MGRå¤åˆ¶ç½‘ç»œæ¥å£
auto eth2
iface eth2 inet static
address 10.10.10.101
netmask 255.255.255.0
```

**ğŸ”¸ é˜²ç«å¢™é…ç½®**
```bash
# MGRå¿…è¦ç«¯å£é…ç½®
# 3306: MySQLæœåŠ¡ç«¯å£
# 33061: MGRé€šä¿¡ç«¯å£

# ä¸šåŠ¡ç½‘ç»œè§„åˆ™
iptables -A INPUT -s 192.168.10.0/24 -p tcp --dport 3306 -j ACCEPT

# MGRå¤åˆ¶ç½‘ç»œè§„åˆ™
iptables -A INPUT -s 10.10.10.0/24 -p tcp --dport 33061 -j ACCEPT
iptables -A INPUT -s 10.10.10.0/24 -p tcp --dport 3306 -j ACCEPT

# ç®¡ç†ç½‘ç»œè§„åˆ™
iptables -A INPUT -s 192.168.20.0/24 -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -s 192.168.20.0/24 -p tcp --dport 3306 -j ACCEPT
```

### 3.3 ç½‘ç»œä¼˜åŒ–é…ç½®


**ğŸ”¸ ç½‘ç»œå‚æ•°è°ƒä¼˜**
```bash
# å¢åŠ ç½‘ç»œç¼“å†²åŒº
echo 'net.core.rmem_max = 134217728' >> /etc/sysctl.conf
echo 'net.core.wmem_max = 134217728' >> /etc/sysctl.conf

# è°ƒæ•´TCPå‚æ•°
echo 'net.ipv4.tcp_rmem = 4096 65536 134217728' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_wmem = 4096 65536 134217728' >> /etc/sysctl.conf

# åº”ç”¨é…ç½®
sysctl -p
```

---

## 4. ğŸ”’ å®‰å…¨ç­–ç•¥å®æ–½


### 4.1 å®‰å…¨ä½“ç³»è®¾è®¡


**ğŸ”¸ å®‰å…¨å¨èƒåˆ†æ**
```
æ½œåœ¨å¨èƒï¼š
â€¢ æ•°æ®æ³„éœ²ï¼šæœªç»æˆæƒè®¿é—®æ•æ„Ÿæ•°æ®
â€¢ æ•°æ®ç¯¡æ”¹ï¼šæ¶æ„ä¿®æ”¹æˆ–åˆ é™¤æ•°æ®
â€¢ æœåŠ¡ä¸­æ–­ï¼šDDoSæ”»å‡»æˆ–ç³»ç»Ÿå…¥ä¾µ
â€¢ å†…éƒ¨å¨èƒï¼šå†…éƒ¨äººå‘˜çš„æ¶æ„è¡Œä¸º

å®‰å…¨ç›®æ ‡ï¼š
â€¢ æ•°æ®æœºå¯†æ€§ï¼šæ•°æ®ä¼ è¾“å’Œå­˜å‚¨åŠ å¯†
â€¢ æ•°æ®å®Œæ•´æ€§ï¼šé˜²æ­¢æ•°æ®è¢«æ¶æ„ç¯¡æ”¹
â€¢ ç³»ç»Ÿå¯ç”¨æ€§ï¼šç¡®ä¿æœåŠ¡æŒç»­ç¨³å®š
â€¢ è®¿é—®æ§åˆ¶ï¼šä¸¥æ ¼çš„æƒé™ç®¡ç†
```

**ğŸ”¸ å®‰å…¨æ¶æ„å›¾**
```
å®‰å…¨é˜²æŠ¤å±‚æ¬¡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åº”ç”¨å±‚å®‰å…¨                  â”‚
â”‚     â”œâ”€ SQLæ³¨å…¥é˜²æŠ¤                   â”‚
â”‚     â”œâ”€ åº”ç”¨å±‚è®¿é—®æ§åˆ¶                 â”‚
â”‚     â””â”€ æ•°æ®è„±æ•                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ç½‘ç»œå±‚å®‰å…¨                  â”‚
â”‚     â”œâ”€ é˜²ç«å¢™è§„åˆ™                    â”‚
â”‚     â”œâ”€ VPN/ä¸“çº¿                     â”‚
â”‚     â””â”€ ç½‘ç»œéš”ç¦»                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ•°æ®åº“å±‚å®‰å…¨                â”‚
â”‚     â”œâ”€ ç”¨æˆ·æƒé™æ§åˆ¶                   â”‚
â”‚     â”œâ”€ SSL/TLSåŠ å¯†                  â”‚
â”‚     â””â”€ å®¡è®¡æ—¥å¿—                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           æ“ä½œç³»ç»Ÿå®‰å…¨                â”‚
â”‚     â”œâ”€ ç³»ç»Ÿç”¨æˆ·ç®¡ç†                   â”‚
â”‚     â”œâ”€ æ–‡ä»¶æƒé™æ§åˆ¶                   â”‚
â”‚     â””â”€ ç³»ç»Ÿè¡¥ä¸ç®¡ç†                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 æ•°æ®åº“å®‰å…¨é…ç½®


**ğŸ”¸ ç”¨æˆ·æƒé™ç®¡ç†**
```sql
-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼Œé¿å…ä½¿ç”¨root
-- åº”ç”¨è¿æ¥ç”¨æˆ·ï¼ˆåªè¯»æƒé™ï¼‰
CREATE USER 'app_read'@'192.168.10.%' IDENTIFIED BY 'StrongPassword123!';
GRANT SELECT ON ecommerce.* TO 'app_read'@'192.168.10.%';

-- åº”ç”¨è¿æ¥ç”¨æˆ·ï¼ˆè¯»å†™æƒé™ï¼‰
CREATE USER 'app_write'@'192.168.10.%' IDENTIFIED BY 'StrongPassword456!';
GRANT SELECT, INSERT, UPDATE, DELETE ON ecommerce.* TO 'app_write'@'192.168.10.%';

-- å¤‡ä»½ç”¨æˆ·
CREATE USER 'backup_user'@'192.168.20.%' IDENTIFIED BY 'BackupPassword789!';
GRANT SELECT, LOCK TABLES, RELOAD ON *.* TO 'backup_user'@'192.168.20.%';

-- MGRå¤åˆ¶ç”¨æˆ·
CREATE USER 'repl_user'@'10.10.10.%' IDENTIFIED BY 'ReplPassword101!';
GRANT REPLICATION SLAVE, BACKUP_ADMIN ON *.* TO 'repl_user'@'10.10.10.%';
```

**ğŸ”¸ SSL/TLSåŠ å¯†é…ç½®**
```ini
# my.cnf SSLé…ç½®
[mysql]
ssl-ca=/etc/mysql/ssl/ca.pem
ssl-cert=/etc/mysql/ssl/server-cert.pem
ssl-key=/etc/mysql/ssl/server-key.pem

# å¼ºåˆ¶SSLè¿æ¥
require_secure_transport = ON

# MGR SSLé…ç½®
[mysql]
group_replication_ssl_mode = REQUIRED
group_replication_recovery_use_ssl = ON
```

**ğŸ”¸ SSLè¯ä¹¦ç”Ÿæˆç¤ºä¾‹**
```bash
# ç”ŸæˆCAç§é’¥
openssl genrsa -out ca-key.pem 4096

# ç”ŸæˆCAè¯ä¹¦
openssl req -new -x509 -key ca-key.pem -out ca.pem -days 3650 \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=Company/CN=MySQL-CA"

# ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server-key.pem 4096

# ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦è¯·æ±‚
openssl req -new -key server-key.pem -out server-req.pem \
  -subj "/C=CN/ST=Beijing/L=Beijing/O=Company/CN=mysql-server"

# ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -in server-req.pem -CA ca.pem -CAkey ca-key.pem \
  -out server-cert.pem -days 365 -CAcreateserial
```

### 4.3 å®¡è®¡å’Œç›‘æ§


**ğŸ”¸ å®¡è®¡æ—¥å¿—é…ç½®**
```ini
# my.cnfå®¡è®¡é…ç½®
[mysqld]
# å¯ç”¨å®¡è®¡æ—¥å¿—
audit_log_policy = ALL
audit_log_format = JSON
audit_log_file = /var/log/mysql/audit.log
audit_log_rotate_on_size = 100M
audit_log_rotations = 10

# è®°å½•æ…¢æŸ¥è¯¢
slow_query_log = ON
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2

# è®°å½•é”™è¯¯æ—¥å¿—
log_error = /var/log/mysql/error.log
log_error_verbosity = 2
```

**ğŸ”¸ å…³é”®äº‹ä»¶ç›‘æ§**
```bash
# ç›‘æ§è„šæœ¬ç¤ºä¾‹ï¼šæ£€æŸ¥ç™»å½•å¤±è´¥
#!/bin/bash
# monitor_failed_login.sh

LOG_FILE="/var/log/mysql/audit.log"
ALERT_THRESHOLD=5
TIME_WINDOW=300  # 5åˆ†é’Ÿ

# ç»Ÿè®¡æœ€è¿‘5åˆ†é’Ÿçš„ç™»å½•å¤±è´¥æ¬¡æ•°
CURRENT_TIME=$(date +%s)
START_TIME=$((CURRENT_TIME - TIME_WINDOW))

FAILED_COUNT=$(grep -c "Access denied" $LOG_FILE | \
  awk -v start=$START_TIME '$1 > start')

if [ $FAILED_COUNT -gt $ALERT_THRESHOLD ]; then
    echo "è­¦å‘Šï¼šæœ€è¿‘5åˆ†é’Ÿæœ‰ $FAILED_COUNT æ¬¡ç™»å½•å¤±è´¥"
    # å‘é€å‘Šè­¦é‚®ä»¶æˆ–çŸ­ä¿¡
fi
```

---

## 5. ğŸš€ éƒ¨ç½²æ­¥éª¤è¯¦è§£


### 5.1 ç¯å¢ƒå‡†å¤‡


**ğŸ”¸ ç³»ç»ŸåŸºç¡€é…ç½®**
```bash
# 1. ç³»ç»Ÿæ›´æ–°
yum update -y

# 2. å…³é—­SELinuxï¼ˆç®€åŒ–é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå¯é€‰æ‹©é…ç½®ï¼‰
setenforce 0
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config

# 3. é…ç½®ä¸»æœºåå’Œhostsæ–‡ä»¶
hostnamectl set-hostname mysql-node1

# ç¼–è¾‘/etc/hosts
cat >> /etc/hosts << EOF
10.10.10.101 mysql-node1
10.10.10.102 mysql-node2
10.10.10.103 mysql-node3
EOF

# 4. æ—¶é—´åŒæ­¥ï¼ˆMGRè¦æ±‚æ—¶é—´ä¸€è‡´ï¼‰
yum install -y chrony
systemctl enable chronyd
systemctl start chronyd
```

**ğŸ”¸ MySQLå®‰è£…**
```bash
# 1. ä¸‹è½½MySQL 8.0 YUMæº
wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
rpm -ivh mysql80-community-release-el7-3.noarch.rpm

# 2. å®‰è£…MySQL
yum install -y mysql-community-server

# 3. å¯åŠ¨MySQLå¹¶è®¾ç½®å¼€æœºè‡ªå¯
systemctl enable mysqld
systemctl start mysqld

# 4. è·å–ä¸´æ—¶å¯†ç 
TEMP_PASSWORD=$(grep 'temporary password' /var/log/mysqld.log | awk '{print $NF}')
echo "ä¸´æ—¶å¯†ç : $TEMP_PASSWORD"

# 5. ä¿®æ”¹rootå¯†ç 
mysql -uroot -p$TEMP_PASSWORD --connect-expired-password << EOF
ALTER USER 'root'@'localhost' IDENTIFIED BY 'NewRootPassword123!';
FLUSH PRIVILEGES;
EOF
```

### 5.2 MGRåŸºç¡€é…ç½®


**ğŸ”¸ é…ç½®æ–‡ä»¶è¯¦è§£**
```ini
# /etc/my.cnf - å®Œæ•´é…ç½®æ–‡ä»¶
[mysqld]
# åŸºç¡€é…ç½®
server_id = 1  # æ¯ä¸ªèŠ‚ç‚¹ä¸åŒï¼š1,2,3
bind-address = 0.0.0.0
port = 3306

# æ•°æ®ç›®å½•
datadir = /var/lib/mysql
socket = /var/lib/mysql/mysql.sock

# æ—¥å¿—é…ç½®
log_error = /var/log/mysqld.log
log_bin = mysql-bin
binlog_format = ROW
binlog_checksum = NONE
gtid_mode = ON
enforce_gtid_consistency = ON

# InnoDBé…ç½®
innodb_buffer_pool_size = 40G  # æ ¹æ®å†…å­˜è°ƒæ•´
innodb_log_file_size = 1G
innodb_flush_log_at_trx_commit = 1
innodb_doublewrite = ON

# MGRä¸“ç”¨é…ç½®
# å¤åˆ¶ç›¸å…³
log_slave_updates = ON
relay_log_recovery = ON
slave_preserve_commit_order = ON

# Group Replicationé…ç½®
plugin_load_add = 'group_replication.so'
group_replication_group_name = "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
group_replication_start_on_boot = OFF
group_replication_local_address = "10.10.10.101:33061"
group_replication_group_seeds = "10.10.10.101:33061,10.10.10.102:33061,10.10.10.103:33061"
group_replication_bootstrap_group = OFF

# å•ä¸»æ¨¡å¼é…ç½®
group_replication_single_primary_mode = ON
group_replication_enforce_update_everywhere_checks = OFF

# ç½‘ç»œå’Œæ€§èƒ½é…ç½®
group_replication_ip_whitelist = "10.10.10.0/24"
group_replication_communication_max_message_size = 10M
```

**ğŸ”¸ å…³é”®å‚æ•°è¯´æ˜**
```
server_idï¼š
â€¢ ä½œç”¨ï¼šå”¯ä¸€æ ‡è¯†æ¯ä¸ªMySQLå®ä¾‹
â€¢ è®¾ç½®ï¼šæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»ä¸åŒ
â€¢ ç¤ºä¾‹ï¼šNode1=1, Node2=2, Node3=3

group_replication_group_nameï¼š
â€¢ ä½œç”¨ï¼šæ ‡è¯†MGRé›†ç¾¤çš„å”¯ä¸€ID
â€¢ æ ¼å¼ï¼šUUIDæ ¼å¼çš„å­—ç¬¦ä¸²
â€¢ æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ç›¸åŒ

group_replication_local_addressï¼š
â€¢ ä½œç”¨ï¼šæœ¬èŠ‚ç‚¹çš„ç›‘å¬åœ°å€å’Œç«¯å£
â€¢ æ ¼å¼ï¼šIP:PORT
â€¢ æ³¨æ„ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„IPä¸åŒï¼Œç«¯å£é€šå¸¸ç›¸åŒ

group_replication_group_seedsï¼š
â€¢ ä½œç”¨ï¼šé›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„åœ°å€åˆ—è¡¨
â€¢ æ ¼å¼ï¼šç”¨é€—å·åˆ†éš”çš„åœ°å€åˆ—è¡¨
â€¢ æ³¨æ„ï¼šæ‰€æœ‰èŠ‚ç‚¹é…ç½®ç›¸åŒ
```

### 5.3 MGRé›†ç¾¤å¯åŠ¨


**ğŸ”¸ ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¼•å¯¼èŠ‚ç‚¹ï¼‰**
```sql
-- 1. åˆ›å»ºå¤åˆ¶ç”¨æˆ·
CREATE USER 'repl_user'@'%' IDENTIFIED BY 'ReplPassword123!';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'%';
FLUSH PRIVILEGES;

-- 2. é…ç½®å¤åˆ¶é€šé“
CHANGE MASTER TO MASTER_USER='repl_user', MASTER_PASSWORD='ReplPassword123!' 
FOR CHANNEL 'group_replication_recovery';

-- 3. å®‰è£…MGRæ’ä»¶
INSTALL PLUGIN group_replication SONAME 'group_replication.so';

-- 4. å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¼•å¯¼æ¨¡å¼ï¼‰
SET GLOBAL group_replication_bootstrap_group=ON;
START GROUP_REPLICATION;
SET GLOBAL group_replication_bootstrap_group=OFF;

-- 5. éªŒè¯çŠ¶æ€
SELECT * FROM performance_schema.replication_group_members;
```

**ğŸ”¸ åç»­èŠ‚ç‚¹åŠ å…¥**
```sql
-- åœ¨Node2å’ŒNode3ä¸Šæ‰§è¡Œ

-- 1. åˆ›å»ºå¤åˆ¶ç”¨æˆ·ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦åˆ›å»ºï¼‰
CREATE USER 'repl_user'@'%' IDENTIFIED BY 'ReplPassword123!';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'%';
FLUSH PRIVILEGES;

-- 2. é…ç½®å¤åˆ¶é€šé“
CHANGE MASTER TO MASTER_USER='repl_user', MASTER_PASSWORD='ReplPassword123!' 
FOR CHANNEL 'group_replication_recovery';

-- 3. å®‰è£…MGRæ’ä»¶
INSTALL PLUGIN group_replication SONAME 'group_replication.so';

-- 4. åŠ å…¥é›†ç¾¤ï¼ˆä¸éœ€è¦bootstrapï¼‰
START GROUP_REPLICATION;

-- 5. éªŒè¯èŠ‚ç‚¹åŠ å…¥
SELECT * FROM performance_schema.replication_group_members;
```

**ğŸ”¸ é›†ç¾¤çŠ¶æ€éªŒè¯**
```sql
-- æŸ¥çœ‹é›†ç¾¤æˆå‘˜çŠ¶æ€
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE 
FROM performance_schema.replication_group_members;

-- é¢„æœŸç»“æœï¼š
+--------------------------------------+-------------+-------------+--------------+-------------+
| MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE |
+--------------------------------------+-------------+-------------+--------------+-------------+
| aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa | mysql-node1 |        3306 | ONLINE       | PRIMARY     |
| bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb | mysql-node2 |        3306 | ONLINE       | SECONDARY   |
| cccccccc-cccc-cccc-cccc-cccccccccccc | mysql-node3 |        3306 | ONLINE       | SECONDARY   |
+--------------------------------------+-------------+-------------+--------------+-------------+

-- æŸ¥çœ‹å¤åˆ¶çŠ¶æ€
SHOW SLAVE STATUS FOR CHANNEL 'group_replication_applier'\G
```

---

## 6. âœ… éªŒè¯æµ‹è¯•æ–¹æ³•


### 6.1 åŠŸèƒ½éªŒè¯æµ‹è¯•


**ğŸ”¸ æ•°æ®åŒæ­¥éªŒè¯**
```sql
-- åœ¨ä¸»èŠ‚ç‚¹ï¼ˆNode1ï¼‰ä¸Šæ‰§è¡Œ
CREATE DATABASE test_mgr;
USE test_mgr;

CREATE TABLE sync_test (
    id INT AUTO_INCREMENT PRIMARY KEY,
    node_name VARCHAR(50),
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO sync_test (node_name) VALUES ('inserted_from_node1');

-- åœ¨ä»èŠ‚ç‚¹ï¼ˆNode2, Node3ï¼‰ä¸ŠéªŒè¯
USE test_mgr;
SELECT * FROM sync_test;

-- é¢„æœŸç»“æœï¼šåœ¨æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„æ•°æ®
```

**ğŸ”¸ æ•…éšœè½¬ç§»éªŒè¯**
```bash
# æ¨¡æ‹Ÿä¸»èŠ‚ç‚¹æ•…éšœ
# åœ¨Node1ä¸Šåœæ­¢MySQLæœåŠ¡
systemctl stop mysqld

# åœ¨Node2ä¸Šæ£€æŸ¥æ–°çš„ä¸»èŠ‚ç‚¹é€‰ä¸¾
mysql -uroot -p -e "
SELECT 
    MEMBER_HOST,
    MEMBER_STATE,
    MEMBER_ROLE 
FROM performance_schema.replication_group_members;"

# é¢„æœŸç»“æœï¼šNode2æˆ–Node3æˆä¸ºæ–°çš„PRIMARY
```

**ğŸ”¸ ç½‘ç»œåˆ†åŒºæµ‹è¯•**
```bash
# æ¨¡æ‹Ÿç½‘ç»œåˆ†åŒº
# åœ¨Node1ä¸Šä¸´æ—¶é˜»æ–­ä¸å…¶ä»–èŠ‚ç‚¹çš„é€šä¿¡
iptables -A INPUT -s 10.10.10.102 -j DROP
iptables -A INPUT -s 10.10.10.103 -j DROP
iptables -A OUTPUT -d 10.10.10.102 -j DROP
iptables -A OUTPUT -d 10.10.10.103 -j DROP

# æ£€æŸ¥é›†ç¾¤çŠ¶æ€å˜åŒ–
# é¢„æœŸï¼šNode1ä¼šå˜ä¸ºOFFLINEï¼ŒNode2å’ŒNode3ç»§ç»­ç»„æˆå¤šæ•°æ´¾
```

### 6.2 æ€§èƒ½éªŒè¯æµ‹è¯•


**ğŸ”¸ åŸºå‡†æ€§èƒ½æµ‹è¯•**
```bash
# ä½¿ç”¨sysbenchè¿›è¡Œæ€§èƒ½æµ‹è¯•
# å®‰è£…sysbench
yum install -y sysbench

# åˆ›å»ºæµ‹è¯•æ•°æ®
sysbench /usr/share/sysbench/oltp_read_write.lua \
    --mysql-host=192.168.10.101 \
    --mysql-port=3306 \
    --mysql-user=test_user \
    --mysql-password=test_pass \
    --mysql-db=test_db \
    --table-size=100000 \
    --tables=10 \
    prepare

# æ‰§è¡Œè¯»å†™æ··åˆæµ‹è¯•
sysbench /usr/share/sysbench/oltp_read_write.lua \
    --mysql-host=192.168.10.101 \
    --mysql-port=3306 \
    --mysql-user=test_user \
    --mysql-password=test_pass \
    --mysql-db=test_db \
    --table-size=100000 \
    --tables=10 \
    --threads=16 \
    --time=300 \
    --report-interval=10 \
    run
```

**ğŸ”¸ å¹¶å‘æµ‹è¯•**
```bash
# å¤šçº¿ç¨‹å¹¶å‘å†™å…¥æµ‹è¯•
# æµ‹è¯•è„šæœ¬ï¼šconcurrent_test.sh
#!/bin/bash

# å¹¶å‘è¿æ¥æ•°
THREADS=50
# æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œæ¬¡æ•°
ITERATIONS=1000

for i in $(seq 1 $THREADS); do
    {
        for j in $(seq 1 $ITERATIONS); do
            mysql -h192.168.10.101 -utest_user -ptest_pass -e "
                INSERT INTO test_mgr.sync_test (node_name) 
                VALUES ('thread_${i}_iter_${j}');"
        done
    } &
done

wait
echo "å¹¶å‘æµ‹è¯•å®Œæˆ"
```

### 6.3 æ•°æ®ä¸€è‡´æ€§éªŒè¯


**ğŸ”¸ æ•°æ®æ ¡éªŒè„šæœ¬**
```bash
#!/bin/bash
# data_consistency_check.sh

NODES=("192.168.10.101" "192.168.10.102" "192.168.10.103")
USER="test_user"
PASS="test_pass"
DB="test_mgr"
TABLE="sync_test"

echo "å¼€å§‹æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥..."

# è·å–æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ‘˜è¦
for node in "${NODES[@]}"; do
    echo "æ£€æŸ¥èŠ‚ç‚¹: $node"
    CHECKSUM=$(mysql -h$node -u$USER -p$PASS -D$DB -e "
        SELECT COUNT(*), SUM(CRC32(CONCAT(id, node_name))) as checksum 
        FROM $TABLE;" -s | tail -1)
    echo "èŠ‚ç‚¹ $node æ•°æ®æ‘˜è¦: $CHECKSUM"
done

echo "æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å®Œæˆ"
```

---

## 7. ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•


### 7.1 æµ‹è¯•ç¯å¢ƒå‡†å¤‡


**ğŸ”¸ æµ‹è¯•å·¥å…·å®‰è£…**
```bash
# å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·
yum install -y sysbench mysql-client

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
mysql -uroot -p << EOF
CREATE USER 'bench_user'@'%' IDENTIFIED BY 'BenchPassword123!';
GRANT ALL PRIVILEGES ON bench_db.* TO 'bench_user'@'%';
CREATE DATABASE bench_db;
FLUSH PRIVILEGES;
EOF
```

**ğŸ”¸ æµ‹è¯•å‚æ•°é…ç½®**
```bash
# æµ‹è¯•é…ç½®æ–‡ä»¶ï¼šbench_config.conf
MYSQL_HOST="192.168.10.101"
MYSQL_PORT="3306"
MYSQL_USER="bench_user"
MYSQL_PASS="BenchPassword123!"
MYSQL_DB="bench_db"

# æµ‹è¯•å‚æ•°
TABLE_SIZE=1000000      # 100ä¸‡æ¡è®°å½•
TABLE_COUNT=10          # 10ä¸ªè¡¨
THREAD_COUNT=32         # 32ä¸ªå¹¶å‘çº¿ç¨‹
TEST_DURATION=600       # æµ‹è¯•10åˆ†é’Ÿ
```

### 7.2 åŸºå‡†æµ‹è¯•æ‰§è¡Œ


**ğŸ”¸ è¯»å†™æ··åˆæµ‹è¯•**
```bash
# 1. å‡†å¤‡æµ‹è¯•æ•°æ®
sysbench oltp_read_write \
    --mysql-host=$MYSQL_HOST \
    --mysql-port=$MYSQL_PORT \
    --mysql-user=$MYSQL_USER \
    --mysql-password=$MYSQL_PASS \
    --mysql-db=$MYSQL_DB \
    --table-size=$TABLE_SIZE \
    --tables=$TABLE_COUNT \
    prepare

# 2. æ‰§è¡Œè¯»å†™æ··åˆæµ‹è¯•
sysbench oltp_read_write \
    --mysql-host=$MYSQL_HOST \
    --mysql-port=$MYSQL_PORT \
    --mysql-user=$MYSQL_USER \
    --mysql-password=$MYSQL_PASS \
    --mysql-db=$MYSQL_DB \
    --table-size=$TABLE_SIZE \
    --tables=$TABLE_COUNT \
    --threads=$THREAD_COUNT \
    --time=$TEST_DURATION \
    --report-interval=10 \
    --percentile=95 \
    run
```

**ğŸ”¸ åªè¯»æ€§èƒ½æµ‹è¯•**
```bash
# åªè¯»æµ‹è¯•ï¼ˆæµ‹è¯•è¯»æ€§èƒ½å’Œè´Ÿè½½å‡è¡¡ï¼‰
for node in 192.168.10.101 192.168.10.102 192.168.10.103; do
    echo "æµ‹è¯•èŠ‚ç‚¹: $node"
    sysbench oltp_read_only \
        --mysql-host=$node \
        --mysql-port=3306 \
        --mysql-user=$MYSQL_USER \
        --mysql-password=$MYSQL_PASS \
        --mysql-db=$MYSQL_DB \
        --table-size=$TABLE_SIZE \
        --tables=$TABLE_COUNT \
        --threads=16 \
        --time=300 \
        --report-interval=10 \
        run
done
```

### 7.3 æ€§èƒ½åŸºå‡†åˆ†æ


**ğŸ”¸ å…¸å‹æ€§èƒ½æŒ‡æ ‡**
```
TPS (Transactions Per Second)ï¼š
â€¢ è¡¡é‡ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç†èƒ½åŠ›
â€¢ MGRç¯å¢ƒï¼šé€šå¸¸æ¯”å•æœºä¸‹é™10-30%
â€¢ æœŸæœ›å€¼ï¼šä¸­å‹é…ç½® > 5000 TPS

QPS (Queries Per Second)ï¼š
â€¢ è¡¡é‡æŸ¥è¯¢å¤„ç†èƒ½åŠ›  
â€¢ è¯»æ“ä½œï¼šå¯é€šè¿‡å¤šèŠ‚ç‚¹æå‡
â€¢ æœŸæœ›å€¼ï¼šè¯»æ“ä½œ > 50000 QPS

å“åº”æ—¶é—´ï¼š
â€¢ 95%å“åº”æ—¶é—´ < 50msï¼ˆè¯»æ“ä½œï¼‰
â€¢ 95%å“åº”æ—¶é—´ < 100msï¼ˆå†™æ“ä½œï¼‰
â€¢ å¹³å‡å“åº”æ—¶é—´ < 20ms

å¤åˆ¶å»¶è¿Ÿï¼š
â€¢ MGRåŒæ­¥å¤åˆ¶ï¼Œå»¶è¿Ÿé€šå¸¸ < 10ms
â€¢ ç½‘ç»œå»¶è¿Ÿæ˜¯ä¸»è¦å½±å“å› ç´ 
```

**ğŸ”¸ æ€§èƒ½æŠ¥å‘Šç¤ºä¾‹**
```
æµ‹è¯•ç»“æœåˆ†ææŠ¥å‘Šï¼š

ç¯å¢ƒé…ç½®ï¼š
- ç¡¬ä»¶ï¼š3èŠ‚ç‚¹ï¼Œ16æ ¸/64GB/SSD
- ç½‘ç»œï¼šåƒå…†ç½‘ç»œï¼Œå»¶è¿Ÿ<1ms
- æ•°æ®ï¼š10ä¸ªè¡¨ï¼Œæ¯è¡¨100ä¸‡è®°å½•

è¯»å†™æ··åˆæµ‹è¯•ï¼ˆ70%è¯»ï¼Œ30%å†™ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‡æ ‡          â”‚ å•æœºæ¨¡å¼  â”‚ MGRæ¨¡å¼   â”‚ æ€§èƒ½æ¯”   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TPS          â”‚ 8,500    â”‚ 6,800    â”‚ 80%      â”‚
â”‚ QPS          â”‚ 85,000   â”‚ 68,000   â”‚ 80%      â”‚
â”‚ å¹³å‡å“åº”æ—¶é—´   â”‚ 12ms     â”‚ 18ms     â”‚ -50%     â”‚
â”‚ 95%å“åº”æ—¶é—´   â”‚ 25ms     â”‚ 35ms     â”‚ -40%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“è®ºï¼š
âœ… æ€§èƒ½ä¸‹é™åœ¨å¯æ¥å—èŒƒå›´å†…ï¼ˆ20%ï¼‰
âœ… è·å¾—é«˜å¯ç”¨æ€§ä¿éšœ
âœ… æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Œå¯æ‰©å±•è¯»æ€§èƒ½
```

---

## 8. ğŸ“ˆ ç›‘æ§ä½“ç³»å»ºè®¾


### 8.1 ç›‘æ§æ¶æ„è®¾è®¡


**ğŸ”¸ ç›‘æ§å±‚æ¬¡ç»“æ„**
```
ç›‘æ§ä½“ç³»æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å‘Šè­¦å±‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ é‚®ä»¶å‘Šè­¦  â”‚ çŸ­ä¿¡å‘Šè­¦  â”‚ ä¼ä¸šå¾®ä¿¡  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            å±•ç¤ºå±‚                    â”‚
â”‚         Grafanaä»ªè¡¨æ¿               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            å­˜å‚¨å±‚                    â”‚
â”‚    Prometheusæ—¶åºæ•°æ®åº“             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            é‡‡é›†å±‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚MySQL     â”‚Node      â”‚MGR       â”‚ â”‚
â”‚  â”‚Exporter  â”‚Exporter  â”‚Monitor   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            æ•°æ®æº                    â”‚
â”‚    MySQL MGRé›†ç¾¤(3ä¸ªèŠ‚ç‚¹)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ç›‘æ§æŒ‡æ ‡è®¾è®¡


**ğŸ”¸ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**
```
MySQLåŸºç¡€æŒ‡æ ‡ï¼š
â€¢ è¿æ¥æ•°ï¼šå½“å‰è¿æ¥/æœ€å¤§è¿æ¥æ¯”ä¾‹
â€¢ TPS/QPSï¼šäº‹åŠ¡å’ŒæŸ¥è¯¢å¤„ç†é€Ÿåº¦
â€¢ å“åº”æ—¶é—´ï¼šæŸ¥è¯¢æ‰§è¡Œæ—¶é—´åˆ†å¸ƒ
â€¢ ç¼“å†²æ± å‘½ä¸­ç‡ï¼šå†…å­˜ä½¿ç”¨æ•ˆç‡
â€¢ é”ç­‰å¾…ï¼šé”ç«äº‰æƒ…å†µ

MGRä¸“ç”¨æŒ‡æ ‡ï¼š
â€¢ é›†ç¾¤æˆå‘˜çŠ¶æ€ï¼šONLINE/OFFLINE/ERROR
â€¢ ä¸»èŠ‚ç‚¹çŠ¶æ€ï¼šè°æ˜¯å½“å‰ä¸»èŠ‚ç‚¹
â€¢ å¤åˆ¶å»¶è¿Ÿï¼šäº‹åŠ¡åº”ç”¨å»¶è¿Ÿ
â€¢ ç½‘ç»œæµé‡ï¼šèŠ‚ç‚¹é—´å¤åˆ¶æµé‡
â€¢ å†²çªæ£€æµ‹ï¼šäº‹åŠ¡å†²çªç»Ÿè®¡

ç³»ç»Ÿèµ„æºæŒ‡æ ‡ï¼š
â€¢ CPUä½¿ç”¨ç‡ï¼šç³»ç»Ÿè´Ÿè½½
â€¢ å†…å­˜ä½¿ç”¨ç‡ï¼šå†…å­˜æ¶ˆè€—
â€¢ ç£ç›˜IOï¼šIOPSå’Œå»¶è¿Ÿ
â€¢ ç½‘ç»œIOï¼šå¸¦å®½ä½¿ç”¨æƒ…å†µ
```

**ğŸ”¸ Prometheusé…ç½®**
```yaml
# prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "mysql_rules.yml"

scrape_configs:
  # MySQLç›‘æ§
  - job_name: 'mysql'
    static_configs:
      - targets: 
        - '192.168.20.101:9104'
        - '192.168.20.102:9104'
        - '192.168.20.103:9104'
    scrape_interval: 10s

  # ç³»ç»Ÿç›‘æ§
  - job_name: 'node'
    static_configs:
      - targets:
        - '192.168.20.101:9100'
        - '192.168.20.102:9100'
        - '192.168.20.103:9100'

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - 'alertmanager:9093'
```

**ğŸ”¸ MySQL Exporteréƒ¨ç½²**
```bash
# 1. ä¸‹è½½MySQL Exporter
wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz
tar xzf mysqld_exporter-0.14.0.linux-amd64.tar.gz
cp mysqld_exporter-0.14.0.linux-amd64/mysqld_exporter /usr/local/bin/

# 2. åˆ›å»ºç›‘æ§ç”¨æˆ·
mysql -uroot -p << EOF
CREATE USER 'exporter'@'localhost' IDENTIFIED BY 'ExporterPassword123!';
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'exporter'@'localhost';
FLUSH PRIVILEGES;
EOF

# 3. é…ç½®æ–‡ä»¶
cat > /etc/mysql_exporter.cnf << EOF
[client]
user=exporter
password=ExporterPassword123!
host=localhost
port=3306
EOF

# 4. åˆ›å»ºç³»ç»ŸæœåŠ¡
cat > /etc/systemd/system/mysql_exporter.service << EOF
[Unit]
Description=MySQL Exporter
After=network.target

[Service]
Type=simple
User=nobody
ExecStart=/usr/local/bin/mysqld_exporter --config.my-cnf=/etc/mysql_exporter.cnf
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 5. å¯åŠ¨æœåŠ¡
systemctl enable mysql_exporter
systemctl start mysql_exporter
```

### 8.3 å‘Šè­¦è§„åˆ™é…ç½®


**ğŸ”¸ å…³é”®å‘Šè­¦è§„åˆ™**
```yaml
# mysql_rules.yml
groups:
- name: mysql_mgr_alerts
  rules:
  # MySQLæœåŠ¡å¯ç”¨æ€§
  - alert: MySQLDown
    expr: mysql_up == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "MySQLå®ä¾‹ {{ $labels.instance }} ä¸å¯ç”¨"
      description: "MySQLæœåŠ¡å·²åœæ­¢è¶…è¿‡30ç§’"

  # MGRé›†ç¾¤æˆå‘˜å¼‚å¸¸
  - alert: MGRMemberOffline
    expr: mysql_group_replication_member_state != 1
    for: 60s
    labels:
      severity: critical
    annotations:
      summary: "MGRæˆå‘˜ {{ $labels.instance }} çŠ¶æ€å¼‚å¸¸"
      description: "é›†ç¾¤æˆå‘˜çŠ¶æ€ä¸æ˜¯ONLINE"

  # è¿æ¥æ•°è¿‡é«˜
  - alert: HighConnections
    expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections > 0.8
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "{{ $labels.instance }} è¿æ¥æ•°è¿‡é«˜"
      description: "è¿æ¥æ•°ä½¿ç”¨ç‡è¶…è¿‡80%"

  # å¤åˆ¶å»¶è¿Ÿ
  - alert: ReplicationLag
    expr: mysql_slave_lag_seconds > 10
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "{{ $labels.instance }} å¤åˆ¶å»¶è¿Ÿè¿‡é«˜"
      description: "å¤åˆ¶å»¶è¿Ÿè¶…è¿‡10ç§’"

  # ç£ç›˜ç©ºé—´ä¸è¶³
  - alert: DiskSpaceLow
    expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) < 0.1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "{{ $labels.instance }} ç£ç›˜ç©ºé—´ä¸è¶³"
      description: "æ ¹åˆ†åŒºå¯ç”¨ç©ºé—´å°‘äº10%"
```

---

## 9. ğŸ”§ è¿ç»´æµç¨‹åˆ¶å®š


### 9.1 æ—¥å¸¸è¿ç»´æ£€æŸ¥æ¸…å•


**ğŸ”¸ æ¯æ—¥æ£€æŸ¥é¡¹ç›®**
```bash
#!/bin/bash
# daily_check.sh - æ¯æ—¥æ£€æŸ¥è„šæœ¬

echo "=== MySQL MGR æ¯æ—¥å¥åº·æ£€æŸ¥ ==="
echo "æ£€æŸ¥æ—¶é—´: $(date)"

# 1. æ£€æŸ¥MGRé›†ç¾¤çŠ¶æ€
echo "1. æ£€æŸ¥MGRé›†ç¾¤çŠ¶æ€"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    MEMBER_HOST,
    MEMBER_STATE,
    MEMBER_ROLE 
FROM performance_schema.replication_group_members;" | column -t

# 2. æ£€æŸ¥MySQLè¿›ç¨‹çŠ¶æ€
echo -e "\n2. æ£€æŸ¥MySQLè¿›ç¨‹çŠ¶æ€"
for node in 192.168.20.101 192.168.20.102 192.168.20.103; do
    echo "èŠ‚ç‚¹ $node:"
    ssh $node "systemctl is-active mysqld"
done

# 3. æ£€æŸ¥è¿æ¥æ•°
echo -e "\n3. æ£€æŸ¥è¿æ¥æ•°"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    $$hostname as host,
    $$max_connections as max_conn,
    (SELECT COUNT(*) FROM information_schema.processlist) as current_conn,
    ROUND((SELECT COUNT(*) FROM information_schema.processlist) / $$max_connections * 100, 2) as usage_percent;"

# 4. æ£€æŸ¥æ…¢æŸ¥è¯¢
echo -e "\n4. æ£€æŸ¥æ…¢æŸ¥è¯¢ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    COUNT(*) as slow_queries,
    AVG(query_time) as avg_time,
    MAX(query_time) as max_time
FROM mysql.slow_log 
WHERE start_time > DATE_SUB(NOW(), INTERVAL 1 DAY);"

# 5. æ£€æŸ¥é”™è¯¯æ—¥å¿—
echo -e "\n5. æ£€æŸ¥é”™è¯¯æ—¥å¿—ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰"
tail -100 /var/log/mysqld.log | grep -i error | tail -10

echo -e "\n=== æ£€æŸ¥å®Œæˆ ==="
```

**ğŸ”¸ æ¯å‘¨æ£€æŸ¥é¡¹ç›®**
```bash
#!/bin/bash
# weekly_check.sh - æ¯å‘¨æ·±åº¦æ£€æŸ¥

echo "=== MySQL MGR æ¯å‘¨æ·±åº¦æ£€æŸ¥ ==="

# 1. æ•°æ®åº“å¤§å°åˆ†æ
echo "1. æ•°æ®åº“å¤§å°åˆ†æ"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    table_schema as 'Database',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) as 'Size(MB)',
    COUNT(*) as 'Tables'
FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
GROUP BY table_schema
ORDER BY SUM(data_length + index_length) DESC;"

# 2. ç´¢å¼•ä½¿ç”¨åˆ†æ
echo -e "\n2. æœªä½¿ç”¨çš„ç´¢å¼•åˆ†æ"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    object_schema,
    object_name,
    index_name
FROM performance_schema.table_io_waits_summary_by_index_usage 
WHERE index_name IS NOT NULL 
AND count_star = 0 
AND object_schema NOT IN ('mysql', 'performance_schema', 'sys')
ORDER BY object_schema, object_name;"

# 3. è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
echo -e "\n3. è¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ"
mysql -uroot -p$ROOT_PASS -e "
SELECT 
    tablespace_name,
    file_name,
    ROUND(total_extents * extent_size / 1024 / 1024, 2) as 'Size(MB)',
    ROUND(free_extents * extent_size / 1024 / 1024, 2) as 'Free(MB)'
FROM information_schema.files 
WHERE file_type = 'DATAFILE';"
```

### 9.2 å¤‡ä»½æ¢å¤æµç¨‹


**ğŸ”¸ å¤‡ä»½ç­–ç•¥è®¾è®¡**
```
å¤‡ä»½ç­–ç•¥ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¤‡ä»½ç±»å‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å…¨é‡å¤‡ä»½ï¼šæ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹                   â”‚
â”‚ å¢é‡å¤‡ä»½ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹                    â”‚
â”‚ æ—¥å¿—å¤‡ä»½ï¼šå®æ—¶ï¼ˆbinlogï¼‰                 â”‚
â”‚ é…ç½®å¤‡ä»½ï¼šæ¯å¤©ï¼ˆé…ç½®æ–‡ä»¶ã€è„šæœ¬ç­‰ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å­˜å‚¨ç­–ç•¥ï¼š
â€¢ æœ¬åœ°ä¿ç•™ï¼š7å¤©å…¨é‡ + 7å¤©å¢é‡
â€¢ è¿œç¨‹å­˜å‚¨ï¼š30å¤©å…¨é‡ + 30å¤©å¢é‡
â€¢ é•¿æœŸå½’æ¡£ï¼š12ä¸ªæœˆå…¨é‡ï¼ˆæœˆæœ«ï¼‰
```

**ğŸ”¸ å¤‡ä»½è„šæœ¬**
```bash
#!/bin/bash
# backup_mgr.sh - MGRå¤‡ä»½è„šæœ¬

BACKUP_DIR="/backup/mysql"
REMOTE_DIR="/remote_backup"
DATE=$(date +%Y%m%d_%H%M%S)
LOG_FILE="/var/log/mysql_backup.log"

# è®°å½•æ—¥å¿—å‡½æ•°
log_message() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a $LOG_FILE
}

# å…¨é‡å¤‡ä»½å‡½æ•°
full_backup() {
    log_message "å¼€å§‹å…¨é‡å¤‡ä»½"
    
    # ä½¿ç”¨mysqldumpè¿›è¡Œå¤‡ä»½
    mysqldump -ubackup_user -p$BACKUP_PASS \
        --single-transaction \
        --routines \
        --triggers \
        --events \
        --all-databases \
        --master-data=2 > $BACKUP_DIR/full_backup_$DATE.sql
    
    if [ $? -eq 0 ]; then
        log_message "å…¨é‡å¤‡ä»½å®Œæˆ: full_backup_$DATE.sql"
        
        # å‹ç¼©å¤‡ä»½æ–‡ä»¶
        gzip $BACKUP_DIR/full_backup_$DATE.sql
        log_message "å¤‡ä»½æ–‡ä»¶å·²å‹ç¼©"
        
        # åŒæ­¥åˆ°è¿œç¨‹å­˜å‚¨
        rsync -av $BACKUP_DIR/full_backup_$DATE.sql.gz $REMOTE_DIR/
        log_message "å¤‡ä»½æ–‡ä»¶å·²åŒæ­¥åˆ°è¿œç¨‹å­˜å‚¨"
    else
        log_message "é”™è¯¯: å…¨é‡å¤‡ä»½å¤±è´¥"
        exit 1
    fi
}

# å¢é‡å¤‡ä»½å‡½æ•°
incremental_backup() {
    log_message "å¼€å§‹å¢é‡å¤‡ä»½ï¼ˆæ‹·è´binlogï¼‰"
    
    # è·å–å½“å‰binlogæ–‡ä»¶
    CURRENT_BINLOG=$(mysql -ubackup_user -p$BACKUP_PASS -e "SHOW MASTER STATUS\G" | grep File | awk '{print $2}')
    
    # æ‹·è´binlogæ–‡ä»¶
    cp /var/lib/mysql/mysql-bin.* $BACKUP_DIR/binlog_$DATE/
    
    log_message "å¢é‡å¤‡ä»½å®Œæˆï¼Œbinlogå·²æ‹·è´"
}

# æ¸…ç†æ—§å¤‡ä»½
cleanup_old_backups() {
    log_message "æ¸…ç†7å¤©å‰çš„æœ¬åœ°å¤‡ä»½"
    find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete
    find $BACKUP_DIR -name "binlog_*" -mtime +7 -exec rm -rf {} \;
    log_message "æ—§å¤‡ä»½æ¸…ç†å®Œæˆ"
}

# ä¸»é€»è¾‘
case "$1" in
    full)
        full_backup
        ;;
    incremental)
        incremental_backup
        ;;
    cleanup)
        cleanup_old_backups
        ;;
    *)
        echo "ç”¨æ³•: $0 {full|incremental|cleanup}"
        exit 1
        ;;
esac
```

### 9.3 æ•…éšœå¤„ç†æµç¨‹


**ğŸ”¸ æ•…éšœåˆ†çº§å’Œå“åº”æ—¶é—´**
```
æ•…éšœç­‰çº§åˆ†ç±»ï¼š

P0 - ä¸¥é‡æ•…éšœï¼š
â€¢ æè¿°ï¼šé›†ç¾¤å®Œå…¨ä¸å¯ç”¨ï¼Œä¸šåŠ¡ä¸­æ–­
â€¢ ç¤ºä¾‹ï¼šæ‰€æœ‰èŠ‚ç‚¹å®•æœºã€ç½‘ç»œå®Œå…¨ä¸­æ–­
â€¢ å“åº”æ—¶é—´ï¼š5åˆ†é’Ÿå†…å“åº”ï¼Œ30åˆ†é’Ÿå†…æ¢å¤
â€¢ å¤„ç†äººå‘˜ï¼šä¸»DBA + ç³»ç»Ÿå·¥ç¨‹å¸ˆ

P1 - é«˜çº§æ•…éšœï¼š
â€¢ æè¿°ï¼šéƒ¨åˆ†åŠŸèƒ½å—å½±å“ï¼Œæ€§èƒ½ä¸¥é‡ä¸‹é™
â€¢ ç¤ºä¾‹ï¼šä¸»èŠ‚ç‚¹æ•…éšœã€å•èŠ‚ç‚¹å®•æœº
â€¢ å“åº”æ—¶é—´ï¼š15åˆ†é’Ÿå†…å“åº”ï¼Œ2å°æ—¶å†…æ¢å¤
â€¢ å¤„ç†äººå‘˜ï¼šå€¼ç­DBA

P2 - ä¸­çº§æ•…éšœï¼š
â€¢ æè¿°ï¼šæ€§èƒ½ä¸‹é™ï¼Œä½†åŠŸèƒ½æ­£å¸¸
â€¢ ç¤ºä¾‹ï¼šæ…¢æŸ¥è¯¢å¢å¤šã€è¿æ¥æ•°è¿‡é«˜
â€¢ å“åº”æ—¶é—´ï¼š30åˆ†é’Ÿå†…å“åº”ï¼Œ4å°æ—¶å†…å¤„ç†
â€¢ å¤„ç†äººå‘˜ï¼šè¿ç»´å·¥ç¨‹å¸ˆ

P3 - ä½çº§æ•…éšœï¼š
â€¢ æè¿°ï¼šè½»å¾®é—®é¢˜ï¼Œä¸å½±å“ä¸šåŠ¡
â€¢ ç¤ºä¾‹ï¼šç£ç›˜ç©ºé—´é¢„è­¦ã€ç›‘æ§å‘Šè­¦
â€¢ å“åº”æ—¶é—´ï¼š2å°æ—¶å†…å“åº”ï¼Œ8å°æ—¶å†…å¤„ç†
â€¢ å¤„ç†äººå‘˜ï¼šè¿ç»´å·¥ç¨‹å¸ˆ
```

**ğŸ”¸ æ•…éšœå¤„ç†æ‰‹å†Œ**
```bash
# å¸¸è§æ•…éšœå¤„ç†è„šæœ¬
#!/bin/bash
# incident_response.sh

# æ£€æŸ¥MGRé›†ç¾¤çŠ¶æ€
check_mgr_status() {
    echo "=== MGRé›†ç¾¤çŠ¶æ€æ£€æŸ¥ ==="
    mysql -uroot -p$ROOT_PASS -e "
    SELECT 
        MEMBER_ID,
        MEMBER_HOST,
        MEMBER_PORT,
        MEMBER_STATE,
        MEMBER_ROLE,
        MEMBER_VERSION
    FROM performance_schema.replication_group_members;" 2>/dev/null
    
    if [ $? -ne 0 ]; then
        echo "é”™è¯¯: æ— æ³•è¿æ¥åˆ°MySQL"
        return 1
    fi
}

# é‡å¯æ•…éšœèŠ‚ç‚¹
restart_failed_node() {
    local node_ip=$1
    echo "=== é‡å¯èŠ‚ç‚¹ $node_ip ==="
    
    ssh $node_ip "systemctl restart mysqld"
    sleep 30
    
    # é‡æ–°åŠ å…¥é›†ç¾¤
    ssh $node_ip "mysql -uroot -p$ROOT_PASS -e 'START GROUP_REPLICATION;'"
    
    echo "èŠ‚ç‚¹é‡å¯å®Œæˆï¼Œæ£€æŸ¥çŠ¶æ€..."
    check_mgr_status
}

# æ‰‹åŠ¨æ•…éšœè½¬ç§»
manual_failover() {
    echo "=== æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§» ==="
    
    # æ‰¾åˆ°å½“å‰ä¸»èŠ‚ç‚¹
    PRIMARY_HOST=$(mysql -uroot -p$ROOT_PASS -e "
    SELECT MEMBER_HOST FROM performance_schema.replication_group_members 
    WHERE MEMBER_ROLE='PRIMARY';" -s | tail -1)
    
    echo "å½“å‰ä¸»èŠ‚ç‚¹: $PRIMARY_HOST"
    
    # é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ï¼ˆç¬¬ä¸€ä¸ªSECONDARYï¼‰
    NEW_PRIMARY=$(mysql -uroot -p$ROOT_PASS -e "
    SELECT MEMBER_HOST FROM performance_schema.replication_group_members 
    WHERE MEMBER_ROLE='SECONDARY' LIMIT 1;" -s | tail -1)
    
    echo "æ–°ä¸»èŠ‚ç‚¹: $NEW_PRIMARY"
    
    # åœ¨æ–°ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œåˆ‡æ¢
    mysql -h$NEW_PRIMARY -uroot -p$ROOT_PASS -e "
    SELECT group_replication_set_as_primary('$NEW_PRIMARY');"
    
    echo "æ•…éšœè½¬ç§»å®Œæˆ"
}

# ä¸»å¤„ç†é€»è¾‘
case "$1" in
    check)
        check_mgr_status
        ;;
    restart)
        restart_failed_node $2
        ;;
    failover)
        manual_failover
        ;;
    *)
        echo "ç”¨æ³•: $0 {check|restart <node_ip>|failover}"
        exit 1
        ;;
esac
```

---

## 10. ğŸ› ï¸ é—®é¢˜å¤„ç†è®°å½•


### 10.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ


**ğŸ”¸ é—®é¢˜1ï¼šèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ START GROUP_REPLICATION æ‰§è¡Œå¤±è´¥
â€¢ é”™è¯¯ä¿¡æ¯ï¼šThis member has more executed transactions than...

åŸå› åˆ†æï¼š
æ–°èŠ‚ç‚¹çš„GTIDé›†åˆæ¯”é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ›´æ–°ï¼Œå¯èƒ½æ˜¯ï¼š
â€¢ ä¹‹å‰åœ¨å…¶ä»–é›†ç¾¤ä¸­è¿è¡Œè¿‡
â€¢ æœ¬åœ°æ‰§è¡Œäº†é¢å¤–çš„äº‹åŠ¡

è§£å†³æ–¹æ¡ˆï¼š
1. æ¸…ç©ºæ–°èŠ‚ç‚¹çš„æ•°æ®ï¼ˆå¦‚æœå¯ä»¥ï¼‰
mysql> RESET MASTER;
mysql> RESET SLAVE ALL;

2. æˆ–è€…ä»å…¶ä»–èŠ‚ç‚¹æ¢å¤æ•°æ®
# åœ¨æ­£å¸¸èŠ‚ç‚¹ä¸Šå¤‡ä»½
mysqldump --single-transaction --all-databases > backup.sql

# åœ¨é—®é¢˜èŠ‚ç‚¹ä¸Šæ¢å¤
mysql < backup.sql
mysql> START GROUP_REPLICATION;
```

**ğŸ”¸ é—®é¢˜2ï¼šé›†ç¾¤è„‘è£‚**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ ç½‘ç»œåˆ†åŒºåå‡ºç°å¤šä¸ªä¸»èŠ‚ç‚¹
â€¢ åº”ç”¨è¿æ¥ä¸åŒèŠ‚ç‚¹çœ‹åˆ°ä¸åŒæ•°æ®

åŸå› åˆ†æï¼š
â€¢ ç½‘ç»œåˆ†åŒºå¯¼è‡´é›†ç¾¤åˆ†è£‚
â€¢ é…ç½®é”™è¯¯ï¼Œæ²¡æœ‰æ­£ç¡®çš„ä»²è£æœºåˆ¶

è§£å†³æ–¹æ¡ˆï¼š
1. ç«‹å³åœæ­¢æ‰€æœ‰å†™æ“ä½œ
2. ç¡®å®šå“ªä¸ªåˆ†åŒºæ˜¯"å¤šæ•°æ´¾"
3. åœæ­¢å°‘æ•°æ´¾åˆ†åŒºçš„MGR
4. ä¿®å¤ç½‘ç»œé—®é¢˜
5. é‡æ–°åŠ å…¥èŠ‚ç‚¹

æ“ä½œæ­¥éª¤ï¼š
# åœ¨å°‘æ•°æ´¾èŠ‚ç‚¹ä¸Š
mysql> STOP GROUP_REPLICATION;

# ä¿®å¤ç½‘ç»œåé‡æ–°åŠ å…¥
mysql> START GROUP_REPLICATION;
```

**ğŸ”¸ é—®é¢˜3ï¼šæ€§èƒ½çªç„¶ä¸‹é™**
```
é—®é¢˜ç°è±¡ï¼š
â€¢ TPS/QPSå¤§å¹…ä¸‹é™
â€¢ å“åº”æ—¶é—´æ˜æ˜¾å¢åŠ 
â€¢ å‡ºç°å¤§é‡æ…¢æŸ¥è¯¢

æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥ç³»ç»Ÿèµ„æº
top, iostat, netstat

2. æ£€æŸ¥MySQLçŠ¶æ€
mysql> SHOW PROCESSLIST;
mysql> SHOW ENGINE INNODB STATUS;

3. æ£€æŸ¥MGRç‰¹æœ‰æŒ‡æ ‡
mysql> SELECT * FROM performance_schema.replication_group_member_stats;

å¸¸è§åŸå› å’Œè§£å†³ï¼š
â€¢ ç½‘ç»œå»¶è¿Ÿé«˜ï¼šæ£€æŸ¥ç½‘ç»œè´¨é‡ï¼Œä¼˜åŒ–ç½‘ç»œé…ç½®
â€¢ é”ç«äº‰ä¸¥é‡ï¼šåˆ†æé”ç­‰å¾…ï¼Œä¼˜åŒ–SQLè¯­å¥
â€¢ ç£ç›˜IOç“¶é¢ˆï¼šæ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡ï¼Œè€ƒè™‘å‡çº§å­˜å‚¨
```

### 10.2 æ•…éšœæ¡ˆä¾‹è¯¦ç»†è®°å½•


**ğŸ”¸ æ¡ˆä¾‹1ï¼šä¸»èŠ‚ç‚¹æ„å¤–å®•æœºå¤„ç†**
```
æ•…éšœæ—¶é—´ï¼š2024å¹´3æœˆ15æ—¥ 14:30
æ•…éšœæè¿°ï¼šç”Ÿäº§ç¯å¢ƒä¸»èŠ‚ç‚¹(mysql-node1)å› ç¡¬ä»¶æ•…éšœçªç„¶å®•æœº

å¤„ç†è¿‡ç¨‹ï¼š
14:30 - ç›‘æ§ç³»ç»Ÿå‘å‡ºå‘Šè­¦ï¼Œä¸»èŠ‚ç‚¹ä¸å¯è¾¾
14:32 - ç¡®è®¤mysql-node2è‡ªåŠ¨æˆä¸ºæ–°ä¸»èŠ‚ç‚¹
14:35 - éªŒè¯åº”ç”¨è¿æ¥æ­£å¸¸ï¼Œæ•°æ®ä¸€è‡´æ€§å®Œå¥½
14:40 - è”ç³»ç¡¬ä»¶å‚å•†æ›´æ¢æ•…éšœç¡¬ä»¶
16:20 - ç¡¬ä»¶æ›´æ¢å®Œæˆï¼Œé‡è£…æ“ä½œç³»ç»Ÿ
17:00 - æ¢å¤MySQLé…ç½®ï¼Œä»å¤‡ä»½æ¢å¤æ•°æ®
17:30 - èŠ‚ç‚¹é‡æ–°åŠ å…¥MGRé›†ç¾¤

ç»éªŒæ•™è®­ï¼š
âœ… è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œæ­£å¸¸ï¼Œä¸šåŠ¡ä¸­æ–­æ—¶é—´<5åˆ†é’Ÿ
âœ… ç›‘æ§å‘Šè­¦åŠæ—¶ï¼Œæ•…éšœå“åº”è¿…é€Ÿ
âŒ ç¡¬ä»¶æ•…éšœé¢„è­¦ä¸è¶³ï¼Œåº”åŠ å¼ºç¡¬ä»¶ç›‘æ§
âŒ æ•°æ®æ¢å¤è€—æ—¶è¾ƒé•¿ï¼Œéœ€ä¼˜åŒ–æ¢å¤æµç¨‹

æ”¹è¿›æªæ–½ï¼š
â€¢ å¢åŠ ç¡¬ä»¶å¥åº·çŠ¶æ€ç›‘æ§
â€¢ å‡†å¤‡çƒ­å¤‡ç¡¬ä»¶ï¼Œç¼©çŸ­æ•…éšœæ¢å¤æ—¶é—´
â€¢ ä¼˜åŒ–æ•°æ®åŒæ­¥æœºåˆ¶ï¼ŒåŠ å¿«èŠ‚ç‚¹é‡æ–°åŠ å…¥é€Ÿåº¦
```

**ğŸ”¸ æ¡ˆä¾‹2ï¼šç½‘ç»œåˆ†åŒºå¯¼è‡´é›†ç¾¤åˆ†è£‚**
```
æ•…éšœæ—¶é—´ï¼š2024å¹´4æœˆ8æ—¥ 09:15
æ•…éšœæè¿°ï¼šæœºæˆ¿é—´ç½‘ç»œé“¾è·¯ä¸­æ–­ï¼Œå¯¼è‡´3ä¸ªèŠ‚ç‚¹åˆ†æˆ2ä¸ªåˆ†åŒº

é—®é¢˜åˆ†æï¼š
åˆ†åŒº1ï¼šmysql-node1 (ä¸»æœºæˆ¿)
åˆ†åŒº2ï¼šmysql-node2, mysql-node3 (å¤‡æœºæˆ¿)

ç”±äºåˆ†åŒº2æœ‰2ä¸ªèŠ‚ç‚¹(è¶…è¿‡åŠæ•°)ï¼Œç»§ç»­æä¾›æœåŠ¡
åˆ†åŒº1çš„å•ä¸ªèŠ‚ç‚¹è‡ªåŠ¨å˜ä¸ºåªè¯»çŠ¶æ€

å¤„ç†è¿‡ç¨‹ï¼š
09:15 - æ£€æµ‹åˆ°ç½‘ç»œåˆ†åŒº
09:20 - ç¡®è®¤åˆ†åŒº2æ­£å¸¸æä¾›æœåŠ¡
09:25 - åœæ­¢åˆ†åŒº1çš„åº”ç”¨è®¿é—®
10:30 - ç½‘ç»œé“¾è·¯ä¿®å¤
10:35 - é‡æ–°å¯åŠ¨mysql-node1çš„MGR
10:40 - éªŒè¯é›†ç¾¤å®Œæ•´æ€§å’Œæ•°æ®ä¸€è‡´æ€§

å¤„ç†è„šæœ¬ï¼š
#!/bin/bash
# ç½‘ç»œåˆ†åŒºæ¢å¤è„šæœ¬
echo "å¼€å§‹ç½‘ç»œåˆ†åŒºæ¢å¤..."

# 1. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping -c 3 mysql-node2 && ping -c 3 mysql-node3
if [ $? -eq 0 ]; then
    echo "ç½‘ç»œè¿é€šæ€§æ­£å¸¸"
    
    # 2. é‡æ–°å¯åŠ¨MGR
    mysql -uroot -p$ROOT_PASS -e "START GROUP_REPLICATION;"
    
    # 3. éªŒè¯é›†ç¾¤çŠ¶æ€
    mysql -uroot -p$ROOT_PASS -e "
    SELECT MEMBER_HOST, MEMBER_STATE, MEMBER_ROLE 
    FROM performance_schema.replication_group_members;"
else
    echo "ç½‘ç»œä»æœªæ¢å¤ï¼Œç­‰å¾…..."
    exit 1
fi
```

**ğŸ”¸ æ¡ˆä¾‹3ï¼šæ•°æ®ä¸ä¸€è‡´é—®é¢˜**
```
æ•…éšœæ—¶é—´ï¼š2024å¹´5æœˆ20æ—¥ 11:45
æ•…éšœæè¿°ï¼šå‘ç°ä¸åŒèŠ‚ç‚¹æŸ¥è¯¢åŒä¸€æ•°æ®è¿”å›ä¸åŒç»“æœ

é—®é¢˜æ’æŸ¥ï¼š
1. æ£€æŸ¥GTIDä¸€è‡´æ€§
mysql> SELECT $$GLOBAL.GTID_EXECUTED;

2. å¯¹æ¯”å„èŠ‚ç‚¹æ•°æ®
mysql> CHECKSUM TABLE user_table;

3. æ£€æŸ¥MGRå¤åˆ¶çŠ¶æ€
mysql> SELECT * FROM performance_schema.replication_group_member_stats;

æ ¹æœ¬åŸå› ï¼š
â€¢ åº”ç”¨ç¨‹åºç»•è¿‡MGRç›´æ¥å†™å…¥ä»èŠ‚ç‚¹
â€¢ å¯¼è‡´ä»èŠ‚ç‚¹äº§ç”Ÿäº†é¢å¤–çš„æœ¬åœ°äº‹åŠ¡

è§£å†³æ–¹æ¡ˆï¼š
1. ç«‹å³åœæ­¢é—®é¢˜åº”ç”¨
2. è¯†åˆ«æ•°æ®å·®å¼‚èŒƒå›´
3. ä»ä¸»èŠ‚ç‚¹é‡æ–°åŒæ­¥æ•°æ®

æ•°æ®ä¿®å¤è¿‡ç¨‹ï¼š
# 1. åœæ­¢æœ‰é—®é¢˜çš„ä»èŠ‚ç‚¹MGR
mysql> STOP GROUP_REPLICATION;

# 2. æ¸…ç©ºä»èŠ‚ç‚¹æ•°æ®
mysql> RESET MASTER;
mysql> DROP DATABASE problematic_db;

# 3. ä»ä¸»èŠ‚ç‚¹å¯¼å‡ºæ•°æ®
mysqldump -hä¸»èŠ‚ç‚¹IP --single-transaction problematic_db > repair.sql

# 4. åœ¨ä»èŠ‚ç‚¹å¯¼å…¥æ•°æ®
mysql < repair.sql

# 5. é‡æ–°åŠ å…¥MGR
mysql> START GROUP_REPLICATION;

é¢„é˜²æªæ–½ï¼š
â€¢ é…ç½®ä»èŠ‚ç‚¹ä¸ºåªè¯»ï¼šread_only=ON
â€¢ åº”ç”¨å±‚å¼ºåˆ¶è·¯ç”±å†™æ“ä½œåˆ°ä¸»èŠ‚ç‚¹
â€¢ å¢åŠ æ•°æ®ä¸€è‡´æ€§ç›‘æ§æ£€æŸ¥
```

### 10.3 æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹


**ğŸ”¸ ä¼˜åŒ–æ¡ˆä¾‹1ï¼šè§£å†³å¤åˆ¶å»¶è¿Ÿé—®é¢˜**
```
é—®é¢˜èƒŒæ™¯ï¼š
â€¢ ä¸šåŠ¡é«˜å³°æœŸå‡ºç°å¤åˆ¶å»¶è¿Ÿ
â€¢ ä»èŠ‚ç‚¹æ•°æ®æ¯”ä¸»èŠ‚ç‚¹å»¶è¿Ÿ5-10ç§’
â€¢ å½±å“è¯»å†™åˆ†ç¦»çš„æ•°æ®ä¸€è‡´æ€§

æ€§èƒ½åˆ†æï¼š
1. æ£€æŸ¥MGRç›¸å…³æŒ‡æ ‡
mysql> SELECT * FROM performance_schema.replication_group_member_stats\G

2. åˆ†æç½‘ç»œå¸¦å®½ä½¿ç”¨
iftop -i eth2  # MGRå¤åˆ¶ç½‘ç»œæ¥å£

3. æ£€æŸ¥ç£ç›˜IOçŠ¶å†µ
iostat -x 1

é—®é¢˜å‘ç°ï¼š
â€¢ ç½‘ç»œå¸¦å®½æ¥è¿‘é¥±å’Œ
â€¢ ç£ç›˜å†™å…¥IOPSè¾¾åˆ°ç“¶é¢ˆ
â€¢ å¤§äº‹åŠ¡å¯¼è‡´å¤åˆ¶é˜»å¡

ä¼˜åŒ–æªæ–½ï¼š
1. ç½‘ç»œä¼˜åŒ–
# è°ƒæ•´ç½‘ç»œç¼“å†²åŒº
echo 'net.core.rmem_max = 268435456' >> /etc/sysctl.conf
echo 'net.core.wmem_max = 268435456' >> /etc/sysctl.conf
sysctl -p

2. MGRå‚æ•°è°ƒä¼˜
# my.cnf æ·»åŠ é…ç½®
group_replication_communication_max_message_size = 50M
group_replication_compression_threshold = 1000000
group_replication_recovery_retry_count = 3

3. åº”ç”¨å±‚ä¼˜åŒ–
# é¿å…å¤§äº‹åŠ¡ï¼Œæ‹†åˆ†ä¸ºå°äº‹åŠ¡
BEGIN;
-- åŸæ¥ä¸€æ¬¡æ’å…¥1ä¸‡æ¡è®°å½•
-- æ”¹ä¸ºåˆ†æ‰¹ï¼Œæ¯æ¬¡1000æ¡
COMMIT;

ä¼˜åŒ–ç»“æœï¼š
â€¢ å¤åˆ¶å»¶è¿Ÿä»10ç§’é™ä½åˆ°1ç§’ä»¥å†…
â€¢ ç½‘ç»œåˆ©ç”¨ç‡ä¸‹é™30%
â€¢ æ•´ä½“TPSæå‡15%
```

**ğŸ”¸ ä¼˜åŒ–æ¡ˆä¾‹2ï¼šæå‡å¹¶å‘æ€§èƒ½**
```
é—®é¢˜èƒŒæ™¯ï¼š
â€¢ é«˜å¹¶å‘åœºæ™¯ä¸‹TPSä¸ç†æƒ³
â€¢ å‡ºç°å¤§é‡é”ç­‰å¾…
â€¢ åº”ç”¨å“åº”æ—¶é—´å¢åŠ 

æ€§èƒ½ç“¶é¢ˆåˆ†æï¼š
1. é”ç­‰å¾…åˆ†æ
mysql> SELECT * FROM performance_schema.data_locks;
mysql> SELECT * FROM performance_schema.data_lock_waits;

2. çƒ­ç‚¹è¡¨è¯†åˆ«
mysql> SELECT 
    object_schema,
    object_name,
    count_star
FROM performance_schema.table_io_waits_summary_by_table 
WHERE object_schema NOT IN ('mysql','performance_schema','sys')
ORDER BY count_star DESC LIMIT 10;

3. æ…¢æŸ¥è¯¢åˆ†æ
mysql> SELECT * FROM mysql.slow_log ORDER BY start_time DESC LIMIT 10;

ä¼˜åŒ–ç­–ç•¥ï¼š
1. ç´¢å¼•ä¼˜åŒ–
-- ä¸ºçƒ­ç‚¹æŸ¥è¯¢æ·»åŠ å¤åˆç´¢å¼•
ALTER TABLE user_orders 
ADD INDEX idx_user_status_time (user_id, status, create_time);

2. äº‹åŠ¡ä¼˜åŒ–
-- å‡å°‘äº‹åŠ¡æŒæœ‰æ—¶é—´
-- ä¼˜åŒ–SQLè¯­å¥å‡å°‘æ‰«æè¡Œæ•°

3. æ¶æ„ä¼˜åŒ–
-- å®æ–½è¯»å†™åˆ†ç¦»
-- çƒ­ç‚¹æ•°æ®è¿ç§»åˆ°ç¼“å­˜

é…ç½®è°ƒä¼˜ï¼š
# my.cnf æ€§èƒ½ç›¸å…³é…ç½®
innodb_buffer_pool_size = 32G
innodb_log_file_size = 2G
innodb_flush_log_at_trx_commit = 2
innodb_thread_concurrency = 0
innodb_read_io_threads = 8
innodb_write_io_threads = 8

ä¼˜åŒ–ç»“æœï¼š
â€¢ TPSä»2000æå‡åˆ°5000
â€¢ å¹³å‡å“åº”æ—¶é—´ä»100msé™åˆ°30ms
â€¢ é”ç­‰å¾…æ—¶é—´å‡å°‘80%
```

### 10.4 è¿ç»´ç»éªŒæ€»ç»“


**ğŸ”¸ éƒ¨ç½²æœ€ä½³å®è·µ**
```
ç¡¬ä»¶é…ç½®å»ºè®®ï¼š
â€¢ CPUï¼šé€‰æ‹©ä¸»é¢‘é«˜çš„å‹å·ï¼Œå•æ ¸æ€§èƒ½æ¯”å¤šæ ¸æ•°é‡æ›´é‡è¦
â€¢ å†…å­˜ï¼šBuffer Poolå¤§å° = çƒ­ç‚¹æ•°æ® Ã— 1.2
â€¢ å­˜å‚¨ï¼šæ•°æ®ç›˜å¿…é¡»ä½¿ç”¨SSDï¼Œè€ƒè™‘NVMeä»¥è·å¾—æ›´å¥½æ€§èƒ½
â€¢ ç½‘ç»œï¼šMGRå¤åˆ¶ç½‘ç»œç‹¬ç«‹ï¼Œè‡³å°‘åƒå…†å¸¦å®½

é…ç½®ä¼˜åŒ–è¦ç‚¹ï¼š
â€¢ åˆç†è®¾ç½®group_replication_group_seeds
â€¢ å¯ç”¨SSLä¿è¯å¤åˆ¶å®‰å…¨
â€¢ é…ç½®åˆé€‚çš„è¶…æ—¶å‚æ•°
â€¢ å®šæœŸæ£€æŸ¥å’Œè°ƒæ•´å‚æ•°

ç›‘æ§é‡ç‚¹æŒ‡æ ‡ï¼š
â€¢ MGRé›†ç¾¤æˆå‘˜çŠ¶æ€
â€¢ å¤åˆ¶å»¶è¿Ÿå’Œå†²çªç‡
â€¢ ç½‘ç»œæµé‡å’Œå»¶è¿Ÿ
â€¢ ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡
```

**ğŸ”¸ æ•…éšœé¢„é˜²æªæ–½**
```
é¢„é˜²æ€§ç»´æŠ¤ï¼š
1. å®šæœŸå¤‡ä»½éªŒè¯
# æ¯æœˆè¿›è¡Œä¸€æ¬¡å®Œæ•´çš„æ¢å¤æµ‹è¯•
bash restore_test.sh

2. ç¡¬ä»¶å¥åº·æ£€æŸ¥
# ç›‘æ§ç£ç›˜SMARTä¿¡æ¯
smartctl -a /dev/sda

3. ç½‘ç»œè´¨é‡ç›‘æ§
# æ£€æŸ¥èŠ‚ç‚¹é—´ç½‘ç»œå»¶è¿Ÿ
for node in node2 node3; do
    ping -c 100 $node | tail -1
done

4. å®¹é‡è§„åˆ’
# ç›‘æ§æ•°æ®å¢é•¿è¶‹åŠ¿
mysql> SELECT 
    table_schema,
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) as 'Size(MB)'
FROM information_schema.tables 
GROUP BY table_schema;

åº”æ€¥é¢„æ¡ˆï¼š
â€¢ å‡†å¤‡è¯¦ç»†çš„æ•…éšœå¤„ç†æ‰‹å†Œ
â€¢ å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
â€¢ å»ºç«‹å¿«é€Ÿå“åº”å›¢é˜Ÿ
â€¢ é…ç½®å¤šå±‚æ¬¡å‘Šè­¦æœºåˆ¶
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„éƒ¨ç½²è¦ç‚¹


**ğŸ”¸ MGRéƒ¨ç½²æ ¸å¿ƒæ¦‚å¿µ**
```
åŸºæœ¬ç†è§£ï¼š
â€¢ MGRæ˜¯MySQLçš„é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ
â€¢ åŸºäºç»„å¤åˆ¶åè®®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ æ”¯æŒè‡ªåŠ¨æ•…éšœè½¬ç§»å’Œæˆå‘˜ç®¡ç†
â€¢ é€‚åˆå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯

éƒ¨ç½²è¦ç´ ï¼š
â€¢ è‡³å°‘3ä¸ªèŠ‚ç‚¹ï¼ˆä¿è¯è¿‡åŠæ•°åŸåˆ™ï¼‰
â€¢ ç½‘ç»œå»¶è¿Ÿè¦ä½ï¼ˆå»ºè®®<10msï¼‰
â€¢ ç¡¬ä»¶é…ç½®è¦å‡è¡¡ï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ï¼‰
â€¢ å®‰å…¨é…ç½®è¦å®Œå–„ï¼ˆSSLã€æƒé™æ§åˆ¶ï¼‰
```

**ğŸ”¸ å…³é”®é…ç½®å‚æ•°ç†è§£**
```
å¿…é¡»é…ç½®çš„å‚æ•°ï¼š
group_replication_group_name    # é›†ç¾¤å”¯ä¸€æ ‡è¯†
group_replication_local_address # æœ¬èŠ‚ç‚¹åœ°å€
group_replication_group_seeds   # é›†ç¾¤èŠ‚ç‚¹åˆ—è¡¨
server_id                       # èŠ‚ç‚¹å”¯ä¸€ID

é‡è¦çš„æ€§èƒ½å‚æ•°ï¼š
group_replication_communication_max_message_size  # æ¶ˆæ¯å¤§å°é™åˆ¶
group_replication_compression_threshold           # å‹ç¼©é˜ˆå€¼
group_replication_flow_control_mode               # æµæ§æ¨¡å¼

å®‰å…¨ç›¸å…³å‚æ•°ï¼š
group_replication_ssl_mode                        # SSLæ¨¡å¼
group_replication_ip_whitelist                    # IPç™½åå•
```

### 11.2 ç”Ÿäº§ç¯å¢ƒå…³é”®æ³¨æ„äº‹é¡¹


**ğŸ”¸ ç¡¬ä»¶é€‰å‹åŸåˆ™**
```
å†…å­˜è§„åˆ’ï¼š
Buffer Pool = æ´»è·ƒæ•°æ®å¤§å° Ã— 1.2
æ€»å†…å­˜ = Buffer Pool + ç³»ç»Ÿå†…å­˜ + é¢„ç•™ç©ºé—´
å»ºè®®ï¼šæ´»è·ƒæ•°æ®50GBéœ€è¦96GBä»¥ä¸Šå†…å­˜

å­˜å‚¨é€‰æ‹©ï¼š
â€¢ æ•°æ®ç›˜ï¼šå¿…é¡»SSDï¼Œæ¨èNVMe
â€¢ æ—¥å¿—ç›˜ï¼šå¯ä»¥SATA SSDï¼Œä½†è¦å¯é 
â€¢ RAIDé…ç½®ï¼šæ•°æ®ç›˜RAID10ï¼Œæ—¥å¿—ç›˜RAID1

ç½‘ç»œè®¾è®¡ï¼š
â€¢ MGRå¤åˆ¶ç½‘ç»œç‹¬ç«‹ï¼Œé¿å…ä¸ä¸šåŠ¡ç½‘ç»œå†²çª
â€¢ å¸¦å®½è‡³å°‘åƒå…†ï¼Œå»¶è¿Ÿè¦ä½
â€¢ è€ƒè™‘ç½‘ç»œå†—ä½™ï¼Œé¿å…å•ç‚¹æ•…éšœ
```

**ğŸ”¸ å®‰å…¨ç­–ç•¥è¦ç‚¹**
```
ç”¨æˆ·æƒé™ç®¡ç†ï¼š
â€¢ é¿å…ä½¿ç”¨rootç”¨æˆ·è¿›è¡Œåº”ç”¨è¿æ¥
â€¢ ä¸ºä¸åŒç”¨é€”åˆ›å»ºä¸“ç”¨ç”¨æˆ·
â€¢ å®šæœŸè½®æ¢å¯†ç ï¼Œä½¿ç”¨å¼ºå¯†ç ç­–ç•¥

ç½‘ç»œå®‰å…¨ï¼š
â€¢ å¯ç”¨SSL/TLSåŠ å¯†ä¼ è¾“
â€¢ é…ç½®é˜²ç«å¢™è§„åˆ™é™åˆ¶è®¿é—®
â€¢ ä½¿ç”¨ä¸“ç”¨ç½‘ç»œè¿›è¡Œå¤åˆ¶é€šä¿¡

æ•°æ®å®‰å…¨ï¼š
â€¢ å¯ç”¨å®¡è®¡æ—¥å¿—è®°å½•å…³é”®æ“ä½œ
â€¢ å®šæœŸå¤‡ä»½å¹¶éªŒè¯å¤‡ä»½æœ‰æ•ˆæ€§
â€¢ å®æ–½æ•°æ®è„±æ•ä¿æŠ¤æ•æ„Ÿä¿¡æ¯
```

### 11.3 è¿ç»´ç®¡ç†æœ€ä½³å®è·µ


**ğŸ”¸ ç›‘æ§ä½“ç³»å»ºè®¾**
```
æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼š
â€¢ é›†ç¾¤çŠ¶æ€ï¼šæˆå‘˜åœ¨çº¿çŠ¶æ€ã€è§’è‰²åˆ†é…
â€¢ æ€§èƒ½æŒ‡æ ‡ï¼šTPSã€QPSã€å“åº”æ—¶é—´
â€¢ èµ„æºä½¿ç”¨ï¼šCPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œ
â€¢ å¤åˆ¶çŠ¶æ€ï¼šå»¶è¿Ÿã€å†²çªã€æµé‡

å‘Šè­¦è®¾ç½®ï¼š
â€¢ P0å‘Šè­¦ï¼šé›†ç¾¤ä¸å¯ç”¨ã€æ•°æ®å®‰å…¨å¨èƒ
â€¢ P1å‘Šè­¦ï¼šå•èŠ‚ç‚¹æ•…éšœã€æ€§èƒ½ä¸¥é‡ä¸‹é™
â€¢ P2å‘Šè­¦ï¼šèµ„æºä½¿ç”¨ç‡é«˜ã€å¤åˆ¶å»¶è¿Ÿ
â€¢ P3å‘Šè­¦ï¼šé¢„è­¦ç±»ã€è¶‹åŠ¿æ€§é—®é¢˜

è‡ªåŠ¨åŒ–ç¨‹åº¦ï¼š
â€¢ ç›‘æ§æ•°æ®è‡ªåŠ¨é‡‡é›†å’Œå­˜å‚¨
â€¢ åŸºç¡€æ•…éšœè‡ªåŠ¨æ¢å¤
â€¢ å‘Šè­¦ä¿¡æ¯è‡ªåŠ¨åˆ†å‘
â€¢ æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå’Œå‘é€
```

**ğŸ”¸ æ•…éšœå¤„ç†ç­–ç•¥**
```
é¢„é˜²ä¸ºä¸»ï¼š
â€¢ å®šæœŸå¥åº·æ£€æŸ¥å’Œç»´æŠ¤
â€¢ å®¹é‡è§„åˆ’å’Œæ€§èƒ½è°ƒä¼˜
â€¢ æ•…éšœæ¼”ç»ƒå’Œåº”æ€¥é¢„æ¡ˆ
â€¢ ç›‘æ§å‘Šè­¦å’Œè¶‹åŠ¿åˆ†æ

å¿«é€Ÿå“åº”ï¼š
â€¢ æ•…éšœåˆ†çº§å’Œå“åº”æ—¶é—´æ ‡å‡†
â€¢ æ ‡å‡†åŒ–çš„æ•…éšœå¤„ç†æµç¨‹
â€¢ è¯¦ç»†çš„æ•…éšœå¤„ç†æ–‡æ¡£
â€¢ ç»éªŒç§¯ç´¯å’ŒçŸ¥è¯†åˆ†äº«

æŒç»­æ”¹è¿›ï¼š
â€¢ æ•…éšœæ ¹å› åˆ†æå’Œæ€»ç»“
â€¢ æµç¨‹ä¼˜åŒ–å’Œå·¥å…·æ”¹è¿›
â€¢ å›¢é˜ŸåŸ¹è®­å’ŒæŠ€èƒ½æå‡
â€¢ æœ€ä½³å®è·µåˆ†äº«å’Œæ¨å¹¿
```

### 11.4 å®é™…åº”ç”¨ä»·å€¼


**ğŸ”¸ ä¸šåŠ¡ä»·å€¼ä½“ç°**
```
é«˜å¯ç”¨æ€§ï¼š
â€¢ æ”¯æŒ99.9%ä»¥ä¸Šçš„å¯ç”¨æ€§è¦æ±‚
â€¢ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œå‡å°‘ä¸šåŠ¡ä¸­æ–­
â€¢ å¤šèŠ‚ç‚¹å†—ä½™ï¼Œé¿å…å•ç‚¹æ•…éšœ

æ•°æ®å®‰å…¨ï¼š
â€¢ åŒæ­¥å¤åˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§
â€¢ å¤šå‰¯æœ¬å­˜å‚¨é˜²æ­¢æ•°æ®ä¸¢å¤±
â€¢ äº‹åŠ¡çº§åˆ«çš„åŸå­æ€§ä¿è¯

æ€§èƒ½æ‰©å±•ï¼š
â€¢ è¯»å†™åˆ†ç¦»æå‡æŸ¥è¯¢æ€§èƒ½
â€¢ å¤šèŠ‚ç‚¹åˆ†æ‹…è¯»å–å‹åŠ›
â€¢ æ°´å¹³æ‰©å±•æ»¡è¶³ä¸šåŠ¡å¢é•¿
```

**ğŸ”¸ æŠ€æœ¯ä»·å€¼ä½“ç°**
```
è¿ç»´æ•ˆç‡ï¼š
â€¢ è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜ï¼Œå‡å°‘äººå·¥å¹²é¢„
â€¢ æ ‡å‡†åŒ–æµç¨‹ï¼Œé™ä½è¿ç»´å¤æ‚åº¦
â€¢ ç›‘æ§å®Œå–„ï¼Œé—®é¢˜å‘ç°åŠæ—¶

æˆæœ¬æ§åˆ¶ï¼š
â€¢ ç›¸æ¯”å•†ä¸šæ•°æ®åº“æˆæœ¬æ›´ä½
â€¢ å¼€æºæ–¹æ¡ˆï¼Œé¿å…è®¸å¯è´¹ç”¨
â€¢ ç¡¬ä»¶è¦æ±‚åˆç†ï¼ŒTCOå¯æ§

æŠ€æœ¯å…ˆè¿›æ€§ï¼š
â€¢ åŸºäºæœ€æ–°çš„ç»„å¤åˆ¶æŠ€æœ¯
â€¢ æ”¯æŒäº‘åŸç”Ÿå’Œå®¹å™¨åŒ–éƒ¨ç½²
â€¢ ä¸MySQLç”Ÿæ€å®Œç¾èåˆ
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- MGRéƒ¨ç½²éœ€è¦è‡³å°‘3ä¸ªèŠ‚ç‚¹ï¼Œéµå¾ªè¿‡åŠæ•°åŸåˆ™
- ç¡¬ä»¶é…ç½®è¦å‡è¡¡ï¼Œç½‘ç»œå»¶è¿Ÿè¦ä½ï¼Œå®‰å…¨é…ç½®è¦å®Œå–„
- ç›‘æ§ä½“ç³»è¦å®Œæ•´ï¼Œæ•…éšœå¤„ç†è¦è¿…é€Ÿï¼Œè¿ç»´æµç¨‹è¦æ ‡å‡†åŒ–
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦å…¨æ–¹ä½è€ƒè™‘å’Œè§„åˆ’