---
title: 26ã€MGRç½‘ç»œæ€§èƒ½ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [MGRç½‘ç»œæ€§èƒ½åŸºç¡€æ¦‚å¿µ](#1-MGRç½‘ç»œæ€§èƒ½åŸºç¡€æ¦‚å¿µ)
2. [ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥](#2-ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥)
3. [å¸¦å®½ä½¿ç”¨ä¼˜åŒ–](#3-å¸¦å®½ä½¿ç”¨ä¼˜åŒ–)
4. [ç½‘ç»œå‚æ•°è°ƒä¼˜](#4-ç½‘ç»œå‚æ•°è°ƒä¼˜)
5. [å‹ç¼©é…ç½®ä¼˜åŒ–](#5-å‹ç¼©é…ç½®ä¼˜åŒ–)
6. [SSLæ€§èƒ½ä¼˜åŒ–](#6-SSLæ€§èƒ½ä¼˜åŒ–)
7. [ç½‘ç»œæ‹“æ‰‘ä¸å¤šç½‘å¡é…ç½®](#7-ç½‘ç»œæ‹“æ‰‘ä¸å¤šç½‘å¡é…ç½®)
8. [è·¨åœ°åŸŸéƒ¨ç½²ä¼˜åŒ–](#8-è·¨åœ°åŸŸéƒ¨ç½²ä¼˜åŒ–)
9. [ç½‘ç»œç›‘æ§ä¸æ•…éšœè¯Šæ–­](#9-ç½‘ç»œç›‘æ§ä¸æ•…éšœè¯Šæ–­)
10. [ç½‘ç»œæœ€ä½³å®è·µæ€»ç»“](#10-ç½‘ç»œæœ€ä½³å®è·µæ€»ç»“)

---

## 1. ğŸŒ MGRç½‘ç»œæ€§èƒ½åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MGRç½‘ç»œæ€§èƒ½


**MGRç½‘ç»œæ€§èƒ½**å°±æ˜¯æŒ‡MySQL Group Replicationé›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹ä¹‹é—´é€šä¿¡çš„æ•ˆç‡å’Œè´¨é‡ã€‚

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šæƒ³è±¡MGRé›†ç¾¤å°±åƒä¸€ä¸ªåŠå…¬å®¤é‡Œçš„å›¢é˜Ÿï¼Œæ¯ä¸ªäººï¼ˆèŠ‚ç‚¹ï¼‰éƒ½éœ€è¦ä¸æ–­åœ°äº’ç›¸æ²Ÿé€šåè°ƒå·¥ä½œã€‚ç½‘ç»œæ€§èƒ½å°±æ˜¯è¿™äº›äººä¹‹é—´æ²Ÿé€šçš„æ•ˆç‡ - æ˜¯ç”µè¯é€šè¯æ¸…æ™°è¿˜æ˜¯æ–­æ–­ç»­ç»­ï¼Œæ˜¯é¢å¯¹é¢äº¤æµè¿˜æ˜¯éš”ç€å¾ˆè¿œå–Šè¯ã€‚

```
MGRç½‘ç»œé€šä¿¡ç¤ºæ„å›¾ï¼š
èŠ‚ç‚¹A â†â”€â”€æ•°æ®åŒæ­¥â”€â”€â†’ èŠ‚ç‚¹B
  â†‘                    â†“
  â””â”€â”€åè°ƒæ¶ˆæ¯â”€â”€â†’ èŠ‚ç‚¹C â†â”˜

ç½‘ç»œæ€§èƒ½å½±å“ï¼š
â€¢ æ•°æ®åŒæ­¥é€Ÿåº¦
â€¢ äº‹åŠ¡æäº¤å»¶è¿Ÿ
â€¢ é›†ç¾¤ç¨³å®šæ€§
â€¢ æ•…éšœæ¢å¤æ—¶é—´
```

### 1.2 MGRç½‘ç»œé€šä¿¡çš„ç‰¹ç‚¹


**ğŸ”¸ é«˜é¢‘é€šä¿¡**ï¼šMGRèŠ‚ç‚¹ä¹‹é—´éœ€è¦é¢‘ç¹äº¤æ¢ä¿¡æ¯
- **å¿ƒè·³æ¶ˆæ¯**ï¼šæ¯ç§’å¤šæ¬¡ï¼Œæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸
- **äº‹åŠ¡æ•°æ®**ï¼šå®æ—¶åŒæ­¥æ‰€æœ‰å†™æ“ä½œ
- **åè°ƒæ¶ˆæ¯**ï¼šå†³å®šå“ªäº›äº‹åŠ¡å¯ä»¥æäº¤

**ğŸ”¸ å¯¹ç½‘ç»œè¦æ±‚é«˜**ï¼š
- **ä½å»¶è¿Ÿ**ï¼šæ¶ˆæ¯ä¼ é€’è¦å¿«ï¼Œå¦åˆ™äº‹åŠ¡æäº¤æ…¢
- **é«˜å¯é **ï¼šç½‘ç»œä¸ç¨³å®šä¼šå¯¼è‡´èŠ‚ç‚¹è¢«è¸¢å‡ºé›†ç¾¤
- **è¶³å¤Ÿå¸¦å®½**ï¼šå¤§é‡æ•°æ®éœ€è¦åŒæ­¥

### 1.3 ç½‘ç»œæ€§èƒ½é—®é¢˜çš„è¡¨ç°


```
å¸¸è§ç—‡çŠ¶è¯Šæ–­ï¼š

ğŸ”´ äº‹åŠ¡æäº¤æ…¢ï¼š
ç°è±¡ï¼šINSERT/UPDATEæ“ä½œè€—æ—¶æ˜æ˜¾å¢åŠ 
åŸå› ï¼šç½‘ç»œå»¶è¿Ÿå¯¼è‡´æ•°æ®åŒæ­¥æ…¢

ğŸ”´ èŠ‚ç‚¹é¢‘ç¹é€€å‡ºï¼š
ç°è±¡ï¼šMGRé›†ç¾¤æˆå‘˜ç»å¸¸å˜åŒ–
åŸå› ï¼šç½‘ç»œä¸ç¨³å®šï¼Œå¿ƒè·³è¶…æ—¶

ğŸ”´ æ•°æ®åŒæ­¥è½åï¼š
ç°è±¡ï¼šä»èŠ‚ç‚¹æ•°æ®å»¶è¿Ÿä¸¥é‡
åŸå› ï¼šå¸¦å®½ä¸è¶³ï¼Œæ•°æ®ä¼ è¾“æ…¢

ğŸ”´ é›†ç¾¤åˆ†è£‚ï¼š
ç°è±¡ï¼šèŠ‚ç‚¹åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„é›†ç¾¤
åŸå› ï¼šç½‘ç»œåˆ†åŒºï¼Œéƒ¨åˆ†èŠ‚ç‚¹æ— æ³•é€šä¿¡
```

---

## 2. âš¡ ç½‘ç»œå»¶è¿Ÿä¼˜åŒ–ç­–ç•¥


### 2.1 ç†è§£ç½‘ç»œå»¶è¿Ÿå¯¹MGRçš„å½±å“


**ç½‘ç»œå»¶è¿Ÿ**å°±æ˜¯æ•°æ®ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦çš„æ—¶é—´ï¼Œå°±åƒä½ ç»™æœ‹å‹å‘å¾®ä¿¡ï¼Œä»ä½ ç‚¹å‡»å‘é€åˆ°å¯¹æ–¹æ”¶åˆ°æ¶ˆæ¯çš„æ—¶é—´ã€‚

> ğŸ“Š **å»¶è¿Ÿæ ‡å‡†å‚è€ƒ**ï¼š
> - **ä¼˜ç§€**ï¼š< 1msï¼ˆåŒæœºæˆ¿ï¼‰
> - **è‰¯å¥½**ï¼š1-5msï¼ˆåŒåŸä¸åŒæœºæˆ¿ï¼‰
> - **å¯æ¥å—**ï¼š5-50msï¼ˆåŒåœ°åŒºä¸åŒåŸå¸‚ï¼‰
> - **éœ€è¦ä¼˜åŒ–**ï¼š> 50msï¼ˆè·¨åœ°åŸŸï¼‰

```
å»¶è¿Ÿå¯¹MGRçš„å…·ä½“å½±å“ï¼š

ä½å»¶è¿Ÿç¯å¢ƒï¼ˆ<5msï¼‰ï¼š
å®¢æˆ·ç«¯ â”€â”€å†™è¯·æ±‚â”€â”€â†’ èŠ‚ç‚¹A
èŠ‚ç‚¹A â”€â”€åŒæ­¥æ•°æ®â”€â”€â†’ èŠ‚ç‚¹Bï¼ˆ2msï¼‰
èŠ‚ç‚¹A â”€â”€åŒæ­¥æ•°æ®â”€â”€â†’ èŠ‚ç‚¹Cï¼ˆ2msï¼‰
èŠ‚ç‚¹A â†â”€â”€ç¡®è®¤æ”¶åˆ°â”€â”€â† èŠ‚ç‚¹Bï¼ˆ2msï¼‰
èŠ‚ç‚¹A â†â”€â”€ç¡®è®¤æ”¶åˆ°â”€â”€â† èŠ‚ç‚¹Cï¼ˆ2msï¼‰
å®¢æˆ·ç«¯ â†â”€â”€æäº¤å®Œæˆâ”€â”€â† èŠ‚ç‚¹A
æ€»è€—æ—¶ï¼šçº¦10ms

é«˜å»¶è¿Ÿç¯å¢ƒï¼ˆ>20msï¼‰ï¼š
ç›¸åŒæµç¨‹ï¼Œæ€»è€—æ—¶ï¼šçº¦100ms+
ç”¨æˆ·æ˜æ˜¾æ„Ÿè§‰åˆ°å»¶è¿Ÿ
```

### 2.2 å»¶è¿Ÿä¼˜åŒ–çš„æ ¸å¿ƒå‚æ•°


**ğŸ”§ group_replication_member_expel_timeout**
```sql
-- è®¾ç½®æˆå‘˜é©±é€è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
SET GLOBAL group_replication_member_expel_timeout = 60;

-- é»˜è®¤å€¼ï¼š0ï¼ˆç«‹å³é©±é€ï¼‰
-- æ¨èå€¼ï¼š30-60ç§’ï¼ˆç»™ç½‘ç»œæ³¢åŠ¨ç•™ç¼“å†²æ—¶é—´ï¼‰
```

> ğŸ’¡ **é€šä¿—è§£é‡Š**ï¼šè¿™ä¸ªå‚æ•°å°±åƒè®¾å®š"å®¹å¿åº¦"ã€‚æ¯”å¦‚å¹³æ—¶åŒäº‹5åˆ†é’Ÿæ²¡å›æ¶ˆæ¯ä½ å°±è®¤ä¸ºä»–ç¦»çº¿äº†ï¼Œä½†ç½‘ç»œä¸å¥½çš„æ—¶å€™ï¼Œä½ å¯èƒ½è¦ç­‰10åˆ†é’Ÿæ‰ä¸‹è¿™ä¸ªç»“è®ºã€‚

**ğŸ”§ group_replication_autorejoin_tries**
```sql
-- è®¾ç½®è‡ªåŠ¨é‡æ–°åŠ å…¥é›†ç¾¤çš„å°è¯•æ¬¡æ•°
SET GLOBAL group_replication_autorejoin_tries = 3;

-- æ¨èå€¼ï¼š1-3æ¬¡ï¼ˆé¿å…æ— é™é‡è¯•ï¼‰
```

### 2.3 ç½‘ç»œå»¶è¿Ÿæµ‹è¯•æ–¹æ³•


**ğŸ“‹ ç®€å•å»¶è¿Ÿæµ‹è¯•**ï¼š
```bash
# æµ‹è¯•åˆ°å…¶ä»–MGRèŠ‚ç‚¹çš„å»¶è¿Ÿ
ping 192.168.1.101  # èŠ‚ç‚¹1
ping 192.168.1.102  # èŠ‚ç‚¹2

# æŒç»­ç›‘æ§å»¶è¿Ÿå˜åŒ–
ping -i 0.1 192.168.1.101  # æ¯0.1ç§’pingä¸€æ¬¡
```

**ğŸ“‹ MySQLä¸“ç”¨ç½‘ç»œæµ‹è¯•**ï¼š
```bash
# æµ‹è¯•MySQLç«¯å£çš„è¿æ¥å»¶è¿Ÿ
time mysql -h192.168.1.101 -e "SELECT 1;"

# ä½¿ç”¨telnetæµ‹è¯•ç«¯å£å¯è¾¾æ€§
telnet 192.168.1.101 3306
```

---

## 3. ğŸ“Š å¸¦å®½ä½¿ç”¨ä¼˜åŒ–


### 3.1 ç†è§£MGRçš„å¸¦å®½éœ€æ±‚


**å¸¦å®½**å°±æ˜¯ç½‘ç»œä¼ è¾“æ•°æ®çš„èƒ½åŠ›ï¼Œå°±åƒæ°´ç®¡çš„ç²—ç»†å†³å®šäº†å•ä½æ—¶é—´èƒ½æµè¿‡å¤šå°‘æ°´ã€‚

> ğŸ“Š **MGRå¸¦å®½éœ€æ±‚ä¼°ç®—**ï¼š
> ```
> åŸºç¡€å…¬å¼ï¼šæ‰€éœ€å¸¦å®½ = å†™å…¥TPS Ã— å¹³å‡è¡Œå¤§å° Ã— 3 Ã— 1.5
> 
> è§£é‡Šï¼š
> â€¢ å†™å…¥TPSï¼šæ¯ç§’äº‹åŠ¡æ•°
> â€¢ å¹³å‡è¡Œå¤§å°ï¼šå•æ¡è®°å½•çš„å­—èŠ‚æ•°
> â€¢ Ã—3ï¼šéœ€è¦å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹
> â€¢ Ã—1.5ï¼šåè®®å¼€é”€å’Œå®‰å…¨å†—ä½™
> 
> ç¤ºä¾‹è®¡ç®—ï¼š
> 1000 TPS Ã— 1KB Ã— 3èŠ‚ç‚¹ Ã— 1.5å€å¼€é”€ = 4.5MB/s = 36Mbps
> ```

### 3.2 å¸¦å®½ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ å‡å°‘ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“**

```sql
-- 1. é¿å…å¤§å­—æ®µçš„é¢‘ç¹æ›´æ–°
-- ä¸å¥½çš„åšæ³•ï¼š
UPDATE user_info SET last_activity = NOW(), big_data_field = 'xxx' 
WHERE user_id = 123;

-- æ›´å¥½çš„åšæ³•ï¼š
UPDATE user_info SET last_activity = NOW() WHERE user_id = 123;
-- å¤§å­—æ®µå•ç‹¬æ›´æ–°ï¼Œæˆ–è€…ä¸åŒæ­¥åˆ°MGR
```

**ğŸ”¸ åˆç†è®¾è®¡è¡¨ç»“æ„**

```sql
-- å°†å¤§å­—æ®µåˆ†ç¦»åˆ°å•ç‹¬çš„è¡¨
CREATE TABLE users (
    user_id INT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    create_time TIMESTAMP
) ENGINE=InnoDB;

-- å¤§å­—æ®µå•ç‹¬å­˜å‚¨ï¼Œä¸å‚ä¸MGRåŒæ­¥
CREATE TABLE user_profiles (
    user_id INT PRIMARY KEY,
    avatar_data LONGBLOB,
    description TEXT
) ENGINE=MyISAM;  -- æˆ–è€…å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“å®ä¾‹
```

### 3.3 å¸¦å®½ç›‘æ§æ–¹æ³•


**ğŸ“‹ ç³»ç»Ÿçº§å¸¦å®½ç›‘æ§**ï¼š
```bash
# å®æ—¶æŸ¥çœ‹ç½‘ç»œæµé‡
iftop -i eth0  # æ˜¾ç¤ºç½‘ç»œè¿æ¥å’Œæµé‡

# æŸ¥çœ‹ç½‘ç»œæ¥å£ç»Ÿè®¡
cat /proc/net/dev

# ä½¿ç”¨nloadç›‘æ§å¸¦å®½ä½¿ç”¨
nload eth0
```

**ğŸ“‹ MySQLå±‚é¢ç›‘æ§**ï¼š
```sql
-- æŸ¥çœ‹MGRç›¸å…³çš„ç½‘ç»œç»Ÿè®¡
SHOW STATUS LIKE 'group_replication%bytes%';

-- ç›‘æ§å¤åˆ¶å»¶è¿Ÿ
SELECT * FROM performance_schema.replication_group_members;
```

---

## 4. ğŸ”§ ç½‘ç»œå‚æ•°è°ƒä¼˜


### 4.1 æ“ä½œç³»ç»Ÿç½‘ç»œå‚æ•°ä¼˜åŒ–


ç½‘ç»œå‚æ•°è°ƒä¼˜å°±åƒç»™æ±½è½¦è°ƒè¯•å‘åŠ¨æœºï¼Œè®©ç½‘ç»œä¼ è¾“æ›´é«˜æ•ˆã€‚

**ğŸ”¸ TCPç¼“å†²åŒºä¼˜åŒ–**

```bash
# æŸ¥çœ‹å½“å‰TCPç¼“å†²åŒºè®¾ç½®
cat /proc/sys/net/core/rmem_max  # æ¥æ”¶ç¼“å†²åŒºæœ€å¤§å€¼
cat /proc/sys/net/core/wmem_max  # å‘é€ç¼“å†²åŒºæœ€å¤§å€¼

# ä¼˜åŒ–TCPç¼“å†²åŒºï¼ˆæ·»åŠ åˆ°/etc/sysctl.confï¼‰
net.core.rmem_max = 16777216          # 16MBæ¥æ”¶ç¼“å†²åŒº
net.core.wmem_max = 16777216          # 16MBå‘é€ç¼“å†²åŒº
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# åº”ç”¨è®¾ç½®
sysctl -p
```

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šç¼“å†²åŒºå°±åƒå¿«é€’ç«™çš„ä¸´æ—¶ä»“åº“ã€‚ä»“åº“å¤§äº†ï¼Œèƒ½ä¸€æ¬¡æ€§å¤„ç†æ›´å¤šåŒ…è£¹ï¼Œå‡å°‘æ¥å›è·‘è…¿çš„æ¬¡æ•°ã€‚

**ğŸ”¸ è¿æ¥æ•°é™åˆ¶ä¼˜åŒ–**

```bash
# å¢åŠ TCPè¿æ¥æ•°é™åˆ¶
net.ipv4.ip_local_port_range = 1024 65535  # å¯ç”¨ç«¯å£èŒƒå›´
net.ipv4.tcp_max_syn_backlog = 8192       # SYNé˜Ÿåˆ—é•¿åº¦
net.core.somaxconn = 8192                 # ç›‘å¬é˜Ÿåˆ—é•¿åº¦

# æ–‡ä»¶å¥æŸ„é™åˆ¶ï¼ˆæ·»åŠ åˆ°/etc/security/limits.confï¼‰
mysql soft nofile 65536
mysql hard nofile 65536
```

### 4.2 MySQLç½‘ç»œå‚æ•°ä¼˜åŒ–


**ğŸ”¸ è¿æ¥ç›¸å…³å‚æ•°**

```sql
-- å¢åŠ æœ€å¤§è¿æ¥æ•°
SET GLOBAL max_connections = 1000;

-- ä¼˜åŒ–è¿æ¥è¶…æ—¶è®¾ç½®
SET GLOBAL connect_timeout = 10;          -- è¿æ¥å»ºç«‹è¶…æ—¶
SET GLOBAL net_read_timeout = 30;         -- è¯»å–è¶…æ—¶
SET GLOBAL net_write_timeout = 30;        -- å†™å…¥è¶…æ—¶

-- å¯ç”¨è¿æ¥å‹ç¼©ï¼ˆé€‚åˆæ…¢ç½‘ç»œï¼‰
-- åœ¨my.cnfä¸­æ·»åŠ ï¼š
-- [mysql]
-- compress
```

**ğŸ”¸ MGRä¸“ç”¨ç½‘ç»œå‚æ•°**

```sql
-- æ¶ˆæ¯ç¼“å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰
SET GLOBAL group_replication_message_cache_size = 1073741824;  -- 1GB

-- é€šä¿¡å¼•æ“ç›¸å…³
SET GLOBAL group_replication_communication_max_message_size = 10485760;  -- 10MB
```

---

## 5. ğŸ—œï¸ å‹ç¼©é…ç½®ä¼˜åŒ–


### 5.1 ç†è§£MGRä¸­çš„å‹ç¼©


**æ•°æ®å‹ç¼©**å°±åƒæŠŠè¡£æœè£…è¿›çœŸç©ºè¢‹ï¼ŒåŒæ ·çš„æ•°æ®å ç”¨æ›´å°‘çš„ç½‘ç»œå¸¦å®½ã€‚

> ğŸ“Š **å‹ç¼©æ•ˆæœç¤ºæ„**ï¼š
> ```
> æœªå‹ç¼©ä¼ è¾“ï¼š
> åŸå§‹æ•°æ®ï¼š1MB â”€â”€ç½‘ç»œâ”€â”€â†’ æ¥æ”¶æ–¹ï¼š1MB
> ä¼ è¾“æ—¶é—´ï¼š1MB Ã· 10Mbps = 0.8ç§’
> 
> å‹ç¼©ä¼ è¾“ï¼š
> åŸå§‹æ•°æ®ï¼š1MB â”€â”€å‹ç¼©â”€â”€â†’ 0.3MB â”€â”€ç½‘ç»œâ”€â”€â†’ è§£å‹ç¼© â”€â”€â†’ 1MB
> ä¼ è¾“æ—¶é—´ï¼š0.3MB Ã· 10Mbps = 0.24ç§’
> ä½†éœ€è¦é¢å¤–çš„å‹ç¼©/è§£å‹æ—¶é—´
> ```

### 5.2 MGRå‹ç¼©é…ç½®


**ğŸ”¸ å¯ç”¨MGRå‹ç¼©**

```sql
-- å¯ç”¨ç»„å¤åˆ¶å‹ç¼©
SET GLOBAL group_replication_compression_threshold = 1000;  -- 1KBä»¥ä¸Šçš„æ¶ˆæ¯å‹ç¼©

-- è®¾ç½®å‹ç¼©ç®—æ³•ï¼ˆMySQL 8.0.18+ï¼‰
SET GLOBAL group_replication_communication_compression_algorithm = 'ZSTD';

-- å¯é€‰å‹ç¼©ç®—æ³•ï¼š
-- 'NONE'ï¼šä¸å‹ç¼©
-- 'ZLIB'ï¼šé€šç”¨å‹ç¼©ï¼Œå…¼å®¹æ€§å¥½
-- 'ZSTD'ï¼šå‹ç¼©ç‡é«˜ï¼Œé€Ÿåº¦å¿«ï¼ˆæ¨èï¼‰
-- 'LZ4'ï¼šå‹ç¼©é€Ÿåº¦æœ€å¿«ï¼Œå‹ç¼©ç‡ä¸­ç­‰
```

**ğŸ”¸ å‹ç¼©å‚æ•°è°ƒä¼˜**

```sql
-- æŸ¥çœ‹å‹ç¼©æ•ˆæœ
SELECT 
    COMPRESSION_TYPE,
    UNCOMPRESSED_BYTES,
    COMPRESSED_BYTES,
    ROUND(100 - (COMPRESSED_BYTES/UNCOMPRESSED_BYTES)*100, 2) AS compression_ratio
FROM performance_schema.binary_log_transaction_compression_stats;
```

### 5.3 å‹ç¼©ç­–ç•¥é€‰æ‹©


**ğŸ“‹ å‹ç¼©ç®—æ³•é€‰æ‹©æŒ‡å—**ï¼š

| ç½‘ç»œç¯å¢ƒ | **æ¨èç®—æ³•** | **åŸå› ** |
|---------|-------------|----------|
| ğŸš€ **é«˜é€Ÿå±€åŸŸç½‘** | `LZ4æˆ–ä¸å‹ç¼©` | `CPUå¼€é”€å°ï¼Œç½‘ç»œä¸æ˜¯ç“¶é¢ˆ` |
| ğŸ“¡ **ä¸­é€Ÿç½‘ç»œ** | `ZSTD` | `å¹³è¡¡å‹ç¼©ç‡å’Œé€Ÿåº¦` |
| ğŸŒ **æ…¢é€Ÿç½‘ç»œ** | `ZLIB` | `æœ€å¤§åŒ–å¸¦å®½èŠ‚çœ` |
| âš¡ **ä½å»¶è¿Ÿè¦æ±‚** | `ä¸å‹ç¼©` | `é¿å…å‹ç¼©å»¶è¿Ÿ` |

---

## 6. ğŸ” SSLæ€§èƒ½ä¼˜åŒ–


### 6.1 ç†è§£SSLå¯¹MGRæ€§èƒ½çš„å½±å“


**SSLåŠ å¯†**å°±åƒç»™æ•°æ®å¥—ä¸Šä¸€ä¸ªå®‰å…¨çš„ä¿æŠ¤å£³ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹éœ€è¦æ¶ˆè€—é¢å¤–çš„æ—¶é—´å’Œèµ„æºã€‚

```
SSLé€šä¿¡æµç¨‹ï¼š
æ™®é€šé€šä¿¡ï¼šæ•°æ® â”€â”€ç›´æ¥ä¼ è¾“â”€â”€â†’ æ¥æ”¶æ–¹
SSLé€šä¿¡ï¼šæ•°æ® â”€â”€åŠ å¯†â”€â”€â†’ ä¼ è¾“ â”€â”€è§£å¯†â”€â”€â†’ æ¥æ”¶æ–¹
            â†‘                    â†‘
         CPUå¼€é”€              CPUå¼€é”€
```

### 6.2 SSLæ€§èƒ½ä¼˜åŒ–é…ç½®


**ğŸ”¸ é€‰æ‹©åˆé€‚çš„SSLé…ç½®**

```sql
-- åœ¨my.cnfä¸­é…ç½®SSL
[mysqld]
# åŸºæœ¬SSLé…ç½®
ssl-ca=/path/to/ca.pem
ssl-cert=/path/to/server-cert.pem
ssl-key=/path/to/server-key.pem

# æ€§èƒ½ä¼˜åŒ–é…ç½®
ssl-cipher=ECDHE-RSA-AES128-GCM-SHA256  # é€‰æ‹©é«˜æ•ˆçš„åŠ å¯†å¥—ä»¶
tls-version=TLSv1.2,TLSv1.3             # ä½¿ç”¨æ–°ç‰ˆæœ¬TLS

# MGR SSLé…ç½®
group_replication_ssl_mode=REQUIRED
group_replication_recovery_use_ssl=ON
```

**ğŸ”¸ ç¡¬ä»¶åŠ é€Ÿä¼˜åŒ–**

```bash
# æ£€æŸ¥CPUæ˜¯å¦æ”¯æŒAES-NIåŠ é€Ÿ
grep -i aes /proc/cpuinfo

# å¦‚æœæ”¯æŒï¼Œç¡®ä¿ä½¿ç”¨AESç›¸å…³çš„åŠ å¯†å¥—ä»¶
# åœ¨MySQLé…ç½®ä¸­ä¼˜å…ˆé€‰æ‹©AESåŠ å¯†
```

### 6.3 SSLæ€§èƒ½ç›‘æ§


```sql
-- æŸ¥çœ‹SSLè¿æ¥çŠ¶æ€
SHOW STATUS LIKE 'Ssl%';

-- æŸ¥çœ‹å…·ä½“çš„SSLä¿¡æ¯
SELECT 
    CONNECTION_ID,
    SSL_VERSION,
    SSL_CIPHER,
    SSL_SESSIONS_REUSED
FROM performance_schema.session_status 
WHERE VARIABLE_NAME LIKE 'Ssl%';
```

---

## 7. ğŸŒ ç½‘ç»œæ‹“æ‰‘ä¸å¤šç½‘å¡é…ç½®


### 7.1 ç†è§£ç½‘ç»œæ‹“æ‰‘å¯¹MGRçš„å½±å“


**ç½‘ç»œæ‹“æ‰‘**å°±æ˜¯æœåŠ¡å™¨ä¹‹é—´è¿æ¥çš„"è·¯çº¿å›¾"ï¼Œå°±åƒåŸå¸‚çš„é“è·¯è§„åˆ’å½±å“äº¤é€šæ•ˆç‡ä¸€æ ·ã€‚

```
ä¸åŒç½‘ç»œæ‹“æ‰‘ç¤ºæ„ï¼š

ğŸ”¸ å•äº¤æ¢æœºæ‹“æ‰‘ï¼ˆæ¨èï¼‰ï¼š
èŠ‚ç‚¹A â”€â”€â”
        â”œâ”€â”€ äº¤æ¢æœº â”€â”€ å¤–ç½‘
èŠ‚ç‚¹B â”€â”€â”¤
        â”‚
èŠ‚ç‚¹C â”€â”€â”˜
ä¼˜ç‚¹ï¼šå»¶è¿Ÿä½ï¼Œå¸¦å®½è¶³
ç¼ºç‚¹ï¼šå•ç‚¹æ•…éšœé£é™©

ğŸ”¸ å¤šäº¤æ¢æœºæ‹“æ‰‘ï¼š
èŠ‚ç‚¹A â”€â”€ äº¤æ¢æœº1 â”€â”€â”
                   â”œâ”€â”€ æ ¸å¿ƒäº¤æ¢æœº â”€â”€ å¤–ç½‘
èŠ‚ç‚¹B â”€â”€ äº¤æ¢æœº2 â”€â”€â”¤
                   â”‚
èŠ‚ç‚¹C â”€â”€ äº¤æ¢æœº3 â”€â”€â”˜
ä¼˜ç‚¹ï¼šå¯é æ€§é«˜
ç¼ºç‚¹ï¼šå»¶è¿Ÿç¨é«˜

ğŸ”¸ è·¨æ•°æ®ä¸­å¿ƒæ‹“æ‰‘ï¼š
æ•°æ®ä¸­å¿ƒA: [èŠ‚ç‚¹A] â†â”€â”€ä¸“çº¿â”€â”€â†’ [èŠ‚ç‚¹B] :æ•°æ®ä¸­å¿ƒB
                              â†‘
                              â””â”€â”€ [èŠ‚ç‚¹C] :æ•°æ®ä¸­å¿ƒC
æŒ‘æˆ˜ï¼šå»¶è¿Ÿé«˜ï¼Œå¸¦å®½é™åˆ¶
```

### 7.2 å¤šç½‘å¡é…ç½®ä¼˜åŒ–


**å¤šç½‘å¡**å°±åƒç»™æœåŠ¡å™¨å®‰è£…å¤šæ¡"ç½‘ç»œé€šé“"ï¼Œå¯ä»¥æé«˜å¸¦å®½å’Œå¯é æ€§ã€‚

**ğŸ”¸ ç½‘å¡ç»‘å®šé…ç½®**

```bash
# åˆ›å»ºç½‘å¡ç»‘å®šé…ç½®æ–‡ä»¶ /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE=bond0
TYPE=Bond
BONDING_MASTER=yes
BOOTPROTO=static
IPADDR=192.168.1.100
NETMASK=255.255.255.0
BONDING_OPTS="mode=802.3ad miimon=100 lacp_rate=fast"

# é…ç½®ç‰©ç†ç½‘å¡ /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
BOOTPROTO=none
MASTER=bond0
SLAVE=yes

# é…ç½®ç‰©ç†ç½‘å¡ /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
BOOTPROTO=none
MASTER=bond0
SLAVE=yes

# é‡å¯ç½‘ç»œæœåŠ¡
systemctl restart network
```

**ğŸ”¸ MySQLç»‘å®šç‰¹å®šç½‘å¡**

```sql
-- åœ¨my.cnfä¸­æŒ‡å®šç»‘å®šçš„IPåœ°å€
[mysqld]
bind-address=192.168.1.100  # ç»‘å®šåˆ°bond0çš„IP

# MGRé€šä¿¡æŒ‡å®šæ¥å£
group_replication_local_address="192.168.1.100:33061"
```

### 7.3 ç½‘ç»œQoSé…ç½®


**QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰**å°±åƒç»™ä¸åŒç±»å‹çš„æ•°æ®åˆ†é…"ä¼˜å…ˆé€šè¡Œæƒ"ã€‚

```bash
# ä½¿ç”¨tcå‘½ä»¤é…ç½®æµé‡æ§åˆ¶
# ä¸ºMGRæµé‡åˆ›å»ºé«˜ä¼˜å…ˆçº§é˜Ÿåˆ—
tc qdisc add dev eth0 root handle 1: htb default 30
tc class add dev eth0 parent 1: classid 1:1 htb rate 1000mbit
tc class add dev eth0 parent 1:1 classid 1:10 htb rate 800mbit ceil 1000mbit prio 1
tc class add dev eth0 parent 1:1 classid 1:20 htb rate 200mbit ceil 1000mbit prio 2

# MGRç«¯å£æµé‡ä½¿ç”¨é«˜ä¼˜å…ˆçº§
tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip dport 33061 0xffff flowid 1:10
```

---

## 8. ğŸŒ è·¨åœ°åŸŸéƒ¨ç½²ä¼˜åŒ–


### 8.1 è·¨åœ°åŸŸéƒ¨ç½²çš„æŒ‘æˆ˜


**è·¨åœ°åŸŸéƒ¨ç½²**å°±åƒåœ¨ä¸åŒåŸå¸‚å¼€åˆ†å…¬å¸ï¼Œæ€»éƒ¨å’Œåˆ†å…¬å¸ä¹‹é—´çš„åè°ƒä¼šå˜å¾—å¤æ‚ã€‚

```
è·¨åœ°åŸŸéƒ¨ç½²ç¤ºæ„å›¾ï¼š
åŒ—äº¬æœºæˆ¿     â†â”€â”€â”€â”€â”€å»¶è¿Ÿ50msâ”€â”€â”€â”€â”€â†’     ä¸Šæµ·æœºæˆ¿
[èŠ‚ç‚¹A]                              [èŠ‚ç‚¹B]
   â†‘                                    â†‘
   â””â”€â”€å»¶è¿Ÿ30msâ”€â”€â†’ [èŠ‚ç‚¹C] â†â”€â”€å»¶è¿Ÿ40msâ”€â”€â”˜
                  æ·±åœ³æœºæˆ¿

æŒ‘æˆ˜ï¼š
â€¢ ç½‘ç»œå»¶è¿Ÿå¤§ï¼ˆ50ms+ï¼‰
â€¢ å¸¦å®½é™åˆ¶ï¼ˆé€šå¸¸æ¯”å±€åŸŸç½‘å°ï¼‰
â€¢ ç½‘ç»œæŠ–åŠ¨ï¼ˆå¶å°”å»¶è¿Ÿçªå¢ï¼‰
â€¢ æˆæœ¬é«˜ï¼ˆè·¨åœ°åŸŸä¸“çº¿è´µï¼‰
```

### 8.2 è·¨åœ°åŸŸä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ åˆç†çš„æˆå‘˜åˆ†å¸ƒ**

```sql
-- é…ç½®MGRä»¥é€‚åº”é«˜å»¶è¿Ÿ
SET GLOBAL group_replication_member_expel_timeout = 120;  -- å¢åŠ è¶…æ—¶æ—¶é—´
SET GLOBAL group_replication_autorejoin_tries = 5;       -- å¢åŠ é‡è¯•æ¬¡æ•°

-- è°ƒæ•´å¿ƒè·³é—´éš”
SET GLOBAL group_replication_group_seeds = 
'node1.beijing.example.com:33061,node2.shanghai.example.com:33061,node3.shenzhen.example.com:33061';
```

**ğŸ”¸ è¯»å†™åˆ†ç¦»ç­–ç•¥**

```sql
-- æ¯ä¸ªåœ°åŸŸçš„åº”ç”¨ä¼˜å…ˆè®¿é—®æœ¬åœ°èŠ‚ç‚¹
-- åº”ç”¨è¿æ¥é…ç½®ç¤ºä¾‹

# åŒ—äº¬åº”ç”¨é…ç½®
spring.datasource.url=jdbc:mysql://node1.beijing.example.com:3306/mydb
spring.datasource.read-only-url=jdbc:mysql://node1.beijing.example.com:3306/mydb

# ä¸Šæµ·åº”ç”¨é…ç½®  
spring.datasource.url=jdbc:mysql://node2.shanghai.example.com:3306/mydb
spring.datasource.read-only-url=jdbc:mysql://node2.shanghai.example.com:3306/mydb
```

### 8.3 ç½‘ç»œä¼˜åŒ–é…ç½®


**ğŸ”¸ ä¸“çº¿ç½‘ç»œä¼˜åŒ–**

```bash
# TCPæ‹¥å¡æ§åˆ¶ç®—æ³•ä¼˜åŒ–ï¼ˆé€‚åˆé«˜å»¶è¿Ÿç½‘ç»œï¼‰
echo 'net.ipv4.tcp_congestion_control = bbr' >> /etc/sysctl.conf

# è°ƒæ•´TCPçª—å£å¤§å°
echo 'net.core.rmem_max = 67108864' >> /etc/sysctl.conf
echo 'net.core.wmem_max = 67108864' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem = 4096 87380 67108864' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_wmem = 4096 65536 67108864' >> /etc/sysctl.conf

sysctl -p
```

---

## 9. ğŸ“Š ç½‘ç»œç›‘æ§ä¸æ•…éšœè¯Šæ–­


### 9.1 ç½‘ç»œç›‘æ§æŒ‡æ ‡


**ç½‘ç»œç›‘æ§**å°±åƒç»™ç½‘ç»œå®‰è£…"å¥åº·ç›‘æµ‹å™¨"ï¼Œæ—¶åˆ»å…³æ³¨ç½‘ç»œçŠ¶æ€ã€‚

**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**

```sql
-- MGRçŠ¶æ€ç›‘æ§
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE
FROM performance_schema.replication_group_members;

-- ç½‘ç»œç›¸å…³çŠ¶æ€
SHOW STATUS LIKE 'group_replication%';
```

**ğŸ”¸ ç½‘ç»œå»¶è¿Ÿç›‘æ§è„šæœ¬**

```bash
#!/bin/bash
# mgr_network_monitor.sh - MGRç½‘ç»œç›‘æ§è„šæœ¬

MGR_NODES=("192.168.1.101" "192.168.1.102" "192.168.1.103")
LOG_FILE="/var/log/mgr_network.log"

while true; do
    for node in "${MGR_NODES[@]}"; do
        # æµ‹è¯•pingå»¶è¿Ÿ
        ping_time=$(ping -c 1 -W 1 $node | grep 'time=' | awk -F'time=' '{print $2}' | awk '{print $1}')
        
        # æµ‹è¯•MySQLç«¯å£è¿é€šæ€§
        mysql_test=$(timeout 5 mysql -h$node -e "SELECT 1" 2>/dev/null && echo "OK" || echo "FAIL")
        
        # è®°å½•æ—¥å¿—
        echo "$(date '+%Y-%m-%d %H:%M:%S') Node:$node Ping:${ping_time}ms MySQL:$mysql_test" >> $LOG_FILE
    done
    
    sleep 10
done
```

### 9.2 å¸¸è§ç½‘ç»œé—®é¢˜è¯Šæ–­


**ğŸ”¸ ç½‘ç»œå»¶è¿Ÿé—®é¢˜è¯Šæ–­**

```bash
# 1. åŸºç¡€ç½‘ç»œæµ‹è¯•
ping -c 100 192.168.1.101  # æµ‹è¯•100æ¬¡pingï¼Œçœ‹å¹³å‡å»¶è¿Ÿå’Œä¸¢åŒ…ç‡

# 2. è·¯ç”±è·Ÿè¸ª
traceroute 192.168.1.101   # æŸ¥çœ‹æ•°æ®åŒ…ç»è¿‡çš„è·¯å¾„

# 3. ç½‘ç»œè´¨é‡æµ‹è¯•
mtr 192.168.1.101          # å®æ—¶æ˜¾ç¤ºç½‘ç»œè´¨é‡

# 4. ç«¯å£è¿é€šæ€§æµ‹è¯•
telnet 192.168.1.101 3306  # æµ‹è¯•MySQLç«¯å£
nmap -p 3306,33061 192.168.1.101  # æ‰«æMGRç›¸å…³ç«¯å£
```

**ğŸ”¸ å¸¦å®½ç“¶é¢ˆè¯Šæ–­**

```bash
# 1. å®æ—¶ç½‘ç»œæµé‡ç›‘æ§
iftop -i eth0 -P          # æ˜¾ç¤ºç«¯å£çº§åˆ«çš„æµé‡

# 2. å†å²æµé‡ç»Ÿè®¡
sar -n DEV 1 60           # 60ç§’å†…æ¯ç§’ç»Ÿè®¡ç½‘ç»œæµé‡

# 3. ç½‘ç»œå¸¦å®½æµ‹è¯•
iperf3 -s                # åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå¯åŠ¨æœåŠ¡ç«¯
iperf3 -c 192.168.1.101   # åœ¨å¦ä¸€å°æœåŠ¡å™¨æµ‹è¯•å¸¦å®½
```

### 9.3 MGRä¸“ç”¨è¯Šæ–­


**ğŸ”¸ MGRçŠ¶æ€æ£€æŸ¥SQL**

```sql
-- 1. æ£€æŸ¥é›†ç¾¤æ•´ä½“çŠ¶æ€
SELECT 
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    IF(MEMBER_STATE = 'ONLINE', 'âœ… æ­£å¸¸', 'âŒ å¼‚å¸¸') AS STATUS
FROM performance_schema.replication_group_members;

-- 2. æ£€æŸ¥ç½‘ç»œé€šä¿¡ç»Ÿè®¡
SELECT 
    CHANNEL_NAME,
    COUNTER_NAME,
    COUNTER_VALUE
FROM performance_schema.replication_group_member_stats
WHERE COUNTER_NAME LIKE '%network%' OR COUNTER_NAME LIKE '%queue%';

-- 3. æ£€æŸ¥é”™è¯¯æ—¥å¿—
SELECT 
    LOGGED,
    ERROR_CODE,
    SUBSYSTEM,
    DATA
FROM performance_schema.error_log 
WHERE SUBSYSTEM = 'Repl' 
ORDER BY LOGGED DESC 
LIMIT 10;
```

---

## 10. ğŸ“‹ ç½‘ç»œæœ€ä½³å®è·µæ€»ç»“


### 10.1 ç½‘ç»œæ¶æ„æœ€ä½³å®è·µ


**ğŸ”¸ ç¡¬ä»¶å±‚é¢**

> ğŸ’¡ **ç½‘ç»œè®¾å¤‡é€‰æ‹©**ï¼š
> - **äº¤æ¢æœº**ï¼šé€‰æ‹©ä¼ä¸šçº§ï¼Œæ”¯æŒä¸‡å…†ç«¯å£
> - **ç½‘å¡**ï¼šåƒå…†èµ·æ­¥ï¼Œæ¨èä¸‡å…†ç½‘å¡
> - **çº¿ç¼†**ï¼šå…­ç±»çº¿ä»¥ä¸Šï¼Œå…‰çº¤æ›´ä½³
> - **å†—ä½™**ï¼šåŒç½‘å¡ç»‘å®šï¼ŒåŒäº¤æ¢æœºè¿æ¥

**ğŸ”¸ ç½‘ç»œæ‹“æ‰‘è§„åˆ’**

```
æ¨èçš„MGRç½‘ç»œæ‹“æ‰‘ï¼š

åŒæœºæˆ¿éƒ¨ç½²ï¼ˆæœ€ä½³ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¸å¿ƒäº¤æ¢æœºï¼ˆä¸‡å…†ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MGRèŠ‚ç‚¹1 â”‚ MGRèŠ‚ç‚¹2 â”‚ MGRèŠ‚ç‚¹3        â”‚
â”‚ åŒç½‘å¡   â”‚ åŒç½‘å¡   â”‚ åŒç½‘å¡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è·¨æœºæˆ¿éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰ï¼š
æœºæˆ¿A â†â”€â”€ä¸“çº¿ï¼ˆåƒå…†+ï¼‰â”€â”€â†’ æœºæˆ¿B
[MGRèŠ‚ç‚¹1,2]                [MGRèŠ‚ç‚¹3]
```

### 10.2 é…ç½®å‚æ•°æœ€ä½³å®è·µ


**ğŸ”¸ æ ¸å¿ƒå‚æ•°é…ç½®æ¨¡æ¿**

```sql
-- MGRç½‘ç»œä¼˜åŒ–å‚æ•°ï¼ˆmy.cnfï¼‰
[mysqld]
# åŸºç¡€ç½‘ç»œå‚æ•°
max_connections = 1000
connect_timeout = 10
net_read_timeout = 30
net_write_timeout = 30

# MGRä¸“ç”¨å‚æ•°
group_replication_communication_max_message_size = 10485760
group_replication_message_cache_size = 1073741824
group_replication_member_expel_timeout = 60
group_replication_autorejoin_tries = 3

# å‹ç¼©é…ç½®ï¼ˆæ ¹æ®ç½‘ç»œæƒ…å†µé€‰æ‹©ï¼‰
group_replication_compression_threshold = 1024
group_replication_communication_compression_algorithm = 'ZSTD'

# SSLé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
group_replication_ssl_mode = REQUIRED
ssl-cipher = ECDHE-RSA-AES128-GCM-SHA256
```

**ğŸ”¸ æ“ä½œç³»ç»Ÿç½‘ç»œå‚æ•°æ¨¡æ¿**

```bash
# æ·»åŠ åˆ° /etc/sysctl.conf
# TCPç¼“å†²åŒºä¼˜åŒ–
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864

# è¿æ¥æ•°ä¼˜åŒ–
net.ipv4.ip_local_port_range = 1024 65535
net.ipv4.tcp_max_syn_backlog = 8192
net.core.somaxconn = 8192

# é«˜å»¶è¿Ÿç½‘ç»œä¼˜åŒ–
net.ipv4.tcp_congestion_control = bbr
net.ipv4.tcp_slow_start_after_idle = 0
```

### 10.3 ç›‘æ§å’Œç»´æŠ¤æœ€ä½³å®è·µ


**ğŸ”¸ æ—¥å¸¸ç›‘æ§æ¸…å•**

```
ğŸ“Š æ¯æ—¥æ£€æŸ¥é¡¹ï¼š
â–¡ MGRé›†ç¾¤æˆå‘˜çŠ¶æ€
â–¡ ç½‘ç»œå»¶è¿Ÿæ˜¯å¦æ­£å¸¸ï¼ˆ<5mså±€åŸŸç½‘ï¼Œ<50msè·¨åœ°åŸŸï¼‰
â–¡ ç½‘ç»œå¸¦å®½ä½¿ç”¨ç‡ï¼ˆ<80%ï¼‰
â–¡ é”™è¯¯æ—¥å¿—ä¸­çš„ç½‘ç»œç›¸å…³é”™è¯¯

ğŸ“Š æ¯å‘¨æ£€æŸ¥é¡¹ï¼š
â–¡ ç½‘ç»œè´¨é‡è¶‹åŠ¿åˆ†æ
â–¡ SSLè¯ä¹¦æœ‰æ•ˆæœŸæ£€æŸ¥
â–¡ ç½‘ç»œé…ç½®å‚æ•°ä¼˜åŒ–æ•ˆæœè¯„ä¼°
â–¡ å¤‡ä»½ç½‘ç»œè®¾å¤‡çŠ¶æ€æ£€æŸ¥

ğŸ“Š æ¯æœˆæ£€æŸ¥é¡¹ï¼š
â–¡ ç½‘ç»œå®¹é‡è§„åˆ’è¯„ä¼°
â–¡ è·¨åœ°åŸŸç½‘ç»œæˆæœ¬ä¼˜åŒ–
â–¡ ç½‘ç»œå®‰å…¨ç­–ç•¥æ›´æ–°
â–¡ ç¾éš¾æ¢å¤æ–¹æ¡ˆæµ‹è¯•
```

### 10.4 æ•…éšœåº”æ€¥å¤„ç†æµç¨‹


**ğŸ”¸ ç½‘ç»œæ•…éšœåº”æ€¥å“åº”**

```
ç½‘ç»œæ•…éšœå¤„ç†æµç¨‹ï¼š

1ï¸âƒ£ æ•…éšœå‘ç°ï¼ˆè‡ªåŠ¨å‘Šè­¦æˆ–äººå·¥å‘ç°ï¼‰
   â†“
2ï¸âƒ£ å¿«é€Ÿè¯„ä¼°å½±å“èŒƒå›´
   â€¢ å½±å“å“ªäº›MGRèŠ‚ç‚¹ï¼Ÿ
   â€¢ æ˜¯å¦å¯¼è‡´é›†ç¾¤åˆ†è£‚ï¼Ÿ
   â€¢ ä¸šåŠ¡æ˜¯å¦å—å½±å“ï¼Ÿ
   â†“
3ï¸âƒ£ åº”æ€¥å¤„ç†
   â€¢ è½»å¾®å»¶è¿Ÿï¼šè°ƒæ•´è¶…æ—¶å‚æ•°
   â€¢ ä¸¥é‡ç½‘ç»œé—®é¢˜ï¼šä¸´æ—¶ç§»é™¤æ•…éšœèŠ‚ç‚¹
   â€¢ é›†ç¾¤åˆ†è£‚ï¼šæ‰‹åŠ¨é€‰æ‹©ä¸»é›†ç¾¤
   â†“
4ï¸âƒ£ æ ¹æœ¬åŸå› åˆ†æ
   â€¢ ç¡¬ä»¶æ•…éšœï¼Ÿ
   â€¢ ç½‘ç»œé…ç½®é—®é¢˜ï¼Ÿ
   â€¢ å¤–éƒ¨ç½‘ç»œé—®é¢˜ï¼Ÿ
   â†“
5ï¸âƒ£ æ°¸ä¹…ä¿®å¤
   â€¢ æ›´æ¢æ•…éšœç¡¬ä»¶
   â€¢ ä¼˜åŒ–ç½‘ç»œé…ç½®
   â€¢ å‡çº§ç½‘ç»œè®¾å¤‡
   â†“
6ï¸âƒ£ é¢„é˜²æªæ–½
   â€¢ å¢å¼ºç›‘æ§
   â€¢ ä¼˜åŒ–é…ç½®
   â€¢ åˆ¶å®šé¢„æ¡ˆ
```

### 10.5 æ ¸å¿ƒè¦ç‚¹æ€»ç»“


```
ğŸ”¸ MGRç½‘ç»œæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒåŸåˆ™ï¼š
â€¢ ä½å»¶è¿Ÿä¼˜å…ˆï¼šå»¶è¿Ÿæ¯”å¸¦å®½æ›´é‡è¦
â€¢ ç¨³å®šæ€§ç¬¬ä¸€ï¼šå®å¯æ…¢ä¸€ç‚¹ï¼Œä¸èƒ½æ–­è¿æ¥
â€¢ ç›‘æ§ä¸ºç‹ï¼šæå‰å‘ç°é—®é¢˜æ¯”äº‹åå¤„ç†æ›´é‡è¦
â€¢ å†—ä½™ä¿éšœï¼šç½‘ç»œè®¾å¤‡è¦æœ‰å¤‡ä»½æ–¹æ¡ˆ

ğŸ”¸ å…³é”®å‚æ•°è®°å¿†ï¼š
â€¢ å±€åŸŸç½‘å»¶è¿Ÿï¼š< 5ms
â€¢ å¸¦å®½éœ€æ±‚ï¼šTPS Ã— è¡Œå¤§å° Ã— èŠ‚ç‚¹æ•° Ã— 1.5
â€¢ è¶…æ—¶è®¾ç½®ï¼š30-60ç§’ï¼ˆæ ¹æ®ç½‘ç»œè´¨é‡ï¼‰
â€¢ å‹ç¼©é˜ˆå€¼ï¼š1KBä»¥ä¸Šå¯ç”¨å‹ç¼©

ğŸ”¸ ç½‘ç»œä¼˜åŒ–ä¼˜å…ˆçº§ï¼š
1. ç½‘ç»œæ‹“æ‰‘è®¾è®¡ï¼ˆç‰©ç†å±‚ï¼‰
2. æ“ä½œç³»ç»Ÿå‚æ•°è°ƒä¼˜ï¼ˆç³»ç»Ÿå±‚ï¼‰
3. MySQLå‚æ•°ä¼˜åŒ–ï¼ˆåº”ç”¨å±‚ï¼‰
4. ç›‘æ§å’Œæ•…éšœå¤„ç†ï¼ˆè¿ç»´å±‚ï¼‰
```

> ğŸ“š **å­¦ä¹ å»ºè®®**ï¼šç½‘ç»œä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼Œå»ºè®®ä»åŸºç¡€çš„å»¶è¿Ÿå’Œå¸¦å®½æµ‹è¯•å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°å‚æ•°è°ƒä¼˜å’Œç›‘æ§ä½“ç³»å»ºè®¾ã€‚è®°ä½ï¼šç½‘ç»œç¨³å®šæ¯”ç½‘ç»œå¿«é€Ÿæ›´é‡è¦ï¼