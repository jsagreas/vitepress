---
title: 16ã€MGRå¯åœä¸Žé‡å¯æ“ä½œ
---
## ðŸ“š ç›®å½•

1. [MGRå¯åœæ“ä½œåŸºç¡€](#1-MGRå¯åœæ“ä½œåŸºç¡€)
2. [START GROUP_REPLICATIONå‘½ä»¤è¯¦è§£](#2-START-GROUP_REPLICATIONå‘½ä»¤è¯¦è§£)
3. [STOP GROUP_REPLICATIONå‘½ä»¤è¯¦è§£](#3-STOP-GROUP_REPLICATIONå‘½ä»¤è¯¦è§£)
4. [é›†ç¾¤ä¼˜é›…å¯åœæµç¨‹](#4-é›†ç¾¤ä¼˜é›…å¯åœæµç¨‹)
5. [èŠ‚ç‚¹é‡å¯æ“ä½œå®žè·µ](#5-èŠ‚ç‚¹é‡å¯æ“ä½œå®žè·µ)
6. [å¼•å¯¼èŠ‚ç‚¹ç®¡ç†](#6-å¼•å¯¼èŠ‚ç‚¹ç®¡ç†)
7. [å¯åœçŠ¶æ€æ£€æŸ¥ä¸Žç›‘æŽ§](#7-å¯åœçŠ¶æ€æ£€æŸ¥ä¸Žç›‘æŽ§)
8. [æ•…éšœå¤„ç†ä¸Žåº”æ€¥æ“ä½œ](#8-æ•…éšœå¤„ç†ä¸Žåº”æ€¥æ“ä½œ)
9. [è‡ªåŠ¨åŒ–å¯åœç®¡ç†](#9-è‡ªåŠ¨åŒ–å¯åœç®¡ç†)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸš€ MGRå¯åœæ“ä½œåŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯MGRå¯åœæ“ä½œ


**ç®€å•ç†è§£**ï¼šMGRå¯åœæ“ä½œå°±æ˜¯æŽ§åˆ¶MySQL Group ReplicationæœåŠ¡çš„å¼€å¯å’Œå…³é—­ã€‚

```
ç±»æ¯”ç†è§£ï¼š
å°±åƒå¼€å…³ç”µå™¨ä¸€æ ·ï¼š
- å¯åŠ¨ = æŒ‰ä¸‹å¼€å…³ï¼Œè®©è®¾å¤‡å·¥ä½œ
- åœæ­¢ = å…³é—­å¼€å…³ï¼Œè®©è®¾å¤‡åœæ­¢å·¥ä½œ

MGRå¯åœï¼š
- START = è®©èŠ‚ç‚¹åŠ å…¥å¤åˆ¶ç»„ï¼Œå¼€å§‹åŒæ­¥æ•°æ®
- STOP = è®©èŠ‚ç‚¹é€€å‡ºå¤åˆ¶ç»„ï¼Œåœæ­¢åŒæ­¥æ•°æ®
```

### 1.2 å¯åœæ“ä½œçš„æœ¬è´¨


**ðŸ”¸ å¯åŠ¨è¿‡ç¨‹çš„æœ¬è´¨**
```
èŠ‚ç‚¹çŠ¶æ€å˜åŒ–ï¼š
ç¦»çº¿çŠ¶æ€ â†’ åŠ å…¥å¤åˆ¶ç»„ â†’ æ•°æ®åŒæ­¥ â†’ åœ¨çº¿æœåŠ¡

å…·ä½“è¿‡ç¨‹ï¼š
1. æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
2. è¿žæŽ¥åˆ°å¤åˆ¶ç»„
3. è¿›è¡Œæ•°æ®åŒæ­¥ï¼ˆå¦‚æžœéœ€è¦ï¼‰
4. æˆä¸ºæ´»è·ƒæˆå‘˜
```

**ðŸ”¸ åœæ­¢è¿‡ç¨‹çš„æœ¬è´¨**
```
èŠ‚ç‚¹çŠ¶æ€å˜åŒ–ï¼š
åœ¨çº¿æœåŠ¡ â†’ åœæ­¢å†™å…¥ â†’ é€€å‡ºå¤åˆ¶ç»„ â†’ ç¦»çº¿çŠ¶æ€

å…·ä½“è¿‡ç¨‹ï¼š
1. å®Œæˆå½“å‰äº‹åŠ¡
2. é€šçŸ¥å…¶ä»–èŠ‚ç‚¹å‡†å¤‡ç¦»å¼€
3. æ–­å¼€ç»„è¿žæŽ¥
4. å˜ä¸ºç¦»çº¿çŠ¶æ€
```

### 1.3 å¯åœæ“ä½œçš„é‡è¦æ€§


**ðŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦æŽŒæ¡å¯åœæ“ä½œ**
```
æ—¥å¸¸è¿ç»´éœ€æ±‚ï¼š
âœ… æœåŠ¡å™¨ç»´æŠ¤æ—¶éœ€è¦åœæ­¢MGR
âœ… é…ç½®ä¿®æ”¹åŽéœ€è¦é‡å¯MGR
âœ… æ•…éšœæ¢å¤æ—¶éœ€è¦é‡å¯æœåŠ¡
âœ… é›†ç¾¤æ‰©å®¹ç¼©å®¹æ—¶çš„èŠ‚ç‚¹ç®¡ç†
```

**âš ï¸ ä¸å½“æ“ä½œçš„é£Žé™©**
```
å¯èƒ½å¯¼è‡´çš„é—®é¢˜ï¼š
âŒ æ•°æ®ä¸ä¸€è‡´
âŒ è„‘è£‚çŽ°è±¡
âŒ æœåŠ¡ä¸­æ–­
âŒ æ•°æ®ä¸¢å¤±
```

---

## 2. â–¶ï¸ START GROUP_REPLICATIONå‘½ä»¤è¯¦è§£


### 2.1 åŸºæœ¬å¯åŠ¨å‘½ä»¤


**ðŸ”¸ æœ€ç®€å•çš„å¯åŠ¨å‘½ä»¤**
```sql
-- å¯åŠ¨Group Replication
START GROUP_REPLICATION;
```

**è¿™ä¸ªå‘½ä»¤åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ**
```
æ‰§è¡Œè¿‡ç¨‹ï¼š
1. è¯»å–MGRç›¸å…³é…ç½®å‚æ•°
2. åˆå§‹åŒ–å¤åˆ¶ç»„è¿žæŽ¥
3. æ£€æŸ¥æœ¬èŠ‚ç‚¹ä¸Žç»„çš„å…¼å®¹æ€§
4. åŠ å…¥å¤åˆ¶ç»„
5. å¼€å§‹æ•°æ®åŒæ­¥
```

### 2.2 å¸¦ç”¨æˆ·å‡­è¯çš„å¯åŠ¨


**ðŸ”¸ æŒ‡å®šç”¨æˆ·å‡­è¯å¯åŠ¨**
```sql
-- æ–¹å¼1ï¼šç›´æŽ¥åœ¨å‘½ä»¤ä¸­æŒ‡å®š
START GROUP_REPLICATION 
USER='replication_user', 
PASSWORD='replication_password';

-- æ–¹å¼2ï¼šä½¿ç”¨é¢„é…ç½®çš„é€šé“
CHANGE REPLICATION SOURCE TO 
SOURCE_USER='replication_user',
SOURCE_PASSWORD='replication_password'
FOR CHANNEL 'group_replication_applier';

START GROUP_REPLICATION;
```

**ä¸ºä»€ä¹ˆéœ€è¦ç”¨æˆ·å‡­è¯ï¼Ÿ**
```
ç”¨é€”è¯´æ˜Žï¼š
- MGRèŠ‚ç‚¹é—´éœ€è¦ç›¸äº’è¿žæŽ¥
- éœ€è¦æœ‰æƒé™è¿›è¡Œæ•°æ®å¤åˆ¶
- ç”¨æˆ·å¿…é¡»æœ‰REPLICATION SLAVEæƒé™
- ä¿è¯å®‰å…¨çš„èº«ä»½éªŒè¯
```

### 2.3 å¯åŠ¨å‰çš„å¿…è¦æ£€æŸ¥


**ðŸ”¸ å¯åŠ¨å‰æ£€æŸ¥æ¸…å•**
```sql
-- â‘  æ£€æŸ¥MGRç›¸å…³é…ç½®
SHOW VARIABLES LIKE 'group_replication%';

-- â‘¡ æ£€æŸ¥æœåŠ¡å™¨IDå”¯ä¸€æ€§
SELECT $$server_id;

-- â‘¢ æ£€æŸ¥binlogæ˜¯å¦å¼€å¯
SHOW VARIABLES LIKE 'log_bin';

-- â‘£ æ£€æŸ¥GTIDæ˜¯å¦å¯ç”¨
SHOW VARIABLES LIKE 'gtid_mode';
SHOW VARIABLES LIKE 'enforce_gtid_consistency';

-- â‘¤ æ£€æŸ¥å¤åˆ¶ç”¨æˆ·æ˜¯å¦å­˜åœ¨
SELECT user,host FROM mysql.user WHERE user='replication_user';
```

### 2.4 é¦–æ¬¡å¯åŠ¨ï¼ˆå¼•å¯¼å¯åŠ¨ï¼‰


**ðŸ”¸ ä»€ä¹ˆæ˜¯å¼•å¯¼å¯åŠ¨**
```
å¼•å¯¼å¯åŠ¨çš„å«ä¹‰ï¼š
- ç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹
- å®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¤åˆ¶ç»„
- å…¶ä»–èŠ‚ç‚¹é€šè¿‡å®ƒåŠ å…¥ç»„
- ç›¸å½“äºŽ"ç¾¤ä¸»"çš„æ¦‚å¿µ
```

**ðŸ”¸ å¼•å¯¼å¯åŠ¨å‘½ä»¤**
```sql
-- è®¾ç½®å¼•å¯¼æ ‡å¿—
SET GLOBAL group_replication_bootstrap_group=ON;

-- å¯åŠ¨Group Replication
START GROUP_REPLICATION;

-- ç«‹å³å…³é—­å¼•å¯¼æ ‡å¿—ï¼ˆé‡è¦ï¼ï¼‰
SET GLOBAL group_replication_bootstrap_group=OFF;
```

**âš ï¸ å¼•å¯¼æ ‡å¿—çš„é‡è¦æé†’**
```
å…³é”®æ³¨æ„ç‚¹ï¼š
- åªæœ‰ç¬¬ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦è®¾ç½®å¼•å¯¼æ ‡å¿—
- å¯åŠ¨åŽå¿…é¡»ç«‹å³å…³é—­å¼•å¯¼æ ‡å¿—
- å¦‚æžœä¸å…³é—­ï¼Œé‡å¯æ—¶å¯èƒ½åˆ›å»ºæ–°ç»„
- è¿™ä¼šå¯¼è‡´è„‘è£‚é—®é¢˜
```

---

## 3. â¹ï¸ STOP GROUP_REPLICATIONå‘½ä»¤è¯¦è§£


### 3.1 åŸºæœ¬åœæ­¢å‘½ä»¤


**ðŸ”¸ åœæ­¢Group Replication**
```sql
-- åœæ­¢å½“å‰èŠ‚ç‚¹çš„Group Replication
STOP GROUP_REPLICATION;
```

**è¿™ä¸ªå‘½ä»¤å…·ä½“åšäº†ä»€ä¹ˆï¼Ÿ**
```
åœæ­¢è¿‡ç¨‹ï¼š
1. åœæ­¢æŽ¥æ”¶æ–°çš„å†™å…¥äº‹åŠ¡
2. å®Œæˆå½“å‰æ­£åœ¨å¤„ç†çš„äº‹åŠ¡
3. é€šçŸ¥å…¶ä»–èŠ‚ç‚¹è‡ªå·±è¦ç¦»å¼€
4. æ–­å¼€ä¸Žå¤åˆ¶ç»„çš„è¿žæŽ¥
5. èŠ‚ç‚¹å˜ä¸ºç¦»çº¿çŠ¶æ€
```

### 3.2 åœæ­¢æ“ä½œçš„å½±å“


**ðŸ”¸ å¯¹é›†ç¾¤çš„å½±å“**
```
å•èŠ‚ç‚¹åœæ­¢çš„å½±å“ï¼š
âœ… å…¶ä»–èŠ‚ç‚¹ç»§ç»­æ­£å¸¸å·¥ä½œ
âœ… æ•°æ®ä¸€è‡´æ€§ä¸å—å½±å“
âš ï¸ é›†ç¾¤å¯ç”¨æ€§ç•¥æœ‰ä¸‹é™
âš ï¸ å¦‚æžœæ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¼šè§¦å‘ä¸»èŠ‚ç‚¹åˆ‡æ¢
```

**ðŸ”¸ å¯¹åº”ç”¨çš„å½±å“**
```
åº”ç”¨å±‚é¢çš„å½±å“ï¼š
- å¦‚æžœåœæ­¢çš„æ˜¯è¯»å†™èŠ‚ç‚¹ï¼šéœ€è¦é‡æ–°è¿žæŽ¥åˆ°æ–°ä¸»èŠ‚ç‚¹
- å¦‚æžœåœæ­¢çš„æ˜¯åªè¯»èŠ‚ç‚¹ï¼šè¯»è¯·æ±‚éœ€è¦è·¯ç”±åˆ°å…¶ä»–èŠ‚ç‚¹
- å»ºè®®ï¼šåœæ­¢å‰å…ˆå°†æµé‡åˆ‡èµ°
```

### 3.3 å¼ºåˆ¶åœæ­¢æ“ä½œ


**ðŸ”¸ ä»€ä¹ˆæ—¶å€™éœ€è¦å¼ºåˆ¶åœæ­¢**
```
éœ€è¦å¼ºåˆ¶åœæ­¢çš„åœºæ™¯ï¼š
âŒ æ­£å¸¸åœæ­¢å‘½ä»¤æ— å“åº”
âŒ èŠ‚ç‚¹å¡åœ¨æŸä¸ªçŠ¶æ€
âŒ ç´§æ€¥ç»´æŠ¤éœ€è¦
âŒ æ•…éšœæ¢å¤éœ€è¦
```

**ðŸ”¸ å¼ºåˆ¶åœæ­¢çš„æ–¹æ³•**
```sql
-- æ–¹æ³•1ï¼šè®¾ç½®è¶…æ—¶æ—¶é—´
SET SESSION group_replication_member_expel_timeout = 5;
STOP GROUP_REPLICATION;

-- æ–¹æ³•2ï¼šç›´æŽ¥é‡å¯MySQLæœåŠ¡ï¼ˆæœ€åŽæ‰‹æ®µï¼‰
-- åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æ‰§è¡Œ
sudo systemctl restart mysql
```

---

## 4. ðŸ”„ é›†ç¾¤ä¼˜é›…å¯åœæµç¨‹


### 4.1 é›†ç¾¤å®Œæ•´åœæ­¢æµç¨‹


**ðŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦ä¼˜é›…åœæ­¢**
```
ä¼˜é›…åœæ­¢çš„å¥½å¤„ï¼š
âœ… é¿å…æ•°æ®ä¸¢å¤±
âœ… ä¿è¯æ•°æ®ä¸€è‡´æ€§
âœ… å‡å°‘æ¢å¤æ—¶é—´
âœ… é¿å…è„‘è£‚é£Žé™©
```

**ðŸ”¸ é›†ç¾¤åœæ­¢çš„æ­£ç¡®é¡ºåº**
```
åœæ­¢é¡ºåºï¼ˆé‡è¦ï¼ï¼‰ï¼š

æ­¥éª¤1ï¼šåœæ­¢å†™å…¥æµé‡
- åœ¨åº”ç”¨å±‚é¢åœæ­¢å†™å…¥æ“ä½œ
- æˆ–è€…å°†ä¸»èŠ‚ç‚¹è®¾ä¸ºåªè¯»

æ­¥éª¤2ï¼šç­‰å¾…æ•°æ®åŒæ­¥å®Œæˆ
- æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§
- ç¡®ä¿æ²¡æœ‰å¾…å¤åˆ¶çš„äº‹åŠ¡

æ­¥éª¤3ï¼šä¾æ¬¡åœæ­¢éžä¸»èŠ‚ç‚¹
- å…ˆåœæ­¢ä»ŽèŠ‚ç‚¹
- ä¿ç•™ä¸»èŠ‚ç‚¹åˆ°æœ€åŽ

æ­¥éª¤4ï¼šæœ€åŽåœæ­¢ä¸»èŠ‚ç‚¹
- ç¡®ä¿å®ƒæ˜¯æœ€åŽä¸€ä¸ªåœæ­¢çš„
```

**ðŸ”¸ å…·ä½“æ“ä½œç¤ºä¾‹**
```sql
-- åœ¨æ¯ä¸ªéžä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
mysql> STOP GROUP_REPLICATION;
mysql> SELECT * FROM performance_schema.replication_group_members;

-- æœ€åŽåœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ
mysql> STOP GROUP_REPLICATION;
```

### 4.2 é›†ç¾¤å®Œæ•´å¯åŠ¨æµç¨‹


**ðŸ”¸ é›†ç¾¤å¯åŠ¨çš„æ­£ç¡®é¡ºåº**
```
å¯åŠ¨é¡ºåºï¼š

æ­¥éª¤1ï¼šé€‰æ‹©å¼•å¯¼èŠ‚ç‚¹
- é€šå¸¸é€‰æ‹©æœ€åŽåœæ­¢çš„èŠ‚ç‚¹
- æˆ–è€…æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹

æ­¥éª¤2ï¼šå¼•å¯¼å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
- è®¾ç½®bootstrapæ ‡å¿—
- å¯åŠ¨MGR
- ç«‹å³å…³é—­bootstrapæ ‡å¿—

æ­¥éª¤3ï¼šä¾æ¬¡å¯åŠ¨å…¶ä»–èŠ‚ç‚¹
- é€ä¸ªå¯åŠ¨å…¶ä»–èŠ‚ç‚¹
- ç¡®è®¤æ¯ä¸ªèŠ‚ç‚¹æ­£å¸¸åŠ å…¥

æ­¥éª¤4ï¼šéªŒè¯é›†ç¾¤çŠ¶æ€
- æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
- ç¡®è®¤æ•°æ®ä¸€è‡´æ€§
```

**ðŸ”¸ å…·ä½“æ“ä½œç¤ºä¾‹**
```sql
-- ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¼•å¯¼èŠ‚ç‚¹ï¼‰
mysql> SET GLOBAL group_replication_bootstrap_group=ON;
mysql> START GROUP_REPLICATION;
mysql> SET GLOBAL group_replication_bootstrap_group=OFF;

-- å…¶ä»–èŠ‚ç‚¹ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰
mysql> START GROUP_REPLICATION;

-- éªŒè¯é›†ç¾¤çŠ¶æ€
mysql> SELECT * FROM performance_schema.replication_group_members;
```

### 4.3 ä¼˜é›…å¯åœçš„æ£€æŸ¥è¦ç‚¹


**ðŸ“‹ å¯åœè¿‡ç¨‹ä¸­çš„å…³é”®æ£€æŸ¥**
```sql
-- â‘  æ£€æŸ¥é›†ç¾¤æˆå‘˜çŠ¶æ€
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE
FROM performance_schema.replication_group_members;

-- â‘¡ æ£€æŸ¥å¤åˆ¶å»¶è¿Ÿ
SELECT 
    CHANNEL_NAME,
    LAST_APPLIED_TRANSACTION,
    LAST_QUEUED_TRANSACTION
FROM performance_schema.replication_connection_status;

-- â‘¢ æ£€æŸ¥äº‹åŠ¡é˜Ÿåˆ—
SELECT COUNT(*) as pending_transactions 
FROM performance_schema.replication_group_member_stats 
WHERE MEMBER_ID = $$server_uuid 
AND COUNT_TRANSACTIONS_IN_QUEUE > 0;
```

---

## 5. ðŸ”§ èŠ‚ç‚¹é‡å¯æ“ä½œå®žè·µ


### 5.1 å•èŠ‚ç‚¹é‡å¯æµç¨‹


**ðŸ”¸ ä»€ä¹ˆæ—¶å€™éœ€è¦é‡å¯å•ä¸ªèŠ‚ç‚¹**
```
å¸¸è§é‡å¯åœºæ™¯ï¼š
- ä¿®æ”¹äº†MGRé…ç½®å‚æ•°
- èŠ‚ç‚¹å‡ºçŽ°å¼‚å¸¸éœ€è¦æ¢å¤
- æ“ä½œç³»ç»Ÿç»´æŠ¤
- ç¡¬ä»¶ç»´æŠ¤
```

**ðŸ”¸ å•èŠ‚ç‚¹é‡å¯çš„æ ‡å‡†æµç¨‹**
```
é‡å¯æµç¨‹ï¼š

é˜¶æ®µ1ï¼šé‡å¯å‰å‡†å¤‡
1. æ£€æŸ¥èŠ‚ç‚¹å½“å‰çŠ¶æ€
2. å¦‚æžœæ˜¯ä¸»èŠ‚ç‚¹ï¼Œè€ƒè™‘å…ˆåˆ‡æ¢ä¸»èŠ‚ç‚¹
3. å°†è¯¥èŠ‚ç‚¹çš„æµé‡åˆ‡èµ°

é˜¶æ®µ2ï¼šåœæ­¢MGRæœåŠ¡
1. æ‰§è¡ŒSTOP GROUP_REPLICATION
2. ç¡®è®¤èŠ‚ç‚¹å·²ä»Žç»„ä¸­ç§»é™¤

é˜¶æ®µ3ï¼šé‡å¯MySQLæœåŠ¡
1. åœæ­¢MySQLæœåŠ¡
2. å¯åŠ¨MySQLæœåŠ¡

é˜¶æ®µ4ï¼šé‡æ–°åŠ å…¥é›†ç¾¤
1. æ‰§è¡ŒSTART GROUP_REPLICATION
2. ç¡®è®¤èŠ‚ç‚¹æˆåŠŸåŠ å…¥
3. æ¢å¤æµé‡
```

**ðŸ”¸ å•èŠ‚ç‚¹é‡å¯æ“ä½œç¤ºä¾‹**
```bash
# åœæ­¢MGR
mysql -e "STOP GROUP_REPLICATION;"

# é‡å¯MySQLæœåŠ¡
sudo systemctl restart mysql

# é‡æ–°å¯åŠ¨MGR
mysql -e "START GROUP_REPLICATION;"

# æ£€æŸ¥çŠ¶æ€
mysql -e "SELECT * FROM performance_schema.replication_group_members;"
```

### 5.2 ä¸»èŠ‚ç‚¹é‡å¯ç‰¹æ®Šå¤„ç†


**ðŸ”¸ ä¸»èŠ‚ç‚¹é‡å¯çš„æ³¨æ„äº‹é¡¹**
```
ä¸»èŠ‚ç‚¹é‡å¯çš„ç‰¹æ®Šæ€§ï¼š
âš ï¸ ä¸»èŠ‚ç‚¹è´Ÿè´£å†™å…¥æ“ä½œ
âš ï¸ é‡å¯æ—¶ä¼šè§¦å‘ä¸»èŠ‚ç‚¹åˆ‡æ¢
âš ï¸ åº”ç”¨è¿žæŽ¥å¯èƒ½éœ€è¦é‡æ–°å»ºç«‹
âš ï¸ éœ€è¦æ›´è°¨æ…Žçš„æ“ä½œ
```

**ðŸ”¸ ä¸»èŠ‚ç‚¹é‡å¯çš„æŽ¨èåšæ³•**
```sql
-- æ–¹æ³•1ï¼šå…ˆæ‰‹åŠ¨åˆ‡æ¢ä¸»èŠ‚ç‚¹
-- åœ¨å½“å‰ä¸»èŠ‚ç‚¹æ‰§è¡Œ
SET GLOBAL group_replication_single_primary_mode = ON;
-- ç„¶åŽé‡å¯åŽŸä¸»èŠ‚ç‚¹

-- æ–¹æ³•2ï¼šè®¾ç½®ä¸»èŠ‚ç‚¹ä¼˜å…ˆçº§
-- åœ¨å¸Œæœ›æˆä¸ºä¸»èŠ‚ç‚¹çš„èŠ‚ç‚¹ä¸Šè®¾ç½®
SET GLOBAL group_replication_member_weight = 90;
```

### 5.3 æ‰¹é‡èŠ‚ç‚¹é‡å¯


**ðŸ”¸ æ‰¹é‡é‡å¯çš„ç­–ç•¥**
```
é‡å¯ç­–ç•¥ï¼š
- æ»šåŠ¨é‡å¯ï¼šé€ä¸ªé‡å¯ï¼Œä¿è¯æœåŠ¡è¿žç»­æ€§
- åˆ†æ‰¹é‡å¯ï¼šæ¯æ¬¡é‡å¯éƒ¨åˆ†èŠ‚ç‚¹
- å…¨åœå…¨å¯ï¼šé€‚ç”¨äºŽç»´æŠ¤çª—å£æœŸ
```

**ðŸ”¸ æ»šåŠ¨é‡å¯ç¤ºä¾‹è„šæœ¬**
```bash
#!/bin/bash
# æ»šåŠ¨é‡å¯MGRèŠ‚ç‚¹è„šæœ¬

NODES=("node1" "node2" "node3")

for node in "${NODES[@]}"; do
    echo "é‡å¯èŠ‚ç‚¹: $node"
    
    # åœæ­¢MGR
    mysql -h $node -e "STOP GROUP_REPLICATION;"
    
    # é‡å¯MySQLæœåŠ¡
    ssh $node "sudo systemctl restart mysql"
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    sleep 10
    
    # é‡æ–°åŠ å…¥é›†ç¾¤
    mysql -h $node -e "START GROUP_REPLICATION;"
    
    # ç­‰å¾…åŠ å…¥å®Œæˆ
    sleep 5
    
    # æ£€æŸ¥çŠ¶æ€
    mysql -h $node -e "SELECT MEMBER_STATE FROM performance_schema.replication_group_members WHERE MEMBER_ID = $$server_uuid;"
    
    echo "èŠ‚ç‚¹ $node é‡å¯å®Œæˆ"
done
```

---

## 6. ðŸŽ¯ å¼•å¯¼èŠ‚ç‚¹ç®¡ç†


### 6.1 ä»€ä¹ˆæ˜¯å¼•å¯¼èŠ‚ç‚¹


**ðŸ”¸ å¼•å¯¼èŠ‚ç‚¹çš„æ¦‚å¿µ**
```
å¼•å¯¼èŠ‚ç‚¹å°±æ˜¯ï¼š
- é›†ç¾¤å¯åŠ¨æ—¶ç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹
- å®ƒè´Ÿè´£åˆ›å»ºæ–°çš„å¤åˆ¶ç»„
- å…¶ä»–èŠ‚ç‚¹é€šè¿‡å®ƒåŠ å…¥ç»„
- å°±åƒ"å»ºç¾¤"çš„é‚£ä¸ªäºº
```

**ðŸ”¸ å¼•å¯¼èŠ‚ç‚¹çš„ä½œç”¨**
```
ä¸»è¦ä½œç”¨ï¼š
âœ… åˆå§‹åŒ–å¤åˆ¶ç»„
âœ… å®šä¹‰ç»„çš„åˆå§‹é…ç½®
âœ… ä¸ºå…¶ä»–èŠ‚ç‚¹æä¾›åŠ å…¥ç‚¹
âœ… ä¿å­˜ç»„çš„åˆå§‹çŠ¶æ€
```

### 6.2 å¼•å¯¼èŠ‚ç‚¹çš„é€‰æ‹©


**ðŸ”¸ å¦‚ä½•é€‰æ‹©å¼•å¯¼èŠ‚ç‚¹**
```
é€‰æ‹©åŽŸåˆ™ï¼š

åŽŸåˆ™1ï¼šæ•°æ®æœ€æ–°çš„èŠ‚ç‚¹
- é€‰æ‹©GTIDæœ€æ–°çš„èŠ‚ç‚¹
- é¿å…æ•°æ®å›žé€€

åŽŸåˆ™2ï¼šæœ€åŽåœæ­¢çš„èŠ‚ç‚¹
- é€šå¸¸å®ƒçš„æ•°æ®æ˜¯æœ€æ–°çš„
- å‡å°‘æ•°æ®åŒæ­¥æ—¶é—´

åŽŸåˆ™3ï¼šç½‘ç»œè¿žæŽ¥æœ€å¥½çš„èŠ‚ç‚¹
- ç¡®ä¿å…¶ä»–èŠ‚ç‚¹èƒ½é¡ºåˆ©è¿žæŽ¥
- é¿å…ç½‘ç»œé—®é¢˜å½±å“å¯åŠ¨
```

**ðŸ”¸ æ£€æŸ¥èŠ‚ç‚¹æ•°æ®æ–°æ—§**
```sql
-- æ£€æŸ¥GTIDæ‰§è¡Œæƒ…å†µ
SHOW GLOBAL VARIABLES LIKE 'gtid_executed';

-- æ¯”è¾ƒå„èŠ‚ç‚¹çš„GTIDï¼Œé€‰æ‹©æœ€æ–°çš„ä½œä¸ºå¼•å¯¼èŠ‚ç‚¹
-- GTIDæ ¼å¼ï¼šserver_uuid:transaction_number
-- æ•°å­—è¶Šå¤§ï¼Œæ•°æ®è¶Šæ–°
```

### 6.3 å¼•å¯¼å¯åŠ¨æ“ä½œ


**ðŸ”¸ æ­£ç¡®çš„å¼•å¯¼å¯åŠ¨æ­¥éª¤**
```sql
-- æ­¥éª¤1ï¼šè®¾ç½®å¼•å¯¼æ ‡å¿—
SET GLOBAL group_replication_bootstrap_group=ON;

-- æ­¥éª¤2ï¼šå¯åŠ¨Group Replication
START GROUP_REPLICATION;

-- æ­¥éª¤3ï¼šç«‹å³å…³é—­å¼•å¯¼æ ‡å¿—ï¼ˆé‡è¦ï¼ï¼‰
SET GLOBAL group_replication_bootstrap_group=OFF;

-- æ­¥éª¤4ï¼šéªŒè¯å¯åŠ¨æˆåŠŸ
SELECT * FROM performance_schema.replication_group_members;
```

### 6.4 å¼•å¯¼èŠ‚ç‚¹çš„å¸¸è§é—®é¢˜


**ðŸ”¸ å¼•å¯¼æ ‡å¿—å¿˜è®°å…³é—­**
```sql
-- é—®é¢˜ï¼šbootstrapæ ‡å¿—æ²¡æœ‰å…³é—­
-- ç»“æžœï¼šèŠ‚ç‚¹é‡å¯æ—¶ä¼šåˆ›å»ºæ–°ç»„ï¼Œå¯¼è‡´è„‘è£‚

-- æ£€æŸ¥å½“å‰çŠ¶æ€
SHOW GLOBAL VARIABLES LIKE 'group_replication_bootstrap_group';

-- å¦‚æžœå€¼ä¸ºONï¼Œç«‹å³å…³é—­
SET GLOBAL group_replication_bootstrap_group=OFF;
```

**ðŸ”¸ é”™è¯¯çš„å¼•å¯¼èŠ‚ç‚¹é€‰æ‹©**
```
å¸¸è§é”™è¯¯ï¼š
âŒ é€‰æ‹©äº†æ•°æ®è¾ƒæ—§çš„èŠ‚ç‚¹ä½œä¸ºå¼•å¯¼èŠ‚ç‚¹
âŒ ç»“æžœï¼šæ–°æ•°æ®ä¸¢å¤±

è§£å†³æ–¹æ¡ˆï¼š
âœ… é‡æ–°é€‰æ‹©æ­£ç¡®çš„å¼•å¯¼èŠ‚ç‚¹
âœ… åœæ­¢å½“å‰å¼•å¯¼èŠ‚ç‚¹
âœ… ç”¨æ­£ç¡®èŠ‚ç‚¹é‡æ–°å¼•å¯¼
```

---

## 7. ðŸ“Š å¯åœçŠ¶æ€æ£€æŸ¥ä¸Žç›‘æŽ§


### 7.1 åŸºæœ¬çŠ¶æ€æ£€æŸ¥


**ðŸ”¸ æ ¸å¿ƒçŠ¶æ€æ£€æŸ¥å‘½ä»¤**
```sql
-- â‘  æ£€æŸ¥MGRæœåŠ¡çŠ¶æ€
SELECT * FROM performance_schema.replication_group_members;

-- â‘¡ æ£€æŸ¥æœ¬èŠ‚ç‚¹çŠ¶æ€
SELECT 
    MEMBER_STATE,
    MEMBER_ROLE 
FROM performance_schema.replication_group_members 
WHERE MEMBER_ID = $$server_uuid;

-- â‘¢ æ£€æŸ¥å¤åˆ¶çŠ¶æ€
SHOW SLAVE STATUS\G

-- â‘£ æ£€æŸ¥MGRç›¸å…³å˜é‡
SHOW VARIABLES LIKE 'group_replication%';
```

### 7.2 è¯¦ç»†çŠ¶æ€ç›‘æŽ§


**ðŸ”¸ èŠ‚ç‚¹çŠ¶æ€å«ä¹‰è§£é‡Š**
```
MEMBER_STATEçŠ¶æ€è¯´æ˜Žï¼š
- ONLINEï¼šèŠ‚ç‚¹æ­£å¸¸åœ¨çº¿ï¼Œå¯ä»¥å¤„ç†äº‹åŠ¡
- RECOVERINGï¼šèŠ‚ç‚¹æ­£åœ¨åŒæ­¥æ•°æ®ï¼Œè¿½èµ¶è¿›åº¦
- OFFLINEï¼šèŠ‚ç‚¹ç¦»çº¿ï¼Œä¸å‚ä¸Žå¤åˆ¶
- ERRORï¼šèŠ‚ç‚¹å‡ºçŽ°é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥æ—¥å¿—
- UNREACHABLEï¼šç½‘ç»œä¸å¯è¾¾ï¼Œå¯èƒ½æœ‰ç½‘ç»œé—®é¢˜
```

**ðŸ”¸ ç»¼åˆçŠ¶æ€æ£€æŸ¥è„šæœ¬**
```sql
-- åˆ›å»ºçŠ¶æ€æ£€æŸ¥è§†å›¾
CREATE OR REPLACE VIEW mgr_status AS
SELECT 
    MEMBER_ID,
    MEMBER_HOST,
    MEMBER_PORT,
    MEMBER_STATE,
    MEMBER_ROLE,
    CASE 
        WHEN MEMBER_STATE = 'ONLINE' THEN 'ðŸŸ¢'
        WHEN MEMBER_STATE = 'RECOVERING' THEN 'ðŸŸ¡'
        WHEN MEMBER_STATE = 'OFFLINE' THEN 'ðŸ”´'
        WHEN MEMBER_STATE = 'ERROR' THEN 'âŒ'
        ELSE 'â“'
    END as STATUS_ICON
FROM performance_schema.replication_group_members;

-- æŸ¥çœ‹çŠ¶æ€
SELECT * FROM mgr_status;
```

### 7.3 å¯åœè¿‡ç¨‹ç›‘æŽ§


**ðŸ”¸ å¯åŠ¨è¿‡ç¨‹ç›‘æŽ§**
```bash
#!/bin/bash
# ç›‘æŽ§MGRå¯åŠ¨è¿‡ç¨‹

echo "å¼€å§‹ç›‘æŽ§MGRå¯åŠ¨è¿‡ç¨‹..."

mysql -e "START GROUP_REPLICATION;" &

# ç›‘æŽ§å¯åŠ¨çŠ¶æ€
for i in {1..30}; do
    STATE=$(mysql -Ne "SELECT MEMBER_STATE FROM performance_schema.replication_group_members WHERE MEMBER_ID = $$server_uuid;")
    echo "ç¬¬${i}æ¬¡æ£€æŸ¥ - çŠ¶æ€: $STATE"
    
    if [ "$STATE" = "ONLINE" ]; then
        echo "âœ… MGRå¯åŠ¨æˆåŠŸï¼"
        break
    elif [ "$STATE" = "ERROR" ]; then
        echo "âŒ MGRå¯åŠ¨å¤±è´¥ï¼"
        break
    fi
    
    sleep 2
done
```

### 7.4 æ€§èƒ½ç›‘æŽ§æŒ‡æ ‡


**ðŸ”¸ å…³é”®æ€§èƒ½æŒ‡æ ‡**
```sql
-- äº‹åŠ¡å»¶è¿Ÿç›‘æŽ§
SELECT 
    MEMBER_ID,
    COUNT_TRANSACTIONS_IN_QUEUE,
    COUNT_TRANSACTIONS_CHECKED,
    COUNT_CONFLICTS_DETECTED,
    COUNT_TRANSACTIONS_ROWS_VALIDATING
FROM performance_schema.replication_group_member_stats;

-- ç½‘ç»œå»¶è¿Ÿç›‘æŽ§
SELECT 
    CHANNEL_NAME,
    LAST_HEARTBEAT_TIMESTAMP,
    RECEIVED_HEARTBEATS,
    LAST_ERROR_NUMBER,
    LAST_ERROR_MESSAGE
FROM performance_schema.replication_connection_status;
```

---

## 8. ðŸš¨ æ•…éšœå¤„ç†ä¸Žåº”æ€¥æ“ä½œ


### 8.1 å¸¸è§å¯åŠ¨å¤±è´¥é—®é¢˜


**ðŸ”¸ å¯åŠ¨å¤±è´¥çš„å¸¸è§åŽŸå› **
```
é…ç½®é—®é¢˜ï¼š
âŒ server_idå†²çª
âŒ GTIDé…ç½®é”™è¯¯
âŒ ç½‘ç»œé…ç½®é—®é¢˜
âŒ æƒé™é…ç½®é”™è¯¯

è§£å†³æ­¥éª¤ï¼š
1. æ£€æŸ¥é”™è¯¯æ—¥å¿—
2. éªŒè¯é…ç½®å‚æ•°
3. ä¿®å¤é…ç½®é—®é¢˜
4. é‡æ–°å°è¯•å¯åŠ¨
```

**ðŸ”¸ å¯åŠ¨å¤±è´¥æŽ’æŸ¥æµç¨‹**
```sql
-- æ­¥éª¤1ï¼šæ£€æŸ¥åŸºç¡€é…ç½®
SHOW VARIABLES LIKE 'server_id';
SHOW VARIABLES LIKE 'gtid_mode';
SHOW VARIABLES LIKE 'log_bin';

-- æ­¥éª¤2ï¼šæ£€æŸ¥MGRç‰¹å®šé…ç½®
SHOW VARIABLES LIKE 'group_replication_group_name';
SHOW VARIABLES LIKE 'group_replication_local_address';
SHOW VARIABLES LIKE 'group_replication_group_seeds';

-- æ­¥éª¤3ï¼šæ£€æŸ¥ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'replication_user'@'%';

-- æ­¥éª¤4ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
-- åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—
```

### 8.2 åœæ­¢å¤±è´¥å¤„ç†


**ðŸ”¸ åœæ­¢å‘½ä»¤æ— å“åº”**
```sql
-- æƒ…å†µ1ï¼šæ­£å¸¸åœæ­¢è¶…æ—¶
-- ç­‰å¾…æ›´é•¿æ—¶é—´æˆ–æ£€æŸ¥æ˜¯å¦æœ‰é•¿äº‹åŠ¡

-- æƒ…å†µ2ï¼šå¼ºåˆ¶åœæ­¢
-- è®¾ç½®æ›´çŸ­çš„è¶…æ—¶æ—¶é—´
SET SESSION group_replication_member_expel_timeout = 5;
STOP GROUP_REPLICATION;

-- æƒ…å†µ3ï¼šæœ€åŽæ‰‹æ®µ - é‡å¯MySQL
-- åœ¨æ“ä½œç³»ç»Ÿæ‰§è¡Œ
sudo systemctl restart mysql
```

### 8.3 è„‘è£‚é—®é¢˜å¤„ç†


**ðŸ”¸ ä»€ä¹ˆæ˜¯è„‘è£‚**
```
è„‘è£‚çŽ°è±¡ï¼š
- é›†ç¾¤åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„å­é›†ç¾¤
- æ¯ä¸ªå­é›†ç¾¤éƒ½è®¤ä¸ºè‡ªå·±æ˜¯å”¯ä¸€æ­£ç¡®çš„
- ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´
- éœ€è¦ç´§æ€¥å¤„ç†
```

**ðŸ”¸ è„‘è£‚æ£€æµ‹**
```sql
-- æ£€æŸ¥é›†ç¾¤è§†å›¾
SELECT 
    MEMBER_HOST,
    MEMBER_STATE,
    MEMBER_ROLE
FROM performance_schema.replication_group_members;

-- å¦‚æžœä¸åŒèŠ‚ç‚¹çœ‹åˆ°çš„æˆå‘˜åˆ—è¡¨ä¸åŒï¼Œå¯èƒ½å­˜åœ¨è„‘è£‚
```

**ðŸ”¸ è„‘è£‚å¤„ç†æµç¨‹**
```
å¤„ç†æ­¥éª¤ï¼š
1. ç«‹å³åœæ­¢æ‰€æœ‰å†™å…¥æ“ä½œ
2. ç¡®å®šæ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ç»„
3. åœæ­¢æ•°æ®è¾ƒæ—§çš„èŠ‚ç‚¹ç»„
4. ä¿ç•™æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ç»„
5. é‡æ–°é…ç½®MGR
6. é‡å»ºæ•´ä¸ªé›†ç¾¤
```

### 8.4 åº”æ€¥å¯åœè„šæœ¬


**ðŸ”¸ åº”æ€¥åœæ­¢è„šæœ¬**
```bash
#!/bin/bash
# åº”æ€¥åœæ­¢MGRé›†ç¾¤

NODES=("192.168.1.10" "192.168.1.11" "192.168.1.12")

echo "ðŸš¨ åº”æ€¥åœæ­¢MGRé›†ç¾¤"

for node in "${NODES[@]}"; do
    echo "åœæ­¢èŠ‚ç‚¹: $node"
    
    # å°è¯•æ­£å¸¸åœæ­¢
    timeout 30 mysql -h $node -e "STOP GROUP_REPLICATION;" 2>/dev/null
    
    if [ $? -ne 0 ]; then
        echo "âš ï¸ æ­£å¸¸åœæ­¢å¤±è´¥ï¼Œå°è¯•å¼ºåˆ¶åœæ­¢"
        ssh $node "sudo systemctl stop mysql" 2>/dev/null
    fi
    
    echo "èŠ‚ç‚¹ $node å·²åœæ­¢"
done

echo "âœ… é›†ç¾¤åº”æ€¥åœæ­¢å®Œæˆ"
```

**ðŸ”¸ åº”æ€¥å¯åŠ¨è„šæœ¬**
```bash
#!/bin/bash
# åº”æ€¥å¯åŠ¨MGRé›†ç¾¤

BOOTSTRAP_NODE="192.168.1.10"
OTHER_NODES=("192.168.1.11" "192.168.1.12")

echo "ðŸš€ åº”æ€¥å¯åŠ¨MGRé›†ç¾¤"

# å¯åŠ¨å¼•å¯¼èŠ‚ç‚¹
echo "å¯åŠ¨å¼•å¯¼èŠ‚ç‚¹: $BOOTSTRAP_NODE"
mysql -h $BOOTSTRAP_NODE -e "
SET GLOBAL group_replication_bootstrap_group=ON;
START GROUP_REPLICATION;
SET GLOBAL group_replication_bootstrap_group=OFF;
"

# ç­‰å¾…å¼•å¯¼èŠ‚ç‚¹ç¨³å®š
sleep 10

# å¯åŠ¨å…¶ä»–èŠ‚ç‚¹
for node in "${OTHER_NODES[@]}"; do
    echo "å¯åŠ¨èŠ‚ç‚¹: $node"
    mysql -h $node -e "START GROUP_REPLICATION;"
    sleep 5
done

echo "âœ… é›†ç¾¤åº”æ€¥å¯åŠ¨å®Œæˆ"

# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
mysql -h $BOOTSTRAP_NODE -e "SELECT * FROM performance_schema.replication_group_members;"
```

---

## 9. ðŸ¤– è‡ªåŠ¨åŒ–å¯åœç®¡ç†


### 9.1 è‡ªåŠ¨å¯åŠ¨é…ç½®


**ðŸ”¸ MySQLæœåŠ¡è‡ªåŠ¨å¯åŠ¨**
```ini
# /etc/systemd/system/mysql.service.d/override.conf
[Unit]
After=network.target
Wants=network.target

[Service]
Restart=always
RestartSec=10
```

**ðŸ”¸ MGRè‡ªåŠ¨å¯åŠ¨é…ç½®**
```sql
-- åœ¨my.cnfä¸­é…ç½®
[mysqld]
group_replication_start_on_boot = ON
group_replication_bootstrap_group = OFF  # æ³¨æ„ï¼šå¿…é¡»ä¸ºOFF
```

### 9.2 å¯åœç›‘æŽ§è„šæœ¬


**ðŸ”¸ MGRçŠ¶æ€ç›‘æŽ§è„šæœ¬**
```bash
#!/bin/bash
# MGRçŠ¶æ€ç›‘æŽ§å’Œè‡ªåŠ¨æ¢å¤è„šæœ¬

LOG_FILE="/var/log/mgr_monitor.log"
ALERT_EMAIL="admin@company.com"

check_mgr_status() {
    local node=$1
    local state=$(mysql -h $node -Ne "SELECT MEMBER_STATE FROM performance_schema.replication_group_members WHERE MEMBER_ID = $$server_uuid;" 2>/dev/null)
    echo $state
}

send_alert() {
    local message=$1
    echo "$(date): $message" >> $LOG_FILE
    echo "$message" | mail -s "MGR Alert" $ALERT_EMAIL
}

# æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹
NODES=("node1" "node2" "node3")

for node in "${NODES[@]}"; do
    state=$(check_mgr_status $node)
    
    case $state in
        "ONLINE")
            echo "âœ… $node: æ­£å¸¸"
            ;;
        "RECOVERING")
            echo "ðŸŸ¡ $node: æ¢å¤ä¸­"
            ;;
        "OFFLINE"|"ERROR"|"")
            echo "âŒ $node: å¼‚å¸¸ï¼Œå°è¯•é‡å¯"
            
            # å°è¯•é‡å¯MGR
            mysql -h $node -e "START GROUP_REPLICATION;" 2>/dev/null
            
            # å‘é€å‘Šè­¦
            send_alert "èŠ‚ç‚¹ $node MGRçŠ¶æ€å¼‚å¸¸ï¼Œå·²å°è¯•è‡ªåŠ¨é‡å¯"
            ;;
    esac
done
```

### 9.3 å®šæ—¶ä»»åŠ¡é…ç½®


**ðŸ”¸ ä½¿ç”¨crontabé…ç½®å®šæ—¶æ£€æŸ¥**
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ç›‘æŽ§ä»»åŠ¡ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰
*/5 * * * * /usr/local/bin/mgr_monitor.sh >/dev/null 2>&1

# æ¯å¤©å‡Œæ™¨å¤‡ä»½MGRé…ç½®
0 2 * * * /usr/local/bin/backup_mgr_config.sh
```

### 9.4 é…ç½®ç®¡ç†è‡ªåŠ¨åŒ–


**ðŸ”¸ é…ç½®æ–‡ä»¶æ¨¡æ¿**
```bash
#!/bin/bash
# MGRé…ç½®è‡ªåŠ¨åŒ–è„šæœ¬

generate_mgr_config() {
    local node_id=$1
    local node_ip=$2
    
    cat > /tmp/mgr_${node_id}.cnf << EOF
[mysqld]
# åŸºç¡€é…ç½®
server_id = ${node_id}
log_bin = mysql-bin
gtid_mode = ON
enforce_gtid_consistency = ON

# MGRé…ç½®
plugin_load_add = 'group_replication.so'
group_replication_group_name = "$(uuidgen)"
group_replication_start_on_boot = OFF
group_replication_local_address = "${node_ip}:33061"
group_replication_group_seeds = "node1:33061,node2:33061,node3:33061"
group_replication_bootstrap_group = OFF
EOF

    echo "é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: /tmp/mgr_${node_id}.cnf"
}

# ä½¿ç”¨ç¤ºä¾‹
generate_mgr_config 1 "192.168.1.10"
generate_mgr_config 2 "192.168.1.11"
generate_mgr_config 3 "192.168.1.12"
```

---

## 10. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŽŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ðŸ”¸ å¯åœæ“ä½œæœ¬è´¨ï¼šæŽ§åˆ¶èŠ‚ç‚¹åŠ å…¥/é€€å‡ºå¤åˆ¶ç»„çš„è¿‡ç¨‹
ðŸ”¸ å¼•å¯¼å¯åŠ¨ï¼šç¬¬ä¸€ä¸ªå¯åŠ¨çš„èŠ‚ç‚¹ï¼Œè´Ÿè´£åˆ›å»ºå¤åˆ¶ç»„
ðŸ”¸ ä¼˜é›…å¯åœï¼šæŒ‰æ­£ç¡®é¡ºåºå¯åœï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
ðŸ”¸ çŠ¶æ€ç›‘æŽ§ï¼šå®žæ—¶æŽŒæ¡èŠ‚ç‚¹å’Œé›†ç¾¤çš„å¥åº·çŠ¶å†µ
ðŸ”¸ æ•…éšœå¤„ç†ï¼šå¿«é€Ÿè¯†åˆ«å’Œè§£å†³å¯åœè¿‡ç¨‹ä¸­çš„é—®é¢˜
```

### 10.2 å…³é”®æ“ä½œè¦ç‚¹


**ðŸ”¹ å¯åŠ¨æ“ä½œæ ¸å¿ƒ**
```
å¯åŠ¨ä¸‰è¦ç´ ï¼š
âœ… æ­£ç¡®çš„é…ç½®å‚æ•°
âœ… æœ‰æ•ˆçš„å¤åˆ¶ç”¨æˆ·å‡­è¯
âœ… åˆé€‚çš„å¼•å¯¼èŠ‚ç‚¹é€‰æ‹©

å¯åŠ¨é¡ºåºï¼š
å¼•å¯¼èŠ‚ç‚¹ â†’ å…¶ä»–èŠ‚ç‚¹ â†’ çŠ¶æ€éªŒè¯
```

**ðŸ”¹ åœæ­¢æ“ä½œæ ¸å¿ƒ**
```
åœæ­¢ä¸‰åŽŸåˆ™ï¼š
âœ… å…ˆåœåº”ç”¨æµé‡
âœ… å…ˆåœä»ŽèŠ‚ç‚¹ï¼ŒåŽåœä¸»èŠ‚ç‚¹
âœ… ç¡®è®¤æ•°æ®åŒæ­¥å®Œæˆ

ç´§æ€¥åœæ­¢ï¼š
è®¾ç½®è¶…æ—¶ â†’ å¼ºåˆ¶åœæ­¢ â†’ é‡å¯æœåŠ¡
```

**ðŸ”¹ å¼•å¯¼èŠ‚ç‚¹ç®¡ç†**
```
é€‰æ‹©åŽŸåˆ™ï¼š
- æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹
- æœ€åŽåœæ­¢çš„èŠ‚ç‚¹
- ç½‘ç»œè¿žæŽ¥æœ€å¥½çš„èŠ‚ç‚¹

æ“ä½œè¦ç‚¹ï¼š
- è®¾ç½®bootstrapæ ‡å¿—
- å¯åŠ¨MGR
- ç«‹å³å…³é—­bootstrapæ ‡å¿—
```

### 10.3 ç›‘æŽ§æ£€æŸ¥è¦ç‚¹


**ðŸ“Š çŠ¶æ€æ£€æŸ¥æ¸…å•**
```sql
-- å¿…æ£€é¡¹ç›®
âœ… é›†ç¾¤æˆå‘˜çŠ¶æ€ï¼šperformance_schema.replication_group_members
âœ… æœ¬èŠ‚ç‚¹è§’è‰²ï¼šMEMBER_ROLE (PRIMARY/SECONDARY)
âœ… æ•°æ®åŒæ­¥çŠ¶æ€ï¼šäº‹åŠ¡é˜Ÿåˆ—å’Œå»¶è¿Ÿæƒ…å†µ
âœ… ç½‘ç»œè¿žæŽ¥çŠ¶æ€ï¼šå¿ƒè·³å’Œè¿žæŽ¥ä¿¡æ¯
âœ… é”™è¯¯æ—¥å¿—ï¼šMySQL error log
```

### 10.4 æ•…éšœå¤„ç†ç­–ç•¥


**ðŸš¨ åº”æ€¥å¤„ç†æµç¨‹**
```
æ•…éšœè¯†åˆ«ï¼š
è§‚å¯Ÿç—‡çŠ¶ â†’ æ£€æŸ¥æ—¥å¿— â†’ ç¡®å®šåŽŸå› 

å¤„ç†ç­–ç•¥ï¼š
é…ç½®é—®é¢˜ â†’ ä¿®å¤é…ç½® â†’ é‡æ–°å¯åŠ¨
ç½‘ç»œé—®é¢˜ â†’ æ£€æŸ¥ç½‘ç»œ â†’ æ¢å¤è¿žæŽ¥
æ•°æ®é—®é¢˜ â†’ æ•°æ®ä¿®å¤ â†’ é‡å»ºé›†ç¾¤
ç¡¬ä»¶é—®é¢˜ â†’ ç¡¬ä»¶ä¿®å¤ â†’ èŠ‚ç‚¹æ›¿æ¢
```

### 10.5 æœ€ä½³å®žè·µå»ºè®®


**ðŸ’¡ è¿ç»´æœ€ä½³å®žè·µ**
```
æ—¥å¸¸è¿ç»´ï¼š
ðŸ”¸ å»ºç«‹æ ‡å‡†çš„å¯åœæµç¨‹
ðŸ”¸ ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–å¸¸è§„æ“ä½œ
ðŸ”¸ è®¾ç½®å®Œå–„çš„ç›‘æŽ§å‘Šè­¦
ðŸ”¸ å®šæœŸæ¼”ç»ƒæ•…éšœæ¢å¤æµç¨‹

å®‰å…¨è¦ç‚¹ï¼š
ðŸ”¸ bootstrapæ ‡å¿—ç”¨å®Œç«‹å³å…³é—­
ðŸ”¸ å®šæœŸæ£€æŸ¥é…ç½®ä¸€è‡´æ€§
ðŸ”¸ ä¿æŒå¤‡ä»½å’Œæ¢å¤è®¡åˆ’
ðŸ”¸ æ–‡æ¡£åŒ–æ‰€æœ‰æ“ä½œæ­¥éª¤
```

**ðŸŽ¯ è®°å¿†è¦ç‚¹**
- **å¯åŠ¨é¡ºåº**ï¼šå¼•å¯¼èŠ‚ç‚¹å…ˆå¯åŠ¨ï¼Œå…¶ä»–èŠ‚ç‚¹è·Ÿéš
- **åœæ­¢é¡ºåº**ï¼šä»ŽèŠ‚ç‚¹å…ˆåœæ­¢ï¼Œä¸»èŠ‚ç‚¹æœ€åŽåœ
- **å¼•å¯¼åŽŸåˆ™**ï¼šé€‰æ‹©æ•°æ®æœ€æ–°çš„èŠ‚ç‚¹ï¼Œç”¨å®Œç«‹å³å…³é—­æ ‡å¿—
- **ç›‘æŽ§é‡ç‚¹**ï¼šèŠ‚ç‚¹çŠ¶æ€ã€æ•°æ®åŒæ­¥ã€ç½‘ç»œè¿žæŽ¥ã€é”™è¯¯æ—¥å¿—
- **åº”æ€¥å¤„ç†**ï¼šå…ˆä¿æ•°æ®ï¼Œå†æ¢å¤æœåŠ¡ï¼Œæœ€åŽåˆ†æžåŽŸå› 

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
å¯åœæ“ä½œè¦è°¨æ…Žï¼Œé¡ºåºæµç¨‹è®°å¿ƒä¸­
å¼•å¯¼èŠ‚ç‚¹é€‰æœ€æ–°ï¼Œæ ‡å¿—ç”¨å®Œç«‹å³åœ
ç›‘æŽ§çŠ¶æ€è¦åŠæ—¶ï¼Œæ•…éšœå¤„ç†è¦è¿…é€Ÿ
è„šæœ¬è‡ªåŠ¨åŒ–è¿ç»´ï¼Œæ–‡æ¡£è®°å½•ä¿å¹³å®‰
```