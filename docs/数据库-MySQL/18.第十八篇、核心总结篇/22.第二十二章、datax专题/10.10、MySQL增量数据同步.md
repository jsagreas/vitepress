---
title: 10ã€MySQLå¢žé‡æ•°æ®åŒæ­¥
---
## ðŸ“š ç›®å½•

1. [å¢žé‡åŒæ­¥åŸºç¡€æ¦‚å¿µ](#1-å¢žé‡åŒæ­¥åŸºç¡€æ¦‚å¿µ)
2. [å¢žé‡åŒæ­¥ç­–ç•¥è¯¦è§£](#2-å¢žé‡åŒæ­¥ç­–ç•¥è¯¦è§£)
3. [å­—æ®µè®¾è®¡ä¸Žé€‰æ‹©](#3-å­—æ®µè®¾è®¡ä¸Žé€‰æ‹©)
4. [DataXå¢žé‡åŒæ­¥å®žçŽ°](#4-dataxå¢žé‡åŒæ­¥å®žçŽ°)
5. [åŒæ­¥ç›‘æŽ§ä¸Žä¼˜åŒ–](#5-åŒæ­¥ç›‘æŽ§ä¸Žä¼˜åŒ–)
6. [æ•…éšœå¤„ç†ä¸Žä¸€è‡´æ€§](#6-æ•…éšœå¤„ç†ä¸Žä¸€è‡´æ€§)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ“Š å¢žé‡åŒæ­¥åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯å¢žé‡æ•°æ®åŒæ­¥


**ðŸ’¡ é€šä¿—ç†è§£**ï¼š
å¢žé‡åŒæ­¥å°±åƒæ¯å¤©åªåŒæ­¥æ–°å¢žçš„ã€ä¿®æ”¹çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æŠŠæ•´å¼ è¡¨é‡æ–°å¤åˆ¶ä¸€éã€‚

```
å…¨é‡åŒæ­¥ vs å¢žé‡åŒæ­¥å¯¹æ¯”ï¼š

å…¨é‡åŒæ­¥ï¼ˆæ¯æ¬¡éƒ½åŒæ­¥æ‰€æœ‰æ•°æ®ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æºè¡¨(1ä¸‡æ¡) â”‚ â”€â”€â†’ â”‚  ç›®æ ‡è¡¨     â”‚
â”‚  å…¨éƒ¨æ•°æ®   â”‚    â”‚  å…¨éƒ¨è¦†ç›–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç‰¹ç‚¹ï¼šç®€å•ä½†æ•ˆçŽ‡ä½Žï¼Œæ•°æ®é‡å¤§æ—¶å¾ˆæ…¢

å¢žé‡åŒæ­¥ï¼ˆåªåŒæ­¥å˜åŒ–çš„æ•°æ®ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æºè¡¨       â”‚ â”€â”€â†’ â”‚  ç›®æ ‡è¡¨     â”‚
â”‚  åªå–æ–°å¢ž/  â”‚    â”‚  åªæ›´æ–°å˜åŒ– â”‚
â”‚  ä¿®æ”¹çš„æ•°æ® â”‚    â”‚  çš„éƒ¨åˆ†     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç‰¹ç‚¹ï¼šé«˜æ•ˆå¿«é€Ÿï¼Œé€‚åˆå¤§æ•°æ®é‡
```

### 1.2 å¢žé‡åŒæ­¥çš„æ ¸å¿ƒä»·å€¼


**ðŸŽ¯ ä¸ºä»€ä¹ˆè¦ç”¨å¢žé‡åŒæ­¥**ï¼š

1. **æ€§èƒ½æå‡**ï¼šåªå¤„ç†å˜åŒ–æ•°æ®ï¼Œé€Ÿåº¦å¿«
2. **èµ„æºèŠ‚çº¦**ï¼šå‡å°‘ç½‘ç»œä¼ è¾“å’Œç£ç›˜IO
3. **å®žæ—¶æ€§å¥½**ï¼šå¯ä»¥é¢‘ç¹æ‰§è¡Œï¼ŒæŽ¥è¿‘å®žæ—¶
4. **ç³»ç»ŸåŽ‹åŠ›å°**ï¼šä¸ä¼šé•¿æ—¶é—´å ç”¨èµ„æº

```
å®žé™…æ¡ˆä¾‹å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®é‡     â”‚   å…¨é‡åŒæ­¥   â”‚   å¢žé‡åŒæ­¥   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   100ä¸‡æ¡    â”‚    10åˆ†é’Ÿ    â”‚    1åˆ†é’Ÿ     â”‚
â”‚   1000ä¸‡æ¡   â”‚    2å°æ—¶     â”‚    5åˆ†é’Ÿ     â”‚
â”‚   1äº¿æ¡      â”‚    20å°æ—¶    â”‚    15åˆ†é’Ÿ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 å¢žé‡åŒæ­¥çš„åŸºæœ¬åŽŸç†


**ðŸ” æ ¸å¿ƒæ€è·¯**ï¼š
é€šè¿‡æŸç§æ ‡è¯†æ¥åŒºåˆ†å“ªäº›æ•°æ®æ˜¯"æ–°çš„"æˆ–"å˜åŒ–çš„"ã€‚

```
å¢žé‡è¯†åˆ«çš„å¸¸ç”¨æ–¹æ³•ï¼š

æ–¹æ³•1ï¼šæ—¶é—´æˆ³å­—æ®µ
æ•°æ®è¡¨å¢žåŠ å­—æ®µï¼šupdate_time
åŽŸç†ï¼šæ ¹æ®æ—¶é—´åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºæ–°å¢žæˆ–ä¿®æ”¹

æ–¹æ³•2ï¼šè‡ªå¢žIDå­—æ®µ  
æ•°æ®è¡¨è‡ªå¸¦å­—æ®µï¼šid (AUTO_INCREMENT)
åŽŸç†ï¼šæ ¹æ®IDå¤§å°åˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºæ–°å¢ž

æ–¹æ³•3ï¼šç‰ˆæœ¬å·å­—æ®µ
æ•°æ®è¡¨å¢žåŠ å­—æ®µï¼šversion
åŽŸç†ï¼šæ¯æ¬¡ä¿®æ”¹ç‰ˆæœ¬å·+1ï¼Œæ ¹æ®ç‰ˆæœ¬å·åˆ¤æ–­

æ–¹æ³•4ï¼šçŠ¶æ€æ ‡è®°å­—æ®µ
æ•°æ®è¡¨å¢žåŠ å­—æ®µï¼šsync_flag
åŽŸç†ï¼šæ ‡è®°æ•°æ®æ˜¯å¦å·²åŒæ­¥
```

---

## 2. ðŸ›  å¢žé‡åŒæ­¥ç­–ç•¥è¯¦è§£


### 2.1 åŸºäºŽæ—¶é—´æˆ³çš„å¢žé‡åŒæ­¥


**ðŸ’¡ åŸºæœ¬æ€è·¯**ï¼š
åœ¨è¡¨ä¸­å¢žåŠ æ—¶é—´å­—æ®µï¼Œè®°å½•æ•°æ®çš„åˆ›å»ºæˆ–ä¿®æ”¹æ—¶é—´ï¼Œæ¯æ¬¡åªåŒæ­¥åœ¨æŒ‡å®šæ—¶é—´ä¹‹åŽçš„æ•°æ®ã€‚

**ðŸ”§ è¡¨ç»“æž„è®¾è®¡**ï¼š
```sql
-- ä¸ºè¡¨æ·»åŠ æ—¶é—´æˆ³å­—æ®µ
ALTER TABLE user_info ADD COLUMN 
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
  ON UPDATE CURRENT_TIMESTAMP;

-- ç¤ºä¾‹è¡¨ç»“æž„
CREATE TABLE user_info (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50),
  email VARCHAR(100),
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
    ON UPDATE CURRENT_TIMESTAMP
);
```

**ðŸ“Š åŒæ­¥é€»è¾‘ç¤ºæ„**ï¼š
```
æ—¶é—´è½´åŒæ­¥ç¤ºä¾‹ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ æ—¶é—´è½´
     â†‘           â†‘            â†‘
  ä¸Šæ¬¡åŒæ­¥    æœ¬æ¬¡æŸ¥è¯¢      ä¸‹æ¬¡æŸ¥è¯¢
 2024-01-01   2024-01-02   2024-01-03
    â”‚            â”‚            â”‚
    â””â”€åŒæ­¥ç‚¹1     â””â”€åŒæ­¥ç‚¹2     â””â”€åŒæ­¥ç‚¹3

SQLæŸ¥è¯¢ç¤ºä¾‹ï¼š
-- ç¬¬ä¸€æ¬¡å…¨é‡åŒæ­¥
SELECT * FROM user_info;

-- åŽç»­å¢žé‡åŒæ­¥ï¼ˆå‡è®¾ä¸Šæ¬¡åŒæ­¥æ—¶é—´æ˜¯2024-01-01 10:00:00ï¼‰
SELECT * FROM user_info 
WHERE update_time > '2024-01-01 10:00:00';
```

**âš¡ ä¼˜ç¼ºç‚¹åˆ†æž**ï¼š
```
âœ… ä¼˜ç‚¹ï¼š
â€¢ å®žçŽ°ç®€å•ï¼Œå®¹æ˜“ç†è§£
â€¢ å¯ä»¥æ•èŽ·æ‰€æœ‰å˜åŒ–ï¼ˆæ–°å¢žã€ä¿®æ”¹ï¼‰
â€¢ æ”¯æŒåˆ é™¤æ£€æµ‹ï¼ˆé…åˆåˆ é™¤æ ‡è®°å­—æ®µï¼‰

âŒ ç¼ºç‚¹ï¼š
â€¢ éœ€è¦ä¿®æ”¹è¡¨ç»“æž„
â€¢ æ—¶é—´ç²¾åº¦é—®é¢˜ï¼ˆåŒä¸€ç§’å†…çš„æ•°æ®å¯èƒ½é—æ¼ï¼‰
â€¢ æ—¶é’ŸåŒæ­¥è¦æ±‚é«˜
```

### 2.2 åŸºäºŽè‡ªå¢žIDçš„å¢žé‡åŒæ­¥


**ðŸ’¡ åŸºæœ¬æ€è·¯**ï¼š
åˆ©ç”¨æ•°æ®åº“çš„è‡ªå¢žIDç‰¹æ€§ï¼Œæ¯æ¬¡åªåŒæ­¥IDå¤§äºŽä¸Šæ¬¡æœ€å¤§IDçš„æ•°æ®ã€‚

**ðŸ”§ å®žçŽ°æ–¹å¼**ï¼š
```sql
-- è¡¨ç»“æž„ï¼ˆé€šå¸¸å·²æœ‰è‡ªå¢žIDï¼‰
CREATE TABLE order_info (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  order_no VARCHAR(32),
  user_id INT,
  amount DECIMAL(10,2),
  status TINYINT
);

-- å¢žé‡åŒæ­¥SQL
-- ç¬¬ä¸€æ¬¡ï¼šæŸ¥è¯¢æ‰€æœ‰æ•°æ®å¹¶è®°å½•æœ€å¤§ID
SELECT * FROM order_info;
-- å‡è®¾æœ€å¤§IDæ˜¯ 100000

-- ç¬¬äºŒæ¬¡ï¼šåªæŸ¥è¯¢IDå¤§äºŽ100000çš„æ•°æ®
SELECT * FROM order_info WHERE id > 100000;
-- å‡è®¾è¿™æ¬¡æœ€å¤§IDæ˜¯ 100500

-- ç¬¬ä¸‰æ¬¡ï¼šåªæŸ¥è¯¢IDå¤§äºŽ100500çš„æ•°æ®  
SELECT * FROM order_info WHERE id > 100500;
```

**ðŸ“ˆ åŒæ­¥ç‚¹ç®¡ç†**ï¼š
```
IDé€’å¢žåŒæ­¥ç¤ºä¾‹ï¼š
æ•°æ®è¡¨IDåˆ†å¸ƒï¼š
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
â”‚ 98 â”‚ 99 â”‚100 â”‚101 â”‚102 â”‚103 â”‚104 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
       â†‘              â†‘
   ä¸Šæ¬¡åŒæ­¥ç‚¹      æœ¬æ¬¡åŒæ­¥ç‚¹
  max_id=99       max_id=103

åŒæ­¥è®°å½•è¡¨è®¾è®¡ï¼š
CREATE TABLE sync_checkpoint (
  table_name VARCHAR(50) PRIMARY KEY,
  last_sync_id BIGINT,
  last_sync_time TIMESTAMP
);
```

**âš¡ ä¼˜ç¼ºç‚¹åˆ†æž**ï¼š
```
âœ… ä¼˜ç‚¹ï¼š
â€¢ ä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡è¡¨ç»“æž„  
â€¢ æ€§èƒ½å¥½ï¼ŒåŸºäºŽä¸»é”®æŸ¥è¯¢
â€¢ ä¸ä¾èµ–æ—¶é’ŸåŒæ­¥
â€¢ ç®€å•å¯é 

âŒ ç¼ºç‚¹ï¼š
â€¢ åªèƒ½æ£€æµ‹æ–°å¢žæ•°æ®ï¼Œæ— æ³•æ£€æµ‹ä¿®æ”¹
â€¢ ä¸æ”¯æŒåˆ é™¤æ£€æµ‹
â€¢ IDä¸è¿žç»­æ—¶å¯èƒ½æœ‰é—®é¢˜
```

### 2.3 æ··åˆç­–ç•¥å¢žé‡åŒæ­¥


**ðŸ’¡ åŸºæœ¬æ€è·¯**ï¼š
ç»“åˆæ—¶é—´æˆ³å’ŒIDå­—æ®µï¼Œæ—¢èƒ½æ£€æµ‹æ–°å¢žåˆèƒ½æ£€æµ‹ä¿®æ”¹ã€‚

**ðŸ”§ å®žçŽ°æ–¹æ¡ˆ**ï¼š
```sql
-- æŽ¨èçš„è¡¨ç»“æž„è®¾è®¡
CREATE TABLE product_info (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  product_name VARCHAR(100),
  price DECIMAL(10,2),
  create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
    ON UPDATE CURRENT_TIMESTAMP,
  is_deleted TINYINT DEFAULT 0
);

-- æ··åˆç­–ç•¥åŒæ­¥SQL
-- æ–¹æ¡ˆ1ï¼šæ—¶é—´æˆ³ + IDåŒé‡ä¿éšœ
SELECT * FROM product_info 
WHERE (update_time > '2024-01-01 10:00:00' OR id > 50000)
  AND is_deleted = 0;

-- æ–¹æ¡ˆ2ï¼šåˆ†åˆ«å¤„ç†æ–°å¢žå’Œä¿®æ”¹
-- æ–°å¢žæ•°æ®ï¼ˆåŸºäºŽIDï¼‰
SELECT * FROM product_info WHERE id > 50000;

-- ä¿®æ”¹æ•°æ®ï¼ˆåŸºäºŽæ—¶é—´æˆ³ï¼‰  
SELECT * FROM product_info 
WHERE update_time > '2024-01-01 10:00:00' 
  AND id <= 50000;
```

---

## 3. ðŸ”‘ å­—æ®µè®¾è®¡ä¸Žé€‰æ‹©


### 3.1 æ—¶é—´æˆ³å­—æ®µè®¾è®¡è¦ç‚¹


**ðŸ“ å­—æ®µè®¾è®¡è§„èŒƒ**ï¼š
```sql
-- æŽ¨èçš„æ—¶é—´å­—æ®µè®¾è®¡
ALTER TABLE your_table ADD COLUMN (
  -- åˆ›å»ºæ—¶é—´ï¼ˆä¸å¯ä¿®æ”¹ï¼‰
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
    ON UPDATE CURRENT_TIMESTAMP,
    
  -- åˆ é™¤æ ‡è®°ï¼ˆè½¯åˆ é™¤ï¼‰
  deleted_at TIMESTAMP NULL DEFAULT NULL,
  
  -- åŒæ­¥æ ‡è®°
  synced_at TIMESTAMP NULL DEFAULT NULL
);

-- ä¸ºæ—¶é—´å­—æ®µåˆ›å»ºç´¢å¼•
CREATE INDEX idx_updated_at ON your_table(updated_at);
CREATE INDEX idx_created_at ON your_table(created_at);
```

**âš ï¸ æ—¶é—´æˆ³ä½¿ç”¨æ³¨æ„äº‹é¡¹**ï¼š
```
æ—¶é—´ç²¾åº¦é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š

é—®é¢˜ï¼šMySQL TIMESTAMPç²¾åº¦åªåˆ°ç§’ï¼ŒåŒä¸€ç§’å†…å¯èƒ½æœ‰å¤šæ¡æ•°æ®
è§£å†³ï¼š
1. ä½¿ç”¨DATETIME(6)æé«˜åˆ°å¾®ç§’ç²¾åº¦
2. ç»„åˆæ¡ä»¶ï¼šæ—¶é—´æˆ³ + ID
3. å¢žåŠ ç¼“å†²æ—¶é—´ï¼ˆå‘å‰å–1ç§’ï¼‰

ç¤ºä¾‹SQLï¼š
-- æé«˜ç²¾åº¦çš„å­—æ®µå®šä¹‰
updated_at DATETIME(6) DEFAULT CURRENT_TIMESTAMP(6) 
  ON UPDATE CURRENT_TIMESTAMP(6)

-- å¸¦ç¼“å†²çš„æŸ¥è¯¢
SELECT * FROM table 
WHERE updated_at >= DATE_SUB('2024-01-01 10:00:00', INTERVAL 1 SECOND);
```

### 3.2 è‡ªå¢žIDå­—æ®µä½¿ç”¨æŠ€å·§


**ðŸ”¢ IDå­—æ®µåˆ†ç‰‡ç­–ç•¥**ï¼š
```sql
-- å¤§è¡¨åˆ†ç‰‡åŒæ­¥ç¤ºä¾‹
-- å‡è®¾è¡¨æœ‰1000ä¸‡æ•°æ®ï¼Œåˆ†10æ¬¡åŒæ­¥

-- ç¬¬1æ‰¹ï¼šID 1-1000000
SELECT * FROM large_table 
WHERE id BETWEEN 1 AND 1000000;

-- ç¬¬2æ‰¹ï¼šID 1000001-2000000  
SELECT * FROM large_table 
WHERE id BETWEEN 1000001 AND 2000000;

-- åŠ¨æ€åˆ†ç‰‡æŸ¥è¯¢
SET @batch_size = 100000;
SET @start_id = 1;
SELECT * FROM large_table 
WHERE id BETWEEN @start_id AND @start_id + @batch_size - 1;
```

**ðŸ“Š IDè¿žç»­æ€§æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥IDæ˜¯å¦è¿žç»­
SELECT 
  id,
  id - LAG(id) OVER (ORDER BY id) as gap
FROM your_table 
WHERE id - LAG(id) OVER (ORDER BY id) > 1;

-- æŸ¥æ‰¾IDç©ºæ´ž
SELECT 
  t1.id + 1 AS gap_start,
  MIN(t2.id) - 1 AS gap_end
FROM your_table t1
LEFT JOIN your_table t2 ON t1.id < t2.id
WHERE t2.id IS NULL OR t2.id > t1.id + 1
GROUP BY t1.id
HAVING gap_start <= gap_end;
```

### 3.3 å¢žé‡å­—æ®µé€‰æ‹©å»ºè®®


**ðŸŽ¯ ä¸åŒåœºæ™¯çš„æœ€ä½³å®žè·µ**ï¼š

| **ä¸šåŠ¡åœºæ™¯** | **æŽ¨èå­—æ®µ** | **åŒæ­¥ç­–ç•¥** | **é€‚ç”¨æƒ…å†µ** |
|-------------|-------------|-------------|-------------|
| **æ–°é—»æ–‡ç« ** | `created_at` + `id` | æ—¶é—´æˆ³ä¸»å¯¼ | ä¸»è¦æ˜¯æ–°å¢žï¼Œå¾ˆå°‘ä¿®æ”¹ |
| **ç”¨æˆ·ä¿¡æ¯** | `updated_at` + `id` | æ—¶é—´æˆ³ä¸»å¯¼ | é¢‘ç¹ä¿®æ”¹ç”¨æˆ·èµ„æ–™ |
| **è®¢å•æ•°æ®** | `id` + `status_time` | IDä¸»å¯¼ | è®¢å•çŠ¶æ€å˜åŒ–è¿½è¸ª |
| **æ—¥å¿—æ•°æ®** | `id` æˆ– `log_time` | IDä¸»å¯¼ | åªæœ‰æ–°å¢žï¼Œæ— ä¿®æ”¹ |
| **å•†å“ä¿¡æ¯** | `updated_at` + `version` | ç‰ˆæœ¬å·è¾…åŠ© | ä»·æ ¼ç­‰ä¿¡æ¯é¢‘ç¹å˜åŠ¨ |

```sql
-- ç‰ˆæœ¬å·å­—æ®µç¤ºä¾‹
ALTER TABLE product ADD COLUMN 
  version INT DEFAULT 1,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
    ON UPDATE CURRENT_TIMESTAMP;

-- æ¯æ¬¡æ›´æ–°æ—¶ç‰ˆæœ¬å·+1
UPDATE product 
SET price = 299.99, version = version + 1 
WHERE id = 1001;

-- åŸºäºŽç‰ˆæœ¬å·çš„å¢žé‡åŒæ­¥
SELECT * FROM product WHERE version > ä¸Šæ¬¡åŒæ­¥çš„æœ€å¤§ç‰ˆæœ¬å·;
```

---

## 4. âš™ï¸ DataXå¢žé‡åŒæ­¥å®žçŽ°


### 4.1 åŸºç¡€é…ç½®æ¨¡æ¿


**ðŸ“ æ—¶é—´æˆ³å¢žé‡åŒæ­¥é…ç½®**ï¼š
```json
{
  "job": {
    "setting": {
      "speed": {
        "channel": 3,
        "byte": 1048576
      }
    },
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "username": "datax_user",
            "password": "your_password",
            "column": ["id", "name", "email", "created_at", "updated_at"],
            "splitPk": "id",
            "connection": [
              {
                "table": ["user_info"],
                "jdbcUrl": ["jdbc:mysql://localhost:3306/source_db?useUnicode=true&characterEncoding=utf8"]
              }
            ],
            "where": "updated_at > '${last_sync_time}'"
          }
        },
        "writer": {
          "name": "mysqlwriter", 
          "parameter": {
            "writeMode": "replace",
            "username": "datax_user",
            "password": "your_password", 
            "column": ["id", "name", "email", "created_at", "updated_at"],
            "connection": [
              {
                "table": ["user_info"],
                "jdbcUrl": "jdbc:mysql://localhost:3306/target_db?useUnicode=true&characterEncoding=utf8"
              }
            ]
          }
        }
      }
    ]
  }
}
```

**ðŸ“ IDå¢žé‡åŒæ­¥é…ç½®**ï¼š
```json
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "username": "datax_user",
            "password": "your_password",
            "column": ["*"],
            "splitPk": "id",
            "connection": [
              {
                "table": ["order_info"],
                "jdbcUrl": ["jdbc:mysql://localhost:3306/source_db"]
              }
            ],
            "where": "id > ${last_max_id}"
          }
        },
        "writer": {
          "name": "mysqlwriter",
          "parameter": {
            "writeMode": "insert",
            "username": "datax_user", 
            "password": "your_password",
            "column": ["*"],
            "connection": [
              {
                "table": ["order_info"],
                "jdbcUrl": "jdbc:mysql://localhost:3306/target_db"
              }
            ]
          }
        }
      }
    ]
  }
}
```

### 4.2 åŠ¨æ€å‚æ•°ä¼ é€’


**ðŸ”§ Shellè„šæœ¬å®žçŽ°**ï¼š
```bash
#!/bin/bash

# å¢žé‡åŒæ­¥è„šæœ¬
DB_HOST="localhost"
DB_USER="datax_user" 
DB_PASS="your_password"
DB_NAME="source_db"
TABLE_NAME="user_info"

# èŽ·å–ä¸Šæ¬¡åŒæ­¥æ—¶é—´
get_last_sync_time() {
    mysql -h${DB_HOST} -u${DB_USER} -p${DB_PASS} -D${DB_NAME} -N -e \
    "SELECT IFNULL(MAX(sync_time), '1970-01-01 00:00:00') FROM sync_log WHERE table_name='${TABLE_NAME}'"
}

# èŽ·å–ä¸Šæ¬¡åŒæ­¥çš„æœ€å¤§ID
get_last_max_id() {
    mysql -h${DB_HOST} -u${DB_USER} -p${DB_PASS} -D${DB_NAME} -N -e \
    "SELECT IFNULL(MAX(max_id), 0) FROM sync_log WHERE table_name='${TABLE_NAME}'"
}

# æ‰§è¡ŒDataXåŒæ­¥
run_datax_sync() {
    local last_time=$1
    local config_file="user_sync_incremental.json"
    
    # æ›¿æ¢é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°
    sed "s/\${last_sync_time}/${last_time}/g" ${config_file}.template > ${config_file}
    
    # æ‰§è¡ŒDataX
    python /opt/datax/bin/datax.py ${config_file}
    
    # è®°å½•åŒæ­¥ç»“æžœ
    if [ $? -eq 0 ]; then
        current_time=$(date '+%Y-%m-%d %H:%M:%S')
        mysql -h${DB_HOST} -u${DB_USER} -p${DB_PASS} -D${DB_NAME} -e \
        "INSERT INTO sync_log(table_name, sync_time, status) VALUES('${TABLE_NAME}', '${current_time}', 'SUCCESS')"
        echo "åŒæ­¥æˆåŠŸ: ${current_time}"
    else
        echo "åŒæ­¥å¤±è´¥!"
        exit 1
    fi
}

# ä¸»ç¨‹åº
main() {
    echo "å¼€å§‹å¢žé‡åŒæ­¥: $(date)"
    
    last_sync_time=$(get_last_sync_time)
    echo "ä¸Šæ¬¡åŒæ­¥æ—¶é—´: ${last_sync_time}"
    
    run_datax_sync "${last_sync_time}"
    
    echo "å¢žé‡åŒæ­¥å®Œæˆ: $(date)"
}

# æ‰§è¡Œä¸»ç¨‹åº
main
```

### 4.3 åŒæ­¥ç‚¹ç®¡ç†è¡¨è®¾è®¡


**ðŸ“Š åŒæ­¥çŠ¶æ€è·Ÿè¸ªè¡¨**ï¼š
```sql
-- åŒæ­¥æ—¥å¿—è¡¨
CREATE TABLE sync_log (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  table_name VARCHAR(50) NOT NULL,
  sync_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  sync_type ENUM('FULL', 'INCREMENTAL') DEFAULT 'INCREMENTAL',
  last_sync_time TIMESTAMP NULL,
  max_id BIGINT NULL,
  record_count INT DEFAULT 0,
  status ENUM('SUCCESS', 'FAILED', 'RUNNING') DEFAULT 'RUNNING',
  error_msg TEXT NULL,
  duration_seconds INT DEFAULT 0,
  INDEX idx_table_time (table_name, sync_time)
);

-- åŒæ­¥æ£€æŸ¥ç‚¹è¡¨ï¼ˆç®€åŒ–ç‰ˆï¼‰
CREATE TABLE sync_checkpoint (
  table_name VARCHAR(50) PRIMARY KEY,
  last_sync_time TIMESTAMP NULL,
  last_max_id BIGINT NULL,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- åˆå§‹åŒ–æ£€æŸ¥ç‚¹
INSERT INTO sync_checkpoint (table_name, last_sync_time, last_max_id) 
VALUES ('user_info', '1970-01-01 00:00:00', 0);
```

---

## 5. ðŸ“ˆ åŒæ­¥ç›‘æŽ§ä¸Žä¼˜åŒ–


### 5.1 æ•°æ®åŽ»é‡å¤„ç†


**ðŸ”„ ä¸ºä»€ä¹ˆéœ€è¦åŽ»é‡**ï¼š
åœ¨å¢žé‡åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å› ä¸ºç½‘ç»œé—®é¢˜ã€ç¨‹åºé‡å¯ç­‰åŽŸå› å¯¼è‡´æ•°æ®é‡å¤åŒæ­¥ã€‚

```
é‡å¤æ•°æ®äº§ç”Ÿåœºæ™¯ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯1ï¼šåŒæ­¥è¿‡ç¨‹ä¸­ç¨‹åºä¸­æ–­               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ æ—¶é—´ç‚¹1: å¼€å§‹åŒæ­¥ 2024-01-01 10:00:00  â”‚
â”‚ æ—¶é—´ç‚¹2: åŒæ­¥50%æ—¶ç¨‹åºå´©æºƒ             â”‚  
â”‚ æ—¶é—´ç‚¹3: é‡å¯ç¨‹åºï¼Œé‡æ–°ä»Ž10:00:00å¼€å§‹  â”‚
â”‚ ç»“æžœï¼šå‰50%çš„æ•°æ®è¢«é‡å¤åŒæ­¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯2ï¼šæ—¶é—´ç²¾åº¦ä¸å¤Ÿå¯¼è‡´é‡å¤             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ åŒä¸€ç§’å†…æœ‰å¤šæ¡æ•°æ®                     â”‚
â”‚ ä¸Šæ¬¡åŒæ­¥åˆ°ï¼š2024-01-01 10:30:45        â”‚
â”‚ å®žé™…è¿˜æœ‰æ•°æ®ï¼š2024-01-01 10:30:45      â”‚
â”‚ ä¸‹æ¬¡ä¼šé‡å¤åŒæ­¥è¿™äº›æ•°æ®                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ðŸ›  åŽ»é‡ç­–ç•¥å®žçŽ°**ï¼š
```sql
-- æ–¹æ¡ˆ1ï¼šä½¿ç”¨ REPLACE INTOï¼ˆMySQLä¸“ç”¨ï¼‰
-- DataX writeré…ç½®
"writeMode": "replace"

-- ç­‰æ•ˆSQLæ•ˆæžœ
REPLACE INTO target_table (id, name, email) 
VALUES (1, 'John', 'john@email.com');

-- æ–¹æ¡ˆ2ï¼šä½¿ç”¨ ON DUPLICATE KEY UPDATE  
INSERT INTO target_table (id, name, email, updated_at)
VALUES (1, 'John', 'john@email.com', NOW())
ON DUPLICATE KEY UPDATE 
  name = VALUES(name),
  email = VALUES(email), 
  updated_at = VALUES(updated_at);

-- æ–¹æ¡ˆ3ï¼šå…ˆåˆ é™¤å†æ’å…¥ï¼ˆé€‚ç”¨äºŽæ‰¹é‡æ•°æ®ï¼‰
DELETE FROM target_table WHERE id IN (1,2,3,4,5);
INSERT INTO target_table VALUES 
  (1, 'John', 'john@email.com'),
  (2, 'Jane', 'jane@email.com');
```

### 5.2 å¢žé‡åŒæ­¥ç›‘æŽ§


**ðŸ“Š å…³é”®ç›‘æŽ§æŒ‡æ ‡**ï¼š
```sql
-- åŒæ­¥å»¶è¿Ÿç›‘æŽ§
SELECT 
  table_name,
  last_sync_time,
  TIMESTAMPDIFF(MINUTE, last_sync_time, NOW()) as delay_minutes,
  CASE 
    WHEN TIMESTAMPDIFF(MINUTE, last_sync_time, NOW()) > 60 THEN 'ä¸¥é‡å»¶è¿Ÿ'
    WHEN TIMESTAMPDIFF(MINUTE, last_sync_time, NOW()) > 30 THEN 'è½»å¾®å»¶è¿Ÿ' 
    ELSE 'æ­£å¸¸'
  END as status
FROM sync_checkpoint;

-- åŒæ­¥é‡ç›‘æŽ§  
SELECT 
  DATE(sync_time) as sync_date,
  table_name,
  SUM(record_count) as daily_sync_count,
  COUNT(*) as sync_times,
  AVG(duration_seconds) as avg_duration
FROM sync_log 
WHERE sync_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY DATE(sync_time), table_name
ORDER BY sync_date DESC;

-- å¤±è´¥çŽ‡ç›‘æŽ§
SELECT 
  table_name,
  COUNT(*) as total_syncs,
  SUM(CASE WHEN status = 'FAILED' THEN 1 ELSE 0 END) as failed_syncs,
  ROUND(SUM(CASE WHEN status = 'FAILED' THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as failure_rate
FROM sync_log 
WHERE sync_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
GROUP BY table_name;
```

### 5.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**âš¡ æŸ¥è¯¢ä¼˜åŒ–**ï¼š
```sql
-- 1. ç¡®ä¿å¢žé‡å­—æ®µæœ‰ç´¢å¼•
CREATE INDEX idx_updated_at ON user_info(updated_at);
CREATE INDEX idx_id_updated ON user_info(id, updated_at);

-- 2. å¤åˆç´¢å¼•ä¼˜åŒ–ï¼ˆé’ˆå¯¹å¤æ‚whereæ¡ä»¶ï¼‰
CREATE INDEX idx_status_updated ON order_info(status, updated_at);

-- 3. åˆ†åŒºè¡¨ä¼˜åŒ–ï¼ˆå¤§è¡¨åœºæ™¯ï¼‰
CREATE TABLE large_table (
  id BIGINT AUTO_INCREMENT,
  data VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (id, created_at)
) PARTITION BY RANGE (YEAR(created_at)) (
  PARTITION p2023 VALUES LESS THAN (2024),
  PARTITION p2024 VALUES LESS THAN (2025),
  PARTITION p2025 VALUES LESS THAN (2026)
);
```

**ðŸ”§ DataXæ€§èƒ½è°ƒä¼˜**ï¼š
```json
{
  "job": {
    "setting": {
      "speed": {
        "channel": 5,           // å¢žåŠ å¹¶å‘é€šé“æ•°
        "byte": 10485760,       // 10MB æ¯é€šé“é™é€Ÿ
        "record": 100000        // æ¯é€šé“è®°å½•æ•°é™åˆ¶
      },
      "errorLimit": {
        "record": 100,          // å…è®¸100æ¡é”™è¯¯è®°å½•
        "percentage": 0.1       // å…è®¸0.1%é”™è¯¯çŽ‡
      }
    },
    "content": [
      {
        "reader": {
          "parameter": {
            "splitPk": "id",      // æŒ‡å®šåˆ†ç‰‡å­—æ®µ
            "fetchSize": 2048     // å¢žåŠ æ‰¹é‡è¯»å–å¤§å°
          }
        },
        "writer": {
          "parameter": {
            "batchSize": 2048     // å¢žåŠ æ‰¹é‡å†™å…¥å¤§å°
          }
        }
      }
    ]
  }
}
```

---

## 6. ðŸ”§ æ•…éšœå¤„ç†ä¸Žä¸€è‡´æ€§


### 6.1 å¸¸è§æ•…éšœåŠè§£å†³æ–¹æ¡ˆ


**âš ï¸ æ•…éšœåœºæ™¯å¤„ç†**ï¼š

```
æ•…éšœåœºæ™¯1ï¼šç½‘ç»œä¸­æ–­å¯¼è‡´åŒæ­¥å¤±è´¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®é¢˜ï¼šDataXæ‰§è¡Œä¸€åŠæ—¶ç½‘ç»œæ–­å¼€           â”‚
â”‚ çŽ°è±¡ï¼šç›®æ ‡è¡¨æ•°æ®ä¸å®Œæ•´                 â”‚
â”‚ è§£å†³ï¼š                                 â”‚
â”‚ 1. å›žæ»šäº‹åŠ¡ï¼ˆå¦‚æžœæ”¯æŒï¼‰                â”‚
â”‚ 2. æ¸…ç†éƒ¨åˆ†æ•°æ®ï¼Œé‡æ–°åŒæ­¥              â”‚  
â”‚ 3. ä½¿ç”¨æ–­ç‚¹ç»­ä¼ æœºåˆ¶                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•…éšœåœºæ™¯2ï¼šæ—¶é—´æˆ³å›žæ‹¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®é¢˜ï¼šæœåŠ¡å™¨æ—¶é—´è¢«äººä¸ºè°ƒæ•´             â”‚
â”‚ çŽ°è±¡ï¼šæ–°æ•°æ®è¢«æ¼åŒæ­¥                   â”‚
â”‚ è§£å†³ï¼š                                 â”‚
â”‚ 1. ä½¿ç”¨ID+æ—¶é—´æˆ³åŒé‡éªŒè¯               â”‚
â”‚ 2. å®šæœŸå…¨é‡æ ¡éªŒ                       â”‚
â”‚ 3. ç›‘æŽ§æ—¶é—´æˆ³å¼‚å¸¸                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•…éšœåœºæ™¯3ï¼šä¸»ä»Žå»¶è¿Ÿ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®é¢˜ï¼šä»Žä¸»åº“è¯»å–ï¼Œå†™å…¥ä»Žåº“             â”‚
â”‚ çŽ°è±¡ï¼šæ•°æ®åœ¨ä»Žåº“ä¸­è¯»ä¸åˆ°               â”‚
â”‚ è§£å†³ï¼š                                 â”‚
â”‚ 1. å¼ºåˆ¶ä»Žä¸»åº“è¯»å–                     â”‚
â”‚ 2. å¢žåŠ å»¶è¿Ÿç¼“å†²æ—¶é—´                   â”‚
â”‚ 3. ç›‘æŽ§ä¸»ä»Žå»¶è¿ŸçŠ¶æ€                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ðŸ›  æ•…éšœæ¢å¤è„šæœ¬**ï¼š
```bash
#!/bin/bash

# æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬
check_data_consistency() {
    local table_name=$1
    local source_db=$2
    local target_db=$3
    
    echo "æ£€æŸ¥è¡¨ ${table_name} çš„æ•°æ®ä¸€è‡´æ€§..."
    
    # èŽ·å–æºè¡¨è®°å½•æ•°
    source_count=$(mysql -h${SOURCE_HOST} -u${DB_USER} -p${DB_PASS} -D${source_db} -N -e \
        "SELECT COUNT(*) FROM ${table_name}")
    
    # èŽ·å–ç›®æ ‡è¡¨è®°å½•æ•°  
    target_count=$(mysql -h${TARGET_HOST} -u${DB_USER} -p${DB_PASS} -D${target_db} -N -e \
        "SELECT COUNT(*) FROM ${table_name}")
    
    echo "æºè¡¨è®°å½•æ•°: ${source_count}"
    echo "ç›®æ ‡è¡¨è®°å½•æ•°: ${target_count}"
    
    if [ ${source_count} -eq ${target_count} ]; then
        echo "âœ… è®°å½•æ•°ä¸€è‡´"
    else
        echo "âŒ è®°å½•æ•°ä¸ä¸€è‡´ï¼Œå·®å¼‚: $((source_count - target_count))"
        
        # æŸ¥æ‰¾ç¼ºå¤±çš„æ•°æ®
        find_missing_data ${table_name} ${source_db} ${target_db}
    fi
}

# æŸ¥æ‰¾ç¼ºå¤±æ•°æ®
find_missing_data() {
    local table_name=$1
    local source_db=$2  
    local target_db=$3
    
    echo "æŸ¥æ‰¾ç¼ºå¤±çš„æ•°æ®..."
    
    # å¯¼å‡ºå·®å¼‚æ•°æ®
    mysql -h${SOURCE_HOST} -u${DB_USER} -p${DB_PASS} -D${source_db} -e \
    "SELECT s.id FROM ${table_name} s 
     LEFT JOIN ${target_db}.${table_name} t ON s.id = t.id 
     WHERE t.id IS NULL 
     LIMIT 100" > missing_ids.txt
    
    if [ -s missing_ids.txt ]; then
        echo "å‘çŽ°ç¼ºå¤±æ•°æ®ï¼ŒIDåˆ—è¡¨å·²ä¿å­˜åˆ° missing_ids.txt"
    else
        echo "æœªå‘çŽ°ç¼ºå¤±æ•°æ®"
    fi
}
```

### 6.2 æ•°æ®ä¸€è‡´æ€§ä¿éšœ


**ðŸ”’ ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶**ï¼š
```sql
-- 1. è®°å½•æ•°å¯¹æ¯”
SELECT 
  'æºè¡¨' as db_type, COUNT(*) as record_count 
FROM source_db.user_info
UNION ALL
SELECT 
  'ç›®æ ‡è¡¨' as db_type, COUNT(*) as record_count 
FROM target_db.user_info;

-- 2. æ ¡éªŒå’Œå¯¹æ¯”ï¼ˆæ•°æ®å†…å®¹ä¸€è‡´æ€§ï¼‰
SELECT 
  'æºè¡¨' as db_type,
  COUNT(*) as record_count,
  SUM(CRC32(CONCAT(id, name, email))) as checksum
FROM source_db.user_info
UNION ALL  
SELECT 
  'ç›®æ ‡è¡¨' as db_type,
  COUNT(*) as record_count,
  SUM(CRC32(CONCAT(id, name, email))) as checksum
FROM target_db.user_info;

-- 3. æŠ½æ ·å¯¹æ¯”ï¼ˆéšæœºæŠ½å–æ•°æ®è¯¦ç»†å¯¹æ¯”ï¼‰
SELECT s.id, s.name, s.email, t.name as target_name, t.email as target_email
FROM source_db.user_info s
JOIN target_db.user_info t ON s.id = t.id  
WHERE (s.name != t.name OR s.email != t.email)
ORDER BY RAND() 
LIMIT 10;
```

**ðŸ”„ è¡¥å¿æœºåˆ¶**ï¼š
```bash
#!/bin/bash

# æ•°æ®è¡¥å¿åŒæ­¥è„šæœ¬
compensate_missing_data() {
    local table_name=$1
    local missing_ids_file="missing_ids.txt"
    
    if [ ! -f ${missing_ids_file} ]; then
        echo "æ²¡æœ‰å‘çŽ°ç¼ºå¤±æ•°æ®æ–‡ä»¶"
        return 0
    fi
    
    echo "å¼€å§‹è¡¥å¿åŒæ­¥ç¼ºå¤±æ•°æ®..."
    
    # æž„å»ºIDåˆ—è¡¨
    id_list=$(cat ${missing_ids_file} | tr '\n' ',' | sed 's/,$//')
    
    if [ -z "${id_list}" ]; then
        echo "ç¼ºå¤±æ•°æ®æ–‡ä»¶ä¸ºç©º"
        return 0
    fi
    
    # åˆ›å»ºä¸´æ—¶é…ç½®æ–‡ä»¶
    cat > compensate_sync.json << EOF
{
  "job": {
    "content": [
      {
        "reader": {
          "name": "mysqlreader",
          "parameter": {
            "where": "id IN (${id_list})",
            "connection": [{"table": ["${table_name}"]}]
          }
        },
        "writer": {
          "name": "mysqlwriter", 
          "parameter": {
            "writeMode": "replace",
            "connection": [{"table": ["${table_name}"]}]
          }
        }
      }
    ]
  }
}
EOF
    
    # æ‰§è¡Œè¡¥å¿åŒæ­¥
    python /opt/datax/bin/datax.py compensate_sync.json
    
    if [ $? -eq 0 ]; then
        echo "âœ… è¡¥å¿åŒæ­¥å®Œæˆ"
        rm -f ${missing_ids_file} compensate_sync.json
    else
        echo "âŒ è¡¥å¿åŒæ­¥å¤±è´¥"
    fi
}
```

---

## 7. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ å¢žé‡åŒæ­¥ï¼šåªåŒæ­¥å˜åŒ–çš„æ•°æ®ï¼Œæé«˜æ•ˆçŽ‡å’Œæ€§èƒ½
ðŸ”¸ åŒæ­¥ç­–ç•¥ï¼šæ—¶é—´æˆ³ã€è‡ªå¢žIDã€æ··åˆç­–ç•¥ä¸‰ç§ä¸»è¦æ–¹å¼  
ðŸ”¸ å­—æ®µè®¾è®¡ï¼šåˆç†è®¾è®¡å¢žé‡å­—æ®µæ˜¯æˆåŠŸçš„å…³é”®
ðŸ”¸ åŽ»é‡å¤„ç†ï¼šé˜²æ­¢é‡å¤æ•°æ®ï¼Œä¿è¯æ•°æ®è´¨é‡
ðŸ”¸ ç›‘æŽ§å‘Šè­¦ï¼šåŠæ—¶å‘çŽ°é—®é¢˜ï¼Œä¿éšœåŒæ­¥ç¨³å®šæ€§
ðŸ”¸ ä¸€è‡´æ€§æ ¡éªŒï¼šå®šæœŸæ£€æŸ¥ï¼Œç¡®ä¿æ•°æ®å®Œæ•´å‡†ç¡®
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ å¢žé‡ç­–ç•¥é€‰æ‹©åŽŸåˆ™**ï¼š
```
æ•°æ®ç‰¹ç‚¹ â†’ ç­–ç•¥é€‰æ‹©ï¼š
â€¢ åªæœ‰æ–°å¢žï¼Œæ— ä¿®æ”¹ â†’ ä½¿ç”¨IDç­–ç•¥
â€¢ é¢‘ç¹ä¿®æ”¹ â†’ ä½¿ç”¨æ—¶é—´æˆ³ç­–ç•¥  
â€¢ æ–°å¢ž+ä¿®æ”¹éƒ½æœ‰ â†’ ä½¿ç”¨æ··åˆç­–ç•¥
â€¢ å¯¹å®žæ—¶æ€§è¦æ±‚é«˜ â†’ ä½¿ç”¨æ—¶é—´æˆ³ç­–ç•¥
â€¢ æ•°æ®é‡ç‰¹åˆ«å¤§ â†’ è€ƒè™‘åˆ†ç‰‡+IDç­–ç•¥
```

**ðŸ”¹ æ—¶é—´æˆ³vs IDçš„ä¼˜åŠ£**ï¼š
```
æ—¶é—´æˆ³ä¼˜åŠ¿ï¼šèƒ½æ£€æµ‹æ‰€æœ‰å˜åŒ–ï¼ˆæ–°å¢ž+ä¿®æ”¹ï¼‰
æ—¶é—´æˆ³åŠ£åŠ¿ï¼šä¾èµ–æ—¶é’ŸåŒæ­¥ï¼Œå¯èƒ½æœ‰ç²¾åº¦é—®é¢˜

IDä¼˜åŠ¿ï¼šç®€å•å¯é ï¼Œæ€§èƒ½å¥½ï¼Œä¸ä¾èµ–æ—¶é’Ÿ
IDåŠ£åŠ¿ï¼šåªèƒ½æ£€æµ‹æ–°å¢žï¼Œæ— æ³•æ£€æµ‹ä¿®æ”¹
```

**ðŸ”¹ DataXé…ç½®è¦ç‚¹**ï¼š
```
æ ¸å¿ƒé…ç½®é¡¹ï¼š
â€¢ whereæ¡ä»¶ï¼šå®žçŽ°å¢žé‡è¿‡æ»¤çš„å…³é”®  
â€¢ splitPkï¼šæé«˜å¹¶è¡Œåº¦çš„å…³é”®
â€¢ writeModeï¼šå†³å®šåŽ»é‡ç­–ç•¥
â€¢ channelï¼šæŽ§åˆ¶å¹¶å‘åº¦å’Œæ€§èƒ½
```

### 7.3 å®žé™…åº”ç”¨æŒ‡å¯¼


**ðŸ’¡ æœ€ä½³å®žè·µå»ºè®®**ï¼š

- [x] **è¡¨ç»“æž„è®¾è®¡**ï¼šæå‰è§„åˆ’å¥½å¢žé‡å­—æ®µï¼Œå»ºç«‹åˆé€‚ç´¢å¼•
- [x] **ç›‘æŽ§ä½“ç³»**ï¼šå»ºç«‹å®Œå–„çš„åŒæ­¥ç›‘æŽ§å’Œå‘Šè­¦æœºåˆ¶  
- [x] **æ•…éšœé¢„æ¡ˆ**ï¼šå‡†å¤‡æ•°æ®æ ¡éªŒå’Œè¡¥å¿è„šæœ¬
- [x] **æ€§èƒ½è°ƒä¼˜**ï¼šæ ¹æ®æ•°æ®é‡è°ƒæ•´DataXå‚æ•°
- [x] **å®šæœŸæ ¡éªŒ**ï¼šå»ºç«‹æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æµç¨‹

**ðŸŽ¯ å¸¸è§åº”ç”¨åœºæ™¯**ï¼š
- **æ•°æ®ä»“åº“ETL**ï¼šä»Žä¸šåŠ¡åº“å¢žé‡æŠ½å–æ•°æ®åˆ°æ•°ä»“
- **æ•°æ®å¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½å˜åŒ–çš„ä¸šåŠ¡æ•°æ®
- **ç³»ç»Ÿè¿ç§»**ï¼šæ–°æ—§ç³»ç»Ÿå¹¶è¡ŒæœŸé—´çš„æ•°æ®åŒæ­¥
- **æ•°æ®åˆ†å‘**ï¼šå°†æ ¸å¿ƒæ•°æ®åˆ†å‘åˆ°å„ä¸ªä¸šåŠ¡ç³»ç»Ÿ

**ðŸ”§ æ•…éšœæŽ’æŸ¥æ€è·¯**ï¼š
```
æ­¥éª¤1ï¼šæ£€æŸ¥åŒæ­¥æ—¥å¿—ï¼Œç¡®è®¤å¤±è´¥åŽŸå› 
æ­¥éª¤2ï¼šéªŒè¯æºç›®æ ‡æ•°æ®åº“è¿žæŽ¥çŠ¶æ€  
æ­¥éª¤3ï¼šæ£€æŸ¥å¢žé‡å­—æ®µå€¼æ˜¯å¦æ­£å¸¸
æ­¥éª¤4ï¼šå¯¹æ¯”æºè¡¨å’Œç›®æ ‡è¡¨æ•°æ®å·®å¼‚
æ­¥éª¤5ï¼šæ ¹æ®å·®å¼‚æƒ…å†µåˆ¶å®šä¿®å¤æ–¹æ¡ˆ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- å¢žé‡åŒæ­¥æ•ˆçŽ‡é«˜ï¼Œç­–ç•¥é€‰æ‹©å¾ˆé‡è¦
- æ—¶é—´æˆ³IDå„æœ‰é•¿ï¼Œæ ¹æ®åœºæ™¯åšé€‰æ‹©  
- ç›‘æŽ§æ ¡éªŒä¸å¯å°‘ï¼Œæ•…éšœå¤„ç†è¦è¶æ—©
- DataXé…ç½®è¦è°ƒä¼˜ï¼Œæ€§èƒ½ç¨³å®šæ˜¯ç›®æ ‡