---
title: 25ã€ETLæµç¨‹é›†æˆåº”ç”¨
---
## ðŸ“š ç›®å½•

1. [ETLæµç¨‹è®¾è®¡åŸºç¡€](#1-ETLæµç¨‹è®¾è®¡åŸºç¡€)
2. [æ•°æ®æŠ½å–ç­–ç•¥](#2-æ•°æ®æŠ½å–ç­–ç•¥)
3. [æ•°æ®è½¬æ¢è§„åˆ™](#3-æ•°æ®è½¬æ¢è§„åˆ™)
4. [æ•°æ®åŠ è½½æ–¹æ¡ˆ](#4-æ•°æ®åŠ è½½æ–¹æ¡ˆ)
5. [æ•°æ®è´¨é‡æ£€æŸ¥](#5-æ•°æ®è´¨é‡æ£€æŸ¥)
6. [æµç¨‹ç¼–æŽ’ç®¡ç†](#6-æµç¨‹ç¼–æŽ’ç®¡ç†)
7. [ä¾èµ–å…³ç³»é…ç½®](#7-ä¾èµ–å…³ç³»é…ç½®)
8. [å¼‚å¸¸å¤„ç†æµç¨‹](#8-å¼‚å¸¸å¤„ç†æµç¨‹)
9. [æµç¨‹ç›‘æŽ§æ–¹æ¡ˆ](#9-æµç¨‹ç›‘æŽ§æ–¹æ¡ˆ)
10. [æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#10-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
11. [æµç¨‹æµ‹è¯•éªŒè¯](#11-æµç¨‹æµ‹è¯•éªŒè¯)
12. [è¿ç»´ç®¡ç†å®žè·µ](#12-è¿ç»´ç®¡ç†å®žè·µ)
13. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#13-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ðŸ—ï¸ ETLæµç¨‹è®¾è®¡åŸºç¡€


### 1.1 ETLæ˜¯ä»€ä¹ˆ


**ðŸ’¡ é€šä¿—ç†è§£**ï¼š
ETLå°±åƒæ¬å®¶æ•´ç†çš„è¿‡ç¨‹ï¼š
- **Extractï¼ˆæŠ½å–ï¼‰**ï¼šä»Žæ—§æˆ¿å­æ¬ä¸œè¥¿å‡ºæ¥
- **Transformï¼ˆè½¬æ¢ï¼‰**ï¼šæ•´ç†ã€åˆ†ç±»ã€æ¸…æ´ç‰©å“
- **Loadï¼ˆåŠ è½½ï¼‰**ï¼šæŠŠæ•´ç†å¥½çš„ä¸œè¥¿æ”¾åˆ°æ–°æˆ¿å­

**ðŸ” æ·±å…¥ä¸€ç‚¹**ï¼š
ETLæ˜¯æ•°æ®å¤„ç†çš„æ ‡å‡†æµç¨‹ï¼Œä¸“é—¨ç”¨æ¥ï¼š
- ä»Žå„ç§æ•°æ®æºèŽ·å–æ•°æ®ï¼ˆæ•°æ®åº“ã€æ–‡ä»¶ã€APIç­‰ï¼‰
- æŒ‰ç…§ä¸šåŠ¡è§„åˆ™æ¸…æ´—å’Œè½¬æ¢æ•°æ®
- å°†å¤„ç†å¥½çš„æ•°æ®å­˜å‚¨åˆ°ç›®æ ‡ç³»ç»Ÿ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦ETL


**ðŸ“± ç”Ÿæ´»ä¾‹å­**ï¼š
æƒ³è±¡ä½ ç»è¥ä¸€å®¶è¿žé”åº—ï¼š
```
é—®é¢˜ï¼š
â€¢ é—¨åº—Aç”¨Excelè®°å½•é”€å”®
â€¢ é—¨åº—Bç”¨POSç³»ç»Ÿ
â€¢ é—¨åº—Cç”¨æ‰‹å†™è´¦æœ¬
â€¢ æ€»éƒ¨éœ€è¦ç»Ÿä¸€çš„é”€å”®æŠ¥è¡¨

è§£å†³æ–¹æ¡ˆï¼š
é—¨åº—æ•°æ® â†’ ETLå¤„ç† â†’ ç»Ÿä¸€æŠ¥è¡¨
```

**ðŸŽ¯ å®žé™…ä»·å€¼**ï¼š
- **æ•°æ®æ•´åˆ**ï¼šæŠŠåˆ†æ•£çš„æ•°æ®é›†ä¸­èµ·æ¥
- **æ ¼å¼ç»Ÿä¸€**ï¼šä¸åŒç³»ç»Ÿçš„æ•°æ®æ ¼å¼åŒ–
- **è´¨é‡ä¿è¯**ï¼šæ¸…æ´—è„æ•°æ®ï¼Œç¡®ä¿å‡†ç¡®æ€§
- **ä¸šåŠ¡åˆ†æž**ï¼šä¸ºå†³ç­–æä¾›å¯é æ•°æ®åŸºç¡€

### 1.3 DataXåœ¨ETLä¸­çš„è§’è‰²


**ðŸ“‹ DataXå®šä½**ï¼š
```
ä¼ ç»ŸETLå·¥å…·ï¼š   DataXå·¥å…·ï¼š
å¤æ‚æ˜‚è´µ       â†â†’  è½»é‡å…è´¹
å­¦ä¹ å›°éš¾       â†â†’  é…ç½®ç®€å•
åŠŸèƒ½è‡ƒè‚¿       â†â†’  ä¸“æ³¨ä¼ è¾“
```

**ðŸ’» DataXæ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **é«˜æ€§èƒ½**ï¼šæ”¯æŒå¤§æ•°æ®é‡å¿«é€Ÿä¼ è¾“
- **å¤šæºæ”¯æŒ**ï¼šMySQLã€Oracleã€HDFSã€Hiveç­‰20+æ•°æ®æº
- **å®¹é”™èƒ½åŠ›**ï¼šä¼ è¾“å¤±è´¥è‡ªåŠ¨é‡è¯•
- **ç›‘æŽ§å®Œå–„**ï¼šè¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œç»Ÿè®¡ä¿¡æ¯

---

## 2. ðŸ“¤ æ•°æ®æŠ½å–ç­–ç•¥


### 2.1 æŠ½å–æ–¹å¼é€‰æ‹©


**ðŸ”¢ æŠ½å–æ–¹å¼å¯¹æ¯”**ï¼š

| æŠ½å–æ–¹å¼ | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|---------|
| **å…¨é‡æŠ½å–** | æ•°æ®é‡å°ã€é¦–æ¬¡åŒæ­¥ | ç®€å•å¯é  | èµ„æºæ¶ˆè€—å¤§ |
| **å¢žé‡æŠ½å–** | æ—¥å¸¸æ›´æ–°ã€å¤§æ•°æ®é‡ | æ•ˆçŽ‡é«˜ | é€»è¾‘å¤æ‚ |
| **å®žæ—¶æŠ½å–** | ä¸šåŠ¡è¦æ±‚å®žæ—¶æ€§ | å»¶è¿Ÿä½Ž | æˆæœ¬é«˜ |

### 2.2 å¢žé‡æŠ½å–ç­–ç•¥è¯¦è§£


**ðŸ’¡ é€šä¿—ç†è§£**ï¼š
å¢žé‡æŠ½å–å°±åƒçœ‹æ–°é—»ï¼š
- ä¸ç”¨æ¯æ¬¡éƒ½ä»Žå¤´çœ‹æ‰€æœ‰æ–°é—»
- åªçœ‹ä¸Šæ¬¡çœ‹è¿‡ä¹‹åŽçš„æ–°æ–°é—»
- ç”¨"æ—¶é—´æˆ³"è®°ä½çœ‹åˆ°å“ªé‡Œäº†

**ðŸ”§ å¸¸è§å¢žé‡ç­–ç•¥**ï¼š

**æ—¶é—´æˆ³ç­–ç•¥**ï¼š
```json
{
  "reader": {
    "name": "mysqlreader",
    "parameter": {
      "querySql": [
        "SELECT * FROM orders WHERE update_time >= '${last_update_time}'"
      ]
    }
  }
}
```

**IDé€’å¢žç­–ç•¥**ï¼š
```json
{
  "reader": {
    "parameter": {
      "querySql": [
        "SELECT * FROM users WHERE id > ${last_max_id}"
      ]
    }
  }
}
```

### 2.3 æŠ½å–æ€§èƒ½ä¼˜åŒ–


**âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼š

**åˆ†æ‰¹æŠ½å–**ï¼š
```
å¤§è¡¨æ•°æ®ï¼š1000ä¸‡æ¡è®°å½•
åˆ†æ‰¹ç­–ç•¥ï¼šæ¯æ‰¹10ä¸‡æ¡
æ‰§è¡Œæ–¹å¼ï¼š100æ¬¡å°æ‰¹é‡æŠ½å–

å¥½å¤„ï¼š
â€¢ å‡å°‘å†…å­˜å ç”¨
â€¢ é™ä½Žæ•°æ®åº“åŽ‹åŠ›
â€¢ æ”¯æŒæ–­ç‚¹ç»­ä¼ 
```

**å¹¶è¡ŒæŠ½å–**ï¼š
```
å•çº¿ç¨‹ï¼š  [====]           1å°æ—¶
4çº¿ç¨‹ï¼š   [=][=][=][=]    15åˆ†é’Ÿ

é…ç½®ç¤ºä¾‹ï¼š
"job": {
  "setting": {
    "speed": {
      "channel": 4    â† 4ä¸ªå¹¶è¡Œé€šé“
    }
  }
}
```

---

## 3. ðŸ”„ æ•°æ®è½¬æ¢è§„åˆ™


### 3.1 è½¬æ¢è§„åˆ™è®¾è®¡


**ðŸ’¡ é€šä¿—ç†è§£**ï¼š
æ•°æ®è½¬æ¢å°±åƒç¿»è¯‘ï¼š
- æŠŠ"æ–¹è¨€"ç¿»è¯‘æˆ"æ™®é€šè¯"
- æŠŠ"è‹±æ–‡"ç¿»è¯‘æˆ"ä¸­æ–‡"
- è®©ä¸åŒç³»ç»Ÿèƒ½"äº’ç›¸ç†è§£"

**ðŸŽ¯ å¸¸è§è½¬æ¢éœ€æ±‚**ï¼š

**å­—æ®µæ˜ å°„**ï¼š
```
æºç³»ç»Ÿ          ç›®æ ‡ç³»ç»Ÿ
user_name   â†’   username
create_date â†’   created_at
is_active   â†’   status (1/0 â†’ å¯ç”¨/ç¦ç”¨)
```

**æ•°æ®ç±»åž‹è½¬æ¢**ï¼š
```json
{
  "transformer": [
    {
      "name": "dx_map",
      "parameter": {
        "columnIndex": 2,
        "paras": {
          "1": "å¯ç”¨",
          "0": "ç¦ç”¨"
        }
      }
    }
  ]
}
```

### 3.2 å¤æ‚è½¬æ¢å®žçŽ°


**ðŸ“Š ä¸šåŠ¡è§„åˆ™è½¬æ¢**ï¼š

**ç¤ºä¾‹ï¼šè®¢å•çŠ¶æ€è½¬æ¢**
```
ä¸šåŠ¡è§„åˆ™ï¼š
â€¢ status=1 ä¸” pay_timeä¸ä¸ºç©º â†’ "å·²æ”¯ä»˜"
â€¢ status=1 ä¸” pay_timeä¸ºç©º â†’ "å¾…æ”¯ä»˜"  
â€¢ status=0 â†’ "å·²å–æ¶ˆ"

å®žçŽ°æ–¹å¼ï¼š
ä½¿ç”¨Groovyè„šæœ¬æˆ–SQLå‡½æ•°
```

**æ•°æ®æ¸…æ´—è½¬æ¢**ï¼š
```json
{
  "transformer": [
    {
      "name": "dx_groovy",
      "parameter": {
        "code": "
          // æ‰‹æœºå·è„±æ•
          if (record.get(3) != null) {
            String phone = record.get(3);
            phone = phone.replaceAll('(\\d{3})\\d{4}(\\d{4})', '$1****$2');
            record.set(3, phone);
          }
          return record;
        "
      }
    }
  ]
}
```

---

## 4. ðŸ“¥ æ•°æ®åŠ è½½æ–¹æ¡ˆ


### 4.1 åŠ è½½ç­–ç•¥é€‰æ‹©


**ðŸ”§ åŠ è½½æ–¹å¼å¯¹æ¯”**ï¼š

```
æ’å…¥æ¨¡å¼ï¼ˆINSERTï¼‰ï¼š
é€‚ç”¨ï¼šå…¨æ–°æ•°æ®
ç‰¹ç‚¹ï¼šé€Ÿåº¦å¿«ï¼Œä½†é‡åˆ°é‡å¤æ•°æ®ä¼šæŠ¥é”™

è¦†ç›–æ¨¡å¼ï¼ˆREPLACEï¼‰ï¼š
é€‚ç”¨ï¼šå…¨é‡æ›¿æ¢
ç‰¹ç‚¹ï¼šå…ˆåˆ é™¤åŽæ’å…¥ï¼Œæ•°æ®æœ€æ–°

æ›´æ–°æ¨¡å¼ï¼ˆUPDATEï¼‰ï¼š
é€‚ç”¨ï¼šå¢žé‡æ›´æ–°
ç‰¹ç‚¹ï¼šåªæ›´æ–°å˜åŒ–çš„å­—æ®µ
```

### 4.2 æ‰¹é‡åŠ è½½ä¼˜åŒ–


**ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–é…ç½®**ï¼š

```json
{
  "writer": {
    "name": "mysqlwriter",
    "parameter": {
      "writeMode": "insert",
      "batchSize": 1000,        â† æ‰¹é‡å¤§å°
      "preSql": [
        "SET autocommit=0",     â† å…³é—­è‡ªåŠ¨æäº¤
        "SET unique_checks=0"   â† å…³é—­å”¯ä¸€æ€§æ£€æŸ¥
      ],
      "postSql": [
        "SET autocommit=1",
        "SET unique_checks=1"
      ]
    }
  }
}
```

**ðŸ’¡ åŠ è½½ä¼˜åŒ–è¦ç‚¹**ï¼š
- **æ‰¹é‡æ’å…¥**ï¼šå‡å°‘ç½‘ç»œå¼€é”€
- **å…³é—­æ£€æŸ¥**ï¼šæå‡æ’å…¥é€Ÿåº¦
- **ç´¢å¼•ç­–ç•¥**ï¼šåŠ è½½æ—¶ç¦ç”¨ï¼Œå®ŒæˆåŽé‡å»º
- **äº‹åŠ¡æŽ§åˆ¶**ï¼šåˆç†è®¾ç½®æäº¤é¢‘çŽ‡

---

## 5. âœ… æ•°æ®è´¨é‡æ£€æŸ¥


### 5.1 è´¨é‡æ£€æŸ¥ä½“ç³»


**ðŸŽ¯ æ£€æŸ¥å±‚æ¬¡**ï¼š
```
æ•°æ®è´¨é‡é‡‘å­—å¡”ï¼š

                [ä¸šåŠ¡è§„åˆ™]
              /           \
         [æ•°æ®ä¸€è‡´æ€§]   [å‚ç…§å®Œæ•´æ€§]
        /                        \
   [æ ¼å¼è§„èŒƒ]                [éžç©ºæ£€æŸ¥]
  /                                  \
[å­—ç¬¦ç¼–ç ]                        [æ•°æ®ç±»åž‹]
```

### 5.2 è´¨é‡æ£€æŸ¥å®žçŽ°


**ðŸ“‹ æ£€æŸ¥é…ç½®ç¤ºä¾‹**ï¼š

```json
{
  "job": {
    "content": [
      {
        "transformer": [
          {
            "name": "dx_filter",
            "parameter": {
              "code": "
                // éžç©ºæ£€æŸ¥
                if (record.get(0) == null || record.get(0).toString().trim().isEmpty()) {
                  return false;  // è¿‡æ»¤æŽ‰ç©ºæ•°æ®
                }
                
                // æ ¼å¼æ£€æŸ¥ï¼šæ‰‹æœºå·
                String phone = record.get(3);
                if (!phone.matches('^1[3-9]\\d{9}$')) {
                  return false;  // è¿‡æ»¤éžæ³•æ‰‹æœºå·
                }
                
                return true;
              "
            }
          }
        ]
      }
    ]
  }
}
```

**ðŸ” è´¨é‡æŠ¥å‘Šç¤ºä¾‹**ï¼š
```
æ•°æ®è´¨é‡æŠ¥å‘Š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®°å½•æ•°ï¼š    100,000
é€šè¿‡æ£€æŸ¥ï¼š     98,500
å¤±è´¥è®°å½•ï¼š      1,500

å¤±è´¥åŽŸå› ç»Ÿè®¡ï¼š
â€¢ æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼š  800æ¡
â€¢ é‚®ç®±æ ¼å¼é”™è¯¯ï¼š    400æ¡  
â€¢ å¿…å¡«å­—æ®µä¸ºç©ºï¼š    300æ¡
```

---

## 6. ðŸŽ›ï¸ æµç¨‹ç¼–æŽ’ç®¡ç†


### 6.1 å·¥ä½œæµè®¾è®¡


**ðŸ’¡ é€šä¿—ç†è§£**ï¼š
æµç¨‹ç¼–æŽ’å°±åƒåšèœçš„æ­¥éª¤ï¼š
1. å…ˆæ´—èœï¼ˆæ•°æ®æ¸…æ´—ï¼‰
2. å†åˆ‡èœï¼ˆæ•°æ®è½¬æ¢ï¼‰
3. æœ€åŽç‚’èœï¼ˆæ•°æ®åŠ è½½ï¼‰
4. æ¯æ­¥éƒ½è¦æ£€æŸ¥è´¨é‡

**ðŸ”„ å…¸åž‹ETLæµç¨‹**ï¼š
```
å¼€å§‹
  â†“
æ•°æ®æŠ½å– â”€â”€å¤±è´¥â”€â”€â†’ å¼‚å¸¸å¤„ç†
  â†“æˆåŠŸ
æ•°æ®è½¬æ¢ â”€â”€å¤±è´¥â”€â”€â†’ å¼‚å¸¸å¤„ç†  
  â†“æˆåŠŸ
è´¨é‡æ£€æŸ¥ â”€â”€å¤±è´¥â”€â”€â†’ å¼‚å¸¸å¤„ç†
  â†“æˆåŠŸ
æ•°æ®åŠ è½½ â”€â”€å¤±è´¥â”€â”€â†’ å¼‚å¸¸å¤„ç†
  â†“æˆåŠŸ
å‘é€é€šçŸ¥
  â†“
ç»“æŸ
```

### 6.2 è°ƒåº¦é…ç½®


**â° è°ƒåº¦ç­–ç•¥**ï¼š

```bash
# Crontabè°ƒåº¦ç¤ºä¾‹
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡ŒETL
0 2 * * * /opt/datax/bin/datax.py /opt/jobs/daily_etl.json

# æ¯å°æ—¶å¢žé‡åŒæ­¥
0 * * * * /opt/datax/bin/datax.py /opt/jobs/hourly_sync.json

# æ¯å‘¨ä¸€å…¨é‡åŒæ­¥
0 1 * * 1 /opt/datax/bin/datax.py /opt/jobs/weekly_full.json
```

**ðŸ”§ è°ƒåº¦å‚æ•°ä¼ é€’**ï¼š
```bash
# åŠ¨æ€ä¼ é€’æ—¥æœŸå‚æ•°
python datax.py job.json -p "-Dstart_date=$(date -d '1 day ago' +'%Y-%m-%d')"
```

---

## 7. ðŸ”— ä¾èµ–å…³ç³»é…ç½®


### 7.1 ä¾èµ–å…³ç³»è®¾è®¡


**ðŸ“Š ä¾èµ–å…³ç³»å›¾**ï¼š
```
è®¢å•ä¸»è¡¨ETL
    â†“
    â”œâ”€â†’ è®¢å•è¯¦æƒ…ETL
    â”œâ”€â†’ æ”¯ä»˜è®°å½•ETL
    â””â”€â†’ ç‰©æµä¿¡æ¯ETL
         â†“
    æ•°æ®æ±‡æ€»ETL
         â†“
    æŠ¥è¡¨ç”Ÿæˆ
```

### 7.2 ä¾èµ–å®žçŽ°æ–¹æ¡ˆ


**ðŸ”§ Shellè„šæœ¬å®žçŽ°**ï¼š
```bash
#!/bin/bash
# etl_workflow.sh

# æ£€æŸ¥å‰ç½®æ¡ä»¶
check_prerequisite() {
    if [ ! -f "/tmp/orders_ready.flag" ]; then
        echo "å‰ç½®ä»»åŠ¡æœªå®Œæˆï¼Œé€€å‡º"
        exit 1
    fi
}

# æ‰§è¡ŒETLä»»åŠ¡
run_etl() {
    echo "å¼€å§‹æ‰§è¡Œè®¢å•ETL..."
    python /opt/datax/bin/datax.py /opt/jobs/orders_etl.json
    
    if [ $? -eq 0 ]; then
        echo "ETLæ‰§è¡ŒæˆåŠŸ"
        touch "/tmp/orders_etl_done.flag"  # åˆ›å»ºå®Œæˆæ ‡è®°
    else
        echo "ETLæ‰§è¡Œå¤±è´¥"
        exit 1
    fi
}

# è§¦å‘ä¸‹æ¸¸ä»»åŠ¡
trigger_downstream() {
    echo "è§¦å‘ä¸‹æ¸¸ä»»åŠ¡..."
    /opt/jobs/trigger_reports.sh
}

# ä¸»æµç¨‹
check_prerequisite
run_etl
trigger_downstream
```

---

## 8. âš ï¸ å¼‚å¸¸å¤„ç†æµç¨‹


### 8.1 å¼‚å¸¸åˆ†ç±»å¤„ç†


**ðŸ“‹ å¼‚å¸¸ç±»åž‹è¯†åˆ«**ï¼š

| å¼‚å¸¸ç±»åž‹ | **å…¸åž‹åœºæ™¯** | **å¤„ç†ç­–ç•¥** |
|---------|------------|-------------|
| **ç½‘ç»œå¼‚å¸¸** | è¿žæŽ¥è¶…æ—¶ã€ç½‘ç»œä¸­æ–­ | è‡ªåŠ¨é‡è¯•3æ¬¡ |
| **æ•°æ®å¼‚å¸¸** | æ ¼å¼é”™è¯¯ã€çº¦æŸå†²çª | è®°å½•æ—¥å¿—ï¼Œè·³è¿‡å¤„ç† |
| **ç³»ç»Ÿå¼‚å¸¸** | å†…å­˜ä¸è¶³ã€ç£ç›˜æ»¡ | åœæ­¢ä»»åŠ¡ï¼Œå‘é€å‘Šè­¦ |
| **ä¸šåŠ¡å¼‚å¸¸** | ä¸šåŠ¡è§„åˆ™å†²çª | äººå·¥ä»‹å…¥å¤„ç† |

### 8.2 é‡è¯•æœºåˆ¶è®¾è®¡


**ðŸ”„ é‡è¯•ç­–ç•¥é…ç½®**ï¼š
```json
{
  "core": {
    "transport": {
      "channel": {
        "failover": {
          "retryTimes": 3,           â† é‡è¯•æ¬¡æ•°
          "retryInterval": 5000,     â† é‡è¯•é—´éš”(æ¯«ç§’)
          "retryStrategy": "exponential"  â† æŒ‡æ•°é€€é¿
        }
      }
    }
  }
}
```

**ðŸ“§ å‘Šè­¦é€šçŸ¥å®žçŽ°**ï¼š
```bash
# å‘é€å‘Šè­¦é‚®ä»¶
send_alert() {
    local error_msg=$1
    local job_name=$2
    
    echo "ETLä»»åŠ¡å¼‚å¸¸ï¼š$job_name
    é”™è¯¯ä¿¡æ¯ï¼š$error_msg
    å‘ç”Ÿæ—¶é—´ï¼š$(date)
    è¯·åŠæ—¶å¤„ç†ï¼" | mail -s "ETLå‘Šè­¦" admin@company.com
}

# å¼‚å¸¸æ•èŽ·
if ! python datax.py job.json; then
    send_alert "DataXæ‰§è¡Œå¤±è´¥" "è®¢å•åŒæ­¥ä»»åŠ¡"
    exit 1
fi
```

---

## 9. ðŸ“Š æµç¨‹ç›‘æŽ§æ–¹æ¡ˆ


### 9.1 ç›‘æŽ§æŒ‡æ ‡ä½“ç³»


**ðŸ“ˆ æ ¸å¿ƒç›‘æŽ§æŒ‡æ ‡**ï¼š

```
æ‰§è¡Œæ€§èƒ½æŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“Š ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡              â”‚
â”‚ â€¢ æ‰§è¡Œæ—¶é•¿ï¼š45åˆ†é’Ÿ           â”‚
â”‚ â€¢ å¤„ç†è®°å½•æ•°ï¼š1,234,567æ¡    â”‚
â”‚ â€¢ ä¼ è¾“é€Ÿåº¦ï¼š456æ¡/ç§’         â”‚
â”‚ â€¢ é”™è¯¯çŽ‡ï¼š0.02%             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç³»ç»Ÿèµ„æºæŒ‡æ ‡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  
â”‚ ðŸ–¥ï¸ ç³»ç»Ÿèµ„æºä½¿ç”¨              â”‚
â”‚ â€¢ CPUä½¿ç”¨çŽ‡ï¼š65%             â”‚
â”‚ â€¢ å†…å­˜ä½¿ç”¨çŽ‡ï¼š78%            â”‚
â”‚ â€¢ ç£ç›˜IOï¼š245MB/s           â”‚
â”‚ â€¢ ç½‘ç»œå¸¦å®½ï¼š128Mbps         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 ç›‘æŽ§å®žçŽ°æ–¹æ¡ˆ


**ðŸ“‹ æ—¥å¿—ç›‘æŽ§è„šæœ¬**ï¼š
```bash
#!/bin/bash
# monitor_etl.sh

# è§£æžDataXæ—¥å¿—
parse_log() {
    local log_file=$1
    
    # æå–å…³é”®æŒ‡æ ‡
    total_records=$(grep "Total" $log_file | awk '{print $4}')
    error_records=$(grep "Error" $log_file | awk '{print $4}')
    duration=$(grep "Total time" $log_file | awk '{print $3}')
    
    # è®¡ç®—é”™è¯¯çŽ‡
    error_rate=$(echo "scale=4; $error_records * 100 / $total_records" | bc)
    
    echo "å¤„ç†è®°å½•ï¼š$total_records"
    echo "é”™è¯¯è®°å½•ï¼š$error_records" 
    echo "é”™è¯¯çŽ‡ï¼š$error_rate%"
    echo "æ‰§è¡Œæ—¶é•¿ï¼š$duration"
}

# ç›‘æŽ§é˜ˆå€¼æ£€æŸ¥
check_thresholds() {
    if (( $(echo "$error_rate > 1.0" | bc -l) )); then
        send_alert "é”™è¯¯çŽ‡è¿‡é«˜ï¼š$error_rate%"
    fi
    
    if (( $(echo "$duration > 3600" | bc -l) )); then
        send_alert "æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼š$durationç§’"
    fi
}
```

---

## 10. âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


### 10.1 ç³»ç»Ÿçº§ä¼˜åŒ–


**ðŸ”§ JVMå‚æ•°è°ƒä¼˜**ï¼š
```bash
# dataxå¯åŠ¨è„šæœ¬ä¼˜åŒ–
java -server \
     -Xms2g -Xmx8g \              # å †å†…å­˜è®¾ç½®
     -XX:+UseG1GC \               # ä½¿ç”¨G1åžƒåœ¾å›žæ”¶
     -XX:MaxGCPauseMillis=200 \   # æœ€å¤§GCæš‚åœæ—¶é—´
     -XX:+PrintGC \               # æ‰“å°GCæ—¥å¿—
     -jar datax.jar job.json
```

**ðŸ’¾ æ•°æ®åº“è¿žæŽ¥ä¼˜åŒ–**ï¼š
```json
{
  "reader": {
    "parameter": {
      "connection": [
        {
          "jdbcUrl": ["jdbc:mysql://host:3306/db?useSSL=false&rewriteBatchedStatements=true&cachePrepStmts=true"],
          "table": ["user_table"]
        }
      ]
    }
  }
}
```

### 10.2 ä½œä¸šçº§ä¼˜åŒ–


**ðŸ“Š å¹¶å‘ç­–ç•¥ä¼˜åŒ–**ï¼š

```
ä¼˜åŒ–å‰ï¼šå•é€šé“
[æ•°æ®æº] â”€â”€å•çº¿ç¨‹â”€â”€â†’ [ç›®æ ‡]
ä¼ è¾“é€Ÿåº¦ï¼š1000æ¡/ç§’

ä¼˜åŒ–åŽï¼šå¤šé€šé“  
[æ•°æ®æº] â”€â”€çº¿ç¨‹1â”€â”€â†’ [ç›®æ ‡]
        â”€â”€çº¿ç¨‹2â”€â”€â†’
        â”€â”€çº¿ç¨‹3â”€â”€â†’  
        â”€â”€çº¿ç¨‹4â”€â”€â†’
ä¼ è¾“é€Ÿåº¦ï¼š4000æ¡/ç§’

é…ç½®ï¼š
"speed": {
  "channel": 4,
  "record": 10000
}
```

**ðŸŽ¯ æ•°æ®åˆ†ç‰‡ç­–ç•¥**ï¼š
```json
{
  "reader": {
    "parameter": {
      "splitPk": "id",           â† åˆ†ç‰‡é”®
      "connection": [
        {
          "querySql": [
            "SELECT * FROM large_table WHERE id >= ? AND id < ?"
          ]
        }
      ]
    }
  }
}
```

---

## 11. ðŸ§ª æµç¨‹æµ‹è¯•éªŒè¯


### 11.1 æµ‹è¯•ç­–ç•¥è®¾è®¡


**ðŸ“‹ æµ‹è¯•å±‚æ¬¡**ï¼š
```
æµ‹è¯•é‡‘å­—å¡”ï¼š

        [ç«¯åˆ°ç«¯æµ‹è¯•]     â† å®Œæ•´æµç¨‹éªŒè¯
       /             \
   [é›†æˆæµ‹è¯•]     [æ€§èƒ½æµ‹è¯•]   â† ç»„ä»¶åä½œéªŒè¯
  /                         \
[å•å…ƒæµ‹è¯•]               [æ•°æ®æµ‹è¯•]  â† åŸºç¡€åŠŸèƒ½éªŒè¯
```

### 11.2 æ•°æ®ä¸€è‡´æ€§éªŒè¯


**ðŸ” éªŒè¯è„šæœ¬ç¤ºä¾‹**ï¼š
```sql
-- æ•°æ®é‡å¯¹æ¯”
SELECT 
  'source' as type, 
  COUNT(*) as record_count,
  COUNT(DISTINCT user_id) as unique_users
FROM source_table
WHERE create_date = '2024-01-15'

UNION ALL

SELECT 
  'target' as type,
  COUNT(*) as record_count, 
  COUNT(DISTINCT user_id) as unique_users
FROM target_table
WHERE create_date = '2024-01-15';

-- ç»“æžœç¤ºä¾‹ï¼š
-- type    record_count  unique_users
-- source    100000        98500
-- target    100000        98500  âœ“ æ•°æ®ä¸€è‡´
```

**ðŸŽ¯ ä¸šåŠ¡è§„åˆ™éªŒè¯**ï¼š
```bash
#!/bin/bash
# ä¸šåŠ¡è§„åˆ™éªŒè¯è„šæœ¬

# éªŒè¯è®¢å•é‡‘é¢è®¡ç®—
validate_order_amount() {
    echo "éªŒè¯è®¢å•é‡‘é¢è®¡ç®—..."
    
    # æºç³»ç»Ÿè®¢å•æ€»é‡‘é¢
    source_total=$(mysql -h source_db -e "SELECT SUM(amount) FROM orders WHERE date='2024-01-15'" | tail -1)
    
    # ç›®æ ‡ç³»ç»Ÿè®¢å•æ€»é‡‘é¢  
    target_total=$(mysql -h target_db -e "SELECT SUM(amount) FROM orders WHERE date='2024-01-15'" | tail -1)
    
    if [ "$source_total" = "$target_total" ]; then
        echo "âœ“ è®¢å•é‡‘é¢éªŒè¯é€šè¿‡"
    else
        echo "âœ— è®¢å•é‡‘é¢ä¸ä¸€è‡´ï¼šæº=$source_total, ç›®æ ‡=$target_total"
        exit 1
    fi
}

validate_order_amount
```

---

## 12. ðŸ”§ è¿ç»´ç®¡ç†å®žè·µ


### 12.1 æ—¥å¸¸è¿ç»´æµç¨‹


**ðŸ“… è¿ç»´è®¡åˆ’è¡¨**ï¼š

| é¢‘çŽ‡ | **è¿ç»´å†…å®¹** | **å…·ä½“æ“ä½œ** |
|------|------------|-------------|
| **æ—¥å¸¸** | ä»»åŠ¡ç›‘æŽ§ | æ£€æŸ¥æ‰§è¡ŒçŠ¶æ€ã€å¼‚å¸¸å‘Šè­¦ |
| **å‘¨åº¦** | æ€§èƒ½åˆ†æž | åˆ†æžæ‰§è¡Œæ—¶é•¿ã€èµ„æºä½¿ç”¨ |
| **æœˆåº¦** | å®¹é‡è§„åˆ’ | è¯„ä¼°å­˜å‚¨ç©ºé—´ã€æ‰©å®¹éœ€æ±‚ |
| **å­£åº¦** | æµç¨‹ä¼˜åŒ– | æ£€è§†æµç¨‹æ•ˆçŽ‡ã€æ”¹è¿›æ–¹æ¡ˆ |

### 12.2 æ•…éšœå¤„ç†é¢„æ¡ˆ


**ðŸš¨ æ•…éšœå¤„ç†æµç¨‹**ï¼š
```
æ•…éšœå‘çŽ°
    â†“
é—®é¢˜è¯„ä¼° â”€â”€â†’ å½±å“èŒƒå›´ç¡®è®¤
    â†“           â†“
ç´§æ€¥å¤„ç†     å½±å“è¯„ä¼°
    â†“           â†“
ä¸´æ—¶æ–¹æ¡ˆ â”€â”€â†’ é€šçŸ¥ç›¸å…³æ–¹
    â†“
æ ¹å› åˆ†æž
    â†“
æ°¸ä¹…ä¿®å¤
    â†“
æ€»ç»“å½’æ¡£
```

**ðŸ’» å¸¸è§æ•…éšœå¤„ç†**ï¼š
```bash
# ç£ç›˜ç©ºé—´ä¸è¶³å¤„ç†
cleanup_logs() {
    echo "æ¸…ç†åŽ†å²æ—¥å¿—..."
    find /opt/datax/log -name "*.log" -mtime +7 -delete
    
    echo "æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
    find /tmp -name "datax_*" -mtime +1 -delete
    
    echo "å‰©ä½™ç©ºé—´ï¼š$(df -h /opt | tail -1 | awk '{print $4}')"
}

# ä»»åŠ¡å †ç§¯å¤„ç†
check_queue() {
    running_jobs=$(ps aux | grep datax | wc -l)
    
    if [ $running_jobs -gt 10 ]; then
        echo "ä»»åŠ¡å †ç§¯ï¼Œæš‚åœæ–°ä»»åŠ¡å¯åŠ¨"
        # æš‚åœè°ƒåº¦ç³»ç»Ÿ
        systemctl stop cron
    fi
}
```

### 12.3 ç‰ˆæœ¬ç®¡ç†


**ðŸ“¦ é…ç½®ç‰ˆæœ¬æŽ§åˆ¶**ï¼š
```bash
# Gitç®¡ç†ETLé…ç½®
/opt/etl-configs/
â”œâ”€â”€ jobs/
â”‚   â”œâ”€â”€ daily/
â”‚   â”‚   â”œâ”€â”€ orders_sync.json
â”‚   â”‚   â””â”€â”€ users_sync.json
â”‚   â””â”€â”€ hourly/
â”‚       â””â”€â”€ realtime_sync.json
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.sh
â”‚   â””â”€â”€ rollback.sh
â””â”€â”€ docs/
    â””â”€â”€ README.md

# éƒ¨ç½²è„šæœ¬
deploy_config() {
    # å¤‡ä»½å½“å‰é…ç½®
    cp -r /opt/datax/jobs /opt/datax/jobs.backup.$(date +%Y%m%d)
    
    # éƒ¨ç½²æ–°é…ç½®
    git pull origin master
    cp -r jobs/* /opt/datax/jobs/
    
    # éªŒè¯é…ç½®
    python /opt/datax/bin/datax.py --dry-run /opt/datax/jobs/test.json
}
```

---

## 13. ðŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 13.1 å¿…é¡»æŽŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ðŸ”¸ ETLæœ¬è´¨ï¼šæ•°æ®ä»Žæºåˆ°ç›®æ ‡çš„æ¬è¿å’Œæ•´ç†è¿‡ç¨‹
ðŸ”¸ DataXå®šä½ï¼šé˜¿é‡Œå¼€æºçš„é«˜æ€§èƒ½æ•°æ®ä¼ è¾“å·¥å…·
ðŸ”¸ æµç¨‹è®¾è®¡ï¼šæŠ½å–â†’è½¬æ¢â†’åŠ è½½â†’è´¨é‡æ£€æŸ¥çš„å®Œæ•´é“¾è·¯
ðŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå¹¶å‘ã€åˆ†ç‰‡ã€æ‰¹é‡å¤„ç†çš„ç»¼åˆåº”ç”¨
ðŸ”¸ è¿ç»´ç®¡ç†ï¼šç›‘æŽ§ã€å‘Šè­¦ã€æ•…éšœå¤„ç†çš„æ ‡å‡†åŒ–æµç¨‹
```

### 13.2 å…³é”®ç†è§£è¦ç‚¹


**ðŸ”¹ ETL vs æ™®é€šæ•°æ®åŒæ­¥**
```
æ™®é€šåŒæ­¥ï¼šç®€å•çš„æ•°æ®å¤åˆ¶
ETLæµç¨‹ï¼š
â€¢ ä¸šåŠ¡é€»è¾‘å¤„ç†
â€¢ æ•°æ®è´¨é‡ä¿è¯  
â€¢ æ€§èƒ½ä¼˜åŒ–è€ƒè™‘
â€¢ å¼‚å¸¸å¤„ç†æœºåˆ¶
â€¢ ç›‘æŽ§å‘Šè­¦ä½“ç³»
```

**ðŸ”¹ æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ€è·¯**
```
ç“¶é¢ˆè¯†åˆ«ï¼š
â€¢ ç½‘ç»œå¸¦å®½é™åˆ¶
â€¢ æ•°æ®åº“å¤„ç†èƒ½åŠ›
â€¢ ç£ç›˜IOæ€§èƒ½
â€¢ å†…å­˜ä½¿ç”¨æ•ˆçŽ‡

ä¼˜åŒ–ç­–ç•¥ï¼š
â€¢ åˆç†çš„å¹¶å‘åº¦è®¾ç½®
â€¢ é€‚å½“çš„æ‰¹é‡å¤§å°
â€¢ æœ‰æ•ˆçš„æ•°æ®åˆ†ç‰‡
â€¢ å®Œå–„çš„ç¼“å­˜æœºåˆ¶
```

**ðŸ”¹ æ•°æ®è´¨é‡ä¿è¯ä½“ç³»**
```
è´¨é‡ç»´åº¦ï¼š
â€¢ å®Œæ•´æ€§ï¼šæ•°æ®ä¸ä¸¢å¤±
â€¢ å‡†ç¡®æ€§ï¼šæ•°æ®ä¸å‡ºé”™
â€¢ ä¸€è‡´æ€§ï¼šæ ¼å¼ç»Ÿä¸€
â€¢ åŠæ—¶æ€§ï¼šæ»¡è¶³æ—¶æ•ˆè¦æ±‚

ä¿è¯æ‰‹æ®µï¼š
â€¢ æºå¤´éªŒè¯
â€¢ ä¼ è¾“æ£€æŸ¥
â€¢ ç›®æ ‡æ ¡éªŒ
â€¢ ä¸šåŠ¡éªŒè¯
```

### 13.3 å®žé™…åº”ç”¨ä»·å€¼


**ðŸŽ¯ ä¼ä¸šæ•°æ®é›†æˆåœºæ™¯**ï¼š
- **ä¸šåŠ¡æ•°æ®æ•´åˆ**ï¼šå¤šç³»ç»Ÿæ•°æ®ç»Ÿä¸€åˆ°æ•°æ®ä»“åº“
- **å®žæ—¶æŠ¥è¡¨æ”¯æ’‘**ï¼šä¸ºç®¡ç†å†³ç­–æä¾›åŠæ—¶æ•°æ®
- **æ•°æ®å¤‡ä»½è¿ç§»**ï¼šç¡®ä¿æ•°æ®å®‰å…¨å’Œå¯ç”¨æ€§
- **ç³»ç»Ÿè§£è€¦åˆ**ï¼šé™ä½Žç³»ç»Ÿé—´çš„ç›´æŽ¥ä¾èµ–

**ðŸ”§ è¿ç»´æœ€ä½³å®žè·µ**ï¼š
- **æ ‡å‡†åŒ–æµç¨‹**ï¼šå»ºç«‹å¯é‡å¤çš„æ“ä½œè§„èŒƒ
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šå‡å°‘äººå·¥å¹²é¢„å’Œå‡ºé”™æ¦‚çŽ‡
- **ç›‘æŽ§å‘Šè­¦**ï¼šåŠæ—¶å‘çŽ°å’Œå¤„ç†é—®é¢˜
- **æŒç»­ä¼˜åŒ–**ï¼šåŸºäºŽç›‘æŽ§æ•°æ®ä¸æ–­æ”¹è¿›

**ðŸ’¡ å­¦ä¹ å»ºè®®**ï¼š
- **åŠ¨æ‰‹å®žè·µ**ï¼šæ­å»ºæµ‹è¯•çŽ¯å¢ƒï¼Œè¿è¡ŒçœŸå®žä»»åŠ¡
- **åœºæ™¯é©±åŠ¨**ï¼šç»“åˆå…·ä½“ä¸šåŠ¡éœ€æ±‚å­¦ä¹ 
- **ç›‘æŽ§åˆ†æž**ï¼šå…³æ³¨æ€§èƒ½æŒ‡æ ‡å’Œä¼˜åŒ–æ•ˆæžœ
- **ç»éªŒç§¯ç´¯**ï¼šæ€»ç»“å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

**æ ¸å¿ƒè®°å¿†**ï¼š
- ETLæ˜¯æ•°æ®å¤„ç†çš„æ ‡å‡†æµç¨‹ï¼ŒDataXæ˜¯é«˜æ•ˆçš„å®žçŽ°å·¥å…·
- æ€§èƒ½ä¼˜åŒ–éœ€è¦ç»¼åˆè€ƒè™‘å¹¶å‘ã€åˆ†ç‰‡ã€æ‰¹é‡ç­‰ç­–ç•¥
- æ•°æ®è´¨é‡ä¿è¯è´¯ç©¿æ•´ä¸ªETLæµç¨‹çš„æ¯ä¸ªçŽ¯èŠ‚
- è¿ç»´ç®¡ç†çš„æ ¸å¿ƒæ˜¯æ ‡å‡†åŒ–ã€è‡ªåŠ¨åŒ–å’Œå¯ç›‘æŽ§
- å®žé™…åº”ç”¨ä¸­è¦å¹³è¡¡æ•ˆçŽ‡ã€ç¨³å®šæ€§å’Œæˆæœ¬ä¸‰ä¸ªç»´åº¦