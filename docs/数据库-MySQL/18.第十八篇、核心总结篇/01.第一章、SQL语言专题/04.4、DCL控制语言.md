---
title: 4、DCL控制语言
---
## 📚 目录

1. [DCL语句概述](#1-DCL语句概述)
2. [用户管理语句](#2-用户管理语句)
3. [权限授予语句](#3-权限授予语句)
4. [权限撤销语句](#4-权限撤销语句)
5. [角色管理语句](#5-角色管理语句)
6. [权限查询语句](#6-权限查询语句)
7. [权限刷新语句](#7-权限刷新语句)
8. [安全设置语句](#8-安全设置语句)
9. [实用DCL组合语句](#9-实用DCL组合语句)
10. [权限最佳实践](#10-权限最佳实践)
11. [核心要点总结](#11-核心要点总结)

---

## 1. 🔐 DCL语句概述


### 1.1 什么是DCL语句


**🔸 核心定义**
```
DCL（Data Control Language）：数据控制语言
作用：控制数据库用户的访问权限和安全设置
核心功能：用户管理、权限控制、安全防护
```

**💡 DCL的重要性**
数据库安全就像房子的门锁系统：
- **用户管理**：相当于给不同的人分发钥匙
- **权限控制**：决定每把钥匙能打开哪些房间
- **安全设置**：设置门禁时间、访问限制等规则

### 1.2 DCL语句分类


**📊 DCL语句类型图**
```
DCL数据控制语言
├── 用户管理
│   ├── CREATE USER（创建用户）
│   ├── ALTER USER（修改用户）
│   ├── DROP USER（删除用户）
│   └── RENAME USER（重命名用户）
├── 权限控制
│   ├── GRANT（授予权限）
│   ├── REVOKE（撤销权限）
│   └── FLUSH PRIVILEGES（刷新权限）
├── 角色管理（MySQL 8.0+）
│   ├── CREATE ROLE（创建角色）
│   ├── DROP ROLE（删除角色）
│   └── SET ROLE（激活角色）
└── 查询权限
    ├── SHOW GRANTS（显示权限）
    └── 权限表查询
```

---

## 2. 👤 用户管理语句


### 2.1 用户创建与删除


#### 🔸 用户创建（CREATE USER）


**基础用户创建**
```sql
-- 最简单的用户创建
CREATE USER 'username'@'host' IDENTIFIED BY 'password';

-- 实例：创建一个本地用户
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'mypassword123';

-- 创建可以从任何主机连接的用户
CREATE USER 'remote_user'@'%' IDENTIFIED BY 'securepass456';
```

**💡 主机名说明**
- **`localhost`**：只能本地连接
- **`%`**：可以从任何主机连接（注意安全风险）
- **`192.168.1.%`**：只能从特定网段连接
- **`specific.domain.com`**：只能从特定域名连接

**指定认证插件创建**
```sql
-- 使用特定认证插件
CREATE USER 'secure_user'@'localhost' 
IDENTIFIED WITH mysql_native_password BY 'password123';

-- MySQL 8.0 默认使用 caching_sha2_password
CREATE USER 'modern_user'@'%' 
IDENTIFIED WITH caching_sha2_password BY 'newpassword';
```

**条件创建用户**
```sql
-- 如果用户不存在才创建
CREATE USER IF NOT EXISTS 'backup_user'@'localhost' 
IDENTIFIED BY 'backuppass';
```

**密码过期设置**
```sql
-- 创建用户时设置密码立即过期
CREATE USER 'temp_user'@'localhost' 
IDENTIFIED BY 'temppass' PASSWORD EXPIRE;
```

#### 🔸 用户删除（DROP USER）


**基础用户删除**
```sql
-- 删除指定用户
DROP USER 'username'@'host';

-- 条件删除用户
DROP USER IF EXISTS 'old_user'@'localhost';

-- 同时删除多个用户
DROP USER 'user1'@'localhost', 'user2'@'%';
```

### 2.2 用户修改管理


#### 🔸 用户属性修改（ALTER USER）


**密码修改**
```sql
-- 修改用户密码
ALTER USER 'app_user'@'localhost' IDENTIFIED BY 'new_password123';

-- 修改当前用户密码
ALTER USER USER() IDENTIFIED BY 'my_new_password';
```

**账户状态管理**
```sql
-- 强制密码过期
ALTER USER 'temp_user'@'localhost' PASSWORD EXPIRE;

-- 设置密码永不过期
ALTER USER 'system_user'@'localhost' PASSWORD EXPIRE NEVER;

-- 锁定账户
ALTER USER 'suspicious_user'@'%' ACCOUNT LOCK;

-- 解锁账户
ALTER USER 'suspicious_user'@'%' ACCOUNT UNLOCK;
```

#### 🔸 用户重命名（RENAME USER）


```sql
-- 重命名用户
RENAME USER 'old_username'@'localhost' TO 'new_username'@'localhost';

-- 修改用户主机范围
RENAME USER 'user1'@'localhost' TO 'user1'@'%';
```

### 2.3 密码管理


**🔸 密码策略设置**
```sql
-- 设置密码90天后过期
ALTER USER 'app_user'@'localhost' PASSWORD EXPIRE INTERVAL 90 DAY;

-- 设置密码历史记录（记住最近5个密码）
ALTER USER 'app_user'@'localhost' PASSWORD HISTORY 5;

-- 设置密码重用间隔（365天后可重用旧密码）
ALTER USER 'app_user'@'localhost' PASSWORD REUSE INTERVAL 365 DAY;

-- 设置登录失败锁定策略
ALTER USER 'app_user'@'localhost' 
FAILED_LOGIN_ATTEMPTS 3 PASSWORD_LOCK_TIME 2;
```

**💡 密码策略解释**
- **PASSWORD EXPIRE INTERVAL**：密码有效期
- **PASSWORD HISTORY**：禁止重用最近N个密码
- **PASSWORD REUSE INTERVAL**：多久后可以重用旧密码
- **FAILED_LOGIN_ATTEMPTS**：失败多少次后锁定
- **PASSWORD_LOCK_TIME**：锁定多少天

---

## 3. 🔑 权限授予语句


### 3.1 基础权限授予


#### 🔸 数据操作权限（GRANT）


**单个权限授予**
```sql
-- 授予查询权限
GRANT SELECT ON database_name.table_name TO 'user'@'host';

-- 授予插入权限
GRANT INSERT ON database_name.table_name TO 'user'@'host';

-- 授予更新权限
GRANT UPDATE ON database_name.table_name TO 'user'@'host';

-- 授予删除权限
GRANT DELETE ON database_name.table_name TO 'user'@'host';
```

**实际应用示例**
```sql
-- 给客服人员只读权限
GRANT SELECT ON customer_db.* TO 'customer_service'@'%';

-- 给数据分析师查询权限
GRANT SELECT ON analytics_db.* TO 'data_analyst'@'localhost';
```

#### 🔸 结构操作权限


**表结构权限**
```sql
-- 创建表权限
GRANT CREATE ON database_name.* TO 'developer'@'localhost';

-- 修改表结构权限
GRANT ALTER ON database_name.table_name TO 'dba'@'localhost';

-- 删除表权限
GRANT DROP ON database_name.table_name TO 'admin'@'localhost';

-- 索引权限
GRANT INDEX ON database_name.table_name TO 'performance_tuner'@'localhost';
```

### 3.2 权限组合授予


**🔸 常用权限组合**
```sql
-- 基础CRUD权限
GRANT SELECT, INSERT, UPDATE, DELETE 
ON application_db.* TO 'app_user'@'localhost';

-- 开发环境全权限
GRANT ALL PRIVILEGES ON dev_database.* TO 'developer'@'localhost';

-- 超级管理员权限（谨慎使用）
GRANT ALL ON *.* TO 'super_admin'@'localhost';
```

**🔸 字段级权限**
```sql
-- 只能查询特定字段
GRANT SELECT(id, name, email) 
ON users.user_info TO 'limited_user'@'localhost';

-- 只能更新特定字段
GRANT UPDATE(last_login, login_count) 
ON users.user_stats TO 'login_updater'@'localhost';
```

**📝 字段级权限的应用场景**
```
敏感数据保护：
- 客服只能看姓名和电话，不能看身份证号
- 财务只能看订单金额，不能看用户详细信息
- 运营只能更新状态字段，不能修改核心数据
```

### 3.3 管理权限授予


**🔸 系统管理权限**
```sql
-- 重载权限（重启服务、刷新配置）
GRANT RELOAD ON *.* TO 'system_admin'@'localhost';

-- 进程查看权限（查看正在运行的查询）
GRANT PROCESS ON *.* TO 'monitor_user'@'localhost';

-- 超级用户权限（几乎所有操作）
GRANT SUPER ON *.* TO 'emergency_admin'@'localhost';

-- 文件操作权限（导入导出文件）
GRANT FILE ON *.* TO 'backup_user'@'localhost';
```

**🔸 复制权限**
```sql
-- 主从复制从库权限
GRANT REPLICATION SLAVE ON *.* TO 'replica_user'@'192.168.1.%';

-- 复制客户端权限（查看主从状态）
GRANT REPLICATION CLIENT ON *.* TO 'monitor_replication'@'localhost';
```

**🔸 存储程序权限**
```sql
-- 创建存储过程/函数权限
GRANT CREATE ROUTINE ON application_db.* TO 'developer'@'localhost';

-- 修改存储过程/函数权限
GRANT ALTER ROUTINE ON application_db.* TO 'senior_dev'@'localhost';

-- 执行存储过程/函数权限
GRANT EXECUTE ON application_db.* TO 'app_user'@'localhost';
```

### 3.4 高级权限授予


**🔸 权限传递（WITH GRANT OPTION）**
```sql
-- 授予权限同时允许该用户给别人授权
GRANT SELECT, INSERT ON database_name.* 
TO 'team_leader'@'localhost' WITH GRANT OPTION;
```

> ⚠️ **注意**：WITH GRANT OPTION 要谨慎使用，它会让用户获得"授权"的权力

**🔸 特殊权限**
```sql
-- 用户管理权限
GRANT CREATE USER ON *.* TO 'user_manager'@'localhost';

-- 事件调度器权限
GRANT EVENT ON database_name.* TO 'scheduler_user'@'localhost';

-- 触发器权限
GRANT TRIGGER ON database_name.table_name TO 'trigger_manager'@'localhost';
```

---

## 4. ❌ 权限撤销语句


### 4.1 基础权限撤销


**🔸 撤销数据权限（REVOKE）**
```sql
-- 撤销查询权限
REVOKE SELECT ON database_name.table_name FROM 'user'@'host';

-- 撤销多个权限
REVOKE INSERT, UPDATE, DELETE 
ON database_name.table_name FROM 'user'@'host';

-- 撤销所有权限
REVOKE ALL PRIVILEGES ON database_name.* FROM 'user'@'host';
```

**实际应用示例**
```sql
-- 员工离职时撤销权限
REVOKE ALL PRIVILEGES ON company_db.* FROM 'former_employee'@'%';

-- 降级权限（从读写改为只读）
REVOKE INSERT, UPDATE, DELETE ON sales_db.* FROM 'readonly_user'@'localhost';
```

**🔸 撤销管理权限**
```sql
-- 撤销超级权限
REVOKE SUPER ON *.* FROM 'former_admin'@'localhost';

-- 撤销授权能力
REVOKE GRANT OPTION ON database_name.* FROM 'team_leader'@'localhost';
```

### 4.2 特定权限撤销


**🔸 字段级权限撤销**
```sql
-- 撤销特定字段的查询权限
REVOKE SELECT(salary, bonus) 
ON hr_db.employee_info FROM 'hr_assistant'@'localhost';
```

**🔸 存储程序权限撤销**
```sql
-- 撤销存储过程执行权限
REVOKE EXECUTE ON PROCEDURE database_name.proc_name 
FROM 'user'@'host';

-- 撤销函数执行权限
REVOKE EXECUTE ON FUNCTION database_name.func_name 
FROM 'user'@'host';
```

---

## 5. 👥 角色管理语句


> 📝 **说明**：角色功能在MySQL 8.0及以上版本才支持

### 5.1 角色创建与删除


**🔸 角色创建（CREATE ROLE）**
```sql
-- 创建基础角色
CREATE ROLE 'app_read_role';
CREATE ROLE 'app_write_role';
CREATE ROLE 'admin_role';

-- 条件创建角色
CREATE ROLE IF NOT EXISTS 'backup_role';
```

**🔸 角色删除（DROP ROLE）**
```sql
-- 删除角色
DROP ROLE 'old_role';

-- 条件删除角色
DROP ROLE IF EXISTS 'temp_role';
```

### 5.2 角色权限管理


**🔸 角色授权**
```sql
-- 给角色授予权限
GRANT SELECT, INSERT ON application_db.* TO 'app_write_role';
GRANT SELECT ON application_db.* TO 'app_read_role';
GRANT ALL ON *.* TO 'admin_role';

-- 将角色授予用户
GRANT 'app_read_role', 'app_write_role' TO 'developer'@'localhost';
GRANT 'admin_role' TO 'dba'@'localhost';
```

**🔸 角色撤销**
```sql
-- 从用户撤销角色
REVOKE 'app_write_role' FROM 'former_developer'@'localhost';

-- 撤销角色的权限
REVOKE INSERT, UPDATE ON application_db.* FROM 'app_write_role';
```

### 5.3 角色激活管理


**🔸 角色激活（SET ROLE）**
```sql
-- 激活指定角色
SET ROLE 'app_write_role';

-- 激活所有角色
SET ROLE ALL;

-- 激活除指定外的所有角色
SET ROLE ALL EXCEPT 'admin_role';

-- 取消激活所有角色
SET ROLE NONE;
```

**🔸 默认角色设置**
```sql
-- 为用户设置默认角色
SET DEFAULT ROLE 'app_read_role' TO 'developer'@'localhost';

-- 设置多个默认角色
SET DEFAULT ROLE 'app_read_role', 'app_write_role' 
TO 'senior_developer'@'localhost';
```

**💡 角色使用实例**
```sql
-- 完整的角色权限管理流程
-- 1. 创建角色
CREATE ROLE 'sales_read', 'sales_write', 'sales_admin';

-- 2. 给角色分配权限
GRANT SELECT ON sales_db.* TO 'sales_read';
GRANT SELECT, INSERT, UPDATE ON sales_db.* TO 'sales_write';
GRANT ALL ON sales_db.* TO 'sales_admin';

-- 3. 将角色分配给用户
GRANT 'sales_read' TO 'sales_viewer'@'%';
GRANT 'sales_read', 'sales_write' TO 'sales_manager'@'%';
GRANT 'sales_admin' TO 'sales_director'@'localhost';

-- 4. 设置默认角色
SET DEFAULT ROLE 'sales_read' TO 'sales_viewer'@'%';
```

---

## 6. 🔍 权限查询语句


### 6.1 权限信息查询


**🔸 查看权限（SHOW GRANTS）**
```sql
-- 查看当前用户权限
SHOW GRANTS;

-- 查看指定用户权限
SHOW GRANTS FOR 'app_user'@'localhost';

-- 查看当前有效用户权限
SHOW GRANTS FOR CURRENT_USER();

-- 查看用户的角色权限（MySQL 8.0+）
SHOW GRANTS FOR 'developer'@'localhost' USING 'app_write_role';
```

**🔸 权限表查询**
```sql
-- 查看所有用户基本信息
SELECT User, Host, account_locked, password_expired 
FROM mysql.user;

-- 查看数据库级权限
SELECT User, Host, Db, Select_priv, Insert_priv, Update_priv, Delete_priv 
FROM mysql.db;

-- 查看表级权限
SELECT User, Host, Db, Table_name, Table_priv 
FROM mysql.tables_priv;

-- 查看字段级权限
SELECT User, Host, Db, Table_name, Column_name, Column_priv 
FROM mysql.columns_priv;
```

### 6.2 用户信息查询


**🔸 用户管理查询**
```sql
-- 查看所有用户列表
SELECT User, Host, Create_user_priv, Super_priv 
FROM mysql.user ORDER BY User;

-- 查看用户创建语句
SHOW CREATE USER 'app_user'@'localhost';

-- 查看角色信息（MySQL 8.0+）
SELECT User AS role_name FROM mysql.user WHERE account_locked = 'Y';
```

**实用查询模板**
```sql
-- 查找拥有特定权限的用户
SELECT User, Host FROM mysql.user WHERE Super_priv = 'Y';

-- 查找从外网可访问的用户
SELECT User, Host FROM mysql.user WHERE Host = '%';

-- 查找空密码的用户（安全检查）
SELECT User, Host FROM mysql.user WHERE authentication_string = '';
```

---

## 7. 🔄 权限刷新语句


### 7.1 权限生效


**🔸 刷新权限（FLUSH PRIVILEGES）**
```sql
-- 刷新权限表，使权限修改立即生效
FLUSH PRIVILEGES;
```

**💡 什么时候需要FLUSH PRIVILEGES？**
```
需要手动刷新的情况：
✅ 直接修改了mysql.user等权限表
✅ 使用INSERT/UPDATE/DELETE操作权限表

不需要手动刷新的情况：
❌ 使用GRANT/REVOKE语句（自动生效）
❌ 使用CREATE USER/DROP USER语句（自动生效）
```

**权限刷新示例**
```sql
-- 场景：直接修改权限表后需要刷新
UPDATE mysql.user SET Super_priv = 'Y' 
WHERE User = 'admin' AND Host = 'localhost';

-- 必须执行刷新才能生效
FLUSH PRIVILEGES;
```

---

## 8. 🔒 安全设置语句


### 8.1 连接安全


**🔸 SSL配置**
```sql
-- 要求使用SSL连接
GRANT SELECT ON sensitive_db.* TO 'secure_user'@'%' REQUIRE SSL;

-- 要求X509证书
GRANT SELECT ON financial_db.* TO 'finance_user'@'%' REQUIRE X509;

-- 指定加密算法
GRANT SELECT ON top_secret_db.* TO 'crypto_user'@'%' 
REQUIRE CIPHER 'AES256-SHA';

-- 要求特定的证书颁发者
GRANT SELECT ON audit_db.* TO 'auditor'@'%' 
REQUIRE ISSUER 'C=CN,ST=BJ,L=Beijing,O=Company,CN=CA';
```

### 8.2 资源限制


**🔸 连接和查询限制**
```sql
-- 每小时查询次数限制
GRANT SELECT ON large_db.* TO 'limited_user'@'%' 
WITH MAX_QUERIES_PER_HOUR 1000;

-- 每小时更新次数限制
GRANT UPDATE ON data_db.* TO 'batch_user'@'localhost' 
WITH MAX_UPDATES_PER_HOUR 100;

-- 每小时连接次数限制
GRANT SELECT ON service_db.* TO 'client_app'@'%' 
WITH MAX_CONNECTIONS_PER_HOUR 20;

-- 同时连接数限制
GRANT SELECT ON shared_db.* TO 'shared_user'@'%' 
WITH MAX_USER_CONNECTIONS 5;

-- 组合限制
GRANT SELECT, INSERT ON api_db.* TO 'api_user'@'%' 
WITH MAX_QUERIES_PER_HOUR 10000
     MAX_UPDATES_PER_HOUR 500
     MAX_CONNECTIONS_PER_HOUR 100
     MAX_USER_CONNECTIONS 10;
```

**📊 资源限制对比表**

| 限制类型 | **作用** | **使用场景** | **注意事项** |
|---------|---------|-------------|-------------|
| `MAX_QUERIES_PER_HOUR` | **限制每小时查询数** | `防止查询过载` | `SELECT、SHOW等语句` |
| `MAX_UPDATES_PER_HOUR` | **限制每小时更新数** | `防止数据变更过频` | `INSERT、UPDATE、DELETE` |
| `MAX_CONNECTIONS_PER_HOUR` | **限制每小时连接数** | `防止连接轰炸` | `连接建立次数，非同时连接` |
| `MAX_USER_CONNECTIONS` | **限制同时连接数** | `防止连接耗尽` | `该用户最大并发连接数` |

---

## 9. 🛠️ 实用DCL组合语句


### 9.1 常用权限模板


#### 🔸 只读用户模板

```sql
-- 创建只读用户（数据查询员）
CREATE USER 'readonly'@'%' IDENTIFIED BY 'SecurePass123!';
GRANT SELECT ON company_db.* TO 'readonly'@'%';
GRANT SELECT ON reports_db.* TO 'readonly'@'%';

-- 添加资源限制
ALTER USER 'readonly'@'%' 
WITH MAX_QUERIES_PER_HOUR 5000
     MAX_CONNECTIONS_PER_HOUR 50
     MAX_USER_CONNECTIONS 5;

FLUSH PRIVILEGES;
```

#### 🔸 应用用户模板

```sql
-- 创建应用程序用户
CREATE USER 'app_user'@'192.168.1.%' IDENTIFIED BY 'AppSecret456!';

-- 授予应用所需的基础权限
GRANT SELECT, INSERT, UPDATE, DELETE ON app_database.users TO 'app_user'@'192.168.1.%';
GRANT SELECT, INSERT, UPDATE, DELETE ON app_database.orders TO 'app_user'@'192.168.1.%';
GRANT SELECT, INSERT, UPDATE, DELETE ON app_database.products TO 'app_user'@'192.168.1.%';

-- 授予存储过程执行权限
GRANT EXECUTE ON app_database.* TO 'app_user'@'192.168.1.%';

-- 设置连接限制
ALTER USER 'app_user'@'192.168.1.%' 
WITH MAX_USER_CONNECTIONS 20;

FLUSH PRIVILEGES;
```

#### 🔸 管理员用户模板

```sql
-- 创建数据库管理员
CREATE USER 'dba_admin'@'localhost' IDENTIFIED BY 'DBASecret789!';

-- 授予管理员权限（除了FILE权限，安全考虑）
GRANT ALL PRIVILEGES ON *.* TO 'dba_admin'@'localhost' WITH GRANT OPTION;
REVOKE FILE ON *.* FROM 'dba_admin'@'localhost';

-- 设置密码策略
ALTER USER 'dba_admin'@'localhost' 
PASSWORD EXPIRE INTERVAL 60 DAY
PASSWORD HISTORY 5;

FLUSH PRIVILEGES;
```

### 9.2 权限回收模板


**🔸 用户离职权限清理**
```sql
-- 步骤1：锁定账户
ALTER USER 'former_employee'@'%' ACCOUNT LOCK;

-- 步骤2：撤销所有权限
REVOKE ALL PRIVILEGES ON *.* FROM 'former_employee'@'%';
REVOKE GRANT OPTION ON *.* FROM 'former_employee'@'%';

-- 步骤3：撤销角色（如果使用了角色）
REVOKE 'employee_role', 'department_role' FROM 'former_employee'@'%';

-- 步骤4：删除用户
DROP USER 'former_employee'@'%';

FLUSH PRIVILEGES;
```

**🔸 权限降级模板**
```sql
-- 将管理员降级为普通用户
-- 1. 撤销管理权限
REVOKE SUPER, PROCESS, RELOAD ON *.* FROM 'former_admin'@'localhost';
REVOKE GRANT OPTION ON *.* FROM 'former_admin'@'localhost';

-- 2. 只保留基础数据权限
REVOKE ALL ON *.* FROM 'former_admin'@'localhost';
GRANT SELECT, INSERT, UPDATE, DELETE ON specific_db.* TO 'former_admin'@'localhost';

FLUSH PRIVILEGES;
```

### 9.3 角色权限模板


**🔸 应用角色设计（MySQL 8.0+）**
```sql
-- 创建分层角色
CREATE ROLE 'app_reader', 'app_writer', 'app_admin';

-- 基础只读角色
GRANT SELECT ON app_db.* TO 'app_reader';

-- 读写角色（继承只读）
GRANT 'app_reader' TO 'app_writer';
GRANT INSERT, UPDATE, DELETE ON app_db.* TO 'app_writer';

-- 管理员角色（继承读写）
GRANT 'app_writer' TO 'app_admin';
GRANT CREATE, ALTER, DROP, INDEX ON app_db.* TO 'app_admin';
GRANT CREATE ROUTINE, ALTER ROUTINE, EXECUTE ON app_db.* TO 'app_admin';

-- 分配角色给用户
GRANT 'app_reader' TO 'data_analyst'@'%';
GRANT 'app_writer' TO 'app_service'@'192.168.1.%';
GRANT 'app_admin' TO 'tech_lead'@'localhost';

-- 设置默认角色
SET DEFAULT ROLE 'app_reader' TO 'data_analyst'@'%';
SET DEFAULT ROLE 'app_writer' TO 'app_service'@'192.168.1.%';
SET DEFAULT ROLE 'app_admin' TO 'tech_lead'@'localhost';
```

---

## 10. ✨ 权限最佳实践


### 10.1 安全原则


**🔸 最小权限原则**

> 💡 **核心思想**：用户只应该拥有完成工作所需的最小权限

```sql
-- ❌ 错误做法：给所有用户管理员权限
GRANT ALL ON *.* TO 'app_user'@'%';

-- ✅ 正确做法：只给必需权限
GRANT SELECT, INSERT, UPDATE ON app_db.users TO 'app_user'@'192.168.1.%';
GRANT SELECT, INSERT ON app_db.logs TO 'app_user'@'192.168.1.%';
```

**🔸 定期权限审计**
```sql
-- 审计脚本：查找高权限用户
SELECT User, Host, Super_priv, Grant_priv, Create_user_priv
FROM mysql.user 
WHERE Super_priv = 'Y' OR Grant_priv = 'Y' OR Create_user_priv = 'Y';

-- 查找从外网可访问的用户
SELECT User, Host FROM mysql.user WHERE Host IN ('%', '0.0.0.0/0');

-- 查找长时间未登录的用户
SELECT User, Host, 
       DATEDIFF(NOW(), STR_TO_DATE(JSON_UNQUOTE(JSON_EXTRACT(User_attributes, '$.last_login')), '%Y-%m-%d %H:%i:%s')) as days_inactive
FROM mysql.user 
WHERE User_attributes IS NOT NULL;
```

### 10.2 权限管理规范


**🔸 环境隔离**
```sql
-- 开发环境用户
CREATE USER 'dev_user'@'192.168.10.%' IDENTIFIED BY 'DevPass123!';
GRANT ALL ON dev_database.* TO 'dev_user'@'192.168.10.%';

-- 测试环境用户
CREATE USER 'test_user'@'192.168.20.%' IDENTIFIED BY 'TestPass456!';
GRANT SELECT, INSERT, UPDATE, DELETE ON test_database.* TO 'test_user'@'192.168.20.%';

-- 生产环境用户（最严格）
CREATE USER 'prod_user'@'192.168.100.%' IDENTIFIED BY 'ProdSecure789!';
GRANT SELECT, INSERT, UPDATE ON prod_database.users TO 'prod_user'@'192.168.100.%';
GRANT SELECT, INSERT ON prod_database.logs TO 'prod_user'@'192.168.100.%';
```

**🔸 密码安全策略**
```sql
-- 强制定期更改密码
ALTER USER 'sensitive_user'@'localhost' 
PASSWORD EXPIRE INTERVAL 30 DAY
PASSWORD HISTORY 10
FAILED_LOGIN_ATTEMPTS 3
PASSWORD_LOCK_TIME 1;

-- 生产环境密码复杂度要求
-- 在my.cnf中配置：
-- validate_password.policy=STRONG
-- validate_password.length=12
-- validate_password.mixed_case_count=2
-- validate_password.number_count=2
-- validate_password.special_char_count=2
```

**🔸 监控权限变更**
```sql
-- 启用审计日志记录权限变更
-- 在my.cnf中配置：
-- audit_log_policy=ALL
-- audit_log_format=JSON

-- 创建权限变更监控表
CREATE TABLE permission_audit (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_account VARCHAR(100) NOT NULL,
    operation_type ENUM('GRANT', 'REVOKE', 'CREATE_USER', 'DROP_USER') NOT NULL,
    target_user VARCHAR(100),
    privileges TEXT,
    database_name VARCHAR(64),
    table_name VARCHAR(64),
    operated_by VARCHAR(100) NOT NULL,
    operation_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_user_account (user_account),
    INDEX idx_operation_time (operation_time)
) ENGINE=InnoDB;
```

**📋 权限管理检查清单**

- [ ] **用户创建**：使用强密码，限制主机范围
- [ ] **权限分配**：遵循最小权限原则
- [ ] **定期审计**：每月检查用户权限
- [ ] **密码策略**：定期更换，复杂度要求
- [ ] **环境隔离**：不同环境不同用户
- [ ] **监控日志**：记录权限变更操作
- [ ] **应急预案**：权限泄露时的处理流程
- [ ] **文档记录**：维护权限分配文档

---

## 11. 📋 核心要点总结


### 11.1 必须掌握的核心概念


```
🔸 DCL语句本质：控制数据库访问权限和用户安全
🔸 用户管理：CREATE USER、ALTER USER、DROP USER、RENAME USER
🔸 权限控制：GRANT授权、REVOKE撤销、FLUSH PRIVILEGES刷新
🔸 角色管理：CREATE ROLE、SET ROLE、DEFAULT ROLE（MySQL 8.0+）
🔸 安全设置：SSL要求、资源限制、密码策略
🔸 权限查询：SHOW GRANTS、权限表查询
```

### 11.2 关键理解要点


**🔹 权限层级结构**
```
全局权限 (GLOBAL)
    ↓
数据库权限 (DATABASE) 
    ↓
表权限 (TABLE)
    ↓ 
字段权限 (COLUMN)
    ↓
存储过程权限 (ROUTINE)
```

**🔹 权限继承关系**
```
高级权限包含低级权限：
- ALL PRIVILEGES 包含所有权限
- ALTER 权限包含 CREATE, DROP 的部分功能
- SUPER 权限包含很多管理功能
```

**🔹 安全最佳实践原则**
```
最小权限：只给必需的权限
职责分离：不同角色不同权限
定期审计：检查权限分配合理性
环境隔离：开发测试生产分离
强密码：复杂密码定期更换
```

### 11.3 实际应用价值


**🎯 业务场景应用**
- **Web应用**：应用用户只有CRUD权限，管理员有结构权限
- **数据分析**：分析师只有SELECT权限，保护数据安全
- **运维管理**：DBA有管理权限，普通运维有监控权限
- **第三方集成**：外部系统只有特定表的特定权限

**🔧 运营支持**
- **权限审计**：定期检查用户权限分配是否合理
- **安全防护**：通过权限控制防止数据泄露
- **合规要求**：满足数据保护法规要求
- **故障隔离**：限制权限减少误操作风险

**核心记忆口诀**：
- DCL控制访问权，用户角色要分明
- 最小权限是关键，定期审计保安全
- 授权撤销要谨慎，密码策略不可轻
- 环境隔离职责清，监控日志记变更