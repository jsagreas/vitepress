---
title: 1ã€DMLæ“çºµè¯­è¨€
---
## ğŸ“š ç›®å½•

1. [DMLæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ](#1-DMLæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ)
2. [SELECTæŸ¥è¯¢è¯­å¥å®Œæ•´ä½“ç³»](#2-SELECTæŸ¥è¯¢è¯­å¥å®Œæ•´ä½“ç³»)
3. [INSERTæ’å…¥è¯­å¥å®Œæ•´ä½“ç³»](#3-INSERTæ’å…¥è¯­å¥å®Œæ•´ä½“ç³»)
4. [UPDATEæ›´æ–°è¯­å¥å®Œæ•´ä½“ç³»](#4-UPDATEæ›´æ–°è¯­å¥å®Œæ•´ä½“ç³»)
5. [DELETEåˆ é™¤è¯­å¥å®Œæ•´ä½“ç³»](#5-DELETEåˆ é™¤è¯­å¥å®Œæ•´ä½“ç³»)
6. [é«˜çº§DMLç‰¹æ€§ä¸åº”ç”¨](#6-é«˜çº§DMLç‰¹æ€§ä¸åº”ç”¨)
7. [æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ](#7-æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– DMLæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯DML


**DMLå®šä¹‰**ï¼šData Manipulation Languageï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰

> **ğŸ’¡ é€šä¿—ç†è§£**ï¼šDMLå°±åƒæ“ä½œæ–‡ä»¶çš„åŸºæœ¬åŠ¨ä½œ - è¯»å–ã€å†™å…¥ã€ä¿®æ”¹ã€åˆ é™¤ï¼Œåªä¸è¿‡æ“ä½œçš„æ˜¯æ•°æ®åº“ä¸­çš„æ•°æ®

**DMLçš„æ ¸å¿ƒä½œç”¨**ï¼š
- **æŸ¥è¯¢æ•°æ®**ï¼šä»æ•°æ®åº“ä¸­æ£€ç´¢éœ€è¦çš„ä¿¡æ¯
- **æ’å…¥æ•°æ®**ï¼šå‘æ•°æ®åº“ä¸­æ·»åŠ æ–°çš„è®°å½•
- **æ›´æ–°æ•°æ®**ï¼šä¿®æ”¹æ•°æ®åº“ä¸­å·²å­˜åœ¨çš„è®°å½•
- **åˆ é™¤æ•°æ®**ï¼šä»æ•°æ®åº“ä¸­ç§»é™¤ä¸éœ€è¦çš„è®°å½•

### 1.2 DMLå››å¤§æ ¸å¿ƒè¯­å¥


```
DMLè¯­å¥å®¶æ—ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯­å¥ç±»å‹    â”‚ ä¸»è¦ä½œç”¨     â”‚ å…¸å‹åœºæ™¯         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT      â”‚ æŸ¥è¯¢æ•°æ®     â”‚ æŠ¥è¡¨ã€åˆ†æã€å±•ç¤º â”‚
â”‚ INSERT      â”‚ æ’å…¥æ•°æ®     â”‚ æ–°å¢è®°å½•ã€æ‰¹é‡å¯¼å…¥â”‚
â”‚ UPDATE      â”‚ æ›´æ–°æ•°æ®     â”‚ ä¿®æ”¹ä¿¡æ¯ã€çŠ¶æ€å˜æ›´â”‚
â”‚ DELETE      â”‚ åˆ é™¤æ•°æ®     â”‚ æ¸…ç†æ•°æ®ã€å½’æ¡£   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 DMLåœ¨æ•°æ®åº“æ“ä½œä¸­çš„åœ°ä½


**æ•°æ®åº“æ“ä½œè¯­è¨€åˆ†ç±»**ï¼š
```
SQLè¯­è¨€åˆ†ç±»ï¼š
â”œâ”€ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰ï¼šCREATEã€DROPã€ALTER
â”œâ”€ DMLï¼ˆæ•°æ®æ“çºµè¯­è¨€ï¼‰ï¼šSELECTã€INSERTã€UPDATEã€DELETE â† æœ¬æ–‡é‡ç‚¹
â”œâ”€ DCLï¼ˆæ•°æ®æ§åˆ¶è¯­è¨€ï¼‰ï¼šGRANTã€REVOKE
â””â”€ TCLï¼ˆäº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼‰ï¼šCOMMITã€ROLLBACK
```

> **ğŸ“Œ å…³é”®ç†è§£**ï¼šDMLæ˜¯å¼€å‘è€…æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨æœ€é¢‘ç¹çš„SQLè¯­å¥ç±»å‹ï¼ŒæŒæ¡DMLå°±æŒæ¡äº†æ•°æ®åº“æ“ä½œçš„æ ¸å¿ƒ

---

## 2. ğŸ” SELECTæŸ¥è¯¢è¯­å¥å®Œæ•´ä½“ç³»


### 2.1 åŸºç¡€æŸ¥è¯¢è¯­æ³•è¯¦è§£


#### 2.1.1 SELECTåŸºæœ¬ç»“æ„


**æ ‡å‡†SELECTè¯­æ³•æ¨¡æ¿**ï¼š
```sql
SELECT [ä¿®é¥°ç¬¦] å­—æ®µåˆ—è¡¨
FROM è¡¨å
WHERE æ¡ä»¶
GROUP BY åˆ†ç»„å­—æ®µ
HAVING åˆ†ç»„æ¡ä»¶
ORDER BY æ’åºå­—æ®µ
LIMIT é™åˆ¶æ¡ä»¶;
```

**æŸ¥è¯¢è¡¨è¾¾å¼é€‰æ‹©**ï¼š
```sql
-- å…¨å­—æ®µæŸ¥è¯¢ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
SELECT * FROM users;

-- æŒ‡å®šå­—æ®µæŸ¥è¯¢ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
SELECT id, username, email FROM users;

-- å­—æ®µåˆ«åä½¿ç”¨
SELECT 
    id AS user_id,
    username AS ç”¨æˆ·å,
    email user_email    -- ASå…³é”®å­—å¯çœç•¥
FROM users;
```

#### 2.1.2 æŸ¥è¯¢ä¿®é¥°ç¬¦è¯¦è§£


**DISTINCTå»é‡æŸ¥è¯¢**ï¼š
```sql
-- å•å­—æ®µå»é‡
SELECT DISTINCT department FROM employees;

-- å¤šå­—æ®µç»„åˆå»é‡
SELECT DISTINCT department, position FROM employees;

-- DISTINCTROWï¼ˆMySQLç‰¹æœ‰ï¼Œæ•ˆæœåŒDISTINCTï¼‰
SELECT DISTINCTROW department FROM employees;
```

> **ğŸ’¡ ä½¿ç”¨åœºæ™¯**ï¼šç»Ÿè®¡éƒ¨é—¨ç§ç±»ã€è·å–ä¸é‡å¤çš„å•†å“åˆ†ç±»ç­‰

**ä¼˜å…ˆçº§ä¿®é¥°ç¬¦**ï¼š
```sql
-- é«˜ä¼˜å…ˆçº§æŸ¥è¯¢ï¼ˆç´§æ€¥æŠ¥è¡¨ï¼‰
SELECT HIGH_PRIORITY * FROM orders WHERE status = 'pending';

-- ä½ä¼˜å…ˆçº§æŸ¥è¯¢ï¼ˆåå°ç»Ÿè®¡ï¼‰
SELECT LOW_PRIORITY * FROM access_logs;
```

#### 2.1.3 è®¡ç®—å­—æ®µä¸è¡¨è¾¾å¼


**æ•°å€¼è®¡ç®—è¡¨è¾¾å¼**ï¼š
```sql
-- åŸºç¡€ç®—æœ¯è¿ç®—
SELECT 
    product_name,
    price,
    quantity,
    price * quantity AS total_amount,           -- ä¹˜æ³•
    price * quantity * 0.9 AS discounted_total, -- æ‰“9æŠ˜
    quantity % 10 AS remainder                  -- å–æ¨¡è¿ç®—
FROM order_items;

-- ä½è¿ç®—æ“ä½œ
SELECT 
    permissions,
    permissions & 4 AS can_read,    -- æŒ‰ä½ä¸æ£€æŸ¥è¯»æƒé™
    permissions | 2 AS add_write    -- æŒ‰ä½æˆ–æ·»åŠ å†™æƒé™
FROM user_permissions;
```

**å­—ç¬¦ä¸²å¤„ç†è¡¨è¾¾å¼**ï¼š
```sql
SELECT 
    first_name,
    last_name,
    CONCAT(first_name, ' ', last_name) AS full_name,
    CONCAT_WS(' - ', department, position) AS dept_pos,
    UPPER(email) AS email_upper,
    SUBSTRING(phone, 1, 3) AS area_code
FROM employees;
```

**æ—¥æœŸæ—¶é—´è¡¨è¾¾å¼**ï¼š
```sql
SELECT 
    order_date,
    NOW() AS current_time,
    DATEDIFF(NOW(), order_date) AS days_ago,
    DATE_ADD(order_date, INTERVAL 30 DAY) AS payment_due,
    YEAR(order_date) AS order_year,
    DATE_FORMAT(order_date, '%Y-%m') AS order_month
FROM orders;
```

**æ¡ä»¶è¡¨è¾¾å¼**ï¼š
```sql
-- IFå‡½æ•°ï¼šç®€å•æ¡ä»¶åˆ¤æ–­
SELECT 
    product_name,
    stock_quantity,
    IF(stock_quantity > 10, 'å……è¶³', 'ç´§å¼ ') AS stock_status
FROM products;

-- CASEè¯­å¥ï¼šå¤šåˆ†æ”¯æ¡ä»¶
SELECT 
    student_name,
    score,
    CASE 
        WHEN score >= 90 THEN 'A'
        WHEN score >= 80 THEN 'B'
        WHEN score >= 70 THEN 'C'
        WHEN score >= 60 THEN 'D'
        ELSE 'F'
    END AS grade
FROM student_scores;

-- ç©ºå€¼å¤„ç†
SELECT 
    username,
    IFNULL(nickname, username) AS display_name,
    COALESCE(mobile, phone, email) AS contact
FROM users;
```

### 2.2 FROMå­å¥ä¸è¡¨å¼•ç”¨


#### 2.2.1 è¡¨å¼•ç”¨æ–¹å¼è¯¦è§£


**åŸºç¡€è¡¨å¼•ç”¨**ï¼š
```sql
-- å•è¡¨æŸ¥è¯¢
SELECT * FROM products;

-- è·¨æ•°æ®åº“æŸ¥è¯¢
SELECT * FROM shop_db.products;

-- è¡¨åˆ«åä½¿ç”¨
SELECT p.name, p.price 
FROM products AS p;  -- æ¨èå†™æ³•
FROM products p;     -- ç®€å†™å½¢å¼
```

**æ´¾ç”Ÿè¡¨æŸ¥è¯¢**ï¼š
```sql
-- å­æŸ¥è¯¢ä½œä¸ºä¸´æ—¶è¡¨
SELECT category, avg_price
FROM (
    SELECT category, AVG(price) AS avg_price
    FROM products
    GROUP BY category
) AS category_summary
WHERE avg_price > 100;
```

**åˆ†åŒºè¡¨æŸ¥è¯¢**ï¼š
```sql
-- æŒ‡å®šåˆ†åŒºæŸ¥è¯¢ï¼ˆæé«˜æ€§èƒ½ï¼‰
SELECT * FROM sales_2024 PARTITION(p_q1, p_q2);
```

### 2.3 WHEREæ¡ä»¶æŸ¥è¯¢å®Œæ•´è¯¦è§£


#### 2.3.1 æ¯”è¾ƒæ“ä½œç¬¦å…¨é›†


**åŸºç¡€æ¯”è¾ƒæ“ä½œ**ï¼š
```sql
-- ç­‰å€¼æ¯”è¾ƒ
SELECT * FROM users WHERE age = 25;
SELECT * FROM users WHERE status = 'active';

-- ä¸ç­‰å€¼æ¯”è¾ƒ
SELECT * FROM products WHERE price != 0;
SELECT * FROM products WHERE price <> 0;  -- æ ‡å‡†SQLå†™æ³•

-- èŒƒå›´æ¯”è¾ƒ
SELECT * FROM orders WHERE total_amount >= 100;
SELECT * FROM orders WHERE order_date < '2024-01-01';

-- NULLå®‰å…¨æ¯”è¾ƒï¼ˆé‡è¦ï¼ï¼‰
SELECT * FROM users WHERE last_login <=> NULL;  -- èƒ½æ­£ç¡®å¤„ç†NULLæ¯”è¾ƒ
```

> **âš ï¸ é‡è¦æ³¨æ„**ï¼šæ™®é€šçš„ `=` å’Œ `!=` é‡åˆ°NULLä¼šè¿”å›æœªçŸ¥ï¼Œè¦ç”¨ `IS NULL` æˆ– `<=>` å¤„ç†NULLå€¼

#### 2.3.2 é€»è¾‘æ“ä½œç¬¦è¯¦è§£


**é€»è¾‘è¿ç®—ç»„åˆ**ï¼š
```sql
-- ANDé€»è¾‘ä¸
SELECT * FROM products 
WHERE category = 'electronics' AND price > 500;

-- ORé€»è¾‘æˆ–
SELECT * FROM users 
WHERE status = 'premium' OR registration_date < '2023-01-01';

-- NOTé€»è¾‘é
SELECT * FROM products 
WHERE NOT (category = 'books' AND price < 20);

-- å¤æ‚é€»è¾‘ç»„åˆ
SELECT * FROM orders 
WHERE (status = 'paid' OR status = 'shipped') 
  AND total_amount > 100 
  AND customer_type = 'vip';
```

**é€»è¾‘è¿ç®—ä¼˜å…ˆçº§**ï¼š
```
è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. æ¯”è¾ƒæ“ä½œç¬¦ï¼ˆ=, <, >ç­‰ï¼‰
2. NOT
3. AND
4. OR
```

#### 2.3.3 èŒƒå›´ä¸é›†åˆæ“ä½œè¯¦è§£


**BETWEENèŒƒå›´æŸ¥è¯¢**ï¼š
```sql
-- æ•°å€¼èŒƒå›´ï¼ˆåŒ…å«è¾¹ç•Œå€¼ï¼‰
SELECT * FROM products WHERE price BETWEEN 100 AND 500;

-- æ—¥æœŸèŒƒå›´
SELECT * FROM orders 
WHERE order_date BETWEEN '2024-01-01' AND '2024-12-31';

-- å­—ç¬¦ä¸²èŒƒå›´
SELECT * FROM customers 
WHERE customer_name BETWEEN 'A' AND 'M';

-- éèŒƒå›´æŸ¥è¯¢
SELECT * FROM products WHERE price NOT BETWEEN 100 AND 500;
```

**INé›†åˆæŸ¥è¯¢**ï¼š
```sql
-- ç®€å•å€¼é›†åˆ
SELECT * FROM users WHERE department IN ('IT', 'Finance', 'HR');

-- æ•°å­—é›†åˆ
SELECT * FROM products WHERE category_id IN (1, 3, 5, 7);

-- å­æŸ¥è¯¢é›†åˆ
SELECT * FROM orders 
WHERE customer_id IN (
    SELECT customer_id FROM customers WHERE status = 'vip'
);

-- å¤šå­—æ®µé›†åˆåŒ¹é…
SELECT * FROM order_items 
WHERE (product_id, warehouse_id) IN ((101, 1), (102, 2), (103, 1));
```

> **ğŸ’¡ æ€§èƒ½æç¤º**ï¼šINæ“ä½œå¯¹äºå°‘é‡å€¼å¾ˆé«˜æ•ˆï¼Œå¤§é‡å€¼æ—¶è€ƒè™‘ç”¨JOINä»£æ›¿

#### 2.3.4 æ¨¡å¼åŒ¹é…è¯¦è§£


**LIKEæ¨¡å¼åŒ¹é…**ï¼š
```sql
-- å‰ç¼€åŒ¹é…
SELECT * FROM products WHERE product_name LIKE 'è‹¹æœ%';

-- åç¼€åŒ¹é…
SELECT * FROM files WHERE file_name LIKE '%.pdf';

-- åŒ…å«åŒ¹é…
SELECT * FROM customers WHERE address LIKE '%åŒ—äº¬%';

-- å•å­—ç¬¦é€šé…ç¬¦
SELECT * FROM products WHERE product_code LIKE 'A_001';  -- Aå¼€å¤´ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä»»æ„

-- è½¬ä¹‰å­—ç¬¦å¤„ç†
SELECT * FROM articles WHERE title LIKE '%100\%' ESCAPE '\';  -- æœç´¢åŒ…å«"100%"çš„æ ‡é¢˜
```

**æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…**ï¼š
```sql
-- åŸºç¡€æ­£åˆ™åŒ¹é…
SELECT * FROM users WHERE email REGEXP '^[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,}$';

-- æ•°å­—æ¨¡å¼åŒ¹é…
SELECT * FROM products WHERE product_code REGEXP '^[A-Z]{2}[0-9]{4}$';

-- å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
SELECT * FROM customers WHERE customer_name RLIKE '(?i)^john';
```

#### 2.3.5 ç©ºå€¼å¤„ç†è¯¦è§£


**NULLå€¼æŸ¥è¯¢**ï¼š
```sql
-- æŸ¥è¯¢ç©ºå€¼
SELECT * FROM users WHERE last_login IS NULL;

-- æŸ¥è¯¢éç©ºå€¼
SELECT * FROM orders WHERE shipping_address IS NOT NULL;

-- å‡½æ•°å¼ç©ºå€¼åˆ¤æ–­
SELECT * FROM products WHERE ISNULL(description);

-- ç©ºå€¼ä¼˜å…ˆçº§æ’åº
SELECT * FROM customers 
ORDER BY last_contact_date IS NULL, last_contact_date DESC;  -- éNULLå€¼ä¼˜å…ˆ
```

### 2.4 ORDER BYæ’åºå®Œæ•´è¯¦è§£


#### 2.4.1 åŸºç¡€æ’åºæ“ä½œ


**å•å­—æ®µæ’åº**ï¼š
```sql
-- å‡åºæ’åºï¼ˆé»˜è®¤ï¼‰
SELECT * FROM products ORDER BY price;
SELECT * FROM products ORDER BY price ASC;  -- æ˜¾å¼å‡åº

-- é™åºæ’åº
SELECT * FROM products ORDER BY price DESC;
```

**å¤šå­—æ®µæ’åº**ï¼š
```sql
-- å¤šå­—æ®µæ··åˆæ’åº
SELECT * FROM employees 
ORDER BY department ASC, salary DESC, hire_date ASC;
```

#### 2.4.2 é«˜çº§æ’åºæŠ€å·§


**å‡½æ•°ç»“æœæ’åº**ï¼š
```sql
-- æŒ‰è®¡ç®—ç»“æœæ’åº
SELECT product_name, price, stock_quantity,
       price * stock_quantity AS inventory_value
FROM products 
ORDER BY inventory_value DESC;

-- æŒ‰å­—ç¬¦ä¸²é•¿åº¦æ’åº
SELECT customer_name 
FROM customers 
ORDER BY LENGTH(customer_name), customer_name;
```

**è‡ªå®šä¹‰æ’åºè§„åˆ™**ï¼š
```sql
-- FIELDå‡½æ•°è‡ªå®šä¹‰é¡ºåº
SELECT * FROM tasks 
ORDER BY FIELD(priority, 'urgent', 'high', 'medium', 'low');

-- CASEè¡¨è¾¾å¼æ’åº
SELECT * FROM orders 
ORDER BY 
    CASE status 
        WHEN 'pending' THEN 1
        WHEN 'processing' THEN 2 
        WHEN 'shipped' THEN 3
        WHEN 'delivered' THEN 4
        ELSE 5
    END;
```

**ç©ºå€¼æ’åºæ§åˆ¶**ï¼š
```sql
-- ç©ºå€¼æ’åœ¨æœ€å
SELECT * FROM customers 
ORDER BY last_contact_date IS NULL, last_contact_date DESC;

-- ç©ºå€¼æ’åœ¨æœ€å‰
SELECT * FROM products 
ORDER BY discount_rate IS NULL DESC, discount_rate;
```

**éšæœºæ’åº**ï¼š
```sql
-- éšæœºè·å–è®°å½•ï¼ˆå°æ•°æ®é‡ä½¿ç”¨ï¼‰
SELECT * FROM articles ORDER BY RAND() LIMIT 5;
```

### 2.5 GROUP BYåˆ†ç»„è¯¦è§£


#### 2.5.1 åŸºç¡€åˆ†ç»„æ“ä½œ


**å•å­—æ®µåˆ†ç»„**ï¼š
```sql
-- æŒ‰éƒ¨é—¨ç»Ÿè®¡äººæ•°
SELECT department, COUNT(*) AS employee_count
FROM employees 
GROUP BY department;

-- æŒ‰çŠ¶æ€ç»Ÿè®¡è®¢å•
SELECT status, COUNT(*) AS order_count, SUM(total_amount) AS total_sales
FROM orders 
GROUP BY status;
```

**å¤šå­—æ®µåˆ†ç»„**ï¼š
```sql
-- æŒ‰å¹´æœˆç»Ÿè®¡é”€å”®é¢
SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_sales
FROM orders 
GROUP BY YEAR(order_date), MONTH(order_date)
ORDER BY year, month;
```

#### 2.5.2 æ±‡æ€»åˆ†ç»„WITH ROLLUP


**åˆ†çº§æ±‡æ€»**ï¼š
```sql
-- éƒ¨é—¨å’Œæ€»è®¡æ±‡æ€»
SELECT 
    IFNULL(department, 'æ€»è®¡') AS department,
    COUNT(*) AS employee_count,
    AVG(salary) AS avg_salary
FROM employees 
GROUP BY department WITH ROLLUP;

-- å¤šçº§æ±‡æ€»
SELECT 
    IFNULL(category, 'æ‰€æœ‰åˆ†ç±»') AS category,
    IFNULL(brand, 'æ‰€æœ‰å“ç‰Œ') AS brand,
    COUNT(*) AS product_count,
    AVG(price) AS avg_price
FROM products 
GROUP BY category, brand WITH ROLLUP;
```

#### 2.5.3 å¸¸ç”¨èšåˆå‡½æ•°


**æ•°å€¼èšåˆå‡½æ•°**ï¼š
```sql
SELECT 
    category,
    COUNT(*) AS product_count,           -- è®¡æ•°
    COUNT(DISTINCT brand) AS brand_count, -- å»é‡è®¡æ•°
    SUM(stock_quantity) AS total_stock,  -- æ±‚å’Œ
    AVG(price) AS average_price,         -- å¹³å‡å€¼
    MIN(price) AS min_price,            -- æœ€å°å€¼
    MAX(price) AS max_price,            -- æœ€å¤§å€¼
    STDDEV(price) AS price_stddev       -- æ ‡å‡†å·®
FROM products 
GROUP BY category;
```

**å­—ç¬¦ä¸²èšåˆå‡½æ•°**ï¼š
```sql
-- GROUP_CONCATï¼šå°†åˆ†ç»„å†…çš„å€¼è¿æ¥æˆå­—ç¬¦ä¸²
SELECT 
    department,
    GROUP_CONCAT(employee_name) AS employees,
    GROUP_CONCAT(DISTINCT position ORDER BY position SEPARATOR ' | ') AS positions
FROM employees 
GROUP BY department;
```

### 2.6 HAVINGåˆ†ç»„è¿‡æ»¤è¯¦è§£


**HAVING vs WHERE**ï¼š
```
WHEREå’ŒHAVINGçš„åŒºåˆ«ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¯”è¾ƒé¡¹ç›®    â”‚ WHERE            â”‚ HAVING           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿‡æ»¤æ—¶æœº    â”‚ åˆ†ç»„å‰è¿‡æ»¤       â”‚ åˆ†ç»„åè¿‡æ»¤       â”‚
â”‚ è¿‡æ»¤å¯¹è±¡    â”‚ åŸå§‹è®°å½•         â”‚ åˆ†ç»„ç»“æœ         â”‚
â”‚ å¯ç”¨å‡½æ•°    â”‚ ä¸èƒ½ç”¨èšåˆå‡½æ•°   â”‚ å¯ä»¥ç”¨èšåˆå‡½æ•°   â”‚
â”‚ æ€§èƒ½        â”‚ æ›´é«˜æ•ˆ           â”‚ ç›¸å¯¹è¾ƒæ…¢         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**HAVINGä½¿ç”¨å®ä¾‹**ï¼š
```sql
-- ç­›é€‰å‘˜å·¥æ•°è¶…è¿‡5äººçš„éƒ¨é—¨
SELECT department, COUNT(*) AS employee_count
FROM employees 
GROUP BY department
HAVING COUNT(*) > 5;

-- ç­›é€‰å¹³å‡å·¥èµ„é«˜äº8000ä¸”æœ€é«˜å·¥èµ„è¶…è¿‡15000çš„éƒ¨é—¨
SELECT 
    department,
    COUNT(*) AS employee_count,
    AVG(salary) AS avg_salary,
    MAX(salary) AS max_salary
FROM employees 
GROUP BY department
HAVING AVG(salary) > 8000 AND MAX(salary) > 15000;

-- å¤æ‚HAVINGæ¡ä»¶
SELECT 
    customer_id,
    COUNT(*) AS order_count,
    SUM(total_amount) AS total_spent
FROM orders 
WHERE order_date >= '2024-01-01'
GROUP BY customer_id
HAVING COUNT(*) >= 5 AND SUM(total_amount) > 10000
ORDER BY total_spent DESC;
```

### 2.7 LIMITåˆ†é¡µè¯¦è§£


#### 2.7.1 åŸºç¡€é™åˆ¶è¯­æ³•


**ç®€å•é™åˆ¶**ï¼š
```sql
-- åªå–å‰10æ¡è®°å½•
SELECT * FROM products ORDER BY created_at DESC LIMIT 10;

-- åˆ†é¡µæŸ¥è¯¢ï¼šè·³è¿‡å‰20æ¡ï¼Œå–10æ¡
SELECT * FROM products ORDER BY id LIMIT 20, 10;

-- OFFSETè¯­æ³•ï¼ˆæ›´æ¸…æ™°ï¼‰
SELECT * FROM products ORDER BY id LIMIT 10 OFFSET 20;
```

#### 2.7.2 åˆ†é¡µä¼˜åŒ–æŠ€å·§


**æ¸¸æ ‡åˆ†é¡µï¼ˆæ¨èï¼‰**ï¼š
```sql
-- åŸºäºIDçš„æ¸¸æ ‡åˆ†é¡µï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
SELECT * FROM products 
WHERE id > 12345  -- ä¸Šä¸€é¡µçš„æœ€åä¸€ä¸ªID
ORDER BY id 
LIMIT 10;

-- åŸºäºæ—¶é—´çš„æ¸¸æ ‡åˆ†é¡µ
SELECT * FROM articles 
WHERE created_at < '2024-09-10 10:30:00'  -- ä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„æ—¶é—´
ORDER BY created_at DESC 
LIMIT 10;
```

**å¤§åç§»é‡ä¼˜åŒ–**ï¼š
```sql
-- é—®é¢˜ï¼šæ·±åº¦åˆ†é¡µæ€§èƒ½å·®
SELECT * FROM large_table ORDER BY id LIMIT 100000, 10;  -- æ…¢

-- ä¼˜åŒ–ï¼šå…ˆæŸ¥IDå†å…³è”
SELECT t.* 
FROM (
    SELECT id FROM large_table ORDER BY id LIMIT 100000, 10
) temp 
JOIN large_table t ON temp.id = t.id;  -- å¿«
```

### 2.8 å­æŸ¥è¯¢å®Œæ•´åº”ç”¨è¯¦è§£


#### 2.8.1 æ ‡é‡å­æŸ¥è¯¢


**ç›¸å…³æ ‡é‡å­æŸ¥è¯¢**ï¼š
```sql
-- æŸ¥è¯¢æ¯ä¸ªå®¢æˆ·çš„è®¢å•æ•°é‡
SELECT 
    customer_name,
    email,
    (SELECT COUNT(*) 
     FROM orders o 
     WHERE o.customer_id = c.customer_id) AS order_count
FROM customers c;

-- æŸ¥è¯¢é«˜äºå¹³å‡ä»·æ ¼çš„äº§å“
SELECT product_name, price
FROM products 
WHERE price > (SELECT AVG(price) FROM products);
```

#### 2.8.2 åˆ—å­æŸ¥è¯¢


**INå­æŸ¥è¯¢**ï¼š
```sql
-- æŸ¥è¯¢æœ‰è®¢å•çš„å®¢æˆ·
SELECT * FROM customers 
WHERE customer_id IN (
    SELECT DISTINCT customer_id FROM orders
);

-- æŸ¥è¯¢è´­ä¹°è¿‡ç”µå­äº§å“çš„å®¢æˆ·
SELECT * FROM customers 
WHERE customer_id IN (
    SELECT DISTINCT o.customer_id 
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE p.category = 'electronics'
);
```

**ANY/ALLå­æŸ¥è¯¢**ï¼š
```sql
-- ä»·æ ¼é«˜äºä»»æ„ç”µå­äº§å“çš„å•†å“
SELECT * FROM products 
WHERE price > ANY (
    SELECT price FROM products WHERE category = 'electronics'
);

-- ä»·æ ¼é«˜äºæ‰€æœ‰ä¹¦ç±çš„å•†å“
SELECT * FROM products 
WHERE price > ALL (
    SELECT price FROM products WHERE category = 'books'
);
```

#### 2.8.3 EXISTSå­æŸ¥è¯¢


**å­˜åœ¨æ€§æ£€æŸ¥**ï¼š
```sql
-- æŸ¥è¯¢æœ‰è®¢å•çš„å®¢æˆ·ï¼ˆæ¨èå†™æ³•ï¼Œæ€§èƒ½å¥½ï¼‰
SELECT * FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o WHERE o.customer_id = c.customer_id
);

-- æŸ¥è¯¢æ²¡æœ‰è®¢å•çš„å®¢æˆ·
SELECT * FROM customers c
WHERE NOT EXISTS (
    SELECT 1 FROM orders o WHERE o.customer_id = c.customer_id
);

-- å¤æ‚EXISTSæŸ¥è¯¢
SELECT * FROM products p
WHERE EXISTS (
    SELECT 1 FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE oi.product_id = p.product_id 
      AND o.order_date >= '2024-01-01'
      AND o.status = 'completed'
);
```

#### 2.8.4 æ´¾ç”Ÿè¡¨æŸ¥è¯¢


**å­æŸ¥è¯¢ä½œä¸ºæ•°æ®æº**ï¼š
```sql
-- æŸ¥è¯¢å„éƒ¨é—¨å¹³å‡å·¥èµ„é«˜äº8000çš„éƒ¨é—¨è¯¦æƒ…
SELECT dept_summary.*, d.department_name, d.location
FROM (
    SELECT 
        department_id,
        COUNT(*) AS employee_count,
        AVG(salary) AS avg_salary,
        MAX(salary) AS max_salary
    FROM employees 
    GROUP BY department_id
    HAVING AVG(salary) > 8000
) dept_summary
JOIN departments d ON dept_summary.department_id = d.department_id;
```

### 2.9 è¿æ¥æŸ¥è¯¢å®Œæ•´è¯¦è§£


#### 2.9.1 å†…è¿æ¥INNER JOIN


**åŸºç¡€å†…è¿æ¥**ï¼š
```sql
-- æ ‡å‡†å†…è¿æ¥è¯­æ³•
SELECT c.customer_name, o.order_date, o.total_amount
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id;

-- JOINç®€å†™ï¼ˆé»˜è®¤æ˜¯INNER JOINï¼‰
SELECT p.product_name, c.category_name
FROM products p
JOIN categories c ON p.category_id = c.category_id;
```

**å¤šæ¡ä»¶è¿æ¥**ï¼š
```sql
-- å¤åˆè¿æ¥æ¡ä»¶
SELECT e.employee_name, d.department_name
FROM employees e
JOIN departments d ON e.department_id = d.department_id 
                   AND e.status = 'active' 
                   AND d.status = 'active';
```

#### 2.9.2 å¤–è¿æ¥LEFT/RIGHT JOIN


**å·¦å¤–è¿æ¥åº”ç”¨**ï¼š
```sql
-- æ˜¾ç¤ºæ‰€æœ‰å®¢æˆ·ï¼ˆåŒ…æ‹¬æ²¡æœ‰è®¢å•çš„ï¼‰
SELECT 
    c.customer_name,
    COALESCE(o.order_count, 0) AS order_count,
    COALESCE(o.total_spent, 0) AS total_spent
FROM customers c
LEFT JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_spent
    FROM orders 
    GROUP BY customer_id
) o ON c.customer_id = o.customer_id;

-- æŸ¥æ‰¾å­¤ç«‹è®°å½•
SELECT c.* FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
WHERE o.customer_id IS NULL;  -- æ²¡æœ‰è®¢å•çš„å®¢æˆ·
```

#### 2.9.3 å¤šè¡¨è¿æ¥


**é“¾å¼è¿æ¥**ï¼š
```sql
-- ä¸‰è¡¨è¿æ¥æŸ¥è¯¢
SELECT 
    c.customer_name,
    o.order_date,
    p.product_name,
    oi.quantity,
    oi.unit_price
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= '2024-01-01';
```

**å¤æ‚å¤šè¡¨è¿æ¥**ï¼š
```sql
-- å‘˜å·¥-éƒ¨é—¨-é¡¹ç›®å¤šè¡¨è¿æ¥
SELECT 
    e.employee_name,
    d.department_name,
    p.project_name,
    ep.role,
    ep.start_date
FROM employees e
JOIN departments d ON e.department_id = d.department_id
JOIN employee_projects ep ON e.employee_id = ep.employee_id
JOIN projects p ON ep.project_id = p.project_id
WHERE e.status = 'active' AND p.status = 'ongoing';
```

#### 2.9.4 ç‰¹æ®Šè¿æ¥ç±»å‹


**è‡ªè¿æ¥**ï¼š
```sql
-- æŸ¥è¯¢å‘˜å·¥åŠå…¶ç›´æ¥ä¸Šçº§
SELECT 
    e.employee_name AS employee,
    m.employee_name AS manager
FROM employees e
LEFT JOIN employees m ON e.manager_id = m.employee_id;

-- æŸ¥æ‰¾åŒéƒ¨é—¨åŒäº‹
SELECT 
    e1.employee_name AS employee1,
    e2.employee_name AS employee2,
    e1.department_id
FROM employees e1
JOIN employees e2 ON e1.department_id = e2.department_id 
                 AND e1.employee_id < e2.employee_id;  -- é¿å…é‡å¤å’Œè‡ªå·±
```

**äº¤å‰è¿æ¥CROSS JOIN**ï¼š
```sql
-- ç”Ÿæˆæ‰€æœ‰ç»„åˆï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
SELECT s.size_name, c.color_name
FROM product_sizes s
CROSS JOIN product_colors c;
```

### 2.10 è”åˆæŸ¥è¯¢UNIONè¯¦è§£


#### 2.10.1 åŸºç¡€è”åˆæ“ä½œ


**UNION vs UNION ALL**ï¼š
```sql
-- UNIONï¼šè‡ªåŠ¨å»é‡ï¼ˆæ€§èƒ½ç¨æ…¢ï¼‰
SELECT customer_id, 'customer' AS type FROM customers
UNION
SELECT supplier_id, 'supplier' AS type FROM suppliers;

-- UNION ALLï¼šä¿ç•™æ‰€æœ‰è®°å½•ï¼ˆæ€§èƒ½æ›´å¥½ï¼‰
SELECT product_name FROM products WHERE category = 'electronics'
UNION ALL
SELECT product_name FROM products WHERE status = 'new';
```

#### 2.10.2 å¤æ‚è”åˆæŸ¥è¯¢


**å¸¦æ¡ä»¶çš„è”åˆ**ï¼š
```sql
(SELECT 
    customer_id, 
    customer_name, 
    'VIP' AS customer_type,
    total_orders
FROM customer_summary 
WHERE total_orders > 100)

UNION

(SELECT 
    customer_id, 
    customer_name, 
    'Regular' AS customer_type,
    total_orders
FROM customer_summary 
WHERE total_orders <= 100)

ORDER BY total_orders DESC;  -- è”åˆåç»Ÿä¸€æ’åº
```

### 2.11 çª—å£å‡½æ•°è¯¦è§£ï¼ˆMySQL 8.0+ï¼‰


#### 2.11.1 æ’åçª—å£å‡½æ•°


**åŸºç¡€æ’åå‡½æ•°**ï¼š
```sql
-- å„ç§æ’åå‡½æ•°å¯¹æ¯”
SELECT 
    student_name,
    score,
    ROW_NUMBER() OVER(ORDER BY score DESC) AS row_num,      -- 1,2,3,4,5
    RANK() OVER(ORDER BY score DESC) AS rank_num,          -- 1,2,2,4,5
    DENSE_RANK() OVER(ORDER BY score DESC) AS dense_rank   -- 1,2,2,3,4
FROM student_scores;
```

**åˆ†åŒºæ’å**ï¼š
```sql
-- å„ç§‘ç›®å†…æ’å
SELECT 
    student_name,
    subject,
    score,
    RANK() OVER(PARTITION BY subject ORDER BY score DESC) AS subject_rank,
    PERCENT_RANK() OVER(PARTITION BY subject ORDER BY score DESC) AS percentile
FROM student_scores;

-- åˆ†æ¡¶ç»Ÿè®¡
SELECT 
    product_name,
    price,
    NTILE(4) OVER(ORDER BY price) AS price_quartile  -- åˆ†æˆ4ç»„
FROM products;
```

#### 2.11.2 å€¼è®¿é—®çª—å£å‡½æ•°


**LAG/LEADå‡½æ•°**ï¼š
```sql
-- å¯¹æ¯”ç›¸é‚»è®°å½•
SELECT 
    order_date,
    daily_sales,
    LAG(daily_sales, 1) OVER(ORDER BY order_date) AS prev_day_sales,
    LEAD(daily_sales, 1) OVER(ORDER BY order_date) AS next_day_sales,
    daily_sales - LAG(daily_sales, 1) OVER(ORDER BY order_date) AS sales_change
FROM daily_sales_summary;

-- åŒæ¯”åˆ†æ
SELECT 
    month,
    sales,
    LAG(sales, 12) OVER(ORDER BY month) AS last_year_same_month,
    (sales - LAG(sales, 12) OVER(ORDER BY month)) / LAG(sales, 12) OVER(ORDER BY month) * 100 AS yoy_growth
FROM monthly_sales;
```

**FIRST_VALUE/LAST_VALUEå‡½æ•°**ï¼š
```sql
-- åˆ†ç»„å†…ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå€¼
SELECT 
    department,
    employee_name,
    salary,
    FIRST_VALUE(employee_name) OVER(PARTITION BY department ORDER BY salary DESC) AS highest_paid,
    LAST_VALUE(employee_name) OVER(
        PARTITION BY department 
        ORDER BY salary DESC 
        ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
    ) AS lowest_paid
FROM employees;
```

#### 2.11.3 èšåˆçª—å£å‡½æ•°


**ç´¯ç§¯è®¡ç®—**ï¼š
```sql
-- ç´¯ç§¯æ±‚å’Œ
SELECT 
    order_date,
    daily_revenue,
    SUM(daily_revenue) OVER(ORDER BY order_date) AS running_total,
    AVG(daily_revenue) OVER(
        ORDER BY order_date 
        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
    ) AS week_moving_avg
FROM daily_revenue;
```

**åˆ†ç»„å æ¯”è®¡ç®—**ï¼š
```sql
-- å„éƒ¨é—¨å·¥èµ„å æ¯”
SELECT 
    department,
    employee_name,
    salary,
    SUM(salary) OVER(PARTITION BY department) AS dept_total_salary,
    salary / SUM(salary) OVER(PARTITION BY department) * 100 AS salary_percentage
FROM employees;
```

#### 2.11.4 çª—å£æ¡†æ¶è¯¦è§£


**ROWS vs RANGE**ï¼š
```sql
-- ROWSæ¡†æ¶ï¼šåŸºäºç‰©ç†è¡Œæ•°
SELECT 
    order_date,
    amount,
    SUM(amount) OVER(
        ORDER BY order_date 
        ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING
    ) AS sum_5_rows
FROM orders;

-- RANGEæ¡†æ¶ï¼šåŸºäºå€¼èŒƒå›´
SELECT 
    order_date,
    amount,
    SUM(amount) OVER(
        ORDER BY order_date 
        RANGE BETWEEN INTERVAL 7 DAY PRECEDING AND CURRENT ROW
    ) AS sum_last_week
FROM daily_orders;
```

### 2.12 å…¬ç”¨è¡¨è¡¨è¾¾å¼CTEè¯¦è§£ï¼ˆMySQL 8.0+ï¼‰


#### 2.12.1 éé€’å½’CTE


**åŸºç¡€CTEä½¿ç”¨**ï¼š
```sql
-- å®šä¹‰å’Œä½¿ç”¨CTE
WITH high_value_customers AS (
    SELECT customer_id, customer_name, total_orders, total_spent
    FROM customer_summary 
    WHERE total_spent > 10000
),
recent_orders AS (
    SELECT order_id, customer_id, order_date, total_amount
    FROM orders 
    WHERE order_date >= DATE_SUB(NOW(), INTERVAL 30 DAY)
)
SELECT 
    hvc.customer_name,
    COUNT(ro.order_id) AS recent_order_count,
    SUM(ro.total_amount) AS recent_total
FROM high_value_customers hvc
LEFT JOIN recent_orders ro ON hvc.customer_id = ro.customer_id
GROUP BY hvc.customer_id, hvc.customer_name;
```

#### 2.12.2 é€’å½’CTE


**ç»„ç»‡æ¶æ„æŸ¥è¯¢**ï¼š
```sql
-- é€’å½’æŸ¥è¯¢ç»„ç»‡ç»“æ„
WITH RECURSIVE employee_hierarchy AS (
    -- é”šç‚¹ï¼šé¡¶çº§å‘˜å·¥ï¼ˆCEOï¼‰
    SELECT 
        employee_id,
        employee_name,
        manager_id,
        employee_name AS path,
        0 AS level
    FROM employees 
    WHERE manager_id IS NULL
    
    UNION ALL
    
    -- é€’å½’éƒ¨åˆ†ï¼šä¸‹çº§å‘˜å·¥
    SELECT 
        e.employee_id,
        e.employee_name,
        e.manager_id,
        CONCAT(eh.path, ' -> ', e.employee_name) AS path,
        eh.level + 1 AS level
    FROM employees e
    INNER JOIN employee_hierarchy eh ON e.manager_id = eh.employee_id
    WHERE eh.level < 10  -- é˜²æ­¢æ— é™é€’å½’
)
SELECT * FROM employee_hierarchy 
ORDER BY level, path;
```

**æ•°å­—åºåˆ—ç”Ÿæˆ**ï¼š
```sql
-- ç”Ÿæˆæ—¥æœŸåºåˆ—
WITH RECURSIVE date_series AS (
    SELECT DATE('2024-01-01') AS date
    UNION ALL
    SELECT DATE_ADD(date, INTERVAL 1 DAY)
    FROM date_series 
    WHERE date < '2024-12-31'
)
SELECT 
    ds.date,
    COALESCE(os.order_count, 0) AS order_count,
    COALESCE(os.total_sales, 0) AS total_sales
FROM date_series ds
LEFT JOIN (
    SELECT 
        DATE(order_date) AS order_date,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_sales
    FROM orders 
    GROUP BY DATE(order_date)
) os ON ds.date = os.order_date;
```

---

## 3. ğŸ“ INSERTæ’å…¥è¯­å¥å®Œæ•´ä½“ç³»


### 3.1 åŸºç¡€æ’å…¥è¯­æ³•è¯¦è§£


#### 3.1.1 æ ‡å‡†æ’å…¥è¯­æ³•


**åŸºæœ¬INSERTç»“æ„**ï¼š
```sql
-- æ ‡å‡†æ’å…¥è¯­æ³•ï¼ˆæ¨èï¼‰
INSERT INTO users (username, email, password, created_at)
VALUES ('john_doe', 'john@example.com', 'hashed_password', NOW());

-- å…¨å­—æ®µæ’å…¥ï¼ˆéœ€è¦æŒ‰è¡¨ç»“æ„é¡ºåºï¼‰
INSERT INTO users 
VALUES (NULL, 'jane_doe', 'jane@example.com', 'hashed_password', NOW(), NOW());

-- SETè¯­æ³•æ’å…¥ï¼ˆå­—æ®µé¡ºåºæ— å…³ï¼‰
INSERT INTO users 
SET username = 'mike_smith',
    email = 'mike@example.com',
    password = 'hashed_password',
    created_at = NOW();
```

#### 3.1.2 æ‰¹é‡æ’å…¥


**å¤šè¡Œæ’å…¥**ï¼š
```sql
-- æ‰¹é‡æ’å…¥å¤šè¡Œï¼ˆæ¨èæ–¹å¼ï¼Œæ€§èƒ½å¥½ï¼‰
INSERT INTO products (product_name, category_id, price, stock_quantity)
VALUES 
    ('iPhone 15', 1, 999.00, 50),
    ('Samsung Galaxy', 1, 899.00, 30),
    ('Google Pixel', 1, 799.00, 25),
    ('OnePlus 12', 1, 699.00, 40);

-- ä»å…¶ä»–è¡¨æ‰¹é‡æ’å…¥
INSERT INTO product_backup (product_id, product_name, price)
SELECT product_id, product_name, price 
FROM products 
WHERE status = 'discontinued';
```

> **âš¡ æ€§èƒ½æç¤º**ï¼šæ‰¹é‡æ’å…¥æ¯”é€è¡Œæ’å…¥å¿«å‡ åå€ï¼Œå»ºè®®æ¯æ‰¹å¤„ç†1000-5000è¡Œ

#### 3.1.3 æ’å…¥ä¿®é¥°ç¬¦


**ä¼˜å…ˆçº§æ§åˆ¶**ï¼š
```sql
-- ä½ä¼˜å…ˆçº§æ’å…¥ï¼ˆä¸é˜»å¡SELECTï¼‰
INSERT LOW_PRIORITY INTO access_logs (user_id, action, timestamp)
VALUES (1001, 'login', NOW());

-- é«˜ä¼˜å…ˆçº§æ’å…¥ï¼ˆä¼˜å…ˆå¤„ç†ï¼‰
INSERT HIGH_PRIORITY INTO urgent_notifications (user_id, message, created_at)
VALUES (1001, 'ç´§æ€¥é€šçŸ¥å†…å®¹', NOW());
```

### 3.2 æŸ¥è¯¢ç»“æœæ’å…¥è¯¦è§£


**SELECT INTO INSERT**ï¼š
```sql
-- åŸºç¡€æŸ¥è¯¢æ’å…¥
INSERT INTO monthly_sales_summary (year, month, total_sales, order_count)
SELECT 
    YEAR(order_date) AS year,
    MONTH(order_date) AS month,
    SUM(total_amount) AS total_sales,
    COUNT(*) AS order_count
FROM orders 
WHERE order_date >= '2024-01-01'
GROUP BY YEAR(order_date), MONTH(order_date);

-- å¤æ‚æŸ¥è¯¢æ’å…¥
INSERT INTO customer_segments (customer_id, segment, last_order_date, total_spent)
SELECT 
    c.customer_id,
    CASE 
        WHEN summary.total_spent > 10000 THEN 'VIP'
        WHEN summary.total_spent > 5000 THEN 'Premium'
        WHEN summary.total_spent > 1000 THEN 'Regular'
        ELSE 'Basic'
    END AS segment,
    summary.last_order_date,
    summary.total_spent
FROM customers c
JOIN (
    SELECT 
        customer_id,
        MAX(order_date) AS last_order_date,
        SUM(total_amount) AS total_spent
    FROM orders 
    GROUP BY customer_id
) summary ON c.customer_id = summary.customer_id;
```

### 3.3 å†²çªå¤„ç†ä¸UPSERTè¯¦è§£


#### 3.3.1 IGNOREæ’å…¥


**å¿½ç•¥é”™è¯¯æ’å…¥**ï¼š
```sql
-- å¿½ç•¥é‡å¤é”®é”™è¯¯
INSERT IGNORE INTO user_preferences (user_id, preference_key, preference_value)
VALUES 
    (1001, 'theme', 'dark'),
    (1001, 'language', 'zh-CN'),  -- å¦‚æœå·²å­˜åœ¨åˆ™å¿½ç•¥
    (1002, 'theme', 'light');

-- æ‰¹é‡æ’å…¥æ—¶å¿½ç•¥é”™è¯¯
INSERT IGNORE INTO product_tags (product_id, tag_name)
SELECT DISTINCT p.product_id, t.tag_name
FROM products p
CROSS JOIN tags t
WHERE p.category_id = t.category_id;
```

#### 3.3.2 ON DUPLICATE KEY UPDATEè¯¦è§£


**æ™ºèƒ½UPSERTæ“ä½œ**ï¼š
```sql
-- åŸºç¡€UPSERTï¼šæ’å…¥æˆ–æ›´æ–°
INSERT INTO user_stats (user_id, login_count, last_login)
VALUES (1001, 1, NOW())
ON DUPLICATE KEY UPDATE 
    login_count = login_count + 1,
    last_login = NOW();

-- VALUES()å‡½æ•°å¼•ç”¨æ–°å€¼
INSERT INTO inventory (product_id, warehouse_id, quantity, updated_at)
VALUES (101, 1, 50, NOW())
ON DUPLICATE KEY UPDATE 
    quantity = quantity + VALUES(quantity),  -- ç´¯åŠ æ–°æ•°é‡
    updated_at = VALUES(updated_at);         -- ä½¿ç”¨æ–°çš„æ—¶é—´æˆ³

-- æ¡ä»¶æ€§æ›´æ–°
INSERT INTO product_prices (product_id, price, effective_date)
VALUES (101, 299.99, '2024-09-10')
ON DUPLICATE KEY UPDATE 
    price = IF(VALUES(effective_date) > effective_date, 
               VALUES(price), 
               price),  -- åªæœ‰æ–°æ—¥æœŸæ›´æ™šæ‰æ›´æ–°ä»·æ ¼
    effective_date = IF(VALUES(effective_date) > effective_date,
                        VALUES(effective_date),
                        effective_date);
```

**å¤æ‚ä¸šåŠ¡åœºæ™¯UPSERT**ï¼š
```sql
-- ç”¨æˆ·ç§¯åˆ†ç´¯ç§¯
INSERT INTO user_points (user_id, points, earned_date, source)
VALUES (1001, 100, CURDATE(), 'purchase')
ON DUPLICATE KEY UPDATE 
    points = points + VALUES(points),
    last_earned_date = VALUES(earned_date),
    total_transactions = total_transactions + 1;
```

#### 3.3.3 REPLACEè¯­å¥è¯¦è§£


**æ›¿æ¢æ’å…¥**ï¼š
```sql
-- REPLACEåŸºæœ¬ç”¨æ³•ï¼ˆå…ˆåˆ é™¤å†æ’å…¥ï¼‰
REPLACE INTO user_settings (user_id, setting_name, setting_value)
VALUES (1001, 'notification', 'enabled');

-- æ‰¹é‡REPLACE
REPLACE INTO daily_statistics (date, metric_name, metric_value)
SELECT 
    CURDATE() AS date,
    'total_orders' AS metric_name,
    COUNT(*) AS metric_value
FROM orders 
WHERE DATE(order_date) = CURDATE()

UNION ALL

SELECT 
    CURDATE(),
    'total_revenue',
    SUM(total_amount)
FROM orders 
WHERE DATE(order_date) = CURDATE();
```

> **âš ï¸ é‡è¦æ³¨æ„**ï¼šREPLACEä¼šåˆ é™¤æ•´è¡Œå†æ’å…¥ï¼Œä¼šè§¦å‘DELETEè§¦å‘å™¨ï¼Œè°¨æ…ä½¿ç”¨

### 3.4 æ•°æ®å¯¼å…¥LOAD DATAè¯¦è§£


#### 3.4.1 åŸºç¡€æ–‡ä»¶å¯¼å…¥


**CSVæ–‡ä»¶å¯¼å…¥**ï¼š
```sql
-- åŸºæœ¬æ–‡ä»¶å¯¼å…¥
LOAD DATA INFILE '/data/products.csv'
INTO TABLE products
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;  -- è·³è¿‡è¡¨å¤´

-- æœ¬åœ°æ–‡ä»¶å¯¼å…¥
LOAD DATA LOCAL INFILE '/local/path/users.csv'
INTO TABLE users
FIELDS TERMINATED BY ','
ESCAPED BY '\\'
LINES TERMINATED BY '\r\n';
```

#### 3.4.2 é«˜çº§å¯¼å…¥æ§åˆ¶


**å­—æ®µæ˜ å°„ä¸å¤„ç†**ï¼š
```sql
-- å­—æ®µæ˜ å°„å’Œè½¬æ¢
LOAD DATA INFILE '/data/orders.csv'
INTO TABLE orders
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(order_id, customer_id, @order_total, @order_date, status)
SET 
    total_amount = @order_total * 1.1,  -- åŠ ä¸Šç¨è´¹
    order_date = STR_TO_DATE(@order_date, '%m/%d/%Y'),
    created_at = NOW();

-- æ¡ä»¶æ€§å¯¼å…¥
LOAD DATA INFILE '/data/products.csv'
INTO TABLE products
FIELDS TERMINATED BY ','
(product_name, category, @price, @stock)
SET 
    price = IF(@price > 0, @price, NULL),
    stock_quantity = IF(@stock >= 0, @stock, 0),
    status = IF(@price > 0, 'active', 'inactive');
```

**å¯¼å…¥æ¨¡å¼æ§åˆ¶**ï¼š
```sql
-- æ›¿æ¢æ¨¡å¼å¯¼å…¥
LOAD DATA INFILE '/data/config.csv'
REPLACE INTO TABLE system_config
FIELDS TERMINATED BY ','
(config_key, config_value, description);

-- å¿½ç•¥æ¨¡å¼å¯¼å…¥
LOAD DATA INFILE '/data/users.csv'
IGNORE INTO TABLE users
FIELDS TERMINATED BY ','
(username, email, phone);
```

---

## 4. ğŸ”„ UPDATEæ›´æ–°è¯­å¥å®Œæ•´ä½“ç³»


### 4.1 å•è¡¨æ›´æ–°è¯¦è§£


#### 4.1.1 åŸºç¡€æ›´æ–°æ“ä½œ


**ç®€å•å­—æ®µæ›´æ–°**ï¼š
```sql
-- å•å­—æ®µæ›´æ–°
UPDATE users 
SET last_login = NOW() 
WHERE user_id = 1001;

-- å¤šå­—æ®µæ›´æ–°
UPDATE products 
SET price = 199.99,
    stock_quantity = 100,
    updated_at = NOW()
WHERE product_id = 101;
```

**æ‰¹é‡æ›´æ–°**ï¼š
```sql
-- æ¡ä»¶æ‰¹é‡æ›´æ–°
UPDATE orders 
SET status = 'shipped',
    shipped_date = NOW(),
    tracking_number = CONCAT('TRK', LPAD(order_id, 10, '0'))
WHERE status = 'processing' 
  AND payment_status = 'paid';
```

#### 4.1.2 è®¡ç®—æ›´æ–°è¯¦è§£


**æ•°å€¼è®¡ç®—æ›´æ–°**ï¼š
```sql
-- æ•°å­¦è¿ç®—æ›´æ–°
UPDATE user_accounts 
SET balance = balance + 100,           -- å……å€¼
    total_deposits = total_deposits + 100,
    last_deposit_date = NOW()
WHERE user_id = 1001;

-- ç™¾åˆ†æ¯”è°ƒæ•´
UPDATE products 
SET price = price * 1.05,             -- æ¶¨ä»·5%
    old_price = price                  -- ä¿å­˜åŸä»·
WHERE category_id IN (1, 2, 3);

-- æ¡ä»¶è®¡ç®—æ›´æ–°
UPDATE employees 
SET salary = CASE 
    WHEN performance_rating >= 90 THEN salary * 1.15  -- ä¼˜ç§€å‘˜å·¥æ¶¨15%
    WHEN performance_rating >= 80 THEN salary * 1.10  -- è‰¯å¥½å‘˜å·¥æ¶¨10%
    WHEN performance_rating >= 70 THEN salary * 1.05  -- åˆæ ¼å‘˜å·¥æ¶¨5%
    ELSE salary                                        -- å…¶ä»–ä¸å˜
END,
bonus = salary * 0.1 * (performance_rating / 100)
WHERE review_year = 2024;
```

**å­—ç¬¦ä¸²å¤„ç†æ›´æ–°**ï¼š
```sql
-- å­—ç¬¦ä¸²å‡½æ•°æ›´æ–°
UPDATE customers 
SET customer_name = TRIM(customer_name),           -- å»é™¤ç©ºæ ¼
    email = LOWER(email),                          -- è½¬å°å†™
    phone = REGEXP_REPLACE(phone, '[^0-9]', ''),   -- åªä¿ç•™æ•°å­—
    full_address = CONCAT(address, ', ', city, ', ', state)
WHERE updated_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- å­—ç¬¦ä¸²æ›¿æ¢æ›´æ–°
UPDATE articles 
SET content = REPLACE(content, 'old_domain.com', 'new_domain.com'),
    title = CASE 
        WHEN title LIKE '%Draft%' THEN REPLACE(title, 'Draft', 'Published')
        ELSE title
    END,
    updated_at = NOW()
WHERE status = 'published';
```

**æ—¥æœŸæ—¶é—´æ›´æ–°**ï¼š
```sql
-- æ—¥æœŸè®¡ç®—æ›´æ–°
UPDATE subscriptions 
SET end_date = DATE_ADD(start_date, INTERVAL duration_months MONTH),
    next_billing_date = CASE 
        WHEN billing_cycle = 'monthly' THEN DATE_ADD(start_date, INTERVAL 1 MONTH)
        WHEN billing_cycle = 'yearly' THEN DATE_ADD(start_date, INTERVAL 1 YEAR)
        ELSE start_date
    END,
    status = 'active'
WHERE status = 'pending';
```

#### 4.1.3 ç©ºå€¼å¤„ç†æ›´æ–°


**NULLå€¼å¤„ç†**ï¼š
```sql
-- ç©ºå€¼æ›¿æ¢
UPDATE users 
SET nickname = IFNULL(nickname, username),     -- ç©ºæ˜µç§°ç”¨ç”¨æˆ·å
    avatar = COALESCE(avatar, default_avatar), -- å¤šé‡ç©ºå€¼å¤„ç†
    profile_completed = CASE 
        WHEN nickname IS NOT NULL AND bio IS NOT NULL THEN 1
        ELSE 0
    END
WHERE profile_completed IS NULL;

-- ç©ºå­—ç¬¦ä¸²è½¬NULL
UPDATE products 
SET description = NULLIF(TRIM(description), ''),  -- ç©ºå­—ç¬¦ä¸²è½¬NULL
    tags = NULLIF(TRIM(tags), ''),
    updated_at = NOW()
WHERE description = '' OR tags = '';
```

### 4.2 å¤šè¡¨æ›´æ–°è¯¦è§£


#### 4.2.1 JOINæ›´æ–°


**å†…è¿æ¥æ›´æ–°**ï¼š
```sql
-- åŸºäºå…³è”è¡¨æ›´æ–°
UPDATE products p
INNER JOIN categories c ON p.category_id = c.category_id
SET p.category_name = c.category_name,      -- åŒæ­¥åˆ†ç±»åç§°
    p.tax_rate = c.default_tax_rate,       -- åŒæ­¥ç¨ç‡
    p.updated_at = NOW()
WHERE c.updated_at > p.updated_at;         -- åªæ›´æ–°éœ€è¦åŒæ­¥çš„

-- ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
UPDATE customers c
INNER JOIN (
    SELECT 
        customer_id,
        COUNT(*) AS order_count,
        SUM(total_amount) AS total_spent,
        MAX(order_date) AS last_order_date,
        AVG(total_amount) AS avg_order_value
    FROM orders 
    WHERE status = 'completed'
    GROUP BY customer_id
) stats ON c.customer_id = stats.customer_id
SET c.total_orders = stats.order_count,
    c.total_spent = stats.total_spent,
    c.last_order_date = stats.last_order_date,
    c.avg_order_value = stats.avg_order_value,
    c.customer_level = CASE 
        WHEN stats.total_spent > 10000 THEN 'VIP'
        WHEN stats.total_spent > 5000 THEN 'Premium'
        ELSE 'Regular'
    END;
```

**å·¦å¤–è¿æ¥æ›´æ–°**ï¼š
```sql
-- å¤„ç†å¯èƒ½ä¸å­˜åœ¨çš„å…³è”æ•°æ®
UPDATE products p
LEFT JOIN inventory i ON p.product_id = i.product_id
SET p.stock_status = CASE 
        WHEN i.quantity IS NULL THEN 'out_of_stock'
        WHEN i.quantity = 0 THEN 'out_of_stock'
        WHEN i.quantity < 10 THEN 'low_stock'
        ELSE 'in_stock'
    END,
    p.available_quantity = COALESCE(i.quantity, 0),
    p.last_inventory_update = NOW()
WHERE p.stock_status != 'discontinued';
```

#### 4.2.2 ä¼ ç»Ÿå¤šè¡¨æ›´æ–°è¯­æ³•


**é€—å·åˆ†éš”å¤šè¡¨**ï¼š
```sql
-- ä¼ ç»Ÿè¯­æ³•ï¼ˆä»ç„¶æœ‰æ•ˆï¼‰
UPDATE orders o, customers c
SET o.customer_level = c.customer_level,
    o.discount_rate = CASE 
        WHEN c.customer_level = 'VIP' THEN 0.15
        WHEN c.customer_level = 'Premium' THEN 0.10
        WHEN c.customer_level = 'Regular' THEN 0.05
        ELSE 0
    END
WHERE o.customer_id = c.customer_id
  AND o.status = 'pending';
```

### 4.3 å­æŸ¥è¯¢æ›´æ–°è¯¦è§£


#### 4.3.1 æ ‡é‡å­æŸ¥è¯¢æ›´æ–°


**ç›¸å…³å­æŸ¥è¯¢æ›´æ–°**ï¼š
```sql
-- æ›´æ–°äº§å“å¹³å‡è¯„åˆ†
UPDATE products 
SET average_rating = (
        SELECT AVG(rating) 
        FROM product_reviews 
        WHERE product_id = products.product_id
    ),
    review_count = (
        SELECT COUNT(*) 
        FROM product_reviews 
        WHERE product_id = products.product_id
    ),
    updated_at = NOW()
WHERE product_id IN (
    SELECT DISTINCT product_id FROM product_reviews 
    WHERE created_at >= DATE_SUB(NOW(), INTERVAL 1 DAY)
);

-- åºåˆ—å·ç”Ÿæˆ
UPDATE orders 
SET order_number = CONCAT(
        'ORD',
        DATE_FORMAT(order_date, '%Y%m%d'),
        '-',
        LPAD((
            SELECT COUNT(*) + 1
            FROM (SELECT * FROM orders) o2 
            WHERE DATE(o2.order_date) = DATE(orders.order_date)
              AND o2.order_id < orders.order_id
        ), 4, '0')
    )
WHERE order_number IS NULL;
```

#### 4.3.2 é›†åˆå­æŸ¥è¯¢æ›´æ–°


**INå­æŸ¥è¯¢æ›´æ–°**ï¼š
```sql
-- æ‰¹é‡çŠ¶æ€æ›´æ–°
UPDATE users 
SET status = 'inactive',
    deactivated_at = NOW()
WHERE user_id IN (
    SELECT DISTINCT user_id 
    FROM user_activity 
    WHERE last_activity_date < DATE_SUB(NOW(), INTERVAL 6 MONTH)
);

-- åŸºäºå¤æ‚æ¡ä»¶çš„æ‰¹é‡æ›´æ–°
UPDATE products 
SET promotion_price = price * 0.8,
    promotion_start = NOW(),
    promotion_end = DATE_ADD(NOW(), INTERVAL 7 DAY)
WHERE product_id IN (
    SELECT p.product_id
    FROM (SELECT * FROM products) p
    LEFT JOIN order_items oi ON p.product_id = oi.product_id
    WHERE p.stock_quantity > 50
    GROUP BY p.product_id
    HAVING COALESCE(SUM(oi.quantity), 0) < 10  -- é”€é‡å°‘çš„äº§å“
);
```

**EXISTSå­æŸ¥è¯¢æ›´æ–°**ï¼š
```sql
-- å­˜åœ¨æ€§æ£€æŸ¥æ›´æ–°
UPDATE customers 
SET has_orders = 1,
    first_order_date = (
        SELECT MIN(order_date) 
        FROM orders 
        WHERE orders.customer_id = customers.customer_id
    )
WHERE EXISTS (
    SELECT 1 FROM orders WHERE orders.customer_id = customers.customer_id
);

-- ä¸å­˜åœ¨æ€§æ›´æ–°
UPDATE products 
SET status = 'discontinued',
    discontinued_date = NOW()
WHERE NOT EXISTS (
    SELECT 1 FROM order_items 
    WHERE order_items.product_id = products.product_id
      AND created_at >= DATE_SUB(NOW(), INTERVAL 2 YEAR)
) AND status = 'active';
```

### 4.4 æ›´æ–°æ§åˆ¶ä¸ä¼˜åŒ–


#### 4.4.1 æ›´æ–°é™åˆ¶


**LIMITé™åˆ¶æ›´æ–°**ï¼š
```sql
-- é™åˆ¶æ›´æ–°è¡Œæ•°ï¼ˆé˜²æ­¢å¤§æ‰¹é‡æ›´æ–°ï¼‰
UPDATE products 
SET price = price * 0.95 
WHERE category = 'clearance' 
ORDER BY updated_at ASC 
LIMIT 100;

-- åˆ†æ‰¹æ›´æ–°å¤§è¡¨
UPDATE large_table 
SET processed = 1 
WHERE processed = 0 
  AND created_at < DATE_SUB(NOW(), INTERVAL 1 HOUR)
ORDER BY id 
LIMIT 1000;
```

#### 4.4.2 å®‰å…¨æ›´æ–°æ§åˆ¶


**å®‰å…¨æ¨¡å¼æ›´æ–°**ï¼š
```sql
-- å¯ç”¨å®‰å…¨æ¨¡å¼ï¼ˆå¿…é¡»åŒ…å«é”®å€¼æ¡ä»¶ï¼‰
SET sql_safe_updates = 1;

-- è¿™ä¸ªæ›´æ–°ä¼šè¢«é˜»æ­¢ï¼ˆæ²¡æœ‰é”®å€¼æ¡ä»¶ï¼‰
-- UPDATE users SET status = 'active';  -- ERROR!

-- è¿™ä¸ªæ›´æ–°å…è®¸ï¼ˆåŒ…å«ä¸»é”®æ¡ä»¶ï¼‰
UPDATE users SET status = 'active' WHERE user_id = 1001;  -- OK

-- è¿™ä¸ªæ›´æ–°å…è®¸ï¼ˆåŒ…å«LIMITï¼‰
UPDATE users SET status = 'active' WHERE last_login IS NULL LIMIT 100;  -- OK
```

#### 4.4.3 æ€§èƒ½ä¼˜åŒ–æ›´æ–°


**ç´¢å¼•ä¼˜åŒ–æ›´æ–°**ï¼š
```sql
-- åˆ©ç”¨ç´¢å¼•çš„æ›´æ–°æ¡ä»¶
UPDATE orders 
SET status = 'expired' 
WHERE status = 'pending' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 30 DAY)  -- ä½¿ç”¨ç´¢å¼•å­—æ®µ
  AND payment_status = 'unpaid';

-- é¿å…å‡½æ•°æ“ä½œç´¢å¼•å­—æ®µï¼ˆæ€§èƒ½å·®ï¼‰
-- UPDATE orders SET status = 'expired' WHERE YEAR(created_at) = 2023;  -- æ…¢

-- æ”¹ç”¨èŒƒå›´æ¡ä»¶ï¼ˆæ€§èƒ½å¥½ï¼‰
UPDATE orders 
SET status = 'expired' 
WHERE created_at >= '2023-01-01' 
  AND created_at < '2024-01-01';  -- å¿«
```

---

## 5. ğŸ—‘ï¸ DELETEåˆ é™¤è¯­å¥å®Œæ•´ä½“ç³»


### 5.1 å•è¡¨åˆ é™¤è¯¦è§£


#### 5.1.1 åŸºç¡€åˆ é™¤æ“ä½œ


**æ¡ä»¶åˆ é™¤**ï¼š
```sql
-- åŸºæœ¬æ¡ä»¶åˆ é™¤
DELETE FROM users WHERE status = 'inactive';

-- å¤šæ¡ä»¶åˆ é™¤
DELETE FROM sessions 
WHERE expired_at < NOW() 
  AND user_id IS NOT NULL;

-- å¤æ‚æ¡ä»¶åˆ é™¤
DELETE FROM logs 
WHERE (log_level = 'DEBUG' AND created_at < DATE_SUB(NOW(), INTERVAL 7 DAY))
   OR (log_level = 'INFO' AND created_at < DATE_SUB(NOW(), INTERVAL 30 DAY))
   OR (log_level = 'ERROR' AND created_at < DATE_SUB(NOW(), INTERVAL 90 DAY));
```

#### 5.1.2 èŒƒå›´åˆ é™¤


**æ—¶é—´èŒƒå›´åˆ é™¤**ï¼š
```sql
-- åˆ é™¤å†å²æ•°æ®
DELETE FROM access_logs 
WHERE log_date < DATE_SUB(NOW(), INTERVAL 3 MONTH);

-- åˆ é™¤æŒ‡å®šæ—¥æœŸèŒƒå›´
DELETE FROM temporary_data 
WHERE created_at BETWEEN '2024-01-01' AND '2024-01-31';

-- æŒ‰å¹´ä»½åˆ é™¤
DELETE FROM archived_orders 
WHERE YEAR(order_date) < 2020;
```

**é›†åˆåˆ é™¤**ï¼š
```sql
-- IDé›†åˆåˆ é™¤
DELETE FROM user_sessions 
WHERE user_id IN (1001, 1002, 1003, 1004);

-- çŠ¶æ€é›†åˆåˆ é™¤
DELETE FROM orders 
WHERE status IN ('cancelled', 'refunded', 'expired');

-- å­æŸ¥è¯¢é›†åˆåˆ é™¤
DELETE FROM notifications 
WHERE user_id IN (
    SELECT user_id FROM users WHERE status = 'deleted'
);
```

#### 5.1.3 æ¨¡å¼åŒ¹é…åˆ é™¤


**LIKEæ¨¡å¼åˆ é™¤**ï¼š
```sql
-- æ–‡ä»¶åæ¨¡å¼åˆ é™¤
DELETE FROM uploaded_files 
WHERE file_name LIKE '%.tmp' 
   OR file_name LIKE 'temp_%';

-- å†…å®¹åŒ¹é…åˆ é™¤
DELETE FROM comments 
WHERE content LIKE '%spam%' 
   OR content LIKE '%advertisement%';
```

**æ­£åˆ™è¡¨è¾¾å¼åˆ é™¤**ï¼š
```sql
-- æ­£åˆ™åŒ¹é…åˆ é™¤
DELETE FROM user_data 
WHERE phone REGEXP '^[0-9]{3}-[0-9]{3}-[0-9]{4}$'  -- åŒ¹é…ç‰¹å®šæ ¼å¼
  AND phone REGEXP '000-000-';                       -- å‡å·ç 
```

### 5.2 å¤šè¡¨åˆ é™¤è¯¦è§£


#### 5.2.1 JOINåˆ é™¤


**å†…è¿æ¥åˆ é™¤**ï¼š
```sql
-- åˆ é™¤å…³è”æ•°æ®
DELETE o FROM orders o
INNER JOIN customers c ON o.customer_id = c.customer_id
WHERE c.status = 'deleted';

-- åŒæ—¶åˆ é™¤å¤šè¡¨æ•°æ®
DELETE o, oi FROM orders o
INNER JOIN order_items oi ON o.order_id = oi.order_id
WHERE o.status = 'cancelled' 
  AND o.created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- ä¸‰è¡¨è¿æ¥åˆ é™¤
DELETE u, p, s FROM users u
INNER JOIN user_profiles p ON u.user_id = p.user_id
INNER JOIN user_settings s ON u.user_id = s.user_id
WHERE u.status = 'banned' 
  AND u.banned_at < DATE_SUB(NOW(), INTERVAL 2 YEAR);
```

**å¤–è¿æ¥åˆ é™¤**ï¼š
```sql
-- åˆ é™¤å­¤ç«‹è®°å½•
DELETE oi FROM order_items oi
LEFT JOIN orders o ON oi.order_id = o.order_id
WHERE o.order_id IS NULL;  -- åˆ é™¤æ²¡æœ‰å¯¹åº”è®¢å•çš„è®¢å•é¡¹

-- åˆ é™¤æ— å…³è”çš„æ•°æ®
DELETE p FROM products p
LEFT JOIN categories c ON p.category_id = c.category_id
WHERE c.category_id IS NULL 
   OR c.status = 'deleted';
```

#### 5.2.2 å¤æ‚å¤šè¡¨åˆ é™¤åœºæ™¯


**çº§è”åˆ é™¤æ¨¡æ‹Ÿ**ï¼š
```sql
-- åˆ é™¤ç”¨æˆ·åŠå…¶æ‰€æœ‰ç›¸å…³æ•°æ®
DELETE u, p, s, n, l FROM users u
LEFT JOIN user_profiles p ON u.user_id = p.user_id
LEFT JOIN user_settings s ON u.user_id = s.user_id  
LEFT JOIN notifications n ON u.user_id = n.user_id
LEFT JOIN user_logs l ON u.user_id = l.user_id
WHERE u.user_id = 1001 AND u.status = 'delete_requested';

-- æ•°æ®æ¸…ç†ï¼šåˆ é™¤é‡å¤æ•°æ®
DELETE t1 FROM duplicate_records t1
INNER JOIN duplicate_records t2
WHERE t1.id > t2.id 
  AND t1.unique_field = t2.unique_field;  -- ä¿ç•™IDè¾ƒå°çš„è®°å½•
```

### 5.3 å­æŸ¥è¯¢åˆ é™¤è¯¦è§£


#### 5.3.1 EXISTSå­æŸ¥è¯¢åˆ é™¤


**å­˜åœ¨æ€§åˆ é™¤**ï¼š
```sql
-- åˆ é™¤æœ‰ç‰¹å®šå…³è”çš„è®°å½•
DELETE FROM products 
WHERE EXISTS (
    SELECT 1 FROM order_items oi
    JOIN orders o ON oi.order_id = o.order_id
    WHERE oi.product_id = products.product_id 
      AND o.status = 'refunded'
      AND o.refund_date >= DATE_SUB(NOW(), INTERVAL 30 DAY)
);

-- åˆ é™¤æ— å…³è”çš„è®°å½•
DELETE FROM categories 
WHERE NOT EXISTS (
    SELECT 1 FROM products 
    WHERE products.category_id = categories.category_id
) AND status != 'system';

-- å¤æ‚EXISTSåˆ é™¤
DELETE FROM user_sessions 
WHERE EXISTS (
    SELECT 1 FROM users u
    WHERE u.user_id = user_sessions.user_id
      AND (u.status = 'banned' OR u.last_activity < DATE_SUB(NOW(), INTERVAL 1 YEAR))
);
```

#### 5.3.2 IN/NOT INå­æŸ¥è¯¢åˆ é™¤


**é›†åˆå­æŸ¥è¯¢åˆ é™¤**ï¼š
```sql
-- åˆ é™¤æŒ‡å®šé›†åˆä¸­çš„æ•°æ®
DELETE FROM notifications 
WHERE user_id IN (
    SELECT user_id FROM users 
    WHERE subscription_status = 'cancelled'
      AND cancelled_date < DATE_SUB(NOW(), INTERVAL 3 MONTH)
);

-- æ¸…ç†å­¤ç«‹æ•°æ®
DELETE FROM order_items 
WHERE order_id NOT IN (
    SELECT order_id FROM orders WHERE order_id IS NOT NULL
);

-- åŸºäºç»Ÿè®¡ç»“æœåˆ é™¤
DELETE FROM products 
WHERE product_id IN (
    SELECT product_id 
    FROM (
        SELECT p.product_id
        FROM products p
        LEFT JOIN order_items oi ON p.product_id = oi.product_id
        WHERE p.created_at < DATE_SUB(NOW(), INTERVAL 2 YEAR)
        GROUP BY p.product_id
        HAVING COUNT(oi.product_id) = 0  -- ä»æœªè¢«è´­ä¹°
    ) unused_products
);
```

> **âš ï¸ é‡è¦æé†’**ï¼šä½¿ç”¨NOT INæ—¶ï¼Œå¦‚æœå­æŸ¥è¯¢ç»“æœåŒ…å«NULLï¼Œå¯èƒ½å¯¼è‡´æ„å¤–ç»“æœï¼Œå»ºè®®åŠ ä¸ŠNULLè¿‡æ»¤æ¡ä»¶

### 5.4 åˆ é™¤æ§åˆ¶ä¸ä¼˜åŒ–


#### 5.4.1 é™åˆ¶åˆ é™¤


**LIMITæ§åˆ¶åˆ é™¤**ï¼š
```sql
-- åˆ†æ‰¹åˆ é™¤ï¼ˆé¿å…é•¿æ—¶é—´é”è¡¨ï¼‰
DELETE FROM large_log_table 
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR)
ORDER BY created_at ASC 
LIMIT 10000;

-- åˆ é™¤æœ€æ—§çš„è®°å½•
DELETE FROM cache_data 
ORDER BY last_accessed ASC 
LIMIT 1000;

-- æŒ‰æ¡ä»¶æ’åºåˆ é™¤
DELETE FROM user_activities 
WHERE activity_type = 'page_view' 
ORDER BY created_at ASC 
LIMIT 50000;
```

#### 5.4.2 å®‰å…¨åˆ é™¤å®è·µ


**åˆ é™¤å‰éªŒè¯**ï¼š
```sql
-- åˆ é™¤å‰ç»Ÿè®¡ç¡®è®¤
SELECT COUNT(*) AS will_delete_count
FROM orders 
WHERE status = 'cancelled' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 2 YEAR);

-- é¢„è§ˆè¦åˆ é™¤çš„æ•°æ®
SELECT order_id, customer_id, status, created_at
FROM orders 
WHERE status = 'cancelled' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 2 YEAR)
LIMIT 5;

-- äº‹åŠ¡ä¸­éªŒè¯åˆ é™¤
START TRANSACTION;
DELETE FROM orders 
WHERE status = 'cancelled' 
  AND created_at < DATE_SUB(NOW(), INTERVAL 2 YEAR);

SELECT ROW_COUNT() AS deleted_rows;
-- æ£€æŸ¥ç»“æœï¼Œå†³å®šCOMMITæˆ–ROLLBACK
ROLLBACK;  -- æˆ– COMMIT;
```

#### 5.4.3 æ€§èƒ½ä¼˜åŒ–åˆ é™¤


**ç´¢å¼•ä¼˜åŒ–åˆ é™¤**ï¼š
```sql
-- ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºåˆ é™¤æ¡ä»¶
DELETE FROM access_logs 
WHERE log_date < '2024-01-01'    -- å‡è®¾log_dateæœ‰ç´¢å¼•
  AND user_id IS NOT NULL;

-- é¿å…å‡½æ•°æ“ä½œå¯¼è‡´å…¨è¡¨æ‰«æ
-- DELETE FROM orders WHERE YEAR(order_date) < 2023;  -- æ…¢

-- ä½¿ç”¨èŒƒå›´æ¡ä»¶æ›¿ä»£å‡½æ•°
DELETE FROM orders 
WHERE order_date < '2023-01-01';  -- å¿«
```

### 5.5 æ¸…ç©ºè¡¨æ“ä½œè¯¦è§£


#### 5.5.1 DELETE vs TRUNCATE


**DELETEæ¸…ç©º**ï¼š
```sql
-- æ™®é€šåˆ é™¤ï¼ˆæ…¢ï¼Œä½†å®‰å…¨ï¼‰
DELETE FROM session_data;  -- ä¿æŒè‡ªå¢IDï¼Œè§¦å‘è§¦å‘å™¨ï¼Œå¯å›æ»š

-- å¸¦æ¡ä»¶çš„æ¸…ç©º
DELETE FROM logs WHERE 1=1;  -- æ•ˆæœåŒä¸Šï¼Œä½†å†™æ³•ä¸æ¨è
```

**TRUNCATEæ¸…ç©º**ï¼š
```sql
-- å¿«é€Ÿæ¸…ç©ºï¼ˆå¿«ï¼Œä½†è¦è°¨æ…ï¼‰
TRUNCATE TABLE session_data;  -- é‡ç½®è‡ªå¢IDï¼Œä¸è§¦å‘è§¦å‘å™¨ï¼Œä¸å¯å›æ»š
```

**é€‰æ‹©æ ‡å‡†**ï¼š
```
DELETE vs TRUNCATE å¯¹æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰¹æ€§        â”‚ DELETE      â”‚ TRUNCATE    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é€Ÿåº¦        â”‚ æ…¢          â”‚ å¿«          â”‚
â”‚ è‡ªå¢ID      â”‚ ä¿æŒ        â”‚ é‡ç½®ä¸º1     â”‚
â”‚ è§¦å‘å™¨      â”‚ è§¦å‘        â”‚ ä¸è§¦å‘      â”‚
â”‚ å›æ»š        â”‚ å¯å›æ»š      â”‚ ä¸å¯å›æ»š    â”‚
â”‚ æ¡ä»¶åˆ é™¤    â”‚ æ”¯æŒ        â”‚ ä¸æ”¯æŒ      â”‚
â”‚ å¤–é”®çº¦æŸ    â”‚ æ£€æŸ¥        â”‚ å¿½ç•¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.5.2 åˆ†åŒºè¡¨æ¸…ç©º


**åˆ†åŒºè¡¨æ“ä½œ**ï¼š
```sql
-- æ¸…ç©ºæŒ‡å®šåˆ†åŒº
ALTER TABLE sales_data TRUNCATE PARTITION p_2023_q1;

-- åˆ é™¤å¤šä¸ªåˆ†åŒº
ALTER TABLE sales_data DROP PARTITION p_2022_q1, p_2022_q2;

-- åˆ é™¤åˆ†åŒºæ•°æ®ä½†ä¿ç•™åˆ†åŒºç»“æ„
DELETE FROM sales_data PARTITION(p_2023_q1);
```

---

## 6. ğŸš€ é«˜çº§DMLç‰¹æ€§ä¸åº”ç”¨


### 6.1 äº‹åŠ¡ä¸­çš„DMLæ“ä½œè¯¦è§£


#### 6.1.1 äº‹åŠ¡æ§åˆ¶è¯­å¥


**åŸºç¡€äº‹åŠ¡æ“ä½œ**ï¼š
```sql
-- æ ‡å‡†äº‹åŠ¡æµç¨‹
START TRANSACTION;
  INSERT INTO accounts (user_id, balance) VALUES (1001, 1000.00);
  UPDATE accounts SET balance = balance - 100 WHERE user_id = 1001;
  INSERT INTO transactions (from_user, amount, type) VALUES (1001, 100, 'withdrawal');
COMMIT;

-- äº‹åŠ¡å›æ»š
START TRANSACTION;
  UPDATE inventory SET quantity = quantity - 1 WHERE product_id = 101;
  -- å¦‚æœå‘ç°åº“å­˜ä¸è¶³
  SELECT quantity FROM inventory WHERE product_id = 101;
  -- å‡è®¾ç»“æœä¸ºè´Ÿæ•°ï¼Œå›æ»šäº‹åŠ¡
ROLLBACK;
```

**äº‹åŠ¡å±æ€§æ§åˆ¶**ï¼š
```sql
-- åªè¯»äº‹åŠ¡ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
START TRANSACTION READ ONLY;
  SELECT * FROM orders WHERE customer_id = 1001;
  SELECT COUNT(*) FROM order_items WHERE order_id IN (...);
COMMIT;

-- ä¸€è‡´æ€§å¿«ç…§äº‹åŠ¡
START TRANSACTION WITH CONSISTENT SNAPSHOT;
  -- è·å–ä¸€è‡´æ€§å¿«ç…§ï¼Œé€‚åˆæŠ¥è¡¨æŸ¥è¯¢
  SELECT SUM(amount) FROM orders WHERE DATE(order_date) = CURDATE();
  SELECT COUNT(*) FROM customers WHERE status = 'active';
COMMIT;
```

#### 6.1.2 ä¿å­˜ç‚¹æ“ä½œ


**ä¿å­˜ç‚¹ä½¿ç”¨**ï¼š
```sql
START TRANSACTION;
  -- æ‰¹é‡æ“ä½œç¬¬ä¸€é˜¶æ®µ
  INSERT INTO batch_import (data) VALUES ('batch1_data1'), ('batch1_data2');
  SAVEPOINT batch1_complete;
  
  -- æ‰¹é‡æ“ä½œç¬¬äºŒé˜¶æ®µ
  INSERT INTO batch_import (data) VALUES ('batch2_data1'), ('batch2_data2');
  SAVEPOINT batch2_complete;
  
  -- å¦‚æœç¬¬ä¸‰é˜¶æ®µå‡ºé”™
  INSERT INTO batch_import (data) VALUES ('invalid_data');
  -- å›æ»šåˆ°ç¬¬äºŒé˜¶æ®µå®Œæˆç‚¹
  ROLLBACK TO batch2_complete;
  
  -- é‡Šæ”¾ä¸éœ€è¦çš„ä¿å­˜ç‚¹
  RELEASE SAVEPOINT batch1_complete;
COMMIT;
```

#### 6.1.3 é”å®šè¯»æŸ¥è¯¢


**å…±äº«é”æŸ¥è¯¢**ï¼š
```sql
-- å…±äº«é”ï¼ˆè¯»é”ï¼‰- å…è®¸å…¶ä»–äº‹åŠ¡è¯»å–ï¼Œé˜»æ­¢å†™å…¥
START TRANSACTION;
  SELECT balance FROM accounts 
  WHERE user_id = 1001 
  FOR SHARE;  -- æˆ– LOCK IN SHARE MODE (MySQL 5.7å…¼å®¹)
  
  -- åŸºäºè¯»å–çš„æ•°æ®è¿›è¡Œä¸šåŠ¡åˆ¤æ–­
  -- å…¶ä»–äº‹åŠ¡å¯ä»¥è¯»å–ï¼Œä½†ä¸èƒ½ä¿®æ”¹balance
  
  UPDATE accounts SET balance = balance - 100 WHERE user_id = 1001;
COMMIT;
```

**æ’ä»–é”æŸ¥è¯¢**ï¼š
```sql
-- æ’ä»–é”ï¼ˆå†™é”ï¼‰- é˜»æ­¢å…¶ä»–äº‹åŠ¡è¯»å†™
START TRANSACTION;
  SELECT quantity FROM inventory 
  WHERE product_id = 101 
  FOR UPDATE;  -- æ’ä»–é”
  
  -- æ£€æŸ¥åº“å­˜æ˜¯å¦è¶³å¤Ÿ
  -- å…¶ä»–äº‹åŠ¡æ— æ³•è¯»å–æˆ–ä¿®æ”¹è¿™æ¡è®°å½•
  
  UPDATE inventory SET quantity = quantity - 1 WHERE product_id = 101;
COMMIT;
```

**é”å®šé€‰é¡¹ï¼ˆMySQL 8.0+ï¼‰**ï¼š
```sql
-- éé˜»å¡é”å®š
SELECT * FROM products 
WHERE product_id = 101 
FOR UPDATE NOWAIT;  -- å¦‚æœä¸èƒ½ç«‹å³è·å–é”åˆ™æŠ¥é”™

-- è·³è¿‡å·²é”å®šçš„è¡Œ
SELECT * FROM orders 
WHERE status = 'processing' 
FOR UPDATE SKIP LOCKED  -- è·³è¿‡è¢«å…¶ä»–äº‹åŠ¡é”å®šçš„è¡Œ
LIMIT 10;
```

### 6.2 æŸ¥è¯¢ä¼˜åŒ–æç¤ºè¯¦è§£


#### 6.2.1 ç´¢å¼•æç¤º


**USE INDEXæç¤º**ï¼š
```sql
-- å»ºè®®ä½¿ç”¨ç‰¹å®šç´¢å¼•
SELECT * FROM orders 
USE INDEX (idx_customer_date)  -- å»ºè®®ä½¿ç”¨è¿™ä¸ªç´¢å¼•
WHERE customer_id = 1001 AND order_date >= '2024-01-01';

-- ä¸åŒæ“ä½œä½¿ç”¨ä¸åŒç´¢å¼•
SELECT * FROM products p
USE INDEX FOR JOIN (idx_category)      -- è¿æ¥æ—¶ä½¿ç”¨
USE INDEX FOR ORDER BY (idx_price)     -- æ’åºæ—¶ä½¿ç”¨  
USE INDEX FOR GROUP BY (idx_brand)     -- åˆ†ç»„æ—¶ä½¿ç”¨
JOIN categories c ON p.category_id = c.category_id
ORDER BY p.price;
```

**FORCE INDEXå¼ºåˆ¶**ï¼š
```sql
-- å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ï¼ˆå³ä½¿ä¼˜åŒ–å™¨è®¤ä¸ºä¸ä¼˜ï¼‰
SELECT * FROM large_table 
FORCE INDEX (idx_status_date)
WHERE status = 'active' AND created_date > '2024-01-01';
```

**IGNORE INDEXå¿½ç•¥**ï¼š
```sql
-- å¿½ç•¥ç‰¹å®šç´¢å¼•
SELECT * FROM products 
IGNORE INDEX (idx_price)  -- ä¸ä½¿ç”¨ä»·æ ¼ç´¢å¼•
WHERE price BETWEEN 100 AND 500;
```

#### 6.2.2 æŸ¥è¯¢ç¼“å­˜æç¤º


**ç¼“å­˜æ§åˆ¶**ï¼š
```sql
-- å¼ºåˆ¶ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜
SELECT SQL_CACHE customer_name, email 
FROM customers 
WHERE status = 'active';

-- ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼ˆæ•°æ®å®æ—¶æ€§è¦æ±‚é«˜ï¼‰
SELECT SQL_NO_CACHE balance 
FROM accounts 
WHERE user_id = 1001;
```

#### 6.2.3 ç»“æœé›†å¤„ç†æç¤º


**ç»“æœé›†å¤§å°æç¤º**ï¼š
```sql
-- å¤§ç»“æœé›†æç¤ºï¼ˆä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨ï¼‰
SELECT SQL_BIG_RESULT department, COUNT(*) 
FROM employees 
GROUP BY department;

-- å°ç»“æœé›†æç¤ºï¼ˆä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼‰
SELECT SQL_SMALL_RESULT category, AVG(price) 
FROM products 
GROUP BY category;
```

**å…¶ä»–ä¼˜åŒ–æç¤º**ï¼š
```sql
-- ç¼“å†²ç»“æœé›†
SELECT SQL_BUFFER_RESULT * FROM large_table WHERE condition;

-- è®¡ç®—æ€»è¡Œæ•°ï¼ˆé…åˆåˆ†é¡µä½¿ç”¨ï¼‰
SELECT SQL_CALC_FOUND_ROWS * FROM products LIMIT 20;
SELECT FOUND_ROWS() AS total_count;  -- è·å–æ€»è¡Œæ•°

-- å¼ºåˆ¶è¿æ¥é¡ºåº
SELECT STRAIGHT_JOIN c.customer_name, o.order_date
FROM customers c 
JOIN orders o ON c.customer_id = o.customer_id;
```

### 6.3 å…¨æ–‡æœç´¢è¯¦è§£


#### 6.3.1 è‡ªç„¶è¯­è¨€å…¨æ–‡æœç´¢


**åŸºç¡€å…¨æ–‡æœç´¢**ï¼š
```sql
-- åˆ›å»ºå…¨æ–‡ç´¢å¼•
ALTER TABLE articles ADD FULLTEXT(title, content);

-- è‡ªç„¶è¯­è¨€æœç´¢
SELECT *, MATCH(title, content) AGAINST('MySQL database optimization') AS relevance
FROM articles 
WHERE MATCH(title, content) AGAINST('MySQL database optimization')
ORDER BY relevance DESC;

-- å¤šå­—æ®µå…¨æ–‡æœç´¢
SELECT product_name, description
FROM products 
WHERE MATCH(product_name, description) AGAINST('smartphone camera quality');
```

#### 6.3.2 å¸ƒå°”å…¨æ–‡æœç´¢


**å¸ƒå°”æœç´¢è¯­æ³•**ï¼š
```sql
-- å¿…é¡»åŒ…å«å’Œæ’é™¤
SELECT * FROM articles 
WHERE MATCH(content) AGAINST('+MySQL -Oracle' IN BOOLEAN MODE);

-- ç²¾ç¡®çŸ­è¯­æœç´¢
SELECT * FROM articles 
WHERE MATCH(content) AGAINST('"database optimization"' IN BOOLEAN MODE);

-- é€šé…ç¬¦æœç´¢
SELECT * FROM products 
WHERE MATCH(product_name) AGAINST('iphone*' IN BOOLEAN MODE);

-- å¤åˆå¸ƒå°”æœç´¢
SELECT * FROM articles 
WHERE MATCH(title, content) AGAINST(
    '+MySQL +"performance tuning" -Oracle +index*' 
    IN BOOLEAN MODE
);
```

#### 6.3.3 æŸ¥è¯¢æ‰©å±•æœç´¢


**æ‰©å±•æœç´¢**ï¼š
```sql
-- æŸ¥è¯¢æ‰©å±•æ¨¡å¼ï¼ˆè‡ªåŠ¨æ‰¾ç›¸å…³è¯æ±‡ï¼‰
SELECT * FROM articles 
WHERE MATCH(content) AGAINST(
    'database performance' 
    WITH QUERY EXPANSION
);
```

### 6.4 æ•°æ®å¯¼å‡ºSELECT INTOè¯¦è§£


#### 6.4.1 æ–‡ä»¶å¯¼å‡º


**åŸºç¡€æ–‡ä»¶å¯¼å‡º**ï¼š
```sql
-- å¯¼å‡ºä¸ºCSVæ–‡ä»¶
SELECT customer_id, customer_name, email, phone
FROM customers 
WHERE status = 'active'
INTO OUTFILE '/tmp/active_customers.csv'
FIELDS TERMINATED BY ','
OPTIONALLY ENCLOSED BY '"'
LINES TERMINATED BY '\n';

-- æ ¼å¼åŒ–å¯¼å‡º
SELECT 
    CONCAT('"', customer_name, '"') AS name,
    CONCAT('"', email, '"') AS email,
    CONCAT('"', phone, '"') AS phone
FROM customers
INTO OUTFILE '/tmp/formatted_customers.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n';
```

#### 6.4.2 å˜é‡èµ‹å€¼


**æŸ¥è¯¢ç»“æœèµ‹å€¼ç»™å˜é‡**ï¼š
```sql
-- å•å€¼èµ‹å€¼
SELECT COUNT(*) INTO @total_users FROM users WHERE status = 'active';
SELECT @total_users;

-- å¤šå€¼èµ‹å€¼
SELECT 
    COUNT(*) AS total_orders,
    SUM(total_amount) AS total_revenue,
    AVG(total_amount) AS avg_order_value
INTO @order_count, @revenue, @avg_value
FROM orders 
WHERE order_date >= DATE_SUB(NOW(), INTERVAL 1 MONTH);

SELECT @order_count, @revenue, @avg_value;

-- æ¡ä»¶èµ‹å€¼
SELECT 
    CASE 
        WHEN COUNT(*) > 1000 THEN 'high'
        WHEN COUNT(*) > 100 THEN 'medium'
        ELSE 'low'
    END INTO @activity_level
FROM user_activities 
WHERE created_at >= DATE_SUB(NOW(), INTERVAL 1 DAY);
```

### 6.5 è¡¨é”å®šæ“ä½œè¯¦è§£


#### 6.5.1 è¡¨é”å®šè¯­æ³•


**åŸºç¡€è¡¨é”å®š**ï¼š
```sql
-- è¯»é”å®šï¼ˆå…è®¸å…¶ä»–è¿æ¥è¯»å–ï¼Œé˜»æ­¢å†™å…¥ï¼‰
LOCK TABLES customers READ;
  SELECT * FROM customers WHERE status = 'active';
  -- å…¶ä»–è¿æ¥å¯ä»¥è¯»å–customersè¡¨ï¼Œä½†ä¸èƒ½ä¿®æ”¹
UNLOCK TABLES;

-- å†™é”å®šï¼ˆé˜»æ­¢å…¶ä»–è¿æ¥è¯»å†™ï¼‰
LOCK TABLES orders WRITE;
  INSERT INTO orders (customer_id, total_amount) VALUES (1001, 299.99);
  UPDATE orders SET status = 'processing' WHERE order_id = LAST_INSERT_ID();
  -- å…¶ä»–è¿æ¥æ— æ³•è®¿é—®ordersè¡¨
UNLOCK TABLES;
```

**å¤šè¡¨é”å®š**ï¼š
```sql
-- åŒæ—¶é”å®šå¤šä¸ªè¡¨
LOCK TABLES 
    customers READ,
    orders WRITE,
    order_items WRITE;
    
-- æ‰§è¡Œéœ€è¦å¤šè¡¨æ“ä½œçš„ä¸šåŠ¡é€»è¾‘
INSERT INTO orders (customer_id, total_amount) 
SELECT customer_id, 299.99 FROM customers WHERE customer_id = 1001;

INSERT INTO order_items (order_id, product_id, quantity)
VALUES (LAST_INSERT_ID(), 101, 2);

UNLOCK TABLES;
```

#### 6.5.2 é”å®šçš„åº”ç”¨åœºæ™¯


**æ•°æ®ä¸€è‡´æ€§ä¿è¯**ï¼š
```sql
-- åº“å­˜æ‰£å‡åœºæ™¯
LOCK TABLES inventory WRITE, orders WRITE, order_items WRITE;

-- æ£€æŸ¥åº“å­˜
SELECT quantity FROM inventory WHERE product_id = 101;

-- å¦‚æœåº“å­˜å……è¶³ï¼Œåˆ›å»ºè®¢å•å¹¶æ‰£å‡åº“å­˜
INSERT INTO orders (customer_id, total_amount) VALUES (1001, 199.99);
INSERT INTO order_items (order_id, product_id, quantity) 
VALUES (LAST_INSERT_ID(), 101, 1);
UPDATE inventory SET quantity = quantity - 1 WHERE product_id = 101;

UNLOCK TABLES;
```

---

## 7. âš¡ æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ


### 7.1 æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


#### 7.1.1 ç´¢å¼•åˆ©ç”¨ä¼˜åŒ–


**ç´¢å¼•è®¾è®¡åŸåˆ™**ï¼š
```sql
-- å¥½çš„ç´¢å¼•ä½¿ç”¨ç¤ºä¾‹
SELECT * FROM orders 
WHERE customer_id = 1001        -- ä½¿ç”¨ç´¢å¼•å­—æ®µ
  AND status = 'completed'      -- ç»„åˆç´¢å¼•
  AND order_date >= '2024-01-01';

-- è¦†ç›–ç´¢å¼•æŸ¥è¯¢ï¼ˆæœ€ä¼˜ï¼‰
SELECT customer_id, order_date, total_amount 
FROM orders 
WHERE status = 'completed' 
  AND order_date >= '2024-01-01';
-- å‡è®¾æœ‰ç´¢å¼•ï¼šINDEX(status, order_date, customer_id, total_amount)
```

**é¿å…ç´¢å¼•å¤±æ•ˆ**ï¼š
```sql
-- é”™è¯¯ï¼šå‡½æ•°æ“ä½œå¯¼è‡´ç´¢å¼•å¤±æ•ˆ
-- SELECT * FROM orders WHERE YEAR(order_date) = 2024;

-- æ­£ç¡®ï¼šä½¿ç”¨èŒƒå›´æ¡ä»¶
SELECT * FROM orders 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2025-01-01';

-- é”™è¯¯ï¼šå‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢
-- SELECT * FROM customers WHERE customer_name LIKE '%Smith';

-- æ­£ç¡®ï¼šåå¯¼æ¨¡ç³ŠæŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•
SELECT * FROM customers WHERE customer_name LIKE 'Smith%';
```

#### 7.1.2 è¿æ¥ä¼˜åŒ–ç­–ç•¥


**è¿æ¥é¡ºåºä¼˜åŒ–**ï¼š
```sql
-- å°è¡¨é©±åŠ¨å¤§è¡¨åŸåˆ™
SELECT c.customer_name, o.order_date
FROM (
    SELECT DISTINCT customer_id FROM recent_orders  -- å°è¡¨
) rc
JOIN customers c ON rc.customer_id = c.customer_id  -- å¤§è¡¨
JOIN orders o ON c.customer_id = o.customer_id;
```

**EXISTS vs INä¼˜åŒ–**ï¼š
```sql
-- å½“å­æŸ¥è¯¢ç»“æœé›†å°æ—¶ï¼Œä½¿ç”¨IN
SELECT * FROM customers 
WHERE customer_id IN (
    SELECT customer_id FROM vip_customers  -- å°ç»“æœé›†
);

-- å½“å­æŸ¥è¯¢ç»“æœé›†å¤§æ—¶ï¼Œä½¿ç”¨EXISTS
SELECT * FROM customers c
WHERE EXISTS (
    SELECT 1 FROM orders o 
    WHERE o.customer_id = c.customer_id    -- å¤§ç»“æœé›†
      AND o.order_date >= '2024-01-01'
);
```

#### 7.1.3 åˆ†é¡µä¼˜åŒ–


**æ·±åº¦åˆ†é¡µä¼˜åŒ–**ï¼š
```sql
-- é—®é¢˜ï¼šå¤§åç§»é‡åˆ†é¡µï¼ˆæ€§èƒ½å·®ï¼‰
-- SELECT * FROM products ORDER BY product_id LIMIT 100000, 20;

-- è§£å†³æ–¹æ¡ˆ1ï¼šåŸºäºæ¸¸æ ‡çš„åˆ†é¡µ
SELECT * FROM products 
WHERE product_id > 123456  -- ä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•çš„ID
ORDER BY product_id 
LIMIT 20;

-- è§£å†³æ–¹æ¡ˆ2ï¼šå­æŸ¥è¯¢ä¼˜åŒ–
SELECT p.* FROM (
    SELECT product_id FROM products 
    ORDER BY product_id 
    LIMIT 100000, 20
) t JOIN products p ON t.product_id = p.product_id;

-- è§£å†³æ–¹æ¡ˆ3ï¼šå»¶è¿Ÿå…³è”
SELECT p.* FROM products p
INNER JOIN (
    SELECT product_id FROM products ORDER BY product_id LIMIT 100000, 20
) AS t ON p.product_id = t.product_id;
```

### 7.2 æ’å…¥æ€§èƒ½ä¼˜åŒ–


#### 7.2.1 æ‰¹é‡æ’å…¥ç­–ç•¥


**ä¼˜åŒ–æ’å…¥æ€§èƒ½**ï¼š
```sql
-- å•æ¡æ’å…¥ï¼ˆæ…¢ï¼‰
-- INSERT INTO products (name, price) VALUES ('Product1', 99.99);
-- INSERT INTO products (name, price) VALUES ('Product2', 199.99);

-- æ‰¹é‡æ’å…¥ï¼ˆå¿«ï¼‰
INSERT INTO products (name, price) VALUES
('Product1', 99.99),
('Product2', 199.99),
('Product3', 299.99),
-- ... å»ºè®®æ¯æ‰¹1000-5000è¡Œ
('Product1000', 999.99);

-- äº‹åŠ¡æ§åˆ¶æ‰¹é‡æ’å…¥
SET autocommit = 0;
INSERT INTO products (name, price) VALUES (...);  -- æ‰¹é‡æ•°æ®
COMMIT;
SET autocommit = 1;
```

**å¤§æ•°æ®å¯¼å…¥ä¼˜åŒ–**ï¼š
```sql
-- ä¸´æ—¶ç¦ç”¨æ£€æŸ¥ä»¥æé«˜å¯¼å…¥é€Ÿåº¦
SET FOREIGN_KEY_CHECKS = 0;
SET UNIQUE_CHECKS = 0;
SET AUTOCOMMIT = 0;

-- æ‰¹é‡å¯¼å…¥æ•°æ®
LOAD DATA INFILE '/data/large_dataset.csv' INTO TABLE large_table
FIELDS TERMINATED BY ',' ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 LINES;

-- æ¢å¤æ£€æŸ¥
COMMIT;
SET FOREIGN_KEY_CHECKS = 1;
SET UNIQUE_CHECKS = 1;
SET AUTOCOMMIT = 1;

-- é‡å»ºç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE large_table;
```

#### 7.2.2 INSERTæ€§èƒ½è°ƒä¼˜


**ç´¢å¼•å’Œæ’å…¥æ€§èƒ½å¹³è¡¡**ï¼š
```sql
-- å¤§æ‰¹é‡æ’å…¥æ—¶ä¸´æ—¶ç¦ç”¨ç´¢å¼•
ALTER TABLE import_table DISABLE KEYS;

-- æ‰§è¡Œå¤§æ‰¹é‡æ’å…¥
LOAD DATA INFILE '/data/bulk_data.csv' INTO TABLE import_table;

-- é‡æ–°å¯ç”¨ç´¢å¼•
ALTER TABLE import_table ENABLE KEYS;
```

### 7.3 æ›´æ–°åˆ é™¤æ€§èƒ½ä¼˜åŒ–


#### 7.3.1 åˆ†æ‰¹å¤„ç†ç­–ç•¥


**å¤§æ‰¹é‡æ›´æ–°ä¼˜åŒ–**ï¼š
```sql
-- åˆ†æ‰¹æ›´æ–°ï¼Œé¿å…é•¿æ—¶é—´é”è¡¨
DELIMITER $
CREATE PROCEDURE BatchUpdate()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE batch_size INT DEFAULT 1000;
    DECLARE affected_rows INT;
    
    -- å¾ªç¯åˆ†æ‰¹æ›´æ–°
    WHILE TRUE DO
        UPDATE large_table 
        SET status = 'processed', updated_at = NOW()
        WHERE status = 'pending' 
        LIMIT batch_size;
        
        SET affected_rows = ROW_COUNT();
        
        -- å¦‚æœå½±å“è¡Œæ•°å°äºbatch_sizeï¼Œè¯´æ˜å¤„ç†å®Œæ¯•
        IF affected_rows < batch_size THEN
            LEAVE;
        END IF;
        
        -- çŸ­æš‚ä¼‘æ¯ï¼Œé‡Šæ”¾é”
        SELECT SLEEP(0.1);
    END WHILE;
END$
DELIMITER ;

CALL BatchUpdate();
```

**å®‰å…¨çš„å¤§æ‰¹é‡åˆ é™¤**ï¼š
```sql
-- åˆ†æ‰¹åˆ é™¤å†å²æ•°æ®
DELETE FROM access_logs 
WHERE log_date < DATE_SUB(NOW(), INTERVAL 1 YEAR)
ORDER BY log_date 
LIMIT 10000;

-- å¾ªç¯æ‰§è¡Œç›´åˆ°åˆ é™¤å®Œæ¯•
-- å¯ä»¥ç”¨å­˜å‚¨è¿‡ç¨‹æˆ–åº”ç”¨ç¨‹åºæ§åˆ¶
```

#### 7.3.2 ç´¢å¼•å¯¹DMLæ€§èƒ½çš„å½±å“


**ç´¢å¼•ç»´æŠ¤å¼€é”€**ï¼š
```
DMLæ“ä½œå¯¹ç´¢å¼•çš„å½±å“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ“ä½œç±»å‹    â”‚ ä¸»é”®ç´¢å¼•    â”‚ æ™®é€šç´¢å¼•    â”‚ å”¯ä¸€ç´¢å¼•    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INSERT      â”‚ éœ€è¦ç»´æŠ¤    â”‚ éœ€è¦ç»´æŠ¤    â”‚ éœ€è¦æ£€æŸ¥+ç»´æŠ¤â”‚
â”‚ UPDATE      â”‚ å¯èƒ½éœ€è¦    â”‚ å­—æ®µå˜åŒ–æ—¶  â”‚ å­—æ®µå˜åŒ–æ—¶  â”‚
â”‚ DELETE      â”‚ éœ€è¦ç»´æŠ¤    â”‚ éœ€è¦ç»´æŠ¤    â”‚ éœ€è¦ç»´æŠ¤    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–å»ºè®®ï¼š
â€¢ é¿å…è¿‡å¤šä¸å¿…è¦çš„ç´¢å¼•
â€¢ æ‰¹é‡æ“ä½œæ—¶è€ƒè™‘ä¸´æ—¶åˆ é™¤ç´¢å¼•
â€¢ å¤åˆç´¢å¼•æ¯”å¤šä¸ªå•åˆ—ç´¢å¼•æ•ˆç‡é«˜
```

### 7.4 ç›‘æ§ä¸è¯Šæ–­


#### 7.4.1 æ‰§è¡ŒçŠ¶æ€ç›‘æ§


**DMLæ‰§è¡Œä¿¡æ¯è·å–**ï¼š
```sql
-- æŸ¥çœ‹æœ€åæ‰§è¡Œçš„DMLå½±å“è¡Œæ•°
SELECT ROW_COUNT() AS affected_rows;

-- æŸ¥çœ‹æœ€åæ’å…¥çš„è‡ªå¢ID
SELECT LAST_INSERT_ID() AS last_id;

-- æŸ¥çœ‹æ‰§è¡Œè­¦å‘Š
SHOW WARNINGS;

-- æŸ¥çœ‹æ‰§è¡Œé”™è¯¯
SHOW ERRORS;

-- è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
GET DIAGNOSTICS CONDITION 1 
    @errno = MYSQL_ERRNO, 
    @sqlstate = RETURNED_SQLSTATE, 
    @text = MESSAGE_TEXT;
SELECT @errno, @sqlstate, @text;
```

#### 7.4.2 æ€§èƒ½åˆ†æå·¥å…·


**æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’åˆ†æ**ï¼š
```sql
-- åˆ†æSELECTæŸ¥è¯¢è®¡åˆ’
EXPLAIN SELECT * FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
WHERE o.order_date >= '2024-01-01';

-- æ ¼å¼åŒ–è¾“å‡ºæ‰§è¡Œè®¡åˆ’
EXPLAIN FORMAT=JSON 
SELECT * FROM orders 
WHERE customer_id = 1001 AND status = 'completed';

-- åˆ†æUPDATE/DELETEæ‰§è¡Œè®¡åˆ’
EXPLAIN UPDATE products 
SET price = price * 1.1 
WHERE category_id = 1;
```

**æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ**ï¼š
```sql
-- å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;  -- è¶…è¿‡2ç§’è®°å½•
SET GLOBAL log_queries_not_using_indexes = 'ON';

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢çŠ¶æ€
SHOW VARIABLES LIKE 'slow_query%';
SHOW VARIABLES LIKE 'long_query_time';
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


**DMLå››å¤§æ ¸å¿ƒè¯­å¥**ï¼š
- **SELECT**ï¼šæ•°æ®æŸ¥è¯¢ï¼Œæ”¯æŒå¤æ‚æ¡ä»¶ã€è¿æ¥ã€åˆ†ç»„ã€æ’åº
- **INSERT**ï¼šæ•°æ®æ’å…¥ï¼Œæ”¯æŒå•è¡Œã€æ‰¹é‡ã€UPSERTæ“ä½œ
- **UPDATE**ï¼šæ•°æ®æ›´æ–°ï¼Œæ”¯æŒå•è¡¨ã€å¤šè¡¨ã€å­æŸ¥è¯¢æ›´æ–°
- **DELETE**ï¼šæ•°æ®åˆ é™¤ï¼Œæ”¯æŒæ¡ä»¶åˆ é™¤ã€è¿æ¥åˆ é™¤ã€æ‰¹é‡æ¸…ç†

**å…³é”®è¯­æ³•ç»“æ„**ï¼š
```
SELECTè¯­æ³•é¡ºåºï¼šSELECT â†’ FROM â†’ WHERE â†’ GROUP BY â†’ HAVING â†’ ORDER BY â†’ LIMIT
INSERTè¯­æ³•å½¢å¼ï¼šæ ‡å‡†INSERTã€æ‰¹é‡INSERTã€SELECT INSERTã€REPLACE
UPDATEæ›´æ–°æ–¹å¼ï¼šå•è¡¨UPDATEã€JOIN UPDATEã€å­æŸ¥è¯¢UPDATE
DELETEåˆ é™¤ç±»å‹ï¼šæ¡ä»¶DELETEã€JOIN DELETEã€TRUNCATEæ¸…ç©º
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**SELECTæŸ¥è¯¢ä¼˜åŒ–å…³é”®**ï¼š
- **ç´¢å¼•ä½¿ç”¨**ï¼šWHEREæ¡ä»¶ä¼˜å…ˆä½¿ç”¨ç´¢å¼•å­—æ®µï¼Œé¿å…å‡½æ•°æ“ä½œ
- **è¿æ¥ä¼˜åŒ–**ï¼šå°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œé€‰æ‹©åˆé€‚çš„è¿æ¥ç±»å‹
- **åˆ†é¡µä¼˜åŒ–**ï¼šæ·±åº¦åˆ†é¡µç”¨æ¸¸æ ‡æ–¹æ³•ï¼Œé¿å…å¤§åç§»é‡
- **å­æŸ¥è¯¢é€‰æ‹©**ï¼šEXISTS vs INçš„æ€§èƒ½è€ƒé‡

**INSERTæ€§èƒ½è¦ç‚¹**ï¼š
- **æ‰¹é‡æ’å…¥**ï¼šæ¯”å•æ¡æ’å…¥æ€§èƒ½æå‡å‡ åå€
- **äº‹åŠ¡æ§åˆ¶**ï¼šæ‰¹é‡æ“ä½œç”¨äº‹åŠ¡åŒ…è£…ï¼Œæé«˜ä¸€è‡´æ€§
- **UPSERTåœºæ™¯**ï¼šINSERT...ON DUPLICATE KEY UPDATEå¤„ç†å†²çª

**UPDATE/DELETEä¼˜åŒ–**ï¼š
- **åˆ†æ‰¹å¤„ç†**ï¼šå¤§æ‰¹é‡æ“ä½œåˆ†æ‰¹è¿›è¡Œï¼Œé¿å…é•¿æ—¶é—´é”è¡¨
- **æ¡ä»¶ä¼˜åŒ–**ï¼šä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ›´æ–°/åˆ é™¤æ¡ä»¶
- **å®‰å…¨æ“ä½œ**ï¼šé‡è¦æ“ä½œå‰å…ˆé¢„è§ˆï¼Œäº‹åŠ¡ä¸­éªŒè¯

### 8.3 é«˜çº§ç‰¹æ€§åº”ç”¨


**çª—å£å‡½æ•°åº”ç”¨**ï¼š
- **æ’ååˆ†æ**ï¼šROW_NUMBER()ã€RANK()ã€DENSE_RANK()
- **æ•°æ®å¯¹æ¯”**ï¼šLAG()ã€LEAD()è·å–ç›¸é‚»è¡Œæ•°æ®
- **ç´¯ç§¯è®¡ç®—**ï¼šSUM() OVER()å®ç°ç´¯ç§¯æ±‚å’Œ
- **åˆ†ç»„ç»Ÿè®¡**ï¼šå„ç§èšåˆçª—å£å‡½æ•°

**CTEé€’å½’æŸ¥è¯¢**ï¼š
- **å±‚æ¬¡æ•°æ®**ï¼šç»„ç»‡æ¶æ„ã€åˆ†ç±»æ ‘å½¢ç»“æ„æŸ¥è¯¢
- **åºåˆ—ç”Ÿæˆ**ï¼šæ—¥æœŸåºåˆ—ã€æ•°å­—åºåˆ—ç”Ÿæˆ
- **å›¾éå†**ï¼šå¤æ‚å…³ç³»æ•°æ®çš„éå†æŸ¥è¯¢

### 8.4 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**æŸ¥è¯¢ä¼˜åŒ–æ ¸å¿ƒ**ï¼š
```
æ€§èƒ½ä¼˜åŒ–é‡‘å­—å¡”ï¼ˆé‡è¦æ€§ä»ä¸‹åˆ°ä¸Šï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åº”ç”¨å±‚ä¼˜åŒ–           â”‚  â† ä¸šåŠ¡é€»è¾‘ã€ç¼“å­˜ç­–ç•¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        SQLè¯­å¥ä¼˜åŒ–          â”‚  â† æŸ¥è¯¢é‡å†™ã€ç´¢å¼•ä½¿ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        æ•°æ®åº“è®¾è®¡ä¼˜åŒ–       â”‚  â† è¡¨ç»“æ„ã€ç´¢å¼•è®¾è®¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ç¡¬ä»¶é…ç½®ä¼˜åŒ–         â”‚  â† CPUã€å†…å­˜ã€ç£ç›˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æœ€ä½³å®è·µåŸåˆ™**ï¼š
- **ç´¢å¼•è®¾è®¡**ï¼šè¦†ç›–ç´¢å¼•>å¤åˆç´¢å¼•>å•åˆ—ç´¢å¼•
- **æŸ¥è¯¢ç¼–å†™**ï¼šç®€å•æ˜ç¡®>å¤æ‚åµŒå¥—
- **æ•°æ®æ“ä½œ**ï¼šæ‰¹é‡æ“ä½œ>é€æ¡æ“ä½œ
- **äº‹åŠ¡ä½¿ç”¨**ï¼šçŸ­äº‹åŠ¡>é•¿äº‹åŠ¡

### 8.5 å®é™…åº”ç”¨æŒ‡å¯¼


**ä¸šåŠ¡åœºæ™¯å¯¹åº”**ï¼š
```
å¸¸è§ä¸šåŠ¡åœºæ™¯çš„DMLåº”ç”¨ï¼š
â€¢ ç”¨æˆ·æ³¨å†Œï¼šINSERT...ON DUPLICATE KEY UPDATE
â€¢ å•†å“æœç´¢ï¼šå…¨æ–‡æœç´¢ + å¤åˆç´¢å¼•æŸ¥è¯¢
â€¢ è®¢å•ç»Ÿè®¡ï¼šGROUP BY + çª—å£å‡½æ•°
â€¢ æ•°æ®æ¸…ç†ï¼šæ‰¹é‡DELETE + åˆ†é¡µå¤„ç†
â€¢ æŠ¥è¡¨ç”Ÿæˆï¼šå¤æ‚JOIN + èšåˆå‡½æ•°
â€¢ åº“å­˜ç®¡ç†ï¼šäº‹åŠ¡ + SELECT...FOR UPDATE
```

**å¼€å‘å»ºè®®**ï¼š
1. **æµ‹è¯•é©±åŠ¨**ï¼šæ‰€æœ‰DMLè¯­å¥å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
2. **æ€§èƒ½ç›‘æ§**ï¼šå…³æ³¨æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå®šæœŸä¼˜åŒ–
3. **å®‰å…¨ç¬¬ä¸€**ï¼šé‡è¦æ“ä½œä½¿ç”¨äº‹åŠ¡ï¼Œåˆ é™¤å‰å¤‡ä»½
4. **æ¸è¿›ä¼˜åŒ–**ï¼šä»æœ€å½±å“æ€§èƒ½çš„SQLå¼€å§‹ä¼˜åŒ–
5. **æ–‡æ¡£è®°å½•**ï¼šå¤æ‚æŸ¥è¯¢æ·»åŠ æ³¨é‡Šï¼Œä¾¿äºç»´æŠ¤

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æŸ¥è¯¢ä¼˜åŒ–é‡ç´¢å¼•ï¼Œè¿æ¥æ’åºè¦èµ°å¿ƒ
- æ‰¹é‡æ“ä½œèƒœå•æ¡ï¼Œäº‹åŠ¡å®‰å…¨æ˜¯æ ¹æœ¬  
- åˆ†é¡µæ·±åº¦ç”¨æ¸¸æ ‡ï¼Œå¤§è¡¨æ“ä½œè¦åˆ†æ‰¹
- ç›‘æ§æ—¥å¿—å¸¸åˆ†æï¼Œæ€§èƒ½ç“¶é¢ˆæ—©å‘ç°