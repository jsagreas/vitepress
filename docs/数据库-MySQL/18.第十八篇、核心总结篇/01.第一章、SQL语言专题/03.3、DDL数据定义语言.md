---
title: 3ã€DDLæ•°æ®å®šä¹‰è¯­è¨€
---
## ğŸ“š ç›®å½•

1. [DDLæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ](#1-ddlæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ)
2. [æ•°æ®åº“æ“ä½œDDL](#2-æ•°æ®åº“æ“ä½œddl)
3. [æ•°æ®è¡¨æ“ä½œDDL](#3-æ•°æ®è¡¨æ“ä½œddl)
4. [è¡¨ç»“æ„ä¿®æ”¹DDL](#4-è¡¨ç»“æ„ä¿®æ”¹ddl)
5. [ç´¢å¼•æ“ä½œDDL](#5-ç´¢å¼•æ“ä½œddl)
6. [çº¦æŸæ“ä½œDDL](#6-çº¦æŸæ“ä½œddl)
7. [è§†å›¾æ“ä½œDDL](#7-è§†å›¾æ“ä½œddl)
8. [å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°DDL](#8-å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°ddl)
9. [è§¦å‘å™¨DDL](#9-è§¦å‘å™¨ddl)
10. [äº‹ä»¶è°ƒåº¦å™¨DDL](#10-äº‹ä»¶è°ƒåº¦å™¨ddl)
11. [åˆ†åŒºè¡¨DDL](#11-åˆ†åŒºè¡¨ddl)
12. [è¡¨ç©ºé—´DDL](#12-è¡¨ç©ºé—´ddl)
13. [ç”¨æˆ·ä¸æƒé™DDL](#13-ç”¨æˆ·ä¸æƒé™ddl)
14. [é«˜çº§DDLç‰¹æ€§](#14-é«˜çº§ddlç‰¹æ€§)
15. [åœ¨çº¿DDLæ“ä½œ](#15-åœ¨çº¿ddlæ“ä½œ)
16. [DDLæ€§èƒ½ä¼˜åŒ–ä¸æ•…éšœå¤„ç†](#16-ddlæ€§èƒ½ä¼˜åŒ–ä¸æ•…éšœå¤„ç†)
17. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#17-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“– DDLæ¦‚è¿°ä¸åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯DDL


**ğŸ”¸ DDLçš„é€šä¿—ç†è§£**
DDLï¼ˆData Definition Languageï¼‰å°±æ˜¯æ•°æ®å®šä¹‰è¯­è¨€ï¼Œç®€å•è¯´å°±æ˜¯ç”¨æ¥"æ­å»ºæˆ¿å­æ¡†æ¶"çš„è¯­è¨€ã€‚å¦‚æœæŠŠæ•°æ®åº“æ¯”ä½œä¸€ä¸ªå°åŒºï¼ŒDDLå°±æ˜¯ç”¨æ¥ï¼š
- å»ºæˆ¿å­ï¼ˆåˆ›å»ºè¡¨ï¼‰
- è£…ä¿®æˆ¿å­ï¼ˆä¿®æ”¹è¡¨ç»“æ„ï¼‰
- æ‹†æˆ¿å­ï¼ˆåˆ é™¤è¡¨ï¼‰
- è§„åˆ’å°åŒºï¼ˆåˆ›å»ºæ•°æ®åº“ï¼‰

**ğŸ’¡ DDLçš„æ ¸å¿ƒä½œç”¨**
```
æ•°æ®åº“å±‚é¢ï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®åº“
è¡¨ç»“æ„å±‚é¢ï¼šå®šä¹‰è¡¨ç»“æ„ã€å­—æ®µç±»å‹ã€çº¦æŸæ¡ä»¶
ç´¢å¼•å±‚é¢ï¼šåˆ›å»ºã€åˆ é™¤ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
æƒé™å±‚é¢ï¼šç®¡ç†ç”¨æˆ·ã€è§’è‰²ã€æƒé™åˆ†é…
å¯¹è±¡å±‚é¢ï¼šåˆ›å»ºè§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰
```

### 1.2 DDLä¸å…¶ä»–SQLè¯­è¨€çš„åŒºåˆ«


**ğŸ“‹ SQLè¯­è¨€åˆ†ç±»å¯¹æ¯”**

| è¯­è¨€ç±»å‹ | **ä½œç”¨** | **å¸¸ç”¨è¯­å¥** | **é€šä¿—æ¯”å–»** |
|---------|----------|-------------|-------------|
| **DDL** | å®šä¹‰æ•°æ®ç»“æ„ | CREATE, ALTER, DROP | å»ºæˆ¿å­ã€è£…ä¿®æˆ¿å­ |
| **DML** | æ“ä½œæ•°æ®å†…å®¹ | INSERT, UPDATE, DELETE | æ¬å®¶å…·ã€æ•´ç†ç‰©å“ |
| **DQL** | æŸ¥è¯¢æ•°æ® | SELECT | æ‰¾ä¸œè¥¿ã€çœ‹åº“å­˜ |
| **DCL** | æ§åˆ¶æƒé™ | GRANT, REVOKE | ç®¡ç†é’¥åŒ™ã€é—¨ç¦å¡ |

### 1.3 DDLè¯­å¥çš„ç‰¹ç‚¹


**âš¡ æ‰§è¡Œç‰¹æ€§**
- **è‡ªåŠ¨æäº¤**ï¼šDDLè¯­å¥æ‰§è¡Œåç«‹å³ç”Ÿæ•ˆï¼Œæ— æ³•å›æ»š
- **é”è¡¨æ“ä½œ**ï¼šæ‰§è¡Œæ—¶å¯èƒ½é”å®šç›¸å…³è¡¨ï¼Œå½±å“å¹¶å‘æ€§èƒ½
- **ç»“æ„æ€§å˜æ›´**ï¼šæ”¹å˜çš„æ˜¯æ•°æ®åº“çš„ç»“æ„ï¼Œè€Œéæ•°æ®å†…å®¹
- **æƒé™è¦æ±‚**ï¼šé€šå¸¸éœ€è¦è¾ƒé«˜çš„æ•°æ®åº“æƒé™

---

## 2. ğŸ—„ï¸ æ•°æ®åº“æ“ä½œDDL


### 2.1 æ•°æ®åº“åˆ›å»ºè¯¦è§£


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦åˆ›å»ºæ•°æ®åº“**
æ•°æ®åº“å°±åƒä¸€ä¸ªç‹¬ç«‹çš„ä»“åº“ï¼Œä¸åŒé¡¹ç›®çš„æ•°æ®éœ€è¦åˆ†å¼€å­˜å‚¨ï¼Œé¿å…æ··ä¹±ã€‚å°±åƒä¸åŒå…¬å¸ä¸ä¼šæŠŠè´§ç‰©æ”¾åœ¨åŒä¸€ä¸ªä»“åº“é‡Œã€‚

**ğŸ“ åŸºç¡€åˆ›å»ºè¯­æ³•**
```sql
-- æœ€ç®€å•çš„åˆ›å»ºæ–¹å¼
CREATE DATABASE mystore;

-- å®‰å…¨åˆ›å»ºæ–¹å¼ï¼ˆé¿å…é‡å¤åˆ›å»ºæŠ¥é”™ï¼‰
CREATE DATABASE IF NOT EXISTS mystore;

-- SCHEMAæ˜¯DATABASEçš„åˆ«åï¼ˆå®Œå…¨ç›¸åŒï¼‰
CREATE SCHEMA mystore;
```

**ğŸ”§ å®Œæ•´åˆ›å»ºè¯­æ³•**
```sql
CREATE DATABASE mystore
    CHARACTER SET utf8mb4           -- å­—ç¬¦é›†ï¼šæ”¯æŒemojiå’Œå„ç§ç‰¹æ®Šå­—ç¬¦
    COLLATE utf8mb4_unicode_ci;     -- æ’åºè§„åˆ™ï¼šæ”¯æŒå¤šè¯­è¨€æ­£ç¡®æ’åº
```

**ğŸ’¡ å­—ç¬¦é›†å’Œæ’åºè§„åˆ™è§£é‡Š**
```
CHARACTER SETï¼ˆå­—ç¬¦é›†ï¼‰ï¼š
- utf8mb4ï¼šMySQLä¸­çœŸæ­£çš„UTF-8ï¼Œæ”¯æŒ4å­—èŠ‚å­—ç¬¦ï¼ˆemojiã€ç‰¹æ®Šç¬¦å·ï¼‰
- utf8ï¼šMySQLä¸­çš„ä¼ªUTF-8ï¼Œåªæ”¯æŒ3å­—èŠ‚ï¼Œä¸å»ºè®®ä½¿ç”¨

COLLATEï¼ˆæ’åºè§„åˆ™ï¼‰ï¼š
- utf8mb4_unicode_ciï¼šåŸºäºUnicodeæ ‡å‡†ï¼Œå¤šè¯­è¨€æ”¯æŒå¥½ï¼Œä¸åŒºåˆ†å¤§å°å†™
- utf8mb4_general_ciï¼šæ€§èƒ½æ›´å¥½ï¼Œä½†å¤šè¯­è¨€æ”¯æŒç¨å·®
- utf8mb4_binï¼šåŒºåˆ†å¤§å°å†™ï¼Œç²¾ç¡®åŒ¹é…
```

### 2.2 æ•°æ®åº“ä¿®æ”¹æ“ä½œ


**ğŸ”„ ä¿®æ”¹æ•°æ®åº“å±æ€§**
```sql
-- ä¿®æ”¹å­—ç¬¦é›†ï¼ˆå½±å“æ–°å»ºè¡¨çš„é»˜è®¤å­—ç¬¦é›†ï¼‰
ALTER DATABASE mystore CHARACTER SET utf8mb4;

-- ä¿®æ”¹æ’åºè§„åˆ™
ALTER DATABASE mystore COLLATE utf8mb4_unicode_ci;

-- ä¸€æ¬¡æ€§ä¿®æ”¹å­—ç¬¦é›†å’Œæ’åºè§„åˆ™
ALTER DATABASE mystore 
    CHARACTER SET utf8mb4 
    COLLATE utf8mb4_unicode_ci;
```

**âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹**
- ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†ä¸ä¼šå½±å“å·²å­˜åœ¨çš„è¡¨
- åªå½±å“ä¹‹åæ–°åˆ›å»ºçš„è¡¨çš„é»˜è®¤å­—ç¬¦é›†
- å·²æœ‰è¡¨éœ€è¦å•ç‹¬ä¿®æ”¹å­—ç¬¦é›†

### 2.3 æ•°æ®åº“åˆ é™¤æ“ä½œ


**ğŸ—‘ï¸ åˆ é™¤è¯­æ³•**
```sql
-- ç›´æ¥åˆ é™¤ï¼ˆå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ä¼šæŠ¥é”™ï¼‰
DROP DATABASE mystore;

-- å®‰å…¨åˆ é™¤ï¼ˆä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼‰
DROP DATABASE IF EXISTS mystore;

-- ä½¿ç”¨SCHEMAå…³é”®å­—ï¼ˆæ•ˆæœç›¸åŒï¼‰
DROP SCHEMA mystore;
```

**ğŸš¨ åˆ é™¤æ³¨æ„äº‹é¡¹**
```
å±é™©æ€§ï¼šåˆ é™¤æ•°æ®åº“ä¼šæ°¸ä¹…åˆ é™¤æ‰€æœ‰æ•°æ®ï¼Œæ— æ³•æ¢å¤
å½±å“èŒƒå›´ï¼šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ç­‰éƒ½ä¼šè¢«åˆ é™¤
æƒé™è¦æ±‚ï¼šéœ€è¦DROPæƒé™ï¼Œé€šå¸¸åªæœ‰ç®¡ç†å‘˜å…·å¤‡
å»ºè®®æ“ä½œï¼šåˆ é™¤å‰å¿…é¡»å¤‡ä»½é‡è¦æ•°æ®
```

### 2.4 æ•°æ®åº“æŸ¥çœ‹æ“ä½œ


**ğŸ‘€ æŸ¥çœ‹æ•°æ®åº“åˆ—è¡¨**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“
SHOW DATABASES;

-- SCHEMASå’ŒDATABASESæ˜¯åŒä¸€ä¸ªæ„æ€
SHOW SCHEMAS;

-- æ¨¡ç³ŠæŸ¥æ‰¾æ•°æ®åº“
SHOW DATABASES LIKE 'my%';
```

**ğŸ” æŸ¥çœ‹æ•°æ®åº“è¯¦ç»†ä¿¡æ¯**
```sql
-- æŸ¥çœ‹æ•°æ®åº“åˆ›å»ºè¯­å¥
SHOW CREATE DATABASE mystore;

-- æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“
SELECT DATABASE();

-- æŸ¥çœ‹æ•°æ®åº“å­—ç¬¦é›†ä¿¡æ¯
SELECT 
    SCHEMA_NAME,
    DEFAULT_CHARACTER_SET_NAME,
    DEFAULT_COLLATION_NAME
FROM information_schema.SCHEMATA
WHERE SCHEMA_NAME = 'mystore';
```

---

## 3. ğŸ—ï¸ æ•°æ®è¡¨æ“ä½œDDL


### 3.1 è¡¨åˆ›å»ºåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯æ•°æ®è¡¨**
æ•°æ®è¡¨å°±åƒExcelè¡¨æ ¼ï¼Œæœ‰è¡Œå’Œåˆ—ã€‚æ¯ä¸€åˆ—å®šä¹‰äº†æ•°æ®çš„ç±»å‹ï¼ˆæ–‡å­—ã€æ•°å­—ã€æ—¥æœŸç­‰ï¼‰ï¼Œæ¯ä¸€è¡Œå­˜å‚¨ä¸€æ¡å®Œæ•´çš„è®°å½•ã€‚

**ğŸ  è¡¨åˆ›å»ºçš„åŸºæœ¬æ€è·¯**
```
1. ç¡®å®šå­˜å‚¨ä»€ä¹ˆæ•°æ®ï¼ˆç”¨æˆ·ä¿¡æ¯ã€è®¢å•è®°å½•ç­‰ï¼‰
2. å®šä¹‰éœ€è¦å“ªäº›å­—æ®µï¼ˆå§“åã€é‚®ç®±ã€ç”µè¯ç­‰ï¼‰
3. ç¡®å®šæ¯ä¸ªå­—æ®µçš„æ•°æ®ç±»å‹ï¼ˆæ–‡å­—å¤šé•¿ã€æ•°å­—å¤šå¤§ç­‰ï¼‰
4. è®¾ç½®çº¦æŸæ¡ä»¶ï¼ˆå“ªäº›å­—æ®µå¿…å¡«ã€å“ªäº›è¦å”¯ä¸€ç­‰ï¼‰
5. è€ƒè™‘æ€§èƒ½ä¼˜åŒ–ï¼ˆéœ€è¦å“ªäº›ç´¢å¼•ç­‰ï¼‰
```

### 3.2 å­—æ®µå®šä¹‰è¯¦è§£


**ğŸ“ å­—æ®µå®šä¹‰è¯­æ³•ç»“æ„**
```sql
column_name data_type [çº¦æŸæ¡ä»¶] [é»˜è®¤å€¼] [æ³¨é‡Š]
```

**ğŸ”§ å¸¸ç”¨æ•°æ®ç±»å‹è¯¦è§£**
```sql
-- æ•°å­—ç±»å‹
TINYINT     -- å¾ˆå°çš„æ•´æ•°(-128åˆ°127)ï¼Œå¸¸ç”¨äºçŠ¶æ€å€¼
SMALLINT    -- å°æ•´æ•°(-32768åˆ°32767)
MEDIUMINT   -- ä¸­ç­‰æ•´æ•°ï¼Œæ¯”è¾ƒå°‘ç”¨
INT         -- æ ‡å‡†æ•´æ•°ï¼Œæœ€å¸¸ç”¨(-2147483648åˆ°2147483647)
BIGINT      -- å¤§æ•´æ•°ï¼Œç”¨äºIDæˆ–å¤§æ•°å€¼

-- å°æ•°ç±»å‹
DECIMAL(10,2)   -- ç²¾ç¡®å°æ•°ï¼Œ10ä½æ•°å­—ï¼Œ2ä½å°æ•°ï¼Œç”¨äºé‡‘é¢
FLOAT           -- å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œç²¾åº¦è¾ƒä½
DOUBLE          -- åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œç²¾åº¦è¾ƒé«˜

-- å­—ç¬¦ä¸²ç±»å‹
CHAR(10)        -- å®šé•¿å­—ç¬¦ä¸²ï¼Œä¸è¶³è¡¥ç©ºæ ¼ï¼Œé€‚åˆå›ºå®šé•¿åº¦æ•°æ®
VARCHAR(255)    -- å˜é•¿å­—ç¬¦ä¸²ï¼Œæœ€å¸¸ç”¨ï¼Œæ ¹æ®å®é™…å†…å®¹å ç©ºé—´
TEXT            -- é•¿æ–‡æœ¬ï¼Œ65535å­—ç¬¦ä»¥å†…
LONGTEXT        -- è¶…é•¿æ–‡æœ¬ï¼Œå­˜å‚¨æ–‡ç« å†…å®¹

-- æ—¥æœŸæ—¶é—´ç±»å‹
DATE            -- æ—¥æœŸï¼Œæ ¼å¼ï¼šYYYY-MM-DD
TIME            -- æ—¶é—´ï¼Œæ ¼å¼ï¼šHH:MM:SS
DATETIME        -- æ—¥æœŸæ—¶é—´ï¼Œæ ¼å¼ï¼šYYYY-MM-DD HH:MM:SS
TIMESTAMP       -- æ—¶é—´æˆ³ï¼Œè‡ªåŠ¨æ›´æ–°ï¼Œå¸¸ç”¨äºè®°å½•æ“ä½œæ—¶é—´

-- å…¶ä»–å¸¸ç”¨ç±»å‹
JSON            -- JSONæ•°æ®ï¼ŒMySQL 5.7+æ”¯æŒ
BOOLEAN         -- å¸ƒå°”å€¼ï¼Œå®é™…æ˜¯TINYINT(1)
```

**ğŸ›¡ï¸ çº¦æŸæ¡ä»¶è¯¦è§£**
```sql
NOT NULL        -- ä¸èƒ½ä¸ºç©ºï¼Œå¿…å¡«å­—æ®µ
NULL            -- å…è®¸ä¸ºç©ºï¼ˆé»˜è®¤å€¼ï¼‰
DEFAULT value   -- é»˜è®¤å€¼ï¼Œæ’å…¥æ—¶ä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤å€¼
AUTO_INCREMENT  -- è‡ªåŠ¨é€’å¢ï¼Œé€šå¸¸ç”¨äºä¸»é”®ID
UNIQUE          -- å”¯ä¸€çº¦æŸï¼Œä¸å…è®¸é‡å¤å€¼
PRIMARY KEY     -- ä¸»é”®ï¼Œä¸èƒ½ä¸ºç©ºä¸”å”¯ä¸€
COMMENT 'æ³¨é‡Š'   -- å­—æ®µè¯´æ˜ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤
```

### 3.3 å®ç”¨è¡¨åˆ›å»ºç¤ºä¾‹


**ğŸ‘¤ ç”¨æˆ·è¡¨åˆ›å»ºç¤ºä¾‹**
```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç”¨æˆ·IDï¼Œä¸»é”®',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·åï¼Œå”¯ä¸€',
    email VARCHAR(100) NOT NULL UNIQUE COMMENT 'é‚®ç®±ï¼Œå”¯ä¸€',
    password VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œå€¼',
    phone VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1æ­£å¸¸ 0ç¦ç”¨',
    avatar_url VARCHAR(500) DEFAULT NULL COMMENT 'å¤´åƒURL',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) ENGINE=InnoDB CHARACTER SET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·ä¿¡æ¯è¡¨';
```

**ğŸ›’ è®¢å•è¡¨åˆ›å»ºç¤ºä¾‹**
```sql
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'è®¢å•ID',
    order_no VARCHAR(32) NOT NULL UNIQUE COMMENT 'è®¢å•å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    total_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT 'è®¢å•æ€»é‡‘é¢',
    status TINYINT NOT NULL DEFAULT 1 COMMENT 'è®¢å•çŠ¶æ€ï¼š1å¾…ä»˜æ¬¾ 2å·²ä»˜æ¬¾ 3å·²å‘è´§ 4å·²å®Œæˆ 5å·²å–æ¶ˆ',
    shipping_address JSON COMMENT 'æ”¶è´§åœ°å€ä¿¡æ¯',
    order_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸‹å•æ—¶é—´',
    pay_time TIMESTAMP NULL COMMENT 'æ”¯ä»˜æ—¶é—´',
    
    -- æ·»åŠ ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½
    INDEX idx_order_no (order_no),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_order_time (order_time),
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT
) ENGINE=InnoDB CHARACTER SET=utf8mb4 COMMENT='è®¢å•ä¿¡æ¯è¡¨';
```

### 3.4 è¡¨é€‰é¡¹è®¾ç½®è¯¦è§£


**âš™ï¸ å­˜å‚¨å¼•æ“é€‰æ‹©**
```sql
ENGINE=InnoDB    -- é»˜è®¤å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€å¤–é”®ã€è¡Œçº§é”
ENGINE=MyISAM    -- æ—§å¼•æ“ï¼Œä¸æ”¯æŒäº‹åŠ¡ï¼ŒæŸ¥è¯¢å¿«ä½†å®‰å…¨æ€§ä½
ENGINE=MEMORY    -- å†…å­˜å¼•æ“ï¼Œæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œé‡å¯ä¸¢å¤±
```

**ğŸ“Š å…¶ä»–è¡¨é€‰é¡¹**
```sql
CREATE TABLE test_table (
    id INT PRIMARY KEY
) 
ENGINE=InnoDB                           -- å­˜å‚¨å¼•æ“
CHARACTER SET=utf8mb4                   -- å­—ç¬¦é›†
COLLATE=utf8mb4_unicode_ci             -- æ’åºè§„åˆ™
COMMENT='æµ‹è¯•è¡¨'                        -- è¡¨æ³¨é‡Š
AUTO_INCREMENT=1000                     -- è‡ªå¢èµ·å§‹å€¼
ROW_FORMAT=DYNAMIC                      -- è¡Œæ ¼å¼ï¼ˆå‹ç¼©ç›¸å…³ï¼‰
MAX_ROWS=1000000                        -- é¢„è®¡æœ€å¤§è¡Œæ•°
AVG_ROW_LENGTH=100;                     -- å¹³å‡è¡Œé•¿åº¦
```

### 3.5 ç‰¹æ®Šè¡¨åˆ›å»ºæ–¹å¼


**â³ ä¸´æ—¶è¡¨**
```sql
-- ä¸´æ—¶è¡¨åªåœ¨å½“å‰ä¼šè¯ä¸­å­˜åœ¨ï¼Œè¿æ¥æ–­å¼€åè‡ªåŠ¨åˆ é™¤
CREATE TEMPORARY TABLE temp_users (
    id INT,
    name VARCHAR(50)
);
```

**ğŸ“‹ å¤åˆ¶è¡¨ç»“æ„**
```sql
-- åªå¤åˆ¶è¡¨ç»“æ„ï¼Œä¸å¤åˆ¶æ•°æ®
CREATE TABLE users_backup LIKE users;

-- å¤åˆ¶è¡¨ç»“æ„å¹¶å¤åˆ¶æ•°æ®
CREATE TABLE users_backup AS SELECT * FROM users;

-- å¤åˆ¶è¡¨ç»“æ„å¹¶å¤åˆ¶éƒ¨åˆ†æ•°æ®
CREATE TABLE active_users AS 
SELECT * FROM users WHERE status = 1;
```

---

## 4. ğŸ”§ è¡¨ç»“æ„ä¿®æ”¹DDL


### 4.1 æ·»åŠ å­—æ®µæ“ä½œ


**ğŸ”¸ æ·»åŠ å­—æ®µçš„åº”ç”¨åœºæ™¯**
éšç€ä¸šåŠ¡å‘å±•ï¼Œç»å¸¸éœ€è¦ç»™ç°æœ‰è¡¨å¢åŠ æ–°åŠŸèƒ½å­—æ®µï¼Œæ¯”å¦‚ç”¨æˆ·è¡¨éœ€è¦å¢åŠ ç”Ÿæ—¥å­—æ®µã€ç§¯åˆ†å­—æ®µç­‰ã€‚

**â• åŸºç¡€æ·»åŠ è¯­æ³•**
```sql
-- æ·»åŠ å•ä¸ªå­—æ®µï¼ˆé»˜è®¤æ·»åŠ åˆ°æœ€åï¼‰
ALTER TABLE users ADD COLUMN birthday DATE COMMENT 'ç”Ÿæ—¥';

-- æ·»åŠ å­—æ®µå¹¶æŒ‡å®šä½ç½®ï¼ˆæ·»åŠ åˆ°ç¬¬ä¸€åˆ—ï¼‰
ALTER TABLE users ADD COLUMN vip_level TINYINT DEFAULT 0 FIRST;

-- æ·»åŠ å­—æ®µåˆ°æŒ‡å®šå­—æ®µä¹‹å
ALTER TABLE users ADD COLUMN nickname VARCHAR(50) AFTER username;
```

**ğŸ”¢ æ‰¹é‡æ·»åŠ å­—æ®µ**
```sql
ALTER TABLE users 
    ADD COLUMN phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    ADD COLUMN address VARCHAR(200) COMMENT 'åœ°å€',
    ADD COLUMN points INT DEFAULT 0 COMMENT 'ç§¯åˆ†';
```

**ğŸ’¡ æ·»åŠ å­—æ®µæœ€ä½³å®è·µ**
```
1. æ–°å­—æ®µå°½é‡è®¾ç½®é»˜è®¤å€¼ï¼Œé¿å…å½±å“ç°æœ‰æ•°æ®
2. è€ƒè™‘å­—æ®µçš„æ•°æ®ç±»å‹æ˜¯å¦å¤Ÿç”¨ï¼ˆæ¯”å¦‚INTå¤Ÿç”¨å°±ä¸ç”¨BIGINTï¼‰
3. æ·»åŠ å¿…è¦çš„æ³¨é‡Šï¼Œä¾¿äºåç»­ç»´æŠ¤
4. å¤§è¡¨æ·»åŠ å­—æ®µè¦é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸ
```

### 4.2 ä¿®æ”¹å­—æ®µæ“ä½œ


**ğŸ”„ å­—æ®µä¿®æ”¹çš„å¸¸è§éœ€æ±‚**
- å­—æ®µé•¿åº¦ä¸å¤Ÿç”¨äº†ï¼ˆVARCHAR(50) â†’ VARCHAR(100)ï¼‰
- å­—æ®µç±»å‹éœ€è¦å˜æ›´ï¼ˆINT â†’ BIGINTï¼‰
- å­—æ®µåç§°éœ€è¦æ›´æ”¹
- éœ€è¦æ·»åŠ æˆ–å–æ¶ˆçº¦æŸ

**ğŸ› ï¸ ä¿®æ”¹å­—æ®µç±»å‹**
```sql
-- åªä¿®æ”¹å­—æ®µç±»å‹å’Œå±æ€§
ALTER TABLE users MODIFY COLUMN phone VARCHAR(20) NOT NULL;

-- ä¿®æ”¹å­—æ®µç±»å‹å¹¶é‡æ–°å®šä½
ALTER TABLE users MODIFY COLUMN phone VARCHAR(20) AFTER email;
```

**ğŸ“ ä¿®æ”¹å­—æ®µåå’Œç±»å‹**
```sql
-- åŒæ—¶ä¿®æ”¹å­—æ®µåå’Œç±»å‹
ALTER TABLE users CHANGE old_phone mobile_phone VARCHAR(20);

-- åªä¿®æ”¹å­—æ®µåï¼ˆç±»å‹ä¿æŒä¸å˜ï¼‰
ALTER TABLE users CHANGE phone mobile VARCHAR(20);
```

**âš ï¸ å­—æ®µä¿®æ”¹æ³¨æ„äº‹é¡¹**
```sql
-- å±é™©æ“ä½œï¼šæ•°æ®ç±»å‹è½¬æ¢å¯èƒ½ä¸¢å¤±æ•°æ®
-- æ¯”å¦‚ï¼šBIGINTæ”¹ä¸ºINTï¼Œå¤§æ•°å€¼ä¼šè¢«æˆªæ–­
-- å»ºè®®ï¼šå…ˆå¤‡ä»½æ•°æ®ï¼Œå†æ‰§è¡Œä¿®æ”¹

-- å®‰å…¨çš„æ‰©å¤§æ“ä½œ
ALTER TABLE users MODIFY COLUMN username VARCHAR(100); -- 50â†’100 å®‰å…¨

-- éœ€è¦è°¨æ…çš„ç¼©å°æ“ä½œ
ALTER TABLE users MODIFY COLUMN username VARCHAR(30);  -- 50â†’30 å¯èƒ½æˆªæ–­
```

### 4.3 åˆ é™¤å­—æ®µæ“ä½œ


**ğŸ—‘ï¸ åˆ é™¤å­—æ®µè¯­æ³•**
```sql
-- åˆ é™¤å•ä¸ªå­—æ®µ
ALTER TABLE users DROP COLUMN birthday;

-- åˆ é™¤å¤šä¸ªå­—æ®µ
ALTER TABLE users 
    DROP COLUMN phone,
    DROP COLUMN address;
```

**ğŸ’€ åˆ é™¤å­—æ®µçš„å½±å“**
```
æ•°æ®å½±å“ï¼šå­—æ®µä¸­çš„æ‰€æœ‰æ•°æ®æ°¸ä¹…ä¸¢å¤±
åº”ç”¨å½±å“ï¼šä½¿ç”¨è¯¥å­—æ®µçš„ç¨‹åºä¼šæŠ¥é”™
ç´¢å¼•å½±å“ï¼šç›¸å…³ç´¢å¼•ä¼šè‡ªåŠ¨åˆ é™¤
çº¦æŸå½±å“ï¼šç›¸å…³çº¦æŸä¼šè‡ªåŠ¨åˆ é™¤

åˆ é™¤å‰æ£€æŸ¥æ¸…å•ï¼š
â˜‘ï¸ ç¡®è®¤æ²¡æœ‰ç¨‹åºä½¿ç”¨è¯¥å­—æ®µ
â˜‘ï¸ å¤‡ä»½é‡è¦æ•°æ®
â˜‘ï¸ æ£€æŸ¥ç›¸å…³è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹æ˜¯å¦ä½¿ç”¨è¯¥å­—æ®µ
â˜‘ï¸ æ£€æŸ¥æ˜¯å¦æœ‰å¤–é”®å¼•ç”¨
```

### 4.4 è¡¨å±æ€§ä¿®æ”¹


**ğŸ·ï¸ ä¿®æ”¹è¡¨å**
```sql
-- æ–¹å¼ä¸€ï¼šä½¿ç”¨ALTER TABLE
ALTER TABLE old_users RENAME TO new_users;

-- æ–¹å¼äºŒï¼šä½¿ç”¨RENAME TABLEï¼ˆæ¨èï¼Œå¯ä»¥æ‰¹é‡é‡å‘½åï¼‰
RENAME TABLE 
    old_users TO new_users,
    old_orders TO new_orders;
```

**âš™ï¸ ä¿®æ”¹è¡¨å±æ€§**
```sql
-- ä¿®æ”¹å­˜å‚¨å¼•æ“
ALTER TABLE users ENGINE=InnoDB;

-- ä¿®æ”¹å­—ç¬¦é›†
ALTER TABLE users CHARACTER SET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- ä¿®æ”¹è¡¨æ³¨é‡Š
ALTER TABLE users COMMENT='ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆå·²æ›´æ–°ï¼‰';

-- ä¿®æ”¹è‡ªå¢èµ·å§‹å€¼
ALTER TABLE users AUTO_INCREMENT=10000;
```

### 4.5 è¡¨åˆ é™¤ä¸æ¸…ç©º


**ğŸ—‘ï¸ åˆ é™¤è¡¨**
```sql
-- ç›´æ¥åˆ é™¤è¡¨
DROP TABLE users;

-- å®‰å…¨åˆ é™¤ï¼ˆè¡¨ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼‰
DROP TABLE IF EXISTS users;

-- æ‰¹é‡åˆ é™¤è¡¨
DROP TABLE users, orders, products;
```

**ğŸ§¹ æ¸…ç©ºè¡¨æ•°æ®**
```sql
-- TRUNCATEï¼šå¿«é€Ÿæ¸…ç©ºï¼Œé‡ç½®è‡ªå¢ï¼Œæ— æ³•å›æ»š
TRUNCATE TABLE users;

-- DELETEï¼šé€è¡Œåˆ é™¤ï¼Œå¯ä»¥å›æ»šï¼Œä½†é€Ÿåº¦æ…¢
DELETE FROM users;
```

**ğŸ“Š TRUNCATE vs DELETEå¯¹æ¯”**

| ç‰¹æ€§ | **TRUNCATE** | **DELETE** |
|------|-------------|-----------|
| **é€Ÿåº¦** | æå¿« | ç›¸å¯¹è¾ƒæ…¢ |
| **è‡ªå¢é‡ç½®** | ä¼šé‡ç½® | ä¸é‡ç½® |
| **äº‹åŠ¡å›æ»š** | ä¸å¯å›æ»š | å¯å›æ»š |
| **è§¦å‘å™¨** | ä¸è§¦å‘ | ä¼šè§¦å‘ |
| **WHEREæ¡ä»¶** | ä¸æ”¯æŒ | æ”¯æŒ |

---

## 5. ğŸ” ç´¢å¼•æ“ä½œDDL


### 5.1 ç´¢å¼•åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç´¢å¼•**
ç´¢å¼•å°±åƒä¹¦çš„ç›®å½•ï¼Œè®©ä½ èƒ½å¿«é€Ÿæ‰¾åˆ°æƒ³è¦çš„å†…å®¹ã€‚æ²¡æœ‰ç´¢å¼•çš„è¡¨æŸ¥è¯¢å°±åƒæ²¡æœ‰ç›®å½•çš„ä¹¦ï¼Œåªèƒ½ä¸€é¡µé¡µç¿»æ‰¾ã€‚

**ğŸ“š ç´¢å¼•çš„å·¥ä½œåŸç†**
```
æ— ç´¢å¼•æŸ¥è¯¢ï¼š
SELECT * FROM users WHERE email = 'john@example.com';
éœ€è¦æ‰«ææ•´å¼ è¡¨ï¼Œ10ä¸‡æ¡æ•°æ®å°±è¦æ£€æŸ¥10ä¸‡æ¬¡

æœ‰ç´¢å¼•æŸ¥è¯¢ï¼š
åœ¨emailå­—æ®µä¸Šå»ºç«‹ç´¢å¼•åï¼Œåªéœ€è¦å‡ æ¬¡æ¯”è¾ƒå°±èƒ½æ‰¾åˆ°
ç±»ä¼¼äºé€šè¿‡ä¹¦çš„ç›®å½•ç›´æ¥è·³åˆ°æŒ‡å®šé¡µç 
```

**âš¡ ç´¢å¼•çš„ä¼˜ç¼ºç‚¹**
```
ä¼˜ç‚¹ï¼š
âœ… æå¤§æé«˜æŸ¥è¯¢é€Ÿåº¦
âœ… æé«˜ORDER BYå’ŒGROUP BYæ•ˆç‡
âœ… æé«˜è¿æ¥æŸ¥è¯¢æ€§èƒ½

ç¼ºç‚¹ï¼š
âŒ å ç”¨é¢å¤–å­˜å‚¨ç©ºé—´
âŒ é™ä½INSERT/UPDATE/DELETEé€Ÿåº¦
âŒ éœ€è¦ç»´æŠ¤æˆæœ¬
```

### 5.2 ç´¢å¼•åˆ›å»ºè¯¦è§£


**ğŸ—ï¸ åŸºç¡€ç´¢å¼•åˆ›å»º**
```sql
-- åˆ›å»ºæ™®é€šç´¢å¼•ï¼ˆæœ€å¸¸ç”¨ï¼‰
CREATE INDEX idx_email ON users (email);

-- åˆ›å»ºå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_username ON users (username);

-- åˆ›å»ºå¤åˆç´¢å¼•ï¼ˆå¤šä¸ªå­—æ®µç»„åˆï¼‰
CREATE INDEX idx_age_city ON users (age, city);
```

**ğŸ”§ é€šè¿‡ALTER TABLEåˆ›å»ºç´¢å¼•**
```sql
-- æ·»åŠ æ™®é€šç´¢å¼•
ALTER TABLE users ADD INDEX idx_phone (phone);

-- æ·»åŠ å”¯ä¸€ç´¢å¼•
ALTER TABLE users ADD UNIQUE INDEX idx_email (email);

-- æ·»åŠ ä¸»é”®ç´¢å¼•
ALTER TABLE users ADD PRIMARY KEY (id);
```

### 5.3 ç´¢å¼•å‘½åè§„èŒƒ


**ğŸ“ ç´¢å¼•å‘½åæœ€ä½³å®è·µ**
```sql
-- æ™®é€šç´¢å¼•ï¼šidx_å­—æ®µå
CREATE INDEX idx_email ON users (email);
CREATE INDEX idx_created_at ON users (created_at);

-- å”¯ä¸€ç´¢å¼•ï¼šuk_å­—æ®µåï¼ˆuk = unique keyï¼‰
CREATE UNIQUE INDEX uk_username ON users (username);

-- å¤åˆç´¢å¼•ï¼šidx_å­—æ®µ1_å­—æ®µ2
CREATE INDEX idx_age_status ON users (age, status);
CREATE INDEX idx_user_order_date ON orders (user_id, order_date);

-- å¤–é”®ç´¢å¼•ï¼šfk_è¡¨å_å­—æ®µå
CREATE INDEX fk_orders_user_id ON orders (user_id);
```

### 5.4 ç‰¹æ®Šç±»å‹ç´¢å¼•


**ğŸ“ å…¨æ–‡ç´¢å¼•**
```sql
-- åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆç”¨äºæ–‡æœ¬æœç´¢ï¼‰
CREATE FULLTEXT INDEX ft_idx_content ON articles (title, content);

-- ä½¿ç”¨å…¨æ–‡ç´¢å¼•æŸ¥è¯¢
SELECT * FROM articles 
WHERE MATCH(title, content) AGAINST('MySQL æ•™ç¨‹' IN NATURAL LANGUAGE MODE);
```

**ğŸ—ºï¸ ç©ºé—´ç´¢å¼•**
```sql
-- åˆ›å»ºç©ºé—´ç´¢å¼•ï¼ˆç”¨äºåœ°ç†ä½ç½®æ•°æ®ï¼‰
CREATE SPATIAL INDEX sp_idx_location ON stores (location);
```

**ğŸ“Š å‰ç¼€ç´¢å¼•**
```sql
-- å¯¹é•¿å­—ç¬¦ä¸²å­—æ®µåˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ˆèŠ‚çœç©ºé—´ï¼‰
CREATE INDEX idx_description ON products (description(50));

-- é€‚ç”¨åœºæ™¯ï¼šURLã€é•¿æ–‡æœ¬å­—æ®µç­‰
CREATE INDEX idx_url ON pages (url(100));
```

### 5.5 å¤åˆç´¢å¼•è¯¦è§£


**ğŸ”— ä»€ä¹ˆæ˜¯å¤åˆç´¢å¼•**
å¤åˆç´¢å¼•æ˜¯åœ¨å¤šä¸ªå­—æ®µä¸Šå»ºç«‹çš„ç´¢å¼•ï¼Œå°±åƒä¹¦çš„äºŒçº§ç›®å½•ï¼šå…ˆæŒ‰ç« èŠ‚åˆ†ç±»ï¼Œå†æŒ‰å°èŠ‚æ’åºã€‚

**ğŸ’¡ å¤åˆç´¢å¼•çš„é¡ºåºå¾ˆé‡è¦**
```sql
-- åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_age_city_status ON users (age, city, status);

-- èƒ½ä½¿ç”¨åˆ°ç´¢å¼•çš„æŸ¥è¯¢ï¼ˆéµå¾ªå·¦å‰ç¼€åŸåˆ™ï¼‰
SELECT * FROM users WHERE age = 25;                          -- âœ… ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE age = 25 AND city = 'åŒ—äº¬';        -- âœ… ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE age = 25 AND city = 'åŒ—äº¬' AND status = 1; -- âœ… ä½¿ç”¨ç´¢å¼•

-- ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•çš„æŸ¥è¯¢
SELECT * FROM users WHERE city = 'åŒ—äº¬';                     -- âŒ ä¸ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE status = 1;                       -- âŒ ä¸ä½¿ç”¨ç´¢å¼•
SELECT * FROM users WHERE city = 'åŒ—äº¬' AND status = 1;     -- âŒ ä¸ä½¿ç”¨ç´¢å¼•
```

### 5.6 ç´¢å¼•ç®¡ç†æ“ä½œ


**ğŸ‘€ æŸ¥çœ‹ç´¢å¼•**
```sql
-- æŸ¥çœ‹è¡¨çš„æ‰€æœ‰ç´¢å¼•
SHOW INDEX FROM users;

-- æŸ¥çœ‹ç´¢å¼•è¯¦ç»†ä¿¡æ¯
SHOW KEYS FROM users;

-- é€šè¿‡ç³»ç»Ÿè¡¨æŸ¥çœ‹ç´¢å¼•
SELECT 
    INDEX_NAME,
    COLUMN_NAME,
    INDEX_TYPE,
    NON_UNIQUE
FROM information_schema.STATISTICS 
WHERE TABLE_NAME = 'users' AND TABLE_SCHEMA = 'mystore';
```

**ğŸ—‘ï¸ åˆ é™¤ç´¢å¼•**
```sql
-- åˆ é™¤æ™®é€šç´¢å¼•
DROP INDEX idx_email ON users;

-- é€šè¿‡ALTER TABLEåˆ é™¤ç´¢å¼•
ALTER TABLE users DROP INDEX idx_phone;

-- åˆ é™¤ä¸»é”®ç´¢å¼•
ALTER TABLE users DROP PRIMARY KEY;
```

---

## 6. ğŸ›¡ï¸ çº¦æŸæ“ä½œDDL


### 6.1 çº¦æŸåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯çº¦æŸ**
çº¦æŸå°±æ˜¯ç»™æ•°æ®è®¾å®šçš„è§„åˆ™ï¼Œå°±åƒäº¤é€šè§„åˆ™ä¸€æ ·ï¼Œç¡®ä¿æ•°æ®çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚æ¯”å¦‚è§„å®šèº«ä»½è¯å·å¿…é¡»å”¯ä¸€ã€å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°ç­‰ã€‚

**ğŸ·ï¸ çº¦æŸçš„ç±»å‹å’Œä½œç”¨**
```
ä¸»é”®çº¦æŸï¼ˆPRIMARY KEYï¼‰ï¼š
- ä½œç”¨ï¼šç¡®ä¿è®°å½•å”¯ä¸€æ€§ï¼Œä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®
- ç‰¹ç‚¹ï¼šä¸èƒ½ä¸ºç©ºï¼Œä¸èƒ½é‡å¤
- æ¯”å–»ï¼šèº«ä»½è¯å·ï¼Œæ¯ä¸ªäººéƒ½æœ‰ä¸”å”¯ä¸€

å¤–é”®çº¦æŸï¼ˆFOREIGN KEYï¼‰ï¼š
- ä½œç”¨ï¼šç»´æŠ¤è¡¨ä¹‹é—´çš„å…³ç³»å®Œæ•´æ€§
- ç‰¹ç‚¹ï¼šå¼•ç”¨å…¶ä»–è¡¨çš„ä¸»é”®å€¼
- æ¯”å–»ï¼šå­¦ç”Ÿè¡¨ä¸­çš„ç­çº§IDå¿…é¡»åœ¨ç­çº§è¡¨ä¸­å­˜åœ¨

å”¯ä¸€çº¦æŸï¼ˆUNIQUEï¼‰ï¼š
- ä½œç”¨ï¼šç¡®ä¿å­—æ®µå€¼ä¸é‡å¤
- ç‰¹ç‚¹ï¼šå¯ä»¥ä¸ºç©ºï¼Œä½†ä¸èƒ½é‡å¤
- æ¯”å–»ï¼šç”¨æˆ·åã€é‚®ç®±åœ°å€

æ£€æŸ¥çº¦æŸï¼ˆCHECKï¼‰ï¼š
- ä½œç”¨ï¼šç¡®ä¿æ•°æ®æ»¡è¶³ç‰¹å®šæ¡ä»¶
- ç‰¹ç‚¹ï¼šMySQL 8.0+æ‰æ”¯æŒ
- æ¯”å–»ï¼šå¹´é¾„å¿…é¡»å¤§äº0ï¼Œæ€§åˆ«åªèƒ½æ˜¯ç”·æˆ–å¥³

éç©ºçº¦æŸï¼ˆNOT NULLï¼‰ï¼š
- ä½œç”¨ï¼šç¡®ä¿å­—æ®µä¸ä¸ºç©º
- ç‰¹ç‚¹ï¼šå¿…é¡»å¡«å†™å€¼
- æ¯”å–»ï¼šå§“åã€èº«ä»½è¯å·ç­‰å¿…å¡«ä¿¡æ¯
```

### 6.2 ä¸»é”®çº¦æŸæ“ä½œ


**ğŸ”‘ æ·»åŠ ä¸»é”®çº¦æŸ**
```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰ä¸»é”®
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50)
);

-- åˆ›å»ºè¡¨æ—¶å®šä¹‰å¤åˆä¸»é”®
CREATE TABLE user_roles (
    user_id INT,
    role_id INT,
    PRIMARY KEY (user_id, role_id)
);

-- ç»™ç°æœ‰è¡¨æ·»åŠ ä¸»é”®
ALTER TABLE users ADD PRIMARY KEY (id);

-- æ·»åŠ å‘½åçš„ä¸»é”®çº¦æŸ
ALTER TABLE users ADD CONSTRAINT pk_users PRIMARY KEY (id);
```

**ğŸ—‘ï¸ åˆ é™¤ä¸»é”®çº¦æŸ**
```sql
-- åˆ é™¤ä¸»é”®ï¼ˆå¦‚æœæœ‰è‡ªå¢å±æ€§ï¼Œéœ€è¦å…ˆåˆ é™¤è‡ªå¢ï¼‰
ALTER TABLE users MODIFY id INT;         -- å…ˆåˆ é™¤AUTO_INCREMENT
ALTER TABLE users DROP PRIMARY KEY;      -- å†åˆ é™¤ä¸»é”®
```

### 6.3 å¤–é”®çº¦æŸæ“ä½œ


**ğŸ”— å¤–é”®çº¦æŸçš„æ„ä¹‰**
å¤–é”®çº¦æŸç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé˜²æ­¢å‡ºç°"å­¤å„¿æ•°æ®"ã€‚æ¯”å¦‚è®¢å•è¡¨ä¸­çš„ç”¨æˆ·IDå¿…é¡»åœ¨ç”¨æˆ·è¡¨ä¸­å­˜åœ¨ï¼Œä¸èƒ½æœ‰æ— ä¸»è®¢å•ã€‚

**â• æ·»åŠ å¤–é”®çº¦æŸ**
```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰å¤–é”®
CREATE TABLE orders (
    id INT PRIMARY KEY,
    user_id INT,
    amount DECIMAL(10,2),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ç»™ç°æœ‰è¡¨æ·»åŠ å¤–é”®
ALTER TABLE orders 
ADD CONSTRAINT fk_orders_user_id 
FOREIGN KEY (user_id) REFERENCES users(id);

-- å¸¦çº§è”æ“ä½œçš„å¤–é”®
ALTER TABLE orders 
ADD CONSTRAINT fk_orders_user_id 
FOREIGN KEY (user_id) REFERENCES users(id)
ON DELETE CASCADE           -- åˆ é™¤ç”¨æˆ·æ—¶åŒæ—¶åˆ é™¤å…¶è®¢å•
ON UPDATE CASCADE;          -- æ›´æ–°ç”¨æˆ·IDæ—¶åŒæ—¶æ›´æ–°è®¢å•ä¸­çš„ç”¨æˆ·ID
```

**ğŸ”„ å¤–é”®çš„çº§è”æ“ä½œ**
```sql
-- çº§è”æ“ä½œé€‰é¡¹ï¼š
ON DELETE CASCADE    -- åˆ é™¤çˆ¶è®°å½•æ—¶ï¼ŒåŒæ—¶åˆ é™¤å­è®°å½•
ON DELETE SET NULL   -- åˆ é™¤çˆ¶è®°å½•æ—¶ï¼Œå­è®°å½•ç›¸å…³å­—æ®µè®¾ä¸ºNULL
ON DELETE RESTRICT   -- æœ‰å­è®°å½•æ—¶ï¼Œä¸å…è®¸åˆ é™¤çˆ¶è®°å½•ï¼ˆé»˜è®¤ï¼‰
ON DELETE NO ACTION  -- åŒRESTRICT

ON UPDATE CASCADE    -- æ›´æ–°çˆ¶è®°å½•æ—¶ï¼ŒåŒæ—¶æ›´æ–°å­è®°å½•
ON UPDATE SET NULL   -- æ›´æ–°çˆ¶è®°å½•æ—¶ï¼Œå­è®°å½•ç›¸å…³å­—æ®µè®¾ä¸ºNULL
ON UPDATE RESTRICT   -- æœ‰å­è®°å½•æ—¶ï¼Œä¸å…è®¸æ›´æ–°çˆ¶è®°å½•ï¼ˆé»˜è®¤ï¼‰
ON UPDATE NO ACTION  -- åŒRESTRICT
```

**ğŸ—‘ï¸ åˆ é™¤å¤–é”®çº¦æŸ**
```sql
-- åˆ é™¤å¤–é”®çº¦æŸï¼ˆéœ€è¦çŸ¥é“çº¦æŸåï¼‰
ALTER TABLE orders DROP FOREIGN KEY fk_orders_user_id;

-- æŸ¥çœ‹å¤–é”®çº¦æŸå
SHOW CREATE TABLE orders;
SELECT 
    CONSTRAINT_NAME,
    TABLE_NAME,
    COLUMN_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM information_schema.KEY_COLUMN_USAGE 
WHERE TABLE_NAME = 'orders' AND CONSTRAINT_NAME != 'PRIMARY';
```

### 6.4 å”¯ä¸€çº¦æŸæ“ä½œ


**ğŸ¯ å”¯ä¸€çº¦æŸçš„åº”ç”¨**
```sql
-- æ·»åŠ å”¯ä¸€çº¦æŸ
ALTER TABLE users ADD UNIQUE (username);

-- æ·»åŠ å‘½åçš„å”¯ä¸€çº¦æŸ
ALTER TABLE users ADD CONSTRAINT uk_users_email UNIQUE (email);

-- æ·»åŠ å¤åˆå”¯ä¸€çº¦æŸ
ALTER TABLE user_profiles ADD CONSTRAINT uk_phone_region UNIQUE (phone, region);

-- åˆ é™¤å”¯ä¸€çº¦æŸ
ALTER TABLE users DROP INDEX username;
ALTER TABLE users DROP INDEX uk_users_email;
```

### 6.5 æ£€æŸ¥çº¦æŸæ“ä½œï¼ˆMySQL 8.0+ï¼‰


**âœ… æ£€æŸ¥çº¦æŸçš„ä½¿ç”¨**
```sql
-- æ·»åŠ æ£€æŸ¥çº¦æŸ
ALTER TABLE users ADD CONSTRAINT chk_age CHECK (age >= 0 AND age <= 150);

-- æ·»åŠ å¤šæ¡ä»¶æ£€æŸ¥çº¦æŸ
ALTER TABLE products 
ADD CONSTRAINT chk_price CHECK (price > 0),
ADD CONSTRAINT chk_stock CHECK (stock >= 0);

-- æ·»åŠ å¤æ‚æ£€æŸ¥çº¦æŸ
ALTER TABLE orders 
ADD CONSTRAINT chk_status CHECK (status IN (1,2,3,4,5));

-- åˆ é™¤æ£€æŸ¥çº¦æŸ
ALTER TABLE users DROP CONSTRAINT chk_age;
```

**âš ï¸ æ£€æŸ¥çº¦æŸæ³¨æ„äº‹é¡¹**
```
MySQLç‰ˆæœ¬è¦æ±‚ï¼šåªæœ‰MySQL 8.0+æ”¯æŒCHECKçº¦æŸ
æ€§èƒ½å½±å“ï¼šæ¯æ¬¡INSERT/UPDATEéƒ½ä¼šæ£€æŸ¥çº¦æŸæ¡ä»¶
è¡¨è¾¾å¼é™åˆ¶ï¼šä¸èƒ½ä½¿ç”¨å­æŸ¥è¯¢ã€å­˜å‚¨å‡½æ•°ç­‰
ç©ºå€¼å¤„ç†ï¼šNULLå€¼ä¸å‚ä¸æ£€æŸ¥çº¦æŸéªŒè¯
```

### 6.6 çº¦æŸç®¡ç†æœ€ä½³å®è·µ


**ğŸ“‹ çº¦æŸè®¾è®¡åŸåˆ™**
```sql
-- 1. åˆç†çš„çº¦æŸå‘½å
pk_è¡¨å               -- ä¸»é”®çº¦æŸ
fk_è¡¨å_å­—æ®µå        -- å¤–é”®çº¦æŸ  
uk_è¡¨å_å­—æ®µå        -- å”¯ä¸€çº¦æŸ
chk_è¡¨å_å­—æ®µå       -- æ£€æŸ¥çº¦æŸ

-- 2. ç¤ºä¾‹ï¼šè‰¯å¥½çš„çº¦æŸå‘½å
ALTER TABLE orders ADD CONSTRAINT pk_orders PRIMARY KEY (id);
ALTER TABLE orders ADD CONSTRAINT fk_orders_user_id FOREIGN KEY (user_id) REFERENCES users(id);
ALTER TABLE orders ADD CONSTRAINT uk_orders_order_no UNIQUE (order_no);
ALTER TABLE orders ADD CONSTRAINT chk_orders_amount CHECK (amount > 0);
```

---

## 7. ğŸ‘ï¸ è§†å›¾æ“ä½œDDL


### 7.1 è§†å›¾åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è§†å›¾**
è§†å›¾å°±åƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„è¡¨ï¼Œå®ƒæœ¬èº«ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯åŸºäºä¸€ä¸ªæˆ–å¤šä¸ªçœŸå®è¡¨çš„æŸ¥è¯¢ç»“æœã€‚å°±åƒé€è¿‡æœ‰è‰²ç»ç’ƒçœ‹é£æ™¯ï¼Œç»ç’ƒä¸æ˜¯é£æ™¯æœ¬èº«ï¼Œä½†èƒ½è®©ä½ çœ‹åˆ°ç‰¹å®šçš„æ™¯è±¡ã€‚

**ğŸ’¡ è§†å›¾çš„ä½œç”¨å’Œå¥½å¤„**
```
æ•°æ®å®‰å…¨ï¼šéšè—æ•æ„Ÿå­—æ®µï¼Œåªæš´éœ²éœ€è¦çš„ä¿¡æ¯
ç®€åŒ–æŸ¥è¯¢ï¼šæŠŠå¤æ‚çš„å¤šè¡¨è¿æ¥æŸ¥è¯¢å°è£…æˆç®€å•çš„è§†å›¾
æƒé™æ§åˆ¶ï¼šä¸åŒç”¨æˆ·çœ‹åˆ°ä¸åŒçš„æ•°æ®è§†å›¾
æ•°æ®æŠ½è±¡ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›ç¨³å®šçš„æ•°æ®æ¥å£

å®é™…åº”ç”¨åœºæ™¯ï¼š
- è´¢åŠ¡æŠ¥è¡¨è§†å›¾ï¼šåªæ˜¾ç¤ºæ±‡æ€»æ•°æ®ï¼Œéšè—æ˜ç»†
- ç”¨æˆ·ä¿¡æ¯è§†å›¾ï¼šéšè—å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯
- ç»Ÿè®¡åˆ†æè§†å›¾ï¼šé¢„å…ˆè®¡ç®—å¥½çš„å¤æ‚æŸ¥è¯¢ç»“æœ
```

### 7.2 è§†å›¾åˆ›å»ºæ“ä½œ


**ğŸ—ï¸ åŸºç¡€è§†å›¾åˆ›å»º**
```sql
-- ç®€å•è§†å›¾ï¼šåŸºäºå•è¡¨
CREATE VIEW user_public AS
SELECT id, username, email, created_at
FROM users
WHERE status = 1;

-- å¤æ‚è§†å›¾ï¼šåŸºäºå¤šè¡¨è¿æ¥
CREATE VIEW user_order_summary AS
SELECT 
    u.id,
    u.username,
    COUNT(o.id) as order_count,
    SUM(o.amount) as total_amount,
    MAX(o.created_at) as last_order_date
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.username;
```

**ğŸ”§ å®Œæ•´è§†å›¾åˆ›å»ºè¯­æ³•**
```sql
CREATE OR REPLACE VIEW view_name 
(column_alias1, column_alias2, ...)  -- å¯é€‰ï¼šç»™åˆ—èµ·åˆ«å
AS 
SELECT statement
WITH CHECK OPTION;                   -- å¯é€‰ï¼šæ£€æŸ¥é€‰é¡¹
```

**ğŸ“Š å¸¦æ¡ä»¶çš„è§†å›¾**
```sql
-- æ´»è·ƒç”¨æˆ·è§†å›¾
CREATE VIEW active_users AS
SELECT 
    id,
    username,
    email,
    last_login_time,
    DATEDIFF(NOW(), last_login_time) as days_since_login
FROM users 
WHERE status = 1 
  AND last_login_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)
WITH CHECK OPTION;  -- ç¡®ä¿é€šè¿‡è§†å›¾æ’å…¥çš„æ•°æ®ä¹Ÿæ»¡è¶³WHEREæ¡ä»¶
```

### 7.3 è§†å›¾çš„é«˜çº§ç‰¹æ€§


**ğŸ”’ å®‰å…¨å®šä¹‰è€…ä¸è°ƒç”¨è€…æƒé™**
```sql
-- å®šä¹‰è€…æƒé™ï¼ˆé»˜è®¤ï¼‰ï¼šä½¿ç”¨åˆ›å»ºè§†å›¾çš„ç”¨æˆ·æƒé™
CREATE 
    DEFINER = 'admin'@'localhost'
    SQL SECURITY DEFINER
    VIEW secure_user_data AS
SELECT id, username FROM users;

-- è°ƒç”¨è€…æƒé™ï¼šä½¿ç”¨æŸ¥è¯¢è§†å›¾çš„ç”¨æˆ·æƒé™
CREATE 
    SQL SECURITY INVOKER
    VIEW user_own_data AS
SELECT id, username FROM users WHERE created_by = USER();
```

**âš™ï¸ è§†å›¾ç®—æ³•è®¾ç½®**
```sql
-- MERGEç®—æ³•ï¼šå°†è§†å›¾æŸ¥è¯¢åˆå¹¶åˆ°å¤–å±‚æŸ¥è¯¢
CREATE ALGORITHM=MERGE VIEW simple_view AS
SELECT id, name FROM users WHERE status = 1;

-- TEMPTABLEç®—æ³•ï¼šå…ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼Œå†æŸ¥è¯¢
CREATE ALGORITHM=TEMPTABLE VIEW complex_view AS
SELECT user_id, COUNT(*) as order_count
FROM orders GROUP BY user_id;

-- UNDEFINEDç®—æ³•ï¼šè®©MySQLè‡ªåŠ¨é€‰æ‹©
CREATE ALGORITHM=UNDEFINED VIEW auto_view AS
SELECT * FROM users;
```

### 7.4 å¯æ›´æ–°è§†å›¾


**âœï¸ ä»€ä¹ˆæ˜¯å¯æ›´æ–°è§†å›¾**
æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„è§†å›¾å¯ä»¥æ‰§è¡ŒINSERTã€UPDATEã€DELETEæ“ä½œï¼Œä¿®æ”¹ä¼šç›´æ¥å½±å“åº•å±‚çš„çœŸå®è¡¨ã€‚

**ğŸ“ å¯æ›´æ–°è§†å›¾çš„æ¡ä»¶**
```sql
-- å¯æ›´æ–°çš„è§†å›¾ç¤ºä¾‹
CREATE VIEW updatable_users AS
SELECT id, username, email, status
FROM users 
WHERE status = 1
WITH CHECK OPTION;

-- å¯ä»¥æ‰§è¡Œæ›´æ–°æ“ä½œ
UPDATE updatable_users SET email = 'new@example.com' WHERE id = 1;
INSERT INTO updatable_users (username, email) VALUES ('newuser', 'new@test.com');
```

**âš ï¸ ä¸å¯æ›´æ–°è§†å›¾çš„æƒ…å†µ**
```sql
-- åŒ…å«èšåˆå‡½æ•°çš„è§†å›¾ï¼ˆä¸å¯æ›´æ–°ï¼‰
CREATE VIEW user_stats AS
SELECT user_id, COUNT(*) as order_count, AVG(amount) as avg_amount
FROM orders GROUP BY user_id;

-- åŒ…å«DISTINCTçš„è§†å›¾ï¼ˆä¸å¯æ›´æ–°ï¼‰
CREATE VIEW unique_cities AS
SELECT DISTINCT city FROM users;

-- åŒ…å«å­æŸ¥è¯¢çš„è§†å›¾ï¼ˆé€šå¸¸ä¸å¯æ›´æ–°ï¼‰
CREATE VIEW expensive_orders AS
SELECT * FROM orders 
WHERE amount > (SELECT AVG(amount) FROM orders);
```

### 7.5 è§†å›¾ç®¡ç†æ“ä½œ


**ğŸ‘€ æŸ¥çœ‹è§†å›¾ä¿¡æ¯**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰è§†å›¾
SHOW TABLES WHERE Table_type = 'VIEW';

-- æŸ¥çœ‹è§†å›¾å®šä¹‰
SHOW CREATE VIEW user_public;

-- æŸ¥çœ‹è§†å›¾è¯¦ç»†ä¿¡æ¯
SELECT 
    TABLE_NAME,
    VIEW_DEFINITION,
    CHECK_OPTION,
    IS_UPDATABLE,
    DEFINER,
    SECURITY_TYPE
FROM information_schema.VIEWS 
WHERE TABLE_SCHEMA = 'mystore';
```

**ğŸ”„ ä¿®æ”¹è§†å›¾**
```sql
-- ä¿®æ”¹è§†å›¾å®šä¹‰
ALTER VIEW user_public AS
SELECT id, username, email, phone, created_at
FROM users
WHERE status = 1;

-- ä½¿ç”¨CREATE OR REPLACEï¼ˆæ¨èï¼‰
CREATE OR REPLACE VIEW user_public AS
SELECT id, username, email, phone, status, created_at
FROM users
WHERE status IN (1, 2);
```

**ğŸ—‘ï¸ åˆ é™¤è§†å›¾**
```sql
-- åˆ é™¤è§†å›¾
DROP VIEW user_public;

-- å®‰å…¨åˆ é™¤ï¼ˆè§†å›¾ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼‰
DROP VIEW IF EXISTS user_public;

-- æ‰¹é‡åˆ é™¤è§†å›¾
DROP VIEW view1, view2, view3;
```

### 7.6 è§†å›¾åº”ç”¨æœ€ä½³å®è·µ


**ğŸ“‹ è§†å›¾è®¾è®¡åŸåˆ™**
```sql
-- 1. æ•°æ®å®‰å…¨ï¼šéšè—æ•æ„Ÿå­—æ®µ
CREATE VIEW customer_info AS
SELECT 
    id,
    username,
    email,
    phone,
    -- éšè—passwordã€id_cardç­‰æ•æ„Ÿä¿¡æ¯
    created_at
FROM users;

-- 2. ç®€åŒ–å¤æ‚æŸ¥è¯¢ï¼šæŠ¥è¡¨è§†å›¾
CREATE VIEW monthly_sales_report AS
SELECT 
    DATE_FORMAT(order_date, '%Y-%m') as month,
    COUNT(*) as order_count,
    SUM(amount) as total_sales,
    AVG(amount) as avg_order_value
FROM orders 
WHERE status = 'completed'
GROUP BY DATE_FORMAT(order_date, '%Y-%m')
ORDER BY month DESC;

-- 3. æƒé™æ§åˆ¶ï¼šéƒ¨é—¨æ•°æ®è§†å›¾
CREATE VIEW dept_orders AS
SELECT o.*
FROM orders o
JOIN users u ON o.user_id = u.id
WHERE u.department_id = GET_CURRENT_DEPT_ID();  -- å‡è®¾çš„å‡½æ•°
```

---

## 8. ğŸ”§ å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°DDL


### 8.1 å­˜å‚¨è¿‡ç¨‹åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹**
å­˜å‚¨è¿‡ç¨‹å°±åƒæ˜¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„ç¨‹åºï¼Œå¯ä»¥æ¥æ”¶å‚æ•°ã€æ‰§è¡Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€è¿”å›ç»“æœã€‚å°±åƒæŠŠä¸€å¥—æ“ä½œæµç¨‹å†™æˆè„šæœ¬ï¼Œéœ€è¦æ—¶ç›´æ¥è°ƒç”¨ã€‚

**ğŸ’¡ å­˜å‚¨è¿‡ç¨‹çš„ä¼˜åŠ¿**
```
æ€§èƒ½ä¼˜åŠ¿ï¼šé¢„ç¼–è¯‘æ‰§è¡Œï¼Œå‡å°‘ç½‘ç»œä¼ è¾“
å®‰å…¨ä¼˜åŠ¿ï¼šå°è£…ä¸šåŠ¡é€»è¾‘ï¼Œé¿å…SQLæ³¨å…¥
ç»´æŠ¤ä¼˜åŠ¿ï¼šé›†ä¸­ç®¡ç†ä¸šåŠ¡è§„åˆ™ï¼Œä¾¿äºä¿®æ”¹
æƒé™ä¼˜åŠ¿ï¼šç”¨æˆ·åªéœ€è¦æ‰§è¡Œæƒé™ï¼Œä¸éœ€è¦è¡¨æƒé™

åº”ç”¨åœºæ™¯ï¼š
- å¤æ‚çš„ä¸šåŠ¡è®¡ç®—ï¼ˆè®¢å•ç»“ç®—ã€ç§¯åˆ†è®¡ç®—ï¼‰
- æ‰¹é‡æ•°æ®å¤„ç†ï¼ˆæ•°æ®è¿ç§»ã€æ¸…ç†ä»»åŠ¡ï¼‰
- å®šæ—¶ä»»åŠ¡æ‰§è¡Œï¼ˆæŠ¥è¡¨ç”Ÿæˆã€æ•°æ®ç»Ÿè®¡ï¼‰
- æ•°æ®éªŒè¯å’Œè½¬æ¢
```

### 8.2 å­˜å‚¨è¿‡ç¨‹åˆ›å»º


**ğŸ—ï¸ åŸºç¡€å­˜å‚¨è¿‡ç¨‹è¯­æ³•**
```sql
DELIMITER //  -- æ”¹å˜è¯­å¥ç»“æŸç¬¦ï¼Œé¿å…ä¸è¿‡ç¨‹ä½“ä¸­çš„åˆ†å·å†²çª

CREATE PROCEDURE procedure_name (
    [IN | OUT | INOUT] parameter_name datatype,
    ...
)
BEGIN
    -- è¿‡ç¨‹ä½“ï¼šSQLè¯­å¥å’Œç¨‹åºé€»è¾‘
END //

DELIMITER ;   -- æ¢å¤é»˜è®¤çš„è¯­å¥ç»“æŸç¬¦
```

**ğŸ“ å‚æ•°ç±»å‹è¯¦è§£**
```sql
-- INå‚æ•°ï¼šè¾“å…¥å‚æ•°ï¼ˆé»˜è®¤ï¼‰
-- OUTå‚æ•°ï¼šè¾“å‡ºå‚æ•°ï¼Œç”¨äºè¿”å›å€¼
-- INOUTå‚æ•°ï¼šè¾“å…¥è¾“å‡ºå‚æ•°ï¼Œå¯è¯»å¯å†™

DELIMITER //
CREATE PROCEDURE user_statistics(
    IN dept_id INT,                    -- è¾“å…¥ï¼šéƒ¨é—¨ID
    OUT user_count INT,                -- è¾“å‡ºï¼šç”¨æˆ·æ•°é‡
    OUT avg_age DECIMAL(5,2),          -- è¾“å‡ºï¼šå¹³å‡å¹´é¾„
    INOUT status_filter VARCHAR(20)    -- è¾“å…¥è¾“å‡ºï¼šçŠ¶æ€è¿‡æ»¤æ¡ä»¶
)
BEGIN
    -- è®¾ç½®é»˜è®¤çŠ¶æ€è¿‡æ»¤
    IF status_filter IS NULL THEN
        SET status_filter = 'active';
    END IF;
    
    -- ç»Ÿè®¡ç”¨æˆ·æ•°é‡å’Œå¹³å‡å¹´é¾„
    SELECT 
        COUNT(*),
        AVG(age)
    INTO user_count, avg_age
    FROM users 
    WHERE department_id = dept_id 
      AND status = status_filter;
      
    -- ä¿®æ”¹è¾“å…¥è¾“å‡ºå‚æ•°
    SET status_filter = CONCAT(status_filter, '_processed');
END //
DELIMITER ;
```

### 8.3 å®ç”¨å­˜å‚¨è¿‡ç¨‹ç¤ºä¾‹


**ğŸ’° è®¢å•å¤„ç†å­˜å‚¨è¿‡ç¨‹**
```sql
DELIMITER //
CREATE PROCEDURE process_order(
    IN p_user_id BIGINT,
    IN p_product_id BIGINT,
    IN p_quantity INT,
    OUT p_order_id BIGINT,
    OUT p_result_message VARCHAR(255)
)
BEGIN
    DECLARE v_product_price DECIMAL(10,2);
    DECLARE v_stock_count INT;
    DECLARE v_total_amount DECIMAL(10,2);
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_result_message = 'Order processing failed';
        SET p_order_id = 0;
    END;
    
    -- å¼€å§‹äº‹åŠ¡
    START TRANSACTION;
    
    -- æ£€æŸ¥å•†å“åº“å­˜å’Œä»·æ ¼
    SELECT price, stock INTO v_product_price, v_stock_count
    FROM products 
    WHERE id = p_product_id FOR UPDATE;
    
    -- æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    IF v_stock_count < p_quantity THEN
        SET p_result_message = 'Insufficient stock';
        SET p_order_id = 0;
        ROLLBACK;
    ELSE
        -- è®¡ç®—æ€»é‡‘é¢
        SET v_total_amount = v_product_price * p_quantity;
        
        -- åˆ›å»ºè®¢å•
        INSERT INTO orders (user_id, total_amount, status, created_at)
        VALUES (p_user_id, v_total_amount, 1, NOW());
        
        SET p_order_id = LAST_INSERT_ID();
        
        -- åˆ›å»ºè®¢å•æ˜ç»†
        INSERT INTO order_items (order_id, product_id, quantity, price)
        VALUES (p_order_id, p_product_id, p_quantity, v_product_price);
        
        -- æ›´æ–°åº“å­˜
        UPDATE products 
        SET stock = stock - p_quantity 
        WHERE id = p_product_id;
        
        -- æäº¤äº‹åŠ¡
        COMMIT;
        SET p_result_message = 'Order created successfully';
    END IF;
END //
DELIMITER ;

-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
CALL process_order(123, 456, 2, @order_id, @message);
SELECT @order_id, @message;
```

### 8.4 å­˜å‚¨å‡½æ•°åˆ›å»º


**ğŸ”§ å‡½æ•°ä¸è¿‡ç¨‹çš„åŒºåˆ«**
```
å­˜å‚¨è¿‡ç¨‹ï¼ˆPROCEDUREï¼‰ï¼š
- å¯ä»¥æœ‰å¤šä¸ªè¾“å‡ºå‚æ•°
- ä¸ä¸€å®šè¿”å›å€¼
- ç”¨CALLè¯­å¥è°ƒç”¨
- å¯ä»¥æ‰§è¡ŒDMLæ“ä½œ

å­˜å‚¨å‡½æ•°ï¼ˆFUNCTIONï¼‰ï¼š
- å¿…é¡»æœ‰è¿”å›å€¼
- åªèƒ½æœ‰è¾“å…¥å‚æ•°
- å¯ä»¥åœ¨SELECTä¸­ç›´æ¥è°ƒç”¨
- é€šå¸¸ä¸æ‰§è¡ŒDMLæ“ä½œ
```

**ğŸ“ å‡½æ•°åˆ›å»ºè¯­æ³•**
```sql
DELIMITER //
CREATE FUNCTION function_name(parameter_list)
RETURNS return_type
[DETERMINISTIC | NOT DETERMINISTIC]
[READS SQL DATA | MODIFIES SQL DATA | NO SQL | CONTAINS SQL]
BEGIN
    -- å‡½æ•°ä½“
    RETURN value;
END //
DELIMITER ;
```

**ğŸ§® å®ç”¨å‡½æ•°ç¤ºä¾‹**
```sql
-- è®¡ç®—å¹´é¾„çš„å‡½æ•°
DELIMITER //
CREATE FUNCTION calculate_age(birth_date DATE)
RETURNS INT
READS SQL DATA
DETERMINISTIC
BEGIN
    DECLARE age INT;
    SET age = TIMESTAMPDIFF(YEAR, birth_date, CURDATE());
    RETURN age;
END //
DELIMITER ;

-- ä½¿ç”¨å‡½æ•°
SELECT 
    username,
    birth_date,
    calculate_age(birth_date) as age
FROM users;

-- æ ¼å¼åŒ–é‡‘é¢çš„å‡½æ•°
DELIMITER //
CREATE FUNCTION format_money(amount DECIMAL(10,2))
RETURNS VARCHAR(50)
NO SQL
DETERMINISTIC
BEGIN
    IF amount >= 10000 THEN
        RETURN CONCAT(ROUND(amount/10000, 2), 'ä¸‡');
    ELSEIF amount >= 1000 THEN
        RETURN CONCAT(ROUND(amount/1000, 2), 'åƒ');
    ELSE
        RETURN CONCAT(amount, 'å…ƒ');
    END IF;
END //
DELIMITER ;

-- ä½¿ç”¨å‡½æ•°
SELECT 
    order_no,
    amount,
    format_money(amount) as formatted_amount
FROM orders;
```

### 8.5 å­˜å‚¨è¿‡ç¨‹ä¸å‡½æ•°ç®¡ç†


**ğŸ‘€ æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰å­˜å‚¨è¿‡ç¨‹
SHOW PROCEDURE STATUS WHERE Db = 'mystore';

-- æ˜¾ç¤ºæ‰€æœ‰å‡½æ•°
SHOW FUNCTION STATUS WHERE Db = 'mystore';

-- æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å®šä¹‰
SHOW CREATE PROCEDURE process_order;

-- æŸ¥çœ‹å‡½æ•°å®šä¹‰
SHOW CREATE FUNCTION calculate_age;

-- é€šè¿‡ç³»ç»Ÿè¡¨æŸ¥è¯¢
SELECT 
    ROUTINE_NAME,
    ROUTINE_TYPE,
    ROUTINE_DEFINITION
FROM information_schema.ROUTINES 
WHERE ROUTINE_SCHEMA = 'mystore';
```

**ğŸ—‘ï¸ åˆ é™¤å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°**
```sql
-- åˆ é™¤å­˜å‚¨è¿‡ç¨‹
DROP PROCEDURE process_order;
DROP PROCEDURE IF EXISTS process_order;

-- åˆ é™¤å‡½æ•°
DROP FUNCTION calculate_age;
DROP FUNCTION IF EXISTS calculate_age;
```

### 8.6 é”™è¯¯å¤„ç†å’Œè°ƒè¯•


**âš ï¸ å¼‚å¸¸å¤„ç†**
```sql
DELIMITER //
CREATE PROCEDURE safe_update_user(
    IN p_user_id BIGINT,
    IN p_email VARCHAR(100),
    OUT p_result VARCHAR(50)
)
BEGIN
    DECLARE duplicate_key_error CONDITION FOR 1062;
    DECLARE CONTINUE HANDLER FOR duplicate_key_error
    BEGIN
        SET p_result = 'Email already exists';
    END;
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SET p_result = 'Database error occurred';
    END;
    
    START TRANSACTION;
    
    UPDATE users SET email = p_email WHERE id = p_user_id;
    
    IF ROW_COUNT() = 0 THEN
        SET p_result = 'User not found';
        ROLLBACK;
    ELSE
        SET p_result = 'Success';
        COMMIT;
    END IF;
END //
DELIMITER ;
```

---

## 9. âš¡ è§¦å‘å™¨DDL


### 9.1 è§¦å‘å™¨åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è§¦å‘å™¨**
è§¦å‘å™¨å°±åƒæ•°æ®åº“ä¸­çš„"è‡ªåŠ¨æœºå™¨äºº"ï¼Œå½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆå¢åˆ æ”¹æ•°æ®ï¼‰ä¼šè‡ªåŠ¨æ‰§è¡Œé¢„å®šçš„æ“ä½œã€‚å°±åƒé—¨é“ƒå“äº†ä¼šè‡ªåŠ¨å¼€é—¨ï¼Œæ•°æ®å˜åŒ–äº†ä¼šè‡ªåŠ¨æ‰§è¡Œç›¸å…³é€»è¾‘ã€‚

**ğŸ¯ è§¦å‘å™¨çš„åº”ç”¨åœºæ™¯**
```
æ•°æ®å®¡è®¡ï¼šè®°å½•æ•°æ®çš„å˜æ›´å†å²
è‡ªåŠ¨è®¡ç®—ï¼šæ›´æ–°æ±‡æ€»æ•°æ®ã€è®¡ç®—æ´¾ç”Ÿå­—æ®µ
æ•°æ®éªŒè¯ï¼šæ‰§è¡Œå¤æ‚çš„ä¸šåŠ¡è§„åˆ™æ£€æŸ¥
æ—¥å¿—è®°å½•ï¼šè®°å½•æ“ä½œæ—¥å¿—ã€ç”¨æˆ·è¡Œä¸º
æ•°æ®åŒæ­¥ï¼šç»´æŠ¤æ•°æ®ä¸€è‡´æ€§

å®é™…ä¾‹å­ï¼š
- ç”¨æˆ·è¡¨æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨è®°å½•æ“ä½œæ—¥å¿—
- è®¢å•åˆ›å»ºæ—¶ï¼Œè‡ªåŠ¨æ›´æ–°å•†å“åº“å­˜
- åˆ é™¤ç”¨æˆ·æ—¶ï¼Œè‡ªåŠ¨å¤„ç†ç›¸å…³æ•°æ®
- ä»·æ ¼å˜æ›´æ—¶ï¼Œè‡ªåŠ¨é€šçŸ¥ç›¸å…³ç³»ç»Ÿ
```

### 9.2 è§¦å‘å™¨åˆ›å»ºè¯­æ³•


**ğŸ—ï¸ è§¦å‘å™¨åŸºæœ¬è¯­æ³•**
```sql
CREATE TRIGGER trigger_name
{BEFORE | AFTER} {INSERT | UPDATE | DELETE}
ON table_name
FOR EACH ROW
BEGIN
    -- è§¦å‘å™¨é€»è¾‘
END;
```

**ğŸ“ è§¦å‘å™¨ç±»å‹è¯´æ˜**
```
è§¦å‘æ—¶æœºï¼š
- BEFOREï¼šåœ¨è§¦å‘äº‹ä»¶ä¹‹å‰æ‰§è¡Œï¼ˆå¯ä»¥ä¿®æ”¹æ–°å€¼ï¼‰
- AFTERï¼šåœ¨è§¦å‘äº‹ä»¶ä¹‹åæ‰§è¡Œï¼ˆä¸èƒ½ä¿®æ”¹æ–°å€¼ï¼‰

è§¦å‘äº‹ä»¶ï¼š
- INSERTï¼šæ’å…¥æ•°æ®æ—¶è§¦å‘
- UPDATEï¼šæ›´æ–°æ•°æ®æ—¶è§¦å‘  
- DELETEï¼šåˆ é™¤æ•°æ®æ—¶è§¦å‘

ç‰¹æ®Šå˜é‡ï¼š
- NEWï¼šä»£è¡¨æ–°æ’å…¥æˆ–æ›´æ–°åçš„è®°å½•ï¼ˆINSERTå’ŒUPDATEå¯ç”¨ï¼‰
- OLDï¼šä»£è¡¨æ›´æ–°å‰æˆ–è¢«åˆ é™¤çš„è®°å½•ï¼ˆUPDATEå’ŒDELETEå¯ç”¨ï¼‰
```

### 9.3 å®ç”¨è§¦å‘å™¨ç¤ºä¾‹


**ğŸ“Š æ•°æ®å®¡è®¡è§¦å‘å™¨**
```sql
-- åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE user_audit_log (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT,
    operation VARCHAR(10),
    old_data JSON,
    new_data JSON,
    operated_by VARCHAR(50),
    operated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç”¨æˆ·æ›´æ–°å®¡è®¡è§¦å‘å™¨
DELIMITER //
CREATE TRIGGER tr_users_audit_update
AFTER UPDATE ON users
FOR EACH ROW
BEGIN
    INSERT INTO user_audit_log (
        user_id,
        operation,
        old_data,
        new_data,
        operated_by
    ) VALUES (
        NEW.id,
        'UPDATE',
        JSON_OBJECT(
            'username', OLD.username,
            'email', OLD.email,
            'status', OLD.status
        ),
        JSON_OBJECT(
            'username', NEW.username,
            'email', NEW.email,
            'status', NEW.status
        ),
        USER()
    );
END //

-- ç”¨æˆ·åˆ é™¤å®¡è®¡è§¦å‘å™¨
CREATE TRIGGER tr_users_audit_delete
AFTER DELETE ON users
FOR EACH ROW
BEGIN
    INSERT INTO user_audit_log (
        user_id,
        operation,
        old_data,
        operated_by
    ) VALUES (
        OLD.id,
        'DELETE',
        JSON_OBJECT(
            'username', OLD.username,
            'email', OLD.email,
            'status', OLD.status
        ),
        USER()
    );
END //
DELIMITER ;
```

**ğŸ”¢ è‡ªåŠ¨è®¡ç®—è§¦å‘å™¨**
```sql
-- è®¢å•ç»Ÿè®¡è¡¨
CREATE TABLE user_order_stats (
    user_id BIGINT PRIMARY KEY,
    total_orders INT DEFAULT 0,
    total_amount DECIMAL(12,2) DEFAULT 0.00,
    last_order_date TIMESTAMP NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- è®¢å•åˆ›å»ºæ—¶æ›´æ–°ç»Ÿè®¡
DELIMITER //
CREATE TRIGGER tr_orders_insert_stats
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    INSERT INTO user_order_stats (user_id, total_orders, total_amount, last_order_date)
    VALUES (NEW.user_id, 1, NEW.amount, NEW.created_at)
    ON DUPLICATE KEY UPDATE
        total_orders = total_orders + 1,
        total_amount = total_amount + NEW.amount,
        last_order_date = NEW.created_at;
END //

-- è®¢å•åˆ é™¤æ—¶æ›´æ–°ç»Ÿè®¡
CREATE TRIGGER tr_orders_delete_stats
AFTER DELETE ON orders
FOR EACH ROW
BEGIN
    UPDATE user_order_stats
    SET 
        total_orders = total_orders - 1,
        total_amount = total_amount - OLD.amount
    WHERE user_id = OLD.user_id;
END //
DELIMITER ;
```

**âœ… æ•°æ®éªŒè¯è§¦å‘å™¨**
```sql
-- ä¸šåŠ¡è§„åˆ™éªŒè¯è§¦å‘å™¨
DELIMITER //
CREATE TRIGGER tr_orders_validate
BEFORE INSERT ON orders
FOR EACH ROW
BEGIN
    DECLARE user_status INT;
    DECLARE error_message VARCHAR(255);
    
    -- æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    SELECT status INTO user_status
    FROM users
    WHERE id = NEW.user_id;
    
    IF user_status != 1 THEN
        SET error_message = CONCAT('User ', NEW.user_id, ' is not active');
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = error_message;
    END IF;
    
    -- æ£€æŸ¥è®¢å•é‡‘é¢
    IF NEW.amount <= 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Order amount must be positive';
    END IF;
    
    -- è‡ªåŠ¨è®¾ç½®è®¢å•å·
    IF NEW.order_no IS NULL OR NEW.order_no = '' THEN
        SET NEW.order_no = CONCAT('ORD', DATE_FORMAT(NOW(), '%Y%m%d'), LPAD(CONNECTION_ID(), 6, '0'));
    END IF;
END //
DELIMITER ;
```

### 9.4 è§¦å‘å™¨ç®¡ç†æ“ä½œ


**ğŸ‘€ æŸ¥çœ‹è§¦å‘å™¨**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰è§¦å‘å™¨
SHOW TRIGGERS;

-- æ˜¾ç¤ºç‰¹å®šæ•°æ®åº“çš„è§¦å‘å™¨
SHOW TRIGGERS FROM mystore;

-- æŸ¥çœ‹è§¦å‘å™¨å®šä¹‰
SHOW CREATE TRIGGER tr_users_audit_update;

-- é€šè¿‡ç³»ç»Ÿè¡¨æŸ¥è¯¢è§¦å‘å™¨è¯¦ç»†ä¿¡æ¯
SELECT 
    TRIGGER_NAME,
    EVENT_MANIPULATION,
    EVENT_OBJECT_TABLE,
    ACTION_TIMING,
    ACTION_STATEMENT
FROM information_schema.TRIGGERS
WHERE TRIGGER_SCHEMA = 'mystore';
```

**ğŸ—‘ï¸ åˆ é™¤è§¦å‘å™¨**
```sql
-- åˆ é™¤è§¦å‘å™¨
DROP TRIGGER tr_users_audit_update;

-- å®‰å…¨åˆ é™¤
DROP TRIGGER IF EXISTS tr_users_audit_update;
```

### 9.5 è§¦å‘å™¨æœ€ä½³å®è·µ


**ğŸ“‹ è§¦å‘å™¨è®¾è®¡åŸåˆ™**
```sql
-- âœ… å¥½çš„è§¦å‘å™¨è®¾è®¡
DELIMITER //
CREATE TRIGGER tr_product_stock_check
BEFORE UPDATE ON products
FOR EACH ROW
BEGIN
    -- 1. ç®€å•å¿«é€Ÿçš„é€»è¾‘
    IF NEW.stock < 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'Stock cannot be negative';
    END IF;
    
    -- 2. é¿å…å¤æ‚æŸ¥è¯¢
    -- 3. é¿å…è°ƒç”¨å…¶ä»–è§¦å‘å™¨çš„è¡¨
END //

-- âŒ é¿å…çš„è§¦å‘å™¨è®¾è®¡
CREATE TRIGGER tr_bad_example
AFTER INSERT ON orders
FOR EACH ROW
BEGIN
    -- é¿å…ï¼šå¤æ‚çš„å¤šè¡¨è¿æ¥æŸ¥è¯¢
    -- é¿å…ï¼šè°ƒç”¨å­˜å‚¨è¿‡ç¨‹
    -- é¿å…ï¼šé€’å½’è§¦å‘å…¶ä»–è§¦å‘å™¨
    -- é¿å…ï¼šé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ
END //
DELIMITER ;
```

**âš ï¸ è§¦å‘å™¨æ³¨æ„äº‹é¡¹**
```
æ€§èƒ½å½±å“ï¼šæ¯æ¬¡DMLæ“ä½œéƒ½ä¼šæ‰§è¡Œè§¦å‘å™¨ï¼Œå½±å“æ€§èƒ½
è°ƒè¯•å›°éš¾ï¼šè§¦å‘å™¨é”™è¯¯å¯èƒ½å¯¼è‡´æ•´ä¸ªäº‹åŠ¡å›æ»š
é€’å½’é£é™©ï¼šè§¦å‘å™¨Aä¿®æ”¹è¡¨Bï¼Œè§¦å‘å™¨Båˆä¿®æ”¹è¡¨A
ç»´æŠ¤å¤æ‚ï¼šä¸šåŠ¡é€»è¾‘åˆ†æ•£åœ¨è§¦å‘å™¨ä¸­ï¼Œéš¾ä»¥ç»´æŠ¤
ç‰ˆæœ¬æ§åˆ¶ï¼šè§¦å‘å™¨å˜æ›´éœ€è¦é€šè¿‡DDLï¼Œä¸å¦‚åº”ç”¨ä»£ç çµæ´»

ä½¿ç”¨å»ºè®®ï¼š
1. ç®€å•å¿«é€Ÿçš„é€»è¾‘æ‰ç”¨è§¦å‘å™¨
2. å¤æ‚ä¸šåŠ¡é€»è¾‘æ”¾åœ¨åº”ç”¨ç¨‹åºä¸­
3. å……åˆ†æµ‹è¯•ï¼Œé¿å…é€’å½’è°ƒç”¨
4. åšå¥½å¼‚å¸¸å¤„ç†å’Œå›æ»šæœºåˆ¶
5. è®°å½•è§¦å‘å™¨çš„ä½œç”¨å’Œå˜æ›´å†å²
```

---

## 10. â° äº‹ä»¶è°ƒåº¦å™¨DDL


### 10.1 äº‹ä»¶è°ƒåº¦å™¨åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯äº‹ä»¶è°ƒåº¦å™¨**
äº‹ä»¶è°ƒåº¦å™¨å°±åƒæ•°æ®åº“ä¸­çš„"å®šæ—¶é—¹é’Ÿ"ï¼Œå¯ä»¥åœ¨æŒ‡å®šæ—¶é—´æˆ–æŒ‰ç…§å›ºå®šé—´éš”è‡ªåŠ¨æ‰§è¡ŒSQLè¯­å¥ã€‚å°±åƒè®¾å®šé—¹é’Ÿæé†’è‡ªå·±åšæŸä»¶äº‹ï¼Œæ•°æ®åº“å¯ä»¥å®šæ—¶æ‰§è¡Œæ•°æ®æ¸…ç†ã€ç»Ÿè®¡è®¡ç®—ç­‰ä»»åŠ¡ã€‚

**â° äº‹ä»¶è°ƒåº¦å™¨çš„åº”ç”¨åœºæ™¯**
```
å®šæ—¶ä»»åŠ¡ï¼š
- æ¯æ—¥æ•°æ®å¤‡ä»½
- å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
- ç”Ÿæˆæ—¥æŠ¥ã€å‘¨æŠ¥ã€æœˆæŠ¥
- å®šæ—¶åŒæ­¥æ•°æ®

ç»´æŠ¤ä»»åŠ¡ï¼š
- é‡å»ºç´¢å¼•ä¼˜åŒ–æ€§èƒ½
- æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
- æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§

ä¸šåŠ¡ä»»åŠ¡ï¼š
- å¤„ç†è¶…æ—¶è®¢å•
- å‘é€å®šæ—¶é€šçŸ¥
- è®¡ç®—ç”¨æˆ·ç§¯åˆ†
- æ›´æ–°æ’è¡Œæ¦œ
```

### 10.2 å¯ç”¨äº‹ä»¶è°ƒåº¦å™¨


**âš™ï¸ æ£€æŸ¥å’Œå¯ç”¨äº‹ä»¶è°ƒåº¦å™¨**
```sql
-- æ£€æŸ¥äº‹ä»¶è°ƒåº¦å™¨æ˜¯å¦å¯ç”¨
SHOW VARIABLES LIKE 'event_scheduler';

-- å¯ç”¨äº‹ä»¶è°ƒåº¦å™¨ï¼ˆä¸´æ—¶ç”Ÿæ•ˆï¼‰
SET GLOBAL event_scheduler = ON;

-- åœ¨é…ç½®æ–‡ä»¶ä¸­æ°¸ä¹…å¯ç”¨ï¼ˆmy.cnfï¼‰
-- [mysqld]
-- event_scheduler = ON

-- æŸ¥çœ‹å½“å‰è¿è¡Œçš„äº‹ä»¶
SHOW PROCESSLIST;
```

### 10.3 äº‹ä»¶åˆ›å»ºè¯­æ³•


**ğŸ—ï¸ äº‹ä»¶åŸºæœ¬è¯­æ³•**
```sql
CREATE EVENT event_name
ON SCHEDULE schedule_definition
[ON COMPLETION [NOT] PRESERVE]
[ENABLE | DISABLE | DISABLE ON SLAVE]
[COMMENT 'comment_string']
DO
    event_body;
```

**ğŸ“… è°ƒåº¦ç±»å‹è¯¦è§£**
```sql
-- ä¸€æ¬¡æ€§äº‹ä»¶ï¼šåœ¨æŒ‡å®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡
ON SCHEDULE AT timestamp

-- å¾ªç¯äº‹ä»¶ï¼šæŒ‰å›ºå®šé—´éš”é‡å¤æ‰§è¡Œ
ON SCHEDULE EVERY interval [STARTS timestamp] [ENDS timestamp]

-- é—´éš”å•ä½ï¼š
-- YEAR, QUARTER, MONTH, DAY, HOUR, MINUTE, WEEK, SECOND
-- YEAR_MONTH, DAY_HOUR, DAY_MINUTE, DAY_SECOND, HOUR_MINUTE, HOUR_SECOND, MINUTE_SECOND
```

### 10.4 å®ç”¨äº‹ä»¶ç¤ºä¾‹


**ğŸ§¹ æ•°æ®æ¸…ç†äº‹ä»¶**
```sql
-- æ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†è¿‡æœŸæ•°æ®
DELIMITER //
CREATE EVENT cleanup_expired_data
ON SCHEDULE EVERY 1 DAY
STARTS '2024-01-01 02:00:00'
ON COMPLETION PRESERVE
ENABLE
COMMENT 'æ¸…ç†è¿‡æœŸçš„ä¸´æ—¶æ•°æ®å’Œæ—¥å¿—'
DO
BEGIN
    -- æ¸…ç†30å¤©å‰çš„æ“ä½œæ—¥å¿—
    DELETE FROM operation_logs 
    WHERE created_at < DATE_SUB(NOW(), INTERVAL 30 DAY);
    
    -- æ¸…ç†7å¤©å‰çš„ä¸´æ—¶æ–‡ä»¶è®°å½•
    DELETE FROM temp_files 
    WHERE created_at < DATE_SUB(NOW(), INTERVAL 7 DAY);
    
    -- æ¸…ç†å·²å–æ¶ˆçš„è®¢å•ï¼ˆè¶…è¿‡3ä¸ªæœˆï¼‰
    DELETE FROM orders 
    WHERE status = 'cancelled' 
      AND created_at < DATE_SUB(NOW(), INTERVAL 3 MONTH);
      
    -- è®°å½•æ¸…ç†ç»“æœ
    INSERT INTO maintenance_log (operation, message, created_at)
    VALUES ('data_cleanup', 'Expired data cleanup completed', NOW());
END //
DELIMITER ;
```

**ğŸ“Š ç»Ÿè®¡æŠ¥è¡¨ç”Ÿæˆäº‹ä»¶**
```sql
-- æ¯å‘¨ä¸€ä¸Šåˆ9ç‚¹ç”Ÿæˆå‘¨æŠ¥
DELIMITER //
CREATE EVENT generate_weekly_report
ON SCHEDULE EVERY 1 WEEK
STARTS '2024-01-01 09:00:00'  -- ä»å‘¨ä¸€å¼€å§‹
ON COMPLETION PRESERVE
ENABLE
COMMENT 'ç”Ÿæˆå‘¨æŠ¥æ•°æ®'
DO
BEGIN
    DECLARE report_week VARCHAR(10);
    SET report_week = DATE_FORMAT(DATE_SUB(NOW(), INTERVAL 1 WEEK), '%Y-W%u');
    
    -- æ’å…¥å‘¨æŠ¥æ•°æ®
    INSERT INTO weekly_reports (
        report_week,
        new_users,
        total_orders,
        total_revenue,
        avg_order_value,
        generated_at
    )
    SELECT 
        report_week,
        COUNT(DISTINCT u.id) as new_users,
        COUNT(DISTINCT o.id) as total_orders,
        COALESCE(SUM(o.amount), 0) as total_revenue,
        COALESCE(AVG(o.amount), 0) as avg_order_value,
        NOW() as generated_at
    FROM users u
    LEFT JOIN orders o ON u.id = o.user_id 
        AND o.created_at >= DATE_SUB(NOW(), INTERVAL 1 WEEK)
        AND o.created_at < NOW()
        AND o.status = 'completed'
    WHERE u.created_at >= DATE_SUB(NOW(), INTERVAL 1 WEEK)
        AND u.created_at < NOW();
END //
DELIMITER ;
```

**ğŸ”” ä¸šåŠ¡æé†’äº‹ä»¶**
```sql
-- æ¯å°æ—¶æ£€æŸ¥è¶…æ—¶è®¢å•
DELIMITER //
CREATE EVENT check_timeout_orders
ON SCHEDULE EVERY 1 HOUR
ON COMPLETION PRESERVE
ENABLE
COMMENT 'æ£€æŸ¥å¹¶å¤„ç†è¶…æ—¶è®¢å•'
DO
BEGIN
    -- å°†30åˆ†é’Ÿæœªæ”¯ä»˜çš„è®¢å•æ ‡è®°ä¸ºè¶…æ—¶
    UPDATE orders 
    SET 
        status = 'timeout',
        updated_at = NOW()
    WHERE status = 'pending_payment'
      AND created_at < DATE_SUB(NOW(), INTERVAL 30 MINUTE);
    
    -- æ¢å¤è¶…æ—¶è®¢å•çš„åº“å­˜
    UPDATE products p
    INNER JOIN order_items oi ON p.id = oi.product_id
    INNER JOIN orders o ON oi.order_id = o.id
    SET p.stock = p.stock + oi.quantity
    WHERE o.status = 'timeout' 
      AND o.updated_at >= DATE_SUB(NOW(), INTERVAL 1 HOUR);
    
    -- å‘é€è¶…æ—¶é€šçŸ¥ï¼ˆè®°å½•åˆ°é€šçŸ¥è¡¨ï¼‰
    INSERT INTO notifications (user_id, type, message, created_at)
    SELECT 
        user_id,
        'order_timeout',
        CONCAT('è®¢å• ', order_no, ' å·²è¶…æ—¶ï¼Œè¯·é‡æ–°ä¸‹å•'),
        NOW()
    FROM orders 
    WHERE status = 'timeout'
      AND updated_at >= DATE_SUB(NOW(), INTERVAL 1 HOUR);
END //
DELIMITER ;
```

### 10.5 äº‹ä»¶ç®¡ç†æ“ä½œ


**ğŸ‘€ æŸ¥çœ‹äº‹ä»¶**
```sql
-- æ˜¾ç¤ºæ‰€æœ‰äº‹ä»¶
SHOW EVENTS;

-- æ˜¾ç¤ºç‰¹å®šæ•°æ®åº“çš„äº‹ä»¶
SHOW EVENTS FROM mystore;

-- æŸ¥çœ‹äº‹ä»¶è¯¦ç»†å®šä¹‰
SHOW CREATE EVENT cleanup_expired_data;

-- é€šè¿‡ç³»ç»Ÿè¡¨æŸ¥è¯¢äº‹ä»¶ä¿¡æ¯
SELECT 
    EVENT_NAME,
    EVENT_DEFINITION,
    INTERVAL_VALUE,
    INTERVAL_FIELD,
    STATUS,
    STARTS,
    ENDS,
    LAST_EXECUTED,
    EVENT_COMMENT
FROM information_schema.EVENTS
WHERE EVENT_SCHEMA = 'mystore';
```

**ğŸ”„ ä¿®æ”¹äº‹ä»¶**
```sql
-- ä¿®æ”¹äº‹ä»¶è°ƒåº¦
ALTER EVENT cleanup_expired_data
ON SCHEDULE EVERY 2 DAY;  -- æ”¹ä¸ºæ¯2å¤©æ‰§è¡Œä¸€æ¬¡

-- å¯ç”¨/ç¦ç”¨äº‹ä»¶
ALTER EVENT cleanup_expired_data ENABLE;
ALTER EVENT cleanup_expired_data DISABLE;

-- ä¿®æ”¹äº‹ä»¶ä½“
ALTER EVENT cleanup_expired_data
DO
BEGIN
    -- æ–°çš„äº‹ä»¶é€»è¾‘
    DELETE FROM logs WHERE created_at < DATE_SUB(NOW(), INTERVAL 60 DAY);
END;
```

**ğŸ—‘ï¸ åˆ é™¤äº‹ä»¶**
```sql
-- åˆ é™¤äº‹ä»¶
DROP EVENT cleanup_expired_data;

-- å®‰å…¨åˆ é™¤
DROP EVENT IF EXISTS cleanup_expired_data;
```

### 10.6 äº‹ä»¶è°ƒåº¦å™¨æœ€ä½³å®è·µ


**ğŸ“‹ äº‹ä»¶è®¾è®¡åŸåˆ™**
```sql
-- âœ… è‰¯å¥½çš„äº‹ä»¶è®¾è®¡
DELIMITER //
CREATE EVENT safe_maintenance_task
ON SCHEDULE EVERY 1 DAY
STARTS '2024-01-01 03:00:00'  -- é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸ
ON COMPLETION PRESERVE
ENABLE
COMMENT 'å®‰å…¨çš„ç»´æŠ¤ä»»åŠ¡ç¤ºä¾‹'
DO
BEGIN
    -- 1. å¼‚å¸¸å¤„ç†
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
    BEGIN
        INSERT INTO error_log (event_name, error_message, created_at)
        VALUES ('safe_maintenance_task', 'Error occurred during maintenance', NOW());
    END;
    
    -- 2. æ“ä½œå‰æ£€æŸ¥
    IF (SELECT COUNT(*) FROM INFORMATION_SCHEMA.PROCESSLIST 
        WHERE COMMAND != 'Sleep') > 10 THEN
        -- å¦‚æœå½“å‰è¿æ¥è¿‡å¤šï¼Œè·³è¿‡æ‰§è¡Œ
        INSERT INTO maintenance_log (message) VALUES ('Skipped due to high load');
    ELSE
        -- 3. æ‰§è¡Œç»´æŠ¤æ“ä½œ
        DELETE FROM temp_data WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 DAY);
        
        -- 4. è®°å½•æ‰§è¡Œç»“æœ
        INSERT INTO maintenance_log (message) 
        VALUES (CONCAT('Deleted ', ROW_COUNT(), ' temp records'));
    END IF;
END //
DELIMITER ;
```

**âš ï¸ äº‹ä»¶è°ƒåº¦å™¨æ³¨æ„äº‹é¡¹**
```
æ€§èƒ½è€ƒè™‘ï¼š
- é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ
- é¿å…é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ
- åˆç†è®¾ç½®æ‰§è¡Œé¢‘ç‡

é”™è¯¯å¤„ç†ï¼š
- æ·»åŠ å¼‚å¸¸å¤„ç†æœºåˆ¶
- è®°å½•æ‰§è¡Œæ—¥å¿—
- è®¾ç½®æ‰§è¡Œè¶…æ—¶

ç›‘æ§ç»´æŠ¤ï¼š
- å®šæœŸæ£€æŸ¥äº‹ä»¶æ‰§è¡Œæƒ…å†µ
- ç›‘æ§äº‹ä»¶å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“
- åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„äº‹ä»¶

å®‰å…¨è€ƒè™‘ï¼š
- äº‹ä»¶æƒé™æ§åˆ¶
- é¿å…åœ¨äº‹ä»¶ä¸­æ‰§è¡Œå±é™©æ“ä½œ
- åšå¥½æ•°æ®å¤‡ä»½

ä½¿ç”¨å»ºè®®ï¼š
1. äº‹ä»¶è°ƒåº¦å™¨éœ€è¦å•ç‹¬å¯ç”¨
2. é€‚åˆç®€å•çš„å®šæ—¶ä»»åŠ¡
3. å¤æ‚ä»»åŠ¡å»ºè®®ä½¿ç”¨å¤–éƒ¨è°ƒåº¦å·¥å…·ï¼ˆå¦‚cronï¼‰
4. åšå¥½ç›‘æ§å’Œæ—¥å¿—è®°å½•
5. å®šæœŸè¯„ä¼°å’Œä¼˜åŒ–äº‹ä»¶æ€§èƒ½
```

---

## 11. ğŸ“Š åˆ†åŒºè¡¨DDL


### 11.1 åˆ†åŒºè¡¨åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨**
åˆ†åŒºè¡¨å°±åƒæŠŠä¸€ä¸ªå¤§ä»“åº“åˆ†æˆå¤šä¸ªå°æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´å­˜å‚¨ä¸åŒç±»å‹çš„è´§ç‰©ã€‚è™½ç„¶å¯¹å¤–çœ‹èµ·æ¥è¿˜æ˜¯ä¸€ä¸ªä»“åº“ï¼Œä½†å†…éƒ¨å·²ç»åˆ†é—¨åˆ«ç±»ï¼ŒæŸ¥æ‰¾å’Œç®¡ç†éƒ½æ›´é«˜æ•ˆã€‚

**ğŸ’¡ åˆ†åŒºçš„ä¼˜åŠ¿**
```
æŸ¥è¯¢æ€§èƒ½ï¼šåªæ‰«æç›¸å…³åˆ†åŒºï¼Œé¿å…å…¨è¡¨æ‰«æ
å¹¶è¡Œå¤„ç†ï¼šå¤šä¸ªåˆ†åŒºå¯ä»¥å¹¶è¡Œæ“ä½œ
ç»´æŠ¤æ–¹ä¾¿ï¼šå¯ä»¥å•ç‹¬ç»´æŠ¤æŸä¸ªåˆ†åŒº
å­˜å‚¨ç®¡ç†ï¼šæ—§æ•°æ®åˆ†åŒºå¯ä»¥å•ç‹¬åˆ é™¤æˆ–å½’æ¡£
å¤‡ä»½çµæ´»ï¼šå¯ä»¥æŒ‰åˆ†åŒºè¿›è¡Œå¤‡ä»½å’Œæ¢å¤

é€‚ç”¨åœºæ™¯ï¼š
- å¤§è¡¨æ•°æ®ï¼ˆç™¾ä¸‡çº§ä»¥ä¸Šè®°å½•ï¼‰
- æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢é¢‘ç¹ï¼ˆæ—¥å¿—ã€è®¢å•ç­‰ï¼‰
- éœ€è¦å®šæœŸæ¸…ç†å†å²æ•°æ®
- æ•°æ®æœ‰æ˜æ˜¾çš„åˆ†ç±»ç‰¹å¾
```

### 11.2 åˆ†åŒºç±»å‹è¯¦è§£


**ğŸ“… RANGEåˆ†åŒºï¼ˆèŒƒå›´åˆ†åŒºï¼‰**
```sql
-- æŒ‰å¹´ä»½åˆ†åŒºçš„è®¢å•è¡¨
CREATE TABLE orders_partitioned (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    amount DECIMAL(10,2),
    order_date DATE NOT NULL,
    status VARCHAR(20),
    PRIMARY KEY (id, order_date)  -- åˆ†åŒºé”®å¿…é¡»åŒ…å«åœ¨ä¸»é”®ä¸­
) 
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2021 VALUES LESS THAN (2022),
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);

-- æŒ‰æœˆä»½åˆ†åŒºï¼ˆæ›´ç»†ç²’åº¦ï¼‰
CREATE TABLE user_logs (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT,
    action VARCHAR(50),
    log_time TIMESTAMP,
    PRIMARY KEY (id, log_time)
)
PARTITION BY RANGE (TO_DAYS(log_time)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    PARTITION p202404 VALUES LESS THAN (TO_DAYS('2024-05-01'))
);
```

**ğŸ”¢ HASHåˆ†åŒºï¼ˆå“ˆå¸Œåˆ†åŒºï¼‰**
```sql
-- æŒ‰ç”¨æˆ·IDå“ˆå¸Œåˆ†åŒºï¼Œå¹³å‡åˆ†æ•£æ•°æ®
CREATE TABLE user_profiles (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    profile_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (id, user_id)
)
PARTITION BY HASH(user_id) PARTITIONS 8;

-- æŒ‰å­—ç¬¦ä¸²å­—æ®µå“ˆå¸Œåˆ†åŒº
CREATE TABLE products (
    id BIGINT AUTO_INCREMENT,
    product_code VARCHAR(50) NOT NULL,
    name VARCHAR(200),
    price DECIMAL(10,2),
    PRIMARY KEY (id, product_code)
)
PARTITION BY HASH(CRC32(product_code)) PARTITIONS 4;
```

**ğŸ“ LISTåˆ†åŒºï¼ˆåˆ—è¡¨åˆ†åŒºï¼‰**
```sql
-- æŒ‰åœ°åŒºåˆ†åŒº
CREATE TABLE regional_sales (
    id BIGINT AUTO_INCREMENT,
    region_id INT NOT NULL,
    region_name VARCHAR(50),
    sales_amount DECIMAL(12,2),
    sale_date DATE,
    PRIMARY KEY (id, region_id)
)
PARTITION BY LIST(region_id) (
    PARTITION p_north VALUES IN (1,2,3),      -- åŒ—æ–¹åŒºåŸŸ
    PARTITION p_south VALUES IN (4,5,6),      -- å—æ–¹åŒºåŸŸ
    PARTITION p_east VALUES IN (7,8,9),       -- ä¸œéƒ¨åŒºåŸŸ
    PARTITION p_west VALUES IN (10,11,12)     -- è¥¿éƒ¨åŒºåŸŸ
);

-- æŒ‰çŠ¶æ€åˆ†åŒº
CREATE TABLE order_status_log (
    id BIGINT AUTO_INCREMENT,
    order_id BIGINT,
    status VARCHAR(20) NOT NULL,
    changed_at TIMESTAMP,
    PRIMARY KEY (id, status)
)
PARTITION BY LIST COLUMNS(status) (
    PARTITION p_pending VALUES IN ('pending', 'confirmed'),
    PARTITION p_processing VALUES IN ('paid', 'shipped'),
    PARTITION p_completed VALUES IN ('delivered', 'completed'),
    PARTITION p_cancelled VALUES IN ('cancelled', 'refunded')
);
```

**ğŸ—ï¸ KEYåˆ†åŒºï¼ˆé”®åˆ†åŒºï¼‰**
```sql
-- MySQLè‡ªåŠ¨é€‰æ‹©åˆ†åŒºé”®
CREATE TABLE user_sessions (
    session_id VARCHAR(64) PRIMARY KEY,
    user_id BIGINT,
    login_time TIMESTAMP,
    last_activity TIMESTAMP
)
PARTITION BY KEY() PARTITIONS 6;

-- æŒ‡å®šåˆ†åŒºé”®
CREATE TABLE user_preferences (
    user_id BIGINT,
    preference_key VARCHAR(100),
    preference_value TEXT,
    PRIMARY KEY (user_id, preference_key)
)
PARTITION BY KEY(user_id) PARTITIONS 4;
```

### 11.3 å­åˆ†åŒºï¼ˆå¤åˆåˆ†åŒºï¼‰


**ğŸ”€ RANGE + HASH å­åˆ†åŒº**
```sql
CREATE TABLE complex_orders (
    id BIGINT AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    amount DECIMAL(10,2),
    order_date DATE NOT NULL,
    PRIMARY KEY (id, order_date, user_id)
)
PARTITION BY RANGE (YEAR(order_date))
SUBPARTITION BY HASH(user_id) 
SUBPARTITIONS 4 (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 11.4 åˆ†åŒºç®¡ç†æ“ä½œ


**â• æ·»åŠ åˆ†åŒº**
```sql
-- ä¸ºRANGEåˆ†åŒºè¡¨æ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders_partitioned 
ADD PARTITION (
    PARTITION p2025 VALUES LESS THAN (2026)
);

-- ä¸ºHASHåˆ†åŒºè¡¨å¢åŠ åˆ†åŒºæ•°é‡ï¼ˆé‡æ–°åˆ†å¸ƒæ•°æ®ï¼‰
ALTER TABLE user_profiles PARTITION BY HASH(user_id) PARTITIONS 12;

-- ä¸ºLISTåˆ†åŒºæ·»åŠ æ–°åˆ†åŒº
ALTER TABLE regional_sales
ADD PARTITION (
    PARTITION p_overseas VALUES IN (13,14,15)
);
```

**ğŸ—‘ï¸ åˆ é™¤åˆ†åŒº**
```sql
-- åˆ é™¤åˆ†åŒºï¼ˆæ•°æ®ä¹Ÿä¼šè¢«åˆ é™¤ï¼‰
ALTER TABLE orders_partitioned DROP PARTITION p2021;

-- æ‰¹é‡åˆ é™¤åˆ†åŒº
ALTER TABLE orders_partitioned DROP PARTITION p2021, p2022;
```

**ğŸ”„ åˆ†åŒºé‡ç»„**
```sql
-- é‡ç»„åˆ†åŒºï¼šå°†å¤šä¸ªåˆ†åŒºåˆå¹¶
ALTER TABLE orders_partitioned 
REORGANIZE PARTITION p2021, p2022 INTO (
    PARTITION p2021_2022 VALUES LESS THAN (2023)
);

-- æ‹†åˆ†åˆ†åŒºï¼šå°†ä¸€ä¸ªåˆ†åŒºåˆ†æˆå¤šä¸ª
ALTER TABLE orders_partitioned
REORGANIZE PARTITION p_future INTO (
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p2026 VALUES LESS THAN (2027),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

**âœ‚ï¸ æˆªæ–­åˆ†åŒº**
```sql
-- æ¸…ç©ºåˆ†åŒºæ•°æ®ï¼ˆæ¯”DELETEå¿«ï¼‰
ALTER TABLE orders_partitioned TRUNCATE PARTITION p2021;

-- æˆªæ–­å¤šä¸ªåˆ†åŒº
ALTER TABLE orders_partitioned TRUNCATE PARTITION p2021, p2022;
```

### 11.5 åˆ†åŒºæŸ¥è¯¢å’Œä¼˜åŒ–


**ğŸ” æŸ¥çœ‹åˆ†åŒºä¿¡æ¯**
```sql
-- æŸ¥çœ‹è¡¨çš„åˆ†åŒºä¿¡æ¯
SELECT 
    PARTITION_NAME,
    PARTITION_METHOD,
    PARTITION_EXPRESSION,
    TABLE_ROWS,
    DATA_LENGTH,
    INDEX_LENGTH
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders_partitioned' 
  AND TABLE_SCHEMA = 'mystore';

-- æŸ¥çœ‹å…·ä½“åˆ†åŒºçš„æ•°æ®é‡
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    ROUND(DATA_LENGTH/1024/1024, 2) as 'Data Size (MB)',
    ROUND(INDEX_LENGTH/1024/1024, 2) as 'Index Size (MB)'
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders_partitioned';
```

**âš¡ åˆ†åŒºå‰ªææŸ¥è¯¢**
```sql
-- åˆ©ç”¨åˆ†åŒºå‰ªæçš„æŸ¥è¯¢ï¼ˆåªæ‰«æç›¸å…³åˆ†åŒºï¼‰
SELECT * FROM orders_partitioned 
WHERE order_date >= '2024-01-01' 
  AND order_date < '2024-12-31';  -- åªæ‰«æ2024å¹´åˆ†åŒº

-- æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œç¡®è®¤åˆ†åŒºå‰ªæ
EXPLAIN PARTITIONS 
SELECT * FROM orders_partitioned 
WHERE order_date = '2024-06-15';
```

### 11.6 åˆ†åŒºè¡¨æœ€ä½³å®è·µ


**ğŸ“‹ åˆ†åŒºè®¾è®¡åŸåˆ™**
```sql
-- âœ… è‰¯å¥½çš„åˆ†åŒºè®¾è®¡
CREATE TABLE order_history (
    id BIGINT AUTO_INCREMENT,
    order_no VARCHAR(32) NOT NULL,
    user_id BIGINT NOT NULL,
    amount DECIMAL(10,2),
    order_date DATE NOT NULL,
    status VARCHAR(20),
    
    -- 1. åˆ†åŒºé”®åŒ…å«åœ¨ä¸»é”®ä¸­
    PRIMARY KEY (id, order_date),
    
    -- 2. å¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•
    INDEX idx_user_id (user_id),
    INDEX idx_order_no (order_no),
    INDEX idx_status (status)
)
-- 3. é€‰æ‹©åˆé€‚çš„åˆ†åŒºç­–ç•¥
PARTITION BY RANGE (TO_DAYS(order_date)) (
    PARTITION p202401 VALUES LESS THAN (TO_DAYS('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (TO_DAYS('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (TO_DAYS('2024-04-01')),
    -- 4. é¢„ç•™æœªæ¥åˆ†åŒº
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

**âš ï¸ åˆ†åŒºè¡¨æ³¨æ„äº‹é¡¹**
```
åˆ†åŒºé”®é™åˆ¶ï¼š
- åˆ†åŒºé”®å¿…é¡»æ˜¯æ•´æ•°æˆ–è¿”å›æ•´æ•°çš„è¡¨è¾¾å¼
- åˆ†åŒºé”®å¿…é¡»åŒ…å«åœ¨ä¸»é”®æˆ–å”¯ä¸€é”®ä¸­
- ä¸èƒ½ä½¿ç”¨AUTO_INCREMENTå­—æ®µä½œä¸ºå”¯ä¸€åˆ†åŒºé”®

æŸ¥è¯¢ä¼˜åŒ–ï¼š
- æŸ¥è¯¢æ¡ä»¶å°½é‡åŒ…å«åˆ†åŒºé”®ï¼Œåˆ©ç”¨åˆ†åŒºå‰ªæ
- é¿å…è·¨åˆ†åŒºçš„å¤æ‚æŸ¥è¯¢
- åˆç†ä½¿ç”¨åˆ†åŒºå†…çš„ç´¢å¼•

ç»´æŠ¤æˆæœ¬ï¼š
- éœ€è¦å®šæœŸç»´æŠ¤åˆ†åŒºï¼ˆæ·»åŠ ã€åˆ é™¤ã€é‡ç»„ï¼‰
- åˆ†åŒºè¿‡å¤šä¼šå½±å“æ€§èƒ½
- å¤‡ä»½å’Œæ¢å¤å˜å¾—å¤æ‚

ä½¿ç”¨å»ºè®®ï¼š
1. è¡¨æ•°æ®é‡è¾¾åˆ°ç™¾ä¸‡çº§ä»¥ä¸Šå†è€ƒè™‘åˆ†åŒº
2. æœ‰æ˜æ˜¾çš„æ•°æ®åˆ†ç±»ç‰¹å¾ï¼ˆå¦‚æ—¶é—´ã€åœ°åŒºï¼‰
3. æŸ¥è¯¢æ¨¡å¼ç›¸å¯¹å›ºå®š
4. éœ€è¦å®šæœŸæ¸…ç†å†å²æ•°æ®
5. åšå¥½ç›‘æ§å’Œç»´æŠ¤è®¡åˆ’
```

---

## 12. ğŸ’¾ è¡¨ç©ºé—´DDL


### 12.1 è¡¨ç©ºé—´åŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯è¡¨ç©ºé—´**
è¡¨ç©ºé—´å°±åƒæ˜¯æ•°æ®åº“çš„"å­˜å‚¨ä»“åº“"ï¼Œå†³å®šäº†æ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨å“ªé‡Œã€å¦‚ä½•å­˜å‚¨ã€‚MySQLä¸­ä¸»è¦æœ‰ç³»ç»Ÿè¡¨ç©ºé—´å’Œç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå°±åƒæŠŠæ–‡ä»¶å­˜åœ¨å…¬å…±æ–‡ä»¶å¤¹è¿˜æ˜¯æ¯ä¸ªäººçš„ç§äººæ–‡ä»¶å¤¹ã€‚

**ğŸ  è¡¨ç©ºé—´çš„ç±»å‹**
```
ç³»ç»Ÿè¡¨ç©ºé—´ï¼ˆibdata1ï¼‰ï¼š
- MySQLé»˜è®¤çš„å…±äº«è¡¨ç©ºé—´
- å­˜å‚¨InnoDBæ•°æ®å­—å…¸ã€æ’¤é”€æ—¥å¿—ç­‰
- å¤šä¸ªè¡¨å…±äº«åŒä¸€ä¸ªæ–‡ä»¶

ç‹¬ç«‹è¡¨ç©ºé—´ï¼ˆ.ibdæ–‡ä»¶ï¼‰ï¼š
- æ¯ä¸ªè¡¨éƒ½æœ‰è‡ªå·±çš„è¡¨ç©ºé—´æ–‡ä»¶  
- ä¾¿äºç®¡ç†å’Œç»´æŠ¤
- MySQL 5.6+é»˜è®¤å¯ç”¨

é€šç”¨è¡¨ç©ºé—´ï¼ˆGeneral Tablespaceï¼‰ï¼š
- MySQL 5.7+æ–°å¢åŠŸèƒ½
- å¯ä»¥åŒ…å«å¤šä¸ªè¡¨
- æä¾›æ›´çµæ´»çš„å­˜å‚¨ç®¡ç†
```

### 12.2 é€šç”¨è¡¨ç©ºé—´æ“ä½œ


**ğŸ—ï¸ åˆ›å»ºé€šç”¨è¡¨ç©ºé—´**
```sql
-- åˆ›å»ºé€šç”¨è¡¨ç©ºé—´
CREATE TABLESPACE ts_user_data 
ADD DATAFILE 'ts_user_data.ibd' 
FILE_BLOCK_SIZE = 16K
ENGINE = InnoDB;

-- åˆ›å»ºæŒ‡å®šè·¯å¾„çš„è¡¨ç©ºé—´
CREATE TABLESPACE ts_logs
ADD DATAFILE '/var/lib/mysql-files/ts_logs.ibd'
FILE_BLOCK_SIZE = 8K
ENGINE = InnoDB;
```

**ğŸ”§ åœ¨è¡¨ç©ºé—´ä¸­åˆ›å»ºè¡¨**
```sql
-- åœ¨æŒ‡å®šè¡¨ç©ºé—´ä¸­åˆ›å»ºè¡¨
CREATE TABLE user_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    profile_data JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) TABLESPACE ts_user_data;

-- å°†ç°æœ‰è¡¨ç§»åŠ¨åˆ°æŒ‡å®šè¡¨ç©ºé—´
ALTER TABLE existing_table TABLESPACE ts_user_data;
```

**ğŸ‘€ æŸ¥çœ‹è¡¨ç©ºé—´ä¿¡æ¯**
```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨ç©ºé—´
SELECT 
    TABLESPACE_NAME,
    FILE_NAME,
    FILE_TYPE,
    TOTAL_EXTENTS,
    DATA_FREE
FROM information_schema.FILES;

-- æŸ¥çœ‹è¡¨æ‰€åœ¨çš„è¡¨ç©ºé—´
SELECT 
    TABLE_NAME,
    TABLESPACE_NAME
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'mystore';
```

### 12.3 ç‹¬ç«‹è¡¨ç©ºé—´ç®¡ç†


**âš™ï¸ å¯ç”¨ç‹¬ç«‹è¡¨ç©ºé—´**
```sql
-- æŸ¥çœ‹å½“å‰è®¾ç½®
SHOW VARIABLES LIKE 'innodb_file_per_table';

-- å¯ç”¨ç‹¬ç«‹è¡¨ç©ºé—´ï¼ˆå…¨å±€è®¾ç½®ï¼‰
SET GLOBAL innodb_file_per_table = ON;

-- åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
-- [mysqld]
-- innodb_file_per_table = 1
```

**ğŸ“Š è¡¨ç©ºé—´å¤§å°ç®¡ç†**
```sql
-- æŸ¥çœ‹è¡¨ç©ºé—´æ–‡ä»¶å¤§å°
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    ROUND((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS 'Size (MB)',
    DATA_FREE / 1024 / 1024 AS 'Free (MB)'
FROM information_schema.TABLES 
WHERE ENGINE = 'InnoDB' AND TABLE_SCHEMA = 'mystore'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;
```

### 12.4 è¡¨ç©ºé—´å‹ç¼©


**ğŸ—œï¸ è¡¨å‹ç¼©è®¾ç½®**
```sql
-- åˆ›å»ºå‹ç¼©è¡¨
CREATE TABLE compressed_logs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    log_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) 
ENGINE = InnoDB
ROW_FORMAT = COMPRESSED
KEY_BLOCK_SIZE = 8;

-- ä¿®æ”¹ç°æœ‰è¡¨ä¸ºå‹ç¼©æ ¼å¼
ALTER TABLE large_table 
ROW_FORMAT = COMPRESSED,
KEY_BLOCK_SIZE = 8;
```

**ğŸ“ˆ å‹ç¼©æ•ˆæœæŸ¥çœ‹**
```sql
-- æŸ¥çœ‹å‹ç¼©ç»Ÿè®¡ä¿¡æ¯
SELECT 
    TABLE_NAME,
    COMPRESS_OPS,
    COMPRESS_OPS_OK,
    COMPRESS_TIME,
    UNCOMPRESS_OPS,
    UNCOMPRESS_TIME
FROM information_schema.INNODB_CMP_PER_INDEX 
WHERE DATABASE_NAME = 'mystore';
```

### 12.5 è¡¨ç©ºé—´ç»´æŠ¤æ“ä½œ


**ğŸ”„ è¡¨ç©ºé—´é‡ç»„**
```sql
-- å›æ”¶è¡¨ç©ºé—´ç¢ç‰‡
OPTIMIZE TABLE table_name;

-- é‡å»ºè¡¨ï¼ˆå›æ”¶ç©ºé—´ï¼‰
ALTER TABLE table_name ENGINE = InnoDB;

-- åˆ†æè¡¨ç©ºé—´ä½¿ç”¨æƒ…å†µ
ANALYZE TABLE table_name;
```

**ğŸ—‘ï¸ åˆ é™¤è¡¨ç©ºé—´**
```sql
-- åˆ é™¤é€šç”¨è¡¨ç©ºé—´ï¼ˆå¿…é¡»å…ˆåˆ é™¤å…¶ä¸­çš„æ‰€æœ‰è¡¨ï¼‰
DROP TABLESPACE ts_user_data ENGINE = InnoDB;

-- åˆ é™¤è¡¨ç©ºé—´æ–‡ä»¶éœ€è¦æ‰‹åŠ¨æ“ä½œï¼ˆåœæ­¢MySQLååˆ é™¤ï¼‰
```

---

## 13. ğŸ‘¥ ç”¨æˆ·ä¸æƒé™DDL


### 13.1 ç”¨æˆ·ç®¡ç†åŸºç¡€


**ğŸ”¸ MySQLç”¨æˆ·è´¦å·æ ¼å¼**
MySQLä¸­çš„ç”¨æˆ·ç”±ç”¨æˆ·åå’Œä¸»æœºåç»„æˆï¼Œæ ¼å¼ä¸ºï¼š'username'@'hostname'

```sql
'root'@'localhost'        -- åªèƒ½ä»æœ¬åœ°è¿æ¥
'app_user'@'192.168.1.100' -- åªèƒ½ä»æŒ‡å®šIPè¿æ¥
'web_user'@'192.168.1.%'   -- å¯ä»¥ä»192.168.1.xç½‘æ®µè¿æ¥
'api_user'@'%'             -- å¯ä»¥ä»ä»»æ„ä¸»æœºè¿æ¥
```

### 13.2 ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†


**ğŸ‘¤ åˆ›å»ºç”¨æˆ·**
```sql
-- åŸºæœ¬ç”¨æˆ·åˆ›å»º
CREATE USER 'app_user'@'localhost' IDENTIFIED BY 'secure_password123';

-- åˆ›å»ºå¯ä»¥ä»ä»»æ„ä¸»æœºè¿æ¥çš„ç”¨æˆ·
CREATE USER 'web_api'@'%' IDENTIFIED BY 'api_password456';

-- åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®å¯†ç åŠ å¯†æ–¹å¼
CREATE USER 'secure_user'@'localhost' 
IDENTIFIED WITH mysql_native_password BY 'password123';

-- åˆ›å»ºç”¨æˆ·å¹¶è®¾ç½®è´¦å·å±æ€§
CREATE USER 'temp_user'@'localhost' 
IDENTIFIED BY 'temp_pass'
PASSWORD EXPIRE INTERVAL 90 DAY  -- å¯†ç 90å¤©è¿‡æœŸ
ACCOUNT LOCK;                     -- åˆ›å»ºåç«‹å³é”å®š
```

**ğŸ”‘ ä¿®æ”¹ç”¨æˆ·**
```sql
-- ä¿®æ”¹ç”¨æˆ·å¯†ç 
ALTER USER 'app_user'@'localhost' IDENTIFIED BY 'new_password789';

-- ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç 
ALTER USER USER() IDENTIFIED BY 'my_new_password';

-- è®¾ç½®å¯†ç è¿‡æœŸ
ALTER USER 'app_user'@'localhost' PASSWORD EXPIRE;

-- é”å®š/è§£é”ç”¨æˆ·
ALTER USER 'app_user'@'localhost' ACCOUNT LOCK;
ALTER USER 'app_user'@'localhost' ACCOUNT UNLOCK;

-- è®¾ç½®ç”¨æˆ·èµ„æºé™åˆ¶
ALTER USER 'app_user'@'localhost'
WITH MAX_CONNECTIONS_PER_HOUR 100      -- æ¯å°æ—¶æœ€å¤§è¿æ¥æ•°
     MAX_QUERIES_PER_HOUR 1000         -- æ¯å°æ—¶æœ€å¤§æŸ¥è¯¢æ•°
     MAX_UPDATES_PER_HOUR 500          -- æ¯å°æ—¶æœ€å¤§æ›´æ–°æ•°
     MAX_USER_CONNECTIONS 10;          -- åŒæ—¶æœ€å¤§è¿æ¥æ•°
```

**ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·**
```sql
-- åˆ é™¤ç”¨æˆ·
DROP USER 'app_user'@'localhost';

-- å®‰å…¨åˆ é™¤ï¼ˆç”¨æˆ·ä¸å­˜åœ¨ä¹Ÿä¸æŠ¥é”™ï¼‰
DROP USER IF EXISTS 'temp_user'@'localhost';

-- æ‰¹é‡åˆ é™¤ç”¨æˆ·
DROP USER 'user1'@'localhost', 'user2'@'%', 'user3'@'192.168.1.%';
```

### 13.3 æƒé™ç®¡ç†


**ğŸ” æƒé™ç±»å‹è¯¦è§£**
```sql
-- å…¨å±€æƒé™
ALL PRIVILEGES          -- æ‰€æœ‰æƒé™ï¼ˆé™¤GRANTæƒé™å¤–ï¼‰
CREATE USER            -- åˆ›å»ºç”¨æˆ·æƒé™
SUPER                   -- è¶…çº§ç”¨æˆ·æƒé™
PROCESS                 -- æŸ¥çœ‹è¿›ç¨‹æƒé™
RELOAD                  -- é‡è½½æƒé™
SHUTDOWN               -- å…³é—­æœåŠ¡å™¨æƒé™

-- æ•°æ®åº“çº§æƒé™
CREATE                  -- åˆ›å»ºæ•°æ®åº“å’Œè¡¨
DROP                    -- åˆ é™¤æ•°æ®åº“å’Œè¡¨  
ALTER                   -- ä¿®æ”¹è¡¨ç»“æ„
INDEX                   -- åˆ›å»ºå’Œåˆ é™¤ç´¢å¼•
REFERENCES             -- å¤–é”®å¼•ç”¨æƒé™

-- è¡¨çº§æƒé™
SELECT                  -- æŸ¥è¯¢æ•°æ®
INSERT                  -- æ’å…¥æ•°æ®
UPDATE                  -- æ›´æ–°æ•°æ®
DELETE                  -- åˆ é™¤æ•°æ®
TRIGGER                 -- è§¦å‘å™¨æƒé™

-- å­—æ®µçº§æƒé™
SELECT (column_list)    -- ç‰¹å®šå­—æ®µçš„æŸ¥è¯¢æƒé™
INSERT (column_list)    -- ç‰¹å®šå­—æ®µçš„æ’å…¥æƒé™
UPDATE (column_list)    -- ç‰¹å®šå­—æ®µçš„æ›´æ–°æƒé™
```

**â• æˆäºˆæƒé™**
```sql
-- æˆäºˆæ•°æ®åº“æ‰€æœ‰æƒé™
GRANT ALL PRIVILEGES ON mystore.* TO 'app_user'@'localhost';

-- æˆäºˆç‰¹å®šè¡¨çš„æƒé™
GRANT SELECT, INSERT, UPDATE, DELETE ON mystore.users TO 'web_user'@'%';

-- æˆäºˆç‰¹å®šå­—æ®µçš„æƒé™
GRANT SELECT (id, username, email), UPDATE (email) ON mystore.users TO 'limited_user'@'localhost';

-- æˆäºˆå­˜å‚¨è¿‡ç¨‹æƒé™
GRANT EXECUTE ON PROCEDURE mystore.get_user_stats TO 'report_user'@'%';

-- æˆäºˆåˆ›å»ºè§†å›¾æƒé™
GRANT CREATE VIEW ON mystore.* TO 'view_user'@'localhost';

-- æˆäºˆç®¡ç†æƒé™
GRANT CREATE USER, RELOAD ON *.* TO 'admin_user'@'localhost';
```

**âŒ æ’¤é”€æƒé™**
```sql
-- æ’¤é”€ç‰¹å®šæƒé™
REVOKE INSERT, UPDATE, DELETE ON mystore.users FROM 'web_user'@'%';

-- æ’¤é”€æ‰€æœ‰æƒé™
REVOKE ALL PRIVILEGES ON mystore.* FROM 'app_user'@'localhost';

-- æ’¤é”€å…¨å±€æƒé™
REVOKE SUPER ON *.* FROM 'admin_user'@'localhost';
```

**ğŸ‘ï¸ æŸ¥çœ‹æƒé™**
```sql
-- æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™
SHOW GRANTS;

-- æŸ¥çœ‹æŒ‡å®šç”¨æˆ·æƒé™
SHOW GRANTS FOR 'app_user'@'localhost';

-- é€šè¿‡ç³»ç»Ÿè¡¨æŸ¥çœ‹æƒé™è¯¦æƒ…
SELECT 
    User,
    Host,
    Select_priv,
    Insert_priv,
    Update_priv,
    Delete_priv,
    Create_priv,
    Drop_priv
FROM mysql.user 
WHERE User = 'app_user';
```

### 13.4 è§’è‰²ç®¡ç†ï¼ˆMySQL 8.0+ï¼‰


**ğŸ·ï¸ åˆ›å»ºå’Œç®¡ç†è§’è‰²**
```sql
-- åˆ›å»ºè§’è‰²
CREATE ROLE 'app_developer', 'data_analyst', 'report_viewer';

-- ä¸ºè§’è‰²æˆæƒ
GRANT SELECT, INSERT, UPDATE, DELETE ON mystore.* TO 'app_developer';
GRANT SELECT ON mystore.* TO 'data_analyst';
GRANT SELECT ON mystore.reports TO 'report_viewer';

-- å°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·
GRANT 'app_developer' TO 'john'@'localhost';
GRANT 'data_analyst', 'report_viewer' TO 'jane'@'%';

-- è®¾ç½®é»˜è®¤è§’è‰²
SET DEFAULT ROLE 'app_developer' TO 'john'@'localhost';

-- æ¿€æ´»è§’è‰²ï¼ˆç”¨æˆ·ç™»å½•åéœ€è¦æ¿€æ´»ï¼‰
SET ROLE 'app_developer';
SET ROLE ALL;
```

**ğŸ—‘ï¸ åˆ é™¤è§’è‰²**
```sql
-- åˆ é™¤è§’è‰²ï¼ˆéœ€è¦å…ˆä»ç”¨æˆ·æ’¤é”€ï¼‰
REVOKE 'app_developer' FROM 'john'@'localhost';
DROP ROLE 'app_developer';
```

### 13.5 æƒé™å®‰å…¨æœ€ä½³å®è·µ


**ğŸ›¡ï¸ æƒé™è®¾è®¡åŸåˆ™**
```sql
-- 1. æœ€å°æƒé™åŸåˆ™ï¼šåªæˆäºˆå¿…éœ€çš„æƒé™
-- âŒ è¿‡åº¦æˆæƒ
GRANT ALL PRIVILEGES ON *.* TO 'app_user'@'%';

-- âœ… ç²¾ç¡®æˆæƒ  
GRANT SELECT, INSERT, UPDATE ON mystore.users TO 'user_service'@'app_server';
GRANT SELECT, INSERT ON mystore.logs TO 'user_service'@'app_server';

-- 2. ç½‘ç»œè®¿é—®æ§åˆ¶ï¼šé™åˆ¶è¿æ¥æ¥æº
-- âŒ å…è®¸ä»»æ„ä¸»æœºè¿æ¥
CREATE USER 'sensitive_user'@'%';

-- âœ… é™åˆ¶ç‰¹å®šä¸»æœºæˆ–ç½‘æ®µ
CREATE USER 'api_user'@'192.168.10.%';
CREATE USER 'local_admin'@'localhost';

-- 3. åˆ†å±‚æƒé™ç®¡ç†ï¼šä¸åŒç¯å¢ƒä¸åŒæƒé™
-- å¼€å‘ç¯å¢ƒç”¨æˆ·
CREATE USER 'dev_user'@'dev_server' IDENTIFIED BY 'dev_password';
GRANT ALL PRIVILEGES ON dev_db.* TO 'dev_user'@'dev_server';

-- ç”Ÿäº§ç¯å¢ƒç”¨æˆ·ï¼ˆå—é™æƒé™ï¼‰
CREATE USER 'prod_app'@'prod_server' IDENTIFIED BY 'secure_prod_password';
GRANT SELECT, INSERT, UPDATE, DELETE ON prod_db.users TO 'prod_app'@'prod_server';
GRANT SELECT, INSERT ON prod_db.logs TO 'prod_app'@'prod_server';
```

**ğŸ”„ æƒé™ç»´æŠ¤æ“ä½œ**
```sql
-- åˆ·æ–°æƒé™ç¼“å­˜
FLUSH PRIVILEGES;

-- å®šæœŸå®¡æŸ¥æƒé™
SELECT 
    CONCAT(User, '@', Host) as Account,
    Super_priv,
    Create_user_priv,
    Process_priv,
    File_priv,
    Grant_priv
FROM mysql.user 
ORDER BY Super_priv DESC, Create_user_priv DESC;

-- æŸ¥æ‰¾è¿‡åº¦æˆæƒçš„è´¦å·
SELECT DISTINCT
    User,
    Host
FROM mysql.user 
WHERE Super_priv = 'Y' 
   OR Grant_priv = 'Y'
   OR File_priv = 'Y';
```

---

## 14. ğŸš€ é«˜çº§DDLç‰¹æ€§


### 14.1 ç”Ÿæˆåˆ—ï¼ˆGenerated Columnsï¼‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯ç”Ÿæˆåˆ—**
ç”Ÿæˆåˆ—å°±åƒExcelä¸­çš„è®¡ç®—åˆ—ï¼Œå®ƒçš„å€¼æ˜¯æ ¹æ®å…¶ä»–åˆ—è‡ªåŠ¨è®¡ç®—å‡ºæ¥çš„ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ã€‚åˆ†ä¸ºè™šæ‹Ÿç”Ÿæˆåˆ—å’Œå­˜å‚¨ç”Ÿæˆåˆ—ä¸¤ç§ã€‚

**ğŸ“Š è™šæ‹Ÿç”Ÿæˆåˆ—**
```sql
-- åˆ›å»ºåŒ…å«ç”Ÿæˆåˆ—çš„è¡¨
CREATE TABLE user_profiles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    birth_date DATE,
    
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šä¸å å­˜å‚¨ç©ºé—´ï¼ŒæŸ¥è¯¢æ—¶è®¡ç®—
    full_name VARCHAR(101) GENERATED ALWAYS AS (CONCAT(first_name, ' ', last_name)) VIRTUAL,
    age INT GENERATED ALWAYS AS (TIMESTAMPDIFF(YEAR, birth_date, CURDATE())) VIRTUAL
);

-- æ·»åŠ è™šæ‹Ÿç”Ÿæˆåˆ—
ALTER TABLE products ADD COLUMN 
    price_with_tax DECIMAL(10,2) GENERATED ALWAYS AS (price * 1.1) VIRTUAL;
```

**ğŸ’¾ å­˜å‚¨ç”Ÿæˆåˆ—**
```sql
-- å­˜å‚¨ç”Ÿæˆåˆ—ï¼šå ç”¨å­˜å‚¨ç©ºé—´ï¼Œæ’å…¥æ—¶è®¡ç®—å¹¶ä¿å­˜
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_date DATE NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    tax_rate DECIMAL(4,4) DEFAULT 0.08,
    
    -- å­˜å‚¨ç”Ÿæˆåˆ—ï¼šå€¼ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œå¯ä»¥å»ºç´¢å¼•
    tax_amount DECIMAL(10,2) GENERATED ALWAYS AS (amount * tax_rate) STORED,
    total_amount DECIMAL(10,2) GENERATED ALWAYS AS (amount * (1 + tax_rate)) STORED,
    quarter VARCHAR(6) GENERATED ALWAYS AS (CONCAT(YEAR(order_date), '-Q', QUARTER(order_date))) STORED,
    
    -- å¯ä»¥åœ¨ç”Ÿæˆåˆ—ä¸Šå»ºç´¢å¼•ï¼ˆä»…é™STOREDç±»å‹ï¼‰
    INDEX idx_quarter (quarter),
    INDEX idx_total_amount (total_amount)
);
```

**ğŸ”§ ç”Ÿæˆåˆ—çš„ä½¿ç”¨ç¤ºä¾‹**
```sql
-- æ’å…¥æ•°æ®ï¼ˆä¸éœ€è¦æŒ‡å®šç”Ÿæˆåˆ—çš„å€¼ï¼‰
INSERT INTO user_profiles (first_name, last_name, birth_date) 
VALUES ('å¼ ', 'ä¸‰', '1990-05-15');

-- æŸ¥è¯¢æ—¶ç”Ÿæˆåˆ—è‡ªåŠ¨è®¡ç®—
SELECT id, first_name, last_name, full_name, age 
FROM user_profiles;

-- å¯ä»¥åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨ç”Ÿæˆåˆ—
SELECT * FROM user_profiles WHERE age >= 30;
SELECT * FROM orders WHERE quarter = '2024-Q2';
```

### 14.2 ä¸å¯è§åˆ—ï¼ˆInvisible Columnsï¼‰


**ğŸ”¸ ä»€ä¹ˆæ˜¯ä¸å¯è§åˆ—**
ä¸å¯è§åˆ—å­˜åœ¨äºè¡¨ä¸­ä½†åœ¨SELECT *æŸ¥è¯¢ä¸­ä¸æ˜¾ç¤ºï¼Œä¸»è¦ç”¨äºç‰ˆæœ¬å…¼å®¹æ€§å’Œæ¸è¿›å¼schemaæ¼”è¿›ã€‚

**ğŸ‘ï¸ åˆ›å»ºå’Œç®¡ç†ä¸å¯è§åˆ—**
```sql
-- åˆ›å»ºå¸¦ä¸å¯è§åˆ—çš„è¡¨
CREATE TABLE products (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    price DECIMAL(10,2),
    -- ä¸å¯è§åˆ—ï¼šç”¨äºå†…éƒ¨ç»Ÿè®¡ï¼Œä¸å½±å“ç°æœ‰æŸ¥è¯¢
    view_count INT DEFAULT 0 INVISIBLE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP INVISIBLE
);

-- æ·»åŠ ä¸å¯è§åˆ—
ALTER TABLE users ADD COLUMN 
    internal_score INT DEFAULT 0 INVISIBLE;

-- å°†ç°æœ‰åˆ—è®¾ä¸ºä¸å¯è§
ALTER TABLE users ALTER COLUMN internal_score SET INVISIBLE;

-- å°†ä¸å¯è§åˆ—è®¾ä¸ºå¯è§
ALTER TABLE users ALTER COLUMN internal_score SET VISIBLE;
```

**ğŸ” ä¸å¯è§åˆ—çš„æŸ¥è¯¢**
```sql
-- SELECT * ä¸ä¼šæ˜¾ç¤ºä¸å¯è§åˆ—
SELECT * FROM products;

-- å¿…é¡»æ˜ç¡®æŒ‡å®šä¸å¯è§åˆ—æ‰èƒ½æŸ¥è¯¢
SELECT id, name, price, view_count, created_at FROM products;

-- æ’å…¥æ•°æ®æ—¶å¯ä»¥åŒ…å«æˆ–å¿½ç•¥ä¸å¯è§åˆ—
INSERT INTO products (name, price) VALUES ('å•†å“A', 99.99);
INSERT INTO products (name, price, view_count) VALUES ('å•†å“B', 199.99, 10);
```

### 14.3 å¤šå€¼ç´¢å¼•ï¼ˆMulti-Valued Indexesï¼‰


**ğŸ”¸ JSONæ•°ç»„å­—æ®µç´¢å¼•**
MySQL 8.0.17+æ”¯æŒå¯¹JSONæ•°ç»„åˆ›å»ºå¤šå€¼ç´¢å¼•ï¼Œæé«˜JSONæ•°ç»„æŸ¥è¯¢æ€§èƒ½ã€‚

```sql
-- åˆ›å»ºåŒ…å«JSONæ•°ç»„å­—æ®µçš„è¡¨
CREATE TABLE products (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(200),
    tags JSON,  -- å­˜å‚¨æ ‡ç­¾æ•°ç»„ï¼Œå¦‚: ["electronics", "mobile", "smartphone"]
    attributes JSON  -- å­˜å‚¨å±æ€§å¯¹è±¡
);

-- åœ¨JSONæ•°ç»„ä¸Šåˆ›å»ºå¤šå€¼ç´¢å¼•
CREATE INDEX idx_tags ON products ((CAST(tags->'$[*]' AS CHAR(50) ARRAY)));

-- åœ¨JSONå¯¹è±¡çš„æ•°ç»„å€¼ä¸Šåˆ›å»ºå¤šå€¼ç´¢å¼•  
CREATE INDEX idx_colors ON products ((CAST(attributes->'$.colors[*]' AS CHAR(20) ARRAY)));
```

**ğŸ” å¤šå€¼ç´¢å¼•æŸ¥è¯¢**
```sql
-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO products (name, tags, attributes) VALUES
('iPhone 15', '["electronics", "mobile", "apple", "5g"]', '{"colors": ["black", "white", "blue"], "storage": ["128GB", "256GB"]}'),
('Samsung TV', '["electronics", "tv", "samsung", "4k"]', '{"colors": ["black"], "size": ["55inch", "65inch"]}');

-- åˆ©ç”¨å¤šå€¼ç´¢å¼•æŸ¥è¯¢ï¼ˆJSON_CONTAINSæˆ–JSON_OVERLAPSï¼‰
SELECT * FROM products 
WHERE JSON_CONTAINS(tags, '"mobile"');

SELECT * FROM products 
WHERE JSON_OVERLAPS(tags, '["electronics", "mobile"]');

SELECT * FROM products
WHERE JSON_CONTAINS(attributes->'$.colors', '"black"');
```

### 14.4 å‡½æ•°ç´¢å¼•ï¼ˆFunctional Indexesï¼‰


**ğŸ§® è¡¨è¾¾å¼ç´¢å¼•**
```sql
-- åœ¨å‡½æ•°è¡¨è¾¾å¼ä¸Šåˆ›å»ºç´¢å¼•
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50),
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºå‡½æ•°ç´¢å¼•
CREATE INDEX idx_username_lower ON users ((LOWER(username)));
CREATE INDEX idx_email_domain ON users ((SUBSTRING_INDEX(email, '@', -1)));
CREATE INDEX idx_created_year ON users ((YEAR(created_at)));

-- åˆ©ç”¨å‡½æ•°ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
SELECT * FROM users WHERE LOWER(username) = 'john_doe';
SELECT * FROM users WHERE SUBSTRING_INDEX(email, '@', -1) = 'gmail.com';
SELECT * FROM users WHERE YEAR(created_at) = 2024;
```

### 14.5 è¡¨è¾¾å¼é»˜è®¤å€¼


**ğŸ”§ åŠ¨æ€é»˜è®¤å€¼**
```sql
-- ä½¿ç”¨è¡¨è¾¾å¼ä½œä¸ºé»˜è®¤å€¼
CREATE TABLE user_sessions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    session_id VARCHAR(64) DEFAULT (UUID()),  -- UUIDé»˜è®¤å€¼
    user_id BIGINT NOT NULL,
    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expire_time TIMESTAMP DEFAULT (DATE_ADD(CURRENT_TIMESTAMP, INTERVAL 24 HOUR)),
    session_data JSON DEFAULT (JSON_OBJECT())  -- ç©ºJSONå¯¹è±¡é»˜è®¤å€¼
);

-- åœ¨ALTER TABLEä¸­ä½¿ç”¨è¡¨è¾¾å¼é»˜è®¤å€¼
ALTER TABLE products ADD COLUMN 
    product_code VARCHAR(20) DEFAULT (CONCAT('PRD-', LPAD(id, 6, '0')));
```

### 14.6 æ£€æŸ¥çº¦æŸå¢å¼ºï¼ˆMySQL 8.0+ï¼‰


**âœ… å¤æ‚æ£€æŸ¥çº¦æŸ**
```sql
-- åˆ›å»ºå¸¦å¤æ‚æ£€æŸ¥çº¦æŸçš„è¡¨
CREATE TABLE employees (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT,
    salary DECIMAL(10,2),
    department VARCHAR(50),
    hire_date DATE,
    
    -- åŸºæœ¬æ£€æŸ¥çº¦æŸ
    CONSTRAINT chk_age CHECK (age >= 18 AND age <= 70),
    CONSTRAINT chk_salary CHECK (salary > 0),
    
    -- å¤æ‚æ£€æŸ¥çº¦æŸ
    CONSTRAINT chk_senior_salary CHECK (
        (age < 30 AND salary <= 50000) OR 
        (age >= 30 AND salary >= 30000)
    ),
    
    -- è·¨å­—æ®µæ£€æŸ¥çº¦æŸ
    CONSTRAINT chk_hire_date CHECK (
        hire_date >= '2000-01-01' AND 
        hire_date <= CURDATE()
    )
);

-- æ¡ä»¶æ£€æŸ¥çº¦æŸ
ALTER TABLE orders ADD CONSTRAINT chk_discount 
CHECK (
    (order_type = 'vip' AND discount_rate <= 0.3) OR
    (order_type = 'normal' AND discount_rate <= 0.1) OR
    (order_type = 'wholesale' AND discount_rate <= 0.5)
);
```

---

## 15. âš¡ åœ¨çº¿DDLæ“ä½œ


### 15.1 åœ¨çº¿DDLåŸºç¡€æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯åœ¨çº¿DDL**
åœ¨çº¿DDLå°±æ˜¯åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹ä¿®æ”¹è¡¨ç»“æ„ï¼Œå°±åƒåœ¨å•†åº—è¥ä¸šæœŸé—´è¿›è¡Œè£…ä¿®ï¼Œæ—¢è¦ä¿è¯é¡¾å®¢æ­£å¸¸è´­ç‰©ï¼Œåˆè¦å®Œæˆè£…ä¿®å·¥ä½œã€‚

**âš¡ åœ¨çº¿DDLçš„ä¼˜åŠ¿**
```
ä¸šåŠ¡è¿ç»­æ€§ï¼šæœåŠ¡ä¸ä¸­æ–­ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
é«˜å¯ç”¨æ€§ï¼šé¿å…é•¿æ—¶é—´é”è¡¨
çµæ´»æ€§ï¼šå¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦é€‰æ‹©ä¸åŒç­–ç•¥
å®‰å…¨æ€§ï¼šæ”¯æŒå¤±è´¥å›æ»š
```

### 15.2 DDLç®—æ³•å’Œé”ç­–ç•¥


**ğŸ”§ ALGORITHMé€‰é¡¹**
```sql
-- COPYç®—æ³•ï¼šåˆ›å»ºæ–°è¡¨ï¼Œå¤åˆ¶æ•°æ®ï¼ˆæœ€æ…¢ä½†æœ€å®‰å…¨ï¼‰
ALTER TABLE users 
    ADD COLUMN phone VARCHAR(20),
    ALGORITHM=COPY;

-- INPLACEç®—æ³•ï¼šåŸåœ°ä¿®æ”¹ï¼Œæ— éœ€å¤åˆ¶è¡¨ï¼ˆæ¨èï¼‰
ALTER TABLE users 
    ADD INDEX idx_email (email),
    ALGORITHM=INPLACE;

-- INSTANTç®—æ³•ï¼šç¬é—´å®Œæˆï¼Œä»…ä¿®æ”¹å…ƒæ•°æ®ï¼ˆMySQL 8.0+ï¼‰
ALTER TABLE users 
    ADD COLUMN address VARCHAR(200) DEFAULT NULL,
    ALGORITHM=INSTANT;
```

**ğŸ”’ LOCKé€‰é¡¹**
```sql
-- NONEï¼šå…è®¸å¹¶å‘è¯»å†™ï¼ˆæœ€ä½³æ€§èƒ½ï¼‰
ALTER TABLE users 
    ADD COLUMN age INT,
    ALGORITHM=INPLACE, LOCK=NONE;

-- SHAREDï¼šå…è®¸å¹¶å‘è¯»ï¼Œé˜»å¡å†™æ“ä½œ
ALTER TABLE users 
    MODIFY COLUMN username VARCHAR(100),
    LOCK=SHARED;

-- EXCLUSIVEï¼šé˜»å¡æ‰€æœ‰å¹¶å‘è®¿é—®
ALTER TABLE users 
    DROP COLUMN old_field,
    LOCK=EXCLUSIVE;

-- DEFAULTï¼šè®©MySQLè‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥
ALTER TABLE users 
    ADD INDEX idx_created_at (created_at),
    LOCK=DEFAULT;
```

### 15.3 æ”¯æŒåœ¨çº¿DDLçš„æ“ä½œ


**âœ… æ”¯æŒINPLACEä¸”LOCK=NONEçš„æ“ä½œ**
```sql
-- æ·»åŠ åˆ—ï¼ˆå¸¦é»˜è®¤å€¼éœ€è¦MySQL 8.0+ï¼‰
ALTER TABLE users ADD COLUMN nickname VARCHAR(50);

-- åˆ é™¤åˆ—
ALTER TABLE users DROP COLUMN temp_field;

-- æ·»åŠ ç´¢å¼•
ALTER TABLE users ADD INDEX idx_status (status);

-- åˆ é™¤ç´¢å¼•
ALTER TABLE users DROP INDEX idx_old_field;

-- ä¿®æ”¹åˆ—é»˜è®¤å€¼
ALTER TABLE users ALTER COLUMN status SET DEFAULT 'active';

-- é‡å‘½åè¡¨
ALTER TABLE old_users RENAME TO new_users;
```

**âš ï¸ éœ€è¦COPYç®—æ³•çš„æ“ä½œ**
```sql
-- ä¿®æ”¹åˆ—æ•°æ®ç±»å‹ï¼ˆå¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼‰
ALTER TABLE users MODIFY COLUMN id INT;  -- BIGINT â†’ INT éœ€è¦COPY

-- ä¿®æ”¹å­—ç¬¦é›†
ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4;

-- æ·»åŠ ä¸»é”®ï¼ˆå¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼‰
ALTER TABLE temp_table ADD PRIMARY KEY (id);
```

### 15.4 å¤§è¡¨DDLæœ€ä½³å®è·µ


**ğŸ“Š DDLå‰çš„è¯„ä¼°**
```sql
-- 1. æ£€æŸ¥è¡¨å¤§å°
SELECT 
    table_name,
    ROUND((data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)',
    table_rows
FROM information_schema.tables 
WHERE table_name = 'large_table' AND table_schema = 'mystore';

-- 2. æ£€æŸ¥å½“å‰è´Ÿè½½
SHOW PROCESSLIST;

-- 3. æ£€æŸ¥é”ç­‰å¾…æƒ…å†µ
SELECT * FROM information_schema.INNODB_LOCKS;
SELECT * FROM information_schema.INNODB_LOCK_WAITS;
```

**ğŸ› ï¸ ä½¿ç”¨pt-online-schema-change**
```bash
# å¯¹å¤§è¡¨è¿›è¡Œå®‰å…¨çš„ç»“æ„å˜æ›´
pt-online-schema-change \
    --alter "ADD COLUMN phone VARCHAR(20)" \
    --host=localhost \
    --user=root \
    --password=password \
    --execute \
    --chunk-size=1000 \
    --max-load="Threads_running=25" \
    --critical-load="Threads_running=50" \
    D=mystore,t=users

# å‚æ•°è¯´æ˜ï¼š
# --chunk-size: æ¯æ¬¡å¤„ç†çš„è¡Œæ•°
# --max-load: è¶…è¿‡æ­¤è´Ÿè½½æ—¶æš‚åœ
# --critical-load: è¶…è¿‡æ­¤è´Ÿè½½æ—¶ç»ˆæ­¢
```

**â±ï¸ DDLè¿›åº¦ç›‘æ§**
```sql
-- æŸ¥çœ‹åœ¨çº¿DDLè¿›åº¦ï¼ˆMySQL 5.7+ï¼‰
SELECT 
    EVENT_NAME,
    WORK_COMPLETED,
    WORK_ESTIMATED,
    ROUND(100 * WORK_COMPLETED / WORK_ESTIMATED, 2) AS 'Progress %'
FROM performance_schema.events_stages_current;

-- æŸ¥çœ‹DDLç›¸å…³çš„æ€§èƒ½ç»Ÿè®¡
SELECT * FROM performance_schema.events_stages_summary_global_by_event_name 
WHERE EVENT_NAME LIKE 'stage/innodb/alter%';
```

### 15.5 åœ¨çº¿DDLæ•…éšœå¤„ç†


**ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ**
```sql
-- 1. DDLè¢«é˜»å¡
-- æŸ¥çœ‹é˜»å¡çš„äº‹åŠ¡
SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread,
    b.trx_query blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;

-- 2. DDLç©ºé—´ä¸è¶³
-- æ£€æŸ¥ç£ç›˜ç©ºé—´
SELECT $$datadir;  -- æŸ¥çœ‹æ•°æ®ç›®å½•

-- æ£€æŸ¥ä¸´æ—¶è¡¨ç©ºé—´
SHOW VARIABLES LIKE 'innodb_temp_data_file_path';

-- 3. DDLè¶…æ—¶
-- è°ƒæ•´è¶…æ—¶æ—¶é—´
SET SESSION lock_wait_timeout = 300;  -- 5åˆ†é’Ÿ
SET SESSION innodb_lock_wait_timeout = 120;  -- 2åˆ†é’Ÿ
```

**ğŸ›¡ï¸ DDLå®‰å…¨æªæ–½**
```sql
-- 1. DDLå‰å¤‡ä»½
mysqldump -u root -p mystore users > users_backup.sql

-- 2. åœ¨ä»åº“å…ˆæµ‹è¯•
-- åœ¨MySQLä¸»ä»ç¯å¢ƒä¸­ï¼Œå…ˆåœ¨ä»åº“æµ‹è¯•DDLæ“ä½œ

-- 3. è®¾ç½®DDLè¶…æ—¶
SET SESSION lock_wait_timeout = 60;
ALTER TABLE users ADD COLUMN test_col INT;

-- 4. ä½¿ç”¨äº‹åŠ¡æµ‹è¯•ï¼ˆå¯¹æ”¯æŒäº‹åŠ¡çš„DDLï¼‰
START TRANSACTION;
ALTER TABLE small_test_table ADD COLUMN test VARCHAR(50);
-- æ£€æŸ¥ç»“æœæ— è¯¯åå†æäº¤
COMMIT;
```

---

## 16. ğŸ¯ DDLæ€§èƒ½ä¼˜åŒ–ä¸æ•…éšœå¤„ç†


### 16.1 DDLæ€§èƒ½ä¼˜åŒ–ç­–ç•¥


**âš¡ åˆ›å»ºè¡¨æ€§èƒ½ä¼˜åŒ–**
```sql
-- ä¼˜åŒ–çš„è¡¨åˆ›å»ºæ–¹å¼
CREATE TABLE optimized_users (
    id BIGINT AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- åˆ›å»ºè¡¨æ—¶å°±å®šä¹‰ç´¢å¼•ï¼Œæ¯”åç»­æ·»åŠ æ›´é«˜æ•ˆ
    PRIMARY KEY (id),
    UNIQUE KEY uk_username (username),
    UNIQUE KEY uk_email (email),
    KEY idx_created_at (created_at)
) 
ENGINE=InnoDB 
DEFAULT CHARSET=utf8mb4 
COLLATE=utf8mb4_unicode_ci
-- é¢„ä¼°è¡¨å¤§å°ï¼Œä¼˜åŒ–ç©ºé—´åˆ†é…
AVG_ROW_LENGTH=200
MAX_ROWS=10000000;
```

**ğŸ“Š æ‰¹é‡DDLä¼˜åŒ–**
```sql
-- âŒ ä½æ•ˆçš„å¤šæ¬¡ALTER
ALTER TABLE users ADD COLUMN phone VARCHAR(20);
ALTER TABLE users ADD COLUMN address VARCHAR(200);
ALTER TABLE users ADD INDEX idx_phone (phone);

-- âœ… é«˜æ•ˆçš„å•æ¬¡ALTER
ALTER TABLE users 
    ADD COLUMN phone VARCHAR(20),
    ADD COLUMN address VARCHAR(200),
    ADD INDEX idx_phone (phone);
```

**ğŸš€ å¤§è¡¨ç´¢å¼•åˆ›å»ºä¼˜åŒ–**
```sql
-- è®¾ç½®æ›´å¤§çš„æ’åºç¼“å†²åŒº
SET SESSION sort_buffer_size = 268435456;  -- 256MB
SET SESSION read_buffer_size = 131072;     -- 128KB

-- å¯¹å¤§è¡¨åˆ›å»ºç´¢å¼•æ—¶ï¼Œé€‰æ‹©ä¸šåŠ¡ä½å³°æœŸ
CREATE INDEX idx_large_table_column ON large_table (column_name);

-- æ¢å¤é»˜è®¤è®¾ç½®
SET SESSION sort_buffer_size = DEFAULT;
SET SESSION read_buffer_size = DEFAULT;
```

### 16.2 DDLç›‘æ§å’Œè¯Šæ–­


**ğŸ“ˆ DDLæ€§èƒ½ç›‘æ§**
```sql
-- ç›‘æ§DDLæ‰§è¡Œè¿›åº¦
SELECT 
    EVENT_NAME,
    WORK_COMPLETED,
    WORK_ESTIMATED,
    ROUND(100 * WORK_COMPLETED / WORK_ESTIMATED, 2) as Progress_Percent,
    TIMER_START,
    TIMER_END
FROM performance_schema.events_stages_current 
WHERE EVENT_NAME LIKE 'stage/innodb/alter%';

-- æŸ¥çœ‹DDLå†å²æ‰§è¡Œç»Ÿè®¡
SELECT 
    EVENT_NAME,
    COUNT_STAR,
    SUM_TIMER_WAIT/1000000000 as Total_Time_Sec,
    AVG_TIMER_WAIT/1000000000 as Avg_Time_Sec,
    MIN_TIMER_WAIT/1000000000 as Min_Time_Sec,
    MAX_TIMER_WAIT/1000000000 as Max_Time_Sec
FROM performance_schema.events_stages_summary_global_by_event_name 
WHERE EVENT_NAME LIKE 'stage/innodb/alter%'
ORDER BY SUM_TIMER_WAIT DESC;
```

**ğŸ” DDLé˜»å¡è¯Šæ–­**
```sql
-- æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„DDLæ“ä½œ
SELECT 
    ID,
    USER,
    HOST,
    DB,
    COMMAND,
    TIME,
    STATE,
    INFO
FROM information_schema.PROCESSLIST 
WHERE INFO LIKE 'ALTER%' 
   OR INFO LIKE 'CREATE%' 
   OR INFO LIKE 'DROP%';

-- æŸ¥çœ‹å…ƒæ•°æ®é”ç­‰å¾…
SELECT 
    OBJECT_TYPE,
    OBJECT_SCHEMA,
    OBJECT_NAME,
    LOCK_TYPE,
    LOCK_DURATION,
    LOCK_STATUS
FROM performance_schema.metadata_locks 
WHERE LOCK_STATUS = 'PENDING';
```

### 16.3 å¸¸è§DDLé”™è¯¯å¤„ç†


**ğŸš¨ é”™è¯¯ç±»å‹å’Œè§£å†³æ–¹æ¡ˆ**
```sql
-- 1. è¡¨ä¸å­˜åœ¨é”™è¯¯ï¼ˆError 1146ï¼‰
-- è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨IF EXISTS
CREATE TABLE IF NOT EXISTS users (...);
DROP TABLE IF EXISTS temp_table;
ALTER TABLE users DROP COLUMN IF EXISTS old_column;  -- MySQL 8.0+

-- 2. å­—æ®µå·²å­˜åœ¨é”™è¯¯ï¼ˆError 1060ï¼‰
-- è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥åå†æ·»åŠ 
SELECT COUNT(*) 
FROM information_schema.COLUMNS 
WHERE TABLE_SCHEMA = 'mystore' 
  AND TABLE_NAME = 'users' 
  AND COLUMN_NAME = 'phone';

-- å¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ 
SET @sql = IF((SELECT COUNT(*) FROM information_schema.COLUMNS 
               WHERE TABLE_SCHEMA = 'mystore' 
                 AND TABLE_NAME = 'users' 
                 AND COLUMN_NAME = 'phone') = 0,
              'ALTER TABLE users ADD COLUMN phone VARCHAR(20)',
              'SELECT "Column already exists" as message');
PREPARE stmt FROM @sql;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;
```

**ğŸ”§ å¤–é”®çº¦æŸé”™è¯¯å¤„ç†**
```sql
-- 3. å¤–é”®çº¦æŸé”™è¯¯ï¼ˆError 1215, 1452ï¼‰
-- ä¸´æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥
SET FOREIGN_KEY_CHECKS = 0;

-- æ‰§è¡ŒDDLæ“ä½œ
ALTER TABLE orders ADD COLUMN new_column INT;
DROP TABLE IF EXISTS temp_table;

-- é‡æ–°å¯ç”¨å¤–é”®æ£€æŸ¥
SET FOREIGN_KEY_CHECKS = 1;

-- æ£€æŸ¥å¤–é”®çº¦æŸ
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    CONSTRAINT_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM information_schema.KEY_COLUMN_USAGE 
WHERE REFERENCED_TABLE_SCHEMA = 'mystore';
```

### 16.4 DDLå›æ»šç­–ç•¥


**ğŸ”„ DDLå›æ»šå‡†å¤‡**
```sql
-- 1. DDLå‰è®°å½•è¡¨ç»“æ„
SHOW CREATE TABLE users\G

-- 2. å¤‡ä»½é‡è¦æ•°æ®
CREATE TABLE users_backup AS SELECT * FROM users;

-- 3. å‡†å¤‡å›æ»šè¯­å¥
-- å¦‚æœæ‰§è¡Œï¼šALTER TABLE users ADD COLUMN phone VARCHAR(20);
-- å›æ»šè¯­å¥ï¼šALTER TABLE users DROP COLUMN phone;

-- 4. è®°å½•ç´¢å¼•ä¿¡æ¯
SELECT 
    INDEX_NAME,
    COLUMN_NAME,
    INDEX_TYPE,
    NON_UNIQUE
FROM information_schema.STATISTICS 
WHERE TABLE_SCHEMA = 'mystore' 
  AND TABLE_NAME = 'users'
ORDER BY INDEX_NAME, SEQ_IN_INDEX;
```

**âš ï¸ DDLæ•…éšœæ¢å¤**
```sql
-- 1. å¦‚æœDDLä¸­é€”å¤±è´¥ï¼Œæ£€æŸ¥è¡¨çŠ¶æ€
CHECK TABLE users;

-- 2. ä¿®å¤å¯èƒ½çš„è¡¨æŸå
REPAIR TABLE users;

-- 3. é‡æ–°åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE users;

-- 4. ä¼˜åŒ–è¡¨ï¼ˆæ•´ç†ç¢ç‰‡ï¼‰
OPTIMIZE TABLE users;
```

### 16.5 DDLæœ€ä½³å®è·µæ€»ç»“


**ğŸ“‹ DDLæ‰§è¡Œæ£€æŸ¥æ¸…å•**
```sql
-- âœ… æ‰§è¡Œå‰æ£€æŸ¥
-- 1. ç¡®è®¤æ“ä½œå¯¹è±¡
SHOW TABLES LIKE 'target_table';

-- 2. æ£€æŸ¥è¡¨å¤§å°å’Œè¡Œæ•°
SELECT 
    CONCAT(ROUND((data_length + index_length) / 1024 / 1024, 2), ' MB') AS table_size,
    table_rows
FROM information_schema.tables 
WHERE table_name = 'target_table';

-- 3. æ£€æŸ¥å½“å‰è´Ÿè½½
SHOW PROCESSLIST;

-- 4. æ£€æŸ¥ç£ç›˜ç©ºé—´
SELECT $$datadir;

-- 5. å¤‡ä»½å…³é”®æ•°æ®
-- mysqldump æˆ– CREATE TABLE ... AS SELECT ...

-- âœ… æ‰§è¡Œä¸­ç›‘æ§
-- 1. ç›‘æ§è¿›åº¦
-- 2. å…³æ³¨ç³»ç»Ÿè´Ÿè½½
-- 3. æ£€æŸ¥é”ç­‰å¾…æƒ…å†µ

-- âœ… æ‰§è¡ŒåéªŒè¯
-- 1. æ£€æŸ¥è¡¨ç»“æ„æ˜¯å¦æ­£ç¡®
DESCRIBE target_table;

-- 2. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT COUNT(*) FROM target_table;

-- 3. æ£€æŸ¥ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆ
EXPLAIN SELECT * FROM target_table WHERE indexed_column = 'value';

-- 4. æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE target_table;
```

---

## 17. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 17.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ DDLæœ¬è´¨ï¼šæ•°æ®å®šä¹‰è¯­è¨€ï¼Œç”¨äºåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤æ•°æ®åº“å¯¹è±¡
ğŸ”¸ åŸºç¡€æ“ä½œï¼šæ•°æ®åº“ã€è¡¨ã€ç´¢å¼•ã€çº¦æŸã€è§†å›¾çš„åˆ›å»ºå’Œç®¡ç†
ğŸ”¸ é«˜çº§ç‰¹æ€§ï¼šåˆ†åŒºè¡¨ã€è§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹ã€äº‹ä»¶è°ƒåº¦å™¨
ğŸ”¸ ç°ä»£ç‰¹æ€§ï¼šç”Ÿæˆåˆ—ã€ä¸å¯è§åˆ—ã€å¤šå€¼ç´¢å¼•ã€åœ¨çº¿DDL
ğŸ”¸ æƒé™ç®¡ç†ï¼šç”¨æˆ·åˆ›å»ºã€è§’è‰²åˆ†é…ã€æƒé™æ§åˆ¶
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šåˆç†çš„DDLç­–ç•¥å’Œæ•…éšœå¤„ç†æ–¹æ¡ˆ
```

### 17.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ DDLæ“ä½œçš„å½±å“**
```
è‡ªåŠ¨æäº¤ï¼šDDLè¯­å¥æ— æ³•å›æ»šï¼Œæ‰§è¡Œå‰éœ€è°¨æ…
é”è¡¨å½±å“ï¼šå¯èƒ½å½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œ
æ€§èƒ½å½±å“ï¼šå¤§è¡¨DDLéœ€è¦é€‰æ‹©åˆé€‚æ—¶æœº
æ•°æ®å®Œæ•´æ€§ï¼šç»“æ„å˜æ›´è¦ä¿è¯æ•°æ®ä¸ä¸¢å¤±
```

**ğŸ”¹ ç´¢å¼•è®¾è®¡åŸåˆ™**
```
æŸ¥è¯¢å¯¼å‘ï¼šæ ¹æ®å®é™…æŸ¥è¯¢æ¨¡å¼è®¾è®¡ç´¢å¼•
å¤åˆç´¢å¼•ï¼šéµå¾ªå·¦å‰ç¼€åŸåˆ™ï¼Œåˆç†å®‰æ’å­—æ®µé¡ºåº
é€‚åº¦åŸåˆ™ï¼šç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œè¦å¹³è¡¡æŸ¥è¯¢å’Œå†™å…¥æ€§èƒ½
ç»´æŠ¤æˆæœ¬ï¼šè€ƒè™‘ç´¢å¼•å¯¹INSERT/UPDATE/DELETEçš„å½±å“
```

**ğŸ”¹ çº¦æŸè®¾è®¡æ€è·¯**
```
æ•°æ®å®Œæ•´æ€§ï¼šé€šè¿‡çº¦æŸä¿è¯æ•°æ®è´¨é‡
ä¸šåŠ¡è§„åˆ™ï¼šå°†ä¸šåŠ¡é€»è¾‘è½¬åŒ–ä¸ºæ•°æ®åº“çº¦æŸ
æ€§èƒ½è€ƒè™‘ï¼šçº¦æŸæ£€æŸ¥ä¼šå½±å“å†™å…¥æ€§èƒ½
å¤–é”®ä½¿ç”¨ï¼šåœ¨æ•°æ®ä¸€è‡´æ€§å’Œæ€§èƒ½é—´æ‰¾å¹³è¡¡
```

**ğŸ”¹ åˆ†åŒºè¡¨åº”ç”¨åœºæ™¯**
```
å¤§æ•°æ®é‡ï¼šç™¾ä¸‡çº§ä»¥ä¸Šæ•°æ®è€ƒè™‘åˆ†åŒº
æ—¶é—´ç‰¹å¾ï¼šæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢é¢‘ç¹çš„åœºæ™¯
å†å²æ•°æ®ï¼šéœ€è¦å®šæœŸæ¸…ç†æ—§æ•°æ®
æŸ¥è¯¢æ¨¡å¼ï¼šæŸ¥è¯¢æ¡ä»¶ç»å¸¸åŒ…å«åˆ†åŒºé”®
```

### 17.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ› ï¸ DDLæ“ä½œé€‰æ‹©æŒ‡å—**

| åœºæ™¯ | **æ¨èæ–¹æ¡ˆ** | **æ³¨æ„äº‹é¡¹** |
|------|-------------|-------------|
| å°è¡¨ç»“æ„å˜æ›´ | ç›´æ¥ALTER TABLE | å½±å“æ—¶é—´çŸ­ï¼Œå¯éšæ—¶æ‰§è¡Œ |
| å¤§è¡¨æ·»åŠ ç´¢å¼• | é€‰æ‹©ä½å³°æœŸæ‰§è¡Œ | ç›‘æ§æ‰§è¡Œè¿›åº¦å’Œç³»ç»Ÿè´Ÿè½½ |
| å¤§è¡¨ç»“æ„å˜æ›´ | pt-online-schema-change | ä¸šåŠ¡æ— æ„ŸçŸ¥ï¼Œä½†è€—æ—¶è¾ƒé•¿ |
| ç”Ÿäº§ç¯å¢ƒDDL | å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ | å‡†å¤‡å›æ»šæ–¹æ¡ˆ |
| åˆ†åŒºè¡¨ç»´æŠ¤ | è‡ªåŠ¨åŒ–è„šæœ¬å®šæœŸæ‰§è¡Œ | ç›‘æ§åˆ†åŒºå¤§å°å’ŒæŸ¥è¯¢æ€§èƒ½ |

**ğŸ“‹ DDLæœ€ä½³å®è·µ**

```
è®¾è®¡é˜¶æ®µï¼š
â˜‘ï¸ å……åˆ†ç†è§£ä¸šåŠ¡éœ€æ±‚
â˜‘ï¸ åˆç†é€‰æ‹©æ•°æ®ç±»å‹å’Œçº¦æŸ
â˜‘ï¸ è€ƒè™‘æœªæ¥æ‰©å±•æ€§
â˜‘ï¸ åˆ¶å®šå‘½åè§„èŒƒ

å¼€å‘é˜¶æ®µï¼š
â˜‘ï¸ ç‰ˆæœ¬æ§åˆ¶DDLè„šæœ¬
â˜‘ï¸ ç¼–å†™å›æ»šè„šæœ¬
â˜‘ï¸ åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯
â˜‘ï¸ æ€§èƒ½æµ‹è¯•å’Œå®¹é‡è§„åˆ’

éƒ¨ç½²é˜¶æ®µï¼š
â˜‘ï¸ é€‰æ‹©åˆé€‚çš„æ‰§è¡Œæ—¶æœº
â˜‘ï¸ å¤‡ä»½ç›¸å…³æ•°æ®
â˜‘ï¸ ç›‘æ§æ‰§è¡Œè¿‡ç¨‹
â˜‘ï¸ éªŒè¯æ‰§è¡Œç»“æœ

ç»´æŠ¤é˜¶æ®µï¼š
â˜‘ï¸ å®šæœŸæ£€æŸ¥å¯¹è±¡çŠ¶æ€
â˜‘ï¸ ä¼˜åŒ–è¡¨å’Œç´¢å¼•
â˜‘ï¸ æ¸…ç†æ— ç”¨å¯¹è±¡
â˜‘ï¸ æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
```

**âš ï¸ å¸¸è§é™·é˜±é¿å…**

```
é™·é˜±1ï¼šéšæ„åˆ é™¤å¯¹è±¡
âŒ ç›´æ¥DROP TABLE/DATABASE
âœ… å…ˆç¡®è®¤å½±å“èŒƒå›´ï¼Œåšå¥½å¤‡ä»½

é™·é˜±2ï¼šå¿½è§†æ€§èƒ½å½±å“
âŒ é«˜å³°æœŸæ‰§è¡Œå¤§è¡¨DDL
âœ… é€‰æ‹©ä½å³°æœŸæˆ–ä½¿ç”¨åœ¨çº¿å·¥å…·

é™·é˜±3ï¼šç¼ºå°‘çº¦æŸéªŒè¯
âŒ ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒåŠ çº¦æŸ
âœ… å…ˆéªŒè¯æ•°æ®ï¼Œç¡®ä¿çº¦æŸå¯è¡Œ

é™·é˜±4ï¼šæƒé™è¿‡åº¦æˆæƒ
âŒ GRANT ALL ON *.* TO user
âœ… æœ€å°æƒé™åŸåˆ™ï¼ŒæŒ‰éœ€æˆæƒ

é™·é˜±5ï¼šå¿½è§†å¤–é”®å½±å“
âŒ ä¸è€ƒè™‘çº§è”æ“ä½œåæœ
âœ… ä»”ç»†è®¾è®¡çº§è”ç­–ç•¥
```

### 17.4 å­¦ä¹ è·¯å¾„å»ºè®®


**ğŸ“š å…¥é—¨é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰**
- æŒæ¡åŸºæœ¬çš„DDLè¯­æ³•
- ç†è§£æ•°æ®ç±»å‹å’Œçº¦æŸ
- ç»ƒä¹ åˆ›å»ºè¡¨å’Œç´¢å¼•

**ğŸš€ è¿›é˜¶é˜¶æ®µï¼ˆ3-4å‘¨ï¼‰**
- å­¦ä¹ åˆ†åŒºè¡¨å’Œè§†å›¾
- æŒæ¡å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨
- ç†è§£æƒé™ç®¡ç†æœºåˆ¶

**ğŸ† é«˜çº§é˜¶æ®µï¼ˆæŒç»­ï¼‰**
- æ·±å…¥åœ¨çº¿DDLå’Œæ€§èƒ½ä¼˜åŒ–
- å­¦ä¹ æ•…éšœå¤„ç†å’Œæ¢å¤
- å»ºç«‹DDLè§„èŒƒå’Œæµç¨‹

### 17.5 å·¥å…·æ¨è


**ğŸ”§ å¸¸ç”¨DDLå·¥å…·**

```
MySQL Workbenchï¼š
- å›¾å½¢åŒ–DDLè®¾è®¡å·¥å…·
- æ”¯æŒERå›¾è®¾è®¡
- é€‚åˆæ–°æ‰‹å­¦ä¹ 

pt-online-schema-changeï¼š
- å¤§è¡¨åœ¨çº¿ç»“æ„å˜æ›´
- ç”Ÿäº§ç¯å¢ƒå¿…å¤‡å·¥å…·
- æ”¯æŒè¿›åº¦ç›‘æ§

mysqldumpï¼š
- DDLå¤‡ä»½å’Œè¿ç§»
- ç”Ÿæˆå»ºè¡¨è¯­å¥
- æ•°æ®åº“è¿ç§»é¦–é€‰

MySQL Shellï¼š
- ç°ä»£åŒ–ç®¡ç†å·¥å…·
- æ”¯æŒJavaScript/Python
- é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬
```

**ğŸ“Š ç›‘æ§å’Œç®¡ç†**

```
performance_schemaï¼š
- DDLæ‰§è¡Œç›‘æ§
- æ€§èƒ½ç»Ÿè®¡åˆ†æ
- MySQLå†…ç½®å·¥å…·

information_schemaï¼š
- å…ƒæ•°æ®æŸ¥è¯¢
- å¯¹è±¡ä¿¡æ¯è·å–
- æ ‡å‡†SQLæ¥å£

MySQL Enterprise Monitorï¼š
- ä¼ä¸šçº§ç›‘æ§æ–¹æ¡ˆ
- å®æ—¶æ€§èƒ½ç›‘æ§
- å‘Šè­¦å’ŒæŠ¥è¡¨åŠŸèƒ½
```

### 17.6 è®°å¿†è¦ç‚¹


**ğŸ’¡ æ ¸å¿ƒè®°å¿†å£è¯€**
```
DDLæ“ä½œè¦è°¨æ…ï¼š
ç»“æ„è®¾è®¡æ˜¯åŸºç¡€ï¼Œçº¦æŸç´¢å¼•ä¿æ€§èƒ½
æƒé™ç®¡ç†è¦å®‰å…¨ï¼Œåˆ†åŒºè§†å›¾è§£å¤æ‚
åœ¨çº¿æ“ä½œä¿ä¸šåŠ¡ï¼Œç›‘æ§ä¼˜åŒ–é˜²æ•…éšœ
å¤‡ä»½å›æ»šæ˜¯ä¿é™©ï¼Œè§„èŒƒæµç¨‹ä¿ƒå‘å±•
```

**ğŸ¯ å…³é”®æ£€æŸ¥ç‚¹**
```
æ‰§è¡Œå‰ä¸‰é—®ï¼š
1. æ˜¯å¦å½±å“ä¸šåŠ¡è¿è¡Œï¼Ÿ
2. æ˜¯å¦æœ‰å¤‡ä»½å’Œå›æ»šæ–¹æ¡ˆï¼Ÿ
3. æ˜¯å¦åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œï¼Ÿ

æ‰§è¡Œä¸­ä¸‰çœ‹ï¼š
1. çœ‹æ‰§è¡Œè¿›åº¦å’Œè€—æ—¶
2. çœ‹ç³»ç»Ÿè´Ÿè½½å’Œæ€§èƒ½
3. çœ‹é”ç­‰å¾…å’Œé˜»å¡

æ‰§è¡Œåä¸‰éªŒï¼š
1. éªŒè¯ç»“æ„æ˜¯å¦æ­£ç¡®
2. éªŒè¯æ•°æ®æ˜¯å¦å®Œæ•´
3. éªŒè¯æ€§èƒ½æ˜¯å¦æ­£å¸¸
```

**ğŸ” æ•…éšœæ’æŸ¥æ€è·¯**
```
é—®é¢˜åˆ†æå››æ­¥æ³•ï¼š
1. ç°è±¡æè¿°ï¼šå‘ç”Ÿäº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
2. å½±å“èŒƒå›´ï¼šå½±å“å“ªäº›åŠŸèƒ½å’Œç”¨æˆ·ï¼Ÿ
3. åŸå› åˆ†æï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ
4. è§£å†³æ–¹æ¡ˆï¼šå¦‚ä½•å¿«é€Ÿè§£å†³å¹¶é¢„é˜²ï¼Ÿ

æ—¥å¿—æŸ¥çœ‹é‡ç‚¹ï¼š
- é”™è¯¯æ—¥å¿—ï¼šerror.log
- æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šslow.log
- äºŒè¿›åˆ¶æ—¥å¿—ï¼šbinlog
- æ€§èƒ½ç»Ÿè®¡ï¼šperformance_schema
```

é€šè¿‡ç³»ç»Ÿå­¦ä¹ å’Œå®è·µè¿™äº›DDLçŸ¥è¯†ç‚¹ï¼Œå¯ä»¥ï¼š
- è®¾è®¡åˆç†çš„æ•°æ®åº“ç»“æ„
- é«˜æ•ˆç®¡ç†æ•°æ®åº“å¯¹è±¡
- ä¿è¯ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§
- æå‡æ•°æ®åº“æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§
- å»ºç«‹è§„èŒƒçš„DDLæ“ä½œæµç¨‹

è®°ä½ï¼šDDLæ“ä½œå½±å“æ·±è¿œï¼Œè°¨æ…æ“ä½œã€å……åˆ†å‡†å¤‡ã€æŒç»­å­¦ä¹ æ˜¯å…³é”®ï¼