---
title: 14ã€gh-ostæ—¥å¿—ç®¡ç†
---
## ğŸ“š ç›®å½•

1. [gh-ostæ—¥å¿—ç³»ç»Ÿæ¦‚è¿°](#1-gh-ostæ—¥å¿—ç³»ç»Ÿæ¦‚è¿°)
2. [æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é…ç½®](#2-æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é…ç½®)
3. [æ—¥å¿—æ–‡ä»¶ç®¡ç†ç­–ç•¥](#3-æ—¥å¿—æ–‡ä»¶ç®¡ç†ç­–ç•¥)
4. [æ—¥å¿—æ ¼å¼è§£æè¯¦è§£](#4-æ—¥å¿—æ ¼å¼è§£æè¯¦è§£)
5. [é”™è¯¯æ—¥å¿—åˆ†æå®æˆ˜](#5-é”™è¯¯æ—¥å¿—åˆ†æå®æˆ˜)
6. [è°ƒè¯•æ—¥å¿—å¼€å¯ä¸åº”ç”¨](#6-è°ƒè¯•æ—¥å¿—å¼€å¯ä¸åº”ç”¨)
7. [æ—¥å¿—è½®è½¬ä¸å­˜å‚¨ç®¡ç†](#7-æ—¥å¿—è½®è½¬ä¸å­˜å‚¨ç®¡ç†)
8. [æ—¥å¿—ç›‘æ§å‘Šè­¦ä½“ç³»](#8-æ—¥å¿—ç›‘æ§å‘Šè­¦ä½“ç³»)
9. [æ•…éšœè¯Šæ–­æ—¥å¿—å®è·µ](#9-æ•…éšœè¯Šæ–­æ—¥å¿—å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“‹ gh-ostæ—¥å¿—ç³»ç»Ÿæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯gh-ostæ—¥å¿—ç³»ç»Ÿ


**ç®€å•ç†è§£**ï¼šgh-ostæ—¥å¿—ç³»ç»Ÿå°±åƒæ˜¯æ•°æ®åº“è¿ç§»è¿‡ç¨‹çš„"é»‘åŒ£å­"ï¼Œè®°å½•äº†æ•´ä¸ªè¿ç§»è¿‡ç¨‹ä¸­å‘ç”Ÿçš„æ‰€æœ‰é‡è¦äº‹ä»¶ã€‚

```
æƒ³è±¡åœºæ™¯ï¼š
åŒ»ç”Ÿåšæ‰‹æœ¯æ—¶ä¼šè¯¦ç»†è®°å½•æ‰‹æœ¯è¿‡ç¨‹
gh-ostè¿ç§»æ•°æ®æ—¶ä¹Ÿä¼šè¯¦ç»†è®°å½•è¿ç§»è¿‡ç¨‹

è®°å½•å†…å®¹åŒ…æ‹¬ï¼š
â€¢ è¿ç§»å¼€å§‹å’Œç»“æŸæ—¶é—´
â€¢ æ•°æ®å¤åˆ¶è¿›åº¦
â€¢ é‡åˆ°çš„é”™è¯¯å’Œè­¦å‘Š  
â€¢ æ€§èƒ½æŒ‡æ ‡å˜åŒ–
â€¢ ç”¨æˆ·æ“ä½œå‘½ä»¤
```

### 1.2 æ—¥å¿—ç³»ç»Ÿçš„é‡è¦ä½œç”¨


**ğŸ”¸ ç›‘æ§è¿ç§»è¿›åº¦**
```
å®é™…ä½œç”¨ï¼š
å‘Šè¯‰ä½ ç°åœ¨è¿ç§»åˆ°å“ªä¸€æ­¥äº†
è¿˜éœ€è¦å¤šé•¿æ—¶é—´å®Œæˆ
æœ‰æ²¡æœ‰é‡åˆ°é—®é¢˜

å°±åƒä¸‹è½½æ–‡ä»¶æ—¶çš„è¿›åº¦æ¡
è®©ä½ å¿ƒé‡Œæœ‰æ•°
```

**ğŸ”¸ æ•…éšœæ’æŸ¥å®šä½**
```
å½“è¿ç§»å‡ºç°é—®é¢˜æ—¶ï¼š
â€¢ é€šè¿‡æ—¥å¿—æ‰¾åˆ°å…·ä½“é”™è¯¯ä¿¡æ¯
â€¢ å®šä½æ˜¯å“ªä¸ªç¯èŠ‚å‡ºçš„é—®é¢˜
â€¢ åˆ†ææ˜¯é…ç½®é—®é¢˜è¿˜æ˜¯ç¯å¢ƒé—®é¢˜
â€¢ ä¸ºè§£å†³é—®é¢˜æä¾›çº¿ç´¢
```

**ğŸ”¸ æ€§èƒ½åˆ†æä¼˜åŒ–**
```
é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼š
â€¢ å“ªäº›æ“ä½œè€—æ—¶æœ€é•¿
â€¢ ç½‘ç»œä¼ è¾“æ˜¯å¦æœ‰ç“¶é¢ˆ
â€¢ æ•°æ®åº“è´Ÿè½½æ˜¯å¦è¿‡é«˜
â€¢ ä¸ºæ€§èƒ½è°ƒä¼˜æä¾›æ•°æ®æ”¯æ’‘
```

### 1.3 gh-ostæ—¥å¿—çš„å±‚æ¬¡ç»“æ„


```
æ—¥å¿—å±‚æ¬¡ä»ä½åˆ°é«˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DEBUG     â”‚ â† è°ƒè¯•ä¿¡æ¯ï¼ˆæœ€è¯¦ç»†ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    INFO     â”‚ â† ä¸€èˆ¬ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   WARNING   â”‚ â† è­¦å‘Šä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ERROR     â”‚ â† é”™è¯¯ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   FATAL     â”‚ â† è‡´å‘½é”™è¯¯ï¼ˆæœ€ä¸¥é‡ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº§åˆ«è¶Šé«˜ï¼Œè®°å½•çš„ä¿¡æ¯è¶Šé‡è¦
```

---

## 2. âš™ï¸ æ—¥å¿—çº§åˆ«è®¾ç½®ä¸é…ç½®


### 2.1 æ—¥å¿—çº§åˆ«è¯¦è§£


**ğŸ”¹ DEBUGçº§åˆ« - è°ƒè¯•ä¿¡æ¯**
```bash
# å¼€å¯DEBUGçº§åˆ«æ—¥å¿—
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --verbose \
    --debug \
    --execute

ç”¨é€”è¯´æ˜ï¼š
â€¢ è®°å½•æ¯ä¸€æ­¥çš„è¯¦ç»†æ“ä½œ
â€¢ æ˜¾ç¤ºSQLè¯­å¥æ‰§è¡Œè¿‡ç¨‹
â€¢ é€‚åˆå¼€å‘è°ƒè¯•ä½¿ç”¨
â€¢ æ—¥å¿—é‡å¤§ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨
```

**ğŸ”¹ INFOçº§åˆ« - ä¸€èˆ¬ä¿¡æ¯**
```bash
# INFOæ˜¯é»˜è®¤çº§åˆ«ï¼Œä¸éœ€è¦ç‰¹æ®Šå‚æ•°
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --execute

è®°å½•å†…å®¹ï¼š
â€¢ è¿ç§»å¼€å§‹å’Œç»“æŸ
â€¢ é‡è¦çš„è¿›åº¦èŠ‚ç‚¹
â€¢ é…ç½®ä¿¡æ¯ç¡®è®¤
â€¢ æ­£å¸¸çš„çŠ¶æ€å˜åŒ–
```

**ğŸ”¹ WARNINGçº§åˆ« - è­¦å‘Šä¿¡æ¯**
```
è­¦å‘Šåœºæ™¯ä¸¾ä¾‹ï¼š
â€¢ å‘ç°ç´¢å¼•å¯èƒ½å½±å“æ€§èƒ½
â€¢ æ£€æµ‹åˆ°å¤§è¡¨è¿ç§»é£é™©
â€¢ ç½‘ç»œå»¶è¿Ÿè¾ƒé«˜
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³é¢„è­¦

ç‰¹ç‚¹ï¼šä¸ä¼šä¸­æ–­è¿ç§»ï¼Œä½†éœ€è¦æ³¨æ„
```

**ğŸ”¹ ERRORçº§åˆ« - é”™è¯¯ä¿¡æ¯**
```
é”™è¯¯åœºæ™¯ä¸¾ä¾‹ï¼š
â€¢ è¿æ¥æ•°æ®åº“å¤±è´¥
â€¢ SQLè¯­å¥æ‰§è¡Œå‡ºé”™
â€¢ æƒé™ä¸è¶³
â€¢ è¡¨ç»“æ„ä¸å…¼å®¹

ç‰¹ç‚¹ï¼šé€šå¸¸ä¼šå¯¼è‡´è¿ç§»å¤±è´¥
```

### 2.2 æ—¥å¿—çº§åˆ«é…ç½®æ–¹æ³•


**ğŸ“‹ å‘½ä»¤è¡Œå‚æ•°é…ç½®**
```bash
# 1. è¯¦ç»†æ—¥å¿—æ¨¡å¼
gh-ost --verbose --debug --execute

# 2. é™é»˜æ¨¡å¼ï¼ˆåªæ˜¾ç¤ºERRORå’ŒFATALï¼‰
gh-ost --quiet --execute

# 3. è‡ªå®šä¹‰æ—¥å¿—çº§åˆ«
gh-ost --log-level=info --execute
```

**ğŸ“‹ é…ç½®æ–‡ä»¶è®¾ç½®**
```ini
# gh-ost.conf
[logging]
level = info
verbose = true
debug = false
quiet = false

# ä½¿ç”¨é…ç½®æ–‡ä»¶
gh-ost --conf=gh-ost.conf --execute
```

### 2.3 æ—¥å¿—è¾“å‡ºç›®æ ‡é…ç½®


**ğŸ”¸ æ§åˆ¶å°è¾“å‡º**
```bash
# é»˜è®¤è¾“å‡ºåˆ°æ§åˆ¶å°
gh-ost --host=127.0.0.1 --database=mydb --table=users --execute

ä¼˜ç‚¹ï¼šå®æ—¶æŸ¥çœ‹
ç¼ºç‚¹ï¼šå…³é—­ç»ˆç«¯å°±ä¸¢å¤±äº†
```

**ğŸ”¸ æ–‡ä»¶è¾“å‡º**
```bash
# è¾“å‡ºåˆ°æŒ‡å®šæ—¥å¿—æ–‡ä»¶
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --log-file=/var/log/gh-ost/migration.log \
    --execute

ä¼˜ç‚¹ï¼šæŒä¹…ä¿å­˜ï¼Œæ–¹ä¾¿åç»­åˆ†æ
```

**ğŸ”¸ åŒæ—¶è¾“å‡º**
```bash
# åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --log-file=/var/log/gh-ost/migration.log \
    --verbose \
    --execute 2>&1 | tee /var/log/gh-ost/console.log
```

---

## 3. ğŸ“ æ—¥å¿—æ–‡ä»¶ç®¡ç†ç­–ç•¥


### 3.1 æ—¥å¿—æ–‡ä»¶å‘½åè§„èŒƒ


**ğŸ”¸ æ¨èå‘½åæ ¼å¼**
```bash
# æ ¼å¼ï¼šæ—¥æœŸ-æ—¶é—´-æ•°æ®åº“-è¡¨å.log
/var/log/gh-ost/20250101-143022-mydb-users.log

# æ ¼å¼ï¼šæ•°æ®åº“-è¡¨å-æ—¥æœŸ.log  
/var/log/gh-ost/mydb-users-20250101.log

# æ ¼å¼ï¼šè¿ç§»ç±»å‹-è¡¨å-æ—¶é—´æˆ³.log
/var/log/gh-ost/alter-users-1704096622.log
```

**ğŸ’¡ å‘½åè§„èŒƒçš„å¥½å¤„**
```
ä¾¿äºæŸ¥æ‰¾ï¼š
â€¢ æŒ‰æ—¶é—´æ’åº
â€¢ æŒ‰è¡¨ååˆ†ç»„
â€¢ æŒ‰é¡¹ç›®åˆ†ç±»

ä¾¿äºæ¸…ç†ï¼š
â€¢ è‡ªåŠ¨è¯†åˆ«è¿‡æœŸæ–‡ä»¶
â€¢ æ‰¹é‡åˆ é™¤æ—§æ—¥å¿—
â€¢ èŠ‚çœå­˜å‚¨ç©ºé—´
```

### 3.2 æ—¥å¿—ç›®å½•ç»“æ„è®¾è®¡


**ğŸ—ï¸ ç›®å½•ç»“æ„ç¤ºä¾‹**
```
/var/log/gh-ost/
â”œâ”€â”€ 2025/
â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â”‚   â”œâ”€â”€ mydb-users-143022.log
â”‚   â”‚   â”‚   â”œâ”€â”€ mydb-orders-150330.log
â”‚   â”‚   â”‚   â””â”€â”€ mydb-products-161245.log
â”‚   â”‚   â””â”€â”€ 02/
â”‚   â””â”€â”€ 02/
â”œâ”€â”€ current/          â† å½“å‰æ­£åœ¨è¿›è¡Œçš„è¿ç§»
â”œâ”€â”€ archived/         â† å·²å½’æ¡£çš„é‡è¦æ—¥å¿—
â”œâ”€â”€ error/           â† é”™è¯¯æ—¥å¿—å•ç‹¬å­˜æ”¾
â””â”€â”€ debug/           â† è°ƒè¯•æ—¥å¿—å•ç‹¬å­˜æ”¾
```

### 3.3 æ—¥å¿—æ–‡ä»¶æƒé™ç®¡ç†


**ğŸ”’ æƒé™è®¾ç½®ç¤ºä¾‹**
```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/gh-ost
sudo chown mysql:mysql /var/log/gh-ost
sudo chmod 755 /var/log/gh-ost

# è®¾ç½®æ—¥å¿—æ–‡ä»¶æƒé™
sudo chmod 644 /var/log/gh-ost/*.log

# ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·èƒ½è®¿é—®
sudo chgrp dba /var/log/gh-ost
sudo chmod g+r /var/log/gh-ost/*.log
```

**âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
æƒé™æ§åˆ¶ï¼š
â€¢ æ™®é€šç”¨æˆ·ä¸åº”è¯¥æœ‰å†™æƒé™
â€¢ æ•æ„Ÿä¿¡æ¯ä¸è¦è®°å½•åˆ°æ—¥å¿—
â€¢ å®šæœŸå®¡æŸ¥æ—¥å¿—è®¿é—®æƒé™

æ•°æ®ä¿æŠ¤ï¼š
â€¢ ä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•å¯†ç 
â€¢ æ•æ„ŸæŸ¥è¯¢è¯­å¥è¦è„±æ•
â€¢ ä¸ªäººä¿¡æ¯è¦é®è”½å¤„ç†
```

---

## 4. ğŸ“Š æ—¥å¿—æ ¼å¼è§£æè¯¦è§£


### 4.1 gh-ostæ—¥å¿—æ ¼å¼ç»“æ„


**ğŸ”¸ æ ‡å‡†æ—¥å¿—æ ¼å¼**
```
[æ—¶é—´æˆ³] [çº§åˆ«] [ç»„ä»¶] æ¶ˆæ¯å†…å®¹

ç¤ºä¾‹ï¼š
2025-01-01T14:30:22.123Z [INFO] [migrator] Starting migration
2025-01-01T14:30:23.456Z [DEBUG] [applier] Applying binlog event
2025-01-01T14:30:24.789Z [ERROR] [streamer] Connection lost to MySQL
```

### 4.2 å„ç»„ä»¶æ—¥å¿—åˆ†æ


**ğŸ”¸ Migratorç»„ä»¶æ—¥å¿—**
```
[INFO] [migrator] Migration started for mydb.users
å«ä¹‰ï¼šè¿ç§»å™¨ç»„ä»¶å¼€å§‹å¤„ç†usersè¡¨çš„è¿ç§»

[INFO] [migrator] Migration completed successfully  
å«ä¹‰ï¼šè¿ç§»æˆåŠŸå®Œæˆ

[ERROR] [migrator] Migration failed: table not found
å«ä¹‰ï¼šè¿ç§»å¤±è´¥ï¼Œæ‰¾ä¸åˆ°ç›®æ ‡è¡¨
```

**ğŸ”¸ Applierç»„ä»¶æ—¥å¿—**
```
[DEBUG] [applier] Applying DML event: INSERT INTO _users_gho
å«ä¹‰ï¼šåº”ç”¨å™¨æ­£åœ¨æ‰§è¡ŒINSERTæ“ä½œåˆ°å½±å­è¡¨

[INFO] [applier] Applied 1000 events, rate: 500/sec
å«ä¹‰ï¼šå·²åº”ç”¨1000ä¸ªäº‹ä»¶ï¼Œå¤„ç†é€Ÿåº¦æ¯ç§’500ä¸ª

[WARNING] [applier] Lag detected: 2.5 seconds behind master
å«ä¹‰ï¼šæ£€æµ‹åˆ°å»¶è¿Ÿï¼Œæ¯”ä¸»åº“æ…¢2.5ç§’
```

**ğŸ”¸ Inspectorç»„ä»¶æ—¥å¿—**
```
[INFO] [inspector] Analyzing table structure for mydb.users
å«ä¹‰ï¼šæ£€æŸ¥å™¨æ­£åœ¨åˆ†æè¡¨ç»“æ„

[INFO] [inspector] Found PRIMARY KEY on (id)
å«ä¹‰ï¼šå‘ç°ä¸»é”®æ˜¯idå­—æ®µ

[WARNING] [inspector] No UNIQUE KEY found, using PRIMARY KEY
å«ä¹‰ï¼šæ²¡æ‰¾åˆ°å”¯ä¸€é”®ï¼Œä½¿ç”¨ä¸»é”®æ›¿ä»£
```

### 4.3 è¿›åº¦ä¿¡æ¯è§£è¯»


**ğŸ“ˆ è¿›åº¦æ—¥å¿—æ ¼å¼**
```
[INFO] [migrator] Progress: 25.5% (1020000/4000000 rows copied)
è§£è¯»ï¼š
â€¢ å½“å‰è¿›åº¦ï¼š25.5%
â€¢ å·²å¤åˆ¶ï¼š1,020,000è¡Œ
â€¢ æ€»è¡Œæ•°ï¼š4,000,000è¡Œ
â€¢ å‰©ä½™ï¼š2,980,000è¡Œ

[INFO] [migrator] ETA: 2025-01-01 16:45:30 (2h15m remaining)
è§£è¯»ï¼š
â€¢ ETAï¼šé¢„è®¡å®Œæˆæ—¶é—´
â€¢ remainingï¼šå‰©ä½™æ—¶é—´
```

**ğŸ“Š æ€§èƒ½æŒ‡æ ‡æ—¥å¿—**
```
[INFO] [throttler] Current rate: 1250 rows/sec, throttle: false
è§£è¯»ï¼š
â€¢ å½“å‰å¤„ç†é€Ÿåº¦ï¼š1250è¡Œ/ç§’
â€¢ æ˜¯å¦å¼€å¯é™æµï¼šå¦

[INFO] [throttler] Load average: 0.65, Max connections: 150/1000  
è§£è¯»ï¼š
â€¢ ç³»ç»Ÿè´Ÿè½½ï¼š0.65
â€¢ è¿æ¥æ•°ï¼š150ä¸ªï¼ˆæœ€å¤§1000ä¸ªï¼‰
```

---

## 5. ğŸ” é”™è¯¯æ—¥å¿—åˆ†æå®æˆ˜


### 5.1 å¸¸è§é”™è¯¯ç±»å‹åˆ†æ


**ğŸ”¸ è¿æ¥ç›¸å…³é”™è¯¯**
```
[ERROR] [inspector] Error connecting to MySQL: Access denied for user 'ghost'@'localhost'

é—®é¢˜åˆ†æï¼š
â€¢ ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
â€¢ ç”¨æˆ·æƒé™ä¸è¶³
â€¢ ä¸»æœºåœ°å€ä¸åŒ¹é…

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
3. æ£€æŸ¥MySQLç”¨æˆ·hostè®¾ç½®
```

**ğŸ”¸ è¡¨ç»“æ„ç›¸å…³é”™è¯¯**
```
[ERROR] [inspector] Table mydb.users has no PRIMARY or UNIQUE key

é—®é¢˜åˆ†æï¼š
â€¢ è¡¨æ²¡æœ‰ä¸»é”®æˆ–å”¯ä¸€é”®
â€¢ gh-ostéœ€è¦ä¸»é”®æ¥å®šä½è¡Œ

è§£å†³æ–¹æ¡ˆï¼š
1. ä¸ºè¡¨æ·»åŠ ä¸»é”®
2. æ·»åŠ å”¯ä¸€é”®
3. ä½¿ç”¨--allow-on-masterå‚æ•°ï¼ˆè°¨æ…ï¼‰
```

**ğŸ”¸ æƒé™ç›¸å…³é”™è¯¯**
```
[ERROR] [applier] Access denied; you need (at least one of) the SUPER privilege(s)

é—®é¢˜åˆ†æï¼š
â€¢ ç¼ºå°‘SUPERæƒé™
â€¢ æŸäº›æ“ä½œéœ€è¦ç®¡ç†å‘˜æƒé™

è§£å†³æ–¹æ¡ˆï¼š
1. ä¸ºç”¨æˆ·æˆäºˆSUPERæƒé™
2. ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·è¿è¡Œ
3. æ£€æŸ¥å…·ä½“ç¼ºå°‘å“ªäº›æƒé™
```

### 5.2 é”™è¯¯æ—¥å¿—æ’æŸ¥æ­¥éª¤


**ğŸ” ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•**
```
ç¬¬ä¸€æ­¥ï¼šå®šä½é”™è¯¯ä½ç½®
grep -n "ERROR\|FATAL" /var/log/gh-ost/migration.log

ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹é”™è¯¯ä¸Šä¸‹æ–‡  
sed -n '100,120p' /var/log/gh-ost/migration.log

ç¬¬ä¸‰æ­¥ï¼šåˆ†æé”™è¯¯åŸå› 
â€¢ æ£€æŸ¥é”™è¯¯æ¶ˆæ¯å…³é”®è¯
â€¢ æŸ¥çœ‹ç›¸å…³ç»„ä»¶æ—¥å¿—
â€¢ å¯¹æ¯”æ­£å¸¸æ—¥å¿—æ¨¡å¼

ç¬¬å››æ­¥ï¼šæŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ
â€¢ æŸ¥é˜…å®˜æ–¹æ–‡æ¡£
â€¢ æœç´¢ç±»ä¼¼é—®é¢˜
â€¢ éªŒè¯ä¿®å¤æ–¹æ¡ˆ
```

### 5.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ


**ğŸ’¡ é¢„é˜²æ€§æªæ–½**
```bash
# 1. è¿ç§»å‰æ£€æŸ¥
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --dry-run \
    --verbose

# 2. æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯  
gh-ost \
    --host=test-server \
    --database=test_mydb \
    --table=users \
    --execute

# 3. è®¾ç½®åˆç†çš„è¶…æ—¶
gh-ost \
    --connect-timeout=10s \
    --mysql-timeout=30s \
    --execute
```

---

## 6. ğŸ› è°ƒè¯•æ—¥å¿—å¼€å¯ä¸åº”ç”¨


### 6.1 è°ƒè¯•æ¨¡å¼å¯ç”¨æ–¹æ³•


**ğŸ”¸ åŸºç¡€è°ƒè¯•æ¨¡å¼**
```bash
# å¯ç”¨è¯¦ç»†è°ƒè¯•ä¿¡æ¯
gh-ost \
    --host=127.0.0.1 \
    --database=mydb \
    --table=users \
    --debug \
    --verbose \
    --execute

è°ƒè¯•ä¿¡æ¯åŒ…æ‹¬ï¼š
â€¢ SQLè¯­å¥æ‰§è¡Œè¯¦æƒ…
â€¢ ç½‘ç»œé€šä¿¡è¿‡ç¨‹
â€¢ å†…éƒ¨çŠ¶æ€å˜åŒ–
â€¢ æ€§èƒ½è®¡æ•°å™¨
```

**ğŸ”¸ é«˜çº§è°ƒè¯•é€‰é¡¹**
```bash
# è¶…è¯¦ç»†è°ƒè¯•æ¨¡å¼
gh-ost \
    --debug \
    --verbose \
    --log-queries \
    --log-binlog-events \
    --execute

é¢å¤–ä¿¡æ¯ï¼š
â€¢ è®°å½•æ‰€æœ‰æ‰§è¡Œçš„æŸ¥è¯¢
â€¢ è®°å½•binlogäº‹ä»¶è¯¦æƒ…
â€¢ æ˜¾ç¤ºå†…éƒ¨ç®—æ³•é€»è¾‘
```

### 6.2 è°ƒè¯•ä¿¡æ¯åˆ†ç±»è§£è¯»


**ğŸ”¸ SQLæ‰§è¡Œè°ƒè¯•**
```
[DEBUG] [applier] Executing: SELECT COUNT(*) FROM mydb.users WHERE id > 1000
[DEBUG] [applier] Query result: 450000 rows

ç”¨é€”ï¼š
â€¢ éªŒè¯æŸ¥è¯¢é€»è¾‘æ˜¯å¦æ­£ç¡®
â€¢ æ£€æŸ¥æ€§èƒ½æ˜¯å¦åˆç†
â€¢ æ’æŸ¥æ•°æ®ä¸ä¸€è‡´é—®é¢˜
```

**ğŸ”¸ Binlogäº‹ä»¶è°ƒè¯•**
```
[DEBUG] [streamer] Binlog event: WriteRowsEvent
[DEBUG] [streamer] Affected table: mydb.users
[DEBUG] [streamer] Row data: {id: 12345, name: "John", email: "john@example.com"}

ç”¨é€”ï¼š
â€¢ éªŒè¯æ•°æ®å˜æ›´æ•è·
â€¢ æ£€æŸ¥æ•°æ®æ ¼å¼è½¬æ¢
â€¢ æ’æŸ¥æ•°æ®ä¸¢å¤±é—®é¢˜
```

**ğŸ”¸ çŠ¶æ€å˜åŒ–è°ƒè¯•**
```
[DEBUG] [migrator] State transition: copying-rows -> catching-up
[DEBUG] [throttler] Throttle status changed: enabled -> disabled
[DEBUG] [inspector] Heartbeat lag: 0.15 seconds

ç”¨é€”ï¼š
â€¢ äº†è§£è¿ç§»æµç¨‹è¿›å±•
â€¢ ç›‘æ§å†…éƒ¨çŠ¶æ€æœº
â€¢ åˆ†ææ€§èƒ½ç“¶é¢ˆ
```

### 6.3 è°ƒè¯•æ—¥å¿—åˆ†ææŠ€å·§


**ğŸ” æ—¥å¿—è¿‡æ»¤æŠ€å·§**
```bash
# 1. æŒ‰ç»„ä»¶è¿‡æ»¤
grep "\[applier\]" debug.log

# 2. æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤  
sed -n '/2025-01-01T14:30:00/,/2025-01-01T14:35:00/p' debug.log

# 3. æŒ‰å…³é”®å­—è¿‡æ»¤
grep -E "(ERROR|WARNING|timeout|failed)" debug.log

# 4. ç»Ÿè®¡é”™è¯¯é¢‘ç‡
grep -c "ERROR" debug.log
```

**ğŸ“Š æ€§èƒ½åˆ†ææ–¹æ³•**
```bash
# æŸ¥çœ‹å¤„ç†é€Ÿåº¦è¶‹åŠ¿
grep "rows/sec" debug.log | tail -20

# åˆ†æå»¶è¿Ÿåˆ†å¸ƒ
grep "lag:" debug.log | awk '{print $NF}' | sort -n

# æ‰¾å‡ºæœ€æ…¢çš„æ“ä½œ
grep "Executing:" debug.log | grep -v "0.0[0-9]s"
```

---

## 7. ğŸ”„ æ—¥å¿—è½®è½¬ä¸å­˜å‚¨ç®¡ç†


### 7.1 æ—¥å¿—è½®è½¬é…ç½®


**ğŸ”¸ ä½¿ç”¨logrotateç®¡ç†**
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶ /etc/logrotate.d/gh-ost
/var/log/gh-ost/*.log {
    daily                    # æŒ‰å¤©è½®è½¬
    missingok               # æ–‡ä»¶ä¸å­˜åœ¨ä¸æŠ¥é”™
    rotate 30               # ä¿ç•™30ä¸ªå½’æ¡£æ–‡ä»¶
    compress                # å‹ç¼©å½’æ¡£æ–‡ä»¶
    notifempty             # ç©ºæ–‡ä»¶ä¸è½®è½¬
    create 644 mysql mysql  # åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™
    
    postrotate
        # è½®è½¬åæ‰§è¡Œçš„å‘½ä»¤
        /bin/kill -HUP `cat /var/run/gh-ost.pid 2> /dev/null` 2> /dev/null || true
    endscript
}

# æ‰‹åŠ¨æµ‹è¯•è½®è½¬
sudo logrotate -d /etc/logrotate.d/gh-ost
sudo logrotate -f /etc/logrotate.d/gh-ost
```

**ğŸ”¸ è‡ªå®šä¹‰è½®è½¬è„šæœ¬**
```bash
#!/bin/bash
# gh-ost-rotate.sh

LOG_DIR="/var/log/gh-ost"
KEEP_DAYS=30

# æŒ‰å¤§å°è½®è½¬
rotate_by_size() {
    local file=$1
    local max_size="100M"
    
    if [[ $(du -m "$file" | cut -f1) -gt 100 ]]; then
        mv "$file" "${file}.$(date +%Y%m%d-%H%M%S)"
        touch "$file"
        chown mysql:mysql "$file"
    fi
}

# æ¸…ç†è¿‡æœŸæ–‡ä»¶
cleanup_old_logs() {
    find "$LOG_DIR" -name "*.log.*" -mtime +$KEEP_DAYS -delete
}

# æ‰§è¡Œè½®è½¬
for log_file in "$LOG_DIR"/*.log; do
    [[ -f "$log_file" ]] && rotate_by_size "$log_file"
done

cleanup_old_logs
```

### 7.2 å­˜å‚¨ä¼˜åŒ–ç­–ç•¥


**ğŸ”¸ æ—¥å¿—åˆ†çº§å­˜å‚¨**
```
å­˜å‚¨ç­–ç•¥åˆ†çº§ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®æ—¶æ—¥å¿—      â”‚ â† SSDå­˜å‚¨ï¼Œå¿«é€Ÿå†™å…¥
â”‚   (å½“å¤©)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¿‘æœŸæ—¥å¿—      â”‚ â† SASå­˜å‚¨ï¼Œå¹³è¡¡æ€§èƒ½
â”‚   (7å¤©å†…)       â”‚  
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å†å²æ—¥å¿—      â”‚ â† SATAå­˜å‚¨ï¼Œå¤§å®¹é‡
â”‚   (30å¤©å†…)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å½’æ¡£æ—¥å¿—      â”‚ â† å¯¹è±¡å­˜å‚¨ï¼Œé•¿æœŸä¿å­˜
â”‚   (1å¹´ä»¥ä¸Š)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”¸ å‹ç¼©å­˜å‚¨é…ç½®**
```bash
# å®æ—¶å‹ç¼©è„šæœ¬
compress_logs() {
    local log_file=$1
    
    # å¦‚æœæ–‡ä»¶å¤§äº50MBï¼Œè¿›è¡Œå‹ç¼©
    if [[ $(stat -f%z "$log_file" 2>/dev/null || stat -c%s "$log_file") -gt 52428800 ]]; then
        gzip "$log_file"
        echo "Compressed: $log_file -> $log_file.gz"
    fi
}

# å®šæ—¶ä»»åŠ¡
# crontab -e
# 0 2 * * * /usr/local/bin/compress_logs.sh
```

### 7.3 å­˜å‚¨ç©ºé—´ç›‘æ§


**ğŸ“Š ç©ºé—´ä½¿ç”¨ç›‘æ§**
```bash
#!/bin/bash
# monitor-log-space.sh

LOG_DIR="/var/log/gh-ost"
THRESHOLD=80  # ä½¿ç”¨ç‡é˜ˆå€¼

# æ£€æŸ¥ç£ç›˜ä½¿ç”¨ç‡
check_disk_usage() {
    local usage=$(df "$LOG_DIR" | awk 'NR==2 {gsub(/%/, ""); print $5}')
    
    if [[ $usage -gt $THRESHOLD ]]; then
        echo "WARNING: Log directory usage at ${usage}%" >&2
        
        # å‘é€å‘Šè­¦é‚®ä»¶
        echo "Disk usage for $LOG_DIR is at ${usage}%" | \
        mail -s "gh-ost Log Directory Alert" admin@company.com
        
        # æ¸…ç†æœ€è€çš„æ–‡ä»¶
        cleanup_oldest_files
    fi
}

# æ¸…ç†æœ€è€çš„æ–‡ä»¶
cleanup_oldest_files() {
    # åˆ é™¤7å¤©å‰çš„debugæ—¥å¿—
    find "$LOG_DIR" -name "*debug*.log" -mtime +7 -delete
    
    # åˆ é™¤30å¤©å‰çš„æ™®é€šæ—¥å¿—
    find "$LOG_DIR" -name "*.log.gz" -mtime +30 -delete
}

check_disk_usage
```

---

## 8. ğŸš¨ æ—¥å¿—ç›‘æ§å‘Šè­¦ä½“ç³»


### 8.1 å…³é”®æŒ‡æ ‡ç›‘æ§


**ğŸ”¸ é”™è¯¯ç‡ç›‘æ§**
```bash
#!/bin/bash
# error-monitor.sh

LOG_FILE="/var/log/gh-ost/current.log"
TIME_WINDOW=300  # 5åˆ†é’Ÿçª—å£
ERROR_THRESHOLD=10

# ç»Ÿè®¡æœ€è¿‘5åˆ†é’Ÿçš„é”™è¯¯æ•°
count_recent_errors() {
    local since_time=$(date -d "5 minutes ago" "+%Y-%m-%dT%H:%M:%S")
    
    grep -c "\[ERROR\]" <(
        awk -v since="$since_time" '
        $1 " " $2 >= since {print}
        ' "$LOG_FILE"
    )
}

# æ£€æŸ¥é”™è¯¯ç‡
error_count=$(count_recent_errors)
if [[ $error_count -gt $ERROR_THRESHOLD ]]; then
    echo "ALERT: $error_count errors in last 5 minutes" >&2
    
    # å‘é€é’‰é’‰å‘Šè­¦
    curl -X POST "https://oapi.dingtalk.com/robot/send?access_token=xxx" \
    -H 'Content-Type: application/json' \
    -d "{
        \"msgtype\": \"text\",
        \"text\": {
            \"content\": \"gh-osté”™è¯¯å‘Šè­¦: æœ€è¿‘5åˆ†é’Ÿå‡ºç°${error_count}ä¸ªé”™è¯¯\"
        }
    }"
fi
```

**ğŸ”¸ æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```bash
# performance-monitor.sh

extract_performance_metrics() {
    local log_file=$1
    
    # æå–æœ€æ–°çš„æ€§èƒ½æŒ‡æ ‡
    tail -100 "$log_file" | grep -E "(rows/sec|lag:|ETA:)" | \
    while read line; do
        case "$line" in
            *"rows/sec"*)
                rate=$(echo "$line" | grep -o '[0-9]\+ rows/sec' | grep -o '[0-9]\+')
                echo "gh_ost_rate_rows_per_sec $rate"
                ;;
            *"lag:"*)
                lag=$(echo "$line" | grep -o 'lag: [0-9.]\+' | grep -o '[0-9.]\+')
                echo "gh_ost_lag_seconds $lag"
                ;;
            *"ETA:"*)
                # è®¡ç®—å‰©ä½™æ—¶é—´ï¼ˆç§’ï¼‰
                remaining=$(echo "$line" | grep -o '([^)]*remaining)' | \
                           sed 's/[()remaining]//g' | \
                           awk -F'[hm]' '{print $1*3600 + $2*60}')
                echo "gh_ost_eta_seconds $remaining"
                ;;
        esac
    done
}
```

### 8.2 å‘Šè­¦è§„åˆ™é…ç½®


**ğŸ”¸ åŸºäºé˜ˆå€¼çš„å‘Šè­¦**
```yaml
# prometheuså‘Šè­¦è§„åˆ™ gh-ost.yml
groups:
  - name: gh-ost-alerts
    rules:
      - alert: GhostMigrationSlow
        expr: gh_ost_rate_rows_per_sec < 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "gh-ost migration is running slowly"
          description: "Migration rate is {{ $value }} rows/sec, below threshold"

      - alert: GhostMigrationLag  
        expr: gh_ost_lag_seconds > 10
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "gh-ost replication lag is high"
          description: "Lag is {{ $value }} seconds behind master"

      - alert: GhostMigrationErrors
        expr: increase(gh_ost_errors_total[5m]) > 5
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "gh-ost migration has errors"
          description: "{{ $value }} errors in the last 5 minutes"
```

**ğŸ”¸ è‡ªå®šä¹‰å‘Šè­¦è„šæœ¬**
```bash
#!/bin/bash
# alert-manager.sh

# é…ç½®å‚æ•°
WEBHOOK_URL="https://hooks.slack.com/services/xxx"
LOG_FILE="/var/log/gh-ost/current.log"

# å‘é€Slackå‘Šè­¦
send_slack_alert() {
    local message=$1
    local color=$2
    
    curl -X POST -H 'Content-type: application/json' \
    --data "{
        \"attachments\": [{
            \"color\": \"$color\",
            \"text\": \"$message\",
            \"ts\": $(date +%s)
        }]
    }" "$WEBHOOK_URL"
}

# æ£€æŸ¥è‡´å‘½é”™è¯¯
check_fatal_errors() {
    local fatal_count=$(grep -c "\[FATAL\]" "$LOG_FILE")
    
    if [[ $fatal_count -gt 0 ]]; then
        local last_fatal=$(grep "\[FATAL\]" "$LOG_FILE" | tail -1)
        send_slack_alert "ğŸš¨ gh-ost FATAL ERROR: $last_fatal" "danger"
    fi
}

# æ£€æŸ¥è¿ç§»å®Œæˆ
check_migration_completion() {
    if grep -q "Migration completed successfully" "$LOG_FILE"; then
        send_slack_alert "âœ… gh-ost Migration completed successfully!" "good"
    fi
}

# æ‰§è¡Œæ£€æŸ¥
check_fatal_errors
check_migration_completion
```

### 8.3 å‘Šè­¦å“åº”æµç¨‹


**ğŸ“‹ å‘Šè­¦å¤„ç†æ ‡å‡†æµç¨‹**
```
å‘Šè­¦å“åº”æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¥æ”¶å‘Šè­¦      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘ ç¡®è®¤å‘Šè­¦çº§åˆ«  â”‚ â† WARNING/CRITICAL/FATAL
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚   â‘¡æŸ¥çœ‹æ—¥å¿—è¯¦æƒ…  â”‚ â† å®šä½å…·ä½“é—®é¢˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘¢è¯„ä¼°å½±å“èŒƒå›´  â”‚ â† æ˜¯å¦å½±å“ä¸šåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘£åˆ¶å®šå¤„ç†æ–¹æ¡ˆ  â”‚ â† ä¿®å¤/æš‚åœ/å›æ»š
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘¤æ‰§è¡Œå¤„ç†æ–¹æ¡ˆ  â”‚ â† å®æ–½è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘¥éªŒè¯å¤„ç†ç»“æœ  â”‚ â† ç¡®è®¤é—®é¢˜è§£å†³
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â‘¦è®°å½•å¤„ç†è¿‡ç¨‹  â”‚ â† æ›´æ–°å¤„ç†æ–‡æ¡£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ğŸ› ï¸ æ•…éšœè¯Šæ–­æ—¥å¿—å®è·µ


### 9.1 å…¸å‹æ•…éšœè¯Šæ–­æ¡ˆä¾‹


**ğŸ”¸ æ¡ˆä¾‹ä¸€ï¼šè¿ç§»ä¸­æ–­é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
[ERROR] [applier] Lost connection to MySQL server during query

è¯Šæ–­æ­¥éª¤ï¼š
1. æŸ¥çœ‹å®Œæ•´é”™è¯¯ä¿¡æ¯
grep -A5 -B5 "Lost connection" /var/log/gh-ost/migration.log

2. æ£€æŸ¥MySQLè¿æ¥çŠ¶æ€
SHOW PROCESSLIST;
SHOW STATUS LIKE 'Connections';

3. æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
top -p $(pgrep gh-ost)
iostat -x 1

4. åˆ†æç½‘ç»œè¿æ¥
netstat -an | grep :3306
tcpdump -i eth0 port 3306

è§£å†³æ–¹æ¡ˆï¼š
â€¢ å¢åŠ è¿æ¥è¶…æ—¶æ—¶é—´ï¼š--mysql-timeout=60s
â€¢ å¯ç”¨è¿æ¥é‡è¯•ï¼š--max-retries=5
â€¢ æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
â€¢ ä¼˜åŒ–MySQLé…ç½®
```

**ğŸ”¸ æ¡ˆä¾‹äºŒï¼šæ€§èƒ½ä¸‹é™é—®é¢˜**
```
é—®é¢˜ç°è±¡ï¼š
[INFO] [migrator] Current rate: 50 rows/sec (was 500 rows/sec)

è¯Šæ–­æ­¥éª¤ï¼š
1. åˆ†ææ€§èƒ½è¶‹åŠ¿
grep "rows/sec" migration.log | tail -50

2. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
grep "Load average" migration.log
vmstat 1

3. åˆ†æSQLæ‰§è¡Œæƒ…å†µ
grep "Executing:" debug.log | grep -v "0.0[0-9]s"

4. æ£€æŸ¥é”ç­‰å¾…æƒ…å†µ
SHOW ENGINE INNODB STATUS;

è§£å†³æ–¹æ¡ˆï¼š
â€¢ è°ƒæ•´chunk-sizeï¼š--chunk-size=500
â€¢ å¯ç”¨é™æµï¼š--max-load=Threads_running=20
â€¢ ä¼˜åŒ–ç´¢å¼•ï¼šç¡®ä¿è¿ç§»é”®ä¸Šæœ‰ç´¢å¼•
â€¢ é”™å³°æ‰§è¡Œï¼šé¿å¼€ä¸šåŠ¡é«˜å³°æœŸ
```

### 9.2 æ—¥å¿—åˆ†æå·¥å…·ä½¿ç”¨


**ğŸ” è‡ªå®šä¹‰åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# gh-ost-analyzer.sh

LOG_FILE=$1

analyze_migration() {
    echo "=== gh-ost Migration Analysis ==="
    echo
    
    # åŸºæœ¬ä¿¡æ¯
    echo "Migration Info:"
    grep -E "(Migration started|Migration completed)" "$LOG_FILE"
    echo
    
    # æ€§èƒ½ç»Ÿè®¡
    echo "Performance Summary:"
    echo "Average rate: $(grep "rows/sec" "$LOG_FILE" | \
                      awk '{print $NF}' | sed 's/[^0-9]//g' | \
                      awk '{sum+=$1; count++} END {print sum/count}') rows/sec"
    
    echo "Peak rate: $(grep "rows/sec" "$LOG_FILE" | \
                     awk '{print $NF}' | sed 's/[^0-9]//g' | sort -n | tail -1) rows/sec"
    echo
    
    # é”™è¯¯ç»Ÿè®¡
    echo "Error Summary:"
    echo "Total errors: $(grep -c "ERROR" "$LOG_FILE")"
    echo "Total warnings: $(grep -c "WARNING" "$LOG_FILE")"
    echo
    
    # æœ€é¢‘ç¹çš„é”™è¯¯
    echo "Most common errors:"
    grep "ERROR" "$LOG_FILE" | awk -F']' '{print $NF}' | \
    sort | uniq -c | sort -nr | head -5
    echo
    
    # æ—¶é—´çº¿åˆ†æ
    echo "Timeline Analysis:"
    awk '/Migration started/ {start=$1" "$2} 
         /Migration completed/ {end=$1" "$2} 
         END {print "Duration: from " start " to " end}' "$LOG_FILE"
}

analyze_migration
```

**ğŸ“Š å¯è§†åŒ–åˆ†æå·¥å…·**
```python
#!/usr/bin/env python3
# gh-ost-visualizer.py

import re
import matplotlib.pyplot as plt
from datetime import datetime
import sys

def parse_log_file(log_file):
    """è§£ægh-ostæ—¥å¿—æ–‡ä»¶"""
    times = []
    rates = []
    
    with open(log_file, 'r') as f:
        for line in f:
            # æå–æ—¶é—´æˆ³å’Œå¤„ç†é€Ÿåº¦
            if 'rows/sec' in line:
                time_match = re.search(r'(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})', line)
                rate_match = re.search(r'(\d+) rows/sec', line)
                
                if time_match and rate_match:
                    times.append(datetime.fromisoformat(time_match.group(1)))
                    rates.append(int(rate_match.group(1)))
    
    return times, rates

def create_performance_chart(times, rates):
    """åˆ›å»ºæ€§èƒ½è¶‹åŠ¿å›¾"""
    plt.figure(figsize=(12, 6))
    plt.plot(times, rates, 'b-', linewidth=2)
    plt.title('gh-ost Migration Performance Over Time')
    plt.xlabel('Time')
    plt.ylabel('Rows per Second')
    plt.grid(True, alpha=0.3)
    plt.xticks(rotation=45)
    plt.tight_layout()
    plt.savefig('gh-ost-performance.png', dpi=300)
    print("Performance chart saved as gh-ost-performance.png")

if __name__ == '__main__':
    if len(sys.argv) != 2:
        print("Usage: python3 gh-ost-visualizer.py <log_file>")
        sys.exit(1)
    
    times, rates = parse_log_file(sys.argv[1])
    if times and rates:
        create_performance_chart(times, rates)
    else:
        print("No performance data found in log file")
```

### 9.3 æ•…éšœé¢„é˜²æªæ–½


**ğŸ”¸ é¢„æ£€æŸ¥æ¸…å•**
```bash
#!/bin/bash
# pre-migration-check.sh

echo "=== gh-ost Pre-migration Checklist ==="

# 1. æ£€æŸ¥è¡¨ç»“æ„
check_table_structure() {
    echo "Checking table structure..."
    mysql -e "DESCRIBE $DATABASE.$TABLE;" >/dev/null 2>&1
    if [[ $? -eq 0 ]]; then
        echo "âœ… Table exists and accessible"
    else
        echo "âŒ Table not found or not accessible"
        exit 1
    fi
}

# 2. æ£€æŸ¥æƒé™
check_permissions() {
    echo "Checking user permissions..."
    mysql -e "SHOW GRANTS;" | grep -E "(ALTER|CREATE|DROP|INDEX)" >/dev/null
    if [[ $? -eq 0 ]]; then
        echo "âœ… User has required permissions"
    else
        echo "âŒ User lacks required permissions"
        exit 1
    fi
}

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk_space() {
    echo "Checking disk space..."
    local available=$(df /var/log/gh-ost | awk 'NR==2 {print $4}')
    local required=1048576  # 1GB in KB
    
    if [[ $available -gt $required ]]; then
        echo "âœ… Sufficient disk space available"
    else
        echo "âŒ Insufficient disk space for logs"
        exit 1
    fi
}

# 4. æ£€æŸ¥ç½‘ç»œè¿æ¥
check_network() {
    echo "Checking network connectivity..."
    mysql -e "SELECT 1;" >/dev/null 2>&1
    if [[ $? -eq 0 ]]; then
        echo "âœ… Database connection successful"
    else
        echo "âŒ Cannot connect to database"
        exit 1
    fi
}

# æ‰§è¡Œæ£€æŸ¥
check_table_structure
check_permissions  
check_disk_space
check_network

echo "âœ… All pre-migration checks passed!"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ—¥å¿—ç³»ç»Ÿä½œç”¨ï¼šç›‘æ§è¿›åº¦ã€æ’æŸ¥æ•…éšœã€åˆ†ææ€§èƒ½çš„é‡è¦å·¥å…·
ğŸ”¸ æ—¥å¿—çº§åˆ«ç®¡ç†ï¼šDEBUG < INFO < WARNING < ERROR < FATAL
ğŸ”¸ æ—¥å¿—æ ¼å¼ç†è§£ï¼šæ—¶é—´æˆ³ + çº§åˆ« + ç»„ä»¶ + æ¶ˆæ¯å†…å®¹
ğŸ”¸ å…³é”®ç»„ä»¶æ—¥å¿—ï¼šmigratorã€applierã€inspectorã€throttlerå„å¸å…¶èŒ
ğŸ”¸ é”™è¯¯è¯Šæ–­æ–¹æ³•ï¼šç³»ç»Ÿæ€§æ’æŸ¥ï¼Œå®šä½æ ¹å› ï¼Œåˆ¶å®šè§£å†³æ–¹æ¡ˆ
ğŸ”¸ ç›‘æ§å‘Šè­¦ä½“ç³»ï¼šå…³é”®æŒ‡æ ‡ç›‘æ§ï¼ŒåŠæ—¶å‘ç°å’Œå“åº”é—®é¢˜
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ—¥å¿—çº§åˆ«çš„é€‰æ‹©åŸåˆ™**
```
å¼€å‘æµ‹è¯•ï¼šä½¿ç”¨DEBUGçº§åˆ«ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨INFOçº§åˆ«ï¼Œå¹³è¡¡ä¿¡æ¯é‡å’Œæ€§èƒ½
æ•…éšœæ’æŸ¥ï¼šä¸´æ—¶å¼€å¯DEBUGï¼Œå¿«é€Ÿå®šä½é—®é¢˜
æ€§èƒ½ç›‘æ§ï¼šå…³æ³¨WARNINGå’ŒERRORçº§åˆ«
```

**ğŸ”¹ æ—¥å¿—ç®¡ç†çš„æœ€ä½³å®è·µ**
```
æ–‡ä»¶ç®¡ç†ï¼š
â€¢ ç»Ÿä¸€å‘½åè§„èŒƒï¼Œä¾¿äºæŸ¥æ‰¾å’Œåˆ†ç±»
â€¢ è®¾ç½®åˆç†çš„è½®è½¬ç­–ç•¥ï¼Œæ§åˆ¶å­˜å‚¨ç©ºé—´
â€¢ é…ç½®é€‚å½“çš„æƒé™ï¼Œä¿éšœæ•°æ®å®‰å…¨

ç›‘æ§å‘Šè­¦ï¼š
â€¢ è®¾ç½®å…³é”®æŒ‡æ ‡é˜ˆå€¼ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
â€¢ å»ºç«‹åˆ†çº§å“åº”æœºåˆ¶ï¼Œå¿«é€Ÿå¤„ç†é—®é¢˜
â€¢ è®°å½•å¤„ç†è¿‡ç¨‹ï¼Œç§¯ç´¯æ•…éšœå¤„ç†ç»éªŒ
```

**ğŸ”¹ æ•…éšœè¯Šæ–­çš„ç³»ç»Ÿæ–¹æ³•**
```
è¯Šæ–­æ­¥éª¤ï¼š
1. æ”¶é›†ç°è±¡ï¼šå®Œæ•´çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
2. åˆ†æåŸå› ï¼šç»“åˆç³»ç»ŸçŠ¶æ€å’Œç¯å¢ƒå› ç´ 
3. åˆ¶å®šæ–¹æ¡ˆï¼šè¯„ä¼°é£é™©ï¼Œé€‰æ‹©æœ€ä¼˜è§£å†³æ–¹æ¡ˆ
4. éªŒè¯ç»“æœï¼šç¡®è®¤é—®é¢˜è§£å†³ï¼Œé˜²æ­¢å¤å‘
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¡ æ—¥å¿—é…ç½®å»ºè®®**
- **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å¯è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºå­¦ä¹ å’Œè°ƒè¯•
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€‚ä¸­æ—¥å¿—çº§åˆ«ï¼Œé‡ç‚¹å…³æ³¨é”™è¯¯å’Œæ€§èƒ½
- **å¤§è¡¨è¿ç§»**ï¼šå¢åŠ ç›‘æ§é¢‘ç‡ï¼Œè®¾ç½®æ›´ä¸¥æ ¼çš„å‘Šè­¦é˜ˆå€¼
- **å°è¡¨è¿ç§»**ï¼šå¯ä»¥é€‚å½“ç®€åŒ–æ—¥å¿—é…ç½®ï¼Œé™ä½å¼€é”€

**ğŸ”§ å·¥å…·ä½¿ç”¨æŠ€å·§**
- **logrotate**ï¼šè‡ªåŠ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶ï¼Œé¿å…ç£ç›˜ç©ºé—´ä¸è¶³
- **ç›‘æ§ç³»ç»Ÿ**ï¼šé›†æˆPrometheus/Grafanaï¼Œå¯è§†åŒ–ç›‘æ§æŒ‡æ ‡
- **å‘Šè­¦é€šçŸ¥**ï¼šé…ç½®å¤šç§å‘Šè­¦æ¸ é“ï¼Œç¡®ä¿åŠæ—¶å“åº”
- **åˆ†æè„šæœ¬**ï¼šå¼€å‘è‡ªå®šä¹‰å·¥å…·ï¼Œæé«˜æ•…éšœè¯Šæ–­æ•ˆç‡

**âš ï¸ æ³¨æ„äº‹é¡¹æé†’**
- æ•æ„Ÿä¿¡æ¯ä¸è¦è®°å½•åˆ°æ—¥å¿—ä¸­
- è°ƒè¯•æ¨¡å¼ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œæ³¨æ„å­˜å‚¨ç©ºé—´
- å®šæœŸæ¸…ç†å†å²æ—¥å¿—ï¼Œé¿å…å½±å“ç³»ç»Ÿæ€§èƒ½
- å»ºç«‹æ—¥å¿—è®¿é—®æƒé™æ§åˆ¶ï¼Œä¿éšœæ•°æ®å®‰å…¨

### 10.4 å­¦ä¹ å»ºè®®


**ğŸ“š æ·±å…¥å­¦ä¹ è·¯å¾„**
1. **åŸºç¡€æŒæ¡**ï¼šç†Ÿç»ƒé…ç½®å„ç§æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºæ–¹å¼
2. **å®è·µåº”ç”¨**ï¼šåœ¨æµ‹è¯•ç¯å¢ƒä¸­ç»ƒä¹ æ•…éšœè¯Šæ–­å’Œæ€§èƒ½åˆ†æ
3. **å·¥å…·é›†æˆ**ï¼šå­¦ä¹ ä¸ç›‘æ§ç³»ç»Ÿçš„é›†æˆé…ç½®
4. **ç»éªŒç§¯ç´¯**ï¼šè®°å½•å’Œåˆ†æå®é™…é¡¹ç›®ä¸­çš„æ—¥å¿—ç®¡ç†ç»éªŒ

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ—¥å¿—æ˜¯è¿ç§»è¿‡ç¨‹çš„"é»‘åŒ£å­"ï¼Œè®°å½•äº†æ‰€æœ‰é‡è¦ä¿¡æ¯
- åˆç†çš„æ—¥å¿—é…ç½®æ˜¯æˆåŠŸè¿ç§»çš„é‡è¦ä¿éšœ
- ç³»ç»ŸåŒ–çš„æ•…éšœè¯Šæ–­æ–¹æ³•èƒ½å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜
- å®Œå–„çš„ç›‘æ§å‘Šè­¦ä½“ç³»èƒ½åŠæ—¶å‘ç°å’Œå“åº”å¼‚å¸¸