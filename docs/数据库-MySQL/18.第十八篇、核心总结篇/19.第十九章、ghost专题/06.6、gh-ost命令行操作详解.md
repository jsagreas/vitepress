---
title: 6ã€gh-ostå‘½ä»¤è¡Œæ“ä½œè¯¦è§£
---
## ğŸ“š ç›®å½•

1. [gh-ostå‘½ä»¤åŸºç¡€ç»“æ„](#1-gh-ostå‘½ä»¤åŸºç¡€ç»“æ„)
2. [å¸¸ç”¨å‚æ•°ç»„åˆè¯¦è§£](#2-å¸¸ç”¨å‚æ•°ç»„åˆè¯¦è§£)
3. [æ‰§è¡Œæ¨¡å¼é€‰æ‹©](#3-æ‰§è¡Œæ¨¡å¼é€‰æ‹©)
4. [æµ‹è¯•æ¨¡å¼è¿è¡Œ](#4-æµ‹è¯•æ¨¡å¼è¿è¡Œ)
5. [ç”Ÿäº§æ¨¡å¼æ‰§è¡Œ](#5-ç”Ÿäº§æ¨¡å¼æ‰§è¡Œ)
6. [å‚æ•°éªŒè¯ä¸é…ç½®](#6-å‚æ•°éªŒè¯ä¸é…ç½®)
7. [è¾“å‡ºä¿¡æ¯è§£è¯»](#7-è¾“å‡ºä¿¡æ¯è§£è¯»)
8. [å®æˆ˜æ“ä½œç¤ºä¾‹](#8-å®æˆ˜æ“ä½œç¤ºä¾‹)
9. [æ‰¹é‡æ“ä½œä¸è‡ªåŠ¨åŒ–](#9-æ‰¹é‡æ“ä½œä¸è‡ªåŠ¨åŒ–)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš€ gh-ostå‘½ä»¤åŸºç¡€ç»“æ„


### 1.1 ä»€ä¹ˆæ˜¯gh-ostå‘½ä»¤


**ğŸ”¸ ç®€å•ç†è§£**
gh-ostå‘½ä»¤å°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½æ¬å®¶å·¥å…·"ï¼Œå¸®ä½ æŠŠMySQLè¡¨ä»æ—§ç»“æ„æ¬åˆ°æ–°ç»“æ„ï¼Œè€Œä¸”æ¬å®¶è¿‡ç¨‹ä¸­ä¸å½±å“æ­£å¸¸ä½¿ç”¨ã€‚

```
ä¼ ç»ŸDDLæ“ä½œï¼š    ğŸ æ—§æˆ¿å­ â†’ ğŸš«åœæ­¢ä½¿ç”¨ â†’ ğŸ”¨æ”¹é€  â†’ âœ…æ–°æˆ¿å­
gh-ostæ“ä½œï¼š     ğŸ æ—§æˆ¿å­ â†’ ğŸ—ï¸å»ºæ–°æˆ¿å­ â†’ ğŸššé€æ­¥æ¬å®¶ â†’ âœ…åˆ‡æ¢åˆ°æ–°æˆ¿å­
```

**ğŸ”¸ åŸºç¡€å‘½ä»¤è¯­æ³•ç»“æ„**
```bash
gh-ost [å…¨å±€é€‰é¡¹] --alter="ALTERè¯­å¥" [æ•°æ®åº“è¿æ¥é€‰é¡¹] [æ‰§è¡Œé€‰é¡¹]
```

### 1.2 å‘½ä»¤ç»“æ„è§£æ


**ğŸ”¹ å®Œæ•´å‘½ä»¤ç»“æ„å›¾**
```
gh-ost
â”œâ”€â”€ å…¨å±€é€‰é¡¹ï¼ˆæ§åˆ¶æ•´ä½“è¡Œä¸ºï¼‰
â”œâ”€â”€ --alter="DDLè¯­å¥"ï¼ˆè¦æ‰§è¡Œçš„å˜æ›´ï¼‰
â”œâ”€â”€ æ•°æ®åº“è¿æ¥é€‰é¡¹ï¼ˆå¦‚ä½•è¿æ¥æ•°æ®åº“ï¼‰
â”œâ”€â”€ æ‰§è¡Œæ¨¡å¼é€‰é¡¹ï¼ˆå¦‚ä½•æ‰§è¡Œå˜æ›´ï¼‰
â””â”€â”€ æ§åˆ¶é€‰é¡¹ï¼ˆæ‰§è¡Œè¿‡ç¨‹æ§åˆ¶ï¼‰
```

**ğŸ”¹ æœ€ç®€å•çš„å‘½ä»¤ç¤ºä¾‹**
```bash
# æœ€åŸºæœ¬çš„ç»“æ„ï¼šå·¥å…·å + å˜æ›´è¯­å¥ + æ•°æ®åº“ä¿¡æ¯
gh-ost \
  --alter="add column age int" \
  --database="mydb" \
  --table="users" \
  --execute
```

### 1.3 å‚æ•°åˆ†ç±»ç†è§£


| å‚æ•°ç±»å‹ | **ä½œç”¨** | **ä¸¾ä¾‹è¯´æ˜** | **å¿…éœ€æ€§** |
|---------|---------|-------------|-----------|
| ğŸ”¸ **è¿æ¥å‚æ•°** | `å‘Šè¯‰gh-ostå»å“ªæ‰¾æ•°æ®åº“` | `--host, --port, --user` | `å¿…éœ€` |
| ğŸ”¸ **å˜æ›´å‚æ•°** | `å‘Šè¯‰gh-ostè¦åšä»€ä¹ˆæ”¹åŠ¨` | `--alter, --database, --table` | `å¿…éœ€` |
| ğŸ”¸ **æ‰§è¡Œå‚æ•°** | `å‘Šè¯‰gh-ostæ€ä¹ˆæ‰§è¡Œ` | `--execute, --test-on-replica` | `å¿…éœ€ä¸€ä¸ª` |
| ğŸ”¸ **æ§åˆ¶å‚æ•°** | `æ§åˆ¶æ‰§è¡Œè¿‡ç¨‹å’Œæ€§èƒ½` | `--max-load, --chunk-size` | `å¯é€‰` |

---

## 2. âš™ï¸ å¸¸ç”¨å‚æ•°ç»„åˆè¯¦è§£


### 2.1 æ•°æ®åº“è¿æ¥å‚æ•°


**ğŸ”¸ åŸºç¡€è¿æ¥å‚æ•°**
```bash
# è¿æ¥åˆ°MySQLæœåŠ¡å™¨çš„åŸºæœ¬ä¿¡æ¯
--host="127.0.0.1"          # MySQLæœåŠ¡å™¨åœ°å€
--port=3306                  # MySQLç«¯å£å·
--user="root"                # æ•°æ®åº“ç”¨æˆ·å
--password="your_password"   # æ•°æ®åº“å¯†ç 
```

**ğŸ”¸ ç›®æ ‡è¡¨å‚æ•°**
```bash
# æŒ‡å®šè¦æ“ä½œçš„è¡¨
--database="myapp"           # æ•°æ®åº“å
--table="users"              # è¡¨å
```

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼šå°±åƒå¯„å¿«é€’ä¸€æ ·ï¼Œä½ å¾—å‘Šè¯‰å¿«é€’å‘˜å…·ä½“åœ°å€ï¼ˆhost:portï¼‰ï¼Œæ”¶ä»¶äººæ˜¯è°ï¼ˆuserï¼‰ï¼Œé—¨ç¦å¯†ç æ˜¯ä»€ä¹ˆï¼ˆpasswordï¼‰ï¼Œä»¥åŠè¦é€åˆ°å“ªä¸ªæˆ¿é—´ï¼ˆdatabase.tableï¼‰ã€‚

### 2.2 å˜æ›´æ“ä½œå‚æ•°


**ğŸ”¸ DDLå˜æ›´è¯­å¥**
```bash
# è¦æ‰§è¡Œçš„ALTERè¯­å¥ï¼ˆä¸åŒ…å«ALTER TABLEéƒ¨åˆ†ï¼‰
--alter="add column age int"                    # æ·»åŠ åˆ—
--alter="modify column name varchar(100)"      # ä¿®æ”¹åˆ—
--alter="add index idx_email (email)"          # æ·»åŠ ç´¢å¼•
--alter="drop column old_field"                # åˆ é™¤åˆ—
```

**âš ï¸ é‡è¦æé†’**ï¼š`--alter`å‚æ•°åªéœ€è¦å†™ALTER TABLEåé¢çš„éƒ¨åˆ†ï¼Œä¸è¦å†™å®Œæ•´çš„ALTER TABLEè¯­å¥ã€‚

```bash
# âŒ é”™è¯¯å†™æ³•
--alter="ALTER TABLE users add column age int"

# âœ… æ­£ç¡®å†™æ³•  
--alter="add column age int"
```

### 2.3 æ‰§è¡Œæ§åˆ¶å‚æ•°


**ğŸ”¸ æ€§èƒ½æ§åˆ¶å‚æ•°**
```bash
--chunk-size=1000               # æ¯æ¬¡å¤„ç†çš„è¡Œæ•°
--max-load="Threads_running=25" # ç³»ç»Ÿè´Ÿè½½é˜ˆå€¼
--critical-load="Threads_running=1000" # ç´§æ€¥åœæ­¢é˜ˆå€¼
--nice-ratio=0.5                # æš‚åœæ¯”ä¾‹ï¼ˆæ‰§è¡Œ1ç§’æš‚åœ0.5ç§’ï¼‰
```

**ğŸ§  è®°å¿†æŠ€å·§**ï¼š
- `chunk-size`ï¼šæƒ³è±¡æˆæ¬å®¶æ—¶æ¯æ¬¡æ¬å¤šå°‘ç®±å­
- `max-load`ï¼šæƒ³è±¡æˆç”µæ¢¯æ‰¿é‡é™åˆ¶ï¼Œè¶…è¿‡å°±æš‚åœ
- `nice-ratio`ï¼šæƒ³è±¡æˆå·¥ä½œä¼‘æ¯æ¯”ä¾‹ï¼Œé¿å…å¤ªç´¯

### 2.4 å®‰å…¨æ§åˆ¶å‚æ•°


**ğŸ”¸ ä¸»ä»å¤åˆ¶ç›¸å…³**
```bash
--allow-on-master               # å…è®¸åœ¨ä¸»åº“æ‰§è¡Œ
--test-on-replica              # åœ¨ä»åº“æµ‹è¯•
--migrate-on-replica           # åœ¨ä»åº“æ‰§è¡Œè¿ç§»
--assume-rbr                   # å‡è®¾ä½¿ç”¨è¡Œå¤åˆ¶æ¨¡å¼
```

**ğŸ”¸ å®‰å…¨æ£€æŸ¥å‚æ•°**
```bash
--allow-master-master          # å…è®¸ä¸»ä¸»å¤åˆ¶ç¯å¢ƒ
--switch-to-rbr                # è‡ªåŠ¨åˆ‡æ¢åˆ°è¡Œå¤åˆ¶æ¨¡å¼
--assume-master-host="master"  # æŒ‡å®šä¸»åº“åœ°å€
```

---

## 3. ğŸ¯ æ‰§è¡Œæ¨¡å¼é€‰æ‹©


### 3.1 æ‰§è¡Œæ¨¡å¼å¯¹æ¯”


```
æ‰§è¡Œæ¨¡å¼é€‰æ‹©å›¾ï¼š

ç”Ÿäº§ç¯å¢ƒ â”€â”€â”
          â”œâ”€â”€â–¶ --executeï¼ˆç›´æ¥æ‰§è¡Œï¼‰
æµ‹è¯•ç¯å¢ƒ â”€â”€â”˜

ä»åº“ç¯å¢ƒ â”€â”€â”
          â”œâ”€â”€â–¶ --test-on-replicaï¼ˆä»åº“æµ‹è¯•ï¼‰
          â””â”€â”€â–¶ --migrate-on-replicaï¼ˆä»åº“è¿ç§»ï¼‰
```

### 3.2 ä¸‰ç§ä¸»è¦æ‰§è¡Œæ¨¡å¼


**ğŸ”¸ ç›´æ¥æ‰§è¡Œæ¨¡å¼ï¼ˆ--executeï¼‰**
```bash
gh-ost \
  --alter="add column age int" \
  --database="mydb" \
  --table="users" \
  --execute    # ç›´æ¥åœ¨æŒ‡å®šæ•°æ®åº“æ‰§è¡Œ
```

**ç”¨é€”**ï¼šç”Ÿäº§ç¯å¢ƒç›´æ¥æ‰§è¡Œå˜æ›´
**é£é™©**ï¼šç›´æ¥å½±å“ç”Ÿäº§æ•°æ®
**é€‚ç”¨**ï¼šç»è¿‡å……åˆ†æµ‹è¯•çš„å˜æ›´

**ğŸ”¸ ä»åº“æµ‹è¯•æ¨¡å¼ï¼ˆ--test-on-replicaï¼‰**
```bash
gh-ost \
  --alter="add column age int" \
  --database="mydb" \
  --table="users" \
  --test-on-replica    # åœ¨ä»åº“æµ‹è¯•ï¼Œä¸åˆ‡æ¢
```

**ç”¨é€”**ï¼šéªŒè¯å˜æ›´æ˜¯å¦å¯è¡Œ
**é£é™©**ï¼šè¾ƒä½ï¼Œä¸å½±å“ä¸»åº“
**é€‚ç”¨**ï¼šå˜æ›´å‰çš„éªŒè¯æµ‹è¯•

**ğŸ”¸ ä»åº“è¿ç§»æ¨¡å¼ï¼ˆ--migrate-on-replicaï¼‰**
```bash
gh-ost \
  --alter="add column age int" \
  --database="mydb" \
  --table="users" \
  --migrate-on-replica    # åœ¨ä»åº“æ‰§è¡Œå¹¶åˆ‡æ¢
```

**ç”¨é€”**ï¼šåœ¨ä»åº“æ‰§è¡Œå˜æ›´å¹¶åˆ‡æ¢
**é£é™©**ï¼šä¸­ç­‰ï¼Œå½±å“ä»åº“
**é€‚ç”¨**ï¼šä¸»ä»ç¯å¢ƒçš„å˜æ›´æ“ä½œ

### 3.3 æ¨¡å¼é€‰æ‹©å†³ç­–æ ‘


```
æ˜¯å¦æœ‰ä»åº“ï¼Ÿ
â”œâ”€â”€ æœ‰ä»åº“
â”‚   â”œâ”€â”€ ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Ÿ â”€â”€yesâ”€â”€â–¶ --test-on-replicaï¼ˆå…ˆæµ‹è¯•ï¼‰
â”‚   â””â”€â”€ æµ‹è¯•é€šè¿‡ï¼Ÿ â”€â”€yesâ”€â”€â–¶ --migrate-on-replicaï¼ˆä»åº“æ‰§è¡Œï¼‰
â”‚
â””â”€â”€ åªæœ‰ä¸»åº“ â”€â”€â–¶ --executeï¼ˆç›´æ¥æ‰§è¡Œï¼Œéœ€è°¨æ…ï¼‰
```

---

## 4. ğŸ§ª æµ‹è¯•æ¨¡å¼è¿è¡Œ


### 4.1 æµ‹è¯•æ¨¡å¼çš„ä»·å€¼


**ğŸ”¸ ä¸ºä»€ä¹ˆè¦æµ‹è¯•**
æµ‹è¯•æ¨¡å¼å°±åƒ"è¯•è¡£é—´"ï¼Œè®©ä½ åœ¨ä¸ä¹°è¡£æœçš„æƒ…å†µä¸‹çœ‹çœ‹åˆä¸åˆé€‚ã€‚

```
æµ‹è¯•æ¨¡å¼è¿è¡Œæµç¨‹ï¼š
å‡†å¤‡é˜¶æ®µ â†’ åˆ›å»ºghostè¡¨ â†’ æ•°æ®å¤åˆ¶ â†’ éªŒè¯ç»“æœ â†’ æ¸…ç†æµ‹è¯•æ•°æ®
    â†“         â†“         â†“        â†“         â†“
  æ£€æŸ¥ç¯å¢ƒ   æµ‹è¯•DDL   éªŒè¯æ€§èƒ½  ç¡®è®¤æ­£ç¡®   ä¸å½±å“ç”Ÿäº§
```

### 4.2 æµ‹è¯•æ¨¡å¼å‘½ä»¤ç¤ºä¾‹


**ğŸ”¸ åŸºç¡€æµ‹è¯•å‘½ä»¤**
```bash
gh-ost \
  --user="root" \
  --password="password" \
  --host="slave-server" \
  --database="myapp" \
  --table="users" \
  --alter="add column age int default 0" \
  --test-on-replica \
  --verbose
```

**ğŸ”¸ è¯¦ç»†æµ‹è¯•å‘½ä»¤**
```bash
gh-ost \
  --user="readonly_user" \
  --password="test_pass" \
  --host="192.168.1.100" \
  --port=3306 \
  --database="test_db" \
  --table="user_profiles" \
  --alter="add index idx_created_at (created_at)" \
  --test-on-replica \
  --chunk-size=500 \
  --max-load="Threads_running=10" \
  --serve-socket-file="/tmp/gh-ost.test.sock" \
  --verbose
```

### 4.3 æµ‹è¯•è¾“å‡ºä¿¡æ¯è§£è¯»


**ğŸ”¸ æµ‹è¯•å¼€å§‹é˜¶æ®µè¾“å‡º**
```
# è¿æ¥ä¿¡æ¯ç¡®è®¤
2024-01-15 10:30:00 INFO connection validated on slave-server:3306
2024-01-15 10:30:01 INFO Migrating myapp.users
2024-01-15 10:30:01 INFO Inspector connection validated
```

**ğŸ”¸ æµ‹è¯•æ‰§è¡Œé˜¶æ®µè¾“å‡º**
```
# è¡¨åˆ›å»ºå’Œæ•°æ®å¤åˆ¶è¿›åº¦
2024-01-15 10:30:02 INFO Ghost table created
2024-01-15 10:30:02 INFO Row copy estimate: 45000 rows
2024-01-15 10:30:03 INFO Migrating 45000 rows in chunks of 1000
Copy: 5000/45000 11.1%; Applied: 0; Backlog: 0/100; Time: 15s(total), 13s(copy)
```

**ğŸ”¸ æµ‹è¯•å®Œæˆé˜¶æ®µè¾“å‡º**
```
# æµ‹è¯•ç»“æœæ€»ç»“
2024-01-15 10:32:15 INFO Row copy complete
2024-01-15 10:32:15 INFO Test completed successfully
2024-01-15 10:32:16 INFO Ghost table dropped
```

### 4.4 æµ‹è¯•ç»“æœè¯„ä¼°


**ğŸ“Š æµ‹è¯•æˆåŠŸæŒ‡æ ‡**
- [ ] **è¿æ¥æˆåŠŸ**ï¼šèƒ½æ­£å¸¸è¿æ¥åˆ°æ•°æ®åº“
- [ ] **DDLæœ‰æ•ˆ**ï¼šALTERè¯­å¥è¯­æ³•æ­£ç¡®
- [ ] **æ€§èƒ½å¯æ¥å—**ï¼šå¤åˆ¶é€Ÿåº¦æ»¡è¶³è¦æ±‚
- [ ] **æ— é”™è¯¯**ï¼šæ•´ä¸ªè¿‡ç¨‹æ— æŠ¥é”™
- [ ] **èµ„æºä½¿ç”¨åˆç†**ï¼šCPUã€å†…å­˜ã€IOæ­£å¸¸

**âš ï¸ æµ‹è¯•å¤±è´¥å¸¸è§åŸå› **
```bash
# æƒé™ä¸è¶³
ERROR 1142: SELECT command denied to user 'test'@'%' for table 'users'

# è¯­æ³•é”™è¯¯
ERROR 1064: syntax error near 'bad_column_definition' 

# èµ„æºä¸è¶³
ERROR: Aborting operation due to high system load
```

---

## 5. ğŸ¯ ç”Ÿäº§æ¨¡å¼æ‰§è¡Œ


### 5.1 ç”Ÿäº§æ‰§è¡Œå‰å‡†å¤‡


**ğŸ”¸ æ‰§è¡Œå‰æ£€æŸ¥æ¸…å•**
```markdown
**ğŸš¨ ç”Ÿäº§æ‰§è¡Œå‰å¿…æ£€é¡¹**
- [x] å·²åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡
- [x] ä¸šåŠ¡ä½å³°æœŸæ—¶é—´å®‰æ’
- [x] æ•°æ®åº“å¤‡ä»½å·²å®Œæˆ
- [x] ç›‘æ§å‘Šè­¦å·²å°±ä½
- [x] å›æ»šæ–¹æ¡ˆå·²å‡†å¤‡
- [x] ç›¸å…³äººå‘˜å·²é€šçŸ¥
```

**ğŸ”¸ ç”Ÿäº§ç¯å¢ƒå®‰å…¨å‚æ•°**
```bash
# ç”Ÿäº§ç¯å¢ƒæ¨èçš„å®‰å…¨å‚æ•°è®¾ç½®
--max-load="Threads_running=25,Threads_connected=100" \
--critical-load="Threads_running=100,Threads_connected=500" \
--chunk-size=500 \                    # è¾ƒå°çš„chunké¿å…å½±å“æ€§èƒ½
--nice-ratio=1.0 \                   # æ›´å¤šä¼‘æ¯æ—¶é—´
--cut-over-exponential-backoff \     # åˆ‡æ¢æ—¶ä½¿ç”¨æŒ‡æ•°é€€é¿
--panic-flag-file="/tmp/ghost.panic" # ç´§æ€¥åœæ­¢æ–‡ä»¶
```

### 5.2 ç”Ÿäº§æ‰§è¡Œå‘½ä»¤æ¨¡æ¿


**ğŸ”¸ æ ‡å‡†ç”Ÿäº§æ‰§è¡Œå‘½ä»¤**
```bash
#!/bin/bash
# ç”Ÿäº§ç¯å¢ƒgh-ostæ‰§è¡Œè„šæœ¬

# è®¾ç½®åŸºç¡€å˜é‡
DB_HOST="prod-mysql-master"
DB_USER="gh_ost_user"
DB_PASS="secure_password"
DATABASE="production_app"
TABLE_NAME="user_accounts"
ALTER_SQL="add column last_login_at datetime"

# æ‰§è¡Œgh-ost
gh-ost \
  --user="${DB_USER}" \
  --password="${DB_PASS}" \
  --host="${DB_HOST}" \
  --port=3306 \
  --database="${DATABASE}" \
  --table="${TABLE_NAME}" \
  --alter="${ALTER_SQL}" \
  --allow-on-master \
  --execute \
  --chunk-size=500 \
  --max-load="Threads_running=25" \
  --critical-load="Threads_running=100" \
  --nice-ratio=1.0 \
  --cut-over-exponential-backoff \
  --serve-socket-file="/tmp/gh-ost.${TABLE_NAME}.sock" \
  --panic-flag-file="/tmp/gh-ost.${TABLE_NAME}.panic" \
  --verbose \
  2>&1 | tee "/var/log/gh-ost/migration_${TABLE_NAME}_$(date +%Y%m%d_%H%M%S).log"
```

### 5.3 ç”Ÿäº§æ‰§è¡Œç›‘æ§


**ğŸ”¸ æ‰§è¡Œè¿‡ç¨‹ç›‘æ§è¦ç‚¹**
```bash
# 1. ç³»ç»Ÿè´Ÿè½½ç›‘æ§
watch -n 1 'mysqladmin -u root -p processlist | head -20'

# 2. ç£ç›˜IOç›‘æ§
iostat -x 1

# 3. gh-ostè¿›åº¦æŸ¥è¯¢
echo "status" | nc -U /tmp/gh-ost.user_accounts.sock

# 4. åº”ç”¨è¿æ¥æ•°ç›‘æ§
mysqladmin -u root -p status | grep Threads
```

**ğŸ”¸ å…³é”®ç›‘æ§æŒ‡æ ‡**
```
ğŸ“Š éœ€è¦æŒç»­å…³æ³¨çš„æŒ‡æ ‡ï¼š
â”œâ”€â”€ æ•°æ®åº“è¿æ¥æ•° (Threads_connected < 80%)
â”œâ”€â”€ æ´»è·ƒçº¿ç¨‹æ•° (Threads_running < è®¾å®šé˜ˆå€¼)  
â”œâ”€â”€ å¤åˆ¶å»¶è¿Ÿ (Seconds_Behind_Master < 60s)
â”œâ”€â”€ ç£ç›˜IOä½¿ç”¨ç‡ (util < 80%)
â””â”€â”€ gh-ostå¤åˆ¶è¿›åº¦ (Copy progress)
```

---

## 6. ğŸ”§ å‚æ•°éªŒè¯ä¸é…ç½®


### 6.1 å‘½ä»¤è¡Œå‚æ•°éªŒè¯


**ğŸ”¸ å‚æ•°éªŒè¯å·¥å…·**
```bash
# ä½¿ç”¨--helpæŸ¥çœ‹æ‰€æœ‰å‚æ•°
gh-ost --help

# ä½¿ç”¨--versionæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
gh-ost --version

# éªŒè¯è¿æ¥å‚æ•°ï¼ˆä¸æ‰§è¡Œè¿ç§»ï¼‰
gh-ost \
  --user="test_user" \
  --password="test_pass" \
  --host="test-server" \
  --database="test_db" \
  --table="test_table" \
  --alter="add column test_col int" \
  --postpone-cut-over    # åªå‡†å¤‡ä¸æ‰§è¡Œåˆ‡æ¢
```

### 6.2 å‚æ•°æ–‡ä»¶é…ç½®


**ğŸ”¸ åˆ›å»ºå‚æ•°é…ç½®æ–‡ä»¶**
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶ gh-ost.conf
cat > /etc/gh-ost/gh-ost.conf << EOF
# æ•°æ®åº“è¿æ¥é…ç½®
user=gh_ost_user
password=secure_password
host=mysql-master
port=3306

# æ€§èƒ½æ§åˆ¶é…ç½®
chunk-size=500
max-load=Threads_running=25
critical-load=Threads_running=100
nice-ratio=1.0

# å®‰å…¨æ§åˆ¶é…ç½®
allow-on-master=true
cut-over-exponential-backoff=true
panic-flag-file=/tmp/gh-ost.panic

# æ—¥å¿—é…ç½®
verbose=true
serve-socket-file=/tmp/gh-ost.sock
EOF
```

**ğŸ”¸ ä½¿ç”¨é…ç½®æ–‡ä»¶æ‰§è¡Œ**
```bash
# é€šè¿‡é…ç½®æ–‡ä»¶æ‰§è¡Œ
gh-ost \
  --conf="/etc/gh-ost/gh-ost.conf" \
  --database="myapp" \
  --table="users" \
  --alter="add column age int" \
  --execute
```

### 6.3 å‚æ•°ä¼˜å…ˆçº§


```
å‚æ•°ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
å‘½ä»¤è¡Œç›´æ¥å‚æ•° > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼
      â†‘              â†‘         â†‘        â†‘
   æœ€é«˜ä¼˜å…ˆçº§      æ¬¡è¦ä¼˜å…ˆçº§  å¤‡é€‰é…ç½®  ä¿åº•è®¾ç½®
```

**ğŸ”¸ å‚æ•°è¦†ç›–ç¤ºä¾‹**
```bash
# é…ç½®æ–‡ä»¶ä¸­è®¾ç½® chunk-size=1000
# å‘½ä»¤è¡Œä¸­è®¾ç½® --chunk-size=500
# æœ€ç»ˆä½¿ç”¨ chunk-size=500 (å‘½ä»¤è¡Œä¼˜å…ˆ)

gh-ost \
  --conf="/etc/gh-ost/gh-ost.conf" \
  --chunk-size=500 \               # è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®
  --database="myapp" \
  --table="users" \
  --alter="add column age int" \
  --execute
```

---

## 7. ğŸ“Š è¾“å‡ºä¿¡æ¯è§£è¯»


### 7.1 è¾“å‡ºä¿¡æ¯åˆ†ç±»


**ğŸ”¸ è¾“å‡ºä¿¡æ¯ç±»å‹**
```
gh-ostè¾“å‡ºä¿¡æ¯åˆ†ç±»ï¼š
â”œâ”€â”€ INFOï¼šä¸€èˆ¬ä¿¡æ¯ï¼Œæ˜¾ç¤ºæ‰§è¡Œè¿›åº¦
â”œâ”€â”€ WARNï¼šè­¦å‘Šä¿¡æ¯ï¼Œéœ€è¦å…³æ³¨ä½†ä¸å½±å“æ‰§è¡Œ  
â”œâ”€â”€ ERRORï¼šé”™è¯¯ä¿¡æ¯ï¼Œå¯èƒ½å¯¼è‡´æ‰§è¡Œå¤±è´¥
â””â”€â”€ FATALï¼šè‡´å‘½é”™è¯¯ï¼Œç«‹å³åœæ­¢æ‰§è¡Œ
```

### 7.2 å…³é”®è¾“å‡ºä¿¡æ¯è§£è¯»


**ğŸ”¸ åˆå§‹åŒ–é˜¶æ®µä¿¡æ¯**
```bash
# è¿æ¥éªŒè¯æˆåŠŸ
2024-01-15 10:30:00 INFO connection validated on mysql-master:3306
# è§£è¯»ï¼šæˆåŠŸè¿æ¥åˆ°MySQLæœåŠ¡å™¨

# è¡¨ä¿¡æ¯ç¡®è®¤
2024-01-15 10:30:01 INFO Migrating myapp.users; Engine=InnoDB; Row format=DYNAMIC; Rows=150000
# è§£è¯»ï¼šç¡®è®¤è¦è¿ç§»çš„è¡¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å­˜å‚¨å¼•æ“ã€è¡Œæ ¼å¼ã€ä¼°è®¡è¡Œæ•°

# Ghostè¡¨åˆ›å»º
2024-01-15 10:30:02 INFO Ghost table created: _users_gho
# è§£è¯»ï¼šåˆ›å»ºäº†ä¸´æ—¶çš„ghostè¡¨ç”¨äºå­˜å‚¨æ–°ç»“æ„æ•°æ®
```

**ğŸ”¸ æ‰§è¡Œè¿›åº¦ä¿¡æ¯**
```bash
# å¤åˆ¶è¿›åº¦æ˜¾ç¤º
Copy: 15000/150000 10.0%; Applied: 45; Backlog: 2/100; Time: 1m30s(total), 1m25s(copy); streamer: mysql-bin.000123:45678; Lag: 0.5s
```

**ğŸ“‹ è¿›åº¦ä¿¡æ¯è¯¦ç»†è§£è¯»**
- `Copy: 15000/150000 10.0%`ï¼šå·²å¤åˆ¶15000è¡Œï¼Œæ€»å…±150000è¡Œï¼Œå®Œæˆ10%
- `Applied: 45`ï¼šå·²åº”ç”¨45ä¸ªbinlogäº‹ä»¶
- `Backlog: 2/100`ï¼šå¾…å¤„ç†çš„binlogäº‹ä»¶é˜Ÿåˆ—ï¼Œå½“å‰2ä¸ªï¼Œæœ€å¤§100ä¸ª
- `Time: 1m30s(total), 1m25s(copy)`ï¼šæ€»æ—¶é—´1åˆ†30ç§’ï¼Œå¤åˆ¶æ—¶é—´1åˆ†25ç§’
- `streamer: mysql-bin.000123:45678`ï¼šå½“å‰è¯»å–çš„binlogæ–‡ä»¶å’Œä½ç½®
- `Lag: 0.5s`ï¼šä¸»ä»å¤åˆ¶å»¶è¿Ÿ0.5ç§’

**ğŸ”¸ å®Œæˆé˜¶æ®µä¿¡æ¯**
```bash
# åˆ‡æ¢å‡†å¤‡
2024-01-15 10:45:30 INFO Waiting for streamer to close binlog
# è§£è¯»ï¼šç­‰å¾…binlogæµå¤„ç†å®Œæˆ

# åŸå­åˆ‡æ¢
2024-01-15 10:45:31 INFO Locking original & ghost tables
2024-01-15 10:45:31 INFO Tables renamed atomically
# è§£è¯»ï¼šåŸå­æ€§åœ°å®Œæˆè¡¨é‡å‘½åæ“ä½œ

# å®Œæˆæ¸…ç†
2024-01-15 10:45:32 INFO Migration completed successfully
# è§£è¯»ï¼šè¿ç§»æˆåŠŸå®Œæˆ
```

### 7.3 é”™è¯¯ä¿¡æ¯è§£è¯»ä¸å¤„ç†


**ğŸ”¸ å¸¸è§é”™è¯¯ä¿¡æ¯**
```bash
# æƒé™é”™è¯¯
ERROR 1142: SELECT command denied to user 'ghost'@'%' for table 'users'
# è§£è¯»ï¼šç”¨æˆ·ghostæ²¡æœ‰è¯»å–usersè¡¨çš„æƒé™
# å¤„ç†ï¼šç»™ç”¨æˆ·æˆäºˆç›¸åº”æƒé™

# è´Ÿè½½è¿‡é«˜é”™è¯¯
ERROR Aborting operation due to high system load: Threads_running=45 > 25
# è§£è¯»ï¼šç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œæ´»è·ƒçº¿ç¨‹æ•°45è¶…è¿‡è®¾å®šé˜ˆå€¼25
# å¤„ç†ï¼šç­‰å¾…è´Ÿè½½é™ä½æˆ–è°ƒæ•´max-loadå‚æ•°

# ç£ç›˜ç©ºé—´é”™è¯¯
ERROR 1114: The table '_users_gho' is full
# è§£è¯»ï¼šç£ç›˜ç©ºé—´ä¸è¶³ï¼Œæ— æ³•åˆ›å»ºghostè¡¨
# å¤„ç†ï¼šæ¸…ç†ç£ç›˜ç©ºé—´æˆ–é€‰æ‹©å…¶ä»–å­˜å‚¨ä½ç½®
```

---

## 8. ğŸ’¼ å®æˆ˜æ“ä½œç¤ºä¾‹


### 8.1 å¸¸è§åœºæ™¯æ“ä½œç¤ºä¾‹


**ğŸ”¸ åœºæ™¯1ï¼šç»™ç”¨æˆ·è¡¨æ·»åŠ å­—æ®µ**
```bash
# ä¸šåŠ¡éœ€æ±‚ï¼šç»™ç”¨æˆ·è¡¨æ·»åŠ å¹´é¾„å­—æ®µ
gh-ost \
  --user="app_user" \
  --password="app_password" \
  --host="db-master" \
  --database="userdb" \
  --table="users" \
  --alter="add column age int default 0 comment 'ç”¨æˆ·å¹´é¾„'" \
  --allow-on-master \
  --execute \
  --chunk-size=1000 \
  --max-load="Threads_running=30" \
  --verbose
```

**ğŸ”¸ åœºæ™¯2ï¼šä¿®æ”¹å­—æ®µç±»å‹**
```bash
# ä¸šåŠ¡éœ€æ±‚ï¼šå°†ç”¨æˆ·åå­—æ®µé•¿åº¦ä»50å¢åŠ åˆ°100
gh-ost \
  --user="dba_user" \
  --password="dba_password" \
  --host="192.168.1.10" \
  --database="app_db" \
  --table="user_profiles" \
  --alter="modify column username varchar(100) not null comment 'ç”¨æˆ·å'" \
  --allow-on-master \
  --execute \
  --chunk-size=500 \
  --nice-ratio=0.5 \
  --cut-over-exponential-backoff
```

**ğŸ”¸ åœºæ™¯3ï¼šæ·»åŠ ç´¢å¼•**
```bash
# ä¸šåŠ¡éœ€æ±‚ï¼šä¸ºé‚®ç®±å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•
gh-ost \
  --user="index_user" \
  --password="index_pass" \
  --host="mysql-primary" \
  --database="customer_db" \
  --table="customers" \
  --alter="add unique index uk_email (email)" \
  --allow-on-master \
  --execute \
  --chunk-size=2000 \
  --max-load="Threads_running=20,Threads_connected=200"
```

### 8.2 å¤æ‚åœºæ™¯ç¤ºä¾‹


**ğŸ”¸ å¤§è¡¨è¿ç§»ï¼ˆåƒä¸‡çº§æ•°æ®ï¼‰**
```bash
#!/bin/bash
# å¤§è¡¨è¿ç§»è„šæœ¬
TABLE_NAME="order_history"
LOG_FILE="/var/log/gh-ost/migration_${TABLE_NAME}_$(date +%Y%m%d_%H%M%S).log"

echo "å¼€å§‹è¿ç§»å¤§è¡¨ ${TABLE_NAME}..." | tee -a ${LOG_FILE}

gh-ost \
  --user="migration_user" \
  --password="${MYSQL_PASSWORD}" \
  --host="mysql-master" \
  --port=3306 \
  --database="order_system" \
  --table="${TABLE_NAME}" \
  --alter="add column updated_at timestamp default current_timestamp on update current_timestamp" \
  --allow-on-master \
  --execute \
  --chunk-size=100 \                    # å°chunkå‡å°‘é”å®šæ—¶é—´
  --max-load="Threads_running=15" \     # ä¿å®ˆçš„è´Ÿè½½è®¾ç½®
  --critical-load="Threads_running=50" \
  --nice-ratio=2.0 \                   # æ›´å¤šä¼‘æ¯æ—¶é—´
  --cut-over-exponential-backoff \
  --panic-flag-file="/tmp/ghost.${TABLE_NAME}.panic" \
  --serve-socket-file="/tmp/ghost.${TABLE_NAME}.sock" \
  --verbose 2>&1 | tee -a ${LOG_FILE}

if [ $? -eq 0 ]; then
    echo "è¿ç§»æˆåŠŸå®Œæˆï¼" | tee -a ${LOG_FILE}
else
    echo "è¿ç§»å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ï¼" | tee -a ${LOG_FILE}
fi
```

### 8.3 æ•…éšœå¤„ç†ç¤ºä¾‹


**ğŸ”¸ ç´§æ€¥åœæ­¢æ“ä½œ**
```bash
# æ–¹æ³•1ï¼šåˆ›å»ºpanicæ–‡ä»¶
touch /tmp/ghost.users.panic

# æ–¹æ³•2ï¼šé€šè¿‡socketå‘é€åœæ­¢å‘½ä»¤
echo "panic" | nc -U /tmp/ghost.users.sock

# æ–¹æ³•3ï¼šç›´æ¥æ€æ­»è¿›ç¨‹ï¼ˆæœ€åé€‰æ‹©ï¼‰
pkill -f "gh-ost.*users"
```

**ğŸ”¸ æš‚åœå’Œæ¢å¤æ“ä½œ**
```bash
# æš‚åœè¿ç§»
echo "throttle" | nc -U /tmp/ghost.users.sock

# æ¢å¤è¿ç§»  
echo "no-throttle" | nc -U /tmp/ghost.users.sock

# æŸ¥çœ‹å½“å‰çŠ¶æ€
echo "status" | nc -U /tmp/ghost.users.sock
```

---

## 9. ğŸ¤– æ‰¹é‡æ“ä½œä¸è‡ªåŠ¨åŒ–


### 9.1 æ‰¹é‡æ“ä½œè„šæœ¬


**ğŸ”¸ å¤šè¡¨è¿ç§»è„šæœ¬**
```bash
#!/bin/bash
# æ‰¹é‡è¡¨è¿ç§»è„šæœ¬

# å®šä¹‰è¦è¿ç§»çš„è¡¨åˆ—è¡¨
declare -A TABLES
TABLES["users"]="add column created_by varchar(50)"
TABLES["orders"]="add index idx_created_at (created_at)"
TABLES["products"]="modify column description text"

# æ•°æ®åº“è¿æ¥ä¿¡æ¯
DB_HOST="mysql-master"
DB_USER="migration_user"
DB_PASSWORD="secure_password"
DATABASE="ecommerce"

# æ‰¹é‡æ‰§è¡Œè¿ç§»
for table in "${!TABLES[@]}"; do
    alter_sql="${TABLES[$table]}"
    echo "å¼€å§‹è¿ç§»è¡¨: $table"
    echo "å˜æ›´è¯­å¥: $alter_sql"
    
    gh-ost \
        --user="$DB_USER" \
        --password="$DB_PASSWORD" \
        --host="$DB_HOST" \
        --database="$DATABASE" \
        --table="$table" \
        --alter="$alter_sql" \
        --allow-on-master \
        --execute \
        --chunk-size=1000 \
        --max-load="Threads_running=25" \
        --verbose
    
    if [ $? -eq 0 ]; then
        echo "è¡¨ $table è¿ç§»æˆåŠŸ"
    else
        echo "è¡¨ $table è¿ç§»å¤±è´¥ï¼Œåœæ­¢åç»­æ“ä½œ"
        exit 1
    fi
    
    echo "ç­‰å¾…30ç§’åç»§ç»­ä¸‹ä¸€ä¸ªè¡¨..."
    sleep 30
done

echo "æ‰€æœ‰è¡¨è¿ç§»å®Œæˆï¼"
```

### 9.2 å‚æ•°æ–‡ä»¶è‡ªåŠ¨åŒ–


**ğŸ”¸ ç¯å¢ƒé…ç½®ç®¡ç†**
```bash
# å¼€å‘ç¯å¢ƒé…ç½® dev.conf
cat > /etc/gh-ost/dev.conf << EOF
user=dev_user
password=dev_password
host=dev-mysql
port=3306
chunk-size=2000
max-load=Threads_running=50
nice-ratio=0.1
EOF

# ç”Ÿäº§ç¯å¢ƒé…ç½® prod.conf
cat > /etc/gh-ost/prod.conf << EOF
user=prod_user
password=prod_password  
host=prod-mysql
port=3306
chunk-size=500
max-load=Threads_running=15
critical-load=Threads_running=50
nice-ratio=1.0
cut-over-exponential-backoff=true
panic-flag-file=/tmp/gh-ost.panic
EOF

# ä½¿ç”¨é…ç½®æ–‡ä»¶çš„è‡ªåŠ¨åŒ–è„šæœ¬
#!/bin/bash
ENVIRONMENT=${1:-dev}
CONFIG_FILE="/etc/gh-ost/${ENVIRONMENT}.conf"

if [ ! -f "$CONFIG_FILE" ]; then
    echo "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $CONFIG_FILE"
    exit 1
fi

gh-ost \
    --conf="$CONFIG_FILE" \
    --database="$2" \
    --table="$3" \
    --alter="$4" \
    --execute
```

### 9.3 ç›‘æ§è‡ªåŠ¨åŒ–


**ğŸ”¸ ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# gh-ostæ‰§è¡Œç›‘æ§è„šæœ¬

SOCKET_FILE="/tmp/gh-ost.users.sock"
LOG_FILE="/var/log/gh-ost/monitor.log"

# æ£€æŸ¥gh-ostæ˜¯å¦åœ¨è¿è¡Œ
check_running() {
    if [ -S "$SOCKET_FILE" ]; then
        return 0
    else
        return 1
    fi
}

# è·å–æ‰§è¡ŒçŠ¶æ€
get_status() {
    if check_running; then
        echo "status" | nc -U "$SOCKET_FILE" 2>/dev/null
    else
        echo "gh-ost not running"
    fi
}

# ç›‘æ§å¾ªç¯
while check_running; do
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    status=$(get_status)
    echo "[$timestamp] $status" >> "$LOG_FILE"
    
    # æ£€æŸ¥æ˜¯å¦éœ€è¦å‘Šè­¦
    if echo "$status" | grep -q "ERROR\|FATAL"; then
        echo "[$timestamp] å‘ç°é”™è¯¯ï¼Œå‘é€å‘Šè­¦" >> "$LOG_FILE"
        # è¿™é‡Œå¯ä»¥æ·»åŠ å‘Šè­¦é€»è¾‘ï¼Œå¦‚å‘é€é‚®ä»¶æˆ–çŸ­ä¿¡
    fi
    
    sleep 10
done

echo "[$timestamp] gh-ostæ‰§è¡Œç»“æŸ" >> "$LOG_FILE"
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ å‘½ä»¤ç»“æ„ç†è§£**
```
gh-ost = å·¥å…·å + å˜æ›´å†…å®¹ + è¿æ¥ä¿¡æ¯ + æ‰§è¡Œæ–¹å¼ + æ§åˆ¶å‚æ•°
```

**ğŸ”¸ ä¸‰ç§æ‰§è¡Œæ¨¡å¼**
- `--execute`ï¼šç”Ÿäº§ç›´æ¥æ‰§è¡Œ
- `--test-on-replica`ï¼šä»åº“æµ‹è¯•éªŒè¯  
- `--migrate-on-replica`ï¼šä»åº“æ‰§è¡Œè¿ç§»

**ğŸ”¸ å…³é”®å‚æ•°ç»„åˆ**
- **è¿æ¥å‚æ•°**ï¼š`--host`, `--user`, `--password`, `--database`, `--table`
- **å˜æ›´å‚æ•°**ï¼š`--alter`ï¼ˆåªå†™ALTER TABLEåé¢éƒ¨åˆ†ï¼‰
- **æ§åˆ¶å‚æ•°**ï¼š`--chunk-size`, `--max-load`, `--nice-ratio`

### 10.2 å®æˆ˜æ“ä½œè¦ç‚¹


**ğŸ”¹ æ“ä½œå‰å‡†å¤‡**
- [ ] æµ‹è¯•ç¯å¢ƒéªŒè¯é€šè¿‡
- [ ] ç”Ÿäº§ç¯å¢ƒå¤‡ä»½å®Œæˆ  
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å°±ç»ª
- [ ] æ‰§è¡Œæ—¶é—´å®‰æ’åˆç†

**ğŸ”¹ å‚æ•°è®¾ç½®åŸåˆ™**
```
å¼€å‘ç¯å¢ƒï¼šå¤§chunk-sizeï¼Œå®½æ¾loadé™åˆ¶ï¼Œå¿«é€Ÿæ‰§è¡Œ
æµ‹è¯•ç¯å¢ƒï¼šçœŸå®å‚æ•°æ¨¡æ‹Ÿï¼ŒéªŒè¯æ€§èƒ½è¡¨ç°  
ç”Ÿäº§ç¯å¢ƒï¼šå°chunk-sizeï¼Œä¸¥æ ¼loadé™åˆ¶ï¼Œå®‰å…¨ä¼˜å…ˆ
```

**ğŸ”¹ ç›‘æ§å…³æ³¨ç‚¹**
- **ç³»ç»Ÿè´Ÿè½½**ï¼šThreads_running < è®¾å®šé˜ˆå€¼
- **å¤åˆ¶å»¶è¿Ÿ**ï¼šSeconds_Behind_Master < 60ç§’
- **æ‰§è¡Œè¿›åº¦**ï¼šCopyç™¾åˆ†æ¯”å’Œé¢„ä¼°å®Œæˆæ—¶é—´
- **é”™è¯¯ä¿¡æ¯**ï¼šåŠæ—¶å‘ç°å¹¶å¤„ç†å¼‚å¸¸

### 10.3 æœ€ä½³å®è·µå»ºè®®


**ğŸ¯ å®‰å…¨æ‰§è¡ŒåŸåˆ™**
1. **å…ˆæµ‹è¯•åæ‰§è¡Œ**ï¼šæ‰€æœ‰å˜æ›´éƒ½è¦å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
2. **å°æ­¥å¿«è·‘**ï¼šä½¿ç”¨è¾ƒå°çš„chunk-sizeå‡å°‘å½±å“
3. **è´Ÿè½½æ§åˆ¶**ï¼šè®¾ç½®åˆç†çš„max-loadé¿å…å½±å“ä¸šåŠ¡
4. **ç›‘æ§å‘Šè­¦**ï¼šå…¨ç¨‹ç›‘æ§å¹¶è®¾ç½®å¼‚å¸¸å‘Šè­¦
5. **åº”æ€¥é¢„æ¡ˆ**ï¼šå‡†å¤‡panic-flag-fileå’Œå›æ»šæ–¹æ¡ˆ

**ğŸš€ æ€§èƒ½ä¼˜åŒ–æŠ€å·§**
- **ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ**ï¼šé¿å¼€é«˜å¹¶å‘æ—¶æ®µ
- **åˆç†çš„nice-ratio**ï¼šç»™ä¸šåŠ¡ç•™å‡ºè¶³å¤Ÿèµ„æº
- **é€‚å½“çš„chunk-size**ï¼šå¹³è¡¡æ‰§è¡Œé€Ÿåº¦å’Œç³»ç»Ÿå½±å“
- **ç½‘ç»œä¼˜åŒ–**ï¼šç¡®ä¿ä¸»ä»ç½‘ç»œç¨³å®š
- **ç£ç›˜ç©ºé—´é¢„ç•™**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´åˆ›å»ºghostè¡¨

### 10.4 æ•…éšœå¤„ç†æŒ‡å—


**âš ï¸ å¸¸è§é—®é¢˜å¤„ç†**
- **è´Ÿè½½è¿‡é«˜**ï¼šè°ƒæ•´max-loadå‚æ•°æˆ–ç­‰å¾…ç³»ç»Ÿè´Ÿè½½é™ä½
- **ç£ç›˜ç©ºé—´ä¸è¶³**ï¼šæ¸…ç†ç©ºé—´æˆ–ä½¿ç”¨--alter-foreign-keys-method
- **ä¸»ä»å»¶è¿Ÿè¿‡å¤§**ï¼šæš‚åœæ“ä½œæˆ–è°ƒæ•´chunk-size
- **æƒé™ä¸è¶³**ï¼šæ£€æŸ¥å¹¶æˆäºˆç›¸åº”çš„æ•°æ®åº“æƒé™

**ğŸ”§ åº”æ€¥æ“ä½œå‘½ä»¤**
```bash
# ç´§æ€¥åœæ­¢
touch /tmp/gh-ost.panic

# æš‚åœæ‰§è¡Œ
echo "throttle" | nc -U /tmp/gh-ost.sock

# æŸ¥çœ‹çŠ¶æ€  
echo "status" | nc -U /tmp/gh-ost.sock
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- å‘½ä»¤ç»“æ„ï¼šè¿æ¥+å˜æ›´+æ‰§è¡Œ+æ§åˆ¶
- æ‰§è¡Œæ¨¡å¼ï¼šæµ‹è¯•éªŒè¯ï¼Œä»åº“è¿ç§»ï¼Œç›´æ¥æ‰§è¡Œ
- å®‰å…¨åŸåˆ™ï¼šå…ˆæµ‹è¯•ï¼Œæ§è´Ÿè½½ï¼Œå…¨ç›‘æ§ï¼Œå¤‡é¢„æ¡ˆ
- æ€§èƒ½ä¼˜åŒ–ï¼šä½å³°æœŸï¼Œå°chunkï¼Œæ…¢æ‰§è¡Œï¼Œè¶³ç©ºé—´