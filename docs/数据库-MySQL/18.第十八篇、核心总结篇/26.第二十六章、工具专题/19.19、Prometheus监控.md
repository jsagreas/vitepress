---
title: 19ã€Prometheusç›‘æ§
---
## ğŸ“š ç›®å½•

1. [ç›‘æ§æ¦‚è¿°ä¸æ ¸å¿ƒæ¶æ„](#1-ç›‘æ§æ¦‚è¿°ä¸æ ¸å¿ƒæ¶æ„)
2. [mysqld_exporterè¯¦è§£](#2-mysqld_exporterè¯¦è§£)
3. [Prometheusé›†æˆé…ç½®](#3-prometheusé›†æˆé…ç½®)
4. [æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è¯¦è§£](#4-æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è¯¦è§£)
5. [å‘Šè­¦è§„åˆ™é…ç½®](#5-å‘Šè­¦è§„åˆ™é…ç½®)
6. [Grafanaå¯è§†åŒ–å®æˆ˜](#6-grafanaå¯è§†åŒ–å®æˆ˜)
7. [é›†ç¾¤ç›‘æ§æ–¹æ¡ˆ](#7-é›†ç¾¤ç›‘æ§æ–¹æ¡ˆ)
8. [è¿ç»´è‡ªåŠ¨åŒ–é›†æˆ](#8-è¿ç»´è‡ªåŠ¨åŒ–é›†æˆ)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ ç›‘æ§æ¦‚è¿°ä¸æ ¸å¿ƒæ¶æ„


### 1.1 ä»€ä¹ˆæ˜¯MySQLç›‘æ§ç”Ÿæ€


**ç›‘æ§ç”Ÿæ€çš„æœ¬è´¨**ï¼šMySQLç›‘æ§ä¸æ˜¯ç®€å•åœ°çœ‹çœ‹æœåŠ¡å™¨çŠ¶æ€ï¼Œè€Œæ˜¯å»ºç«‹ä¸€å¥—**å®Œæ•´çš„å¥åº·æ£€æŸ¥ä½“ç³»**ï¼Œå°±åƒç»™æ•°æ®åº“åšä½“æ£€ä¸€æ ·ã€‚

```
ä¼ ç»Ÿç›‘æ§æ–¹å¼çš„é—®é¢˜ï¼š
âŒ åªçœ‹åŸºç¡€æŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€ç£ç›˜
âŒ ç¼ºä¹ä¸šåŠ¡å…³è”ï¼šä¸çŸ¥é“æ…¢åœ¨å“ªé‡Œ
âŒ äº‹åå‘ç°é—®é¢˜ï¼šç”¨æˆ·å·²ç»å—å½±å“
âŒ å‘Šè­¦ä¸ç²¾å‡†ï¼šè¦ä¹ˆä¸å“ï¼Œè¦ä¹ˆè¯¯æŠ¥

ç°ä»£ç›‘æ§ç”Ÿæ€çš„ä¼˜åŠ¿ï¼š
âœ… å…¨æ–¹ä½æŒ‡æ ‡ï¼šä»ç³»ç»Ÿåˆ°ä¸šåŠ¡å±‚é¢
âœ… å®æ—¶æ•°æ®é‡‡é›†ï¼šé—®é¢˜å‘ç”Ÿç«‹å³æ„ŸçŸ¥  
âœ… æ™ºèƒ½å‘Šè­¦ï¼šç²¾å‡†å®šä½é—®é¢˜æ ¹å› 
âœ… å¯è§†åŒ–åˆ†æï¼šè¶‹åŠ¿é¢„æµ‹å’Œå®¹é‡è§„åˆ’
```

### 1.2 Prometheus + mysqld_exporteræ¶æ„åŸç†


**æ•´ä½“æ¶æ„å›¾ç¤º**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç›‘æ§æ•°æ®æµè½¬                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  MySQL Server â†â†’ mysqld_exporter â†â†’ Prometheus          â”‚
â”‚      â†“                â†“                â†“                â”‚
â”‚   åŸå§‹æ•°æ®         æŒ‡æ ‡è½¬æ¢         æ•°æ®å­˜å‚¨              â”‚
â”‚                                                         â”‚
â”‚  Prometheus â†â†’ Alertmanager â†â†’ å‘Šè­¦é€šçŸ¥                â”‚
â”‚      â†“                                                  â”‚
â”‚   Grafana å¯è§†åŒ–å±•ç¤º                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶ä½œç”¨**ï¼š
- **MySQL Server**ï¼šæ•°æ®çš„æºå¤´ï¼Œæä¾›å„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯
- **mysqld_exporter**ï¼šä¸“é—¨çš„"ç¿»è¯‘å®˜"ï¼ŒæŠŠMySQLçŠ¶æ€è½¬æˆPrometheusèƒ½ç†è§£çš„æ ¼å¼
- **Prometheus**ï¼šæ•°æ®çš„"ä»“åº“ç®¡ç†å‘˜"ï¼Œå®šæ—¶æ”¶é›†ã€å­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®
- **Grafana**ï¼šæ•°æ®çš„"å±•ç¤ºå‘˜"ï¼ŒæŠŠæ¯ç‡¥çš„æ•°å­—å˜æˆç›´è§‚çš„å›¾è¡¨
- **Alertmanager**ï¼šç³»ç»Ÿçš„"æŠ¥è­¦å‘˜"ï¼Œå‘ç°å¼‚å¸¸ç«‹å³é€šçŸ¥è¿ç»´äººå‘˜

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒåŒ»é™¢ä½“æ£€ä¸€æ ·ï¼ŒMySQLæ˜¯ç—…äººï¼Œmysqld_exporteræ˜¯æ£€æŸ¥è®¾å¤‡ï¼ŒPrometheusæ˜¯ç—…å†ç³»ç»Ÿï¼ŒGrafanaæ˜¯æ£€æŸ¥æŠ¥å‘Šï¼ŒAlertmanageræ˜¯ç´§æ€¥å‘¼å«ç³»ç»Ÿã€‚

### 1.3 ä¸ºä»€ä¹ˆé€‰æ‹©è¿™å¥—ç»„åˆ


**æŠ€æœ¯ä¼˜åŠ¿å¯¹æ¯”**ï¼š

| å¯¹æ¯”ç»´åº¦ | **ä¼ ç»Ÿç›‘æ§** | **Prometheusç”Ÿæ€** | **ä¼˜åŠ¿è¯´æ˜** |
|---------|------------|------------------|------------|
| ğŸ¯ **æŒ‡æ ‡ä¸°å¯Œåº¦** | åŸºç¡€ç³»ç»ŸæŒ‡æ ‡ | æ•°æ®åº“ä¸“ç”¨æŒ‡æ ‡ | mysqld_exporterä¸“ä¸ºMySQLè®¾è®¡ |
| âš¡ **å®æ—¶æ€§** | åˆ†é’Ÿçº§é‡‡é›† | ç§’çº§é‡‡é›† | é—®é¢˜å‘ç°æ›´åŠæ—¶ |
| ğŸ“Š **æ•°æ®å­˜å‚¨** | å…³ç³»å‹æ•°æ®åº“ | æ—¶é—´åºåˆ—æ•°æ®åº“ | ä¸“ä¸ºç›‘æ§æ•°æ®ä¼˜åŒ– |
| ğŸ”” **å‘Šè­¦èƒ½åŠ›** | ç®€å•é˜ˆå€¼å‘Šè­¦ | å¤æ‚è§„åˆ™å¼•æ“ | æ”¯æŒå¤šç»´åº¦æ¡ä»¶åˆ¤æ–­ |
| ğŸ“ˆ **å¯è§†åŒ–** | å›ºå®šå›¾è¡¨ | çµæ´»å®šåˆ¶ | Grafanaç”Ÿæ€å¼ºå¤§ |

---

## 2. ğŸ”§ mysqld_exporterè¯¦è§£


### 2.1 mysqld_exporteræ˜¯ä»€ä¹ˆ


**ç®€å•ç†è§£**ï¼šmysqld_exporterå°±æ˜¯MySQLçš„"ä½“æ£€è®¾å¤‡"ï¼Œå®ƒä¼šå®šæœŸæ£€æŸ¥MySQLçš„å„ç§å¥åº·æŒ‡æ ‡ï¼Œç„¶åç”¨Prometheusèƒ½ç†è§£çš„è¯­è¨€æŠ¥å‘Šç»™ç›‘æ§ç³»ç»Ÿã€‚

**æ ¸å¿ƒå·¥ä½œåŸç†**ï¼š
```
å·¥ä½œæµç¨‹ï¼š
1. è¿æ¥MySQLæ•°æ®åº“
2. æ‰§è¡Œå„ç§SHOWå‘½ä»¤è·å–çŠ¶æ€ä¿¡æ¯
3. å°†MySQLçš„çŠ¶æ€æ•°æ®è½¬æ¢ä¸ºPrometheusæ ¼å¼
4. é€šè¿‡HTTPæ¥å£æš´éœ²ç»™Prometheusé‡‡é›†
```

### 2.2 æŒ‡æ ‡é‡‡é›†æœºåˆ¶è¯¦è§£


**é‡‡é›†æ–¹å¼è¯´æ˜**ï¼š
```sql
-- mysqld_exporterå®é™…æ‰§è¡Œçš„SQLå‘½ä»¤ç¤ºä¾‹
SHOW GLOBAL STATUS;           -- è·å–å…¨å±€çŠ¶æ€å˜é‡
SHOW GLOBAL VARIABLES;        -- è·å–é…ç½®å‚æ•°
SHOW PROCESSLIST;            -- è·å–å½“å‰è¿æ¥ä¿¡æ¯
SHOW ENGINE INNODB STATUS;   -- è·å–InnoDBå¼•æ“çŠ¶æ€
SELECT * FROM INFORMATION_SCHEMA.TABLES; -- è·å–è¡¨ä¿¡æ¯
```

**æ•°æ®è½¬æ¢è¿‡ç¨‹**ï¼š
```
MySQLåŸå§‹æ•°æ®ï¼š
Threads_connected: 15
Slow_queries: 1247
Innodb_buffer_pool_read_requests: 45789

è½¬æ¢ä¸ºPrometheusæ ¼å¼ï¼š
mysql_global_status_threads_connected 15
mysql_global_status_slow_queries 1247  
mysql_global_status_innodb_buffer_pool_read_requests 45789
```

### 2.3 mysqld_exporterå®‰è£…ä¸é…ç½®


**å®‰è£…æ­¥éª¤**ï¼š

<details>
<summary>ğŸ”§ ç‚¹å‡»æŸ¥çœ‹è¯¦ç»†å®‰è£…è¿‡ç¨‹</summary>

```bash
# 1. ä¸‹è½½mysqld_exporter
wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.14.0/mysqld_exporter-0.14.0.linux-amd64.tar.gz

# 2. è§£å‹å®‰è£…
tar -xzf mysqld_exporter-0.14.0.linux-amd64.tar.gz
sudo mv mysqld_exporter-0.14.0.linux-amd64/mysqld_exporter /usr/local/bin/

# 3. åˆ›å»ºç›‘æ§ç”¨æˆ·
mysql -u root -p
CREATE USER 'mysqld_exporter'@'localhost' IDENTIFIED BY 'strong_password';
GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO 'mysqld_exporter'@'localhost';
FLUSH PRIVILEGES;
```
</details>

**æ ¸å¿ƒé…ç½®æ–‡ä»¶**ï¼š
```ini
# /etc/mysqld_exporter/.mysqld_exporter.cnf
[client]
user=mysqld_exporter
password=strong_password
host=localhost
port=3306
```

**å¯åŠ¨é…ç½®**ï¼š
```bash
# åˆ›å»ºsystemdæœåŠ¡
sudo tee /etc/systemd/system/mysqld_exporter.service > /dev/null <<EOF
[Unit]
Description=MySQL Exporter
After=network.target

[Service]
Type=simple
User=prometheus
ExecStart=/usr/local/bin/mysqld_exporter \
  --config.my-cnf=/etc/mysqld_exporter/.mysqld_exporter.cnf \
  --collect.global_status \
  --collect.info_schema.innodb_metrics \
  --collect.global_variables \
  --collect.info_schema.processlist \
  --web.listen-address=0.0.0.0:9104

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start mysqld_exporter
sudo systemctl enable mysqld_exporter
```

### 2.4 è‡ªå®šä¹‰æŒ‡æ ‡é‡‡é›†


**æ‰©å±•ç›‘æ§èŒƒå›´**ï¼š
```bash
# å¯åŠ¨æ—¶æŒ‡å®šé¢å¤–çš„é‡‡é›†å™¨
/usr/local/bin/mysqld_exporter \
  --collect.auto_increment.columns=true \
  --collect.binlog_size=true \
  --collect.engine_innodb_status=true \
  --collect.global_status=true \
  --collect.global_variables=true \
  --collect.info_schema.innodb_cmp=true \
  --collect.info_schema.innodb_cmpmem=true \
  --collect.info_schema.processlist=true \
  --collect.info_schema.query_response_time=true \
  --collect.info_schema.tables=true \
  --collect.info_schema.tablestats=true \
  --collect.info_schema.userstats=true \
  --collect.slave_status=true
```

> âš ï¸ **é‡è¦æé†’**ï¼šå¼€å¯è¿‡å¤šé‡‡é›†å™¨ä¼šå¢åŠ MySQLè´Ÿæ‹…ï¼Œå»ºè®®æ ¹æ®å®é™…éœ€è¦é€‰æ‹©æ€§å¼€å¯ã€‚

---

## 3. âš™ï¸ Prometheusé›†æˆé…ç½®


### 3.1 Prometheusæ˜¯ä»€ä¹ˆ


**é€šä¿—è§£é‡Š**ï¼šPrometheuså°±åƒä¸€ä¸ªå‹¤å¥‹çš„æ•°æ®æ”¶é›†å‘˜ï¼Œå®ƒä¼šæŒ‰ç…§ä½ è®¾å®šçš„æ—¶é—´é—´éš”ï¼Œä¸»åŠ¨å»å„ä¸ªç›‘æ§ç›®æ ‡é‚£é‡Œ"é—®è¯¢"æœ€æ–°çš„çŠ¶æ€æ•°æ®ï¼Œç„¶åæ•´ç†å­˜å‚¨èµ·æ¥ã€‚

**æ—¶é—´åºåˆ—æ•°æ®çš„æ¦‚å¿µ**ï¼š
```
ä¼ ç»Ÿæ•°æ®å­˜å‚¨ï¼š
ç”¨æˆ·ID | å§“å | å¹´é¾„
1001   | å¼ ä¸‰ | 25

æ—¶é—´åºåˆ—æ•°æ®å­˜å‚¨ï¼š
æŒ‡æ ‡åç§°{æ ‡ç­¾} æ•°å€¼ æ—¶é—´æˆ³
mysql_threads_connected{instance="db1"} 15 1642740000
mysql_threads_connected{instance="db1"} 18 1642740060  
mysql_threads_connected{instance="db1"} 12 1642740120
```

### 3.2 Prometheusé…ç½®è¯¦è§£


**æ ¸å¿ƒé…ç½®æ–‡ä»¶**ï¼š
```yaml
# prometheus.yml
global:
  scrape_interval: 15s          # å…¨å±€é‡‡é›†é—´éš”
  evaluation_interval: 15s      # è§„åˆ™è¯„ä¼°é—´éš”
  
rule_files:
  - "mysql_rules.yml"           # MySQLå‘Šè­¦è§„åˆ™æ–‡ä»¶

scrape_configs:
  # MySQLç›‘æ§ä»»åŠ¡é…ç½®
  - job_name: 'mysql'
    static_configs:
      - targets: ['localhost:9104']  # mysqld_exporteråœ°å€
        labels:
          instance: 'mysql-prod-01'   # å®ä¾‹æ ‡è¯†
          environment: 'production'   # ç¯å¢ƒæ ‡è¯†
    scrape_interval: 5s              # MySQLé‡‡é›†é—´éš”ï¼ˆæ›´é¢‘ç¹ï¼‰
    scrape_timeout: 10s              # é‡‡é›†è¶…æ—¶æ—¶é—´
    metrics_path: /metrics           # æŒ‡æ ‡è·¯å¾„
    
  # å¤šå®ä¾‹MySQLç›‘æ§
  - job_name: 'mysql-cluster'
    static_configs:
      - targets: 
          - 'mysql-01:9104'
          - 'mysql-02:9104' 
          - 'mysql-03:9104'
        labels:
          cluster: 'mysql-main'
          environment: 'production'
```

**é…ç½®å‚æ•°è¯¦è§£**ï¼š

| å‚æ•° | **ä½œç”¨** | **æ¨èå€¼** | **è¯´æ˜** |
|------|---------|----------|---------|
| `scrape_interval` | æ•°æ®é‡‡é›†é¢‘ç‡ | `5s-15s` | MySQLç›‘æ§å»ºè®®æ›´é¢‘ç¹ |
| `scrape_timeout` | é‡‡é›†è¶…æ—¶æ—¶é—´ | `10s` | é¿å…é‡‡é›†é˜»å¡ |
| `evaluation_interval` | å‘Šè­¦è§„åˆ™è¯„ä¼°é¢‘ç‡ | `15s` | ä¸é‡‡é›†é—´éš”åŒæ­¥ |
| `labels` | å®ä¾‹æ ‡ç­¾ | è‡ªå®šä¹‰ | ç”¨äºåŒºåˆ†ä¸åŒå®ä¾‹ |

### 3.3 ç›‘æ§æ•°æ®å­˜å‚¨ç­–ç•¥


**å­˜å‚¨é…ç½®ä¼˜åŒ–**ï¼š
```yaml
# prometheus.yml å­˜å‚¨é…ç½®
global:
  external_labels:
    monitor: 'mysql-monitor'
    region: 'cn-beijing'

# æ•°æ®ä¿ç•™ç­–ç•¥
storage:
  tsdb:
    retention.time: 30d           # ä¿ç•™30å¤©æ•°æ®
    retention.size: 50GB          # æœ€å¤§å­˜å‚¨50GB
    wal-compression: true         # å¼€å¯WALå‹ç¼©
```

**æ•°æ®å‹ç¼©ç­–ç•¥**ï¼š
```bash
# å¯åŠ¨Prometheusæ—¶çš„å­˜å‚¨ä¼˜åŒ–å‚æ•°
./prometheus \
  --config.file=prometheus.yml \
  --storage.tsdb.path=/data/prometheus \
  --storage.tsdb.retention.time=30d \
  --storage.tsdb.retention.size=50GB \
  --storage.tsdb.wal-compression \
  --web.console.libraries=/etc/prometheus/console_libraries \
  --web.console.templates=/etc/prometheus/consoles \
  --web.listen-address=0.0.0.0:9090
```

---

## 4. ğŸ“Š æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è¯¦è§£


### 4.1 è¿æ¥ç›¸å…³æŒ‡æ ‡


**è¿æ¥çŠ¶æ€ç›‘æ§**ï¼š
```
æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜ï¼š

mysql_global_status_threads_connected
â†“ å«ä¹‰ï¼šå½“å‰æ´»è·ƒè¿æ¥æ•°
â†“ é‡è¦æ€§ï¼šè¿æ¥æ•°è¿‡é«˜å¯èƒ½å¯¼è‡´æ•°æ®åº“æ— å“åº”
â†“ æ­£å¸¸èŒƒå›´ï¼šæ ¹æ®max_connectionsçš„70%ä»¥å†…

mysql_global_status_threads_running  
â†“ å«ä¹‰ï¼šæ­£åœ¨æ‰§è¡ŒSQLçš„çº¿ç¨‹æ•°
â†“ é‡è¦æ€§ï¼šé«˜å¹¶å‘æ—¶çš„æ€§èƒ½ç“¶é¢ˆæŒ‡æ ‡
â†“ æ­£å¸¸èŒƒå›´ï¼šCPUæ ¸å¿ƒæ•°çš„2-4å€ä»¥å†…

mysql_global_status_connection_errors_total
â†“ å«ä¹‰ï¼šè¿æ¥é”™è¯¯æ€»æ•°
â†“ é‡è¦æ€§ï¼šç½‘ç»œæˆ–é…ç½®é—®é¢˜çš„é‡è¦æŒ‡æ ‡
â†“ å‘Šè­¦æ¡ä»¶ï¼šå¿«é€Ÿå¢é•¿æ—¶éœ€è¦å…³æ³¨
```

**å®é™…ç›‘æ§ç¤ºä¾‹**ï¼š
```promql
# æŸ¥çœ‹å½“å‰è¿æ¥æ•°
mysql_global_status_threads_connected

# æŸ¥çœ‹è¿æ¥æ•°ä½¿ç”¨ç‡
(mysql_global_status_threads_connected / mysql_global_variables_max_connections) * 100

# æŸ¥çœ‹è¿æ¥é”™è¯¯è¶‹åŠ¿
rate(mysql_global_status_connection_errors_total[5m])
```

### 4.2 æŸ¥è¯¢æ€§èƒ½æŒ‡æ ‡


**æŸ¥è¯¢æ•ˆç‡ç›‘æ§**ï¼š
```
mysql_global_status_queries
â†“ å«ä¹‰ï¼šæ€»æŸ¥è¯¢æ¬¡æ•°ï¼ˆåŒ…æ‹¬æ‰€æœ‰SQLè¯­å¥ï¼‰
â†“ ç›‘æ§ç›®çš„ï¼šäº†è§£æ•°æ®åº“æ•´ä½“è´Ÿè½½

mysql_global_status_slow_queries
â†“ å«ä¹‰ï¼šæ…¢æŸ¥è¯¢æ€»æ•°  
â†“ é‡è¦æ€§ï¼šç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒ
â†“ å‘Šè­¦æ¡ä»¶ï¼šå¢é•¿ç‡è¶…è¿‡é˜ˆå€¼

mysql_global_status_select_full_join
â†“ å«ä¹‰ï¼šå…¨è¡¨è¿æ¥æŸ¥è¯¢æ¬¡æ•°
â†“ é‡è¦æ€§ï¼šæ€§èƒ½æ€æ‰‹ï¼Œå¿…é¡»é‡ç‚¹ç›‘æ§
â†“ ç†æƒ³çŠ¶æ€ï¼šåº”è¯¥ä¸º0æˆ–æ¥è¿‘0
```

**æŸ¥è¯¢æ€§èƒ½åˆ†æ**ï¼š
```promql
# æ¯ç§’æŸ¥è¯¢æ•°(QPS)
rate(mysql_global_status_queries[1m])

# æ…¢æŸ¥è¯¢å¢é•¿ç‡
rate(mysql_global_status_slow_queries[5m])

# å…¨è¡¨æ‰«ææ¯”ä¾‹
rate(mysql_global_status_select_scan[5m]) / rate(mysql_global_status_select_full_join[5m]) * 100
```

### 4.3 InnoDBå­˜å‚¨å¼•æ“æŒ‡æ ‡


**ç¼“å†²æ± ç›‘æ§**ï¼š
```
mysql_global_status_innodb_buffer_pool_read_requests
â†“ å«ä¹‰ï¼šç¼“å†²æ± è¯»å–è¯·æ±‚æ€»æ•°
â†“ ä½œç”¨ï¼šè¡¡é‡æ•°æ®è®¿é—®é¢‘ç‡

mysql_global_status_innodb_buffer_pool_reads  
â†“ å«ä¹‰ï¼šä»ç£ç›˜è¯»å–é¡µé¢çš„æ¬¡æ•°
â†“ é‡è¦æ€§ï¼šç‰©ç†è¯»å–å½±å“æ€§èƒ½

ç¼“å†²æ± å‘½ä¸­ç‡è®¡ç®—å…¬å¼ï¼š
å‘½ä¸­ç‡ = (1 - ç‰©ç†è¯»å–æ¬¡æ•°/è¯»å–è¯·æ±‚æ€»æ•°) Ã— 100%
ç†æƒ³å€¼ï¼š> 95%
```

**InnoDBé”ç›‘æ§**ï¼š
```
mysql_global_status_innodb_row_lock_waits
â†“ å«ä¹‰ï¼šè¡Œé”ç­‰å¾…æ¬¡æ•°
â†“ é—®é¢˜ï¼šé¢‘ç¹é”ç­‰å¾…å½±å“å¹¶å‘æ€§èƒ½

mysql_global_status_innodb_row_lock_time
â†“ å«ä¹‰ï¼šè¡Œé”ç­‰å¾…æ€»æ—¶é—´(æ¯«ç§’)  
â†“ è®¡ç®—ï¼šå¹³å‡é”ç­‰å¾…æ—¶é—´ = æ€»æ—¶é—´/ç­‰å¾…æ¬¡æ•°
```

### 4.4 å¤åˆ¶ç›‘æ§æŒ‡æ ‡


**ä¸»ä»å¤åˆ¶å¥åº·åº¦**ï¼š
```
mysql_slave_lag_seconds
â†“ å«ä¹‰ï¼šä»åº“å»¶è¿Ÿæ—¶é—´(ç§’)
â†“ é‡è¦æ€§ï¼šå»¶è¿Ÿè¿‡å¤§å½±å“è¯»å†™åˆ†ç¦»æ•ˆæœ  
â†“ å‘Šè­¦é˜ˆå€¼ï¼šé€šå¸¸è®¾ç½®ä¸º30ç§’

mysql_slave_sql_running
â†“ å«ä¹‰ï¼šSQLçº¿ç¨‹è¿è¡ŒçŠ¶æ€ (1=è¿è¡Œ, 0=åœæ­¢)
â†“ é‡è¦æ€§ï¼šSQLçº¿ç¨‹åœæ­¢æ„å‘³ç€å¤åˆ¶ä¸­æ–­

mysql_slave_io_running  
â†“ å«ä¹‰ï¼šIOçº¿ç¨‹è¿è¡ŒçŠ¶æ€
â†“ é‡è¦æ€§ï¼šIOçº¿ç¨‹åœæ­¢æ— æ³•æ¥æ”¶ä¸»åº“binlog
```

---

## 5. ğŸ”” å‘Šè­¦è§„åˆ™é…ç½®


### 5.1 å‘Šè­¦è§„åˆ™è®¾è®¡åŸåˆ™


**å‘Šè­¦åˆ†çº§ç­–ç•¥**ï¼š
```
ğŸ”´ P0çº§å‘Šè­¦ï¼ˆç«‹å³å¤„ç†ï¼‰ï¼š
- æ•°æ®åº“æ— æ³•è¿æ¥
- ä¸»ä»å¤åˆ¶ä¸­æ–­  
- ç£ç›˜ç©ºé—´ä¸è¶³5%
- è¿æ¥æ•°è¶…è¿‡90%

ğŸŸ¡ P1çº§å‘Šè­¦ï¼ˆ1å°æ—¶å†…å¤„ç†ï¼‰ï¼š
- æ…¢æŸ¥è¯¢å¢é•¿å¼‚å¸¸
- ç¼“å†²æ± å‘½ä¸­ç‡ä½äº90%
- ä»åº“å»¶è¿Ÿè¶…è¿‡60ç§’

ğŸŸ¢ P2çº§å‘Šè­¦ï¼ˆå·¥ä½œæ—¶é—´å¤„ç†ï¼‰ï¼š  
- è¡¨é”ç­‰å¾…æ—¶é—´è¿‡é•¿
- ä¸´æ—¶è¡¨ä½¿ç”¨é¢‘ç¹
- äºŒè¿›åˆ¶æ—¥å¿—å¢é•¿è¿‡å¿«
```

### 5.2 æ ¸å¿ƒå‘Šè­¦è§„åˆ™é…ç½®


**mysql_rules.yml å‘Šè­¦è§„åˆ™**ï¼š
```yaml
groups:
- name: mysql.rules
  rules:
  
  # æ•°æ®åº“è¿æ¥å‘Šè­¦
  - alert: MySQLDown
    expr: mysql_up == 0
    for: 0m
    labels:
      severity: critical
    annotations:
      summary: "MySQLå®ä¾‹ {{ $labels.instance }} æ— æ³•è¿æ¥"
      description: "MySQLæœåŠ¡å™¨å·²ç»å®•æœºè¶…è¿‡0åˆ†é’Ÿ"
      
  # è¿æ¥æ•°è¿‡é«˜å‘Šè­¦  
  - alert: MySQLTooManyConnections
    expr: (mysql_global_status_threads_connected / mysql_global_variables_max_connections) * 100 > 90
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "MySQLè¿æ¥æ•°è¿‡é«˜"
      description: "å®ä¾‹ {{ $labels.instance }} è¿æ¥æ•°ä½¿ç”¨ç‡: {{ $value }}%"
      
  # æ…¢æŸ¥è¯¢å¢é•¿å‘Šè­¦
  - alert: MySQLSlowQueries  
    expr: rate(mysql_global_status_slow_queries[5m]) > 0.2
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "MySQLæ…¢æŸ¥è¯¢å¢é•¿å¼‚å¸¸"
      description: "å®ä¾‹ {{ $labels.instance }} æ…¢æŸ¥è¯¢å¢é•¿ç‡: {{ $value }}/ç§’"
      
  # å¤åˆ¶å»¶è¿Ÿå‘Šè­¦
  - alert: MySQLReplicationLag
    expr: mysql_slave_lag_seconds > 30
    for: 1m  
    labels:
      severity: critical
    annotations:
      summary: "MySQLå¤åˆ¶å»¶è¿Ÿè¿‡é«˜"
      description: "ä»åº“ {{ $labels.instance }} å»¶è¿Ÿ: {{ $value }}ç§’"
      
  # ç¼“å†²æ± å‘½ä¸­ç‡å‘Šè­¦
  - alert: MySQLInnoDBBufferPoolHitRate
    expr: |
      (
        rate(mysql_global_status_innodb_buffer_pool_read_requests[5m]) - 
        rate(mysql_global_status_innodb_buffer_pool_reads[5m])
      ) / rate(mysql_global_status_innodb_buffer_pool_read_requests[5m]) * 100 < 90
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "InnoDBç¼“å†²æ± å‘½ä¸­ç‡è¿‡ä½" 
      description: "å®ä¾‹ {{ $labels.instance }} ç¼“å†²æ± å‘½ä¸­ç‡: {{ $value }}%"
```

### 5.3 å‘Šè­¦é€šçŸ¥é…ç½®


**Alertmanageré…ç½®**ï¼š
```yaml
# alertmanager.yml
global:
  smtp_smarthost: 'smtp.company.com:587'
  smtp_from: 'alerts@company.com'

route:
  group_by: ['alertname', 'cluster']
  group_wait: 10s
  group_interval: 10s  
  repeat_interval: 1h
  receiver: 'web.hook'
  
receivers:
- name: 'web.hook'
  email_configs:
  - to: 'dba-team@company.com'
    subject: '[MySQLå‘Šè­¦] {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'
    body: |
      {{ range .Alerts }}
      å‘Šè­¦è¯¦æƒ…:
      - å®ä¾‹: {{ .Labels.instance }}
      - å‘Šè­¦: {{ .Annotations.summary }}
      - æè¿°: {{ .Annotations.description }}
      - æ—¶é—´: {{ .StartsAt }}
      {{ end }}
```

---

## 6. ğŸ“ˆ Grafanaå¯è§†åŒ–å®æˆ˜


### 6.1 Grafana Dashboardè®¾è®¡


**Dashboardæ¶æ„è®¾è®¡**ï¼š
```
MySQL Overview Dashboard ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ æ ¸å¿ƒçŠ¶æ€é¢æ¿ï¼ˆé¡¶éƒ¨ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿æ¥çŠ¶æ€ | QPS/TPS | å“åº”æ—¶é—´ | é”™è¯¯ç‡    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š æ€§èƒ½åˆ†æé¢æ¿ï¼ˆä¸­éƒ¨ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ…¢æŸ¥è¯¢è¶‹åŠ¿ | é”ç­‰å¾… | ç¼“å†²æ± çŠ¶æ€          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  
â”‚ ğŸ” ç³»ç»Ÿèµ„æºé¢æ¿ï¼ˆåº•éƒ¨ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CPUä½¿ç”¨ç‡ | å†…å­˜ | ç£ç›˜I/O | ç½‘ç»œæµé‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ ¸å¿ƒPanelé…ç½®


**è¿æ¥çŠ¶æ€ç›‘æ§é¢æ¿**ï¼š
```json
{
  "title": "MySQLè¿æ¥çŠ¶æ€",
  "type": "stat",
  "targets": [
    {
      "expr": "mysql_global_status_threads_connected",
      "legendFormat": "å½“å‰è¿æ¥æ•°"
    },
    {
      "expr": "mysql_global_variables_max_connections", 
      "legendFormat": "æœ€å¤§è¿æ¥æ•°"
    }
  ],
  "fieldConfig": {
    "defaults": {
      "color": {
        "mode": "thresholds"
      },
      "thresholds": {
        "steps": [
          {"color": "green", "value": null},
          {"color": "yellow", "value": 100},
          {"color": "red", "value": 200}
        ]
      }
    }
  }
}
```

**æ€§èƒ½æŒ‡æ ‡å›¾è¡¨**ï¼š
```json
{
  "title": "QPS/TPSè¶‹åŠ¿",
  "type": "graph", 
  "targets": [
    {
      "expr": "rate(mysql_global_status_queries[1m])",
      "legendFormat": "QPS - {{instance}}"
    },
    {
      "expr": "rate(mysql_global_status_com_commit[1m]) + rate(mysql_global_status_com_rollback[1m])",
      "legendFormat": "TPS - {{instance}}"  
    }
  ],
  "yAxes": [
    {
      "label": "æ¯ç§’æ“ä½œæ•°",
      "min": 0
    }
  ]
}
```

### 6.3 è‡ªå®šä¹‰Dashboardæ¨¡æ¿


**å¯¼å…¥Dashboard JSON**ï¼š
```json
{
  "dashboard": {
    "id": null,
    "title": "MySQLæ•°æ®åº“ç›‘æ§",
    "tags": ["mysql", "database"],
    "timezone": "browser",
    "panels": [
      {
        "id": 1,
        "title": "æ•°æ®åº“çŠ¶æ€æ¦‚è§ˆ",
        "type": "row",
        "collapsed": false,
        "panels": []
      }
    ],
    "templating": {
      "list": [
        {
          "name": "instance",
          "type": "query", 
          "query": "label_values(mysql_up, instance)",
          "current": {
            "text": "All",
            "value": "$__all"
          }
        }
      ]
    },
    "time": {
      "from": "now-1h",
      "to": "now"
    }
  }
}
```

---

## 7. ğŸ—ï¸ é›†ç¾¤ç›‘æ§æ–¹æ¡ˆ


### 7.1 MySQLé›†ç¾¤æ¶æ„ç›‘æ§


**å¤šå®ä¾‹ç›‘æ§é…ç½®**ï¼š
```yaml
# prometheus.yml - é›†ç¾¤ç›‘æ§é…ç½®
scrape_configs:
  # MySQLä¸»åº“ç›‘æ§
  - job_name: 'mysql-master'
    static_configs:
      - targets: ['mysql-master:9104']
        labels:
          role: 'master'
          cluster: 'mysql-prod'
          
  # MySQLä»åº“ç›‘æ§  
  - job_name: 'mysql-slaves'
    static_configs:
      - targets: 
          - 'mysql-slave-01:9104'
          - 'mysql-slave-02:9104'
          - 'mysql-slave-03:9104'
        labels:
          role: 'slave'
          cluster: 'mysql-prod'
          
  # MySQLä»£ç†ç›‘æ§
  - job_name: 'mysql-proxy'
    static_configs:
      - targets: ['proxysql:9104'] 
        labels:
          role: 'proxy'
          cluster: 'mysql-prod'
```

### 7.2 é›†ç¾¤å¥åº·åº¦ç›‘æ§


**é›†ç¾¤çŠ¶æ€æ£€æŸ¥è§„åˆ™**ï¼š
```yaml
# é›†ç¾¤å‘Šè­¦è§„åˆ™
groups:
- name: mysql-cluster.rules
  rules:
  
  # ä¸»åº“å®•æœºå‘Šè­¦
  - alert: MySQLMasterDown
    expr: mysql_up{role="master"} == 0
    for: 0m
    labels:
      severity: critical
    annotations:
      summary: "MySQLä¸»åº“å®•æœº"
      description: "ä¸»åº“ {{ $labels.instance }} å·²å®•æœº"
      
  # ä»åº“æ•°é‡æ£€æŸ¥
  - alert: MySQLSlaveCount
    expr: count(mysql_up{role="slave"} == 1) < 2
    for: 1m
    labels:
      severity: warning  
    annotations:
      summary: "MySQLä»åº“æ•°é‡ä¸è¶³"
      description: "å¯ç”¨ä»åº“æ•°é‡: {{ $value }}"
      
  # é›†ç¾¤å¤åˆ¶ä¸€è‡´æ€§æ£€æŸ¥
  - alert: MySQLReplicationConsistency
    expr: |
      (
        mysql_global_status_executed_gtid_set{role="master"} - 
        mysql_global_status_executed_gtid_set{role="slave"}
      ) > 1000
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "ä¸»ä»æ•°æ®ä¸ä¸€è‡´"
      description: "GTIDå·®å¼‚è¿‡å¤§: {{ $value }}"
```

### 7.3 å®¹é‡è§„åˆ’ç›‘æ§


**èµ„æºä½¿ç”¨è¶‹åŠ¿åˆ†æ**ï¼š
```promql
# è¿æ¥æ•°å¢é•¿è¶‹åŠ¿é¢„æµ‹
predict_linear(mysql_global_status_threads_connected[1h], 4*3600) 

# ç£ç›˜ç©ºé—´å¢é•¿é¢„æµ‹  
predict_linear(mysql_global_status_innodb_data_fsyncs[1h], 24*3600)

# QPSå¢é•¿è¶‹åŠ¿
avg_over_time(rate(mysql_global_status_queries[5m])[7d:1h])
```

---

## 8. ğŸ¤– è¿ç»´è‡ªåŠ¨åŒ–é›†æˆ


### 8.1 è‡ªåŠ¨åŒ–å‘Šè­¦å“åº”


**å‘Šè­¦è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹**ï¼š
```
å‘Šè­¦è§¦å‘ â†’ Webhooké€šçŸ¥ â†’ è‡ªåŠ¨åŒ–è„šæœ¬ â†’ é—®é¢˜è¯Šæ–­ â†’ è‡ªåŠ¨ä¿®å¤/äººå·¥ä»‹å…¥

å®ç°æ–¹æ¡ˆï¼š
1. Alertmanager webhooké…ç½®
2. è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™  
3. é—®é¢˜è¯Šæ–­é€»è¾‘
4. ä¿®å¤æ“ä½œæ‰§è¡Œ
5. ç»“æœåé¦ˆé€šçŸ¥
```

**è‡ªåŠ¨åŒ–è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# mysql-auto-recovery.sh

ALERT_NAME="$1"
INSTANCE="$2"

case "$ALERT_NAME" in
  "MySQLTooManyConnections")
    echo "å¤„ç†è¿æ¥æ•°è¿‡é«˜é—®é¢˜..."
    # æŸ¥æ‰¾é•¿æ—¶é—´è¿è¡Œçš„æŸ¥è¯¢
    mysql -h $INSTANCE -e "SHOW PROCESSLIST" | grep "Query" | awk '{if($6>300) print "KILL "$1";"}'
    ;;
    
  "MySQLSlowQueries") 
    echo "åˆ†ææ…¢æŸ¥è¯¢é—®é¢˜..."
    # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ
    mysql -h $INSTANCE -e "SET GLOBAL slow_query_log = 1"
    # å‘é€æ…¢æŸ¥è¯¢æŠ¥å‘Š
    mysqldumpslow /var/log/mysql/slow.log | mail -s "æ…¢æŸ¥è¯¢æŠ¥å‘Š" dba@company.com
    ;;
    
  "MySQLReplicationLag")
    echo "ä¿®å¤å¤åˆ¶å»¶è¿Ÿ..."  
    # æ£€æŸ¥å¤åˆ¶çŠ¶æ€
    mysql -h $INSTANCE -e "SHOW SLAVE STATUS\G" 
    # å°è¯•é‡å¯å¤åˆ¶
    mysql -h $INSTANCE -e "STOP SLAVE; START SLAVE;"
    ;;
esac
```

### 8.2 ç›‘æ§æ•°æ®åˆ†æ


**æ€§èƒ½è¶‹åŠ¿åˆ†æ**ï¼š
```python
#!/usr/bin/env python3
# mysql_performance_analyzer.py

import requests
import json
from datetime import datetime, timedelta

class MySQLAnalyzer:
    def __init__(self, prometheus_url):
        self.prometheus_url = prometheus_url
        
    def get_metric_data(self, query, hours=24):
        """è·å–æŒ‡æ ‡æ•°æ®"""
        end_time = datetime.now()
        start_time = end_time - timedelta(hours=hours)
        
        params = {
            'query': query,
            'start': start_time.isoformat(),
            'end': end_time.isoformat(), 
            'step': '1m'
        }
        
        response = requests.get(f'{self.prometheus_url}/api/v1/query_range', params=params)
        return response.json()
        
    def analyze_performance_trend(self):
        """åˆ†ææ€§èƒ½è¶‹åŠ¿"""
        # QPSè¶‹åŠ¿åˆ†æ
        qps_data = self.get_metric_data('rate(mysql_global_status_queries[5m])')
        
        # è¿æ¥æ•°è¶‹åŠ¿åˆ†æ  
        conn_data = self.get_metric_data('mysql_global_status_threads_connected')
        
        # ç”Ÿæˆåˆ†ææŠ¥å‘Š
        report = {
            'qps_avg': self.calculate_average(qps_data),
            'qps_peak': self.find_peak_value(qps_data),
            'conn_avg': self.calculate_average(conn_data), 
            'recommendations': self.generate_recommendations()
        }
        
        return report
        
    def generate_recommendations(self):
        """ç”Ÿæˆä¼˜åŒ–å»ºè®®"""
        recommendations = []
        
        # åŸºäºæ•°æ®ç”Ÿæˆå»ºè®®
        recommendations.append("å»ºè®®ä¼˜åŒ–æ…¢æŸ¥è¯¢")
        recommendations.append("å»ºè®®è°ƒæ•´ç¼“å†²æ± å¤§å°")
        
        return recommendations

# ä½¿ç”¨ç¤ºä¾‹
analyzer = MySQLAnalyzer('http://localhost:9090')
report = analyzer.analyze_performance_trend()
print(json.dumps(report, indent=2, ensure_ascii=False))
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§ç”Ÿæ€ï¼šPrometheus + mysqld_exporter + Grafanaçš„å®Œæ•´é“¾è·¯
ğŸ”¸ æŒ‡æ ‡é‡‡é›†ï¼šmysqld_exporterå°†MySQLçŠ¶æ€è½¬æ¢ä¸ºæ—¶é—´åºåˆ—æ•°æ®  
ğŸ”¸ æ•°æ®å­˜å‚¨ï¼šPrometheusçš„æ—¶é—´åºåˆ—æ•°æ®åº“å­˜å‚¨æœºåˆ¶
ğŸ”¸ å‘Šè­¦æœºåˆ¶ï¼šåŸºäºè§„åˆ™çš„æ™ºèƒ½å‘Šè­¦å’Œåˆ†çº§å¤„ç†
ğŸ”¸ å¯è§†åŒ–å±•ç¤ºï¼šGrafanaçš„çµæ´»å›¾è¡¨é…ç½®å’ŒDashboardè®¾è®¡
ğŸ”¸ é›†ç¾¤ç›‘æ§ï¼šå¤šå®ä¾‹ã€ä¸»ä»ã€ä»£ç†çš„ç»Ÿä¸€ç›‘æ§æ–¹æ¡ˆ
ğŸ”¸ è‡ªåŠ¨åŒ–è¿ç»´ï¼šå‘Šè­¦å“åº”è‡ªåŠ¨åŒ–å’Œæ€§èƒ½åˆ†æè‡ªåŠ¨åŒ–
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ç›‘æ§ä¸æ˜¯ç›®çš„ï¼Œé¢„é˜²æ‰æ˜¯æ ¸å¿ƒ**
```
ç›‘æ§çš„ä»·å€¼é“¾ï¼š
æ•°æ®é‡‡é›† â†’ è¶‹åŠ¿åˆ†æ â†’ é—®é¢˜é¢„è­¦ â†’ è‡ªåŠ¨ä¿®å¤ â†’ å®¹é‡è§„åˆ’

é‡ç‚¹ç†è§£ï¼š
- ç›‘æ§æ˜¯ä¸ºäº†æ›´æ—©å‘ç°é—®é¢˜
- å‘Šè­¦æ˜¯ä¸ºäº†å¿«é€Ÿå“åº”å¤„ç†  
- åˆ†ææ˜¯ä¸ºäº†æŒç»­ä¼˜åŒ–æ”¹è¿›
- è‡ªåŠ¨åŒ–æ˜¯ä¸ºäº†å‡å°‘äººå·¥å¹²é¢„
```

**ğŸ”¹ æŒ‡æ ‡é€‰æ‹©çš„ä¼˜å…ˆçº§**
```
P0çº§æŒ‡æ ‡ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰ï¼š
âœ… æ•°æ®åº“å¯ç”¨æ€§ï¼šmysql_up
âœ… è¿æ¥çŠ¶æ€ï¼šthreads_connected
âœ… æŸ¥è¯¢æ€§èƒ½ï¼šQPS/æ…¢æŸ¥è¯¢
âœ… å¤åˆ¶çŠ¶æ€ï¼šslave_lag_seconds

P1çº§æŒ‡æ ‡ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š
ğŸ”¸ ç¼“å†²æ± å‘½ä¸­ç‡ï¼šinnodb_buffer_poolç›¸å…³
ğŸ”¸ é”ç­‰å¾…çŠ¶æ€ï¼šinnodb_row_lockç›¸å…³  
ğŸ”¸ ç£ç›˜I/Oï¼šinnodb_data_reads/writes
ğŸ”¸ ä¸´æ—¶è¡¨ä½¿ç”¨ï¼šcreated_tmp_tables

P2çº§æŒ‡æ ‡ï¼ˆæ·±åº¦åˆ†æï¼‰ï¼š
ğŸ”¹ è¡¨ç©ºé—´ä½¿ç”¨ï¼šinformation_schemaç›¸å…³
ğŸ”¹ ç”¨æˆ·è¿æ¥ç»Ÿè®¡ï¼šprocesslistç›¸å…³
ğŸ”¹ æŸ¥è¯¢ç¼“å­˜ï¼šquery_cacheç›¸å…³
```

**ğŸ”¹ å‘Šè­¦è§„åˆ™è®¾è®¡çš„å¹³è¡¡**
```
é¿å…å‘Šè­¦ç–²åŠ³ï¼š
âŒ é˜ˆå€¼è¿‡äºæ•æ„Ÿ â†’ å¤§é‡è¯¯æŠ¥
âŒ å‘Šè­¦è¿‡äºé¢‘ç¹ â†’ è¿ç»´éº»ç—¹  
âŒ ä¿¡æ¯ä¸å¤Ÿè¯¦ç»† â†’ æ— æ³•å®šä½

ç†æƒ³å‘Šè­¦ç‰¹å¾ï¼š
âœ… ç²¾å‡†è§¦å‘ï¼šçœŸæ­£æœ‰é—®é¢˜æ‰å‘Šè­¦
âœ… ä¿¡æ¯å®Œæ•´ï¼šåŒ…å«è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡
âœ… åˆ†çº§å¤„ç†ï¼šä¸åŒçº§åˆ«ä¸åŒå“åº”
âœ… è‡ªåŠ¨æ¢å¤ï¼šé—®é¢˜è§£å†³åè‡ªåŠ¨æ¸…é™¤
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ“Š éƒ¨ç½²å»ºè®®**
- **å°å‹ç¯å¢ƒ**ï¼šå•æœºPrometheus + Grafanaï¼Œé‡ç‚¹ç›‘æ§æ ¸å¿ƒæŒ‡æ ‡
- **ä¸­å‹ç¯å¢ƒ**ï¼šPrometheusé›†ç¾¤ + å‘Šè­¦ç®¡ç†ï¼Œå¢åŠ è‡ªåŠ¨åŒ–è„šæœ¬  
- **å¤§å‹ç¯å¢ƒ**ï¼šå®Œæ•´ç›‘æ§ç”Ÿæ€ + æ•°æ®åˆ†æå¹³å°ï¼Œæ·±åº¦é›†æˆè¿ç»´æµç¨‹

**ğŸ”§ ä¼˜åŒ–ç­–ç•¥**
- **é‡‡é›†é¢‘ç‡**ï¼šæ ¹æ®ä¸šåŠ¡é‡è¦æ€§è°ƒæ•´ï¼Œæ ¸å¿ƒæŒ‡æ ‡5ç§’ï¼Œä¸€èˆ¬æŒ‡æ ‡15ç§’
- **æ•°æ®ä¿ç•™**ï¼šçƒ­æ•°æ®30å¤©ï¼Œå†·æ•°æ®6ä¸ªæœˆï¼Œå½’æ¡£1å¹´ä»¥ä¸Š
- **å‘Šè­¦åˆ†çº§**ï¼šP0ç«‹å³é€šçŸ¥ï¼ŒP1å·¥ä½œæ—¶é—´ï¼ŒP2å®šæœŸæ±‡æ€»

**ğŸš€ è¿›é˜¶æ–¹å‘**
- **æœºå™¨å­¦ä¹ **ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹å¼‚å¸¸å’Œå®¹é‡éœ€æ±‚
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šå‘Šè­¦è§¦å‘è‡ªåŠ¨è¯Šæ–­å’Œä¿®å¤æµç¨‹
- **ä¸šåŠ¡å…³è”**ï¼šç›‘æ§æ•°æ®ä¸ä¸šåŠ¡æŒ‡æ ‡çš„å…³è”åˆ†æ

### 9.4 å¸¸è§é—®é¢˜ä¸è§£å†³


**â“ mysqld_exporterè¿æ¥é—®é¢˜**
```bash
# æ£€æŸ¥è¿æ¥é…ç½®
mysql -u mysqld_exporter -p -h localhost -e "SHOW VARIABLES LIKE 'max_connections'"

# æ£€æŸ¥æƒé™è®¾ç½®
SHOW GRANTS FOR 'mysqld_exporter'@'localhost';

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
journalctl -u mysqld_exporter -f
```

**â“ Prometheusæ•°æ®ç¼ºå¤±**  
```bash
# æ£€æŸ¥TargetçŠ¶æ€
curl http://localhost:9090/api/v1/targets

# éªŒè¯æŒ‡æ ‡å¯è®¿é—®æ€§
curl http://localhost:9104/metrics | grep mysql_up

# æ£€æŸ¥é…ç½®è¯­æ³•
./promtool check config prometheus.yml
```

**â“ å‘Šè­¦ä¸è§¦å‘**
```bash
# æ£€æŸ¥è§„åˆ™è¯­æ³•
./promtool check rules mysql_rules.yml  

# éªŒè¯è§„åˆ™æ‰§è¡Œ
curl http://localhost:9090/api/v1/rules

# æŸ¥çœ‹AlertmanagerçŠ¶æ€
curl http://localhost:9093/api/v1/alerts
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é‡‡é›†è½¬æ¢å­˜å‚¨å±•ç¤ºï¼Œç›‘æ§é“¾è·¯è¦å®Œæ•´
- æŒ‡æ ‡å‘Šè­¦å¯è§†åŒ–ï¼Œä¸‰ä½ä¸€ä½“ç¼ºä¸€ä¸å¯  
- é¢„é˜²é‡äºå“åº”ï¼Œè¶‹åŠ¿åˆ†ææ˜¯å…³é”®
- è‡ªåŠ¨åŒ–æ˜¯æ–¹å‘ï¼Œå‡å°‘äººå·¥ææ•ˆç‡