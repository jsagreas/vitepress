---
title: 22、命令行导入与LOAD DATA
---
## 📚 目录

1. [MySQL客户端导入基础](#1-mysql客户端导入基础)
2. [SQL脚本文件导入详解](#2-sql脚本文件导入详解)
3. [标准输入数据导入技术](#3-标准输入数据导入技术)
4. [批量导入性能优化策略](#4-批量导入性能优化策略)
5. [LOAD DATA语法与机制](#5-load-data语法与机制)
6. [文件导入模式对比](#6-文件导入模式对比)
7. [数据格式处理技巧](#7-数据格式处理技巧)
8. [错误处理与故障排除](#8-错误处理与故障排除)
9. [核心要点总结](#9-核心要点总结)

---

## 1. 🚀 MySQL客户端导入基础


### 1.1 mysql客户端是什么


**💡 通俗理解**
```
mysql客户端 = MySQL数据库的"操作台"
就像你用QQ聊天需要QQ客户端一样
操作MySQL数据库就需要mysql客户端

作用：连接数据库 → 执行SQL命令 → 查看结果
```

> 📖 **概念解释**：mysql客户端是MySQL官方提供的命令行工具，用于与MySQL服务器建立连接并执行各种数据库操作

### 1.2 基本连接方式


**🔧 连接语法格式**
```bash
mysql -h 主机地址 -P 端口 -u 用户名 -p 数据库名
```

**🎯 常用连接示例**
```bash
# 连接本地数据库
mysql -u root -p

# 连接远程数据库
mysql -h 192.168.1.100 -u admin -p company_db

# 指定端口连接
mysql -h localhost -P 3307 -u root -p
```

### 1.3 导入操作的本质


**📊 导入过程图解**
```
数据文件/脚本     mysql客户端      MySQL服务器
      │              │               │
      │─── 读取 ────→│               │
      │              │─── 发送 ────→│
      │              │               │─ 执行SQL
      │              │               │─ 存储数据
      │              │←── 响应 ─────│
```

> 💡 **核心理解**：导入就是把外部数据通过mysql客户端"搬运"到MySQL服务器里存储起来

---

## 2. 📄 SQL脚本文件导入详解


### 2.1 什么是SQL脚本文件


**🔍 概念澄清**
SQL脚本文件就是包含一堆SQL语句的普通文本文件，通常以`.sql`结尾

```sql
-- 这就是一个SQL脚本文件示例 backup.sql
CREATE DATABASE IF NOT EXISTS company;
USE company;

CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    salary DECIMAL(10,2)
);

INSERT INTO employees VALUES (1, '张三', 5000.00);
INSERT INTO employees VALUES (2, '李四', 6000.00);
```

### 2.2 脚本导入的三种方法


#### 🎯 方法一：source命令（推荐）


```bash
# 先连接到MySQL
mysql -u root -p

# 在MySQL命令行中执行
mysql> source /path/to/backup.sql;
```

**✅ 优点**：
- 可以看到执行过程
- 出错时能及时发现
- 支持相对路径和绝对路径

#### 🎯 方法二：重定向输入


```bash
# 直接在系统命令行执行
mysql -u root -p database_name < backup.sql

# 或者指定完整连接信息
mysql -h localhost -u root -p company < /home/user/backup.sql
```

**✅ 优点**：
- 一条命令完成
- 适合自动化脚本
- 不需要进入MySQL命令行

#### 🎯 方法三：-e参数执行


```bash
# 执行单条SQL语句
mysql -u root -p -e "SELECT * FROM employees;"

# 执行文件中的SQL（较少使用）
mysql -u root -p -e "$(cat backup.sql)"
```

### 2.3 脚本导入实战示例


**📝 完整导入流程**

> 🔧 **实践案例**：导入员工数据备份

```bash
# 第一步：准备SQL脚本文件 employees_backup.sql
-- employees_backup.sql 内容
DROP DATABASE IF EXISTS company;
CREATE DATABASE company CHARACTER SET utf8mb4;
USE company;

CREATE TABLE employees (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    department VARCHAR(30),
    salary DECIMAL(10,2),
    hire_date DATE
);

INSERT INTO employees (name, department, salary, hire_date) VALUES
('张三', '技术部', 8000.00, '2023-01-15'),
('李四', '销售部', 6000.00, '2023-02-20'),
('王五', '财务部', 7000.00, '2023-03-10');

# 第二步：执行导入
mysql -u root -p < employees_backup.sql

# 第三步：验证导入结果
mysql -u root -p company -e "SELECT COUNT(*) FROM employees;"
```

---

## 3. 📥 标准输入数据导入技术


### 3.1 标准输入导入的含义


**💭 通俗解释**
标准输入就是"从键盘或管道直接喂数据给程序"

```bash
# 键盘输入（交互式）
mysql -u root -p
mysql> CREATE TABLE test (id INT);
mysql> INSERT INTO test VALUES (1);

# 管道输入（非交互式）
echo "SELECT NOW();" | mysql -u root -p
```

### 3.2 管道导入数据


**🔄 管道导入原理图**
```
数据源         管道符(|)      mysql客户端      MySQL服务器
echo命令   ──────────→    处理SQL语句   ──────→   执行并存储
cat命令                    
其他程序                    
```

**🎯 实用管道导入示例**

```bash
# 方式1：echo输出SQL语句
echo "INSERT INTO employees (name, salary) VALUES ('新员工', 5500);" | mysql -u root -p company

# 方式2：cat读取文件内容
cat data.sql | mysql -u root -p company

# 方式3：组合多个命令
{
    echo "USE company;"
    echo "DELETE FROM employees WHERE salary < 5000;"
    echo "INSERT INTO employees (name, salary) VALUES ('高薪员工', 10000);"
} | mysql -u root -p
```

### 3.3 标准输入的高级用法


**📊 Here Document（文档内嵌）**

```bash
# 使用 << 符号创建内嵌文档
mysql -u root -p company << EOF
SELECT '开始导入数据...' AS message;
INSERT INTO employees (name, department, salary) VALUES 
('赵六', 'IT部', 9000),
('孙七', '人事部', 5500);
SELECT '导入完成！' AS message;
SELECT COUNT(*) AS total_count FROM employees;
EOF
```

> ⚠️ **注意事项**：EOF是结束标记，可以用任意字符串替代，但开始和结束必须一致

---

## 4. ⚡ 批量导入性能优化策略


### 4.1 为什么需要优化


**📈 性能对比示例**
```
普通导入方式：
- 1万条记录：约30秒
- 10万条记录：约5分钟
- 100万条记录：约1小时

优化后导入：
- 1万条记录：约2秒
- 10万条记录：约10秒  
- 100万条记录：约2分钟
```

### 4.2 核心优化技术


#### 🚀 技术1：批量INSERT语句


```sql
-- ❌ 低效方式：逐条插入
INSERT INTO employees (name, salary) VALUES ('张三', 5000);
INSERT INTO employees (name, salary) VALUES ('李四', 6000);
INSERT INTO employees (name, salary) VALUES ('王五', 7000);

-- ✅ 高效方式：批量插入
INSERT INTO employees (name, salary) VALUES 
('张三', 5000),
('李四', 6000),
('王五', 7000),
('赵六', 8000);
```

#### 🚀 技术2：关闭自动提交


```bash
mysql -u root -p company << EOF
SET autocommit = 0;
START TRANSACTION;

-- 大量INSERT语句
INSERT INTO employees (name, salary) VALUES ('员工1', 5000);
INSERT INTO employees (name, salary) VALUES ('员工2', 5500);
-- ... 更多数据

COMMIT;
SET autocommit = 1;
EOF
```

#### 🚀 技术3：临时调整MySQL参数


```sql
-- 导入前设置
SET unique_checks = 0;          -- 关闭唯一性检查
SET foreign_key_checks = 0;     -- 关闭外键检查
SET sql_log_bin = 0;           -- 关闭二进制日志

-- 执行大量导入操作
-- ...

-- 导入后恢复
SET unique_checks = 1;
SET foreign_key_checks = 1;
SET sql_log_bin = 1;
```

### 4.3 优化实战案例


**🎯 完整优化脚本示例**

```bash
#!/bin/bash
# 高性能批量导入脚本

# 设置数据库连接信息
DB_HOST="localhost"
DB_USER="root"
DB_NAME="company"

# 执行优化导入
mysql -h $DB_HOST -u $DB_USER -p $DB_NAME << EOF
-- 性能优化设置
SET autocommit = 0;
SET unique_checks = 0;
SET foreign_key_checks = 0;

START TRANSACTION;

-- 批量导入数据（示例）
INSERT INTO employees (name, department, salary) VALUES
('员工001', '技术部', 8000),
('员工002', '销售部', 6000),
('员工003', '财务部', 7000);
-- 可以继续添加更多数据...

COMMIT;

-- 恢复原始设置
SET autocommit = 1;
SET unique_checks = 1;
SET foreign_key_checks = 1;

SELECT '导入完成，共导入', COUNT(*), '条记录' FROM employees;
EOF
```

---

## 5. 📂 LOAD DATA语法与机制


### 5.1 LOAD DATA是什么


**💡 通俗理解**
LOAD DATA是MySQL专门用来"搬运"大量数据的"叉车"工具

```
普通INSERT = 用手一个个搬箱子（慢）
LOAD DATA = 用叉车整批搬运（快）

速度对比：LOAD DATA比INSERT快10-100倍！
```

> 📖 **技术定义**：LOAD DATA是MySQL的内置命令，专门用于从文本文件快速导入大量数据到数据表中

### 5.2 基本语法结构


**📋 完整语法格式**
```sql
LOAD DATA [LOCAL] INFILE '文件路径'
INTO TABLE 表名
[FIELDS 
    TERMINATED BY '字段分隔符'
    [OPTIONALLY] ENCLOSED BY '字段包围符'
    ESCAPED BY '转义符']
[LINES 
    STARTING BY '行开始符'
    TERMINATED BY '行结束符']
[IGNORE number LINES]
[(列名1, 列名2, ...)]
[SET 列名 = 表达式, ...]
```

### 5.3 基础用法示例


**🎯 最简单的LOAD DATA**

```sql
-- 创建测试表
CREATE TABLE employees (
    id INT,
    name VARCHAR(50),
    salary DECIMAL(10,2)
);

-- 准备数据文件 employees.txt（内容如下）
1	张三	5000.00
2	李四	6000.00
3	王五	7000.00

-- 执行导入
LOAD DATA INFILE '/path/to/employees.txt'
INTO TABLE employees;
```

---

## 6. 🔄 文件导入模式对比


### 6.1 LOCAL vs 非LOCAL模式


**📊 两种模式对比表**

| 特性 | **LOCAL模式** | **非LOCAL模式** |
|------|---------------|-----------------|
| **文件位置** | `客户端机器上` | `MySQL服务器上` |
| **安全性** | `较安全，权限要求低` | `需要FILE权限` |
| **传输方式** | `通过网络传输文件` | `服务器直接读取` |
| **性能** | `稍慢（需传输）` | `更快（本地读取）` |
| **使用场景** | `远程导入，开发测试` | `服务器端批量导入` |

### 6.2 LOCAL模式详解


**🔧 LOCAL模式语法**
```sql
-- LOCAL关键字表示文件在客户端
LOAD DATA LOCAL INFILE '/local/path/data.txt'
INTO TABLE employees
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n';
```

**📁 文件位置示例**
```
客户端导入流程：
┌─────────────────┐     网络传输      ┌─────────────────┐
│   客户端电脑     │ ──────────────→ │  MySQL服务器    │
│ /home/data.txt  │    上传文件       │ 处理并存储数据   │
└─────────────────┘                  └─────────────────┘
```

### 6.3 服务器文件模式详解


**🏠 服务器模式语法**
```sql
-- 不带LOCAL，文件必须在MySQL服务器上
LOAD DATA INFILE '/var/lib/mysql-files/data.txt'
INTO TABLE employees
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\r\n';
```

**⚠️ 权限要求**
```sql
-- 用户需要FILE权限
GRANT FILE ON *.* TO 'username'@'localhost';

-- 检查当前用户权限
SHOW GRANTS FOR CURRENT_USER();
```

> 🚨 **安全提醒**：服务器模式要求文件在MySQL的secure_file_priv指定目录下，这是为了安全考虑

---

## 7. 🎨 数据格式处理技巧


### 7.1 字段分隔符设置


**📝 常见分隔符类型**

```sql
-- 制表符分隔（默认）
FIELDS TERMINATED BY '\t'

-- 逗号分隔（CSV格式）
FIELDS TERMINATED BY ','

-- 分号分隔
FIELDS TERMINATED BY ';'

-- 自定义分隔符
FIELDS TERMINATED BY '||'
```

**🎯 实际案例演示**

```sql
-- CSV格式数据文件 employees.csv
1,张三,技术部,8000.50
2,李四,销售部,6000.00
3,王五,财务部,7500.25

-- 对应的LOAD DATA语句
LOAD DATA LOCAL INFILE 'employees.csv'
INTO TABLE employees
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(id, name, department, salary);
```

### 7.2 行终止符配置


**🔄 不同系统的行结束符**

```sql
-- Windows系统（\r\n）
LINES TERMINATED BY '\r\n'

-- Unix/Linux系统（\n）
LINES TERMINATED BY '\n'

-- Mac老系统（\r）
LINES TERMINATED BY '\r'

-- 自动识别（推荐）
LINES TERMINATED BY '\n'  -- MySQL会自动处理\r
```

### 7.3 字段包围符处理


**🔐 处理包含特殊字符的数据**

```sql
-- 数据文件内容（包含逗号的数据）
1,"张三","技术部,研发组",8000
2,"李四","销售部,华南区",6000

-- 对应的LOAD DATA语句
LOAD DATA LOCAL INFILE 'employees_quoted.csv'
INTO TABLE employees
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n';
```

### 7.4 NULL值导入处理


**❓ NULL值的表示方法**

```sql
-- 数据文件中的NULL值表示
1	张三	技术部	8000
2	李四	\N	6000
3	王五	财务部	\N

-- LOAD DATA处理NULL值
LOAD DATA LOCAL INFILE 'employees_with_null.txt'
INTO TABLE employees
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n'
(id, name, @department, @salary)
SET 
    department = NULLIF(@department, '\\N'),
    salary = NULLIF(@salary, '\\N');
```

---

## 8. ⚠️ 错误处理与故障排除


### 8.1 常见导入错误


**🚨 错误类型总览**

| 错误类型 | **常见原因** | **解决方法** |
|----------|-------------|-------------|
| **文件找不到** | `路径错误、权限不足` | `检查文件路径和权限` |
| **数据格式错误** | `分隔符不匹配` | `确认文件格式设置` |
| **字符集问题** | `编码不一致` | `指定正确字符集` |
| **主键冲突** | `重复数据导入` | `使用REPLACE或IGNORE` |
| **字段数量不匹配** | `列数不对应` | `检查表结构和数据` |

### 8.2 重复数据处理策略


**🔄 三种处理方式**

```sql
-- 方式1：忽略重复数据
LOAD DATA LOCAL INFILE 'data.txt'
IGNORE
INTO TABLE employees;

-- 方式2：替换重复数据
LOAD DATA LOCAL INFILE 'data.txt'
REPLACE
INTO TABLE employees;

-- 方式3：更新重复数据
LOAD DATA LOCAL INFILE 'data.txt'
INTO TABLE employees
ON DUPLICATE KEY UPDATE
salary = VALUES(salary),
department = VALUES(department);
```

### 8.3 导入过程监控


**📊 监控导入状态**

```sql
-- 查看导入警告信息
LOAD DATA LOCAL INFILE 'data.txt'
INTO TABLE employees;

SHOW WARNINGS;

-- 获取导入统计信息
SELECT 
    ROW_COUNT() as imported_rows,
    CONNECTION_ID() as connection_id;
```

### 8.4 错误排查实战


**🔍 完整排查流程**

```bash
# 第一步：检查文件是否存在
ls -la /path/to/datafile.txt

# 第二步：检查文件内容格式
head -5 /path/to/datafile.txt

# 第三步：检查MySQL连接和权限
mysql -u root -p -e "SHOW GRANTS;"

# 第四步：测试小批量导入
mysql -u root -p << EOF
LOAD DATA LOCAL INFILE '/path/to/sample.txt'
INTO TABLE test_table
FIELDS TERMINATED BY '\t'
LINES TERMINATED BY '\n';

SHOW WARNINGS;
SELECT COUNT(*) FROM test_table;
EOF
```

---

## 9. 📋 核心要点总结


### 9.1 必须掌握的核心概念


```
🔸 mysql客户端：连接和操作MySQL的命令行工具
🔸 SQL脚本导入：通过source命令或重定向导入.sql文件
🔸 标准输入导入：使用管道和重定向实现数据导入
🔸 LOAD DATA：MySQL专用的高速批量数据导入工具
🔸 LOCAL模式：文件在客户端，安全性高，适合远程导入
🔸 服务器模式：文件在服务器，性能更优，需要特殊权限
```

### 9.2 关键技术要点


**🔹 导入方式选择原则**
```
小量数据（<1万条）：
→ 使用INSERT语句导入
→ 简单直接，易于调试

中量数据（1万-10万条）：
→ 使用优化的批量INSERT
→ 关闭自动提交，批量操作

大量数据（>10万条）：
→ 使用LOAD DATA导入
→ 速度最快，专为大数据设计
```

**🔹 性能优化记忆要点**
```
批量操作：多条INSERT合并成一条
事务控制：关闭自动提交，手动提交
参数调优：关闭检查项，减少开销
格式优化：选择合适的分隔符和编码
```

### 9.3 实际应用指导


**🎯 不同场景的最佳实践**

```
开发环境导入：
✅ 使用LOCAL模式LOAD DATA
✅ 数据量小，操作简单
✅ 出错容易调试和重试

生产环境导入：
✅ 使用服务器模式LOAD DATA  
✅ 提前测试脚本和格式
✅ 做好备份和回滚准备

定期数据同步：
✅ 编写自动化脚本
✅ 包含错误处理和日志
✅ 设置监控和告警
```

**🔧 故障处理思路**
```
1. 确认文件：路径、权限、格式、编码
2. 检查权限：用户权限、FILE权限、目录权限  
3. 验证语法：分隔符、字段数、数据类型
4. 小批量测试：先导入少量数据验证
5. 查看日志：SHOW WARNINGS获取详细错误信息
```

### 9.4 核心记忆口诀


**💭 技术要点速记**
```
mysql客户端连数据库，
source重定向导脚本，
批量数据LOAD最快，
LOCAL安全服务器快，
分隔符号要对应，
错误处理看警告。
```

**🎓 学习建议**
- **先掌握基础**：mysql客户端连接和基本SQL导入
- **再学优化**：批量操作和性能调优技巧  
- **重点练习**：LOAD DATA的各种参数和模式
- **实战演练**：处理真实的数据导入场景
- **总结经验**：记录常见问题和解决方案