---
title: 40ã€å¤‡ä»½æ¢å¤æ•…éšœå¤„ç†ä¸è¯Šæ–­
---
## ğŸ“š ç›®å½•

1. [å¤‡ä»½æ¢å¤æ•…éšœæ¦‚è¿°](#1-å¤‡ä»½æ¢å¤æ•…éšœæ¦‚è¿°)
2. [å¸¸è§æ•…éšœç±»å‹åˆ†æ](#2-å¸¸è§æ•…éšœç±»å‹åˆ†æ)
3. [æ•…éšœè¯Šæ–­æ–¹æ³•ä½“ç³»](#3-æ•…éšœè¯Šæ–­æ–¹æ³•ä½“ç³»)
4. [å¤‡ä»½æ–‡ä»¶é—®é¢˜å¤„ç†](#4-å¤‡ä»½æ–‡ä»¶é—®é¢˜å¤„ç†)
5. [æ¢å¤è¿‡ç¨‹æ•…éšœå¤„ç†](#5-æ¢å¤è¿‡ç¨‹æ•…éšœå¤„ç†)
6. [æ•°æ®ä¸€è‡´æ€§é—®é¢˜è§£å†³](#6-æ•°æ®ä¸€è‡´æ€§é—®é¢˜è§£å†³)
7. [æ€§èƒ½ä¸èµ„æºé—®é¢˜ä¼˜åŒ–](#7-æ€§èƒ½ä¸èµ„æºé—®é¢˜ä¼˜åŒ–)
8. [å…¼å®¹æ€§é—®é¢˜è§£å†³æ–¹æ¡ˆ](#8-å…¼å®¹æ€§é—®é¢˜è§£å†³æ–¹æ¡ˆ)
9. [æ•…éšœé¢„é˜²ä¸æœ€ä½³å®è·µ](#9-æ•…éšœé¢„é˜²ä¸æœ€ä½³å®è·µ)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ å¤‡ä»½æ¢å¤æ•…éšœæ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯å¤‡ä»½æ¢å¤æ•…éšœ


**ğŸ  ç”Ÿæ´»ç±»æ¯”**
> å°±åƒå®¶é‡Œçš„é‡è¦æ–‡ä»¶ï¼Œä½ ç²¾å¿ƒä¿å­˜åœ¨ä¿é™©ç®±é‡Œï¼Œä½†çœŸæ­£éœ€è¦ç”¨çš„æ—¶å€™å´å‘ç°ï¼šä¿é™©ç®±æ‰“ä¸å¼€ã€æ–‡ä»¶æŸåäº†ã€æˆ–è€…æ–‡ä»¶å†…å®¹ä¸å®Œæ•´ã€‚MySQLå¤‡ä»½æ¢å¤æ•…éšœå°±æ˜¯è¿™æ ·çš„æƒ…å†µã€‚

**ğŸ’¡ æ ¸å¿ƒå®šä¹‰**
```
å¤‡ä»½æ¢å¤æ•…éšœï¼šåœ¨æ•°æ®åº“å¤‡ä»½æˆ–æ¢å¤è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ç§å¼‚å¸¸æƒ…å†µ
åŒ…æ‹¬ï¼šå¤‡ä»½å¤±è´¥ã€æ¢å¤ä¸­æ–­ã€æ•°æ®ä¸¢å¤±ã€æ€§èƒ½é—®é¢˜ç­‰
å½±å“ï¼šå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ã€ä¸šåŠ¡ä¸­æ–­ã€æ¢å¤æ—¶é—´å»¶é•¿
```

### 1.2 æ•…éšœå½±å“èŒƒå›´


**ğŸ“Š æ•…éšœå½±å“å±‚æ¬¡**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ä¸šåŠ¡å±‚å½±å“           â”‚ â† æœåŠ¡ä¸­æ–­ã€æ•°æ®ä¸¢å¤±
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     åº”ç”¨å±‚å½±å“           â”‚ â† è¿æ¥å¤±è´¥ã€åŠŸèƒ½å¼‚å¸¸
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     æ•°æ®åº“å±‚å½±å“         â”‚ â† æ¢å¤å¤±è´¥ã€æ•°æ®ä¸ä¸€è‡´
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ç³»ç»Ÿå±‚å½±å“           â”‚ â† èµ„æºä¸è¶³ã€æƒé™é—®é¢˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“ˆ æ•…éšœä¸¥é‡ç¨‹åº¦åˆ†çº§**
| çº§åˆ« | **å½±å“èŒƒå›´** | **æ¢å¤æ—¶é—´** | **æ•°æ®ä¸¢å¤±** | **å…¸å‹åœºæ™¯** |
|------|-------------|-------------|-------------|-------------|
| ğŸ”´ **P0çº§** | `å…¨ä¸šåŠ¡ä¸­æ–­` | `>4å°æ—¶` | `å¯èƒ½ä¸¢å¤±` | `ä¸»åº“å´©æºƒï¼Œå¤‡ä»½å®Œå…¨ä¸å¯ç”¨` |
| ğŸŸ¡ **P1çº§** | `éƒ¨åˆ†åŠŸèƒ½` | `1-4å°æ—¶` | `å°‘é‡ä¸¢å¤±` | `æ¢å¤è¿‡ç¨‹ä¸­æ–­ï¼Œéœ€é‡æ–°å¼€å§‹` |
| ğŸŸ¢ **P2çº§** | `æ€§èƒ½å½±å“` | `<1å°æ—¶` | `æ— ä¸¢å¤±` | `æ¢å¤é€Ÿåº¦æ…¢ï¼Œä½†æœ€ç»ˆæˆåŠŸ` |

---

## 2. ğŸ” å¸¸è§æ•…éšœç±»å‹åˆ†æ


### 2.1 å¤‡ä»½é˜¶æ®µæ•…éšœ


**ğŸ’¾ å¤‡ä»½æ–‡ä»¶ç›¸å…³æ•…éšœ**

**ğŸ”¸ å¤‡ä»½æ–‡ä»¶æŸå**
```bash
# å¸¸è§ç°è±¡
ERROR 1064: You have an error in your SQL syntax
ERROR 2006: MySQL server has gone away
ERROR 145: Table './db/table' is marked as crashed

# äº§ç”ŸåŸå› 
â€¢ å¤‡ä»½è¿‡ç¨‹ä¸­ç³»ç»Ÿå¼‚å¸¸æ–­ç”µ
â€¢ å­˜å‚¨è®¾å¤‡æ•…éšœå¯¼è‡´æ–‡ä»¶æŸå
â€¢ ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­æ•°æ®åŒ…ä¸¢å¤±
â€¢ ç—…æ¯’æˆ–æ¶æ„è½¯ä»¶ç ´åæ–‡ä»¶
```

**ğŸ”¸ å¤‡ä»½æ–‡ä»¶ä¸å®Œæ•´**
```bash
# æ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§
# é€»è¾‘å¤‡ä»½æ£€æŸ¥
tail -10 backup.sql
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“å°¾ï¼š
-- Dump completed on 2025-09-11 15:30:21

# ç‰©ç†å¤‡ä»½æ£€æŸ¥
xtrabackup --prepare --target-dir=/backup/
# æˆåŠŸä¼šæ˜¾ç¤ºï¼šcompleted OK!
```

### 2.2 æ¢å¤é˜¶æ®µæ•…éšœ


**âš¡ æ¢å¤è¿‡ç¨‹ä¸­æ–­é—®é¢˜**

**ğŸ”¸ è¿æ¥è¶…æ—¶å¯¼è‡´ä¸­æ–­**
```sql
-- ç°è±¡ï¼šæ¢å¤å¤§æ–‡ä»¶æ—¶è¿æ¥æ–­å¼€
ERROR 2013: Lost connection to MySQL server during query

-- è§£å†³æ–¹æ¡ˆï¼šè°ƒæ•´è¶…æ—¶å‚æ•°
SET SESSION wait_timeout = 28800;        -- 8å°æ—¶
SET SESSION interactive_timeout = 28800;  -- 8å°æ—¶
SET SESSION net_read_timeout = 3600;     -- 1å°æ—¶
SET SESSION net_write_timeout = 3600;    -- 1å°æ—¶
```

**ğŸ”¸ ç£ç›˜ç©ºé—´ä¸è¶³**
```bash
# ç°è±¡
ERROR 1114: The table 'temp_table' is full
ERROR 28: No space left on device

# è¯Šæ–­å‘½ä»¤
df -h                    # æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
du -sh /var/lib/mysql/   # æŸ¥çœ‹MySQLæ•°æ®ç›®å½•å¤§å°
```

### 2.3 æ•°æ®ä¸€è‡´æ€§æ•…éšœ


**ğŸ¯ æ•°æ®ä¸ä¸€è‡´é—®é¢˜**

**ğŸ”¸ å¤–é”®çº¦æŸå†²çª**
```sql
-- ç°è±¡
ERROR 1452: Cannot add or update a child row: 
a foreign key constraint fails

-- è§£å†³æ­¥éª¤
-- 1. ä¸´æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥
SET FOREIGN_KEY_CHECKS = 0;

-- 2. æ‰§è¡Œæ¢å¤æ“ä½œ
SOURCE /backup/backup.sql;

-- 3. é‡æ–°å¯ç”¨å¤–é”®æ£€æŸ¥
SET FOREIGN_KEY_CHECKS = 1;

-- 4. éªŒè¯æ•°æ®å®Œæ•´æ€§
SELECT TABLE_NAME 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database';
```

---

## 3. ğŸ”¬ æ•…éšœè¯Šæ–­æ–¹æ³•ä½“ç³»


### 3.1 ç³»ç»ŸåŒ–è¯Šæ–­æµç¨‹


**ğŸ“‹ è¯Šæ–­æ£€æŸ¥æ¸…å•**
- [ ] **ç¯å¢ƒæ£€æŸ¥**ï¼šç³»ç»Ÿèµ„æºã€æƒé™ã€ç‰ˆæœ¬
- [ ] **æ—¥å¿—åˆ†æ**ï¼šé”™è¯¯æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—
- [ ] **å¤‡ä»½éªŒè¯**ï¼šæ–‡ä»¶å®Œæ•´æ€§ã€æ ¼å¼æ­£ç¡®æ€§
- [ ] **ç½‘ç»œè¿æ¥**ï¼šè¿æ¥ç¨³å®šæ€§ã€è¶…æ—¶è®¾ç½®
- [ ] **é…ç½®æ£€æŸ¥**ï¼šå‚æ•°è®¾ç½®ã€å­—ç¬¦é›†é…ç½®

### 3.2 æ—¥å¿—åˆ†ææŠ€å·§


**ğŸ“ MySQLé”™è¯¯æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä½ç½®
SHOW VARIABLES LIKE 'log_error';

# å®æ—¶ç›‘æ§é”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log

# æœç´¢ç‰¹å®šé”™è¯¯
grep -i "ERROR\|FATAL" /var/log/mysql/error.log | tail -20
```

**ğŸ” å…³é”®é”™è¯¯æ¨¡å¼è¯†åˆ«**
```bash
# å¸¸è§é”™è¯¯æ¨¡å¼
ERROR 1046: No database selected          # æœªé€‰æ‹©æ•°æ®åº“
ERROR 1049: Unknown database             # æ•°æ®åº“ä¸å­˜åœ¨  
ERROR 1146: Table doesn't exist          # è¡¨ä¸å­˜åœ¨
ERROR 1062: Duplicate entry              # ä¸»é”®é‡å¤
ERROR 1264: Out of range value           # æ•°å€¼è¶…å‡ºèŒƒå›´
```

### 3.3 æ€§èƒ½è¯Šæ–­æ–¹æ³•


**ğŸ“Š æ€§èƒ½ç›‘æ§æŒ‡æ ‡**
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥çŠ¶æ€
SHOW PROCESSLIST;

-- æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
SHOW STATUS LIKE 'Threads_%';
SHOW STATUS LIKE 'Connections';
SHOW STATUS LIKE 'Aborted_%';

-- æŸ¥çœ‹InnoDBçŠ¶æ€
SHOW ENGINE INNODB STATUS\G
```

**âš¡ èµ„æºä½¿ç”¨ç›‘æ§**
```bash
# ç³»ç»Ÿèµ„æºç›‘æ§
top -p $(pgrep mysqld)     # MySQLè¿›ç¨‹èµ„æºä½¿ç”¨
iostat -x 1 5             # IOç»Ÿè®¡
free -h                   # å†…å­˜ä½¿ç”¨æƒ…å†µ
```

---

## 4. ğŸ› ï¸ å¤‡ä»½æ–‡ä»¶é—®é¢˜å¤„ç†


### 4.1 å¤‡ä»½æ–‡ä»¶æŸåæ£€æµ‹ä¸ä¿®å¤


**ğŸ”§ æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥**
```bash
# 1. æ£€æŸ¥æ–‡ä»¶å¤§å°
ls -lh backup.sql
# å¦‚æœæ–‡ä»¶å¼‚å¸¸å°ï¼Œå¯èƒ½å¤‡ä»½ä¸å®Œæ•´

# 2. æ£€æŸ¥æ–‡ä»¶ç»“å°¾
tail -10 backup.sql
# æ­£å¸¸çš„mysqldumpæ–‡ä»¶åº”è¯¥ä»¥ä»¥ä¸‹å†…å®¹ç»“å°¾ï¼š
# /*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
# -- Dump completed on YYYY-MM-DD HH:MM:SS

# 3. æ£€æŸ¥SQLè¯­æ³•
mysql --force --show-warnings < backup.sql > /dev/null
```

**ğŸš¨ æŸåæ–‡ä»¶ä¿®å¤ç­–ç•¥**

**ğŸ”¸ éƒ¨åˆ†æŸåä¿®å¤**
```bash
# 1. æå–å¯ç”¨éƒ¨åˆ†
head -n -100 backup.sql > backup_partial.sql
echo "/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;" >> backup_partial.sql

# 2. åˆ†æ®µæ¢å¤
split -l 100000 backup.sql backup_part_
# é€ä¸ªå¯¼å…¥åˆ†æ®µæ–‡ä»¶ï¼Œè·³è¿‡æŸåéƒ¨åˆ†

# 3. æ‰‹åŠ¨ä¿®å¤SQLè¯­å¥
sed -i 's/corrupted_part/fixed_part/g' backup.sql
```

### 4.2 å¤‡ä»½æ ¼å¼è½¬æ¢


**ğŸ”„ ä¸åŒæ ¼å¼é—´è½¬æ¢**
```bash
# mysqldumpè½¬CSVæ ¼å¼
mysqldump --tab=/tmp/backup/ --fields-terminated-by=',' database_name

# CSVè½¬SQLæ ¼å¼
mysql database_name -e "
LOAD DATA INFILE '/tmp/backup/table_name.txt' 
INTO TABLE table_name 
FIELDS TERMINATED BY ',' 
LINES TERMINATED BY '\n';"
```

---

## 5. âš™ï¸ æ¢å¤è¿‡ç¨‹æ•…éšœå¤„ç†


### 5.1 æ¢å¤ä¸­æ–­é—®é¢˜è§£å†³


**ğŸ”„ æ–­ç‚¹ç»­ä¼ æœºåˆ¶**
```bash
# 1. è®°å½•æ¢å¤è¿›åº¦
mysql database_name < backup.sql 2>&1 | tee restore.log

# 2. æŸ¥æ‰¾ä¸­æ–­ç‚¹
grep -n "ERROR" restore.log | tail -1

# 3. ä»ä¸­æ–­ç‚¹ç»§ç»­
tail -n +12345 backup.sql | mysql database_name
```

**ğŸ’¡ åˆ†æ‰¹æ¢å¤ç­–ç•¥**
```sql
-- å°†å¤§æ–‡ä»¶åˆ†æˆå°å—å¤„ç†
-- 1. åªæ¢å¤è¡¨ç»“æ„
mysqldump --no-data database_name | mysql new_database

-- 2. åˆ†è¡¨æ¢å¤æ•°æ®
mysqldump --no-create-info --where="id BETWEEN 1 AND 10000" 
database_name table_name | mysql new_database

-- 3. åˆ†æ‰¹æ’å…¥æ•°æ®
INSERT INTO table_name SELECT * FROM backup_table LIMIT 1000;
-- é‡å¤æ‰§è¡Œï¼Œæ¯æ¬¡å¤„ç†1000æ¡è®°å½•
```

### 5.2 å†…å­˜ä¸è¶³é—®é¢˜å¤„ç†


**ğŸ“Š å†…å­˜ä¼˜åŒ–é…ç½®**
```sql
-- ä¸´æ—¶è°ƒæ•´å†…å­˜ç›¸å…³å‚æ•°
SET SESSION bulk_insert_buffer_size = 256*1024*1024;  -- 256MB
SET SESSION myisam_sort_buffer_size = 128*1024*1024;  -- 128MB
SET SESSION read_buffer_size = 8*1024*1024;           -- 8MB
SET SESSION read_rnd_buffer_size = 16*1024*1024;      -- 16MB
```

**ğŸ”§ åˆ†æ®µå¤„ç†æ–¹æ¡ˆ**
```bash
# ä½¿ç”¨mysqlå‘½ä»¤çš„æ‰¹å¤„ç†æ¨¡å¼
mysql --batch --skip-column-names database_name < backup.sql

# æˆ–è€…ä½¿ç”¨mysqlimportå·¥å…·
mysqlimport --local --compress --delete --lock-tables 
database_name /path/to/backup/files/*.txt
```

---

## 6. âš–ï¸ æ•°æ®ä¸€è‡´æ€§é—®é¢˜è§£å†³


### 6.1 å¤–é”®çº¦æŸå†²çªå¤„ç†


**ğŸ”— å¤–é”®é—®é¢˜è¯Šæ–­**
```sql
-- æŸ¥çœ‹æ‰€æœ‰å¤–é”®çº¦æŸ
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    CONSTRAINT_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM information_schema.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_SCHEMA = 'your_database'
    AND REFERENCED_TABLE_NAME IS NOT NULL;
```

**ğŸ› ï¸ å¤–é”®å†²çªè§£å†³æ­¥éª¤**
```sql
-- æ–¹æ¡ˆ1ï¼šè°ƒæ•´å¯¼å…¥é¡ºåº
-- 1. å…ˆå¯¼å…¥çˆ¶è¡¨æ•°æ®
-- 2. å†å¯¼å…¥å­è¡¨æ•°æ®

-- æ–¹æ¡ˆ2ï¼šä¸´æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥ï¼ˆæ¨èï¼‰
SET FOREIGN_KEY_CHECKS = 0;
-- æ‰§è¡Œæ•°æ®å¯¼å…¥
SOURCE backup.sql;
SET FOREIGN_KEY_CHECKS = 1;

-- æ–¹æ¡ˆ3ï¼šé‡å»ºå¤–é”®å…³ç³»
-- åˆ é™¤æ‰€æœ‰å¤–é”®
ALTER TABLE child_table DROP FOREIGN KEY fk_constraint_name;
-- å¯¼å…¥æ•°æ®åé‡æ–°æ·»åŠ 
ALTER TABLE child_table ADD CONSTRAINT fk_constraint_name 
FOREIGN KEY (column_name) REFERENCES parent_table(column_name);
```

### 6.2 å­—ç¬¦é›†ä¸åŒ¹é…è§£å†³


**ğŸ”¤ å­—ç¬¦é›†é—®é¢˜è¯Šæ–­**
```sql
-- æŸ¥çœ‹æ•°æ®åº“å­—ç¬¦é›†
SHOW VARIABLES LIKE 'character_set%';

-- æŸ¥çœ‹è¡¨å­—ç¬¦é›†
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    TABLE_COLLATION
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database';
```

**ğŸ”§ å­—ç¬¦é›†è½¬æ¢æ–¹æ¡ˆ**
```sql
-- æ–¹æ¡ˆ1ï¼šä¿®æ”¹å¯¼å…¥æ—¶çš„å­—ç¬¦é›†
mysql --default-character-set=utf8mb4 database_name < backup.sql

-- æ–¹æ¡ˆ2ï¼šè½¬æ¢ç°æœ‰æ•°æ®å­—ç¬¦é›†
ALTER DATABASE database_name CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æ–¹æ¡ˆ3ï¼šåœ¨å¤‡ä»½æ–‡ä»¶ä¸­æŒ‡å®šå­—ç¬¦é›†
-- åœ¨backup.sqlæ–‡ä»¶å¼€å¤´æ·»åŠ ï¼š
/*!40101 SET NAMES utf8mb4 */;
```

---

## 7. ğŸš€ æ€§èƒ½ä¸èµ„æºé—®é¢˜ä¼˜åŒ–


### 7.1 æ¢å¤æ€§èƒ½ä¼˜åŒ–


**âš¡ å¯¼å…¥é€Ÿåº¦ä¼˜åŒ–æŠ€å·§**
```sql
-- ä¼˜åŒ–å‚æ•°è®¾ç½®
SET SESSION sql_log_bin = 0;              -- å…³é—­äºŒè¿›åˆ¶æ—¥å¿—
SET SESSION foreign_key_checks = 0;       -- å…³é—­å¤–é”®æ£€æŸ¥
SET SESSION unique_checks = 0;             -- å…³é—­å”¯ä¸€æ€§æ£€æŸ¥
SET SESSION autocommit = 0;               -- å…³é—­è‡ªåŠ¨æäº¤

-- æ‰¹é‡å¯¼å…¥åæäº¤
COMMIT;

-- æ¢å¤é»˜è®¤è®¾ç½®
SET SESSION sql_log_bin = 1;
SET SESSION foreign_key_checks = 1;
SET SESSION unique_checks = 1;
SET SESSION autocommit = 1;
```

**ğŸ“Š InnoDBä¼˜åŒ–é…ç½®**
```sql
-- ä¸´æ—¶è°ƒæ•´InnoDBå‚æ•°ï¼ˆéœ€è¦é‡å¯MySQLï¼‰
-- åœ¨my.cnfä¸­è®¾ç½®ï¼š
[mysqld]
innodb_buffer_pool_size = 4G              # è®¾ç½®ä¸ºå¯ç”¨å†…å­˜çš„70-80%
innodb_log_file_size = 512M               # å¢å¤§é‡åšæ—¥å¿—æ–‡ä»¶
innodb_flush_log_at_trx_commit = 2        # æé«˜å†™å…¥æ€§èƒ½
innodb_doublewrite = 0                    # ä¸´æ—¶å…³é—­åŒå†™ç¼“å†²
sync_binlog = 0                           # ä¸´æ—¶å…³é—­binlogåŒæ­¥
```

### 7.2 ç£ç›˜ç©ºé—´ç®¡ç†


**ğŸ’¾ ç©ºé—´é¢„ä¼°å’Œæ¸…ç†**
```bash
# ä¼°ç®—æ¢å¤æ‰€éœ€ç©ºé—´
# é€šå¸¸éœ€è¦å¤‡ä»½æ–‡ä»¶å¤§å°çš„2-3å€ç©ºé—´

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f /tmp/mysql*
rm -f /var/lib/mysql/*.tmp

# æ¸…ç†æ—§çš„äºŒè¿›åˆ¶æ—¥å¿—
mysql -e "PURGE BINARY LOGS BEFORE DATE_SUB(NOW(), INTERVAL 3 DAY);"

# å‹ç¼©å¤‡ä»½æ–‡ä»¶èŠ‚çœç©ºé—´
gzip backup.sql                          # å‹ç¼©å¤‡ä»½
zcat backup.sql.gz | mysql database_name # ç›´æ¥ä»å‹ç¼©æ–‡ä»¶æ¢å¤
```

---

## 8. ğŸ”„ å…¼å®¹æ€§é—®é¢˜è§£å†³æ–¹æ¡ˆ


### 8.1 ç‰ˆæœ¬å…¼å®¹æ€§å¤„ç†


**ğŸ“‹ ç‰ˆæœ¬å·®å¼‚æ£€æŸ¥**
```sql
-- æ£€æŸ¥MySQLç‰ˆæœ¬
SELECT VERSION();

-- æ£€æŸ¥å¤‡ä»½æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯
head -20 backup.sql | grep "MySQL dump"
-- è¾“å‡ºç±»ä¼¼ï¼š-- MySQL dump 10.13  Distrib 8.0.32
```

**ğŸ”§ ç‰ˆæœ¬å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ**

**ğŸ”¸ é«˜ç‰ˆæœ¬åˆ°ä½ç‰ˆæœ¬**
```bash
# ä½¿ç”¨å…¼å®¹å‚æ•°å¯¼å‡º
mysqldump --compatible=mysql40 \
          --skip-set-charset \
          --skip-add-locks \
          database_name > compatible_backup.sql

# ç§»é™¤ä¸å…¼å®¹çš„è¯­å¥
sed -i '/\/\*!50013 DEFINER/d' backup.sql
sed -i '/\/\*!50017 DEFINER/d' backup.sql
```

**ğŸ”¸ ä½ç‰ˆæœ¬åˆ°é«˜ç‰ˆæœ¬**
```sql
-- æ›´æ–°å­˜å‚¨å¼•æ“
ALTER TABLE table_name ENGINE=InnoDB;

-- æ›´æ–°å­—ç¬¦é›†
ALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4;

-- ä¿®å¤è¡¨ç»“æ„
REPAIR TABLE table_name;
OPTIMIZE TABLE table_name;
```

### 8.2 å­˜å‚¨å¼•æ“å…¼å®¹æ€§


**ğŸ”§ å­˜å‚¨å¼•æ“è½¬æ¢**
```sql
-- æŸ¥çœ‹è¡¨çš„å­˜å‚¨å¼•æ“
SELECT TABLE_NAME, ENGINE 
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database';

-- æ‰¹é‡è½¬æ¢å­˜å‚¨å¼•æ“
SELECT CONCAT('ALTER TABLE ', TABLE_NAME, ' ENGINE=InnoDB;') as convert_sql
FROM information_schema.TABLES 
WHERE TABLE_SCHEMA = 'your_database' 
  AND ENGINE != 'InnoDB';
```

---

## 9. ğŸ›¡ï¸ æ•…éšœé¢„é˜²ä¸æœ€ä½³å®è·µ


### 9.1 é¢„é˜²æ€§æªæ–½


**ğŸ“ å¤‡ä»½éªŒè¯æœºåˆ¶**
```bash
# å»ºç«‹è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬
#!/bin/bash
BACKUP_FILE="backup_$(date +%Y%m%d).sql"
TEST_DB="backup_test_db"

# 1. æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
if tail -1 "$BACKUP_FILE" | grep -q "completed"; then
    echo "å¤‡ä»½æ–‡ä»¶å®Œæ•´"
else
    echo "è­¦å‘Šï¼šå¤‡ä»½æ–‡ä»¶å¯èƒ½ä¸å®Œæ•´"
    exit 1
fi

# 2. æµ‹è¯•æ¢å¤
mysql -e "DROP DATABASE IF EXISTS $TEST_DB; CREATE DATABASE $TEST_DB;"
mysql "$TEST_DB" < "$BACKUP_FILE"

# 3. éªŒè¯æ•°æ®
TABLE_COUNT=$(mysql -e "SELECT COUNT(*) FROM information_schema.TABLES WHERE TABLE_SCHEMA='$TEST_DB';" -s)
echo "æ¢å¤äº† $TABLE_COUNT ä¸ªè¡¨"

# 4. æ¸…ç†æµ‹è¯•ç¯å¢ƒ
mysql -e "DROP DATABASE $TEST_DB;"
```

**âš ï¸ é£é™©è¯„ä¼°æ¸…å•**
- [ ] **å¤‡ä»½ç­–ç•¥**ï¼šæ˜¯å¦æœ‰å¤šé‡å¤‡ä»½
- [ ] **å­˜å‚¨å®‰å…¨**ï¼šå¤‡ä»½æ–‡ä»¶æ˜¯å¦å¼‚åœ°å­˜å‚¨
- [ ] **æ¢å¤æµ‹è¯•**ï¼šæ˜¯å¦å®šæœŸæµ‹è¯•æ¢å¤æµç¨‹
- [ ] **ç›‘æ§å‘Šè­¦**ï¼šæ˜¯å¦æœ‰è‡ªåŠ¨ç›‘æ§æœºåˆ¶
- [ ] **æ–‡æ¡£è®°å½•**ï¼šæ˜¯å¦æœ‰è¯¦ç»†çš„æ“ä½œæ–‡æ¡£

### 9.2 åº”æ€¥å“åº”é¢„æ¡ˆ


**ğŸš¨ åº”æ€¥å¤„ç†æµç¨‹**
```
æ­¥éª¤1ï¼šæ•…éšœç¡®è®¤
â”œâ”€â”€ ç¡®è®¤æ•…éšœç±»å‹å’Œå½±å“èŒƒå›´
â”œâ”€â”€ è¯„ä¼°æ•…éšœä¸¥é‡ç¨‹åº¦
â””â”€â”€ å¯åŠ¨åº”æ€¥å“åº”å›¢é˜Ÿ

æ­¥éª¤2ï¼šå¿«é€Ÿå“åº”
â”œâ”€â”€ åœæ­¢ç›¸å…³ä¸šåŠ¡æ“ä½œ
â”œâ”€â”€ ä¿æŠ¤ç°æœ‰æ•°æ®
â””â”€â”€ å¯ç”¨å¤‡ç”¨ç³»ç»Ÿï¼ˆå¦‚æœ‰ï¼‰

æ­¥éª¤3ï¼šé—®é¢˜è¯Šæ–­
â”œâ”€â”€ æ”¶é›†é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
â”œâ”€â”€ åˆ†ææ•…éšœæ ¹æœ¬åŸå› 
â””â”€â”€ åˆ¶å®šæ¢å¤æ–¹æ¡ˆ

æ­¥éª¤4ï¼šæ‰§è¡Œæ¢å¤
â”œâ”€â”€ é€‰æ‹©æœ€ä¼˜æ¢å¤ç­–ç•¥
â”œâ”€â”€ æ‰§è¡Œæ•°æ®æ¢å¤æ“ä½œ
â””â”€â”€ éªŒè¯æ•°æ®å®Œæ•´æ€§

æ­¥éª¤5ï¼šæœåŠ¡æ¢å¤
â”œâ”€â”€ é‡å¯åº”ç”¨æœåŠ¡
â”œâ”€â”€ éªŒè¯ä¸šåŠ¡åŠŸèƒ½
â””â”€â”€ ç›‘æ§ç³»ç»ŸçŠ¶æ€
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•…éšœç±»å‹ï¼šå¤‡ä»½æŸåã€æ¢å¤ä¸­æ–­ã€æ•°æ®ä¸ä¸€è‡´ã€æ€§èƒ½é—®é¢˜
ğŸ”¸ è¯Šæ–­æ–¹æ³•ï¼šæ—¥å¿—åˆ†æã€ç³»ç»Ÿç›‘æ§ã€å¤‡ä»½éªŒè¯ã€è¿æ¥æµ‹è¯•
ğŸ”¸ å¤„ç†æŠ€å·§ï¼šåˆ†æ‰¹å¤„ç†ã€å‚æ•°ä¼˜åŒ–ã€æ ¼å¼è½¬æ¢ã€å…¼å®¹æ€§å¤„ç†
ğŸ”¸ é¢„é˜²æªæ–½ï¼šå®šæœŸæµ‹è¯•ã€å¤šé‡å¤‡ä»½ã€ç›‘æ§å‘Šè­¦ã€åº”æ€¥é¢„æ¡ˆ
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ•…éšœå¤„ç†çš„æ ¸å¿ƒæ€è·¯**
```
1. å¿«é€Ÿå®šä½ï¼šé€šè¿‡æ—¥å¿—å’Œç—‡çŠ¶å¿«é€Ÿæ‰¾åˆ°é—®é¢˜æ ¹æº
2. åˆ†è€Œæ²»ä¹‹ï¼šå°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå¯å¤„ç†çš„å°é—®é¢˜
3. éªŒè¯æ¢å¤ï¼šæ¯ä¸ªä¿®å¤æ­¥éª¤åéƒ½è¦éªŒè¯æ•ˆæœ
4. é¢„é˜²ä¸ºä¸»ï¼šå»ºç«‹å®Œå–„çš„é¢„é˜²å’Œç›‘æ§æœºåˆ¶
```

**ğŸ”¹ å¸¸è§æ•…éšœçš„å¤„ç†ä¼˜å…ˆçº§**
```
P0çº§ï¼ˆç´§æ€¥ï¼‰ï¼š
â€¢ å¤‡ä»½æ–‡ä»¶å®Œå…¨æŸå â†’ å¯»æ‰¾å…¶ä»–å¤‡ä»½æº
â€¢ æ¢å¤è¿‡ç¨‹æ•°æ®ä¸¢å¤± â†’ ç«‹å³åœæ­¢ï¼Œé‡æ–°è§„åˆ’

P1çº§ï¼ˆé‡è¦ï¼‰ï¼š
â€¢ æ¢å¤è¿‡ç¨‹ä¸­æ–­ â†’ æ–­ç‚¹ç»­ä¼ æˆ–åˆ†æ‰¹å¤„ç†
â€¢ å¤–é”®çº¦æŸå†²çª â†’ è°ƒæ•´å¯¼å…¥é¡ºåºæˆ–ä¸´æ—¶ç¦ç”¨

P2çº§ï¼ˆä¸€èˆ¬ï¼‰ï¼š
â€¢ æ¢å¤é€Ÿåº¦æ…¢ â†’ ä¼˜åŒ–å‚æ•°é…ç½®
â€¢ å­—ç¬¦é›†ä¸åŒ¹é… â†’ è½¬æ¢å­—ç¬¦é›†è®¾ç½®
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ¯ ä¸€åˆ†é’ŸæŒæ¡**
æœ€æ ¸å¿ƒçš„3ä¸ªåº”å¯¹ç­–ç•¥ï¼š
1. **æ—¥å¿—åˆ†æ**ï¼šæ‰€æœ‰æ•…éšœéƒ½ä»æ—¥å¿—å¼€å§‹åˆ†æ
2. **åˆ†æ­¥éªŒè¯**ï¼šæ¯ä¸ªæ“ä½œæ­¥éª¤éƒ½è¦éªŒè¯ç»“æœ
3. **å¤‡ç”¨æ–¹æ¡ˆ**ï¼šå§‹ç»ˆå‡†å¤‡Bè®¡åˆ’å’ŒCè®¡åˆ’

**â­ å¿…é¡»ç†è§£**
æ•…éšœå¤„ç†ä¸æ˜¯å•çº¯çš„æŠ€æœ¯æ“ä½œï¼Œè€Œæ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ï¼š
- éœ€è¦å¹³æ—¶çš„é¢„é˜²å’Œå‡†å¤‡
- éœ€è¦æ•…éšœæ—¶çš„å†·é™åˆ†æ
- éœ€è¦å¤„ç†åçš„æ€»ç»“æ”¹è¿›

**ğŸš¨ æ³¨æ„äº‹é¡¹**
- åœ¨ç”Ÿäº§ç¯å¢ƒæ“ä½œå‰ï¼Œå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯
- é‡è¦æ“ä½œè¦æœ‰å¤‡ä»½å’Œå›æ»šæ–¹æ¡ˆ
- åŠæ—¶è®°å½•æ“ä½œæ­¥éª¤å’Œé—®é¢˜è§£å†³è¿‡ç¨‹
- å»ºç«‹çŸ¥è¯†åº“ï¼Œé¿å…é‡å¤è¸©å‘

**ğŸ’ª å®è·µæŒ‘æˆ˜**
```
æ¨¡æ‹Ÿæ•…éšœåœºæ™¯ï¼š
1. åˆ›å»ºä¸€ä¸ªæŸåçš„å¤‡ä»½æ–‡ä»¶ï¼Œç»ƒä¹ ä¿®å¤æ–¹æ³•
2. åœ¨æ¢å¤è¿‡ç¨‹ä¸­äººä¸ºä¸­æ–­ï¼Œç»ƒä¹ æ–­ç‚¹ç»­ä¼ 
3. æ¨¡æ‹Ÿä¸åŒç‰ˆæœ¬é—´çš„å…¼å®¹æ€§é—®é¢˜
4. ç»ƒä¹ åœ¨èµ„æºå—é™ç¯å¢ƒä¸‹çš„æ¢å¤æ“ä½œ
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- æ•…éšœè¯Šæ–­çœ‹æ—¥å¿—ï¼Œç³»ç»Ÿåˆ†ææ‰¾æ ¹å› 
- åˆ†æ­¥éªŒè¯ç¨³æ¢å¤ï¼Œé¢„é˜²æªæ–½ä¿å¹³å®‰
- åº”æ€¥é¢„æ¡ˆè¦å¸¸ç»ƒï¼Œæ–‡æ¡£è®°å½•åŠ©æ’é”™
- å¤‡ä»½éªŒè¯æ˜¯å…³é”®ï¼Œå¤šé‡ä¿éšœé˜²ä¸‡ä¸€