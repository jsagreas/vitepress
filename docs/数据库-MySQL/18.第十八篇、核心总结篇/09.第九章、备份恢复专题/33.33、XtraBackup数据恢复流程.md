---
title: 33ã€XtraBackupæ•°æ®æ¢å¤æµç¨‹
---
## ğŸ“š ç›®å½•

1. [XtraBackupæ¢å¤æ¦‚è¿°](#1-XtraBackupæ¢å¤æ¦‚è¿°)
2. [å¤‡ä»½æ–‡ä»¶å‡†å¤‡ï¼ˆPrepareï¼‰](#2-å¤‡ä»½æ–‡ä»¶å‡†å¤‡Prepare)
3. [å®Œæ•´æ¢å¤æµç¨‹](#3-å®Œæ•´æ¢å¤æµç¨‹)
4. [å¢é‡æ¢å¤æ“ä½œ](#4-å¢é‡æ¢å¤æ“ä½œ)
5. [éƒ¨åˆ†æ•°æ®æ¢å¤](#5-éƒ¨åˆ†æ•°æ®æ¢å¤)
6. [æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹](#6-æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹)
7. [æ¢å¤æ€§èƒ½ä¼˜åŒ–](#7-æ¢å¤æ€§èƒ½ä¼˜åŒ–)
8. [æ¢å¤æ•…éšœæ’æŸ¥](#8-æ¢å¤æ•…éšœæ’æŸ¥)
9. [æ¢å¤éªŒè¯ä¸æ£€æŸ¥](#9-æ¢å¤éªŒè¯ä¸æ£€æŸ¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ XtraBackupæ¢å¤æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯XtraBackupæ¢å¤


**XtraBackupæ¢å¤**æ˜¯æŒ‡ä½¿ç”¨Percona XtraBackupå·¥å…·åˆ›å»ºçš„å¤‡ä»½æ–‡ä»¶æ¥è¿˜åŸMySQLæ•°æ®åº“çš„è¿‡ç¨‹ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¹‹å‰"æ‹å¿«ç…§"çš„æ•°æ®é‡æ–°"è£…å›"åˆ°æ•°æ®åº“ä¸­ã€‚

```
æ¢å¤æµç¨‹ç®€å›¾ï¼š
å¤‡ä»½æ–‡ä»¶ â†’ å‡†å¤‡é˜¶æ®µ â†’ è¿˜åŸåˆ°ç›®æ ‡ä½ç½® â†’ å¯åŠ¨æ•°æ®åº“ â†’ éªŒè¯æ•°æ®

å°±åƒä»ç…§ç‰‡å†²æ´—èƒ¶å·ä¸€æ ·ï¼š
èƒ¶å·(å¤‡ä»½) â†’ å†²æ´—(prepare) â†’ æ‰“å°(restore) â†’ æŸ¥çœ‹æ•ˆæœ(éªŒè¯)
```

### 1.2 æ¢å¤çš„æ ¸å¿ƒæ¦‚å¿µ


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦æ¢å¤ï¼Ÿ**
- **ç¡¬ä»¶æ•…éšœ**ï¼šæœåŠ¡å™¨ç£ç›˜æŸåã€ä¸»æ¿çƒ§æ¯
- **äººä¸ºè¯¯æ“ä½œ**ï¼šè¯¯åˆ æ•°æ®åº“ã€é”™è¯¯çš„UPDATEè¯­å¥
- **è½¯ä»¶æ•…éšœ**ï¼šMySQLå´©æºƒã€æ–‡ä»¶ç³»ç»ŸæŸå
- **ç¾éš¾åœºæ™¯**ï¼šæœºæˆ¿æ–­ç”µã€è‡ªç„¶ç¾å®³

**ğŸ”¸ æ¢å¤çš„æœ¬è´¨**
```
æ¢å¤ = å°†æ•°æ®åº“çŠ¶æ€å›æ»šåˆ°å¤‡ä»½æ—¶åˆ»çš„çŠ¶æ€
å¤‡ä»½æ—¶åˆ»ï¼š2024-01-01 10:00:00
æ¢å¤åï¼šæ•°æ®åº“çŠ¶æ€å®Œå…¨å›åˆ°è¿™ä¸ªæ—¶é—´ç‚¹
```

### 1.3 XtraBackupæ¢å¤çš„ä¼˜åŠ¿


**âš¡ ç›¸æ¯”å…¶ä»–æ¢å¤æ–¹å¼çš„ä¼˜ç‚¹**
- **ç‰©ç†å¤‡ä»½**ï¼šç›´æ¥æ“ä½œæ•°æ®æ–‡ä»¶ï¼Œé€Ÿåº¦å¿«
- **çƒ­å¤‡ä»½å…¼å®¹**ï¼šå¯ä»¥æ¢å¤åœ¨çº¿å¤‡ä»½çš„æ•°æ®
- **å¢é‡æ”¯æŒ**ï¼šæ”¯æŒå¢é‡å¤‡ä»½çš„æ¢å¤
- **ä¸€è‡´æ€§ä¿è¯**ï¼šäº‹åŠ¡ä¸€è‡´æ€§çš„å®Œæ•´æ¢å¤

```
æ¢å¤é€Ÿåº¦å¯¹æ¯”ï¼š
mysqldumpé€»è¾‘æ¢å¤ï¼š  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ æ…¢
XtraBackupç‰©ç†æ¢å¤ï¼š â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ å¿«

æ•°æ®é‡100GBçš„æ¢å¤æ—¶é—´ï¼š
mysqldumpï¼š  çº¦8-12å°æ—¶
XtraBackupï¼š çº¦30åˆ†é’Ÿ-2å°æ—¶
```

---

## 2. ğŸ› ï¸ å¤‡ä»½æ–‡ä»¶å‡†å¤‡ï¼ˆPrepareï¼‰


### 2.1 Prepareé˜¶æ®µçš„ä½œç”¨


**ğŸ”¸ ä»€ä¹ˆæ˜¯Prepareï¼Ÿ**
Prepareå°±åƒæ˜¯"æ•´ç†æ··ä¹±çš„æˆ¿é—´"ï¼ŒæŠŠå¤‡ä»½æ–‡ä»¶ä¸­ä¸ä¸€è‡´çš„æ•°æ®æ•´ç†æˆå¯ç”¨çŠ¶æ€ã€‚

```
å¤‡ä»½æ—¶çš„çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²æäº¤äº‹åŠ¡ âœ“    â”‚
â”‚ æœªæäº¤äº‹åŠ¡ âœ—    â”‚  â† éœ€è¦å›æ»š
â”‚ éƒ¨åˆ†å†™å…¥æ•°æ® ?   â”‚  â† éœ€è¦å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Prepareåçš„çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·²æäº¤äº‹åŠ¡ âœ“    â”‚  â† ä¿ç•™
â”‚ å›æ»šæœªæäº¤äº‹åŠ¡   â”‚  â† å·²æ¸…ç†
â”‚ å®Œæ•´ä¸€è‡´æ€§æ•°æ®   â”‚  â† å¯ç”¨çŠ¶æ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®Œæ•´å¤‡ä»½çš„Prepare


**ğŸ“ åŸºæœ¬Prepareå‘½ä»¤**
```bash
# å‡†å¤‡å®Œæ•´å¤‡ä»½
xtrabackup --prepare --target-dir=/backup/full_backup_2024-01-01

# å‘½ä»¤è§£é‡Šï¼š
# --prepareï¼šå¯åŠ¨å‡†å¤‡æ¨¡å¼
# --target-dirï¼šæŒ‡å®šå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•
```

**ğŸ” Prepareè¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ**
```
1. åº”ç”¨redo logï¼ˆé‡åšæ—¥å¿—ï¼‰
   â””â”€â”€ ç¡®ä¿å·²æäº¤äº‹åŠ¡çš„æ•°æ®å®Œæ•´å†™å…¥

2. å›æ»šundo logï¼ˆæ’¤é”€æ—¥å¿—ï¼‰  
   â””â”€â”€ æ¸…ç†æœªæäº¤äº‹åŠ¡çš„æ•°æ®

3. åˆ›å»ºç»Ÿä¸€çš„æ•°æ®çŠ¶æ€
   â””â”€â”€ å½¢æˆäº‹åŠ¡ä¸€è‡´æ€§å¿«ç…§
```

### 2.3 å¢é‡å¤‡ä»½çš„Prepare


**ğŸ“ å¢é‡å¤‡ä»½Prepareæµç¨‹**
```bash
# ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡åŸºç¡€å¤‡ä»½ï¼ˆä¸è¦rollbackï¼‰
xtrabackup --prepare --apply-log-only --target-dir=/backup/base

# ç¬¬äºŒæ­¥ï¼šåº”ç”¨ç¬¬ä¸€ä¸ªå¢é‡å¤‡ä»½
xtrabackup --prepare --apply-log-only \
  --target-dir=/backup/base \
  --incremental-dir=/backup/inc1

# ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨ç¬¬äºŒä¸ªå¢é‡å¤‡ä»½
xtrabackup --prepare --apply-log-only \
  --target-dir=/backup/base \
  --incremental-dir=/backup/inc2

# æœ€åä¸€æ­¥ï¼šæœ€ç»ˆå‡†å¤‡ï¼ˆæ‰§è¡Œrollbackï¼‰
xtrabackup --prepare --target-dir=/backup/base
```

**âš ï¸ å…³é”®å‚æ•°è¯´æ˜**
- `--apply-log-only`ï¼šåªåº”ç”¨æ—¥å¿—ï¼Œä¸æ‰§è¡Œå›æ»š
- `--incremental-dir`ï¼šæŒ‡å®šå¢é‡å¤‡ä»½ç›®å½•

```
å¢é‡åˆå¹¶è¿‡ç¨‹å›¾ç¤ºï¼š

åŸºç¡€å¤‡ä»½     ç¬¬1ä¸ªå¢é‡     ç¬¬2ä¸ªå¢é‡     æœ€ç»ˆçŠ¶æ€
   ğŸ“¦    +     ğŸ“¦     +     ğŸ“¦     =    ğŸ“¦
  Base       Inc1        Inc2       Ready
   â”‚           â”‚           â”‚           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            åˆå¹¶è¿‡ç¨‹       å¯ç”¨çŠ¶æ€
```

### 2.4 Prepareå¸¸è§é€‰é¡¹


| å‚æ•° | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `--use-memory=4G` | **è®¾ç½®å†…å­˜ä½¿ç”¨é‡** | `å¤§æ•°æ®é‡å¤‡ä»½ï¼ŒåŠ é€Ÿå¤„ç†` |
| `--apply-log-only` | **ä»…åº”ç”¨æ—¥å¿—** | `å¢é‡å¤‡ä»½åˆå¹¶è¿‡ç¨‹` |
| `--export` | **å¯¼å‡ºè¡¨ç©ºé—´** | `éƒ¨åˆ†è¡¨æ¢å¤` |

**ğŸ’¡ å†…å­˜ä¼˜åŒ–ç¤ºä¾‹**
```bash
# ä½¿ç”¨æ›´å¤šå†…å­˜åŠ é€Ÿprepare
xtrabackup --prepare --use-memory=8G --target-dir=/backup/full
```

---

## 3. ğŸ”„ å®Œæ•´æ¢å¤æµç¨‹


### 3.1 æ¢å¤å‰çš„å‡†å¤‡å·¥ä½œ


**ğŸ”¸ ç¯å¢ƒæ£€æŸ¥æ¸…å•**
- [ ] **åœæ­¢MySQLæœåŠ¡**ï¼šç¡®ä¿æ•°æ®ç›®å½•ä¸è¢«å ç”¨
- [ ] **å¤‡ä»½ç°æœ‰æ•°æ®**ï¼šä¸‡ä¸€æ¢å¤å¤±è´¥è¿˜èƒ½å›é€€
- [ ] **æ£€æŸ¥ç£ç›˜ç©ºé—´**ï¼šç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´
- [ ] **éªŒè¯å¤‡ä»½å®Œæ•´æ€§**ï¼šç¡®è®¤å¤‡ä»½æ–‡ä»¶å¯ç”¨

```bash
# 1. åœæ­¢MySQLæœåŠ¡
systemctl stop mysql
# æˆ–è€…
service mysql stop

# 2. å¤‡ä»½å½“å‰æ•°æ®ç›®å½•ï¼ˆå¦‚æœè¿˜æœ‰ä»·å€¼ï¼‰
mv /var/lib/mysql /var/lib/mysql.backup.$(date +%Y%m%d)

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h /var/lib/mysql
```

### 3.2 æ‰§è¡Œå®Œæ•´æ¢å¤


**ğŸ“ æ ‡å‡†æ¢å¤å‘½ä»¤**
```bash
# æ¢å¤åˆ°é»˜è®¤æ•°æ®ç›®å½•
xtrabackup --copy-back --target-dir=/backup/prepared_backup

# æ¢å¤åˆ°æŒ‡å®šç›®å½•
xtrabackup --copy-back \
  --target-dir=/backup/prepared_backup \
  --datadir=/custom/mysql/data
```

**ğŸ” copy-backè¿‡ç¨‹è¯¦è§£**
```
copy-backåšäº†ä»€ä¹ˆï¼š

1. åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„
   /var/lib/mysql/
   â”œâ”€â”€ mysql/          â† ç³»ç»Ÿæ•°æ®åº“
   â”œâ”€â”€ performance_schema/
   â”œâ”€â”€ database1/      â† ç”¨æˆ·æ•°æ®åº“
   â””â”€â”€ database2/

2. å¤åˆ¶æ•°æ®æ–‡ä»¶
   ib_logfile0, ib_logfile1  â† InnoDBæ—¥å¿—æ–‡ä»¶
   ibdata1                   â† InnoDBç³»ç»Ÿè¡¨ç©ºé—´
   *.frm, *.ibd             â† è¡¨ç»“æ„å’Œæ•°æ®æ–‡ä»¶

3. è®¾ç½®æ–‡ä»¶æƒé™
   æ‰€æœ‰æ–‡ä»¶è®¾ç½®ä¸ºmysqlç”¨æˆ·å’Œç»„
```

### 3.3 æ¢å¤åçš„é…ç½®


**ğŸ”§ æƒé™ä¿®å¤**
```bash
# ä¿®å¤æ–‡ä»¶æ‰€æœ‰è€…
chown -R mysql:mysql /var/lib/mysql

# ä¿®å¤ç›®å½•æƒé™
chmod 750 /var/lib/mysql
chmod 660 /var/lib/mysql/*
```

**ğŸš€ å¯åŠ¨æ•°æ®åº“**
```bash
# å¯åŠ¨MySQLæœåŠ¡
systemctl start mysql

# æ£€æŸ¥å¯åŠ¨çŠ¶æ€
systemctl status mysql

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼ˆå¦‚æœå¯åŠ¨å¤±è´¥ï¼‰
tail -f /var/log/mysql/error.log
```

### 3.4 å®Œæ•´æ¢å¤ç¤ºä¾‹


```bash
#!/bin/bash
# å®Œæ•´æ¢å¤è„šæœ¬ç¤ºä¾‹

echo "å¼€å§‹æ¢å¤MySQLæ•°æ®åº“..."

# 1. åœæ­¢MySQL
systemctl stop mysql

# 2. å¤‡ä»½ç°æœ‰æ•°æ®
if [ -d "/var/lib/mysql" ]; then
    mv /var/lib/mysql /var/lib/mysql.backup.$(date +%Y%m%d_%H%M%S)
fi

# 3. æ‰§è¡Œæ¢å¤
xtrabackup --copy-back --target-dir=/backup/prepared_backup

# 4. ä¿®å¤æƒé™
chown -R mysql:mysql /var/lib/mysql

# 5. å¯åŠ¨MySQL
systemctl start mysql

echo "æ¢å¤å®Œæˆï¼"
```

---

## 4. ğŸ“ˆ å¢é‡æ¢å¤æ“ä½œ


### 4.1 å¢é‡æ¢å¤çš„æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯å¢é‡æ¢å¤ï¼Ÿ**
å¢é‡æ¢å¤å°±åƒ"è¡¥ä¸æ›´æ–°"ï¼Œå…ˆæ¢å¤åŸºç¡€å¤‡ä»½ï¼Œç„¶åé€ä¸ªåº”ç”¨å¢é‡å¤‡ä»½ã€‚

```
å¢é‡æ¢å¤æ—¶é—´çº¿ï¼š

å‘¨æ—¥å…¨å¤‡    å‘¨ä¸€å¢é‡    å‘¨äºŒå¢é‡    å‘¨ä¸‰å¢é‡
   ğŸ“¦   â†’     ğŸ“¦    â†’     ğŸ“¦    â†’     ğŸ“¦
  100%      +10%       +15%       +12%

æ¢å¤åˆ°å‘¨ä¸‰ = å…¨å¤‡ + å‘¨ä¸€å¢é‡ + å‘¨äºŒå¢é‡ + å‘¨ä¸‰å¢é‡
```

### 4.2 å¢é‡æ¢å¤çš„æ­¥éª¤


**ğŸ“‹ è¯¦ç»†æ¢å¤æµç¨‹**

```bash
# æ­¥éª¤1ï¼šå‡†å¤‡åŸºç¡€å¤‡ä»½
xtrabackup --prepare --apply-log-only \
  --target-dir=/backup/base_backup

# æ­¥éª¤2ï¼šé€ä¸ªåº”ç”¨å¢é‡å¤‡ä»½
# åº”ç”¨ç¬¬1ä¸ªå¢é‡
xtrabackup --prepare --apply-log-only \
  --target-dir=/backup/base_backup \
  --incremental-dir=/backup/inc_backup_day1

# åº”ç”¨ç¬¬2ä¸ªå¢é‡
xtrabackup --prepare --apply-log-only \
  --target-dir=/backup/base_backup \
  --incremental-dir=/backup/inc_backup_day2

# æ­¥éª¤3ï¼šæœ€ç»ˆå‡†å¤‡ï¼ˆæ³¨æ„ï¼šå»æ‰apply-log-onlyï¼‰
xtrabackup --prepare --target-dir=/backup/base_backup

# æ­¥éª¤4ï¼šæ‰§è¡Œæ¢å¤
xtrabackup --copy-back --target-dir=/backup/base_backup
```

### 4.3 å¢é‡æ¢å¤æ³¨æ„äº‹é¡¹


> **âš ï¸ é‡è¦æé†’**
> å¢é‡å¤‡ä»½å¿…é¡»æŒ‰ç…§**æ—¶é—´é¡ºåº**ä¾æ¬¡åº”ç”¨ï¼Œä¸èƒ½è·³è¿‡ä»»ä½•ä¸€ä¸ªå¢é‡å¤‡ä»½

```
æ­£ç¡®çš„é¡ºåºï¼š
åŸºç¡€å¤‡ä»½ â†’ å¢é‡1 â†’ å¢é‡2 â†’ å¢é‡3 âœ“

é”™è¯¯çš„é¡ºåºï¼š
åŸºç¡€å¤‡ä»½ â†’ å¢é‡1 â†’ å¢é‡3 âœ—ï¼ˆè·³è¿‡äº†å¢é‡2ï¼‰
åŸºç¡€å¤‡ä»½ â†’ å¢é‡2 â†’ å¢é‡1 âœ—ï¼ˆé¡ºåºé¢ å€’ï¼‰
```

**ğŸ” LSNæ£€æŸ¥**
æ¯ä¸ªå¢é‡å¤‡ä»½éƒ½æœ‰LSNï¼ˆLog Sequence Numberï¼‰èŒƒå›´ï¼š
```bash
# æŸ¥çœ‹å¤‡ä»½çš„LSNä¿¡æ¯
cat /backup/base_backup/xtrabackup_info | grep lsn
cat /backup/inc_backup_day1/xtrabackup_info | grep lsn

# LSNå¿…é¡»è¿ç»­ï¼š
# åŸºç¡€å¤‡ä»½ï¼šfrom_lsn=0 to_lsn=1000
# å¢é‡1ï¼š  from_lsn=1000 to_lsn=1500  âœ“ è¿ç»­
# å¢é‡2ï¼š  from_lsn=1500 to_lsn=2000  âœ“ è¿ç»­
```

---

## 5. ğŸ¯ éƒ¨åˆ†æ•°æ®æ¢å¤


### 5.1 ä»€ä¹ˆæ˜¯éƒ¨åˆ†æ•°æ®æ¢å¤


**ğŸ”¸ åº”ç”¨åœºæ™¯**
éƒ¨åˆ†æ¢å¤å°±åƒ"ç²¾ç¡®æ‰‹æœ¯"ï¼Œåªæ¢å¤éœ€è¦çš„æ•°æ®åº“æˆ–è¡¨ï¼Œè€Œä¸æ˜¯æ•´ä¸ªMySQLå®ä¾‹ã€‚

```
åœºæ™¯ç¤ºä¾‹ï¼š
è¯¯åˆ äº†æŸä¸ªé‡è¦è¡¨ â†’ åªæ¢å¤è¿™ä¸ªè¡¨
æŸä¸ªæ•°æ®åº“æŸå   â†’ åªæ¢å¤è¿™ä¸ªæ•°æ®åº“
éœ€è¦å†å²æ•°æ®     â†’ æ¢å¤åˆ°æµ‹è¯•ç¯å¢ƒå¯¹æ¯”
```

### 5.2 å•ä¸ªæ•°æ®åº“æ¢å¤


**ğŸ“ æ¢å¤æŒ‡å®šæ•°æ®åº“**
```bash
# 1. å‡†å¤‡å¤‡ä»½ï¼ˆå¯¼å‡ºæ¨¡å¼ï¼‰
xtrabackup --prepare --export --target-dir=/backup/full_backup

# 2. åªå¤åˆ¶æŒ‡å®šæ•°æ®åº“
mkdir -p /tmp/restore_db
cp -r /backup/full_backup/target_database /tmp/restore_db/

# 3. åœ¨ç›®æ ‡MySQLä¸­åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE target_database;"

# 4. å¯¼å…¥è¡¨ç»“æ„
mysql -u root -p target_database < /tmp/restore_db/target_database/*.sql
```

### 5.3 å•ä¸ªè¡¨æ¢å¤


**ğŸ“ ä½¿ç”¨transportable tablespace**
```sql
-- 1. åœ¨ç›®æ ‡æ•°æ®åº“ä¸­åˆ›å»ºç›¸åŒè¡¨ç»“æ„
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(255)
) ENGINE=InnoDB;

-- 2. ä¸¢å¼ƒç°æœ‰è¡¨ç©ºé—´
ALTER TABLE users DISCARD TABLESPACE;
```

```bash
# 3. å¤åˆ¶å¤‡ä»½æ–‡ä»¶ä¸­çš„è¡¨æ–‡ä»¶
cp /backup/prepared/mydb/users.ibd /var/lib/mysql/mydb/
cp /backup/prepared/mydb/users.cfg /var/lib/mysql/mydb/

# 4. ä¿®å¤æƒé™
chown mysql:mysql /var/lib/mysql/mydb/users.*
```

```sql
-- 5. å¯¼å…¥è¡¨ç©ºé—´
ALTER TABLE users IMPORT TABLESPACE;
```

### 5.4 éƒ¨åˆ†æ¢å¤çš„å®é™…æ¡ˆä¾‹


**ğŸ’¼ æ¡ˆä¾‹ï¼šè¯¯åˆ ç”¨æˆ·è¡¨æ¢å¤**
```bash
#!/bin/bash
# æ¢å¤è¯¯åˆ çš„usersè¡¨

echo "å¼€å§‹æ¢å¤usersè¡¨..."

# 1. å‡†å¤‡å¯¼å‡ºå¤‡ä»½
xtrabackup --prepare --export --target-dir=/backup/last_full

# 2. åœ¨å¦ä¸€ä¸ªä¸´æ—¶MySQLå®ä¾‹ä¸­æ¢å¤å®Œæ•´æ•°æ®
xtrabackup --copy-back --target-dir=/backup/last_full --datadir=/tmp/mysql_temp

# 3. å¯åŠ¨ä¸´æ—¶å®ä¾‹å¹¶å¯¼å‡ºusersè¡¨
mysqldump -h127.0.0.1 -P3307 -uroot mydb users > /tmp/users_recovery.sql

# 4. å¯¼å…¥åˆ°ç”Ÿäº§ç¯å¢ƒ
mysql -uroot -p mydb < /tmp/users_recovery.sql

echo "ç”¨æˆ·è¡¨æ¢å¤å®Œæˆï¼"
```

---

## 6. â° æ¢å¤åˆ°æŒ‡å®šæ—¶é—´ç‚¹


### 6.1 ç‚¹æ—¶é—´æ¢å¤ï¼ˆPITRï¼‰æ¦‚å¿µ


**ğŸ”¸ ä»€ä¹ˆæ˜¯PITRï¼Ÿ**
Point-In-Time Recoveryï¼ˆPITRï¼‰æ˜¯æŒ‡æ¢å¤æ•°æ®åº“åˆ°æŸä¸ªç²¾ç¡®çš„æ—¶é—´ç‚¹ï¼Œæ¯”å¦‚"æ¢å¤åˆ°ä»Šå¤©ä¸Šåˆ10:30åˆ†çš„çŠ¶æ€"ã€‚

```
æ—¶é—´çº¿æ¢å¤ç¤ºä¾‹ï¼š

å‘¨æ—¥å…¨å¤‡          è¯¯æ“ä½œæ—¶é—´         å½“å‰æ—¶é—´
   ğŸ“¦â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âŒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â°
09:00            14:30           16:00
   â”‚                â”‚             â”‚
   â””â”€â”€ æ¢å¤ç›®æ ‡ï¼š14:29åˆ†çš„çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”˜
   
é€šè¿‡ï¼šå…¨å¤‡ + binlogé‡æ”¾ å®ç°ç²¾ç¡®æ¢å¤
```

### 6.2 PITRæ¢å¤æµç¨‹


**ğŸ“‹ å®Œæ•´PITRæ­¥éª¤**

```bash
# æ­¥éª¤1ï¼šæ¢å¤åˆ°æœ€è¿‘çš„å®Œæ•´å¤‡ä»½
xtrabackup --copy-back --target-dir=/backup/sunday_full

# æ­¥éª¤2ï¼šå¯åŠ¨MySQLåˆ°ä¸´æ—¶çŠ¶æ€
systemctl start mysql

# æ­¥éª¤3ï¼šç¡®å®šbinlogä½ç½®
# æŸ¥çœ‹å¤‡ä»½æ—¶çš„binlogä½ç½®
cat /backup/sunday_full/xtrabackup_binlog_info
# è¾“å‡ºï¼šmysql-bin.000001  154692

# æ­¥éª¤4ï¼šåº”ç”¨binlogåˆ°æŒ‡å®šæ—¶é—´ç‚¹
mysqlbinlog --start-position=154692 \
  --stop-datetime="2024-01-15 14:29:00" \
  /var/lib/mysql/mysql-bin.000001 \
  /var/lib/mysql/mysql-bin.000002 | mysql -uroot -p
```

### 6.3 åŸºäºä½ç½®çš„æ¢å¤


**ğŸ“ ä½¿ç”¨binlog positionæ¢å¤**
```bash
# æŸ¥æ‰¾é—®é¢˜æ“ä½œçš„ç¡®åˆ‡ä½ç½®
mysqlbinlog /var/lib/mysql/mysql-bin.000002 | grep -A5 -B5 "DROP TABLE"

# æ‰¾åˆ°é—®é¢˜ä½ç½®ï¼šposition 245639
# æ¢å¤åˆ°é—®é¢˜ä½ç½®ä¹‹å‰
mysqlbinlog --start-position=154692 \
  --stop-position=245638 \
  mysql-bin.000001 mysql-bin.000002 | mysql -uroot -p
```

### 6.4 PITRå®é™…æ¡ˆä¾‹


**ğŸ’¼ æ¡ˆä¾‹ï¼šæ¢å¤è¯¯åˆ æ•°æ®**
```bash
#!/bin/bash
# åœºæ™¯ï¼š14:30åˆ†è¯¯æ‰§è¡Œäº† DELETE FROM orders WHERE date='2024-01-15'
# éœ€è¦æ¢å¤åˆ°14:29åˆ†çš„çŠ¶æ€

echo "å¼€å§‹ç‚¹æ—¶é—´æ¢å¤..."

# 1. åœæ­¢MySQL
systemctl stop mysql

# 2. å¤‡ä»½å½“å‰æ•°æ®ï¼ˆä¸‡ä¸€éœ€è¦å›é€€ï¼‰
mv /var/lib/mysql /var/lib/mysql.backup

# 3. æ¢å¤åŸºç¡€å¤‡ä»½
xtrabackup --copy-back --target-dir=/backup/daily_backup_20240114

# 4. ä¿®å¤æƒé™å¹¶å¯åŠ¨
chown -R mysql:mysql /var/lib/mysql
systemctl start mysql

# 5. åº”ç”¨binlogåˆ°è¯¯æ“ä½œå‰
mysqlbinlog --start-position=154692 \
  --stop-datetime="2024-01-15 14:29:00" \
  /backup/binlogs/mysql-bin.* | mysql -uroot -p

echo "ç‚¹æ—¶é—´æ¢å¤å®Œæˆï¼æ•°æ®å·²æ¢å¤åˆ°14:29åˆ†çŠ¶æ€"
```

---

## 7. âš¡ æ¢å¤æ€§èƒ½ä¼˜åŒ–


### 7.1 å½±å“æ¢å¤é€Ÿåº¦çš„å› ç´ 


**ğŸ”¸ ä¸»è¦æ€§èƒ½ç“¶é¢ˆ**
```
I/Oç“¶é¢ˆï¼šç£ç›˜è¯»å†™é€Ÿåº¦ï¼ˆæœ€ä¸»è¦ï¼‰
CPUç“¶é¢ˆï¼šæ•°æ®è§£å‹ç¼©ã€æ ¡éªŒè®¡ç®—  
å†…å­˜ç“¶é¢ˆï¼šç¼“å†²åŒºå¤§å°ä¸è¶³
ç½‘ç»œç“¶é¢ˆï¼šè¿œç¨‹æ¢å¤æ—¶çš„ä¼ è¾“é€Ÿåº¦
```

### 7.2 ç£ç›˜I/Oä¼˜åŒ–


**ğŸ’¾ å­˜å‚¨ä¼˜åŒ–ç­–ç•¥**
```bash
# 1. ä½¿ç”¨SSDå­˜å‚¨
# å¤‡ä»½æ–‡ä»¶å’Œæ¢å¤ç›®æ ‡éƒ½ä½¿ç”¨SSD

# 2. å¢åŠ å¹¶è¡ŒI/O
xtrabackup --copy-back \
  --parallel=8 \
  --target-dir=/backup/full

# 3. ä¼˜åŒ–æ–‡ä»¶ç³»ç»Ÿ
# ä½¿ç”¨XFSæ–‡ä»¶ç³»ç»Ÿï¼Œç¦ç”¨atime
mount -o noatime,nodiratime /dev/sdb1 /var/lib/mysql
```

**ğŸ“Š å¹¶è¡Œåº¦è®¾ç½®å‚è€ƒ**
| CPUæ ¸å¿ƒæ•° | å»ºè®®å¹¶è¡Œåº¦ | é€‚ç”¨åœºæ™¯ |
|-----------|-----------|----------|
| 4æ ¸ | `--parallel=4` | `å°å‹ç¯å¢ƒ` |
| 8æ ¸ | `--parallel=6` | `ä¸­å‹ç¯å¢ƒ` |
| 16æ ¸+ | `--parallel=8` | `å¤§å‹ç¯å¢ƒ` |

### 7.3 å†…å­˜ä¼˜åŒ–


**ğŸ§  å†…å­˜å‚æ•°è°ƒä¼˜**
```bash
# Prepareé˜¶æ®µå†…å­˜ä¼˜åŒ–
xtrabackup --prepare \
  --use-memory=8G \
  --target-dir=/backup/full

# ç³»ç»Ÿçº§åˆ«ä¼˜åŒ–
echo 3 > /proc/sys/vm/drop_caches  # æ¸…ç†ç¼“å­˜
echo never > /sys/kernel/mm/transparent_hugepage/enabled
```

### 7.4 ç½‘ç»œä¼ è¾“ä¼˜åŒ–


**ğŸŒ è¿œç¨‹æ¢å¤åŠ é€Ÿ**
```bash
# ä½¿ç”¨å‹ç¼©ä¼ è¾“
xtrabackup --backup --compress \
  --target-dir=/backup/compressed

# æµå¼æ¢å¤ï¼ˆé¿å…ä¸­é—´å­˜å‚¨ï¼‰
xtrabackup --backup --stream=xbstream \
  --target-dir=./ | ssh target-server \
  "xbstream -x -C /var/lib/mysql"
```

### 7.5 æ€§èƒ½ç›‘æ§


**ğŸ“ˆ ç›‘æ§æ¢å¤è¿›åº¦**
```bash
# ç›‘æ§ç£ç›˜I/O
iostat -x 1

# ç›‘æ§è¿›ç¨‹çŠ¶æ€
watch -n1 'ps aux | grep xtrabackup'

# ç›‘æ§æ–‡ä»¶å¤åˆ¶è¿›åº¦
watch -n5 'du -sh /var/lib/mysql'
```

---

## 8. ğŸ”§ æ¢å¤æ•…éšœæ’æŸ¥


### 8.1 å¸¸è§æ¢å¤é”™è¯¯


**âŒ é”™è¯¯1ï¼šæƒé™é—®é¢˜**
```
é”™è¯¯ä¿¡æ¯ï¼š
xtrabackup: Error: cannot open the destination directory '/var/lib/mysql'

è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /var/lib/
# åˆ›å»ºç›®å½•å¹¶è®¾ç½®æƒé™
mkdir -p /var/lib/mysql
chown mysql:mysql /var/lib/mysql
```

**âŒ é”™è¯¯2ï¼šç£ç›˜ç©ºé—´ä¸è¶³**
```
é”™è¯¯ä¿¡æ¯ï¼š
xtrabackup: Error: Write to './ibdata1' failed

è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
# æ¸…ç†ä¸å¿…è¦æ–‡ä»¶æˆ–æ‰©å±•ç£ç›˜
```

**âŒ é”™è¯¯3ï¼šLSNä¸åŒ¹é…**
```
é”™è¯¯ä¿¡æ¯ï¼š
This incremental backup seems to be inconsistent

è§£å†³æ–¹æ¡ˆï¼š
# æ£€æŸ¥LSNåºåˆ—
cat /backup/*/xtrabackup_info | grep last_lsn
# ç¡®ä¿å¢é‡å¤‡ä»½é¡ºåºæ­£ç¡®
```

### 8.2 Prepareé˜¶æ®µæ•…éšœ


**ğŸ” Prepareå¤±è´¥è¯Šæ–­**
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
xtrabackup --prepare --target-dir=/backup/full 2>&1 | tee prepare.log

# å¸¸è§prepareé”™è¯¯ï¼š
# 1. å†…å­˜ä¸è¶³
xtrabackup --prepare --use-memory=2G --target-dir=/backup/full

# 2. æŸåçš„å¤‡ä»½æ–‡ä»¶
xtrabackup --prepare --force-non-empty-directories --target-dir=/backup/full
```

### 8.3 MySQLå¯åŠ¨å¤±è´¥


**ğŸš¨ å¯åŠ¨æ•…éšœå¤„ç†**
```bash
# 1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/mysql/error.log

# 2. å¸¸è§å¯åŠ¨é—®é¢˜å¤„ç†
# InnoDBå´©æºƒæ¢å¤
echo "innodb_force_recovery = 1" >> /etc/mysql/my.cnf
systemctl start mysql

# æƒé™é—®é¢˜
chown -R mysql:mysql /var/lib/mysql
chmod 750 /var/lib/mysql
chmod 660 /var/lib/mysql/*

# ç«¯å£å ç”¨
netstat -tlnp | grep 3306
```

### 8.4 æ•…éšœæ’æŸ¥å·¥å…·åŒ…


**ğŸ› ï¸ è¯Šæ–­è„šæœ¬**
```bash
#!/bin/bash
# XtraBackupæ¢å¤è¯Šæ–­è„šæœ¬

echo "=== XtraBackupæ¢å¤è¯Šæ–­ ==="

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
if [ -f "$1/xtrabackup_info" ]; then
    echo "âœ“ å¤‡ä»½ä¿¡æ¯æ–‡ä»¶å­˜åœ¨"
    grep -E "(start_time|end_time|binlog)" "$1/xtrabackup_info"
else
    echo "âœ— å¤‡ä»½ä¿¡æ¯æ–‡ä»¶ç¼ºå¤±"
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
echo -e "\n=== ç£ç›˜ç©ºé—´æ£€æŸ¥ ==="
df -h | grep -E "(æ–‡ä»¶ç³»ç»Ÿ|/var)"

# æ£€æŸ¥MySQLè¿›ç¨‹
echo -e "\n=== MySQLè¿›ç¨‹çŠ¶æ€ ==="
ps aux | grep mysql | grep -v grep

# æ£€æŸ¥ç«¯å£å ç”¨
echo -e "\n=== ç«¯å£æ£€æŸ¥ ==="
netstat -tlnp | grep 3306

echo -e "\nè¯Šæ–­å®Œæˆï¼"
```

---

## 9. âœ… æ¢å¤éªŒè¯ä¸æ£€æŸ¥


### 9.1 æ•°æ®å®Œæ•´æ€§éªŒè¯


**ğŸ” åŸºæœ¬éªŒè¯æ­¥éª¤**
```sql
-- 1. æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨
SHOW DATABASES;

-- 2. æ£€æŸ¥è¡¨æ•°é‡
SELECT COUNT(*) FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema');

-- 3. æ£€æŸ¥æ•°æ®è¡Œæ•°
SELECT table_schema, table_name, table_rows 
FROM information_schema.tables 
WHERE table_schema = 'your_database';

-- 4. æ£€æŸ¥ç´¢å¼•çŠ¶æ€
SHOW INDEX FROM your_table;
```

### 9.2 ä¸šåŠ¡æ•°æ®éªŒè¯


**ğŸ“Š å…³é”®ä¸šåŠ¡æŒ‡æ ‡æ£€æŸ¥**
```sql
-- æ£€æŸ¥å…³é”®è¡¨çš„æ•°æ®é‡
SELECT 
    'ç”¨æˆ·è¡¨' as table_name,
    COUNT(*) as record_count,
    MAX(created_at) as latest_record
FROM users
UNION ALL
SELECT 
    'è®¢å•è¡¨' as table_name,
    COUNT(*) as record_count,
    MAX(order_date) as latest_record  
FROM orders;

-- æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
SELECT 
    COUNT(DISTINCT user_id) as unique_users_in_orders,
    (SELECT COUNT(*) FROM users) as total_users
FROM orders;
```

### 9.3 æ—¶é—´ç‚¹éªŒè¯


**â° éªŒè¯æ¢å¤æ—¶é—´ç‚¹**
```sql
-- æ£€æŸ¥æœ€åçš„æ“ä½œæ—¶é—´
SELECT MAX(updated_at) as last_update_time FROM your_table;

-- æ£€æŸ¥binlogä½ç½®ï¼ˆå¦‚æœæ˜¯PITRæ¢å¤ï¼‰
SHOW MASTER STATUS;

-- éªŒè¯ç‰¹å®šæ—¶é—´ç‚¹çš„æ•°æ®
SELECT COUNT(*) FROM orders 
WHERE order_date = '2024-01-15' AND order_time < '14:30:00';
```

### 9.4 æ€§èƒ½éªŒè¯


**âš¡ æ•°æ®åº“æ€§èƒ½æ£€æŸ¥**
```sql
-- æ£€æŸ¥è¡¨çŠ¶æ€
CHECK TABLE your_important_table;

-- åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE your_important_table;

-- æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ
EXPLAIN SELECT * FROM your_table WHERE indexed_column = 'value';
```

### 9.5 éªŒè¯æ¸…å•


**ğŸ“‹ æ¢å¤åæ£€æŸ¥æ¸…å•**
- [ ] **æ•°æ®åº“å¯åŠ¨æ­£å¸¸**ï¼šæ— é”™è¯¯æ—¥å¿—
- [ ] **æ‰€æœ‰æ•°æ®åº“å­˜åœ¨**ï¼šæ£€æŸ¥æ•°æ®åº“åˆ—è¡¨
- [ ] **è¡¨ç»“æ„å®Œæ•´**ï¼šéªŒè¯å…³é”®è¡¨ç»“æ„
- [ ] **æ•°æ®è¡Œæ•°æ­£ç¡®**ï¼šå¯¹æ¯”å¤‡ä»½å‰çš„ç»Ÿè®¡
- [ ] **ç´¢å¼•çŠ¶æ€æ­£å¸¸**ï¼šæ£€æŸ¥ç´¢å¼•å®Œæ•´æ€§
- [ ] **å¤–é”®çº¦æŸæ­£ç¡®**ï¼šéªŒè¯å…³è”å…³ç³»
- [ ] **è§¦å‘å™¨å’Œå­˜å‚¨è¿‡ç¨‹**ï¼šæ£€æŸ¥ç¨‹åºå¯¹è±¡
- [ ] **ç”¨æˆ·æƒé™æ­£å¸¸**ï¼šéªŒè¯åº”ç”¨è¿æ¥
- [ ] **æ€§èƒ½è¡¨ç°æ­£å¸¸**ï¼šæ‰§è¡Œæ€§èƒ½æµ‹è¯•
- [ ] **ä¸šåŠ¡åŠŸèƒ½å¯ç”¨**ï¼šè¿›è¡Œä¸šåŠ¡éªŒè¯

```bash
# è‡ªåŠ¨åŒ–éªŒè¯è„šæœ¬
#!/bin/bash
mysql -uroot -p << EOF
SELECT 'Database List:' as info;
SHOW DATABASES;

SELECT 'Table Count:' as info;
SELECT COUNT(*) as total_tables FROM information_schema.tables 
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema');

SELECT 'Engine Status:' as info;
SHOW ENGINE INNODB STATUS\G
EOF
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ¢å¤æœ¬è´¨ï¼šå°†æ•°æ®åº“çŠ¶æ€æ¢å¤åˆ°å¤‡ä»½æ—¶åˆ»
ğŸ”¸ Prepareé˜¶æ®µï¼šæ•´ç†å¤‡ä»½æ–‡ä»¶ä¸ºå¯ç”¨çŠ¶æ€ï¼Œåº”ç”¨redoå’Œå›æ»šundo
ğŸ”¸ å®Œæ•´æ¢å¤ï¼šåœæœåŠ¡ â†’ copy-back â†’ ä¿®æƒé™ â†’ å¯åŠ¨éªŒè¯
ğŸ”¸ å¢é‡æ¢å¤ï¼šæŒ‰æ—¶é—´é¡ºåºä¾æ¬¡åº”ç”¨å¢é‡å¤‡ä»½
ğŸ”¸ PITRæ¢å¤ï¼šå¤‡ä»½+binlogé‡æ”¾å®ç°ç²¾ç¡®æ—¶é—´ç‚¹æ¢å¤
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå¹¶è¡Œå¤„ç†ã€å†…å­˜è°ƒä¼˜ã€I/Oä¼˜åŒ–
ğŸ”¸ æ•…éšœæ’æŸ¥ï¼šæƒé™ã€ç©ºé—´ã€LSNã€å¯åŠ¨é—®é¢˜çš„è¯Šæ–­æ–¹æ³•
ğŸ”¸ éªŒè¯æ£€æŸ¥ï¼šæ•°æ®å®Œæ•´æ€§ã€ä¸šåŠ¡ä¸€è‡´æ€§ã€æ€§èƒ½æ­£å¸¸æ€§
```

### 10.2 å…³é”®æ“ä½œè¦ç‚¹


**ğŸ”¹ Prepareé˜¶æ®µå…³é”®ç‚¹**
```
å®Œæ•´å¤‡ä»½ï¼šç›´æ¥prepareå³å¯
å¢é‡å¤‡ä»½ï¼šå¿…é¡»æŒ‰é¡ºåºï¼Œä½¿ç”¨apply-log-onlyï¼ˆé™¤æœ€åä¸€æ­¥ï¼‰
æœ€ç»ˆå‡†å¤‡ï¼šå»æ‰apply-log-onlyï¼Œæ‰§è¡Œå®Œæ•´çš„rollback
å†…å­˜ä¼˜åŒ–ï¼šå¤§å¤‡ä»½ä½¿ç”¨--use-memoryå‚æ•°
```

**ğŸ”¹ æ¢å¤æ“ä½œå…³é”®ç‚¹**
```
å®‰å…¨ç¬¬ä¸€ï¼šæ¢å¤å‰å¤‡ä»½ç°æœ‰æ•°æ®
åœæ­¢æœåŠ¡ï¼šç¡®ä¿æ•°æ®ç›®å½•ä¸è¢«å ç”¨
æƒé™ä¿®å¤ï¼šcopy-backåå¿…é¡»ä¿®å¤æ–‡ä»¶æƒé™
æ¸è¿›éªŒè¯ï¼šå¯åŠ¨åé€æ­¥éªŒè¯æ•°æ®å®Œæ•´æ€§
```

**ğŸ”¹ PITRæ¢å¤å…³é”®ç‚¹**
```
æ—¶é—´ç²¾ç¡®ï¼šç¡®å®šå‡†ç¡®çš„æ¢å¤æ—¶é—´ç‚¹
binlogè¿ç»­ï¼šç¡®ä¿binlogæ–‡ä»¶å®Œæ•´è¿ç»­
ä½ç½®ç¡®è®¤ï¼šä½¿ç”¨xtrabackup_binlog_infoç¡®å®šèµ·å§‹ä½ç½®
é€æ­¥åº”ç”¨ï¼šå…ˆæ¢å¤å¤‡ä»½ï¼Œå†åº”ç”¨binlog
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç¾éš¾æ¢å¤**ï¼šç¡¬ä»¶æ•…éšœæ—¶çš„å¿«é€Ÿæ•°æ®æ¢å¤
- **è¯¯æ“ä½œæ¢å¤**ï¼šç²¾ç¡®å›æ»šåˆ°è¯¯æ“ä½œå‰çš„çŠ¶æ€
- **ç¯å¢ƒè¿ç§»**ï¼šç”Ÿäº§æ•°æ®å…‹éš†åˆ°æµ‹è¯•ç¯å¢ƒ
- **ç‰ˆæœ¬å›é€€**ï¼šåº”ç”¨å‡çº§å¤±è´¥æ—¶çš„æ•°æ®å›é€€
- **åˆè§„å®¡è®¡**ï¼šæ¢å¤ç‰¹å®šæ—¶é—´ç‚¹æ•°æ®è¿›è¡Œå®¡è®¡

**ğŸ”§ è¿ç»´å®è·µ**
- **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šç¼–å†™æ ‡å‡†åŒ–æ¢å¤æµç¨‹è„šæœ¬
- **ç›‘æ§å‘Šè­¦**ï¼šç›‘æ§æ¢å¤è¿‡ç¨‹å’Œç»“æœ
- **æ–‡æ¡£è®°å½•**ï¼šè¯¦ç»†è®°å½•æ¢å¤æ“ä½œå’ŒéªŒè¯ç»“æœ
- **æ¼”ç»ƒæµ‹è¯•**ï¼šå®šæœŸè¿›è¡Œæ¢å¤æ¼”ç»ƒéªŒè¯å¤‡ä»½å¯ç”¨æ€§

**ğŸš¨ æ³¨æ„äº‹é¡¹**
- **æ¢å¤ä¸æ˜¯ä¸‡èƒ½çš„**ï¼šå®šæœŸéªŒè¯å¤‡ä»½çš„å¯ç”¨æ€§
- **æ—¶é—´çª—å£æœ‰é™**ï¼šbinlogä¿ç•™æ—¶é—´é™åˆ¶PITRèŒƒå›´
- **æ€§èƒ½å½±å“**ï¼šå¤§æ•°æ®é‡æ¢å¤éœ€è¦è€ƒè™‘ä¸šåŠ¡åœæœºæ—¶é—´
- **æƒé™å®‰å…¨**ï¼šæ¢å¤è¿‡ç¨‹ä¸­æ³¨æ„æ•°æ®å®‰å…¨å’Œè®¿é—®æ§åˆ¶

**æ ¸å¿ƒè®°å¿†**ï¼š
- XtraBackupæ¢å¤ä¸‰æ­¥èµ°ï¼šprepareã€copy-backã€éªŒè¯
- å¢é‡æ¢å¤æŒ‰æ—¶åºï¼ŒLSNæ£€æŸ¥å¾ˆé‡è¦
- PITRæ¢å¤è¦ç²¾ç¡®ï¼Œå¤‡ä»½åŠ binlogç»„åˆæ‹³
- æ€§èƒ½ä¼˜åŒ–å¤šæ–¹é¢ï¼ŒI/Oå†…å­˜å¹¶è¡Œåº¦
- æ•…éšœæ’æŸ¥æœ‰å¥—è·¯ï¼Œæƒé™ç©ºé—´LSNæŸ¥
- éªŒè¯æ£€æŸ¥è¦å…¨é¢ï¼Œæ•°æ®ä¸šåŠ¡æ€§èƒ½çœ‹