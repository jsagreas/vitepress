---
title: 17ã€myloaderæ¢å¤å®æˆ˜æ“ä½œ
---
## ğŸ“š ç›®å½•

1. [myloaderåŸºç¡€æ¦‚å¿µ](#1-myloaderåŸºç¡€æ¦‚å¿µ)
2. [å®Œæ•´æ¢å¤å‘½ä»¤æ“ä½œ](#2-å®Œæ•´æ¢å¤å‘½ä»¤æ“ä½œ)
3. [é€‰æ‹©æ€§æ¢å¤æŠ€æœ¯](#3-é€‰æ‹©æ€§æ¢å¤æŠ€æœ¯)
4. [é«˜çº§æ¢å¤ç­–ç•¥](#4-é«˜çº§æ¢å¤ç­–ç•¥)
5. [æ¢å¤ç›‘æ§ä¸éªŒè¯](#5-æ¢å¤ç›‘æ§ä¸éªŒè¯)
6. [é”™è¯¯å¤„ç†ä¸æœ€ä½³å®è·µ](#6-é”™è¯¯å¤„ç†ä¸æœ€ä½³å®è·µ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”§ myloaderåŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯myloader


**ç®€å•ç†è§£**ï¼šmyloaderå°±æ˜¯mydumperçš„"å…„å¼Ÿå·¥å…·"ï¼Œä¸“é—¨è´Ÿè´£æŠŠå¤‡ä»½æ•°æ®æ¢å¤å›æ•°æ®åº“

```
å¤‡ä»½æµç¨‹ï¼šMySQLæ•°æ®åº“ â†’ mydumper â†’ å¤‡ä»½æ–‡ä»¶
æ¢å¤æµç¨‹ï¼šå¤‡ä»½æ–‡ä»¶ â†’ myloader â†’ MySQLæ•°æ®åº“

å°±åƒå‹ç¼©å’Œè§£å‹ç¼©ï¼š
- mydumper = å‹ç¼©å·¥å…·ï¼ˆæŠŠæ•°æ®å‹æˆå¤‡ä»½æ–‡ä»¶ï¼‰
- myloader = è§£å‹å·¥å…·ï¼ˆæŠŠå¤‡ä»½æ–‡ä»¶è¿˜åŸæˆæ•°æ®ï¼‰
```

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **å¹¶è¡Œæ¢å¤**ï¼šåŒæ—¶ç”¨å¤šä¸ªçº¿ç¨‹æ¢å¤æ•°æ®ï¼Œé€Ÿåº¦å¿«
- **çµæ´»é€‰æ‹©**ï¼šå¯ä»¥åªæ¢å¤æŸäº›åº“æˆ–è¡¨ï¼Œä¸å¿…å…¨éƒ¨æ¢å¤
- **æ™ºèƒ½æ¢å¤**ï¼šè‡ªåŠ¨å¤„ç†è¡¨ç»“æ„ã€ç´¢å¼•ã€æ•°æ®çš„æ¢å¤é¡ºåº

### 1.2 myloaderå·¥ä½œåŸç†


**æ¢å¤è¿‡ç¨‹å›¾ç¤º**ï¼š
```
å¤‡ä»½ç›®å½•                myloaderå¤„ç†                  ç›®æ ‡æ•°æ®åº“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ table1.sqlâ”‚â”€â”€â”        â”‚   çº¿ç¨‹1     â”‚              â”‚   åº“1    â”‚
â”‚ table2.sqlâ”‚â”€â”€â”¼â”€â”€â”€â”€â”€â”€â†’ â”‚   çº¿ç¨‹2     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚   åº“2    â”‚
â”‚ table3.sqlâ”‚â”€â”€â”˜        â”‚   çº¿ç¨‹3     â”‚              â”‚   åº“3    â”‚
â”‚   ...    â”‚           â”‚    ...      â”‚              â”‚   ...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
â€¢ å¤šä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œï¼Œä¸ç”¨æ’é˜Ÿç­‰å¾…
â€¢ è‡ªåŠ¨è¯†åˆ«è¡¨ä¹‹é—´çš„ä¾èµ–å…³ç³»
â€¢ ä¼˜å…ˆæ¢å¤è¡¨ç»“æ„ï¼Œå†æ¢å¤æ•°æ®
```

### 1.3 æ¢å¤å‰çš„å‡†å¤‡å·¥ä½œ


**ç¯å¢ƒæ£€æŸ¥æ¸…å•**ï¼š
```bash
# 1. ç¡®è®¤myloaderå·²å®‰è£…
myloader --version

# 2. ç¡®è®¤ç›®æ ‡MySQLæœåŠ¡å™¨å¯è¿æ¥
mysql -hç›®æ ‡ä¸»æœº -uç”¨æˆ·å -på¯†ç  -e "SELECT VERSION();"

# 3. æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
ls -la /å¤‡ä»½ç›®å½•/
# åº”è¯¥çœ‹åˆ°ï¼šåº“å-schema-create.sql, è¡¨å.sqlç­‰æ–‡ä»¶

# 4. ç¡®è®¤ç›®æ ‡åº“æƒé™ï¼ˆéœ€è¦CREATE, INSERT, INDEXç­‰æƒé™ï¼‰
mysql -e "SHOW GRANTS FOR CURRENT_USER();"
```

---

## 2. ğŸ“¥ å®Œæ•´æ¢å¤å‘½ä»¤æ“ä½œ


### 2.1 åŸºç¡€å®Œæ•´æ¢å¤


**æœ€ç®€å•çš„æ¢å¤å‘½ä»¤**ï¼š
```bash
# åŸºæœ¬è¯­æ³•
myloader -h ä¸»æœºå -u ç”¨æˆ·å -på¯†ç  -d å¤‡ä»½ç›®å½•

# å®é™…ä¾‹å­
myloader -h localhost -u root -p123456 -d /backup/2024-09-11/
```

**å‘½ä»¤è§£é‡Š**ï¼š
- `-h localhost`ï¼šè¿æ¥åˆ°æœ¬åœ°MySQLæœåŠ¡å™¨
- `-u root`ï¼šä½¿ç”¨rootç”¨æˆ·ç™»å½•
- `-p123456`ï¼šå¯†ç æ˜¯123456
- `-d /backup/2024-09-11/`ï¼šä»è¿™ä¸ªç›®å½•è¯»å–å¤‡ä»½æ–‡ä»¶

### 2.2 å®Œæ•´æ¢å¤å‘½ä»¤è¯¦è§£


**å®Œæ•´çš„æ¢å¤å‘½ä»¤ç¤ºä¾‹**ï¼š
```bash
myloader \
  --host=192.168.1.100 \
  --user=backup_user \
  --password=secure_password \
  --port=3306 \
  --directory=/data/backup/mysql_backup_20240911 \
  --threads=4 \
  --verbose=3 \
  --overwrite-tables \
  --enable-binlog
```

**å‚æ•°è¯¦ç»†è¯´æ˜**ï¼š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--host` | ç›®æ ‡æ•°æ®åº“åœ°å€ | `192.168.1.100` | è¦æ¢å¤åˆ°å“ªå°æœåŠ¡å™¨ |
| `--user` | æ•°æ®åº“ç”¨æˆ·å | `backup_user` | æœ‰æƒé™åˆ›å»ºåº“è¡¨çš„ç”¨æˆ· |
| `--password` | æ•°æ®åº“å¯†ç  | `secure_password` | å¯¹åº”ç”¨æˆ·çš„å¯†ç  |
| `--port` | æ•°æ®åº“ç«¯å£ | `3306` | MySQLæœåŠ¡ç«¯å£ |
| `--directory` | å¤‡ä»½æ–‡ä»¶ç›®å½• | `/data/backup/` | mydumperç”Ÿæˆçš„å¤‡ä»½ç›®å½• |
| `--threads` | å¹¶è¡Œçº¿ç¨‹æ•° | `4` | åŒæ—¶å·¥ä½œçš„çº¿ç¨‹æ•°é‡ |
| `--verbose` | æ—¥å¿—è¯¦ç»†ç¨‹åº¦ | `3` | æ•°å­—è¶Šå¤§æ—¥å¿—è¶Šè¯¦ç»† |

### 2.3 æ¢å¤è¿›åº¦ç›‘æ§


**å®æ—¶ç›‘æ§æ¢å¤è¿›åº¦**ï¼š
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨verboseå‚æ•°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
myloader -h localhost -u root -p123456 -d /backup/ --verbose=3

# æ–¹æ³•2ï¼šç›‘æ§MySQLè¿›ç¨‹åˆ—è¡¨
mysql -e "SHOW PROCESSLIST;" | grep "INSERT\|CREATE"

# æ–¹æ³•3ï¼šç›‘æ§æ•°æ®åº“å¤§å°å˜åŒ–
watch -n 5 "mysql -e 'SELECT table_schema, ROUND(SUM(data_length+index_length)/1024/1024,2) AS MB FROM information_schema.tables GROUP BY table_schema;'"
```

**è¿›åº¦ç›‘æ§ç¤ºä¾‹è¾“å‡º**ï¼š
```
2024-09-11 20:15:01 [INFO] - å¼€å§‹æ¢å¤æ•°æ®åº“: ecommerce
2024-09-11 20:15:02 [INFO] - åˆ›å»ºè¡¨ç»“æ„: users (çº¿ç¨‹1)
2024-09-11 20:15:03 [INFO] - åˆ›å»ºè¡¨ç»“æ„: products (çº¿ç¨‹2)
2024-09-11 20:15:05 [INFO] - å¼€å§‹å¯¼å…¥æ•°æ®: users.sql (çº¿ç¨‹1)
2024-09-11 20:15:05 [INFO] - å¼€å§‹å¯¼å…¥æ•°æ®: products.sql (çº¿ç¨‹2)
2024-09-11 20:15:30 [INFO] - å®Œæˆå¯¼å…¥: users (10ä¸‡è¡Œ)
2024-09-11 20:15:45 [INFO] - å®Œæˆå¯¼å…¥: products (5ä¸‡è¡Œ)
```

---

## 3. ğŸ¯ é€‰æ‹©æ€§æ¢å¤æŠ€æœ¯


### 3.1 æŒ‰æ•°æ®åº“æ¢å¤


**åªæ¢å¤æŒ‡å®šçš„æ•°æ®åº“**ï¼š
```bash
# åªæ¢å¤ecommerceæ•°æ®åº“
myloader -h localhost -u root -p123456 -d /backup/ --source-db=ecommerce

# åŒæ—¶æ¢å¤å¤šä¸ªæ•°æ®åº“
myloader -h localhost -u root -p123456 -d /backup/ \
  --source-db=ecommerce \
  --source-db=logs \
  --source-db=analytics
```

**å®é™…åº”ç”¨åœºæ™¯**ï¼š
```
åœºæ™¯ï¼šç”Ÿäº§ç¯å¢ƒæœ‰10ä¸ªæ•°æ®åº“ï¼Œä½†åªæƒ³æ¢å¤å…¶ä¸­çš„ç”¨æˆ·æ•°æ®åº“

å‘½ä»¤ï¼š
myloader -h localhost -u root -p123456 -d /backup/ --source-db=user_center

å¥½å¤„ï¼š
â€¢ èŠ‚çœæ—¶é—´ï¼ˆä¸ç”¨æ¢å¤å…¶ä»–9ä¸ªæ•°æ®åº“ï¼‰
â€¢ èŠ‚çœç©ºé—´ï¼ˆç›®æ ‡æœåŠ¡å™¨ä¸éœ€è¦å…¨éƒ¨æ•°æ®ï¼‰
â€¢ é™ä½é£é™©ï¼ˆåªå½±å“æŒ‡å®šæ•°æ®åº“ï¼‰
```

### 3.2 æŒ‰è¡¨æ¢å¤


**åªæ¢å¤æŒ‡å®šçš„è¡¨**ï¼š
```bash
# æ¢å¤å•ä¸ªè¡¨
myloader -h localhost -u root -p123456 -d /backup/ \
  --source-db=ecommerce \
  --tables-list=users

# æ¢å¤å¤šä¸ªè¡¨
myloader -h localhost -u root -p123456 -d /backup/ \
  --source-db=ecommerce \
  --tables-list=users,products,orders
```

**è¡¨æ¢å¤çš„å®é™…åº”ç”¨**ï¼š
```
é—®é¢˜åœºæ™¯ï¼š
ç”µå•†ç³»ç»Ÿçš„ordersè¡¨æ•°æ®å‡ºé”™äº†ï¼Œä½†å…¶ä»–è¡¨éƒ½æ­£å¸¸

è§£å†³æ–¹æ¡ˆï¼š
1. åœæ­¢åº”ç”¨å†™å…¥ordersè¡¨
2. å¤‡ä»½å½“å‰çš„ordersè¡¨ï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
3. åªæ¢å¤ordersè¡¨ï¼š
   myloader -h localhost -u root -p123456 -d /backup/ \
     --source-db=ecommerce \
     --tables-list=orders \
     --overwrite-tables

ä¼˜åŠ¿ï¼š
â€¢ æ¢å¤é€Ÿåº¦å¿«ï¼ˆåªå¤„ç†ä¸€ä¸ªè¡¨ï¼‰
â€¢ å½±å“èŒƒå›´å°ï¼ˆå…¶ä»–è¡¨ç»§ç»­æ­£å¸¸è¿è¡Œï¼‰
â€¢ é£é™©å¯æ§ï¼ˆå®¹æ˜“å›æ»šï¼‰
```

### 3.3 æ•°æ®åº“é‡å‘½åæ¢å¤


**æ¢å¤æ—¶é‡å‘½åæ•°æ®åº“**ï¼š
```bash
# å°†ecommerceåº“æ¢å¤ä¸ºecommerce_teståº“
myloader -h localhost -u root -p123456 -d /backup/ \
  --source-db=ecommerce \
  --overwrite-tables \
  -B ecommerce_test
```

**é‡å‘½åæ¢å¤çš„å…¸å‹ç”¨é€”**ï¼š
```
å¼€å‘æµ‹è¯•ç¯å¢ƒæ­å»ºï¼š
åŸå§‹æ•°æ®åº“ï¼šproduction_db
æµ‹è¯•æ•°æ®åº“ï¼štest_db

myloader -h testserver -u root -p123456 -d /backup/ \
  --source-db=production_db \
  -B test_db

æ•°æ®åˆ†æç¯å¢ƒï¼š
åŸå§‹æ•°æ®åº“ï¼šsales_db  
åˆ†ææ•°æ®åº“ï¼šsales_analysis

myloader -h analyst-server -u root -p123456 -d /backup/ \
  --source-db=sales_db \
  -B sales_analysis
```

---

## 4. ğŸš€ é«˜çº§æ¢å¤ç­–ç•¥


### 4.1 å¤§æ•°æ®é‡æ¢å¤ç­–ç•¥


**é’ˆå¯¹å¤§æ•°æ®é‡çš„ä¼˜åŒ–é…ç½®**ï¼š
```bash
# å¤§æ•°æ®é‡æ¢å¤çš„ä¼˜åŒ–å‘½ä»¤
myloader \
  --host=localhost \
  --user=root \
  --password=123456 \
  --directory=/backup/big_data/ \
  --threads=8 \
  --rows=10000 \
  --compress-protocol \
  --overwrite-tables \
  --verbose=2
```

**å¤§æ•°æ®æ¢å¤çš„åˆ†é˜¶æ®µç­–ç•¥**ï¼š
```
é˜¶æ®µ1ï¼šè¡¨ç»“æ„æ¢å¤
myloader -h localhost -u root -p123456 -d /backup/ --no-data

é˜¶æ®µ2ï¼šå°è¡¨æ•°æ®æ¢å¤
myloader -h localhost -u root -p123456 -d /backup/ \
  --tables-list=users,categories,settings \
  --no-schemas

é˜¶æ®µ3ï¼šå¤§è¡¨æ•°æ®æ¢å¤ï¼ˆé€ä¸ªè¿›è¡Œï¼‰
myloader -h localhost -u root -p123456 -d /backup/ \
  --tables-list=orders \
  --threads=16 \
  --rows=5000

é˜¶æ®µ4ï¼šç´¢å¼•é‡å»º
mysql -e "ALTER TABLE orders ENABLE KEYS;"
```

### 4.2 è·¨æœåŠ¡å™¨æ¢å¤


**ä»ä¸€å°æœåŠ¡å™¨æ¢å¤åˆ°å¦ä¸€å°æœåŠ¡å™¨**ï¼š
```bash
# åœºæ™¯ï¼šä»ç”Ÿäº§æœåŠ¡å™¨å¤‡ä»½æ¢å¤åˆ°æµ‹è¯•æœåŠ¡å™¨
# æ­¥éª¤1ï¼šåœ¨ç”Ÿäº§æœåŠ¡å™¨åˆ›å»ºå¤‡ä»½
mydumper -h prod-server -u backup_user -p password -B production_db -c

# æ­¥éª¤2ï¼šä¼ è¾“å¤‡ä»½æ–‡ä»¶åˆ°æµ‹è¯•æœåŠ¡å™¨
scp -r /backup/production_db/ user@test-server:/backup/

# æ­¥éª¤3ï¼šåœ¨æµ‹è¯•æœåŠ¡å™¨æ¢å¤
myloader -h test-server -u root -p test_password -d /backup/production_db/
```

**è·¨ç‰ˆæœ¬æ¢å¤å¤„ç†**ï¼š
```bash
# MySQL 5.7 â†’ MySQL 8.0 æ¢å¤
myloader -h mysql8-server -u root -p123456 -d /backup/ \
  --skip-definer \
  --set-gtid-purged=OFF

# å¤„ç†å­—ç¬¦é›†é—®é¢˜
myloader -h target-server -u root -p123456 -d /backup/ \
  --default-character-set=utf8mb4
```

### 4.3 å¢é‡æ¢å¤ç­–ç•¥


**ç»“åˆbinlogçš„å¢é‡æ¢å¤**ï¼š
```bash
# æ­¥éª¤1ï¼šæ¢å¤å…¨é‡å¤‡ä»½ï¼ˆåˆ°æŸä¸ªæ—¶é—´ç‚¹ï¼‰
myloader -h localhost -u root -p123456 -d /backup/full_20240910/

# æ­¥éª¤2ï¼šåº”ç”¨binlogï¼ˆä»å¤‡ä»½æ—¶é—´ç‚¹åˆ°ç°åœ¨ï¼‰
mysqlbinlog --start-datetime="2024-09-10 23:59:59" \
  --stop-datetime="2024-09-11 12:00:00" \
  /var/log/mysql/mysql-bin.000001 | mysql -u root -p123456

# æ­¥éª¤3ï¼šéªŒè¯æ•°æ®ä¸€è‡´æ€§
mysql -e "CHECKSUM TABLE important_table;"
```

---

## 5. ğŸ“Š æ¢å¤ç›‘æ§ä¸éªŒè¯


### 5.1 æ¢å¤è¿‡ç¨‹ç›‘æ§


**ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š
```bash
#!/bin/bash
# æ¢å¤ç›‘æ§è„šæœ¬

echo "å¼€å§‹ç›‘æ§myloaderæ¢å¤è¿›ç¨‹..."

while true; do
    # æ£€æŸ¥myloaderè¿›ç¨‹æ˜¯å¦è¿˜åœ¨è¿è¡Œ
    if pgrep myloader > /dev/null; then
        echo "$(date): myloaderæ­£åœ¨è¿è¡Œ..."
        
        # æ˜¾ç¤ºå½“å‰MySQLè¿æ¥æ•°
        mysql_connections=$(mysql -u root -p123456 -e "SHOW STATUS LIKE 'Threads_connected';" | tail -1 | awk '{print $2}')
        echo "å½“å‰MySQLè¿æ¥æ•°: $mysql_connections"
        
        # æ˜¾ç¤ºæ•°æ®åº“å¤§å°
        mysql -u root -p123456 -e "SELECT table_schema as 'æ•°æ®åº“', ROUND(SUM(data_length+index_length)/1024/1024,2) as 'å¤§å°(MB)' FROM information_schema.tables GROUP BY table_schema;"
        
        sleep 30
    else
        echo "$(date): myloaderæ¢å¤å®Œæˆ"
        break
    fi
done
```

### 5.2 æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥


**æ¢å¤åçš„éªŒè¯æ–¹æ³•**ï¼š
```sql
-- 1. æ£€æŸ¥è¡¨çš„è®°å½•æ•°é‡
SELECT 
    table_schema as 'æ•°æ®åº“',
    table_name as 'è¡¨å',
    table_rows as 'è®°å½•æ•°'
FROM information_schema.tables 
WHERE table_schema = 'ecommerce'
ORDER BY table_rows DESC;

-- 2. æ£€æŸ¥è¡¨çš„æ•°æ®å®Œæ•´æ€§
CHECKSUM TABLE users, products, orders;

-- 3. æ£€æŸ¥ç´¢å¼•çŠ¶æ€
SELECT 
    table_name as 'è¡¨å',
    index_name as 'ç´¢å¼•å',
    cardinality as 'åŸºæ•°'
FROM information_schema.statistics 
WHERE table_schema = 'ecommerce'
ORDER BY table_name, index_name;

-- 4. æ£€æŸ¥å¤–é”®çº¦æŸ
SELECT 
    constraint_name,
    table_name,
    referenced_table_name
FROM information_schema.referential_constraints
WHERE constraint_schema = 'ecommerce';
```

### 5.3 æ€§èƒ½éªŒè¯


**æ¢å¤æ€§èƒ½è¯„ä¼°**ï¼š
```bash
# è®°å½•æ¢å¤å¼€å§‹æ—¶é—´
echo "æ¢å¤å¼€å§‹æ—¶é—´: $(date)" > recovery_log.txt

# æ‰§è¡Œæ¢å¤
time myloader -h localhost -u root -p123456 -d /backup/ --verbose=3 >> recovery_log.txt 2>&1

# è®°å½•æ¢å¤ç»“æŸæ—¶é—´
echo "æ¢å¤ç»“æŸæ—¶é—´: $(date)" >> recovery_log.txt

# åˆ†ææ¢å¤æ—¥å¿—
grep -E "(INFO|ERROR|WARNING)" recovery_log.txt | tail -20
```

---

## 6. âš ï¸ é”™è¯¯å¤„ç†ä¸æœ€ä½³å®è·µ


### 6.1 å¸¸è§é”™è¯¯å¤„ç†


**é”™è¯¯ç±»å‹åŠè§£å†³æ–¹æ¡ˆ**ï¼š

<details>
<summary>**è¿æ¥é”™è¯¯**</summary>

```bash
# é”™è¯¯ä¿¡æ¯ï¼šERROR 2003: Can't connect to MySQL server
# åŸå› ï¼šç½‘ç»œé—®é¢˜æˆ–MySQLæœåŠ¡æœªå¯åŠ¨
# è§£å†³æ–¹æ¡ˆï¼š
systemctl status mysql
systemctl start mysql
telnet ç›®æ ‡ä¸»æœº 3306
```
</details>

<details>
<summary>**æƒé™é”™è¯¯**</summary>

```sql
-- é”™è¯¯ä¿¡æ¯ï¼šERROR 1044: Access denied for user
-- åŸå› ï¼šç”¨æˆ·æƒé™ä¸è¶³
-- è§£å†³æ–¹æ¡ˆï¼š
GRANT ALL PRIVILEGES ON *.* TO 'backup_user'@'%';
FLUSH PRIVILEGES;
```
</details>

<details>
<summary>**è¡¨å·²å­˜åœ¨é”™è¯¯**</summary>

```bash
# é”™è¯¯ä¿¡æ¯ï¼šTable 'users' already exists
# è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨è¦†ç›–é€‰é¡¹
myloader -h localhost -u root -p123456 -d /backup/ --overwrite-tables
```
</details>

<details>
<summary>**ç£ç›˜ç©ºé—´ä¸è¶³**</summary>

```bash
# é”™è¯¯ä¿¡æ¯ï¼šERROR 28: No space left on device
# è§£å†³æ–¹æ¡ˆï¼š
df -h  # æ£€æŸ¥ç£ç›˜ç©ºé—´
du -sh /var/lib/mysql/  # æ£€æŸ¥MySQLæ•°æ®ç›®å½•å¤§å°
# æ¸…ç†ç©ºé—´æˆ–æ‰©å®¹ç£ç›˜
```
</details>

### 6.2 å›æ»šæ“ä½œæ–¹æ³•


**å®‰å…¨å›æ»šç­–ç•¥**ï¼š
```bash
# æ¢å¤å‰çš„å®‰å…¨æªæ–½
# 1. å¤‡ä»½å½“å‰æ•°æ®
mysqldump -u root -p123456 --all-databases > pre_restore_backup.sql

# 2. åˆ›å»ºæ¢å¤ç‚¹
mysql -u root -p123456 -e "FLUSH LOGS;"

# 3. æ‰§è¡Œæ¢å¤
myloader -h localhost -u root -p123456 -d /backup/

# å¦‚æœæ¢å¤å‡ºé”™ï¼Œå¿«é€Ÿå›æ»šï¼š
# 1. åœæ­¢åº”ç”¨ç¨‹åº
# 2. æ¢å¤ä¹‹å‰çš„å¤‡ä»½
mysql -u root -p123456 < pre_restore_backup.sql
# 3. é‡å¯åº”ç”¨ç¨‹åº
```

### 6.3 æ¢å¤æ€§èƒ½ä¼˜åŒ–


**ä¼˜åŒ–é…ç½®å»ºè®®**ï¼š
```bash
# MySQLé…ç½®ä¼˜åŒ–ï¼ˆæ¢å¤æœŸé—´ä¸´æ—¶è®¾ç½®ï¼‰
mysql -u root -p123456 -e "
SET GLOBAL innodb_buffer_pool_size = 2G;
SET GLOBAL innodb_log_file_size = 512M;
SET GLOBAL innodb_flush_log_at_trx_commit = 2;
SET GLOBAL sync_binlog = 0;
SET GLOBAL foreign_key_checks = 0;
"

# æ¢å¤å®Œæˆåæ¢å¤æ­£å¸¸è®¾ç½®
mysql -u root -p123456 -e "
SET GLOBAL innodb_flush_log_at_trx_commit = 1;
SET GLOBAL sync_binlog = 1;
SET GLOBAL foreign_key_checks = 1;
"
```

### 6.4 æ¢å¤æœ€ä½³å®è·µ


**ğŸ“‹ æ¢å¤æ“ä½œæ¸…å•**ï¼š

âœ… **æ¢å¤å‰æ£€æŸ¥**ï¼š
- [ ] ç¡®è®¤å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
- [ ] æ£€æŸ¥ç›®æ ‡æœåŠ¡å™¨ç©ºé—´
- [ ] éªŒè¯ç”¨æˆ·æƒé™
- [ ] å¤‡ä»½å½“å‰æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰

âœ… **æ¢å¤è¿‡ç¨‹ç›‘æ§**ï¼š
- [ ] å®æ—¶ç›‘æ§æ¢å¤è¿›åº¦
- [ ] æ£€æŸ¥é”™è¯¯æ—¥å¿—
- [ ] ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨

âœ… **æ¢å¤åéªŒè¯**ï¼š
- [ ] æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
- [ ] è¡¨ç»“æ„éªŒè¯
- [ ] ç´¢å¼•çŠ¶æ€ç¡®è®¤
- [ ] åº”ç”¨ç¨‹åºæµ‹è¯•

**ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
```
çº¿ç¨‹æ•°è®¾ç½®ï¼š
â€¢ CPUæ ¸å¿ƒæ•° Ã— 2 ï¼ˆæ¨èèµ·ç‚¹ï¼‰
â€¢ ç›‘æ§CPUä½¿ç”¨ç‡ï¼Œé¿å…è¶…è¿‡80%
â€¢ è€ƒè™‘ç£ç›˜IOç“¶é¢ˆ

å†…å­˜é…ç½®ï¼š
â€¢ innodb_buffer_pool_size = ç‰©ç†å†…å­˜çš„70-80%
â€¢ æ¢å¤æœŸé—´å¯ä¸´æ—¶è°ƒå¤§

ç½‘ç»œä¼˜åŒ–ï¼š
â€¢ ä½¿ç”¨--compress-protocolï¼ˆè¿œç¨‹æ¢å¤ï¼‰
â€¢ æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```bash
ğŸ”¸ myloaderæœ¬è´¨ï¼šmydumperçš„æ¢å¤å·¥å…·ï¼Œæ”¯æŒå¹¶è¡Œæ¢å¤
ğŸ”¸ åŸºæœ¬ç”¨æ³•ï¼šmyloader -hä¸»æœº -uç”¨æˆ· -på¯†ç  -då¤‡ä»½ç›®å½•
ğŸ”¸ é€‰æ‹©æ€§æ¢å¤ï¼šå¯æŒ‰åº“ã€æŒ‰è¡¨ã€é‡å‘½åæ¢å¤
ğŸ”¸ ç›‘æ§éªŒè¯ï¼šè¿‡ç¨‹ç›‘æ§ + ç»“æœéªŒè¯ + ä¸€è‡´æ€§æ£€æŸ¥
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šå¸¸è§é—®é¢˜è¯Šæ–­ + å›æ»šç­–ç•¥ + æ€§èƒ½ä¼˜åŒ–
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ æ¢å¤ç­–ç•¥é€‰æ‹©**ï¼š
```
å…¨é‡æ¢å¤ï¼šé€‚åˆç¾éš¾æ¢å¤ã€ç¯å¢ƒæ­å»º
é€‰æ‹©æ€§æ¢å¤ï¼šé€‚åˆå•è¡¨ä¿®å¤ã€éƒ¨åˆ†æ•°æ®åŒæ­¥
é‡å‘½åæ¢å¤ï¼šé€‚åˆæµ‹è¯•ç¯å¢ƒã€æ•°æ®åˆ†æ

æ€§èƒ½è€ƒè™‘ï¼š
â€¢ å¤§æ•°æ®é‡ï¼šåˆ†é˜¶æ®µæ¢å¤ï¼Œä¼˜åŒ–å‚æ•°
â€¢ è·¨ç½‘ç»œï¼šå‹ç¼©ä¼ è¾“ï¼Œç›‘æ§ç½‘ç»œ
â€¢ é«˜å¯ç”¨ï¼šæœ€å°åŒ–åœæœºæ—¶é—´
```

**ğŸ”¹ å®‰å…¨æ€§ä¿éšœ**ï¼š
```
æ¢å¤å‰å‡†å¤‡ï¼š
â€¢ å¤‡ä»½å½“å‰æ•°æ®
â€¢ ç¡®è®¤æƒé™è®¾ç½®
â€¢ æ£€æŸ¥ç£ç›˜ç©ºé—´

æ¢å¤è¿‡ç¨‹æ§åˆ¶ï¼š
â€¢ å®æ—¶ç›‘æ§è¿›åº¦
â€¢ åŠæ—¶å‘ç°å¼‚å¸¸
â€¢ å‡†å¤‡å›æ»šæ–¹æ¡ˆ

æ¢å¤åéªŒè¯ï¼š
â€¢ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
â€¢ åº”ç”¨åŠŸèƒ½æµ‹è¯•
â€¢ æ€§èƒ½åŸºå‡†å¯¹æ¯”
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ’¼ å…¸å‹ä¸šåŠ¡åœºæ™¯**ï¼š
- **ç¾éš¾æ¢å¤**ï¼šæœåŠ¡å™¨æ•…éšœåçš„å®Œæ•´æ•°æ®æ¢å¤
- **æ•°æ®ä¿®å¤**ï¼šè¯¯æ“ä½œåçš„å•è¡¨æ•°æ®æ¢å¤  
- **ç¯å¢ƒæ­å»º**ï¼šç”Ÿäº§æ•°æ®åŒæ­¥åˆ°æµ‹è¯•ç¯å¢ƒ
- **æ•°æ®è¿ç§»**ï¼šè·¨æœåŠ¡å™¨çš„æ•°æ®åº“è¿ç§»
- **ç‰ˆæœ¬å‡çº§**ï¼šæ•°æ®åº“ç‰ˆæœ¬å‡çº§æ—¶çš„æ•°æ®è¿ç§»

**ğŸ”§ è¿ç»´å®è·µä»·å€¼**ï¼š
- **æ•ˆç‡æå‡**ï¼šå¹¶è¡Œæ¢å¤æ¯”ä¼ ç»Ÿæ–¹æ³•å¿«5-10å€
- **çµæ´»æ€§å¼º**ï¼šæ”¯æŒå„ç§ç²’åº¦çš„é€‰æ‹©æ€§æ¢å¤
- **é£é™©å¯æ§**ï¼šå®Œå–„çš„ç›‘æ§å’Œå›æ»šæœºåˆ¶
- **æ˜“äºè‡ªåŠ¨åŒ–**ï¼šè„šæœ¬å‹å¥½ï¼Œä¾¿äºé›†æˆåˆ°è¿ç»´æµç¨‹

**æ ¸å¿ƒè®°å¿†**ï¼š
- myloaderæ˜¯mydumperçš„æœ€ä½³æ­æ¡£ï¼Œä¸“æ³¨å¹¶è¡Œæ¢å¤
- é€‰æ‹©æ€§æ¢å¤è®©æ•°æ®æ¢å¤æ›´ç²¾å‡†æ›´é«˜æ•ˆ
- ç›‘æ§éªŒè¯æ˜¯æ¢å¤æ“ä½œçš„å®‰å…¨ä¿éšœ
- å……åˆ†å‡†å¤‡å’Œæ­£ç¡®é…ç½®æ˜¯æˆåŠŸæ¢å¤çš„å…³é”®