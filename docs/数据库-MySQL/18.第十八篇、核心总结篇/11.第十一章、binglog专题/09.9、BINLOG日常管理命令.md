---
title: 9ã€BINLOGæ—¥å¸¸ç®¡ç†å‘½ä»¤
---
## ğŸ“š ç›®å½•

1. [æ—¥å¿—æŸ¥çœ‹å‘½ä»¤](#1-æ—¥å¿—æŸ¥çœ‹å‘½ä»¤)
2. [æ—¥å¿—äº‹ä»¶æŸ¥çœ‹](#2-æ—¥å¿—äº‹ä»¶æŸ¥çœ‹)
3. [æ—¥å¿—è½®è½¬ä¸æ¸…ç†](#3-æ—¥å¿—è½®è½¬ä¸æ¸…ç†)
4. [mysqlbinlogå·¥å…·ä½¿ç”¨](#4-mysqlbinlogå·¥å…·ä½¿ç”¨)
5. [çŠ¶æ€ç›‘æ§å‘½ä»¤](#5-çŠ¶æ€ç›‘æ§å‘½ä»¤)
6. [æ‰¹é‡æ“ä½œè„šæœ¬](#6-æ‰¹é‡æ“ä½œè„šæœ¬)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“‹ æ—¥å¿—æŸ¥çœ‹å‘½ä»¤


### 1.1 SHOW BINARY LOGSå‘½ä»¤


**ğŸ”¸ æ ¸å¿ƒä½œç”¨**
```
SHOW BINARY LOGSï¼šæŸ¥çœ‹å½“å‰MySQLå®ä¾‹ä¸­æ‰€æœ‰çš„äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
ä½œç”¨ï¼šäº†è§£æœ‰å¤šå°‘ä¸ªbinlogæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤§å°ï¼Œå¿«é€Ÿå®šä½ç›®æ ‡æ—¥å¿—
```

**ğŸ’¡ åŸºæœ¬è¯­æ³•**
```sql
SHOW BINARY LOGS;
-- æˆ–è€…ä½¿ç”¨åŒä¹‰è¯
SHOW MASTER LOGS;
```

**ğŸ“Š è¾“å‡ºç»“æœè§£æ**
```sql
mysql> SHOW BINARY LOGS;
+------------------+-----------+-----------+
| Log_name         | File_size | Encrypted |
+------------------+-----------+-----------+
| mysql-bin.000001 |       177 | No        |
| mysql-bin.000002 |      1547 | No        |
| mysql-bin.000003 |     52847 | No        |
| mysql-bin.000004 |       154 | No        |
+------------------+-----------+-----------+

å­—æ®µå«ä¹‰ï¼š
- Log_nameï¼šäºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶å
- File_sizeï¼šæ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- Encryptedï¼šæ˜¯å¦åŠ å¯†ï¼ˆYes/Noï¼‰
```

> ğŸ’¡ **å®ç”¨æŠ€å·§**ï¼šé€šè¿‡æ–‡ä»¶å¤§å°å¯ä»¥å¿«é€Ÿåˆ¤æ–­å“ªäº›æ—¥å¿—æ–‡ä»¶åŒ…å«è¾ƒå¤šæ•°æ®å˜æ›´

### 1.2 æ—¥å¿—æ–‡ä»¶çŠ¶æ€æŸ¥è¯¢


**ğŸ”§ æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶**
```sql
SHOW MASTER STATUS;

è¾“å‡ºç¤ºä¾‹ï¼š
+------------------+----------+--------------+------------------+-------------------+
| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000004 |      154 |              |                  |                   |
+------------------+----------+--------------+------------------+-------------------+

å…³é”®ä¿¡æ¯ï¼š
- Fileï¼šå½“å‰å†™å…¥çš„binlogæ–‡ä»¶
- Positionï¼šå½“å‰å†™å…¥ä½ç½®ï¼ˆå­—èŠ‚åç§»é‡ï¼‰
- Executed_Gtid_Setï¼šå·²æ‰§è¡Œçš„GTIDé›†åˆ
```

**ğŸ“ˆ æ—¥å¿—é…ç½®æŸ¥çœ‹**
```sql
-- æŸ¥çœ‹binlogç›¸å…³é…ç½®
SHOW VARIABLES LIKE 'log_bin%';
SHOW VARIABLES LIKE 'binlog%';
SHOW VARIABLES LIKE 'sync_binlog';

é‡è¦é…ç½®é¡¹ï¼š
- log_binï¼šæ˜¯å¦å¯ç”¨binlog
- log_bin_basenameï¼šbinlogæ–‡ä»¶åŸºç¡€å
- binlog_formatï¼šè®°å½•æ ¼å¼ï¼ˆROW/STATEMENT/MIXEDï¼‰
- max_binlog_sizeï¼šå•ä¸ªæ–‡ä»¶æœ€å¤§å¤§å°
```

---

## 2. ğŸ” æ—¥å¿—äº‹ä»¶æŸ¥çœ‹


### 2.1 SHOW BINLOG EVENTSå‘½ä»¤è¯¦è§£


**ğŸ”¸ åŸºæœ¬æ¦‚å¿µ**
```
SHOW BINLOG EVENTSï¼šæŸ¥çœ‹æŒ‡å®šbinlogæ–‡ä»¶ä¸­çš„å…·ä½“äº‹ä»¶
äº‹ä»¶ï¼šbinlogä¸­çš„æœ€å°è®°å½•å•ä½ï¼Œå¦‚BEGINã€INSERTã€UPDATEã€COMMITç­‰
ç”¨é€”ï¼šæ’æŸ¥é—®é¢˜ã€åˆ†ææ•°æ®å˜æ›´ã€æ¢å¤æ•°æ®
```

**ğŸ’» åŸºæœ¬è¯­æ³•**
```sql
SHOW BINLOG EVENTS 
    [IN 'log_name'] 
    [FROM pos] 
    [LIMIT [offset,] row_count];

å‚æ•°è¯´æ˜ï¼š
- IN 'log_name'ï¼šæŒ‡å®šbinlogæ–‡ä»¶åï¼Œä¸æŒ‡å®šåˆ™æŸ¥çœ‹å½“å‰æ–‡ä»¶
- FROM posï¼šä»æŒ‡å®šä½ç½®å¼€å§‹æŸ¥çœ‹
- LIMITï¼šé™åˆ¶è¿”å›è®°å½•æ•°ï¼Œç±»ä¼¼æ™®é€šæŸ¥è¯¢çš„LIMIT
```

### 2.2 å®é™…ä½¿ç”¨ç¤ºä¾‹


**ğŸ“ æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„æ‰€æœ‰äº‹ä»¶**
```sql
SHOW BINLOG EVENTS IN 'mysql-bin.000003';

è¾“å‡ºç¤ºä¾‹ï¼š
+------------------+-----+----------------+-----------+-------------+----------------------------------------+
| Log_name         | Pos | Event_type     | Server_id | End_log_pos | Info                                   |
+------------------+-----+----------------+-----------+-------------+----------------------------------------+
| mysql-bin.000003 |   4 | Format_desc    |         1 |         123 | Server ver: 8.0.28, Binlog ver: 4     |
| mysql-bin.000003 | 123 | Previous_gtids |         1 |         154 |                                        |
| mysql-bin.000003 | 154 | Anonymous_Gtid |         1 |         233 | SET $$SESSION.GTID_NEXT= 'ANONYMOUS'   |
| mysql-bin.000003 | 233 | Query          |         1 |         317 | BEGIN                                  |
| mysql-bin.000003 | 317 | Update_rows    |         1 |         425 | table_id: 108 flags: STMT_END_F       |
| mysql-bin.000003 | 425 | Xid            |         1 |         456 | COMMIT /* xid=47 */                    |
+------------------+-----+----------------+-----------+-------------+----------------------------------------+
```

**ğŸ¯ å­—æ®µå«ä¹‰è¯¦è§£**
```
Log_nameï¼šæ—¥å¿—æ–‡ä»¶å
Posï¼šäº‹ä»¶åœ¨æ–‡ä»¶ä¸­çš„èµ·å§‹ä½ç½®
Event_typeï¼šäº‹ä»¶ç±»å‹
    - Format_descï¼šæ–‡ä»¶æ ¼å¼æè¿°
    - Queryï¼šSQLè¯­å¥ï¼ˆå¦‚BEGINã€COMMITã€DDLï¼‰
    - Update_rowsï¼šè¡Œçº§æ›´æ–°äº‹ä»¶
    - Insert_rowsï¼šè¡Œçº§æ’å…¥äº‹ä»¶
    - Delete_rowsï¼šè¡Œçº§åˆ é™¤äº‹ä»¶
    - Xidï¼šäº‹åŠ¡æäº¤äº‹ä»¶
Server_idï¼šäº§ç”Ÿäº‹ä»¶çš„æœåŠ¡å™¨ID
End_log_posï¼šäº‹ä»¶ç»“æŸä½ç½®
Infoï¼šäº‹ä»¶è¯¦ç»†ä¿¡æ¯
```

**ğŸ“Š æŒ‰ä½ç½®èŒƒå›´æŸ¥çœ‹**
```sql
-- æŸ¥çœ‹æŒ‡å®šä½ç½®èŒƒå›´çš„äº‹ä»¶
SHOW BINLOG EVENTS IN 'mysql-bin.000003' FROM 154 LIMIT 10;

-- æŸ¥çœ‹æœ€è¿‘çš„äº‹ä»¶
SHOW BINLOG EVENTS IN 'mysql-bin.000003' LIMIT 5;

-- ä»æŒ‡å®šåç§»é‡å¼€å§‹æŸ¥çœ‹
SHOW BINLOG EVENTS IN 'mysql-bin.000003' LIMIT 5, 10;
```

### 2.3 äº‹ä»¶ç±»å‹è§£æ


**ğŸ”§ å¸¸è§äº‹ä»¶ç±»å‹è¯´æ˜**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                äº‹ä»¶ç±»å‹åˆ†ç±»                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç®¡ç†ç±»äº‹ä»¶     â”‚ Format_desc, Rotate, Stop     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   äº‹åŠ¡ç±»äº‹ä»¶     â”‚ Query(BEGIN/COMMIT), Xid      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®å˜æ›´äº‹ä»¶   â”‚ Insert_rows, Update_rows,     â”‚
â”‚                â”‚ Delete_rows                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   DDLäº‹ä»¶       â”‚ Query(CREATE/ALTER/DROP)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   GTIDäº‹ä»¶      â”‚ Gtid, Anonymous_Gtid          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> âš ï¸ **é‡è¦æç¤º**ï¼šROWæ ¼å¼çš„binlogä¸­ï¼ŒDMLæ“ä½œæ˜¾ç¤ºä¸º*_rowsäº‹ä»¶ï¼Œå…·ä½“SQLè¯­å¥éœ€è¦ç”¨mysqlbinlogå·¥å…·è§£æ

---

## 3. ğŸ”„ æ—¥å¿—è½®è½¬ä¸æ¸…ç†


### 3.1 FLUSH LOGSæ‰‹åŠ¨è½®è½¬


**ğŸ”¸ è½®è½¬çš„å«ä¹‰**
```
æ—¥å¿—è½®è½¬ï¼šå…³é—­å½“å‰æ­£åœ¨å†™å…¥çš„binlogæ–‡ä»¶ï¼Œåˆ›å»ºæ–°çš„binlogæ–‡ä»¶
ç›®çš„ï¼šæ§åˆ¶å•ä¸ªæ–‡ä»¶å¤§å°ï¼Œä¾¿äºç®¡ç†å’Œå¤‡ä»½
è§¦å‘æ—¶æœºï¼šæ‰‹åŠ¨æ‰§è¡Œã€è¾¾åˆ°max_binlog_sizeã€é‡å¯MySQL
```

**ğŸ’» è½®è½¬å‘½ä»¤**
```sql
-- è½®è½¬æ‰€æœ‰æ—¥å¿—ï¼ˆåŒ…æ‹¬binlogã€error logç­‰ï¼‰
FLUSH LOGS;

-- ä»…è½®è½¬äºŒè¿›åˆ¶æ—¥å¿—
FLUSH BINARY LOGS;

æ‰§è¡Œå‰åå¯¹æ¯”ï¼š
æ‰§è¡Œå‰ï¼šå½“å‰æ–‡ä»¶ mysql-bin.000003
æ‰§è¡Œåï¼šå…³é—­000003ï¼Œåˆ›å»ºmysql-bin.000004
```

**ğŸ“Š è½®è½¬æ“ä½œçš„å½±å“**
```
è½®è½¬è¿‡ç¨‹ï¼š
1. å®Œæˆå½“å‰binlogæ–‡ä»¶çš„å†™å…¥
2. å…³é—­å½“å‰æ–‡ä»¶
3. åˆ›å»ºæ–°çš„åºå·æ–‡ä»¶
4. æ›´æ–°binlogç´¢å¼•æ–‡ä»¶

å½±å“ï¼š
âœ… ä¸ä¼šä¸¢å¤±æ•°æ®
âœ… ä¸ä¼šä¸­æ–­æ­£åœ¨è¿›è¡Œçš„äº‹åŠ¡
âœ… æ–°äº‹åŠ¡å†™å…¥æ–°æ–‡ä»¶
âš ï¸  ä¼šäº§ç”ŸçŸ­æš‚çš„IOå¼€é”€
```

### 3.2 PURGE BINARY LOGSæ¸…ç†æ—¥å¿—


**ğŸ”¸ æ¸…ç†çš„å¿…è¦æ€§**
```
ä¸ºä»€ä¹ˆè¦æ¸…ç†binlogï¼š
- binlogæ–‡ä»¶ä¼šæŒç»­å¢é•¿å ç”¨ç£ç›˜ç©ºé—´
- è¿‡å¤šæ–‡ä»¶å½±å“ç®¡ç†æ•ˆç‡
- æ—§æ–‡ä»¶é€šå¸¸å·²ç»ä¸éœ€è¦ï¼ˆå·²å¤‡ä»½æˆ–è¶…è¿‡ä¿ç•™æœŸï¼‰
```

**ğŸ’¡ æ¸…ç†æ–¹å¼ä¸€ï¼šæŒ‰æ–‡ä»¶åæ¸…ç†**
```sql
-- æ¸…ç†æŒ‡å®šæ–‡ä»¶ä¹‹å‰çš„æ‰€æœ‰binlogï¼ˆä¸åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶ï¼‰
PURGE BINARY LOGS TO 'mysql-bin.000005';

ç¤ºä¾‹ï¼š
å½“å‰æ–‡ä»¶ï¼š000001, 000002, 000003, 000004, 000005, 000006
æ‰§è¡Œåï¼šä¿ç•™000005, 000006ï¼Œåˆ é™¤000001-000004
```

**â° æ¸…ç†æ–¹å¼äºŒï¼šæŒ‰æ—¶é—´æ¸…ç†**
```sql
-- æ¸…ç†æŒ‡å®šæ—¶é—´ä¹‹å‰çš„binlog
PURGE BINARY LOGS BEFORE '2024-01-01 00:00:00';

-- æ¸…ç†3å¤©å‰çš„binlog
PURGE BINARY LOGS BEFORE DATE_SUB(NOW(), INTERVAL 3 DAY);

-- æ¸…ç†æŒ‡å®šæ—¥æœŸä¹‹å‰çš„binlog
PURGE BINARY LOGS BEFORE '2024-09-01';
```

> âš ï¸ **æ¸…ç†æ³¨æ„äº‹é¡¹**ï¼š
> - ç¡®ä¿è¦æ¸…ç†çš„binlogå·²ç»å¤‡ä»½
> - ç¡®ä¿ä»åº“å·²ç»åº”ç”¨äº†è¿™äº›æ—¥å¿—
> - ä¸èƒ½æ¸…ç†æ­£åœ¨ä½¿ç”¨çš„å½“å‰binlogæ–‡ä»¶

### 3.3 RESET MASTERé‡ç½®æ—¥å¿—


**ğŸ”¸ é‡ç½®æ“ä½œè¯´æ˜**
```
RESET MASTERï¼šåˆ é™¤æ‰€æœ‰binlogæ–‡ä»¶ï¼Œé‡æ–°å¼€å§‹ç¼–å·
å±é™©æ“ä½œï¼šä¼šä¸¢å¤±æ‰€æœ‰å†å²æ—¥å¿—è®°å½•
é€‚ç”¨åœºæ™¯ï¼šå…¨æ–°ç¯å¢ƒæ­å»ºã€å½»åº•æ¸…ç†æµ‹è¯•æ•°æ®
```

**âš ï¸ é‡ç½®å‘½ä»¤**
```sql
RESET MASTER;

æ‰§è¡Œæ•ˆæœï¼š
- åˆ é™¤æ‰€æœ‰ç°æœ‰binlogæ–‡ä»¶
- åˆ é™¤binlogç´¢å¼•æ–‡ä»¶
- é‡æ–°åˆ›å»ºmysql-bin.000001
- é‡ç½®binlogä½ç½®ä¸º4
```

> ğŸš¨ **å±é™©è­¦å‘Š**ï¼šç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼ä¼šå¯¼è‡´ä¸»ä»å¤åˆ¶ä¸­æ–­ï¼Œä¸¢å¤±æ‰€æœ‰å†å²æ—¥å¿—

### 3.4 è‡ªåŠ¨æ¸…ç†é…ç½®


**ğŸ”§ è‡ªåŠ¨æ¸…ç†å‚æ•°**
```sql
-- æŸ¥çœ‹è‡ªåŠ¨æ¸…ç†é…ç½®
SHOW VARIABLES LIKE 'binlog_expire_logs_seconds';
SHOW VARIABLES LIKE 'expire_logs_days';

-- è®¾ç½®è‡ªåŠ¨æ¸…ç†ï¼ˆä¿ç•™7å¤©ï¼‰
SET GLOBAL binlog_expire_logs_seconds = 604800;  -- 7å¤©=7*24*3600ç§’

-- æˆ–è€…åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
[mysqld]
binlog_expire_logs_seconds = 604800
```

---

## 4. ğŸ› ï¸ mysqlbinlogå·¥å…·ä½¿ç”¨


### 4.1 å·¥å…·åŸºæœ¬ä»‹ç»


**ğŸ”¸ å·¥å…·ä½œç”¨**
```
mysqlbinlogï¼šMySQLå®˜æ–¹æä¾›çš„binlogè§£æå·¥å…·
åŠŸèƒ½ï¼šå°†äºŒè¿›åˆ¶æ ¼å¼çš„binlogè½¬æ¢ä¸ºå¯è¯»çš„SQLè¯­å¥
ç”¨é€”ï¼šæ•°æ®æ¢å¤ã€æ•…éšœåˆ†æã€å®¡è®¡è¿½è¸ª
```

**ğŸ“‹ åŸºæœ¬è¯­æ³•ç»“æ„**
```bash
mysqlbinlog [é€‰é¡¹] binlogæ–‡ä»¶å

å¸¸ç”¨é€‰é¡¹ï¼š
-v, --verbose          æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆè¡Œçº§äº‹ä»¶çš„å…·ä½“æ•°æ®ï¼‰
-vv                    æ›´è¯¦ç»†ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ•°æ®ç±»å‹ï¼‰
--start-datetime       æŒ‡å®šå¼€å§‹æ—¶é—´
--stop-datetime        æŒ‡å®šç»“æŸæ—¶é—´  
--start-position       æŒ‡å®šå¼€å§‹ä½ç½®
--stop-position        æŒ‡å®šç»“æŸä½ç½®
--database             åªæ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“çš„äº‹ä»¶
--base64-output=decode-rows  è§£ç è¡Œçº§äº‹ä»¶
```

### 4.2 å¸¸ç”¨æ“ä½œç¤ºä¾‹


**ğŸ“ æŸ¥çœ‹æ•´ä¸ªbinlogæ–‡ä»¶**
```bash
# åŸºæœ¬æŸ¥çœ‹
mysqlbinlog mysql-bin.000003

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆæ¨èï¼‰
mysqlbinlog -v mysql-bin.000003

# æŸ¥çœ‹è¶…è¯¦ç»†ä¿¡æ¯
mysqlbinlog -vv mysql-bin.000003
```

**â° æŒ‰æ—¶é—´èŒƒå›´æŸ¥çœ‹**
```bash
# æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µçš„æ“ä½œ
mysqlbinlog --start-datetime="2024-09-11 10:00:00" \
           --stop-datetime="2024-09-11 12:00:00" \
           mysql-bin.000003

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´ä¹‹åçš„æ“ä½œ
mysqlbinlog --start-datetime="2024-09-11 10:00:00" \
           mysql-bin.000003
```

**ğŸ“ æŒ‰ä½ç½®èŒƒå›´æŸ¥çœ‹**
```bash
# æŒ‰binlogä½ç½®æŸ¥çœ‹
mysqlbinlog --start-position=154 \
           --stop-position=1000 \
           mysql-bin.000003

# ä»æŒ‡å®šä½ç½®å¼€å§‹
mysqlbinlog --start-position=500 mysql-bin.000003
```

**ğŸ¯ æŒ‰æ•°æ®åº“è¿‡æ»¤**
```bash
# åªæŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„å˜æ›´
mysqlbinlog --database=test_db mysql-bin.000003

# æŸ¥çœ‹å¤šä¸ªæ•°æ®åº“
mysqlbinlog --database=db1 --database=db2 mysql-bin.000003
```

### 4.3 æ•°æ®æ¢å¤å®æˆ˜


**ğŸ”§ åŸºäºæ—¶é—´ç‚¹æ¢å¤**
```bash
# æ¢å¤åˆ°æ•…éšœå‘ç”Ÿå‰çš„æ—¶é—´ç‚¹
mysqlbinlog --start-datetime="2024-09-11 08:00:00" \
           --stop-datetime="2024-09-11 11:30:00" \
           mysql-bin.000003 | mysql -u root -p

# åˆ†æ­¥éª¤æ¢å¤
# 1. å¯¼å‡ºSQLåˆ°æ–‡ä»¶
mysqlbinlog --start-datetime="2024-09-11 08:00:00" \
           --stop-datetime="2024-09-11 11:30:00" \
           mysql-bin.000003 > recovery.sql

# 2. æ£€æŸ¥SQLå†…å®¹
less recovery.sql

# 3. æ‰§è¡Œæ¢å¤
mysql -u root -p < recovery.sql
```

**ğŸ“Š åŸºäºä½ç½®æ¢å¤**
```bash
# æ¢å¤æŒ‡å®šä½ç½®èŒƒå›´çš„æ•°æ®
mysqlbinlog --start-position=154 \
           --stop-position=1247 \
           mysql-bin.000003 | mysql -u root -p
```

### 4.4 è¾“å‡ºæ ¼å¼è§£æ


**ğŸ“– mysqlbinlogè¾“å‡ºç¤ºä¾‹**
```sql
/*!50530 SET $$SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!50003 SET @OLD_COMPLETION_TYPE=$$COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
# at 154
#240911 10:15:30 server id 1  end_log_pos 233 CRC32 0x1a2b3c4d 	Query	thread_id=8	exec_time=0	error_code=0
SET TIMESTAMP=1726027530/*!*/;
SET $$session.pseudo_thread_id=8/*!*/;
BEGIN
/*!*/;
# at 233
#240911 10:15:30 server id 1  end_log_pos 317 CRC32 0x5e6f7a8b 	Update_rows: table id 108 flags: STMT_END_F
## UPDATE `test`.`users`

## WHERE

##   @1=1

##   @2='old_name'

## SET

##   @1=1

##   @2='new_name'

# at 317
#240911 10:15:30 server id 1  end_log_pos 348 CRC32 0x9c8d7e6f 	Xid = 47
COMMIT/*!*/;
```

**ğŸ” è¾“å‡ºå†…å®¹è§£è¯»**
```
å…³é”®ä¿¡æ¯ï¼š
- # at 154ï¼šäº‹ä»¶åœ¨binlogä¸­çš„ä½ç½®
- æ—¶é—´æˆ³ï¼šäº‹ä»¶å‘ç”Ÿæ—¶é—´
- server idï¼šäº§ç”Ÿäº‹ä»¶çš„æœåŠ¡å™¨ID
- end_log_posï¼šäº‹ä»¶ç»“æŸä½ç½®
- CRC32ï¼šæ ¡éªŒç 
- thread_idï¼šæ‰§è¡Œçº¿ç¨‹ID
- exec_timeï¼šæ‰§è¡Œæ—¶é—´

## æ ‡è®°ï¼šè¡¨ç¤ºè¡Œçº§å˜æ›´çš„è¯¦ç»†å†…å®¹

@1, @2ï¼šåˆ—çš„åºå·ï¼ˆç¬¬1åˆ—ã€ç¬¬2åˆ—ï¼‰
WHEREï¼šæ›´æ–°å‰çš„å€¼
SETï¼šæ›´æ–°åçš„å€¼
```

---

## 5. ğŸ“Š çŠ¶æ€ç›‘æ§å‘½ä»¤


### 5.1 å®æ—¶ç›‘æ§å‘½ä»¤


**ğŸ” æŸ¥çœ‹binlogå†™å…¥çŠ¶æ€**
```sql
-- æŸ¥çœ‹binlogç›¸å…³çŠ¶æ€å˜é‡
SHOW STATUS LIKE 'binlog%';

é‡è¦æŒ‡æ ‡ï¼š
+-------------------------+-------+
| Variable_name           | Value |
+-------------------------+-------+
| Binlog_cache_disk_use   | 0     |  -- ä½¿ç”¨ç£ç›˜ç¼“å­˜çš„äº‹åŠ¡æ•°
| Binlog_cache_use        | 125   |  -- ä½¿ç”¨binlogç¼“å­˜çš„äº‹åŠ¡æ•°
| Binlog_stmt_cache_disk_use | 0  |  -- è¯­å¥ç¼“å­˜ç£ç›˜ä½¿ç”¨æ¬¡æ•°
| Binlog_stmt_cache_use   | 87    |  -- è¯­å¥ç¼“å­˜ä½¿ç”¨æ¬¡æ•°
+-------------------------+-------+
```

**ğŸ“ˆ ç›‘æ§binlogå†™å…¥é¢‘ç‡**
```sql
-- æŸ¥çœ‹æ¯ç§’binlogå†™å…¥é‡ï¼ˆéœ€è¦å®šæœŸé‡‡æ ·å¯¹æ¯”ï¼‰
SHOW STATUS LIKE 'binlog_cache_use';

-- 5ç§’åå†æ¬¡æŸ¥è¯¢ï¼Œè®¡ç®—å·®å€¼
-- (æ–°å€¼ - æ—§å€¼) / æ—¶é—´é—´éš” = æ¯ç§’äº‹åŠ¡æ•°
```

**âš¡ æŸ¥çœ‹å½“å‰binlogå¤§å°**
```bash
# åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŸ¥çœ‹
ls -lh /var/lib/mysql/mysql-bin.*

# æˆ–è€…ä½¿ç”¨SQLæŸ¥è¯¢
SELECT 
    Log_name,
    ROUND(File_size/1024/1024, 2) AS 'Size_MB'
FROM INFORMATION_SCHEMA.BINARY_LOG_FILES;
```

### 5.2 æ€§èƒ½è¯Šæ–­å‘½ä»¤


**ğŸ”§ è¯Šæ–­binlogæ€§èƒ½é—®é¢˜**
```sql
-- æŸ¥çœ‹binlogç›¸å…³é…ç½®
SHOW VARIABLES WHERE Variable_name IN (
    'sync_binlog',
    'binlog_cache_size',
    'binlog_stmt_cache_size',
    'max_binlog_cache_size',
    'binlog_group_commit_sync_delay'
);

å…³é”®é…ç½®è§£é‡Šï¼š
- sync_binlogï¼šæ¯å¤šå°‘æ¬¡äº‹åŠ¡åŒæ­¥åˆ°ç£ç›˜ï¼ˆ1=æ¯æ¬¡åŒæ­¥ï¼Œæœ€å®‰å…¨ä½†æœ€æ…¢ï¼‰
- binlog_cache_sizeï¼šæ¯ä¸ªè¿æ¥çš„binlogç¼“å­˜å¤§å°
- binlog_group_commit_sync_delayï¼šç»„æäº¤å»¶è¿Ÿæ—¶é—´ï¼ˆå¾®ç§’ï¼‰
```

**ğŸ“Š ç¼“å­˜ä½¿ç”¨æ•ˆç‡åˆ†æ**
```sql
-- è®¡ç®—binlogç¼“å­˜å‘½ä¸­ç‡
SELECT 
    ($$binlog_cache_use - $$binlog_cache_disk_use) / $$binlog_cache_use * 100 
    AS 'Cache_Hit_Rate_%';

-- å¦‚æœå‘½ä¸­ç‡ä½äº95%ï¼Œè€ƒè™‘å¢å¤§binlog_cache_size
```

### 5.3 ç©ºé—´ä½¿ç”¨ç›‘æ§


**ğŸ’¾ æŸ¥çœ‹binlogå ç”¨ç©ºé—´**
```sql
-- æŸ¥çœ‹æ‰€æœ‰binlogæ–‡ä»¶æ€»å¤§å°
SELECT 
    ROUND(SUM(File_size)/1024/1024/1024, 2) AS 'Total_GB',
    COUNT(*) AS 'File_Count',
    ROUND(AVG(File_size)/1024/1024, 2) AS 'Avg_Size_MB'
FROM INFORMATION_SCHEMA.BINARY_LOG_FILES;
```

**ğŸ“… æŒ‰æ—¥æœŸç»Ÿè®¡binlogå¤§å°**
```bash
# ä½¿ç”¨è„šæœ¬ç»Ÿè®¡æ¯æ—¥binlogå¢é•¿
#!/bin/bash
for log in $(mysql -e "SHOW BINARY LOGS" | grep mysql-bin | awk '{print $1}'); do
    size=$(mysql -e "SHOW BINARY LOGS" | grep $log | awk '{print $2}')
    date=$(mysqlbinlog --start-position=4 --stop-position=200 $log 2>/dev/null | grep "SET TIMESTAMP" | head -1 | sed 's/.*=//' | sed 's/.*!//')
    echo "$log: $size bytes, Date: $date"
done
```

---

## 6. ğŸ¤– æ‰¹é‡æ“ä½œè„šæœ¬


### 6.1 æ—¥å¿—å¤‡ä»½è„šæœ¬


**ğŸ“¦ è‡ªåŠ¨å¤‡ä»½binlogè„šæœ¬**
```bash
#!/bin/bash
# binlog_backup.sh - binlogå¤‡ä»½è„šæœ¬

MYSQL_USER="backup_user"
MYSQL_PASS="backup_password"
BACKUP_DIR="/backup/binlog"
RETENTION_DAYS=7

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR/$(date +%Y%m%d)

# è·å–å½“å‰binlogåˆ—è¡¨
mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SHOW BINARY LOGS" | grep mysql-bin | while read log_info; do
    log_name=$(echo $log_info | awk '{print $1}')
    
    # æ£€æŸ¥æ˜¯å¦ä¸ºå½“å‰æ­£åœ¨ä½¿ç”¨çš„æ—¥å¿—
    current_log=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SHOW MASTER STATUS" | grep mysql-bin | awk '{print $1}')
    
    if [ "$log_name" != "$current_log" ]; then
        echo "å¤‡ä»½ $log_name"
        cp /var/lib/mysql/$log_name $BACKUP_DIR/$(date +%Y%m%d)/
    fi
done

# æ¸…ç†è¿‡æœŸå¤‡ä»½
find $BACKUP_DIR -type d -mtime +$RETENTION_DAYS -exec rm -rf {} \;
```

### 6.2 æ—¥å¿—æ¸…ç†è„šæœ¬


**ğŸ§¹ æ™ºèƒ½æ¸…ç†è„šæœ¬**
```bash
#!/bin/bash
# binlog_cleanup.sh - æ™ºèƒ½æ¸…ç†binlog

MYSQL_USER="admin"
MYSQL_PASS="password"
KEEP_DAYS=3
MIN_FREE_SPACE_GB=10

# æ£€æŸ¥ç£ç›˜ç©ºé—´
free_space=$(df /var/lib/mysql | tail -1 | awk '{print $4/1024/1024}')

if (( $(echo "$free_space < $MIN_FREE_SPACE_GB" | bc -l) )); then
    echo "ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œå¼€å§‹æ¸…ç†binlog"
    
    # è®¡ç®—ä¿ç•™æ—¶é—´
    keep_datetime=$(date -d "$KEEP_DAYS days ago" "+%Y-%m-%d %H:%M:%S")
    
    # æ‰§è¡Œæ¸…ç†
    mysql -u$MYSQL_USER -p$MYSQL_PASS -e "PURGE BINARY LOGS BEFORE '$keep_datetime';"
    
    echo "æ¸…ç†å®Œæˆï¼Œä¿ç•™æœ€è¿‘${KEEP_DAYS}å¤©çš„æ—¥å¿—"
else
    echo "ç£ç›˜ç©ºé—´å……è¶³ï¼Œæ— éœ€æ¸…ç†"
fi
```

### 6.3 æ—¥å¿—åˆ†æè„šæœ¬


**ğŸ“Š binlogç»Ÿè®¡åˆ†æè„šæœ¬**
```bash
#!/bin/bash
# binlog_analysis.sh - binlogåˆ†æç»Ÿè®¡

MYSQL_USER="root"
MYSQL_PASS="password"
LOG_FILE="$1"

if [ -z "$LOG_FILE" ]; then
    echo "ç”¨æ³•: $0 <binlogæ–‡ä»¶å>"
    exit 1
fi

echo "=== $LOG_FILE åˆ†ææŠ¥å‘Š ==="
echo "æ–‡ä»¶å¤§å°: $(ls -lh $LOG_FILE | awk '{print $5}')"
echo ""

# ç»Ÿè®¡äº‹ä»¶ç±»å‹
echo "äº‹ä»¶ç±»å‹ç»Ÿè®¡:"
mysqlbinlog $LOG_FILE | grep "^#.*end_log_pos" | awk '{print $6}' | sort | uniq -c | sort -nr

echo ""

# ç»Ÿè®¡æ¶‰åŠçš„æ•°æ®åº“
echo "æ¶‰åŠçš„æ•°æ®åº“:"
mysqlbinlog --database=all $LOG_FILE | grep "^use " | sort | uniq -c

echo ""

# ç»Ÿè®¡æ—¶é—´èŒƒå›´
echo "æ—¶é—´èŒƒå›´:"
first_time=$(mysqlbinlog $LOG_FILE | grep "^#[0-9]" | head -1 | awk '{print $1 " " $2}' | sed 's/#//')
last_time=$(mysqlbinlog $LOG_FILE | grep "^#[0-9]" | tail -1 | awk '{print $1 " " $2}' | sed 's/#//')
echo "å¼€å§‹æ—¶é—´: $first_time"
echo "ç»“æŸæ—¶é—´: $last_time"
```

### 6.4 ç›‘æ§å‘Šè­¦è„šæœ¬


**ğŸš¨ binlogç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# binlog_monitor.sh - binlogç›‘æ§å‘Šè­¦

MYSQL_USER="monitor"
MYSQL_PASS="password"
MAX_SIZE_GB=10
MAX_FILES=50
ALERT_EMAIL="admin@company.com"

# æ£€æŸ¥binlogæ–‡ä»¶æ•°é‡
file_count=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SHOW BINARY LOGS" | grep mysql-bin | wc -l)

if [ $file_count -gt $MAX_FILES ]; then
    echo "å‘Šè­¦ï¼šbinlogæ–‡ä»¶æ•°é‡è¶…è¿‡é˜ˆå€¼($file_count > $MAX_FILES)" | mail -s "Binlog Alert" $ALERT_EMAIL
fi

# æ£€æŸ¥binlogæ€»å¤§å°
total_size=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SELECT ROUND(SUM(File_size)/1024/1024/1024, 2) FROM INFORMATION_SCHEMA.BINARY_LOG_FILES" | tail -1)

if (( $(echo "$total_size > $MAX_SIZE_GB" | bc -l) )); then
    echo "å‘Šè­¦ï¼šbinlogæ€»å¤§å°è¶…è¿‡é˜ˆå€¼(${total_size}GB > ${MAX_SIZE_GB}GB)" | mail -s "Binlog Size Alert" $ALERT_EMAIL
fi

# æ£€æŸ¥binlogæ˜¯å¦æ­£å¸¸å†™å…¥
current_pos=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SHOW MASTER STATUS" | grep mysql-bin | awk '{print $2}')
sleep 60
new_pos=$(mysql -u$MYSQL_USER -p$MYSQL_PASS -e "SHOW MASTER STATUS" | grep mysql-bin | awk '{print $2}')

if [ "$current_pos" -eq "$new_pos" ]; then
    echo "å‘Šè­¦ï¼šbinlogå¯èƒ½åœæ­¢å†™å…¥" | mail -s "Binlog Write Alert" $ALERT_EMAIL
fi
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒå‘½ä»¤


```
ğŸ”¸ æŸ¥çœ‹å‘½ä»¤ï¼š
   - SHOW BINARY LOGSï¼šæŸ¥çœ‹æ‰€æœ‰binlogæ–‡ä»¶
   - SHOW MASTER STATUSï¼šæŸ¥çœ‹å½“å‰binlogçŠ¶æ€
   - SHOW BINLOG EVENTSï¼šæŸ¥çœ‹binlogäº‹ä»¶è¯¦æƒ…

ğŸ”¸ ç®¡ç†å‘½ä»¤ï¼š
   - FLUSH LOGSï¼šæ‰‹åŠ¨è½®è½¬æ—¥å¿—
   - PURGE BINARY LOGSï¼šæ¸…ç†å†å²æ—¥å¿—
   - RESET MASTERï¼šé‡ç½®æ‰€æœ‰æ—¥å¿—ï¼ˆå±é™©æ“ä½œï¼‰

ğŸ”¸ åˆ†æå·¥å…·ï¼š
   - mysqlbinlogï¼šè§£æbinlogæ–‡ä»¶çš„æ ¸å¿ƒå·¥å…·
   - æ”¯æŒæ—¶é—´ã€ä½ç½®ã€æ•°æ®åº“è¿‡æ»¤
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å‘½ä»¤ä½¿ç”¨æ—¶æœº**
```
æ—¥å¸¸è¿ç»´ï¼š
- SHOW BINARY LOGSï¼šäº†è§£æ—¥å¿—æ–‡ä»¶çŠ¶å†µ
- SHOW MASTER STATUSï¼šè·å–å½“å‰å¤åˆ¶ä½ç½®
- FLUSH LOGSï¼šå®šæœŸè½®è½¬æ§åˆ¶æ–‡ä»¶å¤§å°

æ•…éšœå¤„ç†ï¼š
- SHOW BINLOG EVENTSï¼šå¿«é€Ÿå®šä½é—®é¢˜äº‹ä»¶
- mysqlbinlogï¼šè¯¦ç»†åˆ†æå’Œæ•°æ®æ¢å¤
- PURGE BINARY LOGSï¼šç´§æ€¥æ¸…ç†é‡Šæ”¾ç©ºé—´

æ€§èƒ½è°ƒä¼˜ï¼š
- ç›‘æ§binlogç¼“å­˜ä½¿ç”¨æƒ…å†µ
- è°ƒæ•´ç›¸å…³é…ç½®å‚æ•°
- å®šæœŸæ¸…ç†å‡å°‘IOå‹åŠ›
```

**ğŸ”¹ æ“ä½œå®‰å…¨æ€§**
```
å®‰å…¨æ“ä½œï¼š
âœ… SHOWç±»å‘½ä»¤ï¼šåªè¯»æ“ä½œï¼Œéšæ—¶å¯ç”¨
âœ… FLUSH LOGSï¼šå®‰å…¨çš„è½®è½¬æ“ä½œ
âœ… åŸºäºæ—¶é—´çš„PURGEï¼šç›¸å¯¹å®‰å…¨

å±é™©æ“ä½œï¼š
âš ï¸  PURGE BINARY LOGSï¼šå¯èƒ½å½±å“å¤åˆ¶
ğŸš¨ RESET MASTERï¼šæåº¦å±é™©ï¼Œä¼šä¸¢å¤±æ‰€æœ‰æ—¥å¿—

æ“ä½œå‰æ£€æŸ¥ï¼š
- ç¡®è®¤ä»åº“å¤åˆ¶çŠ¶æ€
- ç¡®è®¤æ—¥å¿—å·²å¤‡ä»½
- ç¡®è®¤æ“ä½œæ—¶é—´çª—å£
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ è¿ç»´åœºæ™¯åº”ç”¨**
- **æ—¥å¸¸å·¡æ£€**ï¼šå®šæœŸæ£€æŸ¥binlogæ–‡ä»¶æ•°é‡å’Œå¤§å°
- **æ•…éšœæ’æŸ¥**ï¼šé€šè¿‡äº‹ä»¶æŸ¥çœ‹å®šä½æ•°æ®å˜æ›´é—®é¢˜
- **æ•°æ®æ¢å¤**ï¼šä½¿ç”¨mysqlbinlogè¿›è¡Œç²¾ç¡®æ¢å¤
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç›‘æ§binlogç›¸å…³æŒ‡æ ‡è°ƒä¼˜é…ç½®
- **ç©ºé—´ç®¡ç†**ï¼šåˆç†æ¸…ç†å†å²æ—¥å¿—é‡Šæ”¾ç£ç›˜ç©ºé—´

**ğŸ’¡ æœ€ä½³å®è·µ**
- **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šå‡å°‘æ‰‹å·¥æ“ä½œé”™è¯¯
- **ç›‘æ§å‘Šè­¦**ï¼šåŠæ—¶å‘ç°å¼‚å¸¸æƒ…å†µ
- **å®šæœŸå¤‡ä»½**ï¼šä¿è¯æ•°æ®å®‰å…¨
- **æ–‡æ¡£è®°å½•**ï¼šè®°å½•é‡è¦æ“ä½œå’Œé…ç½®å˜æ›´

> ğŸ“– **å­¦ä¹ å»ºè®®**ï¼šè¿™äº›å‘½ä»¤æ˜¯MySQLè¿ç»´çš„åŸºç¡€æŠ€èƒ½ï¼Œå»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒä¸­å¤šç»ƒä¹ ï¼Œç†Ÿæ‚‰å„å‘½ä»¤çš„è¾“å‡ºæ ¼å¼å’Œä½¿ç”¨åœºæ™¯ï¼Œé€æ­¥æŒæ¡binlogçš„ç®¡ç†ç²¾é«“ã€‚

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- SHOWå‘½ä»¤çœ‹çŠ¶æ€ï¼ŒFLUSHå‘½ä»¤åšè½®è½¬
- PURGEæ¸…ç†è¦è°¨æ…ï¼ŒRESETé‡ç½®æœ€å±é™©  
- mysqlbinlogæ˜¯ç¥å™¨ï¼Œæ—¶é—´ä½ç½®ä»»ä½ é€‰
- è„šæœ¬è‡ªåŠ¨åŒ–è¿ç»´ï¼Œç›‘æ§å‘Šè­¦ä¿å¹³å®‰