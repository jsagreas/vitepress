---
title: 5、BINLOG核心参数配置
---
## 📚 目录

1. [BINLOG基础配置](#1-BINLOG基础配置)
2. [格式与刷盘控制](#2-格式与刷盘控制)
3. [缓存与性能参数](#3-缓存与性能参数)
4. [日志管理与清理](#4-日志管理与清理)
5. [过滤与优化配置](#5-过滤与优化配置)
6. [高级特性配置](#6-高级特性配置)
7. [核心配置总结](#7-核心配置总结)

---

## 1. 🔧 BINLOG基础配置


### 1.1 什么是BINLOG配置


**💡 通俗理解**：就像给你的日记本设置规则一样
```
普通日记本：想写就写，没有规则
MySQL BINLOG：需要先设置规则才能正常工作

比如：
- 日记本放在哪里？(log_bin参数)
- 用什么格式写？(binlog_format参数)  
- 什么时候保存？(sync_binlog参数)
- 写多大换新本？(max_binlog_size参数)
```

### 1.2 log_bin参数 - 启用BINLOG


**🔸 参数作用**：控制是否开启二进制日志功能

```sql
-- 查看当前状态
SHOW VARIABLES LIKE 'log_bin';

-- 结果示例：
-- log_bin = ON  (已开启)
-- log_bin = OFF (未开启)
```

**📋 配置方式**
```ini
# 方式1：在配置文件中启用(推荐)
[mysqld]
log-bin = mysql-bin          # 启用并指定文件名前缀
# 或者
log-bin = /var/log/mysql/binlog/mysql-bin  # 指定完整路径

# 方式2：命令行启动
mysqld --log-bin=mysql-bin
```

**🎯 配置说明**
```
路径配置规则：
✅ 相对路径：mysql-bin (存储在数据目录下)
✅ 绝对路径：/var/log/mysql/mysql-bin (存储在指定目录)
✅ 只指定目录：/var/log/mysql/ (文件名使用默认)

生成的文件：
mysql-bin.000001  ← 第一个日志文件
mysql-bin.000002  ← 第二个日志文件  
mysql-bin.index   ← 索引文件(记录所有binlog文件)
```

### 1.3 server-id配置 - 服务器标识


**🔸 必需配置**：启用BINLOG必须设置唯一的服务器ID

```ini
[mysqld]
server-id = 1                # 每台服务器必须唯一
log-bin = mysql-bin
```

**⚠️ 重要提醒**
```
server-id作用：
- 主从复制时区分不同服务器
- 防止循环复制
- 建议使用IP地址最后一段作为ID

示例：
服务器A：192.168.1.10 → server-id = 10
服务器B：192.168.1.20 → server-id = 20
```

---

## 2. 📝 格式与刷盘控制


### 2.1 binlog_format - 日志格式设置


**💡 通俗理解**：就像选择日记的记录方式

```
记录方式对比：
📝 STATEMENT格式：记录"做了什么"
   日记：今天吃了苹果、跑了步

📊 ROW格式：记录"改变了什么"  
   日记：体重从70kg变成69.5kg、步数从0变成8000

🔄 MIXED格式：智能选择
   日记：重要事情详细记录，日常事情简单记录
```

**🔧 配置方式**
```sql
-- 查看当前格式
SHOW VARIABLES LIKE 'binlog_format';

-- 动态修改(会话级别)
SET SESSION binlog_format = 'ROW';

-- 动态修改(全局级别)
SET GLOBAL binlog_format = 'ROW';
```

**📋 配置文件设置**
```ini
[mysqld]
binlog_format = ROW          # 推荐使用ROW格式
# 或者
binlog_format = STATEMENT    # 语句格式
binlog_format = MIXED        # 混合格式
```

**📊 三种格式对比**

| 格式 | **记录内容** | **优点** | **缺点** | **适用场景** |
|------|------------|---------|----------|-------------|
| 🔸 **ROW** | `记录每行数据变化` | `精确、安全` | `日志文件大` | `推荐使用，主从复制` |
| 🔸 **STATEMENT** | `记录执行的SQL语句` | `日志文件小` | `可能不一致` | `简单查询、空间敏感` |
| 🔸 **MIXED** | `智能选择上述两种` | `平衡性能和安全` | `复杂度高` | `兼容老系统` |

### 2.2 sync_binlog - 刷盘控制参数


**💡 通俗理解**：控制什么时候把日记真正写到本子上

```
写日记的过程：
1. 先在草稿纸上写(内存缓冲区)
2. 再誊抄到日记本(磁盘文件)

sync_binlog就是控制什么时候誊抄：
- sync_binlog = 0：想什么时候抄就什么时候抄(系统决定)
- sync_binlog = 1：写一句就抄一句(最安全)  
- sync_binlog = 10：写10句再一起抄(平衡性能)
```

**🔧 配置设置**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'sync_binlog';

-- 动态修改
SET GLOBAL sync_binlog = 1;
```

**📋 配置文件**
```ini
[mysqld]
sync_binlog = 1              # 推荐设置：最高安全级别
# 或者
sync_binlog = 0              # 性能优先
sync_binlog = 100            # 平衡设置
```

**⚡ 性能与安全对比**

```
安全性对比：
🔒 sync_binlog = 1    ← 最安全(每次事务都刷盘)
🔐 sync_binlog = 10   ← 较安全(可能丢失最近10个事务)  
🔓 sync_binlog = 0    ← 风险较高(可能丢失更多数据)

性能对比：
⚡ sync_binlog = 0    ← 性能最好
⚖️ sync_binlog = 100  ← 性能适中
🐌 sync_binlog = 1    ← 性能较慢但最安全

推荐配置：
生产环境：sync_binlog = 1 (数据安全优先)
测试环境：sync_binlog = 100 (平衡性能)
```

---

## 3. 💾 缓存与性能参数


### 3.1 max_binlog_size - 文件大小限制


**💡 通俗理解**：设置每个日记本最多能写多少页

```
日记本管理：
📔 小本子：max_binlog_size = 100M (页数少，换本频繁)
📕 中本子：max_binlog_size = 500M (页数适中，推荐)  
📗 大本子：max_binlog_size = 1G   (页数多，换本较少)

好处：
- 文件不会无限增大
- 方便备份和传输
- 便于日志管理和清理
```

**🔧 配置方式**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'max_binlog_size';

-- 动态修改
SET GLOBAL max_binlog_size = 536870912;  -- 512MB
```

**📋 配置文件**
```ini
[mysqld]
max_binlog_size = 512M       # 推荐512MB
# 或者
max_binlog_size = 1G         # 1GB
max_binlog_size = 100M       # 100MB
```

**📊 大小设置建议**

```
文件大小选择标准：

🔸 小型系统(< 1万TPS)：
max_binlog_size = 100M-256M

🔸 中型系统(1万-10万TPS)：  
max_binlog_size = 512M (推荐)

🔸 大型系统(> 10万TPS)：
max_binlog_size = 1G

注意事项：
⚠️ 不要设置过小(频繁切换影响性能)
⚠️ 不要设置过大(单文件过大不便管理)
✅ 512MB是大多数场景的最佳选择
```

### 3.2 binlog_cache_size - 事务缓存配置


**💡 通俗理解**：每个人的草稿纸大小

```
写日记的过程：
👤 每个人都有一张草稿纸(binlog_cache_size)
📝 先在草稿纸上写事务中的所有操作  
📋 事务完成后，一次性抄到日记本上

草稿纸大小影响：
📄 小草稿纸：写不完需要临时用磁盘(性能下降)
📜 大草稿纸：够用但浪费内存
📝 合适大小：刚好够用，性能最佳
```

**🔧 参数配置**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'binlog_cache_size';

-- 动态修改
SET GLOBAL binlog_cache_size = 1048576;  -- 1MB
```

**📋 配置文件**
```ini
[mysqld]  
binlog_cache_size = 1M       # 默认32KB，建议1MB
# 或者
binlog_cache_size = 512K     # 小事务系统
binlog_cache_size = 2M       # 大事务系统
```

**📊 缓存使用监控**
```sql
-- 查看缓存使用情况
SHOW STATUS LIKE 'Binlog_cache%';

-- 重要指标：
-- Binlog_cache_use：使用binlog缓存的事务数
-- Binlog_cache_disk_use：使用磁盘临时文件的事务数

-- 优化目标：Binlog_cache_disk_use = 0 或很小
```

### 3.3 binlog_stmt_cache_size - 语句缓存


**💡 通俗理解**：非事务语句的草稿纸

```
两种草稿纸：
📝 事务草稿纸(binlog_cache_size)：写事务操作
📄 语句草稿纸(binlog_stmt_cache_size)：写非事务操作

非事务操作包括：
- CREATE TABLE  
- DROP TABLE
- ALTER TABLE
- 存储过程调用等
```

**🔧 配置方式**
```ini
[mysqld]
binlog_stmt_cache_size = 32K # 默认值，通常够用
```

---

## 4. 🗂️ 日志管理与清理


### 4.1 expire_logs_days - 日志保留天数


**💡 通俗理解**：旧日记本保留多少天

```
日记本管理策略：
📅 expire_logs_days = 7   ← 保留7天(一周)
📅 expire_logs_days = 30  ← 保留30天(一个月)  
📅 expire_logs_days = 0   ← 永不删除(手动管理)

自动清理：
🕐 每天检查一次
🗑️ 自动删除过期的binlog文件
💾 节省磁盘空间
```

**🔧 配置方式**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'expire_logs_days';

-- 动态修改
SET GLOBAL expire_logs_days = 7;
```

**📋 配置文件**
```ini
[mysqld]
expire_logs_days = 7         # 推荐7天
# 或者  
expire_logs_days = 30        # 保留30天
expire_logs_days = 0         # 不自动删除
```

### 4.2 binlog_expire_logs_seconds - 精确时间控制


**🔸 MySQL 8.0新特性**：更精确的过期时间控制

```sql
-- 精确到秒的控制
SET GLOBAL binlog_expire_logs_seconds = 604800;  -- 7天=7*24*3600秒
```

**📋 配置文件**
```ini
[mysqld]
# 优先级高于expire_logs_days
binlog_expire_logs_seconds = 604800    # 7天
```

**⏰ 时间换算参考**
```
常用时间配置：
1小时  = 3600秒
1天    = 86400秒  
1周    = 604800秒
1个月  = 2592000秒(30天)
```

### 4.3 手动清理BINLOG


**🔧 手动清理命令**
```sql
-- 查看所有binlog文件
SHOW BINARY LOGS;

-- 清理指定文件之前的日志
PURGE BINARY LOGS TO 'mysql-bin.000010';

-- 清理指定时间之前的日志  
PURGE BINARY LOGS BEFORE '2024-01-01 00:00:00';

-- 清理3天前的日志
PURGE BINARY LOGS BEFORE DATE_SUB(NOW(), INTERVAL 3 DAY);
```

**⚠️ 清理注意事项**
```
安全清理原则：
✅ 确保从库已同步完成
✅ 确保备份已包含要删除的日志
✅ 不要删除正在使用的日志文件
❌ 不要直接删除物理文件(用SQL命令)
```

---

## 5. 🎯 过滤与优化配置


### 5.1 binlog_do_db - 指定记录的数据库


**💡 通俗理解**：只给特定的事情写日记

```
日记过滤：
📝 binlog_do_db = 'shop'     ← 只记录shop数据库的操作
📝 binlog_do_db = 'user'     ← 只记录user数据库的操作

好处：
- 减少日志文件大小
- 提高主从复制效率  
- 专注重要数据库
```

**🔧 配置方式**
```ini
[mysqld]
# 只记录指定数据库
binlog_do_db = shop
binlog_do_db = user          # 可以多次指定

# 或者在一行中指定多个
binlog_do_db = shop,user,order
```

**⚠️ 使用注意**
```
限制说明：
- 只在STATEMENT格式下完全有效
- ROW格式下可能有意外行为
- 跨数据库操作可能被过滤
- 建议谨慎使用
```

### 5.2 binlog_ignore_db - 排除指定数据库


**💡 通俗理解**：不给某些事情写日记

```
排除策略：
📝 binlog_ignore_db = 'test'    ← 不记录test数据库
📝 binlog_ignore_db = 'tmp'     ← 不记录临时数据库

常见排除：
- 测试数据库
- 临时数据库  
- 系统数据库(如mysql、information_schema)
```

**🔧 配置方式**
```ini
[mysqld]
# 排除指定数据库
binlog_ignore_db = test
binlog_ignore_db = tmp
binlog_ignore_db = mysql     # 排除系统库
```

### 5.3 过滤配置最佳实践


**🎯 推荐配置策略**
```ini
[mysqld]
# 推荐：不使用数据库级过滤
# 使用表级过滤或应用层控制

# 如果必须使用，推荐排除方式：
binlog_ignore_db = mysql
binlog_ignore_db = information_schema  
binlog_ignore_db = performance_schema
binlog_ignore_db = sys
```

**📊 过滤方式对比**

| 方式 | **优点** | **缺点** | **建议** |
|------|---------|----------|----------|
| 🔸 **不过滤** | `完整记录，最安全` | `日志文件较大` | `推荐使用` |
| 🔸 **binlog_do_db** | `精确控制` | `容易遗漏，复杂` | `谨慎使用` |
| 🔸 **binlog_ignore_db** | `排除无关数据` | `可能误排除` | `只排除系统库` |

---

## 6. ⚡ 高级特性配置


### 6.1 binlog_group_commit_sync_delay - 组提交延迟


**💡 通俗理解**：等一等再一起保存，提高效率

```
保存策略对比：

立即保存模式：
📝 写一句 → 立即保存 → 写一句 → 立即保存
效果：安全但慢

组提交模式：  
📝 写一句 → 等等 → 写一句 → 等等 → 一起保存
效果：稍微延迟但效率高

类比：
就像坐电梯，等几秒钟让更多人进来，一起上楼更高效
```

**🔧 配置参数**
```sql
-- 设置组提交延迟(微秒)
SET GLOBAL binlog_group_commit_sync_delay = 1000;  -- 1毫秒

-- 设置组提交最大等待事务数
SET GLOBAL binlog_group_commit_sync_no_delay_count = 10;
```

**📋 配置文件**
```ini
[mysqld]
# 组提交延迟优化
binlog_group_commit_sync_delay = 1000           # 1毫秒延迟
binlog_group_commit_sync_no_delay_count = 10    # 等待10个事务或到时间
```

### 6.2 binlog_transaction_dependency_tracking - 依赖跟踪


**💡 通俗理解**：智能识别事务之间的关系，提高并行效率

```
事务关系识别：

COMMIT_ORDER(默认)：
按提交顺序排列，简单但保守

WRITESET：  
按写入数据识别依赖，更智能
- 操作不同数据的事务可并行
- 操作相同数据的事务需串行

WRITESET_SESSION：
结合会话信息，最智能
```

**🔧 配置方式**
```sql
-- 查看当前设置
SHOW VARIABLES LIKE 'binlog_transaction_dependency_tracking';

-- 设置依赖跟踪模式
SET GLOBAL binlog_transaction_dependency_tracking = 'WRITESET';
```

**📋 配置文件**
```ini
[mysqld]
# MySQL 5.7.22+支持
binlog_transaction_dependency_tracking = WRITESET
# 或
binlog_transaction_dependency_tracking = WRITESET_SESSION  # 推荐
```

### 6.3 binlog_checksum - 校验和配置


**💡 通俗理解**：给日记本加上防伪标识

```
校验和作用：
📔 原始日记：可能被篡改或损坏
📔 带校验和日记：可以检测是否被改动

检测过程：
1. 写入时计算校验和
2. 读取时重新计算  
3. 对比两个校验和
4. 不一致则说明数据损坏
```

**🔧 配置方式**
```sql
-- 查看校验和设置
SHOW VARIABLES LIKE 'binlog_checksum';

-- 设置校验和算法
SET GLOBAL binlog_checksum = 'CRC32';  -- 推荐
```

**📋 配置选项**
```ini
[mysqld]
binlog_checksum = CRC32      # 推荐使用CRC32
# 或
binlog_checksum = NONE       # 不使用校验和(不推荐)
```

---

## 7. 📋 核心配置总结


### 7.1 生产环境推荐配置


**🎯 标准生产配置**
```ini
[mysqld]
# ============ BINLOG基础配置 ============
server-id = 1                               # 服务器唯一ID
log-bin = /var/log/mysql/mysql-bin          # BINLOG文件路径
binlog_format = ROW                         # 推荐ROW格式

# ============ 安全与刷盘配置 ============  
sync_binlog = 1                             # 最高安全级别
binlog_checksum = CRC32                     # 启用校验和

# ============ 文件管理配置 ============
max_binlog_size = 512M                      # 文件大小限制
expire_logs_days = 7                        # 保留7天
# binlog_expire_logs_seconds = 604800       # 精确控制(MySQL 8.0)

# ============ 性能优化配置 ============
binlog_cache_size = 1M                      # 事务缓存
binlog_stmt_cache_size = 32K                # 语句缓存

# ============ 高级特性配置 ============
binlog_group_commit_sync_delay = 1000       # 组提交延迟1ms
binlog_group_commit_sync_no_delay_count = 10 # 组提交事务数
binlog_transaction_dependency_tracking = WRITESET_SESSION  # 依赖跟踪

# ============ 过滤配置(可选) ============
binlog_ignore_db = mysql                    # 排除系统库
binlog_ignore_db = information_schema
binlog_ignore_db = performance_schema
binlog_ignore_db = sys
```

### 7.2 不同场景配置建议


**📊 配置场景对比**

| 场景类型 | **sync_binlog** | **max_binlog_size** | **expire_logs_days** | **binlog_cache_size** |
|---------|----------------|-------------------|-------------------|---------------------|
| 🔸 **高安全生产** | `1` | `512M` | `7` | `2M` |
| 🔸 **平衡生产** | `10-100` | `512M` | `3` | `1M` |
| 🔸 **高性能生产** | `1000` | `1G` | `3` | `1M` |
| 🔸 **测试环境** | `0` | `100M` | `1` | `512K` |

### 7.3 配置检查清单


**✅ 上线前检查**
```sql
-- 1. 检查BINLOG是否启用
SHOW VARIABLES LIKE 'log_bin';

-- 2. 检查服务器ID是否设置
SHOW VARIABLES LIKE 'server_id';

-- 3. 检查BINLOG格式
SHOW VARIABLES LIKE 'binlog_format';

-- 4. 检查刷盘设置
SHOW VARIABLES LIKE 'sync_binlog';

-- 5. 检查文件大小限制
SHOW VARIABLES LIKE 'max_binlog_size';

-- 6. 检查保留时间
SHOW VARIABLES LIKE 'expire_logs_days';

-- 7. 查看当前BINLOG文件
SHOW BINARY LOGS;

-- 8. 检查缓存使用情况
SHOW STATUS LIKE 'Binlog_cache%';
```

### 7.4 常见配置问题与解决


**🐛 问题排查**

```
问题1：BINLOG文件过大
原因：max_binlog_size设置过大或事务过大
解决：调整max_binlog_size，优化事务大小

问题2：磁盘空间不足  
原因：expire_logs_days设置过大或未设置
解决：设置合理的日志保留时间

问题3：性能下降
原因：sync_binlog=1但并发很高
解决：启用组提交优化或调整sync_binlog

问题4：主从延迟
原因：binlog_format不合适
解决：使用ROW格式，启用并行复制

问题5：缓存不足
检查：Binlog_cache_disk_use指标
解决：增大binlog_cache_size
```

### 7.5 配置优化建议


**🚀 性能优化要点**
```
优化策略：

🔸 安全与性能平衡：
- sync_binlog = 1 + 组提交优化
- binlog_format = ROW  
- 合适的缓存大小

🔸 磁盘空间优化：
- 合理设置max_binlog_size
- 及时清理过期日志
- 监控磁盘使用情况

🔸 复制性能优化：  
- 启用并行复制相关参数
- 使用WRITESET依赖跟踪
- 优化网络和磁盘IO

🔸 监控关键指标：
- Binlog_cache_disk_use(应该为0)
- 文件大小和数量
- 主从延迟时间
```

**核心记忆要点**：
- BINLOG配置影响数据安全和性能
- 生产环境必须启用并合理配置参数  
- sync_binlog=1保证最高安全性
- ROW格式是最佳选择
- 定期清理日志避免磁盘爆满
- 监控关键指标及时调优