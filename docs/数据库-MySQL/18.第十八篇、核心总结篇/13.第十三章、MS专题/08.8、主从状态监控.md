---
title: 8ã€ä¸»ä»çŠ¶æ€ç›‘æ§
---
## ğŸ“š ç›®å½•

1. [ä¸»ä»çŠ¶æ€ç›‘æ§æ¦‚è¿°](#1-ä¸»ä»çŠ¶æ€ç›‘æ§æ¦‚è¿°)
2. [SHOW SLAVE STATUSå‘½ä»¤è¯¦è§£](#2-SHOW-SLAVE-STATUSå‘½ä»¤è¯¦è§£)
3. [æ ¸å¿ƒçŠ¶æ€å‚æ•°è§£æ](#3-æ ¸å¿ƒçŠ¶æ€å‚æ•°è§£æ)
4. [å»¶è¿Ÿç›‘æ§ä¸åˆ†æ](#4-å»¶è¿Ÿç›‘æ§ä¸åˆ†æ)
5. [é”™è¯¯ä¿¡æ¯è¯Šæ–­](#5-é”™è¯¯ä¿¡æ¯è¯Šæ–­)
6. [å¥åº·æ£€æŸ¥è„šæœ¬å®æˆ˜](#6-å¥åº·æ£€æŸ¥è„šæœ¬å®æˆ˜)
7. [ç›‘æ§æœ€ä½³å®è·µ](#7-ç›‘æ§æœ€ä½³å®è·µ)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ä¸»ä»çŠ¶æ€ç›‘æ§æ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦ç›‘æ§ä¸»ä»çŠ¶æ€


**ç›‘æ§çš„é‡è¦æ€§**ï¼š
ä¸»ä»å¤åˆ¶å°±åƒæ˜¯æ•°æ®çš„"æ¬è¿å·¥"ï¼Œæˆ‘ä»¬éœ€è¦æ—¶åˆ»çŸ¥é“æ¬è¿å·¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæœ‰æ²¡æœ‰å·æ‡’æˆ–å‡ºé”™ã€‚

```
ä¸»åº“æ•°æ®å˜åŒ–    â†’    ä»åº“åŒæ­¥æ›´æ–°
    â†“                    â†“
  å†™å…¥æ—¥å¿—           è¯»å–å¹¶æ‰§è¡Œ
    â†“                    â†“
å¦‚æœä¸­é—´ä»»ä½•ç¯èŠ‚å‡ºé—®é¢˜ï¼Œæ•°æ®å°±ä¸ä¸€è‡´äº†ï¼
```

**ç›‘æ§è§£å†³çš„é—®é¢˜**ï¼š
- âœ… **åŠæ—¶å‘ç°æ•…éšœ**ï¼šå¤åˆ¶è¿›ç¨‹æ˜¯å¦æ­£å¸¸è¿è¡Œ
- âœ… **æŒæ¡å»¶è¿Ÿæƒ…å†µ**ï¼šä»åº“è½åä¸»åº“å¤šé•¿æ—¶é—´
- âœ… **å®šä½å…·ä½“é—®é¢˜**ï¼šå“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜
- âœ… **é¢„é˜²æ•°æ®ä¸ä¸€è‡´**ï¼šé¿å…è¯»åˆ°è¿‡æœŸæ•°æ®

### 1.2 ä¸»ä»å¤åˆ¶çš„å…³é”®ç¯èŠ‚


```
ä¸»åº“binlogå†™å…¥ â†’ IOçº¿ç¨‹è¯»å– â†’ ä¸­ç»§æ—¥å¿—å­˜å‚¨ â†’ SQLçº¿ç¨‹æ‰§è¡Œ â†’ ä»åº“æ•°æ®æ›´æ–°
     â†“              â†“            â†“            â†“            â†“
  æ—¥å¿—æ–‡ä»¶        ç½‘ç»œä¼ è¾“      æœ¬åœ°å­˜å‚¨      SQLè§£æ      æ•°æ®å†™å…¥
```

**æ¯ä¸ªç¯èŠ‚éƒ½å¯èƒ½å‡ºé—®é¢˜**ï¼š
- **ç½‘ç»œé—®é¢˜**ï¼šIOçº¿ç¨‹è¿æ¥ä¸­æ–­
- **æƒé™é—®é¢˜**ï¼šä»åº“æ— æ³•è¯»å–ä¸»åº“æ—¥å¿—
- **SQLé”™è¯¯**ï¼šä»åº“æ‰§è¡ŒSQLå¤±è´¥
- **ç£ç›˜é—®é¢˜**ï¼šä¸­ç»§æ—¥å¿—å†™å…¥å¤±è´¥

---

## 2. ğŸ“‹ SHOW SLAVE STATUSå‘½ä»¤è¯¦è§£


### 2.1 åŸºæœ¬ç”¨æ³•


**å‘½ä»¤ä½œç”¨**ï¼š
`SHOW SLAVE STATUS` æ˜¯MySQLæä¾›çš„ä¸“é—¨æŸ¥çœ‹ä»åº“å¤åˆ¶çŠ¶æ€çš„å‘½ä»¤ï¼Œå°±åƒæ˜¯æŸ¥çœ‹"æ¬è¿å·¥"çš„å·¥ä½œæŠ¥å‘Šã€‚

```sql
-- åœ¨ä»åº“ä¸Šæ‰§è¡Œ
SHOW SLAVE STATUS\G

-- ä¸ºä»€ä¹ˆç”¨\Gï¼Ÿ
-- å› ä¸ºè¾“å‡ºå†…å®¹å¾ˆå¤šï¼Œ\Gè®©ç»“æœç«–å‘æ˜¾ç¤ºï¼Œæ›´å®¹æ˜“é˜…è¯»
```

### 2.2 å‘½ä»¤è¾“å‡ºç»“æ„


**è¾“å‡ºå†…å®¹åˆ†ç±»**ï¼š
```
åŸºæœ¬è¿æ¥ä¿¡æ¯ï¼šä¸»åº“åœ°å€ã€ç«¯å£ã€ç”¨æˆ·ç­‰
IOçº¿ç¨‹çŠ¶æ€ï¼šæ˜¯å¦è¿è¡Œã€è¯»å–ä½ç½®ã€é”™è¯¯ä¿¡æ¯
SQLçº¿ç¨‹çŠ¶æ€ï¼šæ˜¯å¦è¿è¡Œã€æ‰§è¡Œä½ç½®ã€é”™è¯¯ä¿¡æ¯
å»¶è¿Ÿä¿¡æ¯ï¼šä»åº“è½åä¸»åº“çš„æ—¶é—´
æ–‡ä»¶ä½ç½®ï¼šå½“å‰å¤„ç†çš„æ—¥å¿—æ–‡ä»¶å’Œä½ç½®
```

### 2.3 å®Œæ•´ç¤ºä¾‹è¾“å‡º


```sql
mysql> SHOW SLAVE STATUS\G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 192.168.1.100
                  Master_User: replication
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000003
          Read_Master_Log_Pos: 1234567
               Relay_Log_File: relay-bin.000002
                Relay_Log_Pos: 890123
        Relay_Master_Log_File: mysql-bin.000003
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
              Replicate_Do_DB: 
          Replicate_Ignore_DB: 
           Replicate_Do_Table: 
       Replicate_Ignore_Table: 
      Replicate_Wild_Do_Table: 
  Replicate_Wild_Ignore_Table: 
                   Last_Errno: 0
                   Last_Error: 
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 1234567
              Relay_Log_Space: 1024000
              Until_Condition: None
               Until_Log_File: 
                Until_Log_Pos: 0
           Master_SSL_Allowed: No
           Master_SSL_CA_File: 
           Master_SSL_CA_Path: 
              Master_SSL_Cert: 
            Master_SSL_Cipher: 
               Master_SSL_Key: 
        Seconds_Behind_Master: 0
Master_SSL_Verify_Server_Cert: No
                Last_IO_Errno: 0
                Last_IO_Error: 
               Last_SQL_Errno: 0
               Last_SQL_Error: 
  Replicate_Ignore_Server_Ids: 
             Master_Server_Id: 1
                  Master_UUID: 12345678-1234-1234-1234-123456789abc
             Master_Info_File: /var/lib/mysql/master.info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates
           Master_Retry_Count: 86400
                  Master_Bind: 
      Last_IO_Error_Timestamp: 
     Last_SQL_Error_Timestamp: 
               Master_SSL_Crl: 
           Master_SSL_Crlpath: 
           Retrieved_Gtid_Set: 
            Executed_Gtid_Set: 
                Auto_Position: 0
         Replicate_Rewrite_DB: 
                 Channel_Name: 
           Master_TLS_Version: 
```

---

## 3. ğŸ”§ æ ¸å¿ƒçŠ¶æ€å‚æ•°è§£æ


### 3.1 IOçº¿ç¨‹çŠ¶æ€ç›‘æ§


**Slave_IO_Runningå‚æ•°**ï¼š
- **å«ä¹‰**ï¼šIOçº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ
- **æœŸæœ›å€¼**ï¼š`Yes`
- **å¼‚å¸¸å€¼**ï¼š`No`ã€`Connecting`

```sql
-- æ£€æŸ¥IOçº¿ç¨‹çŠ¶æ€
SELECT 
    Slave_IO_Running,
    Slave_IO_State,
    Last_IO_Error
FROM 
    performance_schema.replication_connection_status;
```

**Slave_IO_Stateè¯¦ç»†çŠ¶æ€**ï¼š
```
æ­£å¸¸çŠ¶æ€ï¼š
"Waiting for master to send event" - ç­‰å¾…ä¸»åº“å‘é€äº‹ä»¶ï¼ˆæ­£å¸¸ï¼‰
"Connecting to master" - æ­£åœ¨è¿æ¥ä¸»åº“
"Checking master version" - æ£€æŸ¥ä¸»åº“ç‰ˆæœ¬

å¼‚å¸¸çŠ¶æ€ï¼š
"Reconnecting after a failed master event read" - è¿æ¥å¤±è´¥é‡è¿
"Waiting to reconnect after a failed master event read" - ç­‰å¾…é‡è¿
```

### 3.2 SQLçº¿ç¨‹çŠ¶æ€ç›‘æ§


**Slave_SQL_Runningå‚æ•°**ï¼š
- **å«ä¹‰**ï¼šSQLçº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ
- **æœŸæœ›å€¼**ï¼š`Yes`
- **å¼‚å¸¸å€¼**ï¼š`No`

```sql
-- æ£€æŸ¥SQLçº¿ç¨‹çŠ¶æ€
SELECT 
    Slave_SQL_Running,
    Slave_SQL_Running_State,
    Last_SQL_Error
FROM 
    performance_schema.replication_applier_status;
```

**SQLçº¿ç¨‹çŠ¶æ€è§£æ**ï¼š
```
æ­£å¸¸çŠ¶æ€ï¼š
"Slave has read all relay log; waiting for more updates"
- SQLçº¿ç¨‹å·²å¤„ç†å®Œæ‰€æœ‰ä¸­ç»§æ—¥å¿—ï¼Œç­‰å¾…æ–°æ•°æ®

"Reading event from the relay log"
- æ­£åœ¨è¯»å–ä¸­ç»§æ—¥å¿—ä¸­çš„äº‹ä»¶

å¼‚å¸¸çŠ¶æ€ï¼š
"Error 'Duplicate entry' on query"
- SQLæ‰§è¡Œé”™è¯¯ï¼Œé€šå¸¸æ˜¯ä¸»é”®å†²çª
```

### 3.3 æ–‡ä»¶ä½ç½®ç›‘æ§


**Master_Log_Fileå’ŒRead_Master_Log_Pos**ï¼š
```
Master_Log_File: mysql-bin.000003     â† å½“å‰è¯»å–çš„ä¸»åº“æ—¥å¿—æ–‡ä»¶
Read_Master_Log_Pos: 1234567          â† åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¯»å–ä½ç½®

é€šä¿—ç†è§£ï¼š
å°±åƒè¯»ä¹¦ä¸€æ ·ï¼Œå‘Šè¯‰ä½ ç°åœ¨è¯»åˆ°ç¬¬å‡ æœ¬ä¹¦(æ–‡ä»¶)çš„ç¬¬å‡ é¡µ(ä½ç½®)
```

**ä½ç½®å‚æ•°å¯¹æ¯”**ï¼š
```
Read_Master_Log_Pos  - IOçº¿ç¨‹è¯»å–åˆ°çš„ä½ç½®ï¼ˆå·²ä¸‹è½½ï¼‰
Exec_Master_Log_Pos  - SQLçº¿ç¨‹æ‰§è¡Œåˆ°çš„ä½ç½®ï¼ˆå·²åº”ç”¨ï¼‰

æ­£å¸¸æƒ…å†µï¼šä¸¤ä¸ªä½ç½®åº”è¯¥ç›¸ç­‰æˆ–æ¥è¿‘
å¼‚å¸¸æƒ…å†µï¼šå·®è·è¿‡å¤§è¯´æ˜SQLçº¿ç¨‹å¤„ç†æ…¢ï¼Œç§¯å‹ä¸¥é‡
```

### 3.4 ä¸­ç»§æ—¥å¿—ç›‘æ§


**Relay_Log_Fileå’ŒRelay_Log_Pos**ï¼š
```
Relay_Log_File: relay-bin.000002      â† å½“å‰ä½¿ç”¨çš„ä¸­ç»§æ—¥å¿—æ–‡ä»¶
Relay_Log_Pos: 890123                 â† åœ¨ä¸­ç»§æ—¥å¿—ä¸­çš„ä½ç½®
Relay_Log_Space: 1024000              â† ä¸­ç»§æ—¥å¿—æ€»å ç”¨ç©ºé—´

ä¸­ç»§æ—¥å¿—ä½œç”¨ï¼š
ä¸»åº“æ—¥å¿— â†’ ä¸­ç»§æ—¥å¿—(æœ¬åœ°å­˜å‚¨) â†’ SQLçº¿ç¨‹æ‰§è¡Œ
          â†‘
    ç±»ä¼¼ç¼“å†²åŒºï¼Œé¿å…ç½‘ç»œä¸­æ–­å½±å“
```

---

## 4. â±ï¸ å»¶è¿Ÿç›‘æ§ä¸åˆ†æ


### 4.1 Seconds_Behind_Masterè¯¦è§£


**å»¶è¿Ÿçš„å«ä¹‰**ï¼š
```
Seconds_Behind_Master: 5

é€šä¿—è§£é‡Šï¼š
ä»åº“æ¯”ä¸»åº“"æ…¢äº†5ç§’é’Ÿ"
ä¸»åº“5ç§’å‰çš„æ“ä½œï¼Œä»åº“ç°åœ¨æ‰æ‰§è¡Œå®Œ
```

**å»¶è¿Ÿå€¼è§£è¯»**ï¼š
- **0**ï¼šå®Œå…¨åŒæ­¥ï¼Œæ— å»¶è¿Ÿ
- **å°äº5ç§’**ï¼šæ­£å¸¸èŒƒå›´ï¼Œå¯æ¥å—
- **5-30ç§’**ï¼šè½»å¾®å»¶è¿Ÿï¼Œéœ€å…³æ³¨
- **å¤§äº30ç§’**ï¼šä¸¥é‡å»¶è¿Ÿï¼Œéœ€ç«‹å³å¤„ç†
- **NULL**ï¼šIOçº¿ç¨‹æˆ–SQLçº¿ç¨‹æœªè¿è¡Œ

### 4.2 å»¶è¿Ÿäº§ç”Ÿçš„åŸå› 


**å¸¸è§å»¶è¿ŸåŸå› **ï¼š
```
ç½‘ç»œå»¶è¿Ÿï¼š
ä¸»åº“ --[æ…¢ç½‘ç»œ]--> ä»åº“
IOçº¿ç¨‹è·å–æ—¥å¿—æ…¢

ç¡¬ä»¶æ€§èƒ½ï¼š
ä¸»åº“: SSDé«˜æ€§èƒ½    ä»åº“: æœºæ¢°ç¡¬ç›˜
       â†“              â†“
     å†™å…¥å¿«          æ‰§è¡Œæ…¢

SQLå¤æ‚åº¦ï¼š
ä¸»åº“å¹¶å‘å†™å…¥ â†’ ä»åº“å•çº¿ç¨‹æ‰§è¡Œ
   å¤šæ¡ç®€å•SQL     ä¸€æ¡å¤æ‚SQL
```

### 4.3 å»¶è¿Ÿç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# å»¶è¿Ÿç›‘æ§è„šæœ¬

MYSQL_USER="monitor"
MYSQL_PASSWORD="password"
MYSQL_HOST="localhost"

# è·å–å»¶è¿Ÿä¿¡æ¯
DELAY=$(mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master" | awk '{print $2}')

# åˆ¤æ–­å»¶è¿Ÿæƒ…å†µ
if [ "$DELAY" = "NULL" ]; then
    echo "âŒ è­¦å‘Šï¼šå¤åˆ¶çº¿ç¨‹æœªè¿è¡Œï¼"
    exit 2
elif [ "$DELAY" -gt 30 ]; then
    echo "ğŸ”´ ä¸¥é‡ï¼šå»¶è¿Ÿ ${DELAY} ç§’ï¼Œè¶…è¿‡é˜ˆå€¼ï¼"
    exit 1
elif [ "$DELAY" -gt 5 ]; then
    echo "ğŸŸ¡ æ³¨æ„ï¼šå»¶è¿Ÿ ${DELAY} ç§’ï¼Œéœ€è¦å…³æ³¨"
    exit 0
else
    echo "âœ… æ­£å¸¸ï¼šå»¶è¿Ÿ ${DELAY} ç§’"
    exit 0
fi
```

---

## 5. ğŸš¨ é”™è¯¯ä¿¡æ¯è¯Šæ–­


### 5.1 IOçº¿ç¨‹é”™è¯¯åˆ†æ


**Last_IO_Errorå¸¸è§é”™è¯¯**ï¼š

```sql
-- 1. è¿æ¥æƒé™é”™è¯¯
Last_IO_Error: Access denied for user 'replication'@'192.168.1.101'

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥å¤åˆ¶ç”¨æˆ·æƒé™
2. ç¡®è®¤ç”¨æˆ·å¯†ç æ­£ç¡®
3. éªŒè¯ç½‘ç»œè¿æ¥
```

```sql
-- 2. ç½‘ç»œè¿æ¥è¶…æ—¶
Last_IO_Error: Got timeout reading communication packets

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. è°ƒæ•´è¶…æ—¶å‚æ•°
3. ç¡®è®¤ä¸»åº“çŠ¶æ€
```

```sql
-- 3. æ—¥å¿—æ–‡ä»¶ä¸¢å¤±
Last_IO_Error: Got fatal error 1236 from master when reading data from binary log

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥ä¸»åº“binlogæ–‡ä»¶
2. é‡æ–°åˆå§‹åŒ–ä»åº“
3. ä½¿ç”¨GTIDæ¨¡å¼é¿å…ä½ç½®ä¾èµ–
```

### 5.2 SQLçº¿ç¨‹é”™è¯¯åˆ†æ


**Last_SQL_Errorå¸¸è§é”™è¯¯**ï¼š

```sql
-- 1. ä¸»é”®å†²çª
Last_SQL_Error: Duplicate entry '123' for key 'PRIMARY'

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
2. æ‰‹åŠ¨åˆ é™¤å†²çªæ•°æ®
3. è·³è¿‡è¯¥é”™è¯¯äº‹åŠ¡ï¼šSET GLOBAL sql_slave_skip_counter = 1;
```

```sql
-- 2. è¡¨ä¸å­˜åœ¨
Last_SQL_Error: Table 'test.users' doesn't exist

è§£å†³æ–¹æ¡ˆï¼š
1. ç¡®è®¤è¡¨ç»“æ„ä¸€è‡´
2. æ‰‹åŠ¨åˆ›å»ºç¼ºå¤±çš„è¡¨
3. é‡æ–°åˆå§‹åŒ–ä»åº“
```

```sql
-- 3. å­—æ®µä¸åŒ¹é…
Last_SQL_Error: Unknown column 'new_field' in 'field list'

è§£å†³æ–¹æ¡ˆï¼š
1. æ£€æŸ¥è¡¨ç»“æ„å·®å¼‚
2. åŒæ­¥è¡¨ç»“æ„å˜æ›´
3. ä½¿ç”¨pt-table-syncå·¥å…·
```

### 5.3 é”™è¯¯å¤„ç†æµç¨‹


```
å‘ç°é”™è¯¯
    â†“
1. è®°å½•é”™è¯¯ä¿¡æ¯
    â†“
2. åœæ­¢å¤åˆ¶
STOP SLAVE;
    â†“
3. åˆ†æé”™è¯¯åŸå› 
æ£€æŸ¥Last_IO_Erroræˆ–Last_SQL_Error
    â†“
4. ä¿®å¤å…·ä½“é—®é¢˜
æ ¹æ®é”™è¯¯ç±»å‹é‡‡å–å¯¹åº”æªæ–½
    â†“
5. å¯åŠ¨å¤åˆ¶
START SLAVE;
    â†“
6. éªŒè¯ä¿®å¤ç»“æœ
SHOW SLAVE STATUS\G
```

---

## 6. ğŸ› ï¸ å¥åº·æ£€æŸ¥è„šæœ¬å®æˆ˜


### 6.1 åŸºç¡€ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# MySQLä¸»ä»å¤åˆ¶å¥åº·æ£€æŸ¥è„šæœ¬

# é…ç½®ä¿¡æ¯
MYSQL_USER="monitor"
MYSQL_PASSWORD="monitor123"
MYSQL_HOST="localhost"
MYSQL_PORT=3306

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "ğŸ” MySQLä¸»ä»å¤åˆ¶çŠ¶æ€æ£€æŸ¥ - $(date)"
echo "=================================="

# æ£€æŸ¥MySQLè¿æ¥
if ! mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -P$MYSQL_PORT -e "SELECT 1" &>/dev/null; then
    echo -e "${RED}âŒ MySQLè¿æ¥å¤±è´¥${NC}"
    exit 1
fi

# è·å–å¤åˆ¶çŠ¶æ€
SLAVE_STATUS=$(mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -P$MYSQL_PORT -e "SHOW SLAVE STATUS\G" 2>/dev/null)

if [ -z "$SLAVE_STATUS" ]; then
    echo -e "${RED}âŒ æœªé…ç½®ä¸»ä»å¤åˆ¶${NC}"
    exit 1
fi

# è§£æçŠ¶æ€ä¿¡æ¯
IO_RUNNING=$(echo "$SLAVE_STATUS" | grep "Slave_IO_Running:" | awk '{print $2}')
SQL_RUNNING=$(echo "$SLAVE_STATUS" | grep "Slave_SQL_Running:" | awk '{print $2}')
SECONDS_BEHIND=$(echo "$SLAVE_STATUS" | grep "Seconds_Behind_Master:" | awk '{print $2}')
LAST_IO_ERROR=$(echo "$SLAVE_STATUS" | grep "Last_IO_Error:" | cut -d: -f2- | sed 's/^ *//')
LAST_SQL_ERROR=$(echo "$SLAVE_STATUS" | grep "Last_SQL_Error:" | cut -d: -f2- | sed 's/^ *//')

echo "ğŸ“Š å¤åˆ¶çŠ¶æ€æ‘˜è¦ï¼š"
echo "â”œâ”€ IOçº¿ç¨‹è¿è¡ŒçŠ¶æ€: $IO_RUNNING"
echo "â”œâ”€ SQLçº¿ç¨‹è¿è¡ŒçŠ¶æ€: $SQL_RUNNING"
echo "â””â”€ å¤åˆ¶å»¶è¿Ÿ: $SECONDS_BEHIND ç§’"
echo ""

# æ£€æŸ¥ç»“æœ
ERRORS=0

# æ£€æŸ¥IOçº¿ç¨‹
if [ "$IO_RUNNING" != "Yes" ]; then
    echo -e "${RED}âŒ IOçº¿ç¨‹æœªè¿è¡Œ${NC}"
    [ -n "$LAST_IO_ERROR" ] && echo -e "   é”™è¯¯ä¿¡æ¯: $LAST_IO_ERROR"
    ERRORS=$((ERRORS + 1))
else
    echo -e "${GREEN}âœ… IOçº¿ç¨‹è¿è¡Œæ­£å¸¸${NC}"
fi

# æ£€æŸ¥SQLçº¿ç¨‹
if [ "$SQL_RUNNING" != "Yes" ]; then
    echo -e "${RED}âŒ SQLçº¿ç¨‹æœªè¿è¡Œ${NC}"
    [ -n "$LAST_SQL_ERROR" ] && echo -e "   é”™è¯¯ä¿¡æ¯: $LAST_SQL_ERROR"
    ERRORS=$((ERRORS + 1))
else
    echo -e "${GREEN}âœ… SQLçº¿ç¨‹è¿è¡Œæ­£å¸¸${NC}"
fi

# æ£€æŸ¥å»¶è¿Ÿ
if [ "$SECONDS_BEHIND" = "NULL" ]; then
    echo -e "${RED}âŒ æ— æ³•è·å–å»¶è¿Ÿä¿¡æ¯ï¼ˆçº¿ç¨‹å¯èƒ½æœªè¿è¡Œï¼‰${NC}"
    ERRORS=$((ERRORS + 1))
elif [ "$SECONDS_BEHIND" -gt 30 ]; then
    echo -e "${RED}âŒ å»¶è¿Ÿè¿‡é«˜: ${SECONDS_BEHIND} ç§’${NC}"
    ERRORS=$((ERRORS + 1))
elif [ "$SECONDS_BEHIND" -gt 5 ]; then
    echo -e "${YELLOW}âš ï¸  å»¶è¿Ÿè¾ƒé«˜: ${SECONDS_BEHIND} ç§’${NC}"
else
    echo -e "${GREEN}âœ… å»¶è¿Ÿæ­£å¸¸: ${SECONDS_BEHIND} ç§’${NC}"
fi

echo ""
echo "=================================="

if [ $ERRORS -eq 0 ]; then
    echo -e "${GREEN}ğŸ‰ ä¸»ä»å¤åˆ¶çŠ¶æ€å¥åº·${NC}"
    exit 0
else
    echo -e "${RED}ğŸ’¥ å‘ç° $ERRORS ä¸ªé—®é¢˜ï¼Œéœ€è¦å¤„ç†${NC}"
    exit 1
fi
```

### 6.2 è¯¦ç»†è¯Šæ–­è„šæœ¬


```bash
#!/bin/bash
# MySQLä¸»ä»å¤åˆ¶è¯¦ç»†è¯Šæ–­è„šæœ¬

MYSQL_USER="monitor"
MYSQL_PASSWORD="monitor123"
MYSQL_HOST="localhost"

echo "ğŸ”¬ MySQLä¸»ä»å¤åˆ¶è¯¦ç»†è¯Šæ–­"
echo "========================"

# è·å–å®Œæ•´çŠ¶æ€
mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -e "
SELECT 
    'ğŸ“ è¿æ¥ä¿¡æ¯' as 'è¯Šæ–­é¡¹ç›®',
    CONCAT('ä¸»åº“: ', Master_Host, ':', Master_Port) as 'è¯¦ç»†ä¿¡æ¯'
UNION ALL
SELECT 
    'ğŸ“‚ å½“å‰å¤„ç†æ–‡ä»¶',
    CONCAT('ä¸»åº“æ—¥å¿—: ', Master_Log_File, ' ä½ç½®: ', Read_Master_Log_Pos)
UNION ALL
SELECT 
    'ğŸ“ ä¸­ç»§æ—¥å¿—',
    CONCAT('æ–‡ä»¶: ', Relay_Log_File, ' ä½ç½®: ', Relay_Log_Pos)
UNION ALL
SELECT 
    'â±ï¸ å»¶è¿ŸçŠ¶æ€',
    CONCAT('å»¶è¿Ÿ: ', IFNULL(Seconds_Behind_Master, 'NULL'), ' ç§’')
UNION ALL
SELECT 
    'ğŸ”„ IOçº¿ç¨‹',
    CONCAT('çŠ¶æ€: ', Slave_IO_Running, ' | ', Slave_IO_State)
UNION ALL
SELECT 
    'âš™ï¸ SQLçº¿ç¨‹',
    CONCAT('çŠ¶æ€: ', Slave_SQL_Running, ' | ', Slave_SQL_Running_State)
FROM performance_schema.replication_connection_status 
JOIN performance_schema.replication_applier_status;
" 2>/dev/null

echo ""
echo "ğŸ” ä½ç½®åˆ†æï¼š"

# ä½ç½®å·®å¼‚åˆ†æ
mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -e "
SELECT 
    'è¯»å–ä½ç½®' as 'ç±»å‹',
    Master_Log_File as 'æ—¥å¿—æ–‡ä»¶',
    Read_Master_Log_Pos as 'ä½ç½®'
FROM performance_schema.replication_connection_status
UNION ALL
SELECT 
    'æ‰§è¡Œä½ç½®',
    Master_Log_File,
    Exec_Master_Log_Pos
FROM performance_schema.replication_connection_status;
" 2>/dev/null

echo ""
echo "ğŸ“Š æ€§èƒ½æŒ‡æ ‡ï¼š"

# æ€§èƒ½ç›¸å…³ä¿¡æ¯
mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -e "
SELECT 
    ROUND(Relay_Log_Space/1024/1024, 2) as 'ä¸­ç»§æ—¥å¿—å¤§å°(MB)',
    Connect_Retry as 'é‡è¿é—´éš”(ç§’)',
    Master_Retry_Count as 'é‡è¯•æ¬¡æ•°é™åˆ¶'
FROM performance_schema.replication_connection_status;
" 2>/dev/null
```

### 6.3 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


```bash
#!/bin/bash
# è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬ - åŒ…å«å‘Šè­¦åŠŸèƒ½

MYSQL_USER="monitor"
MYSQL_PASSWORD="monitor123"
MYSQL_HOST="localhost"

# å‘Šè­¦é…ç½®
DELAY_WARNING=5      # å»¶è¿Ÿè­¦å‘Šé˜ˆå€¼ï¼ˆç§’ï¼‰
DELAY_CRITICAL=30    # å»¶è¿Ÿä¸¥é‡é˜ˆå€¼ï¼ˆç§’ï¼‰
LOG_FILE="/var/log/mysql_replication_monitor.log"

# æ—¥å¿—å‡½æ•°
log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a $LOG_FILE
}

# å‘é€å‘Šè­¦ï¼ˆå¯ä»¥é›†æˆé’‰é’‰ã€é‚®ä»¶ç­‰ï¼‰
send_alert() {
    local level=$1
    local message=$2
    
    log_message "[$level] $message"
    
    # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„å‘Šè­¦å‘é€é€»è¾‘
    # ä¾‹å¦‚ï¼šå‘é€é‚®ä»¶ã€é’‰é’‰æ¶ˆæ¯ã€çŸ­ä¿¡ç­‰
    case $level in
        "CRITICAL")
            echo "ğŸš¨ ä¸¥é‡å‘Šè­¦ï¼š$message"
            # curl -X POST "é’‰é’‰webhook" -d "..."
            ;;
        "WARNING")
            echo "âš ï¸ è­¦å‘Šï¼š$message"
            ;;
        "INFO")
            echo "â„¹ï¸ ä¿¡æ¯ï¼š$message"
            ;;
    esac
}

# ä¸»ç›‘æ§é€»è¾‘
check_replication() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # è·å–çŠ¶æ€
    local status=$(mysql -u$MYSQL_USER -p$MYSQL_PASSWORD -h$MYSQL_HOST -e "
        SELECT 
            Slave_IO_Running,
            Slave_SQL_Running,
            IFNULL(Seconds_Behind_Master, -1) as delay,
            Last_IO_Error,
            Last_SQL_Error
        FROM performance_schema.replication_connection_status 
        JOIN performance_schema.replication_applier_status;
    " --batch --skip-column-names 2>/dev/null)
    
    if [ -z "$status" ]; then
        send_alert "CRITICAL" "æ— æ³•è·å–å¤åˆ¶çŠ¶æ€ä¿¡æ¯"
        return 1
    fi
    
    # è§£æçŠ¶æ€
    IFS=$'\t' read -r io_running sql_running delay io_error sql_error <<< "$status"
    
    # æ£€æŸ¥IOçº¿ç¨‹
    if [ "$io_running" != "Yes" ]; then
        send_alert "CRITICAL" "IOçº¿ç¨‹æœªè¿è¡Œ - é”™è¯¯: $io_error"
    fi
    
    # æ£€æŸ¥SQLçº¿ç¨‹
    if [ "$sql_running" != "Yes" ]; then
        send_alert "CRITICAL" "SQLçº¿ç¨‹æœªè¿è¡Œ - é”™è¯¯: $sql_error"
    fi
    
    # æ£€æŸ¥å»¶è¿Ÿ
    if [ "$delay" -eq -1 ]; then
        send_alert "CRITICAL" "æ— æ³•è·å–å»¶è¿Ÿä¿¡æ¯"
    elif [ "$delay" -gt $DELAY_CRITICAL ]; then
        send_alert "CRITICAL" "å¤åˆ¶å»¶è¿Ÿä¸¥é‡: ${delay}ç§’"
    elif [ "$delay" -gt $DELAY_WARNING ]; then
        send_alert "WARNING" "å¤åˆ¶å»¶è¿Ÿè¾ƒé«˜: ${delay}ç§’"
    else
        log_message "INFO: å¤åˆ¶çŠ¶æ€æ­£å¸¸ - å»¶è¿Ÿ: ${delay}ç§’"
    fi
}

# æ‰§è¡Œæ£€æŸ¥
check_replication

# å¦‚æœä½œä¸ºå®šæ—¶ä»»åŠ¡è¿è¡Œï¼Œå¯ä»¥æ·»åŠ åˆ°crontabï¼š
# */5 * * * * /path/to/monitor_script.sh
```

---

## 7. ğŸ“ˆ ç›‘æ§æœ€ä½³å®è·µ


### 7.1 ç›‘æ§æŒ‡æ ‡ä½“ç³»


**æ ¸å¿ƒç›‘æ§æŒ‡æ ‡**ï¼š
```
ğŸ”´ å…³é”®æŒ‡æ ‡ï¼ˆå¿…é¡»ç›‘æ§ï¼‰ï¼š
â”œâ”€ Slave_IO_Running        - IOçº¿ç¨‹çŠ¶æ€
â”œâ”€ Slave_SQL_Running       - SQLçº¿ç¨‹çŠ¶æ€  
â”œâ”€ Seconds_Behind_Master   - å¤åˆ¶å»¶è¿Ÿ
â””â”€ Last_IO_Error/Last_SQL_Error - é”™è¯¯ä¿¡æ¯

ğŸŸ¡ é‡è¦æŒ‡æ ‡ï¼ˆå»ºè®®ç›‘æ§ï¼‰ï¼š
â”œâ”€ Relay_Log_Space         - ä¸­ç»§æ—¥å¿—å ç”¨ç©ºé—´
â”œâ”€ Read_Master_Log_Pos     - è¯»å–ä½ç½®
â”œâ”€ Exec_Master_Log_Pos     - æ‰§è¡Œä½ç½®
â””â”€ Master_Log_File         - å½“å‰æ—¥å¿—æ–‡ä»¶

ğŸŸ¢ è¾…åŠ©æŒ‡æ ‡ï¼ˆå¯é€‰ç›‘æ§ï¼‰ï¼š
â”œâ”€ Connect_Retry           - é‡è¿é—´éš”
â”œâ”€ Master_Retry_Count      - é‡è¯•æ¬¡æ•°
â””â”€ Slave_IO_State          - IOçº¿ç¨‹è¯¦ç»†çŠ¶æ€
```

### 7.2 å‘Šè­¦é˜ˆå€¼è®¾ç½®


**å»¶è¿Ÿå‘Šè­¦é˜ˆå€¼**ï¼š
```
ä¸šåŠ¡ç±»å‹          è­¦å‘Šé˜ˆå€¼    ä¸¥é‡é˜ˆå€¼    å¤„ç†å»ºè®®
å®æ—¶äº¤æ˜“ç³»ç»Ÿ        1ç§’        3ç§’       ç«‹å³å¤„ç†
ä¸€èˆ¬ä¸šåŠ¡ç³»ç»Ÿ        5ç§’        30ç§’      ä¼˜å…ˆå¤„ç†  
æŠ¥è¡¨åˆ†æç³»ç»Ÿ        30ç§’       300ç§’     è®¡åˆ’å¤„ç†
æ•°æ®å¤‡ä»½ç³»ç»Ÿ        300ç§’      3600ç§’    å®šæœŸæ£€æŸ¥
```

### 7.3 ç›‘æ§éƒ¨ç½²æ¶æ„


```
ç›‘æ§æ¶æ„å›¾ï¼š

ä¸»åº“æœåŠ¡å™¨ â†â”€â”€â”€â”€â”€â”€â”€ ä»åº“æœåŠ¡å™¨
     â”‚                  â”‚
     â”‚              ç›‘æ§è„šæœ¬
     â”‚                  â”‚
     â””â”€â”€â”€â”€ ç›‘æ§ä¸­å¿ƒ â†â”€â”€â”€â”€â”˜
           (Prometheus/Zabbix)
                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
        å‘Šè­¦ç³»ç»Ÿ  â”‚  å¯è§†åŒ–
       (AlertManager) â”‚ (Grafana)
            â”‚     â”‚     â”‚
        â”Œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
      é‚®ä»¶  çŸ­ä¿¡  é’‰é’‰  ä¼å¾®  ç”µè¯
```

### 7.4 æ•…éšœå¤„ç†æµç¨‹


**æ ‡å‡†å¤„ç†æµç¨‹**ï¼š
```
1. å‘Šè­¦æ¥æ”¶ (1åˆ†é’Ÿå†…)
   â†“
2. é—®é¢˜ç¡®è®¤ (3åˆ†é’Ÿå†…)
   - ç™»å½•ä»åº“ç¡®è®¤çŠ¶æ€
   - æ£€æŸ¥å…·ä½“é”™è¯¯ä¿¡æ¯
   â†“
3. å½±å“è¯„ä¼° (5åˆ†é’Ÿå†…)
   - ç¡®è®¤ä¸šåŠ¡å½±å“èŒƒå›´
   - è¯„ä¼°ç´§æ€¥ç¨‹åº¦
   â†“
4. åº”æ€¥å¤„ç† (15åˆ†é’Ÿå†…)
   - æ ¹æ®é”™è¯¯ç±»å‹å¿«é€Ÿå¤„ç†
   - å¿…è¦æ—¶åˆ‡æ¢åˆ°å¤‡ç”¨ä»åº“
   â†“
5. æ ¹æœ¬è§£å†³ (60åˆ†é’Ÿå†…)
   - å½»åº•è§£å†³æ ¹æœ¬åŸå› 
   - éªŒè¯ä¿®å¤æ•ˆæœ
   â†“
6. æ€»ç»“è®°å½•
   - è®°å½•é—®é¢˜åŸå› å’Œè§£å†³æ–¹æ¡ˆ
   - æ›´æ–°ç›‘æ§å’Œæµç¨‹
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ ç›‘æ§å‘½ä»¤ï¼šSHOW SLAVE STATUSæ˜¯ä¸»ä»ç›‘æ§çš„æ ¸å¿ƒå‘½ä»¤
ğŸ”¸ å…³é”®çŠ¶æ€ï¼šIOçº¿ç¨‹å’ŒSQLçº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€å†³å®šå¤åˆ¶æ˜¯å¦æ­£å¸¸
ğŸ”¸ å»¶è¿Ÿç›‘æ§ï¼šSeconds_Behind_Masteråæ˜ æ•°æ®ä¸€è‡´æ€§ç¨‹åº¦
ğŸ”¸ é”™è¯¯è¯Šæ–­ï¼šLast_IO_Errorå’ŒLast_SQL_Errorå¸®åŠ©å®šä½å…·ä½“é—®é¢˜
ğŸ”¸ ä½ç½®ä¿¡æ¯ï¼šæ—¥å¿—æ–‡ä»¶å’Œä½ç½®ä¿¡æ¯ç”¨äºæ•…éšœæ¢å¤
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ å¤åˆ¶ç›‘æ§çš„æœ¬è´¨**
```
å¤åˆ¶ç›‘æ§å°±åƒç›‘æ§"æ•°æ®æ¬è¿å·¥"ï¼š
- IOçº¿ç¨‹ = è´Ÿè´£ä¸‹è½½çš„å·¥äºº
- SQLçº¿ç¨‹ = è´Ÿè´£å®‰è£…çš„å·¥äºº  
- å»¶è¿Ÿ = å·¥ä½œè¿›åº¦è½åç¨‹åº¦
- é”™è¯¯ = å·¥äººé‡åˆ°çš„å…·ä½“é—®é¢˜
```

**ğŸ”¹ çŠ¶æ€å‚æ•°çš„å…³è”å…³ç³»**
```
æ­£å¸¸çŠ¶æ€ç»„åˆï¼š
Slave_IO_Running: Yes + Slave_SQL_Running: Yes + Seconds_Behind_Master: 0-5

å±é™©ä¿¡å·ï¼š
- ä»»ä¸€çº¿ç¨‹ä¸ºNo = å¤åˆ¶ä¸­æ–­
- å»¶è¿ŸæŒç»­å¢é•¿ = æ€§èƒ½é—®é¢˜
- é”™è¯¯ä¿¡æ¯ä¸ä¸ºç©º = éœ€è¦äººå·¥å¹²é¢„
```

**ğŸ”¹ ç›‘æ§çš„æ—¶æ•ˆæ€§è¦æ±‚**
```
å®æ—¶ç›‘æ§ï¼šæ¯30ç§’-1åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
å‘Šè­¦å“åº”ï¼šé—®é¢˜å‘ç”Ÿå5åˆ†é’Ÿå†…å“åº”
æ•…éšœæ¢å¤ï¼š15-60åˆ†é’Ÿå†…è§£å†³ï¼ˆæ ¹æ®ä¸šåŠ¡é‡è¦æ€§ï¼‰
```

### 8.3 å®é™…åº”ç”¨ä»·å€¼


- **ç”Ÿäº§ç¯å¢ƒå¿…å¤‡**ï¼šä¸»ä»å¤åˆ¶æ˜¯é«˜å¯ç”¨çš„åŸºç¡€ï¼Œç›‘æ§æ˜¯ä¿éšœ
- **æ•…éšœé¢„é˜²**ï¼šåŠæ—¶å‘ç°é—®é¢˜é¿å…æ•°æ®ä¸ä¸€è‡´
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé€šè¿‡å»¶è¿Ÿç›‘æ§è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
- **è¿ç»´è‡ªåŠ¨åŒ–**ï¼šè„šæœ¬åŒ–ç›‘æ§æé«˜è¿ç»´æ•ˆç‡
- **ä¸šåŠ¡è¿ç»­æ€§**ï¼šå¿«é€Ÿæ•…éšœå‘ç°å’Œå¤„ç†ä¿éšœä¸šåŠ¡ç¨³å®š

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸»ä»ç›‘æ§çœ‹ä¸‰ç‚¹ï¼šä¸¤ä¸ªçº¿ç¨‹ä¸€å»¶è¿Ÿ
- IOè´Ÿè´£ä¸‹SQLè£…ï¼Œé”™è¯¯ä¿¡æ¯è¦è®°ç‰¢
- å»¶è¿Ÿæ§åˆ¶åœ¨å‡ ç§’ï¼Œè¶…æ—¶å‘Šè­¦è¦çŸ¥é“
- è„šæœ¬ç›‘æ§è‡ªåŠ¨åŒ–ï¼Œæ•…éšœå¤„ç†è¦é«˜æ•ˆ