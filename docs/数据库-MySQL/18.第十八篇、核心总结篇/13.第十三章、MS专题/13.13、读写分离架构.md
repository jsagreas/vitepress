---
title: 13ã€è¯»å†™åˆ†ç¦»æ¶æ„
---
## ğŸ“š ç›®å½•

1. [è¯»å†™åˆ†ç¦»åŸç†](#1-è¯»å†™åˆ†ç¦»åŸç†)
2. [åº”ç”¨å±‚å®ç°æ–¹æ¡ˆ](#2-åº”ç”¨å±‚å®ç°æ–¹æ¡ˆ)
3. [ä¸­é—´ä»¶ä»£ç†æ–¹æ¡ˆ](#3-ä¸­é—´ä»¶ä»£ç†æ–¹æ¡ˆ)
4. [ProxySQLé…ç½®è¯¦è§£](#4-ProxySQLé…ç½®è¯¦è§£)
5. [MySQL Routerä½¿ç”¨](#5-MySQL-Routerä½¿ç”¨)
6. [è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡](#6-è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡)
7. [æ•°æ®ä¸€è‡´æ€§å¤„ç†](#7-æ•°æ®ä¸€è‡´æ€§å¤„ç†)
8. [æ•…éšœè½¬ç§»é…ç½®](#8-æ•…éšœè½¬ç§»é…ç½®)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¯»å†™åˆ†ç¦»åŸç†


### 1.1 ä»€ä¹ˆæ˜¯è¯»å†™åˆ†ç¦»


**ç®€å•ç†è§£**ï¼šæŠŠæ•°æ®åº“çš„è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå¤„ç†

```
ä¼ ç»Ÿå•æœºæ¶æ„ï¼š                è¯»å†™åˆ†ç¦»æ¶æ„ï¼š
åº”ç”¨ç¨‹åº                     åº”ç”¨ç¨‹åº
   |                           |
   v                          v
MySQLæœåŠ¡å™¨               è¯»å†™åˆ†ç¦»ä¸­é—´ä»¶
(è¯»+å†™å‹åŠ›å¤§)                 /    \
                           å†™/      \è¯»
                           v        v
                      ä¸»æœåŠ¡å™¨    ä»æœåŠ¡å™¨
                    (ä¸“é—¨å†™å…¥)   (ä¸“é—¨æŸ¥è¯¢)
```

**æ ¸å¿ƒæ€æƒ³**ï¼š
- ğŸ”¸ **ä¸»åº“è´Ÿè´£å†™**ï¼šINSERTã€UPDATEã€DELETEæ“ä½œ
- ğŸ”¸ **ä»åº“è´Ÿè´£è¯»**ï¼šSELECTæŸ¥è¯¢æ“ä½œ
- ğŸ”¸ **æ•°æ®åŒæ­¥**ï¼šä¸»åº“å˜æ›´è‡ªåŠ¨åŒæ­¥åˆ°ä»åº“
- ğŸ”¸ **è´Ÿè½½åˆ†æ•£**ï¼šè¯»å†™å‹åŠ›åˆ†æ•£åˆ°ä¸åŒæœåŠ¡å™¨

### 1.2 è¯»å†™åˆ†ç¦»çš„ä¼˜åŠ¿


**æ€§èƒ½æå‡**ï¼š
```
å•æœºæƒ…å†µï¼š
â”œâ”€ è¯»å†™æ··åˆï¼Œèµ„æºç«äº‰æ¿€çƒˆ
â”œâ”€ ç£ç›˜IOæˆä¸ºç“¶é¢ˆ
â””â”€ CPUå’Œå†…å­˜ä½¿ç”¨ä¸å‡è¡¡

è¯»å†™åˆ†ç¦»åï¼š
â”œâ”€ è¯»å†™æ“ä½œåˆ†ç¦»ï¼Œå‡å°‘èµ„æºç«äº‰
â”œâ”€ ä»åº“å¯ä»¥ä¼˜åŒ–ä¸“é—¨ç”¨äºæŸ¥è¯¢
â”œâ”€ æ”¯æŒå¤šä¸ªä»åº“ï¼Œè¯»æ€§èƒ½çº¿æ€§æå‡
â””â”€ ä¸»åº“ä¸“æ³¨å†™å…¥ï¼Œå†™æ€§èƒ½æ›´ç¨³å®š
```

**å¯ç”¨æ€§æå‡**ï¼š
- âœ… **å®¹é”™èƒ½åŠ›**ï¼šä»åº“æ•…éšœä¸å½±å“å†™å…¥
- âœ… **è´Ÿè½½åˆ†æ•£**ï¼šå¤šä¸ªä»åº“åˆ†æ‹…è¯»å‹åŠ›
- âœ… **ç»´æŠ¤æ–¹ä¾¿**ï¼šå¯ä»¥é€ä¸ªç»´æŠ¤ä»åº“è€Œä¸å½±å“æœåŠ¡

### 1.3 è¯»å†™åˆ†ç¦»æ¶æ„æ¨¡å¼


**å…¸å‹æ¶æ„å›¾**ï¼š
```
                     åº”ç”¨å±‚
                       |
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              |   è¯»å†™åˆ†ç¦»ç»„ä»¶     |
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       |
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         |             |             |
         v             v             v
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   | ä¸»æ•°æ®åº“ |   | ä»æ•°æ®åº“1|   | ä»æ•°æ®åº“2|
   | (Master)|   | (Slave1)|   | (Slave2)|
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        |             ^             ^
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              ä¸»ä»å¤åˆ¶åŒæ­¥
```

---

## 2. ğŸ’» åº”ç”¨å±‚å®ç°æ–¹æ¡ˆ


### 2.1 åº”ç”¨å±‚è¯»å†™åˆ†ç¦»åŸç†


**ä»€ä¹ˆæ˜¯åº”ç”¨å±‚å®ç°**ï¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ç›´æ¥åˆ¤æ–­SQLç±»å‹ï¼Œè¿æ¥ä¸åŒçš„æ•°æ®åº“

**å®ç°æ–¹å¼**ï¼š
```java
// Javaåº”ç”¨å±‚å®ç°ç¤ºä¾‹
public class DatabaseRouter {
    private DataSource masterDataSource;   // ä¸»åº“è¿æ¥
    private DataSource slaveDataSource;    // ä»åº“è¿æ¥
    
    public Connection getConnection(String sql) {
        if (isWriteOperation(sql)) {
            return masterDataSource.getConnection();  // å†™æ“ä½œè¿ä¸»åº“
        } else {
            return slaveDataSource.getConnection();   // è¯»æ“ä½œè¿ä»åº“
        }
    }
    
    private boolean isWriteOperation(String sql) {
        String upperSql = sql.toUpperCase().trim();
        return upperSql.startsWith("INSERT") || 
               upperSql.startsWith("UPDATE") || 
               upperSql.startsWith("DELETE");
    }
}
```

### 2.2 Spring Booté›†æˆç¤ºä¾‹


**é…ç½®å¤šæ•°æ®æº**ï¼š
```yaml
# application.yml
spring:
  datasource:
    master:
      jdbc-url: jdbc:mysql://master-db:3306/mydb
      username: root
      password: password
      driver-class-name: com.mysql.cj.jdbc.Driver
    slave:
      jdbc-url: jdbc:mysql://slave-db:3306/mydb
      username: readonly
      password: password
      driver-class-name: com.mysql.cj.jdbc.Driver
```

**åŠ¨æ€æ•°æ®æºé…ç½®**ï¼š
```java
@Configuration
public class DataSourceConfig {
    
    @Bean("masterDataSource")
    @ConfigurationProperties("spring.datasource.master")
    public DataSource masterDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean("slaveDataSource")
    @ConfigurationProperties("spring.datasource.slave")
    public DataSource slaveDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean
    public DataSource dynamicDataSource() {
        DynamicDataSource dataSource = new DynamicDataSource();
        Map<Object, Object> dataSourceMap = new HashMap<>();
        dataSourceMap.put("master", masterDataSource());
        dataSourceMap.put("slave", slaveDataSource());
        dataSource.setTargetDataSources(dataSourceMap);
        dataSource.setDefaultTargetDataSource(masterDataSource());
        return dataSource;
    }
}
```

**AOPå®ç°è‡ªåŠ¨è·¯ç”±**ï¼š
```java
@Aspect
@Component
public class DataSourceAspect {
    
    @Around("@annotation(ReadOnly)")
    public Object switchToSlave(ProceedingJoinPoint point) throws Throwable {
        try {
            DataSourceContextHolder.setDataSource("slave");
            return point.proceed();
        } finally {
            DataSourceContextHolder.clear();
        }
    }
    
    @Around("@annotation(WriteOnly)")
    public Object switchToMaster(ProceedingJoinPoint point) throws Throwable {
        try {
            DataSourceContextHolder.setDataSource("master");
            return point.proceed();
        } finally {
            DataSourceContextHolder.clear();
        }
    }
}
```

### 2.3 åº”ç”¨å±‚æ–¹æ¡ˆä¼˜ç¼ºç‚¹


| ç‰¹æ€§ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|------|----------|----------|
| ğŸ”¸ **æ€§èƒ½** | `æ— ä¸­é—´ä»¶å¼€é”€ï¼Œæ€§èƒ½æœ€é«˜` | `éœ€è¦ç®¡ç†å¤šä¸ªè¿æ¥æ± ` |
| ğŸ”¸ **çµæ´»æ€§** | `å¯ä»¥ç²¾ç¡®æ§åˆ¶è·¯ç”±é€»è¾‘` | `ä»£ç å¤æ‚åº¦è¾ƒé«˜` |
| ğŸ”¸ **ç»´æŠ¤æ€§** | `ä¸šåŠ¡é€»è¾‘æ¸…æ™°å¯æ§` | `æ¯ä¸ªåº”ç”¨éƒ½è¦å®ç°ä¸€é` |
| ğŸ”¸ **é€æ˜æ€§** | `å¯¹DBAé€æ˜` | `å¯¹å¼€å‘è€…ä¸é€æ˜` |

---

## 3. ğŸ”„ ä¸­é—´ä»¶ä»£ç†æ–¹æ¡ˆ


### 3.1 ä¸­é—´ä»¶ä»£ç†åŸç†


**ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶ä»£ç†**ï¼šåœ¨åº”ç”¨å’Œæ•°æ®åº“ä¹‹é—´å¢åŠ ä¸€ä¸ªä»£ç†å±‚ï¼Œä»£ç†å±‚è´Ÿè´£è·¯ç”±è¯·æ±‚

```
åº”ç”¨ç¨‹åºè®¿é—®æµç¨‹ï¼š

åº”ç”¨ç¨‹åº
    |
    | (æ ‡å‡†MySQLåè®®)
    v
è¯»å†™åˆ†ç¦»ä¸­é—´ä»¶
    |
    â”œâ”€â”€ è§£æSQLè¯­å¥
    â”œâ”€â”€ åˆ¤æ–­è¯»å†™ç±»å‹  
    â”œâ”€â”€ é€‰æ‹©ç›®æ ‡æ•°æ®åº“
    â””â”€â”€ è½¬å‘è¯·æ±‚
    |
    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
| ä¸»æ•°æ®åº“ | ä»æ•°æ®åº“ |
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸­é—´ä»¶çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- ğŸ”¸ **SQLè§£æ**ï¼šåˆ†æSQLè¯­å¥ç±»å‹
- ğŸ”¸ **è¿æ¥ç®¡ç†**ï¼šç»´æŠ¤åˆ°å„æ•°æ®åº“çš„è¿æ¥æ± 
- ğŸ”¸ **è´Ÿè½½å‡è¡¡**ï¼šåœ¨å¤šä¸ªä»åº“é—´åˆ†é…è¯»è¯·æ±‚
- ğŸ”¸ **æ•…éšœæ£€æµ‹**ï¼šç›‘æ§æ•°æ®åº“å¥åº·çŠ¶æ€

### 3.2 ä¸»æµä¸­é—´ä»¶å¯¹æ¯”


| ä¸­é—´ä»¶ | **ç±»å‹** | **æ€§èƒ½** | **åŠŸèƒ½** | **é€‚ç”¨åœºæ™¯** |
|--------|----------|----------|----------|-------------|
| ğŸ”¸ **ProxySQL** | `ç‹¬ç«‹ä»£ç†` | `æé«˜` | `åŠŸèƒ½ä¸°å¯Œ` | `å¤§å‹äº’è”ç½‘åº”ç”¨` |
| ğŸ”¸ **MySQL Router** | `å®˜æ–¹è·¯ç”±` | `é«˜` | `ç®€å•å®ç”¨` | `MySQLç”Ÿæ€ç¯å¢ƒ` |
| ğŸ”¸ **MaxScale** | `ä¸“ä¸šä»£ç†` | `é«˜` | `ä¼ä¸šçº§` | `MariaDBç¯å¢ƒ` |
| ğŸ”¸ **MyCat** | `å›½äº§ä»£ç†` | `ä¸­ç­‰` | `åˆ†åº“åˆ†è¡¨` | `ä¸­å°å‹ä¼ä¸š` |

### 3.3 ä¸­é—´ä»¶æ–¹æ¡ˆä¼˜ç¼ºç‚¹


**ä¼˜ç‚¹**ï¼š
- âœ… **åº”ç”¨é€æ˜**ï¼šåº”ç”¨æ— éœ€ä¿®æ”¹ä»£ç 
- âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šé›†ä¸­é…ç½®è¯»å†™åˆ†ç¦»ç­–ç•¥
- âœ… **åŠŸèƒ½ä¸°å¯Œ**ï¼šæ”¯æŒè´Ÿè½½å‡è¡¡ã€æ•…éšœè½¬ç§»ç­‰é«˜çº§åŠŸèƒ½
- âœ… **ç›‘æ§æ–¹ä¾¿**ï¼šæä¾›è¯¦ç»†çš„æ€§èƒ½ç›‘æ§æŒ‡æ ‡

**ç¼ºç‚¹**ï¼š
- âŒ **é¢å¤–å¼€é”€**ï¼šå¢åŠ ç½‘ç»œå»¶è¿Ÿå’Œèµ„æºæ¶ˆè€—
- âŒ **å•ç‚¹é£é™©**ï¼šä¸­é—´ä»¶æœ¬èº«å¯èƒ½æˆä¸ºç“¶é¢ˆ
- âŒ **å¤æ‚æ€§**ï¼šå¢åŠ æ¶æ„å¤æ‚åº¦å’Œè¿ç»´éš¾åº¦

---

## 4. âš™ï¸ ProxySQLé…ç½®è¯¦è§£


### 4.1 ProxySQLåŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯ProxySQL**ï¼šé«˜æ€§èƒ½çš„MySQLä»£ç†æœåŠ¡å™¨ï¼Œä¸“é—¨ä¸ºè¯»å†™åˆ†ç¦»å’Œè´Ÿè½½å‡è¡¡è®¾è®¡

**æ ¸å¿ƒç»„ä»¶**ï¼š
```
ProxySQLæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç®¡ç†ç•Œé¢       â”‚ â† Webç•Œé¢å’ŒSQLæ¥å£
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è§„åˆ™å¼•æ“       â”‚ â† SQLè·¯ç”±è§„åˆ™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è¿æ¥æ±          â”‚ â† æ•°æ®åº“è¿æ¥ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç›‘æ§ç»Ÿè®¡       â”‚ â† æ€§èƒ½æŒ‡æ ‡æ”¶é›†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ProxySQLå®‰è£…é…ç½®


**å®‰è£…ProxySQL**ï¼š
```bash
# CentOS/RHELå®‰è£…
sudo yum install -y proxysql

# Ubuntu/Debianå®‰è£…  
sudo apt-get install proxysql

# å¯åŠ¨æœåŠ¡
sudo systemctl start proxysql
sudo systemctl enable proxysql
```

**åŸºç¡€é…ç½®æ–‡ä»¶**ï¼š
```sql
-- è¿æ¥ProxySQLç®¡ç†ç•Œé¢
mysql -u admin -padmin -h 127.0.0.1 -P6032

-- é…ç½®MySQLæœåŠ¡å™¨ç»„
INSERT INTO mysql_servers(hostgroup_id, hostname, port, weight) VALUES
(0, '192.168.1.10', 3306, 1000),  -- ä¸»åº“ï¼Œå†™ç»„
(1, '192.168.1.11', 3306, 900),   -- ä»åº“1ï¼Œè¯»ç»„
(1, '192.168.1.12', 3306, 900);   -- ä»åº“2ï¼Œè¯»ç»„

-- ç”Ÿæ•ˆé…ç½®
LOAD MYSQL SERVERS TO RUNTIME;
SAVE MYSQL SERVERS TO DISK;
```

### 4.3 è¯»å†™åˆ†ç¦»è§„åˆ™é…ç½®


**é…ç½®ç”¨æˆ·å’Œè·¯ç”±è§„åˆ™**ï¼š
```sql
-- é…ç½®åº”ç”¨ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup) VALUES
('appuser', 'password123', 0);  -- é»˜è®¤è¿æ¥å†™ç»„

-- é…ç½®è¯»å†™åˆ†ç¦»è§„åˆ™
INSERT INTO mysql_query_rules(rule_id, match_pattern, destination_hostgroup, apply) VALUES
(1, '^SELECT.*', 1, 1),          -- SELECTè¯­å¥è·¯ç”±åˆ°è¯»ç»„
(2, '^INSERT.*', 0, 1),          -- INSERTè¯­å¥è·¯ç”±åˆ°å†™ç»„
(3, '^UPDATE.*', 0, 1),          -- UPDATEè¯­å¥è·¯ç”±åˆ°å†™ç»„
(4, '^DELETE.*', 0, 1);          -- DELETEè¯­å¥è·¯ç”±åˆ°å†™ç»„

-- ç‰¹æ®Šè§„åˆ™ï¼šäº‹åŠ¡å†…çš„SELECTä¹Ÿèµ°ä¸»åº“
INSERT INTO mysql_query_rules(rule_id, match_pattern, destination_hostgroup, apply) VALUES
(10, '^SELECT.*FOR UPDATE.*', 0, 1);  -- SELECT FOR UPDATEèµ°å†™ç»„

-- ç”Ÿæ•ˆé…ç½®
LOAD MYSQL USERS TO RUNTIME;
LOAD MYSQL QUERY RULES TO RUNTIME;
SAVE MYSQL USERS TO DISK;
SAVE MYSQL QUERY RULES TO DISK;
```

### 4.4 é«˜çº§é…ç½®é€‰é¡¹


**è¿æ¥æ± ä¼˜åŒ–**ï¼š
```sql
-- è®¾ç½®è¿æ¥æ± å‚æ•°
UPDATE global_variables SET variable_value='1000' 
WHERE variable_name='mysql-max_connections';

UPDATE global_variables SET variable_value='10' 
WHERE variable_name='mysql-free_connections_pct';

-- è®¾ç½®å¥åº·æ£€æŸ¥
UPDATE global_variables SET variable_value='2000' 
WHERE variable_name='mysql-ping_interval_server_msec';

-- ç”Ÿæ•ˆé…ç½®
LOAD MYSQL VARIABLES TO RUNTIME;
SAVE MYSQL VARIABLES TO DISK;
```

**æ•…éšœåˆ‡æ¢é…ç½®**ï¼š
```sql
-- é…ç½®å¥åº·æ£€æŸ¥ç”¨æˆ·
INSERT INTO mysql_users(username, password, default_hostgroup) VALUES
('monitor', 'monitor123', 0);

-- è®¾ç½®ç›‘æ§å‚æ•°
UPDATE global_variables SET variable_value='monitor' 
WHERE variable_name='mysql-monitor_username';
UPDATE global_variables SET variable_value='monitor123' 
WHERE variable_name='mysql-monitor_password';

-- è®¾ç½®æ•…éšœæ£€æµ‹é—´éš”
UPDATE global_variables SET variable_value='2000' 
WHERE variable_name='mysql-monitor_ping_interval';
```

---

## 5. ğŸ”€ MySQL Routerä½¿ç”¨


### 5.1 MySQL RouteråŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯MySQL Router**ï¼šOracleå®˜æ–¹æä¾›çš„è½»é‡çº§MySQLä»£ç†ï¼Œä¸“é—¨ä¸ºMySQL Group Replicationå’Œä¸»ä»å¤åˆ¶è®¾è®¡

**ç‰¹ç‚¹**ï¼š
- ğŸ”¸ **å®˜æ–¹æ”¯æŒ**ï¼šMySQLå®˜æ–¹ç»´æŠ¤ï¼Œå…¼å®¹æ€§æœ€å¥½
- ğŸ”¸ **è½»é‡çº§**ï¼šèµ„æºå ç”¨å°‘ï¼Œæ€§èƒ½å¼€é”€å°
- ğŸ”¸ **ç®€å•é…ç½®**ï¼šé…ç½®ç®€å•ï¼Œæ˜“äºéƒ¨ç½²
- ğŸ”¸ **è‡ªåŠ¨å‘ç°**ï¼šæ”¯æŒè‡ªåŠ¨å‘ç°MySQLé›†ç¾¤æ‹“æ‰‘

### 5.2 MySQL Routerå®‰è£…é…ç½®


**å®‰è£…MySQL Router**ï¼š
```bash
# ä¸‹è½½å®‰è£…åŒ…
wget https://dev.mysql.com/get/Downloads/MySQL-Router/mysql-router-8.0.33-linux-glibc2.12-x86_64.tar.xz

# è§£å‹å®‰è£…
tar -xf mysql-router-8.0.33-linux-glibc2.12-x86_64.tar.xz
sudo mv mysql-router-8.0.33-linux-glibc2.12-x86_64 /opt/mysql-router

# åˆ›å»ºé…ç½®ç›®å½•
sudo mkdir -p /etc/mysqlrouter
```

**åŸºç¡€é…ç½®æ–‡ä»¶**ï¼š
```ini
# /etc/mysqlrouter/mysqlrouter.conf
[DEFAULT]
logging_folder = /var/log/mysqlrouter
runtime_folder = /var/run/mysqlrouter
config_folder = /etc/mysqlrouter

# è¯»å†™åˆ†ç¦»é…ç½®
[routing:primary]
bind_address = 0.0.0.0
bind_port = 7001
destinations = 192.168.1.10:3306    # ä¸»åº“åœ°å€
routing_strategy = first-available
mode = read-write

[routing:secondary]  
bind_address = 0.0.0.0
bind_port = 7002
destinations = 192.168.1.11:3306,192.168.1.12:3306  # ä»åº“åœ°å€
routing_strategy = round-robin
mode = read-only

# æ—¥å¿—é…ç½®
[logger]
level = INFO
```

### 5.3 Routerä½¿ç”¨ç¤ºä¾‹


**åº”ç”¨è¿æ¥é…ç½®**ï¼š
```java
// Javaåº”ç”¨é…ç½®
@Configuration
public class RouterDataSourceConfig {
    
    @Bean("writeDataSource")
    public DataSource writeDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://router-host:7001/mydb");  // å†™ç«¯å£
        config.setUsername("appuser");
        config.setPassword("password");
        return new HikariDataSource(config);
    }
    
    @Bean("readDataSource") 
    public DataSource readDataSource() {
        HikariConfig config = new HikariConfig();
        config.setJdbcUrl("jdbc:mysql://router-host:7002/mydb");  // è¯»ç«¯å£
        config.setUsername("appuser");
        config.setPassword("password");
        return new HikariDataSource(config);
    }
}
```

**å¯åŠ¨å’Œç›‘æ§**ï¼š
```bash
# å¯åŠ¨Router
/opt/mysql-router/bin/mysqlrouter -c /etc/mysqlrouter/mysqlrouter.conf

# æŸ¥çœ‹çŠ¶æ€
curl http://localhost:8443/api/20190715/routes/

# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
curl http://localhost:8443/api/20190715/connections/
```

---

## 6. ğŸ”— è¿æ¥æ± ä¸è´Ÿè½½å‡è¡¡


### 6.1 è¿æ¥æ± é…ç½®åŸç†


**ä¸ºä»€ä¹ˆéœ€è¦è¿æ¥æ± **ï¼šæ•°æ®åº“è¿æ¥åˆ›å»ºå’Œé”€æ¯ä»£ä»·é«˜æ˜‚

```
æ— è¿æ¥æ± ï¼š                    æœ‰è¿æ¥æ± ï¼š
åº”ç”¨è¯·æ±‚ â†’ åˆ›å»ºè¿æ¥          åº”ç”¨è¯·æ±‚ â†’ ä»æ± ä¸­è·å–è¿æ¥
       â†’ æ‰§è¡ŒSQL                    â†’ æ‰§è¡ŒSQL  
       â†’ å…³é—­è¿æ¥                    â†’ å½’è¿˜è¿æ¥åˆ°æ± 
       
å¼€é”€ï¼šæ¯æ¬¡éƒ½è¦TCPæ¡æ‰‹         å¼€é”€ï¼šä»…åœ¨æ± åˆå§‹åŒ–æ—¶æ¡æ‰‹
```

### 6.2 è¿æ¥æ± æœ€ä½³å®è·µ


**HikariCPé…ç½®ç¤ºä¾‹**ï¼š
```yaml
# application.yml
spring:
  datasource:
    master:
      type: com.zaxxer.hikari.HikariDataSource
      hikari:
        minimum-idle: 5          # æœ€å°ç©ºé—²è¿æ¥
        maximum-pool-size: 20    # æœ€å¤§è¿æ¥æ•°
        idle-timeout: 300000     # ç©ºé—²è¶…æ—¶(5åˆ†é’Ÿ)
        max-lifetime: 1200000    # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´(20åˆ†é’Ÿ)
        connection-timeout: 20000 # è¿æ¥è¶…æ—¶(20ç§’)
        
    slave:
      type: com.zaxxer.hikari.HikariDataSource  
      hikari:
        minimum-idle: 10         # è¯»åº“è¿æ¥å¯ä»¥å¤šä¸€äº›
        maximum-pool-size: 50    # è¯»å‹åŠ›å¤§ï¼Œæ± å­å¤§ä¸€äº›
        idle-timeout: 300000
        max-lifetime: 1200000
        connection-timeout: 20000
```

**è¿æ¥æ± å‚æ•°è°ƒä¼˜æŒ‡å—**ï¼š
```
å‚æ•°è°ƒä¼˜åŸåˆ™ï¼š

1. æœ€å¤§è¿æ¥æ•° = CPUæ ¸å¿ƒæ•° Ã— 2 + ç£ç›˜æ•°é‡
   â””â”€ ä¾‹ï¼š8æ ¸CPU + 2å—ç£ç›˜ = 18ä¸ªè¿æ¥

2. æœ€å°ç©ºé—²è¿æ¥ = æœ€å¤§è¿æ¥æ•° Ã— 0.25  
   â””â”€ ä¿æŒè¶³å¤Ÿçš„çƒ­è¿æ¥

3. è¿æ¥è¶…æ—¶ = ä¸šåŠ¡æœ€å¤§å®¹å¿æ—¶é—´
   â””â”€ é€šå¸¸è®¾ç½®ä¸º20-30ç§’

4. ç©ºé—²è¶…æ—¶ = 5-10åˆ†é’Ÿ
   â””â”€ é¿å…é•¿æ—¶é—´å ç”¨è¿æ¥

5. æœ€å¤§ç”Ÿå­˜æ—¶é—´ = æ•°æ®åº“wait_timeoutçš„ä¸€åŠ
   â””â”€ é¿å…è¿æ¥è¢«æ•°æ®åº“å¼ºåˆ¶å…³é—­
```

### 6.3 è´Ÿè½½å‡è¡¡ç­–ç•¥


**å¸¸è§è´Ÿè½½å‡è¡¡ç®—æ³•**ï¼š

| ç®—æ³• | **åŸç†** | **é€‚ç”¨åœºæ™¯** | **ä¼˜ç¼ºç‚¹** |
|------|----------|-------------|-----------|
| ğŸ”¸ **è½®è¯¢** | `ä¾æ¬¡åˆ†é…åˆ°æ¯ä¸ªä»åº“` | `ä»åº“é…ç½®ç›¸åŒ` | `ç®€å•ä½†ä¸è€ƒè™‘è´Ÿè½½` |
| ğŸ”¸ **åŠ æƒè½®è¯¢** | `æ ¹æ®æƒé‡æ¯”ä¾‹åˆ†é…` | `ä»åº“é…ç½®ä¸åŒ` | `é™æ€æƒé‡ï¼Œä¸å¤Ÿçµæ´»` |
| ğŸ”¸ **æœ€å°‘è¿æ¥** | `åˆ†é…åˆ°è¿æ¥æ•°æœ€å°‘çš„ä»åº“` | `é•¿è¿æ¥è¾ƒå¤š` | `åŠ¨æ€è´Ÿè½½å‡è¡¡` |
| ğŸ”¸ **å“åº”æ—¶é—´** | `åˆ†é…åˆ°å“åº”æœ€å¿«çš„ä»åº“` | `æ€§èƒ½å·®å¼‚æ˜æ˜¾` | `æœ€ä¼˜ä½†å®ç°å¤æ‚` |

**ProxySQLè´Ÿè½½å‡è¡¡é…ç½®**ï¼š
```sql
-- é…ç½®ä»åº“æƒé‡
UPDATE mysql_servers SET weight=1000 WHERE hostgroup_id=1 AND hostname='192.168.1.11';
UPDATE mysql_servers SET weight=500 WHERE hostgroup_id=1 AND hostname='192.168.1.12';

-- è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•
UPDATE global_variables SET variable_value='0' 
WHERE variable_name='mysql-default_query_delay';  -- å»¶è¿Ÿ0ms

UPDATE global_variables SET variable_value='1' 
WHERE variable_name='mysql-threshold_query_length';  -- æŸ¥è¯¢é•¿åº¦é˜ˆå€¼

-- ç”Ÿæ•ˆé…ç½®
LOAD MYSQL SERVERS TO RUNTIME;
LOAD MYSQL VARIABLES TO RUNTIME;
```

---

## 7. ğŸ“Š æ•°æ®ä¸€è‡´æ€§å¤„ç†


### 7.1 ä¸»ä»å»¶è¿Ÿé—®é¢˜


**ä»€ä¹ˆæ˜¯ä¸»ä»å»¶è¿Ÿ**ï¼šä¸»åº“å†™å…¥æ•°æ®åï¼Œä»åº“è¿˜æ²¡æœ‰åŒæ­¥åˆ°æœ€æ–°æ•°æ®

```
ä¸»ä»å»¶è¿Ÿæ—¶åºå›¾ï¼š

æ—¶é—´è½´: 0ç§’     1ç§’     2ç§’     3ç§’
ä¸»åº“:   å†™å…¥ â†’ ç¡®è®¤   
             â†“
ä»åº“:       æ¥æ”¶ â†’ åº”ç”¨ â†’ å®Œæˆ

åº”ç”¨:   å†™å…¥ â†’ ç«‹å³è¯»å– â†’ è¯»åˆ°æ—§æ•°æ®ï¼

å»¶è¿ŸåŸå› ï¼š
â”œâ”€ ç½‘ç»œå»¶è¿Ÿï¼šä¸»ä»åº“é—´ç½‘ç»œä¼ è¾“æ—¶é—´
â”œâ”€ ç£ç›˜IOï¼šä»åº“å†™å…¥ç£ç›˜çš„æ—¶é—´  
â”œâ”€ SQLæ‰§è¡Œï¼šå¤æ‚SQLåœ¨ä»åº“æ‰§è¡Œæ—¶é—´
â””â”€ é”ç­‰å¾…ï¼šä»åº“ä¸Šçš„é”ç«äº‰
```

### 7.2 ä¸€è‡´æ€§ä¿éšœç­–ç•¥


**ğŸ”¸ å¼ºä¸€è‡´æ€§ç­–ç•¥**ï¼š
```java
// å†™åè¯»ä¸»åº“ç­–ç•¥
@Service
public class UserService {
    
    @Autowired
    private UserMapper userMapper;
    
    // å†™æ“ä½œåçš„è¯»æ“ä½œå¼ºåˆ¶èµ°ä¸»åº“
    @Transactional
    public void updateUserAndRead(Long userId, String name) {
        // 1. æ›´æ–°ç”¨æˆ·(èµ°ä¸»åº“)
        userMapper.updateUser(userId, name);
        
        // 2. ç«‹å³è¯»å–(å¼ºåˆ¶èµ°ä¸»åº“)
        forceReadFromMaster(() -> {
            return userMapper.selectById(userId);
        });
    }
    
    private <T> T forceReadFromMaster(Supplier<T> supplier) {
        try {
            DataSourceContextHolder.setDataSource("master");
            return supplier.get();
        } finally {
            DataSourceContextHolder.clear();
        }
    }
}
```

**ğŸ”¸ ä¼šè¯ä¿æŒç­–ç•¥**ï¼š
```java
// åŸºäºSessionçš„ä¸»åº“è¯»å–
@Component
public class ConsistencyHandler {
    
    private static final String WRITE_SESSION_KEY = "recent_write_timestamp";
    private static final long CONSISTENCY_WINDOW = 5000; // 5ç§’ä¸€è‡´æ€§çª—å£
    
    public void markRecentWrite(HttpSession session) {
        session.setAttribute(WRITE_SESSION_KEY, System.currentTimeMillis());
    }
    
    public boolean shouldReadFromMaster(HttpSession session) {
        Long writeTime = (Long) session.getAttribute(WRITE_SESSION_KEY);
        if (writeTime == null) {
            return false;
        }
        
        long elapsed = System.currentTimeMillis() - writeTime;
        return elapsed < CONSISTENCY_WINDOW;
    }
}
```

### 7.3 æœ€ç»ˆä¸€è‡´æ€§å¤„ç†


**å»¶è¿Ÿå®¹å¿åœºæ™¯**ï¼š
```java
// å¯¹å»¶è¿Ÿä¸æ•æ„Ÿçš„æŸ¥è¯¢å¯ä»¥èµ°ä»åº“
@Service
public class ReportService {
    
    @ReadOnly  // æ³¨è§£æ ‡è®°èµ°ä»åº“
    public List<OrderStatistics> getDailyReport(Date date) {
        // æŠ¥è¡¨æŸ¥è¯¢å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œå¯ä»¥æ¥å—å‡ ç§’å»¶è¿Ÿ
        return orderMapper.selectDailyStatistics(date);
    }
    
    @ReadOnly
    public List<User> searchUsers(String keyword) {
        // ç”¨æˆ·æœç´¢å¯ä»¥æ¥å—å»¶è¿Ÿ
        return userMapper.searchByKeyword(keyword);
    }
}
```

**è¡¥å¿æœºåˆ¶**ï¼š
```java
// è¯»å–å¤±è´¥æ—¶çš„è¡¥å¿ç­–ç•¥
@Component
public class ReadFallbackHandler {
    
    public User getUserWithFallback(Long userId) {
        try {
            // 1. å°è¯•ä»ä»åº“è¯»å–
            return slaveUserMapper.selectById(userId);
        } catch (Exception e) {
            logger.warn("ä»åº“è¯»å–å¤±è´¥ï¼Œå›é€€åˆ°ä¸»åº“: {}", e.getMessage());
            // 2. ä»åº“å¤±è´¥æ—¶å›é€€åˆ°ä¸»åº“
            return masterUserMapper.selectById(userId);
        }
    }
}
```

---

## 8. ğŸ”„ æ•…éšœè½¬ç§»é…ç½®


### 8.1 æ•…éšœæ£€æµ‹æœºåˆ¶


**å¥åº·æ£€æŸ¥åŸç†**ï¼š
```
å¥åº·æ£€æŸ¥æµç¨‹ï¼š

ä¸­é—´ä»¶ â†’ å®šæœŸå‘é€å¿ƒè·³ â†’ æ•°æ®åº“
        â†“
    è®°å½•å“åº”æ—¶é—´å’ŒçŠ¶æ€
        â†“
    è¶…è¿‡é˜ˆå€¼æ ‡è®°ä¸ºä¸å¥åº·
        â†“
    ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤
```

**ProxySQLæ•…éšœæ£€æµ‹é…ç½®**ï¼š
```sql
-- é…ç½®å¥åº·æ£€æŸ¥å‚æ•°
UPDATE global_variables SET variable_value='2000' 
WHERE variable_name='mysql-monitor_ping_interval';        -- å¿ƒè·³é—´éš”2ç§’

UPDATE global_variables SET variable_value='10' 
WHERE variable_name='mysql-monitor_ping_max_failures';    -- æœ€å¤§å¤±è´¥æ¬¡æ•°

UPDATE global_variables SET variable_value='1000' 
WHERE variable_name='mysql-monitor_ping_timeout';         -- å¿ƒè·³è¶…æ—¶1ç§’

-- æŸ¥çœ‹æœåŠ¡å™¨å¥åº·çŠ¶æ€
SELECT * FROM monitor.mysql_server_ping_log 
WHERE time_start_us > UNIX_TIMESTAMP(NOW() - INTERVAL 1 HOUR) * 1000000;
```

### 8.2 è‡ªåŠ¨æ•…éšœè½¬ç§»


**ä»åº“æ•…éšœè½¬ç§»**ï¼š
```sql
-- ProxySQLè‡ªåŠ¨æ•…éšœè½¬ç§»é…ç½®
INSERT INTO mysql_servers(hostgroup_id, hostname, port, status, weight) VALUES
(1, '192.168.1.11', 3306, 'ONLINE', 1000),   -- ä¸»ä»åº“
(1, '192.168.1.12', 3306, 'ONLINE', 1000),   -- å¤‡ä»åº“
(2, '192.168.1.13', 3306, 'OFFLINE_SOFT', 1000); -- æ•…éšœè½¬ç§»å¤‡åº“

-- æ•…éšœè½¬ç§»è§„åˆ™
INSERT INTO mysql_query_rules(rule_id, match_pattern, destination_hostgroup, apply) VALUES
(100, '^SELECT.*', 1, 1);  -- æ­£å¸¸æƒ…å†µèµ°hostgroup 1

-- å½“hostgroup 1å…¨éƒ¨æ•…éšœæ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°hostgroup 2
```

**ä¸»åº“æ•…éšœè½¬ç§»**ï¼š
```bash
# ä¸»åº“æ•…éšœæ—¶çš„æ‰‹åŠ¨åˆ‡æ¢è„šæœ¬
#!/bin/bash

# 1. æ£€æµ‹ä¸»åº“çŠ¶æ€
if ! mysql -h192.168.1.10 -e "SELECT 1" > /dev/null 2>&1; then
    echo "ä¸»åº“æ•…éšœï¼Œå¼€å§‹åˆ‡æ¢..."
    
    # 2. é€‰æ‹©æœ€æ–°çš„ä»åº“ä½œä¸ºæ–°ä¸»åº“
    NEW_MASTER=$(mysql -h192.168.1.11 -e "SHOW SLAVE STATUS\G" | grep "Seconds_Behind_Master" | awk '{print $2}')
    
    # 3. æå‡ä»åº“ä¸ºä¸»åº“
    mysql -h192.168.1.11 -e "STOP SLAVE; RESET SLAVE ALL;"
    
    # 4. æ›´æ–°ProxySQLé…ç½®
    mysql -h127.0.0.1 -P6032 -uadmin -padmin -e "
        UPDATE mysql_servers SET hostgroup_id=0 
        WHERE hostname='192.168.1.11';
        LOAD MYSQL SERVERS TO RUNTIME;
    "
    
    echo "æ•…éšœè½¬ç§»å®Œæˆ"
fi
```

### 8.3 åŠè‡ªåŠ¨æ•…éšœè½¬ç§»


**MHAï¼ˆMaster High Availabilityï¼‰æ–¹æ¡ˆ**ï¼š
```yaml
# MHAé…ç½®æ–‡ä»¶
server_id=1
[server default]
manager_workdir=/var/log/masterha/app1
manager_log=/var/log/masterha/app1/manager.log
master_binlog_dir=/var/lib/mysql
user=mha
password=mha_password
ping_interval=3
repl_user=replication
repl_password=repl_password

[server1]
hostname=192.168.1.10
candidate_master=1

[server2]  
hostname=192.168.1.11
candidate_master=1

[server3]
hostname=192.168.1.12
no_master=1
```

**æ•…éšœè½¬ç§»ç›‘æ§**ï¼š
```bash
# å¯åŠ¨MHAç®¡ç†å™¨
nohup masterha_manager --conf=/etc/mha/app1.cnf > /var/log/mha.log 2>&1 &

# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
masterha_check_status --conf=/etc/mha/app1.cnf

# æ‰‹åŠ¨æ•…éšœè½¬ç§»
masterha_master_switch --conf=/etc/mha/app1.cnf --master_state=dead \
  --dead_master_host=192.168.1.10 --new_master_host=192.168.1.11
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¯»å†™åˆ†ç¦»åŸç†ï¼šä¸»åº“å†™ï¼Œä»åº“è¯»ï¼Œé€šè¿‡å¤åˆ¶ä¿æŒæ•°æ®åŒæ­¥
ğŸ”¸ å®ç°æ–¹æ¡ˆå¯¹æ¯”ï¼šåº”ç”¨å±‚çµæ´»ä½†å¤æ‚ï¼Œä¸­é—´ä»¶é€æ˜ä½†æœ‰å¼€é”€
ğŸ”¸ è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼šè½®è¯¢ã€åŠ æƒã€æœ€å°‘è¿æ¥ã€å“åº”æ—¶é—´ç­‰ç®—æ³•
ğŸ”¸ ä¸€è‡´æ€§å¤„ç†ï¼šå¼ºä¸€è‡´æ€§ vs æœ€ç»ˆä¸€è‡´æ€§ï¼Œå»¶è¿Ÿå®¹å¿åº¦æƒè¡¡
ğŸ”¸ æ•…éšœè½¬ç§»ï¼šå¥åº·æ£€æŸ¥ã€è‡ªåŠ¨åˆ‡æ¢ã€æ‰‹åŠ¨æ¢å¤ç­‰æœºåˆ¶
```

### 9.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¯»å†™åˆ†ç¦»çš„ä»·å€¼**
```
æ€§èƒ½æ–¹é¢ï¼š
â”œâ”€ è¯»å†™åˆ†ç¦»ï¼šå‡å°‘å•æœºå‹åŠ›ï¼Œæå‡å¹¶å‘èƒ½åŠ›
â”œâ”€ æ°´å¹³æ‰©å±•ï¼šå¢åŠ ä»åº“çº¿æ€§æå‡è¯»æ€§èƒ½
â”œâ”€ ä¸“ä¸šä¼˜åŒ–ï¼šä¸»åº“ä¼˜åŒ–å†™å…¥ï¼Œä»åº“ä¼˜åŒ–æŸ¥è¯¢
â””â”€ ç¼“å­˜å‹å¥½ï¼šä»åº“å¯ä»¥é…ç½®æ›´å¤§çš„æŸ¥è¯¢ç¼“å­˜

å¯ç”¨æ€§æ–¹é¢ï¼š
â”œâ”€ å®¹é”™èƒ½åŠ›ï¼šä»åº“æ•…éšœä¸å½±å“å†™å…¥æœåŠ¡
â”œâ”€ è´Ÿè½½åˆ†æ•£ï¼šé¿å…å•ç‚¹æ•…éšœå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨
â”œâ”€ ç»´æŠ¤å‹å¥½ï¼šå¯ä»¥é€ä¸ªç»´æŠ¤ä»åº“
â””â”€ å¤‡ä»½å‹å¥½ï¼šå¯ä»¥åœ¨ä»åº“ä¸Šåšå¤‡ä»½
```

**ğŸ”¹ æ–¹æ¡ˆé€‰æ‹©åŸåˆ™**
```
åº”ç”¨å±‚å®ç°é€‚åˆï¼š
â”œâ”€ å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„åœºæ™¯
â”œâ”€ ä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç²¾ç»†æ§åˆ¶
â”œâ”€ å›¢é˜Ÿæœ‰è¶³å¤Ÿçš„å¼€å‘èƒ½åŠ›
â””â”€ åº”ç”¨æ•°é‡ä¸å¤šï¼Œå¯ä»¥ç»Ÿä¸€æ”¹é€ 

ä¸­é—´ä»¶ä»£ç†é€‚åˆï¼š
â”œâ”€ å¸Œæœ›å¯¹åº”ç”¨é€æ˜çš„åœºæ™¯
â”œâ”€ å¤šç§ç¼–ç¨‹è¯­è¨€çš„åº”ç”¨å…±å­˜
â”œâ”€ éœ€è¦ç»Ÿä¸€çš„è¿ç»´ç®¡ç†
â””â”€ å›¢é˜Ÿè¿ç»´èƒ½åŠ›å¼ºäºå¼€å‘èƒ½åŠ›
```

### 9.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ”¸ éƒ¨ç½²æœ€ä½³å®è·µ**
```
ç¡¬ä»¶é…ç½®ï¼š
â”œâ”€ ä¸»åº“ï¼šé«˜æ€§èƒ½SSDï¼Œå……è¶³å†…å­˜ï¼Œå¿«é€ŸCPU
â”œâ”€ ä»åº“ï¼šå¯ä»¥ç¨ä½é…ç½®ï¼Œä½†å†…å­˜è¦å……è¶³
â”œâ”€ ç½‘ç»œï¼šä¸»ä»é—´è¦æœ‰ç¨³å®šé«˜é€Ÿç½‘ç»œè¿æ¥
â””â”€ ç›‘æ§ï¼šå®Œå–„çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»

é…ç½®ä¼˜åŒ–ï¼š
â”œâ”€ ä¸»åº“ï¼šä¼˜åŒ–å†™å…¥æ€§èƒ½ï¼Œé€‚å½“çš„innodb_buffer_pool_size
â”œâ”€ ä»åº“ï¼šä¼˜åŒ–è¯»å–æ€§èƒ½ï¼Œå¢å¤§query_cache_size
â”œâ”€ å¤åˆ¶ï¼šé…ç½®åˆé€‚çš„å¤åˆ¶æ ¼å¼å’Œå¹¶è¡Œå¤åˆ¶
â””â”€ è¿æ¥æ± ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è°ƒæ•´è¿æ¥æ± å‚æ•°
```

**ğŸ”¸ è¿ç»´æ³¨æ„äº‹é¡¹**
```
ç›‘æ§æŒ‡æ ‡ï¼š
â”œâ”€ ä¸»ä»å»¶è¿Ÿï¼šSeconds_Behind_Master
â”œâ”€ è¿æ¥æ•°ï¼šThreads_connected vs max_connections  
â”œâ”€ QPS/TPSï¼šæ¯ç§’æŸ¥è¯¢å’Œäº‹åŠ¡æ•°
â”œâ”€ æ…¢æŸ¥è¯¢ï¼šslow_query_logåˆ†æ
â””â”€ é”™è¯¯æ—¥å¿—ï¼šerror.logç›‘æ§

æ•…éšœå¤„ç†ï¼š
â”œâ”€ ä»åº“æ•…éšœï¼šåŠæ—¶ä¿®å¤æˆ–æ›¿æ¢ï¼Œé¿å…å½±å“è¯»æ€§èƒ½
â”œâ”€ ä¸»åº“æ•…éšœï¼šå¿«é€Ÿåˆ‡æ¢ï¼Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§
â”œâ”€ ç½‘ç»œæ•…éšœï¼šæ£€æŸ¥ä¸»ä»åŒæ­¥çŠ¶æ€ï¼Œå¿…è¦æ—¶é‡å»º
â””â”€ ä¸­é—´ä»¶æ•…éšœï¼šå¤‡ç”¨ä¸­é—´ä»¶æˆ–åº”ç”¨å±‚é™çº§
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- è¯»å†™åˆ†ç¦»æ˜¯æ€§èƒ½ä¼˜åŒ–å’Œé«˜å¯ç”¨çš„é‡è¦æ‰‹æ®µ
- è¦åœ¨åº”ç”¨å¤æ‚åº¦å’Œè¿ç»´å¤æ‚åº¦é—´æ‰¾åˆ°å¹³è¡¡ç‚¹
- æ•°æ®ä¸€è‡´æ€§éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚åšåˆç†æƒè¡¡
- æ•…éšœè½¬ç§»æœºåˆ¶æ˜¯è¯»å†™åˆ†ç¦»æ¶æ„çš„é‡è¦ä¿éšœ
- å®Œå–„çš„ç›‘æ§å’Œè¿ç»´æ˜¯æ¶æ„ç¨³å®šè¿è¡Œçš„åŸºç¡€