---
title: 1ã€Otteræ¦‚è¿°ä¸æ ¸å¿ƒæ¦‚å¿µ
---
## ğŸ“š ç›®å½•

1. [Otteræ˜¯ä»€ä¹ˆ](#1-Otteræ˜¯ä»€ä¹ˆ)
2. [æ ¸å¿ƒæ¶æ„è®¾è®¡](#2-æ ¸å¿ƒæ¶æ„è®¾è®¡)
3. [Canalå¢é‡æ—¥å¿—è§£æåŸç†](#3-Canalå¢é‡æ—¥å¿—è§£æåŸç†)
4. [åˆ†å¸ƒå¼åŒæ­¥æœºåˆ¶](#4-åˆ†å¸ƒå¼åŒæ­¥æœºåˆ¶)
5. [åŒå‘åŒæ­¥ä¸å†²çªå¤„ç†](#5-åŒå‘åŒæ­¥ä¸å†²çªå¤„ç†)
6. [å¼‚æ„æ•°æ®åº“æ”¯æŒ](#6-å¼‚æ„æ•°æ®åº“æ”¯æŒ)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸŒŠ Otteræ˜¯ä»€ä¹ˆ


### 1.1 Otterçš„é€šä¿—å®šä¹‰


**ğŸ’¡ ç®€å•ç†è§£**ï¼šOtterå°±åƒæ˜¯ä¸€ä¸ª**æ•°æ®æ¬è¿å·¥**ï¼Œä¸“é—¨è´Ÿè´£æŠŠä¸€ä¸ªæ•°æ®åº“çš„æ•°æ®å®æ—¶æ¬åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ï¼Œä¿è¯ä¸¤è¾¹çš„æ•°æ®å§‹ç»ˆä¿æŒåŒæ­¥ã€‚

> **å½¢è±¡æ¯”å–»**ï¼šæƒ³è±¡ä½ æœ‰ä¸¤ä¸ªä»“åº“ï¼Œå½“å·¦è¾¹ä»“åº“è¿›è´§æˆ–å‡ºè´§æ—¶ï¼Œå³è¾¹ä»“åº“ä¹Ÿè¦åŒæ­¥è¿›è¡Œç›¸åŒçš„æ“ä½œï¼ŒOtterå°±æ˜¯è´Ÿè´£è¿™ä¸ªåŒæ­¥å·¥ä½œçš„"ä¼ è¯ç­’"ã€‚

```
ä¼ ç»Ÿäººå·¥åŒæ­¥ vs Otterè‡ªåŠ¨åŒæ­¥ï¼š

äººå·¥æ–¹å¼ï¼š
æ•°æ®åº“Aå˜åŒ– â†’ äººå·¥å¯Ÿè§‰ â†’ æ‰‹åŠ¨åœ¨æ•°æ®åº“Bæ‰§è¡Œ â†’ å®¹æ˜“å‡ºé”™ä¸”å»¶è¿Ÿ

Otteræ–¹å¼ï¼š
æ•°æ®åº“Aå˜åŒ– â†’ Otterè‡ªåŠ¨å¯Ÿè§‰ â†’ è‡ªåŠ¨åœ¨æ•°æ®åº“BåŒæ­¥ â†’ æ¯«ç§’çº§åŒæ­¥
```

### 1.2 Otterçš„æ ¸å¿ƒä»·å€¼


**ğŸ¯ è§£å†³çš„å®é™…é—®é¢˜**

| **ä¸šåŠ¡åœºæ™¯** | **æ²¡æœ‰Otterçš„ç—›ç‚¹** | **ä½¿ç”¨Otterçš„æ•ˆæœ** |
|-------------|-------------------|-------------------|
| **å¼‚åœ°å¤‡ä»½** | `æ‰‹åŠ¨å¤‡ä»½ï¼Œå®¹æ˜“é—æ¼` | `å®æ—¶è‡ªåŠ¨å¤‡ä»½ï¼Œæ•°æ®ä¸ä¸¢å¤±` |
| **è¯»å†™åˆ†ç¦»** | `ä¸»ä»å»¶è¿Ÿï¼Œæ•°æ®ä¸ä¸€è‡´` | `æ¯«ç§’çº§åŒæ­¥ï¼Œå‡ ä¹æ— å»¶è¿Ÿ` |
| **æ•°æ®è¿ç§»** | `åœæœºè¿ç§»ï¼Œä¸šåŠ¡ä¸­æ–­` | `åœ¨çº¿è¿ç§»ï¼Œä¸šåŠ¡ä¸åœæœº` |
| **å¤šæœºæˆ¿éƒ¨ç½²** | `æ•°æ®åŒæ­¥å¤æ‚ï¼Œä¸€è‡´æ€§éš¾ä¿è¯` | `è‡ªåŠ¨å¤šæœºæˆ¿åŒæ­¥ï¼Œæ•°æ®å¼ºä¸€è‡´` |

### 1.3 Otteråœ¨é˜¿é‡Œå·´å·´çš„è¯ç”ŸèƒŒæ™¯


**ğŸ“ˆ å‘å±•å†ç¨‹**

```
é˜¿é‡Œæ•°æ®åŒæ­¥çš„æ¼”è¿›ï¼š

æ—©æœŸ(2010å‰)ï¼š
æ‰‹å·¥åŒæ­¥ â†’ è„šæœ¬åŒæ­¥ â†’ ç®€å•å·¥å…·

é—®é¢˜çˆ†å‘æœŸ(2010-2012)ï¼š
â€¢ ä¸šåŠ¡è§„æ¨¡æš´å¢ï¼Œæ‰‹å·¥åŒæ­¥è·Ÿä¸ä¸Š
â€¢ å¤šæœºæˆ¿å»ºè®¾ï¼Œæ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜
â€¢ ç³»ç»Ÿè¶Šæ¥è¶Šå¤šï¼Œæ•°æ®å­¤å²›ä¸¥é‡

Otterè¯ç”Ÿ(2012)ï¼š
â€¢ åŸºäºCanalæ—¥å¿—è§£ææŠ€æœ¯
â€¢ åˆ†å¸ƒå¼æ¶æ„è®¾è®¡
â€¢ æ”¯æŒåŒå‘åŒæ­¥
â€¢ å¼‚æ„æ•°æ®åº“æ”¯æŒ

å¼€æºè´¡çŒ®(2013+)ï¼š
â€¢ å¼€æºç»™ç¤¾åŒºä½¿ç”¨
â€¢ æŒç»­ä¼˜åŒ–å’ŒåŠŸèƒ½å¢å¼º
```

> **ğŸ’¼ å®é™…åº”ç”¨è§„æ¨¡**ï¼šåœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨ï¼ŒOtteræ¯å¤©å¤„ç†**æ•°åäº¿çº§åˆ«**çš„æ•°æ®åŒæ­¥ä»»åŠ¡ï¼Œæ”¯æ’‘æ·˜å®ã€å¤©çŒ«ç­‰æ ¸å¿ƒä¸šåŠ¡çš„æ•°æ®åŒæ­¥éœ€æ±‚ã€‚

---

## 2. ğŸ—ï¸ æ ¸å¿ƒæ¶æ„è®¾è®¡


### 2.1 Otteræ¶æ„å…¨æ™¯å›¾


```
Otteråˆ†å¸ƒå¼æ¶æ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç®¡ç†æ§åˆ¶å°                              â”‚
â”‚               (Webç®¡ç†ç•Œé¢ + é…ç½®ä¸­å¿ƒ)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ é…ç½®ä¸‹å‘ & ç›‘æ§
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ZooKeeperé›†ç¾¤                            â”‚
â”‚              (åè°ƒä¸­å¿ƒ + é…ç½®å­˜å‚¨)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ åè°ƒ & é…ç½®
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NodeèŠ‚ç‚¹1   â”‚    NodeèŠ‚ç‚¹2    â”‚        NodeèŠ‚ç‚¹N            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Select   â”‚ â”‚ â”‚   Extract   â”‚ â”‚ â”‚        Transform        â”‚ â”‚
â”‚ â”‚ (æ•°æ®é€‰æ‹©) â”‚ â”‚ â”‚  (æ•°æ®æå–)  â”‚ â”‚ â”‚       (æ•°æ®è½¬æ¢)        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   Load    â”‚ â”‚ â”‚    ...      â”‚ â”‚ â”‚          ...            â”‚ â”‚
â”‚ â”‚ (æ•°æ®åŠ è½½) â”‚ â”‚ â”‚             â”‚ â”‚ â”‚                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                        â”‚
        â–¼                â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æºæ•°æ®åº“   â”‚ â”‚    ç›®æ ‡æ•°æ®åº“    â”‚ â”‚      å…¶ä»–ç›®æ ‡ç³»ç»Ÿ        â”‚
â”‚  (MySQL)    â”‚ â”‚   (Oracle)      â”‚ â”‚    (ES/HBase...)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶èŒè´£è¯¦è§£


**ğŸ”§ å„ç»„ä»¶å…·ä½“ä½œç”¨**

```java
// ç®¡ç†æ§åˆ¶å°ï¼šç›¸å½“äº"æŒ‡æŒ¥ä¸­å¿ƒ"
åŠŸèƒ½ï¼š
- åˆ›å»ºåŒæ­¥ä»»åŠ¡é…ç½®
- ç›‘æ§åŒæ­¥çŠ¶æ€
- æŸ¥çœ‹åŒæ­¥æ—¥å¿—
- ç®¡ç†èŠ‚ç‚¹ä¿¡æ¯

// ZooKeeperï¼šç›¸å½“äº"åè°ƒå‘˜"
åŠŸèƒ½ï¼š
- å­˜å‚¨é…ç½®ä¿¡æ¯
- åè°ƒå„ä¸ªNodeèŠ‚ç‚¹
- é€‰ä¸¾ä¸»èŠ‚ç‚¹
- çŠ¶æ€ç›‘æ§

// NodeèŠ‚ç‚¹ï¼šç›¸å½“äº"å¹²æ´»çš„å·¥äºº"
åŠŸèƒ½ï¼š
- æ‰§è¡Œå…·ä½“çš„æ•°æ®åŒæ­¥ä»»åŠ¡
- ä»æºåº“è¯»å–æ•°æ®å˜åŒ–
- å¯¹æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†
- å†™å…¥åˆ°ç›®æ ‡åº“
```

### 2.3 SETLæ•°æ®å¤„ç†æµç¨‹


**ğŸ“Š æ•°æ®æµè½¬çš„å››ä¸ªé˜¶æ®µ**

> **SETLæ¨¡å‹**ï¼šSelect(é€‰æ‹©) â†’ Extract(æå–) â†’ Transform(è½¬æ¢) â†’ Load(åŠ è½½)

```
SETLæµç¨‹è¯¦è§£ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Select    â”‚â”€â”€â”€â–¶â”‚   Extract   â”‚â”€â”€â”€â–¶â”‚ Transform   â”‚â”€â”€â”€â–¶â”‚    Load     â”‚
â”‚   (é€‰æ‹©)    â”‚    â”‚   (æå–)    â”‚    â”‚   (è½¬æ¢)    â”‚    â”‚   (åŠ è½½)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Selecté˜¶æ®µï¼šå†³å®šåŒæ­¥å“ªäº›è¡¨ã€å“ªäº›å­—æ®µ
Extracté˜¶æ®µï¼šä»æºåº“çš„binlogä¸­æå–å˜æ›´æ•°æ®
Transformé˜¶æ®µï¼šæ•°æ®æ ¼å¼è½¬æ¢ã€å­—æ®µæ˜ å°„ã€ä¸šåŠ¡é€»è¾‘å¤„ç†
Loadé˜¶æ®µï¼šå°†å¤„ç†åçš„æ•°æ®å†™å…¥ç›®æ ‡åº“
```

**ğŸ’¡ å…·ä½“ä¾‹å­è¯´æ˜**

```sql
-- æºåº“MySQLä¸­çš„æ•°æ®å˜åŒ–
UPDATE user_info SET age = 25, city = 'Shanghai' WHERE user_id = 1001;

-- Otterå¤„ç†è¿‡ç¨‹ï¼š
-- Select: é…ç½®äº†åŒæ­¥user_infoè¡¨
-- Extract: ä»binlogè§£æå‡ºè¿™æ¡UPDATEè¯­å¥
-- Transform: å¯èƒ½éœ€è¦å­—æ®µæ˜ å°„(city â†’ user_city)
-- Load: åœ¨ç›®æ ‡Oracleåº“æ‰§è¡Œå¯¹åº”çš„UPDATE
```

### 2.4 é«˜å¯ç”¨è®¾è®¡ç‰¹ç‚¹


**ğŸ›¡ï¸ å¯é æ€§ä¿éšœæœºåˆ¶**

| **å¯é æ€§ç‰¹æ€§** | **å®ç°æ–¹å¼** | **è§£å†³çš„é—®é¢˜** |
|---------------|-------------|---------------|
| **èŠ‚ç‚¹æ•…éšœæ¢å¤** | `å¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»` | `å•èŠ‚ç‚¹æŒ‚æ‰ä¸å½±å“åŒæ­¥` |
| **æ•°æ®ä¸€è‡´æ€§** | `äº‹åŠ¡æ€§å¤„ç†ï¼Œå¤±è´¥å›æ»š` | `ä¿è¯æ•°æ®ä¸ä¼šé”™ä¹±` |
| **æ–­ç‚¹ç»­ä¼ ** | `è®°å½•åŒæ­¥ä½ç‚¹ï¼Œæ”¯æŒé‡å¯æ¢å¤` | `åœæœºç»´æŠ¤åèƒ½ç»§ç»­åŒæ­¥` |
| **ç›‘æ§å‘Šè­¦** | `å®æ—¶çŠ¶æ€ç›‘æ§ï¼Œå¼‚å¸¸è‡ªåŠ¨å‘Šè­¦` | `é—®é¢˜åŠæ—¶å‘ç°å’Œå¤„ç†` |

---

## 3. ğŸ” Canalå¢é‡æ—¥å¿—è§£æåŸç†


### 3.1 ä»€ä¹ˆæ˜¯Canal


**ğŸ’¡ Canalçš„é€šä¿—è§£é‡Š**

> **Canal**ï¼šæƒ³è±¡MySQLæ•°æ®åº“æœ‰ä¸€ä¸ª"è®°å½•æœ¬"(binlog)ï¼Œé‡Œé¢è¯¦ç»†è®°å½•äº†æ‰€æœ‰çš„æ•°æ®å˜åŒ–ã€‚Canalå°±æ˜¯ä¸“é—¨"è¯»æ‡‚"è¿™ä¸ªè®°å½•æœ¬çš„å·¥å…·ã€‚

```
MySQLæ•°æ®å˜åŒ–çš„è®°å½•è¿‡ç¨‹ï¼š

ç”¨æˆ·æ‰§è¡ŒSQL â†’ MySQLæ‰§è¡Œ â†’ å†™å…¥binlog â†’ Canalè¯»å–binlog â†’ è§£ææˆç»“æ„åŒ–æ•°æ®

ä¾‹å¦‚ï¼š
INSERT INTO users(name, age) VALUES('å¼ ä¸‰', 25);
                    â†“
binlogè®°å½•ï¼š[INSERT] table=users, name='å¼ ä¸‰', age=25
                    â†“
Canalè§£æï¼š{operation: "INSERT", table: "users", data: {name: "å¼ ä¸‰", age: 25}}
```

### 3.2 MySQL binlogåŸºç¡€çŸ¥è¯†


**ğŸ“ binlogæ˜¯ä»€ä¹ˆ**

> **binlog** (Binary Log)ï¼šMySQLçš„äºŒè¿›åˆ¶æ—¥å¿—ï¼Œè®°å½•äº†æ‰€æœ‰**æ”¹å˜æ•°æ®**çš„SQLè¯­å¥ï¼Œä¸»è¦ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ã€‚

**ğŸ”¸ binlogçš„ä¸‰ç§æ ¼å¼**

| **æ ¼å¼ç±»å‹** | **è®°å½•å†…å®¹** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|-------------|-------------|---------|---------|
| **Statement** | `è®°å½•æ‰§è¡Œçš„SQLè¯­å¥` | `æ—¥å¿—é‡å°` | `æŸäº›å‡½æ•°å¯èƒ½ä¸»ä»ä¸ä¸€è‡´` |
| **Row** | `è®°å½•æ¯è¡Œæ•°æ®çš„å…·ä½“å˜åŒ–` | `æ•°æ®ä¸€è‡´æ€§æœ€å¥½` | `æ—¥å¿—é‡å¤§` |
| **Mixed** | `æ··åˆä½¿ç”¨ä¸Šè¿°ä¸¤ç§` | `å¹³è¡¡æ—¥å¿—é‡å’Œä¸€è‡´æ€§` | `å¤æ‚åº¦è¾ƒé«˜` |

> **âš ï¸ é‡è¦æé†’**ï¼šOtteræ¨èä½¿ç”¨**Rowæ ¼å¼**çš„binlogï¼Œå› ä¸ºå®ƒèƒ½å‡†ç¡®è®°å½•æ¯è¡Œæ•°æ®çš„å˜åŒ–ï¼Œä¿è¯åŒæ­¥çš„å‡†ç¡®æ€§ã€‚

### 3.3 Canalå·¥ä½œåŸç†æ·±å…¥


**ğŸ”„ Canalæ¨¡æ‹ŸMySQLä»åº“çš„å·¥ä½œæ–¹å¼**

```
Canalä¼ªè£…æˆMySQLä»åº“çš„è¿‡ç¨‹ï¼š

                MySQLä¸»åº“
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚
    çœŸæ­£çš„ä»åº“   Canalä¼ªè£…   å…¶ä»–ä»åº“
        â”‚       çš„ä»åº“        â”‚
        â”‚          â”‚          â”‚
    åº”ç”¨è¯»å–    Otteræ¶ˆè´¹   åº”ç”¨è¯»å–
```

**ğŸ“‹ Canalè§£æbinlogçš„è¯¦ç»†æµç¨‹**

```java
// Canalè§£ææµç¨‹ä¼ªä»£ç 
public class CanalWorkFlow {
    
    // 1. è¿æ¥MySQLï¼Œä¼ªè£…æˆä»åº“
    public void connectAsSlaveToMySQL() {
        // å‘é€DUMPå‘½ä»¤ï¼Œè¯·æ±‚binlogæ•°æ®
        connection.sendCommand("COM_BINLOG_DUMP");
    }
    
    // 2. æ¥æ”¶binlogäº‹ä»¶
    public void receiveBinlogEvent() {
        while (true) {
            BinlogEvent event = connection.readBinlogEvent();
            parseEvent(event);
        }
    }
    
    // 3. è§£æä¸åŒç±»å‹çš„binlogäº‹ä»¶
    public void parseEvent(BinlogEvent event) {
        switch (event.getType()) {
            case INSERT:
                // è§£æINSERTäº‹ä»¶ï¼Œæå–æ–°å¢çš„æ•°æ®
                break;
            case UPDATE:
                // è§£æUPDATEäº‹ä»¶ï¼Œæå–å˜æ›´å‰åçš„æ•°æ®
                break;
            case DELETE:
                // è§£æDELETEäº‹ä»¶ï¼Œæå–è¢«åˆ é™¤çš„æ•°æ®
                break;
        }
    }
}
```

### 3.4 Canalåœ¨Otterä¸­çš„é›†æˆåº”ç”¨


**ğŸ”— Canal + Otterçš„åä½œå…³ç³»**

```
Canalå’ŒOtterçš„åˆ†å·¥ï¼š

Canalè´Ÿè´£ï¼š
â€¢ è¿æ¥MySQLæ•°æ®åº“
â€¢ å®æ—¶è§£æbinlogæ—¥å¿—
â€¢ å°†å˜æ›´æ•°æ®è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
â€¢ æä¾›æ•°æ®ç»™Otteræ¶ˆè´¹

Otterè´Ÿè´£ï¼š
â€¢ ä»Canalè·å–å˜æ›´æ•°æ®
â€¢ æ ¹æ®é…ç½®è¿›è¡Œæ•°æ®è½¬æ¢
â€¢ å°†æ•°æ®åŒæ­¥åˆ°ç›®æ ‡æ•°æ®åº“
â€¢ å¤„ç†åŒæ­¥è¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µ
```

**ğŸ’¡ å®é™…åº”ç”¨ç¤ºä¾‹**

```sql
-- æºMySQLåº“æ‰§è¡Œ
UPDATE product SET price = 199.99, status = 'active' WHERE product_id = 'P001';

-- Canalè§£æåçš„æ•°æ®æ ¼å¼
{
  "type": "UPDATE",
  "database": "ecommerce",
  "table": "product", 
  "beforeData": {
    "product_id": "P001",
    "price": 299.99,
    "status": "inactive"
  },
  "afterData": {
    "product_id": "P001", 
    "price": 199.99,
    "status": "active"
  }
}

-- Otteræ¥æ”¶ååœ¨ç›®æ ‡åº“æ‰§è¡Œ
UPDATE product_copy SET price = 199.99, status = 'active' WHERE product_id = 'P001';
```

---

## 4. ğŸŒ åˆ†å¸ƒå¼åŒæ­¥æœºåˆ¶


### 4.1 åˆ†å¸ƒå¼æ¶æ„çš„å¿…è¦æ€§


**ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼**

> **å•æœºåŒæ­¥çš„å±€é™æ€§**ï¼šæƒ³è±¡åªæœ‰ä¸€ä¸ªäººæ¬è´§ï¼Œå½“è´§ç‰©å¤ªå¤šæˆ–è€…è·ç¦»å¤ªè¿œæ—¶ï¼Œä¸€ä¸ªäººæ ¹æœ¬å¿™ä¸è¿‡æ¥ï¼Œå¿…é¡»è¦å¤šä¸ªäººåä½œã€‚

**ğŸ“Š å•æœº vs åˆ†å¸ƒå¼å¯¹æ¯”**

| **å¯¹æ¯”ç»´åº¦** | **å•æœºæ¶æ„** | **åˆ†å¸ƒå¼æ¶æ„** |
|-------------|-------------|---------------|
| **å¤„ç†èƒ½åŠ›** | `å—å•æœºæ€§èƒ½é™åˆ¶` | `å¤šæœºåä½œï¼Œèƒ½åŠ›å€å¢` |
| **å¯é æ€§** | `å•ç‚¹æ•…éšœé£é™©` | `æ•…éšœè‡ªåŠ¨è½¬ç§»` |
| **æ‰©å±•æ€§** | `æ— æ³•æ°´å¹³æ‰©å±•` | `å¯åŠ¨æ€å¢å‡èŠ‚ç‚¹` |
| **å¤æ‚åº¦** | `ç®€å•` | `éœ€è¦åè°ƒæœºåˆ¶` |

### 4.2 NodeèŠ‚ç‚¹åˆ†å·¥åä½œ


**ğŸ‘¥ èŠ‚ç‚¹è§’è‰²åˆ†é…**

```
OtterèŠ‚ç‚¹åˆ†å·¥ç¤ºæ„å›¾ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒæ­¥ä»»åŠ¡ç®¡é“(Pipeline)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Node-1    â”‚   Node-2    â”‚   Node-3    â”‚      Node-4         â”‚
â”‚  Selectä»»åŠ¡  â”‚ Extractä»»åŠ¡  â”‚Transformä»»åŠ¡â”‚    Loadä»»åŠ¡         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è´Ÿè´£ç­›é€‰éœ€è¦ â”‚ è´Ÿè´£ä»Canal  â”‚ è´Ÿè´£æ•°æ®æ ¼å¼ â”‚ è´Ÿè´£å°†å¤„ç†å¥½çš„      â”‚
â”‚ åŒæ­¥çš„æ•°æ®   â”‚ è·å–å˜æ›´æ•°æ® â”‚ è½¬æ¢å’Œå¤„ç†   â”‚ æ•°æ®å†™å…¥ç›®æ ‡åº“      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ”„ ä»»åŠ¡æµè½¬è¿‡ç¨‹**

```java
// åˆ†å¸ƒå¼ä»»åŠ¡æµè½¬ç¤ºä¾‹
public class PipelineExample {
    
    // Node-1: Selecté˜¶æ®µ
    public void selectStage() {
        // æ ¹æ®é…ç½®ç­›é€‰è¦åŒæ­¥çš„è¡¨å’Œå­—æ®µ
        List<Table> selectedTables = getConfiguredTables();
        // å°†ä»»åŠ¡ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
        sendToNextNode(selectedTables);
    }
    
    // Node-2: Extracté˜¶æ®µ  
    public void extractStage() {
        // ä»Canalè·å–binlogå˜æ›´æ•°æ®
        List<RowData> changes = canal.getChanges();
        // è¿‡æ»¤å‡ºéœ€è¦çš„æ•°æ®
        List<RowData> filteredData = filterData(changes);
        sendToNextNode(filteredData);
    }
    
    // Node-3: Transformé˜¶æ®µ
    public void transformStage() {
        // æ•°æ®æ ¼å¼è½¬æ¢
        List<RowData> transformedData = transformData(receivedData);
        sendToNextNode(transformedData);
    }
    
    // Node-4: Loadé˜¶æ®µ
    public void loadStage() {
        // å†™å…¥ç›®æ ‡æ•°æ®åº“
        targetDatabase.batchInsert(transformedData);
    }
}
```

### 4.3 ZooKeeperåè°ƒæœºåˆ¶


**ğŸ­ ZooKeeperçš„è§’è‰²**

> **ZooKeeper**ï¼šå°±åƒæ˜¯ä¸€ä¸ª"é¡¹ç›®ç»ç†"ï¼Œè´Ÿè´£åè°ƒå„ä¸ªèŠ‚ç‚¹çš„å·¥ä½œï¼Œç¡®ä¿å¤§å®¶æ­¥è°ƒä¸€è‡´ï¼Œä¸ä¼šä¹±å¥—ã€‚

**ğŸ”§ ZooKeeperçš„å…·ä½“èŒè´£**

```
ZooKeeperåœ¨Otterä¸­çš„ä½œç”¨ï¼š

é…ç½®ç®¡ç†ï¼š
â”œâ”€â”€ åŒæ­¥ä»»åŠ¡é…ç½®å­˜å‚¨
â”œâ”€â”€ èŠ‚ç‚¹ä¿¡æ¯æ³¨å†Œ
â””â”€â”€ å‚æ•°é…ç½®åˆ†å‘

æœåŠ¡å‘ç°ï¼š
â”œâ”€â”€ èŠ‚ç‚¹ä¸Šçº¿ä¸‹çº¿é€šçŸ¥
â”œâ”€â”€ å¥åº·çŠ¶æ€æ£€æŸ¥
â””â”€â”€ è´Ÿè½½å‡è¡¡

ä¸»èŠ‚ç‚¹é€‰ä¸¾ï¼š
â”œâ”€â”€ è‡ªåŠ¨é€‰ä¸¾ä¸»èŠ‚ç‚¹
â”œâ”€â”€ ä¸»èŠ‚ç‚¹æ•…éšœè½¬ç§»
â””â”€â”€ è„‘è£‚é—®é¢˜è§£å†³

åˆ†å¸ƒå¼é”ï¼š
â”œâ”€â”€ ä»»åŠ¡æ‰§è¡Œäº’æ–¥
â”œâ”€â”€ èµ„æºè®¿é—®æ§åˆ¶
â””â”€â”€ å¹¶å‘å®‰å…¨ä¿è¯
```

### 4.4 æ•…éšœæ¢å¤æœºåˆ¶


**ğŸš¨ å¸¸è§æ•…éšœåœºæ™¯åŠå¤„ç†**

| **æ•…éšœç±»å‹** | **æ£€æµ‹æ–¹å¼** | **æ¢å¤ç­–ç•¥** | **å½±å“ç¨‹åº¦** |
|-------------|-------------|-------------|-------------|
| **å•èŠ‚ç‚¹å®•æœº** | `å¿ƒè·³æ£€æµ‹` | `ä»»åŠ¡è‡ªåŠ¨è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹` | `ç§’çº§æ¢å¤` |
| **ç½‘ç»œåˆ†åŒº** | `ZKè¿æ¥çŠ¶æ€` | `å¤šæ•°æ´¾åŸåˆ™ï¼Œå°‘æ•°æ´¾æš‚åœ` | `åˆ†é’Ÿçº§æ¢å¤` |
| **ç›®æ ‡åº“ä¸å¯ç”¨** | `è¿æ¥å¼‚å¸¸` | `ä»»åŠ¡æš‚åœï¼Œç­‰å¾…æ¢å¤åé‡è¯•` | `å–å†³äºç›®æ ‡åº“` |
| **æ•°æ®å†²çª** | `å”¯ä¸€é”®å†²çª` | `æ ¹æ®ç­–ç•¥è·³è¿‡æˆ–è¦†ç›–` | `å½±å“å•æ¡æ•°æ®` |

> **âš ï¸ å…³é”®ç‰¹æ€§**ï¼šOtteræ”¯æŒ**æ–­ç‚¹ç»­ä¼ **ï¼Œå³ä½¿èŠ‚ç‚¹é‡å¯æˆ–ç½‘ç»œä¸­æ–­ï¼Œä¹Ÿèƒ½ä»ä¸Šæ¬¡åœæ­¢çš„ä½ç½®ç»§ç»­åŒæ­¥ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚

---

## 5. â†”ï¸ åŒå‘åŒæ­¥ä¸å†²çªå¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯åŒå‘åŒæ­¥


**ğŸ”„ åŒå‘åŒæ­¥çš„æ¦‚å¿µ**

> **åŒå‘åŒæ­¥**ï¼šä¸æ˜¯åªæœ‰Aåº“åŒæ­¥åˆ°Båº“ï¼Œè€Œæ˜¯Aåº“å’ŒBåº“ä¹‹é—´å¯ä»¥**äº’ç›¸åŒæ­¥**ï¼Œä»»ä½•ä¸€è¾¹çš„æ•°æ®å˜åŒ–éƒ½ä¼šåŒæ­¥åˆ°å¦ä¸€è¾¹ã€‚

```
å•å‘åŒæ­¥ vs åŒå‘åŒæ­¥ï¼š

å•å‘åŒæ­¥ï¼š
æ•°æ®åº“A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ æ•°æ®åº“B
         (åªèƒ½Aåˆ°B)

åŒå‘åŒæ­¥ï¼š  
æ•°æ®åº“A â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ æ•°æ®åº“B
         (Aå’ŒBå¯ä»¥äº’ç›¸åŒæ­¥)
```

### 5.2 åŒå‘åŒæ­¥çš„åº”ç”¨åœºæ™¯


**ğŸ’¼ å®é™…ä¸šåŠ¡éœ€æ±‚**

| **åº”ç”¨åœºæ™¯** | **ä¸šåŠ¡éœ€æ±‚** | **åŒå‘åŒæ­¥çš„ä»·å€¼** |
|-------------|-------------|-------------------|
| **å¼‚åœ°å¤šæ´»** | `ä¸¤ä¸ªæœºæˆ¿éƒ½èƒ½å¤„ç†ä¸šåŠ¡` | `ä»»ä¸€æœºæˆ¿çš„æ•°æ®å˜åŒ–éƒ½èƒ½åŒæ­¥åˆ°å¦ä¸€æœºæˆ¿` |
| **è¯»å†™åˆ†ç¦»ä¼˜åŒ–** | `ä»åº“å¶å°”éœ€è¦å†™å…¥` | `ä»åº“å†™å…¥çš„æ•°æ®èƒ½å›æµåˆ°ä¸»åº“` |
| **æ•°æ®åº“è¿ç§»** | `æ–°æ—§ç³»ç»Ÿå¹¶è¡Œè¿è¡Œ` | `ä¸¤è¾¹éƒ½èƒ½å†™å…¥ï¼Œä¿è¯æ•°æ®ä¸€è‡´` |
| **å¤šç³»ç»Ÿåä½œ** | `ä¸åŒç³»ç»Ÿä¿®æ”¹å…±äº«æ•°æ®` | `å„ç³»ç»Ÿçš„ä¿®æ”¹éƒ½èƒ½è¢«å…¶ä»–ç³»ç»Ÿçœ‹åˆ°` |

### 5.3 å¾ªç¯å¤åˆ¶é—®é¢˜


**ğŸ”„ ä»€ä¹ˆæ˜¯å¾ªç¯å¤åˆ¶**

> **å¾ªç¯å¤åˆ¶**ï¼šAåº“çš„æ•°æ®åŒæ­¥åˆ°Båº“åï¼ŒBåº“åˆæŠŠè¿™ä¸ªæ•°æ®åŒæ­¥å›Aåº“ï¼Œå½¢æˆæ— é™å¾ªç¯ï¼Œå°±åƒä¸¤ä¸ªäººäº’ç›¸ä¼ è¯ä¸€æ ·ã€‚

```
å¾ªç¯å¤åˆ¶çš„äº§ç”Ÿè¿‡ç¨‹ï¼š

1. ç”¨æˆ·åœ¨Aåº“æ‰§è¡Œï¼šINSERT INTO users VALUES(1, 'å¼ ä¸‰')
2. Otterå°†æ­¤å˜æ›´åŒæ­¥åˆ°Båº“
3. Båº“çš„Otterç›‘å¬åˆ°INSERTäº‹ä»¶
4. Båº“çš„Otteråˆå°†æ­¤äº‹ä»¶åŒæ­¥å›Aåº“  â† é—®é¢˜å‡ºç°
5. Aåº“åˆäº§ç”Ÿæ–°çš„INSERTäº‹ä»¶...
6. æ— é™å¾ªç¯ä¸‹å»
```

**ğŸ›¡ï¸ Otterçš„å¾ªç¯æ£€æµ‹æœºåˆ¶**

```java
// Otteré˜²æ­¢å¾ªç¯å¤åˆ¶çš„æ ¸å¿ƒæœºåˆ¶
public class LoopPreventionExample {
    
    // åœ¨åŒæ­¥çš„æ•°æ®ä¸­æ·»åŠ æ ‡è¯†
    public void addSyncTag(RowData data) {
        // æ·»åŠ æ¥æºæ ‡è¯†ï¼Œè¡¨ç¤ºè¿™æ¡æ•°æ®æ˜¯ä»å“ªä¸ªOtterèŠ‚ç‚¹åŒæ­¥è¿‡æ¥çš„
        data.addMetadata("sync_source", "otter_node_001");
        data.addMetadata("sync_timestamp", System.currentTimeMillis());
    }
    
    // æ£€æµ‹æ˜¯å¦ä¸ºå¾ªç¯æ•°æ®
    public boolean isLoopbackData(RowData data) {
        String syncSource = data.getMetadata("sync_source");
        // å¦‚æœæ•°æ®å·²ç»æœ‰åŒæ­¥æ ‡è¯†ï¼Œè¯´æ˜æ˜¯å…¶ä»–OtteråŒæ­¥è¿‡æ¥çš„
        // å½“å‰Otterå°±ä¸åº”è¯¥å†æ¬¡åŒæ­¥è¿™æ¡æ•°æ®
        return syncSource != null && syncSource.equals(currentNodeId);
    }
}
```

### 5.4 æ•°æ®å†²çªå¤„ç†ç­–ç•¥


**âš”ï¸ å¸¸è§å†²çªç±»å‹**

```
æ•°æ®å†²çªçš„å‡ ç§æƒ…å†µï¼š

æ—¶é—´å†²çªï¼š
Aåº“ï¼šUPDATE user SET age=25 WHERE id=1 (æ—¶é—´ï¼š10:00:01)
Båº“ï¼šUPDATE user SET age=30 WHERE id=1 (æ—¶é—´ï¼š10:00:02)
â†’ é—®é¢˜ï¼šä»¥å“ªä¸ªä¸ºå‡†ï¼Ÿ

ä¸»é”®å†²çªï¼š
Aåº“ï¼šINSERT INTO user(id, name) VALUES(100, 'å¼ ä¸‰')
Båº“ï¼šINSERT INTO user(id, name) VALUES(100, 'æå››') 
â†’ é—®é¢˜ï¼šåŒä¸€ä¸ªIDä¸èƒ½æ’å…¥ä¸¤æ¬¡

åˆ é™¤å†²çªï¼š
Aåº“ï¼šDELETE FROM user WHERE id=1
Båº“ï¼šUPDATE user SET age=25 WHERE id=1
â†’ é—®é¢˜ï¼šæ›´æ–°ä¸€ä¸ªå·²è¢«åˆ é™¤çš„è®°å½•
```

**ğŸ¯ Otterçš„å†²çªè§£å†³ç­–ç•¥**

| **å†²çªç±»å‹** | **å¤„ç†ç­–ç•¥** | **é…ç½®é€‰é¡¹** | **é€‚ç”¨åœºæ™¯** |
|-------------|-------------|-------------|-------------|
| **ä¸»é”®å†²çª** | `ä½¿ç”¨INSERT...ON DUPLICATE KEY UPDATE` | `è¦†ç›–æ¨¡å¼` | `å…è®¸åæ¥çš„æ•°æ®è¦†ç›–` |
| **æ—¶é—´æˆ³å†²çª** | `æ¯”è¾ƒä¿®æ”¹æ—¶é—´ï¼Œä¿ç•™æœ€æ–°çš„` | `æ—¶é—´æˆ³ä¼˜å…ˆ` | `æœ‰update_timeå­—æ®µçš„è¡¨` |
| **åˆ é™¤å†²çª** | `è®°å½•å†²çªæ—¥å¿—ï¼Œäººå·¥å¤„ç†` | `è·³è¿‡æ¨¡å¼` | `é‡è¦æ•°æ®ï¼Œéœ€è¦äººå·¥ç¡®è®¤` |
| **ä¸šåŠ¡å†²çª** | `è°ƒç”¨è‡ªå®šä¹‰å†²çªå¤„ç†å™¨` | `è‡ªå®šä¹‰å¤„ç†` | `å¤æ‚ä¸šåŠ¡é€»è¾‘` |

**ğŸ’¡ å†²çªå¤„ç†é…ç½®ç¤ºä¾‹**

```xml
<!-- Otterå†²çªå¤„ç†é…ç½® -->
<dataMediaPair>
    <conflictMode>override</conflictMode>  <!-- å†²çªå¤„ç†æ¨¡å¼ -->
    <skipDdl>true</skipDdl>               <!-- è·³è¿‡DDLè¯­å¥ -->
    <skipError>false</skipError>          <!-- é‡åˆ°é”™è¯¯æ˜¯å¦è·³è¿‡ -->
    
    <!-- è‡ªå®šä¹‰å†²çªå¤„ç†å™¨ -->
    <conflictResolver>
        <className>com.company.CustomConflictResolver</className>
    </conflictResolver>
</dataMediaPair>
```

---

## 6. ğŸ”„ å¼‚æ„æ•°æ®åº“æ”¯æŒ


### 6.1 ä»€ä¹ˆæ˜¯å¼‚æ„æ•°æ®åº“åŒæ­¥


**ğŸ—ƒï¸ å¼‚æ„æ•°æ®åº“çš„å«ä¹‰**

> **å¼‚æ„æ•°æ®åº“**ï¼šä¸åŒç±»å‹ã€ä¸åŒå‚å•†çš„æ•°æ®åº“ï¼Œæ¯”å¦‚MySQLã€Oracleã€PostgreSQLã€SQL Serverç­‰ï¼Œå®ƒä»¬çš„è¯­æ³•ã€æ•°æ®ç±»å‹ã€å­˜å‚¨æ–¹å¼éƒ½ä¸ä¸€æ ·ã€‚

```
åŒæ„åŒæ­¥ vs å¼‚æ„åŒæ­¥ï¼š

åŒæ„åŒæ­¥ï¼šMySQL â†’ MySQL
â€¢ æ•°æ®ç±»å‹ç›¸åŒ
â€¢ SQLè¯­æ³•ä¸€è‡´  
â€¢ åŒæ­¥ç›¸å¯¹ç®€å•

å¼‚æ„åŒæ­¥ï¼šMySQL â†’ Oracle
â€¢ æ•°æ®ç±»å‹éœ€è¦æ˜ å°„
â€¢ SQLè¯­æ³•éœ€è¦è½¬æ¢
â€¢ åŒæ­¥å¤æ‚åº¦é«˜
```

### 6.2 Otteræ”¯æŒçš„æ•°æ®åº“ç±»å‹


**ğŸ“Š æ”¯æŒçš„æ•°æ®åº“çŸ©é˜µ**

| **æ•°æ®åº“ç±»å‹** | **ä½œä¸ºæºåº“** | **ä½œä¸ºç›®æ ‡åº“** | **ç‰¹æ®Šè¯´æ˜** |
|---------------|-------------|---------------|-------------|
| **MySQL** | `âœ… å®Œæ•´æ”¯æŒ` | `âœ… å®Œæ•´æ”¯æŒ` | `åŸç”Ÿæ”¯æŒï¼ŒåŠŸèƒ½æœ€å…¨` |
| **Oracle** | `âœ… æ”¯æŒ` | `âœ… æ”¯æŒ` | `éœ€è¦é…ç½®LogMiner` |
| **PostgreSQL** | `âš ï¸ æœ‰é™æ”¯æŒ` | `âœ… æ”¯æŒ` | `æºåº“æ”¯æŒéœ€è¦æ’ä»¶` |
| **SQL Server** | `âš ï¸ æœ‰é™æ”¯æŒ` | `âœ… æ”¯æŒ` | `æºåº“æ”¯æŒéœ€è¦CDC` |
| **MongoDB** | `âŒ ä¸æ”¯æŒ` | `âœ… æ”¯æŒ` | `åªèƒ½ä½œä¸ºç›®æ ‡åº“` |

### 6.3 æ•°æ®ç±»å‹æ˜ å°„æœºåˆ¶


**ğŸ”„ æ•°æ®ç±»å‹è½¬æ¢è§„åˆ™**

```java
// MySQLåˆ°Oracleçš„æ•°æ®ç±»å‹æ˜ å°„ç¤ºä¾‹
public class DataTypeMapping {
    
    public Map<String, String> getMySQLToOracleMapping() {
        Map<String, String> mapping = new HashMap<>();
        
        // æ•°å­—ç±»å‹æ˜ å°„
        mapping.put("INT", "NUMBER(10)");
        mapping.put("BIGINT", "NUMBER(19)");
        mapping.put("DECIMAL(10,2)", "NUMBER(10,2)");
        
        // å­—ç¬¦ä¸²ç±»å‹æ˜ å°„
        mapping.put("VARCHAR(255)", "VARCHAR2(255)");
        mapping.put("TEXT", "CLOB");
        
        // æ—¥æœŸæ—¶é—´ç±»å‹æ˜ å°„
        mapping.put("DATETIME", "TIMESTAMP");
        mapping.put("DATE", "DATE");
        
        // äºŒè¿›åˆ¶ç±»å‹æ˜ å°„
        mapping.put("BLOB", "BLOB");
        
        return mapping;
    }
}
```

**ğŸ’¡ å®é™…è½¬æ¢ç¤ºä¾‹**

```sql
-- MySQLæºè¡¨ç»“æ„
CREATE TABLE user_info (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    age TINYINT,
    salary DECIMAL(10,2),
    created_at DATETIME,
    profile TEXT
);

-- Otterè‡ªåŠ¨è½¬æ¢ä¸ºOracleç›®æ ‡è¡¨ç»“æ„
CREATE TABLE user_info (
    id NUMBER(10) PRIMARY KEY,
    username VARCHAR2(50) NOT NULL,
    email VARCHAR2(100),
    age NUMBER(3),
    salary NUMBER(10,2), 
    created_at TIMESTAMP,
    profile CLOB
);
```

### 6.4 SQLè¯­æ³•è½¬æ¢


**ğŸ”§ è¯­æ³•å·®å¼‚å¤„ç†**

| **è¯­æ³•å·®å¼‚** | **MySQL** | **Oracle** | **Otterè½¬æ¢ç­–ç•¥** |
|-------------|-----------|-----------|------------------|
| **åˆ†é¡µæŸ¥è¯¢** | `LIMIT 10 OFFSET 20` | `ROWNUMæˆ–ROW_NUMBER()` | `è‡ªåŠ¨è½¬æ¢åˆ†é¡µè¯­æ³•` |
| **å­—ç¬¦ä¸²æ‹¼æ¥** | `CONCAT(a, b)` | `a \|\| b` | `å‡½æ•°è°ƒç”¨è½¬æ¢` |
| **æ—¥æœŸå‡½æ•°** | `NOW()` | `SYSDATE` | `å‡½æ•°åæ˜ å°„` |
| **è‡ªå¢ä¸»é”®** | `AUTO_INCREMENT` | `SEQUENCE` | `åºåˆ—å·ç”Ÿæˆå™¨` |

### 6.5 ETLæ•°æ®å¤„ç†èƒ½åŠ›


**ğŸ”„ Extract-Transform-Loadå¢å¼º**

> **ETLèƒ½åŠ›**ï¼šOtterä¸ä»…èƒ½ç®€å•åŒæ­¥æ•°æ®ï¼Œè¿˜èƒ½åœ¨åŒæ­¥è¿‡ç¨‹ä¸­å¯¹æ•°æ®è¿›è¡Œå¤æ‚çš„æå–ã€è½¬æ¢å’ŒåŠ è½½å¤„ç†ã€‚

**ğŸ› ï¸ Transformè½¬æ¢åŠŸèƒ½**

```java
// Otteræ•°æ®è½¬æ¢ç¤ºä¾‹
public class DataTransformExample {
    
    // å­—æ®µæ˜ å°„è½¬æ¢
    public void fieldMapping(RowData data) {
        // å°†æºè¡¨çš„first_nameå’Œlast_nameåˆå¹¶ä¸ºç›®æ ‡è¡¨çš„full_name
        String firstName = data.getField("first_name");
        String lastName = data.getField("last_name");
        data.setField("full_name", firstName + " " + lastName);
        
        // åˆ é™¤åŸå­—æ®µ
        data.removeField("first_name");
        data.removeField("last_name");
    }
    
    // æ•°æ®æ ¼å¼è½¬æ¢
    public void dataFormatTransform(RowData data) {
        // å°†æ•°å­—é‡‘é¢è½¬æ¢ä¸ºå¸¦è´§å¸ç¬¦å·çš„å­—ç¬¦ä¸²
        BigDecimal amount = data.getField("amount");
        data.setField("amount_display", "ï¿¥" + amount.toString());
        
        // æ—¥æœŸæ ¼å¼è½¬æ¢
        Date createTime = data.getField("create_time");
        data.setField("create_date", new SimpleDateFormat("yyyy-MM-dd").format(createTime));
    }
    
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    public void businessLogicTransform(RowData data) {
        // æ ¹æ®å¹´é¾„è®¡ç®—å¹´é¾„æ®µ
        Integer age = data.getField("age");
        String ageGroup;
        if (age < 18) {
            ageGroup = "æœªæˆå¹´";
        } else if (age < 60) {
            ageGroup = "æˆå¹´äºº";
        } else {
            ageGroup = "è€å¹´äºº";
        }
        data.setField("age_group", ageGroup);
    }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ Otterå®šä½ï¼šé˜¿é‡Œå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åŒæ­¥ä¸­é—´ä»¶ï¼ŒåŸºäºCanalå¢é‡è§£æ
ğŸ”¸ æ ¸å¿ƒæ¶æ„ï¼šManagerç®¡ç†ç«¯ + ZooKeeperåè°ƒ + å¤šNodeèŠ‚ç‚¹åˆ†å¸ƒå¼å¤„ç†
ğŸ”¸ SETLæµç¨‹ï¼šSelecté€‰æ‹© â†’ Extractæå– â†’ Transformè½¬æ¢ â†’ LoadåŠ è½½
ğŸ”¸ CanalåŸç†ï¼šä¼ªè£…æˆMySQLä»åº“ï¼Œå®æ—¶è§£æbinlogè·å–æ•°æ®å˜æ›´
ğŸ”¸ åŒå‘åŒæ­¥ï¼šæ”¯æŒAâ†”Bäº’ç›¸åŒæ­¥ï¼Œå…·å¤‡å¾ªç¯æ£€æµ‹å’Œå†²çªå¤„ç†æœºåˆ¶
ğŸ”¸ å¼‚æ„æ”¯æŒï¼šæ”¯æŒä¸åŒæ•°æ®åº“é—´åŒæ­¥ï¼Œè‡ªåŠ¨å¤„ç†ç±»å‹æ˜ å°„å’Œè¯­æ³•è½¬æ¢
ğŸ”¸ é«˜å¯ç”¨æ€§ï¼šåˆ†å¸ƒå¼æ¶æ„ã€æ•…éšœè‡ªåŠ¨è½¬ç§»ã€æ–­ç‚¹ç»­ä¼ æœºåˆ¶
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ Otterè§£å†³çš„æ ¸å¿ƒé—®é¢˜**
```
ä¼ ç»Ÿç—›ç‚¹ï¼š
â€¢ æ•°æ®åŒæ­¥å»¶è¿Ÿå¤§ï¼Œå½±å“ä¸šåŠ¡
â€¢ äººå·¥æ“ä½œæ˜“å‡ºé”™ï¼Œå¯é æ€§å·®
â€¢ å¼‚æ„æ•°æ®åº“åŒæ­¥å¤æ‚ï¼Œå¼€å‘æˆæœ¬é«˜
â€¢ æ— æ³•æ”¯æŒåŒå‘åŒæ­¥å’Œå†²çªå¤„ç†

Otterä»·å€¼ï¼š
â€¢ æ¯«ç§’çº§å®æ—¶åŒæ­¥ï¼ŒåŸºäºbinlogå¢é‡è§£æ
â€¢ è‡ªåŠ¨åŒ–è¿è¡Œï¼Œå‡å°‘äººå·¥å¹²é¢„
â€¢ æ”¯æŒå¼‚æ„æ•°æ®åº“ï¼Œå†…ç½®ç±»å‹æ˜ å°„å’Œè¯­æ³•è½¬æ¢
â€¢ å®Œå–„çš„åŒå‘åŒæ­¥å’Œå†²çªè§£å†³æœºåˆ¶
```

**ğŸ”¹ åˆ†å¸ƒå¼æ¶æ„çš„ä¼˜åŠ¿**
```
æ‰©å±•æ€§ï¼šå¯ä»¥æ ¹æ®æ•°æ®é‡åŠ¨æ€å¢åŠ èŠ‚ç‚¹
å¯é æ€§ï¼šå•èŠ‚ç‚¹æ•…éšœä¸å½±å“æ•´ä½“åŒæ­¥
æ€§èƒ½ï¼šå¤šèŠ‚ç‚¹å¹¶è¡Œå¤„ç†ï¼Œæå‡åŒæ­¥æ•ˆç‡
ç»´æŠ¤æ€§ï¼šä»»åŠ¡åˆ†å·¥æ˜ç¡®ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•
```

**ğŸ”¹ Canalçš„æŠ€æœ¯ä»·å€¼**
```
å®æ—¶æ€§ï¼šåŸºäºbinlogè§£æï¼Œæ¯«ç§’çº§å»¶è¿Ÿ
å‡†ç¡®æ€§ï¼šRowæ ¼å¼binlogè®°å½•æ¯è¡Œå˜åŒ–ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´
é€šç”¨æ€§ï¼šæ ‡å‡†MySQLåè®®ï¼Œå…¼å®¹æ€§å¥½
è½»é‡æ€§ï¼šå¯¹æºåº“å½±å“å°ï¼Œæ€§èƒ½æŸè€—ä½
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯ä»·å€¼


**ğŸ’¼ ä¼ä¸šçº§åº”ç”¨**
- **æ•°æ®å¤‡ä»½**ï¼šå®æ—¶å¤‡ä»½æ ¸å¿ƒä¸šåŠ¡æ•°æ®ï¼Œä¿éšœæ•°æ®å®‰å…¨
- **è¯»å†™åˆ†ç¦»**ï¼šä¸»åº“å†™å…¥ï¼Œä»åº“è¯»å–ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½
- **æ•°æ®è¿ç§»**ï¼šåœ¨çº¿è¿ç§»æ•°æ®åº“ï¼Œä¸šåŠ¡ä¸åœæœº
- **å¤šæœºæˆ¿åŒæ­¥**ï¼šå¼‚åœ°ç¾å¤‡ï¼Œä¿éšœä¸šåŠ¡è¿ç»­æ€§
- **æ•°æ®ä»“åº“**ï¼šå®æ—¶åŒæ­¥ä¸šåŠ¡æ•°æ®åˆ°æ•°æ®ä»“åº“ï¼Œæ”¯æŒBIåˆ†æ

**ğŸ¯ æŠ€æœ¯é€‰å‹è€ƒè™‘**
```
é€‚åˆä½¿ç”¨Otterçš„åœºæ™¯ï¼š
âœ… éœ€è¦å®æ—¶æˆ–å‡†å®æ—¶æ•°æ®åŒæ­¥
âœ… æ¶‰åŠå¼‚æ„æ•°æ®åº“åŒæ­¥
âœ… éœ€è¦åŒå‘åŒæ­¥èƒ½åŠ›
âœ… æ•°æ®é‡å¤§ï¼Œå¯¹æ€§èƒ½è¦æ±‚é«˜
âœ… éœ€è¦é«˜å¯ç”¨å’Œå®¹é”™èƒ½åŠ›

ä¸é€‚åˆä½¿ç”¨Otterçš„åœºæ™¯ï¼š
âŒ ç®€å•çš„å®šæ—¶æ‰¹é‡åŒæ­¥
âŒ æ•°æ®é‡å¾ˆå°çš„åœºæ™¯
âŒ å¯¹å®æ—¶æ€§è¦æ±‚ä¸é«˜
âŒ æŠ€æœ¯å›¢é˜Ÿç»´æŠ¤èƒ½åŠ›æœ‰é™
```

### 7.4 å­¦ä¹ è¿›é˜¶è·¯å¾„


**ğŸ“š æ·±å…¥å­¦ä¹ å»ºè®®**
```
åŸºç¡€æŒæ¡ï¼š
â€¢ ç†è§£MySQL binlogåŸç†å’Œæ ¼å¼
â€¢ æŒæ¡ZooKeeperåŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•
â€¢ ç†Ÿæ‚‰åˆ†å¸ƒå¼ç³»ç»ŸåŸºæœ¬ç†è®º

å®è·µæ“ä½œï¼š
â€¢ æ­å»ºOtteræµ‹è¯•ç¯å¢ƒ
â€¢ é…ç½®ç®€å•çš„åŒæ­¥ä»»åŠ¡
â€¢ æµ‹è¯•æ•…éšœæ¢å¤æœºåˆ¶

è¿›é˜¶åº”ç”¨ï¼š
â€¢ è‡ªå®šä¹‰æ•°æ®è½¬æ¢å™¨
â€¢ ä¼˜åŒ–åŒæ­¥æ€§èƒ½
â€¢ ç›‘æ§å’Œè¿ç»´æœ€ä½³å®è·µ

æ‰©å±•å­¦ä¹ ï¼š
â€¢ å¯¹æ¯”å…¶ä»–æ•°æ®åŒæ­¥å·¥å…·(DataXã€Kafka Connectç­‰)
â€¢ äº†è§£å®æ—¶æ•°æ®å¤„ç†æ¡†æ¶(Flinkã€Stormç­‰)
â€¢ å­¦ä¹ æ•°æ®æ²»ç†å’Œæ•°æ®è´¨é‡ç®¡ç†
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
Otteræ•°æ®åŒæ­¥å¾ˆç»™åŠ›ï¼ŒCanalè§£æbinlogæ˜¯æ ¹åŸº
åˆ†å¸ƒå¼æ¶æ„ä¿å¯é ï¼ŒSETLæµç¨‹è¦ç‰¢è®°
åŒå‘åŒæ­¥é˜²å¾ªç¯ï¼Œå¼‚æ„æ”¯æŒæ˜¾ç¥å¨
å®æ—¶å‡†ç¡®åˆé«˜æ•ˆï¼Œä¼ä¸šåº”ç”¨ç¬¬ä¸€é€‰æ‹©
```