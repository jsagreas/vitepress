---
title: 5、Otter环境准备与依赖
---
## 📚 目录

1. [Otter环境概述](#1-Otter环境概述)
2. [JDK环境要求](#2-JDK环境要求)
3. [MySQL版本兼容性](#3-MySQL版本兼容性)
4. [Zookeeper集群部署](#4-Zookeeper集群部署)
5. [操作系统兼容性](#5-操作系统兼容性)
6. [网络连通性要求](#6-网络连通性要求)
7. [端口开放配置](#7-端口开放配置)
8. [用户权限准备](#8-用户权限准备)
9. [目录结构规划](#9-目录结构规划)
10. [系统资源评估](#10-系统资源评估)
11. [环境检查清单](#11-环境检查清单)
12. [核心要点总结](#12-核心要点总结)

---

## 1. 🌐 Otter环境概述


### 1.1 什么是Otter环境准备


**🔸 概念理解**
Otter环境准备就像**搭建舞台**一样，在开始数据同步之前，我们需要把所有必要的"道具"和"设备"都准备好。

```
简单类比：
开餐厅需要准备 → 厨房设备、食材、服务员
搭建Otter需要 → JDK、MySQL、Zookeeper、网络配置
```

**💡 为什么环境准备这么重要**
- **基础决定上层建筑**：环境没配好，Otter就跑不起来
- **稳定性保证**：好的环境配置能避免90%的运行问题
- **性能基础**：合理的资源配置是高效同步的前提

### 1.2 Otter架构组件关系


```
Otter完整架构图：

    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
    │   Manager   │    │    Node     │    │    Node     │
    │  (管理节点)  │    │  (工作节点)  │    │  (工作节点)  │
    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘
           │                  │                  │
           └──────────────────┼──────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │    Zookeeper      │
                    │   (协调服务)       │
                    └───────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │      MySQL        │
                    │   (源库/目标库)    │
                    └───────────────────┘

各组件作用：
🔸 Manager：Web管理界面，配置任务和监控
🔸 Node：实际执行数据同步的工作节点
🔸 Zookeeper：协调各个节点，存储配置信息
🔸 MySQL：数据的来源和目标
```

### 1.3 环境准备的核心目标


**🎯 主要目标**
- **🔸 可用性**：确保所有组件能正常启动和运行
- **🔸 稳定性**：避免因环境问题导致的服务中断
- **🔸 性能**：为高效数据同步提供资源保障
- **🔸 安全性**：合理的权限配置保护数据安全

---

## 2. ☕ JDK环境要求


### 2.1 JDK版本选择


**🔸 版本兼容性说明**
Otter对JDK版本有明确要求，选错版本会导致启动失败或运行异常。

| JDK版本 | **兼容性** | **推荐程度** | **说明** |
|---------|-----------|-------------|---------|
| `JDK 1.6` | ✅ 支持 | ⭐⭐ 不推荐 | `版本过老，安全隐患` |
| `JDK 1.7` | ✅ 支持 | ⭐⭐⭐ 推荐 | `稳定可靠，生产首选` |
| `JDK 1.8` | ✅ 支持 | ⭐⭐⭐⭐ 强烈推荐 | `性能最佳，长期支持` |
| `JDK 11+` | ❌ 不支持 | ❌ 禁用 | `兼容性问题` |

**💡 版本选择建议**
```
生产环境：JDK 1.8（推荐Oracle JDK或OpenJDK）
测试环境：JDK 1.7/1.8都可以
开发环境：JDK 1.8（便于调试）
```

### 2.2 JDK安装配置


**🔧 Linux系统安装示例**
```bash
# 1. 下载JDK 1.8
cd /opt
wget https://download.oracle.com/java/8/archive/jdk-8u301-linux-x64.tar.gz

# 2. 解压安装
tar -zxvf jdk-8u301-linux-x64.tar.gz
mv jdk1.8.0_301 java8

# 3. 配置环境变量
vi /etc/profile
# 添加以下内容：
export JAVA_HOME=/opt/java8
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

# 4. 使配置生效
source /etc/profile

# 5. 验证安装
java -version
```

**⚠️ 常见安装问题**
```
问题1：权限不足
解决：使用sudo或root用户安装

问题2：环境变量不生效
解决：检查配置文件路径，重新登录终端

问题3：版本冲突
解决：卸载其他JDK版本，或使用update-alternatives管理
```

### 2.3 JVM参数优化


**🚀 Otter专用JVM配置**
```bash
# Manager节点JVM参数
export JAVA_OPTS="-Xms1024m -Xmx2048m 
                  -XX:PermSize=128m -XX:MaxPermSize=256m
                  -XX:+UseG1GC
                  -XX:+PrintGCDetails -XX:+PrintGCTimeStamps
                  -Djava.awt.headless=true"

# Node节点JVM参数
export JAVA_OPTS="-Xms2048m -Xmx4096m
                  -XX:PermSize=256m -XX:MaxPermSize=512m
                  -XX:+UseG1GC
                  -XX:MaxGCPauseMillis=200
                  -Djava.awt.headless=true"
```

**📊 参数说明**
- **`-Xms/Xmx`**：堆内存大小，影响处理能力
- **`-XX:PermSize`**：永久代大小，存放类信息
- **`-XX:+UseG1GC`**：G1垃圾收集器，低延迟
- **`-Djava.awt.headless=true`**：无图形界面模式

---

## 3. 🗄️ MySQL版本兼容性


### 3.1 MySQL版本支持情况


**🔸 版本兼容性矩阵**

| MySQL版本 | **Otter支持** | **推荐程度** | **特殊说明** |
|-----------|-------------|-------------|-------------|
| `MySQL 5.1` | ✅ 完全支持 | ⭐⭐ 基础 | `功能完备，但性能一般` |
| `MySQL 5.5` | ✅ 完全支持 | ⭐⭐⭐ 推荐 | `性能提升，生产可用` |
| `MySQL 5.6` | ✅ 完全支持 | ⭐⭐⭐⭐ 强烈推荐 | `性能优秀，功能丰富` |
| `MySQL 5.7` | ✅ 完全支持 | ⭐⭐⭐⭐ 强烈推荐 | `最佳选择，JSON支持` |
| `MySQL 8.0` | ⚠️ 部分支持 | ⭐⭐ 谨慎使用 | `新特性可能不兼容` |

### 3.2 MySQL配置要求


**🔧 必需的MySQL配置**
```ini
[mysqld]
# Binlog配置（核心）
log-bin = mysql-bin
server-id = 1
binlog-format = ROW

# 字符集配置
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 连接配置
max_connections = 1000
max_connect_errors = 100

# 缓冲区配置
innodb_buffer_pool_size = 1G
query_cache_size = 256M

# 超时配置
wait_timeout = 28800
interactive_timeout = 28800
```

**💡 配置说明**
```
🔸 log-bin：开启二进制日志，Otter通过读取binlog实现同步
🔸 server-id：服务器唯一标识，主从复制必需
🔸 binlog-format：ROW格式记录每行数据变化，最准确
🔸 字符集：utf8mb4支持emoji等特殊字符
```

### 3.3 MySQL用户权限配置


**👤 创建Otter专用用户**
```sql
-- 创建用户
CREATE USER 'otter'@'%' IDENTIFIED BY 'otter123!';

-- 授予权限
GRANT ALL PRIVILEGES ON *.* TO 'otter'@'%';

-- 特别重要：REPLICATION权限
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'otter'@'%';

-- 刷新权限
FLUSH PRIVILEGES;

-- 验证权限
SHOW GRANTS FOR 'otter'@'%';
```

**⚠️ 权限说明**
- **`REPLICATION SLAVE`**：读取binlog权限
- **`REPLICATION CLIENT`**：获取主库状态权限
- **`ALL PRIVILEGES`**：数据读写权限（可根据需要细化）

---

## 4. 🐘 Zookeeper集群部署


### 4.1 Zookeeper作用理解


**🔸 Zookeeper在Otter中的作用**
想象Zookeeper是一个**"总指挥部"**：

```
没有Zookeeper的情况：
Node1 ←→ Node2 ←→ Node3 (各自为战，容易混乱)

有Zookeeper的情况：
        Zookeeper (总指挥)
         ↙  ↓  ↘
    Node1  Node2  Node3 (统一协调，井然有序)
```

**💡 具体功能**
- **🔸 配置管理**：存储Pipeline配置信息
- **🔸 服务发现**：Manager和Node节点互相发现
- **🔸 选主协调**：Manager节点的主备切换
- **🔸 状态监控**：实时监控各节点状态

### 4.2 Zookeeper集群规划


**🏗️ 集群规模建议**

| 环境类型 | **节点数量** | **推荐配置** | **说明** |
|---------|-------------|-------------|---------|
| `开发环境` | 1个节点 | `单机模式` | `简单测试，不保证高可用` |
| `测试环境` | 3个节点 | `3节点集群` | `模拟生产，验证功能` |
| `生产环境` | 3/5个节点 | `奇数节点集群` | `高可用，容错能力强` |

**📊 为什么选择奇数个节点**
```
Zookeeper使用过半机制：
3节点：最多容忍1个节点故障 (2>3/2)
4节点：最多容忍1个节点故障 (2>4/2)
5节点：最多容忍2个节点故障 (3>5/2)

结论：4个节点和3个节点容错能力相同，但成本更高
```

### 4.3 Zookeeper安装配置


**🔧 单节点安装示例**
```bash
# 1. 下载Zookeeper
cd /opt
wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz

# 2. 解压安装
tar -zxvf zookeeper-3.4.14.tar.gz
mv zookeeper-3.4.14 zookeeper

# 3. 创建配置文件
cd zookeeper/conf
cp zoo_sample.cfg zoo.cfg

# 4. 编辑配置文件
vi zoo.cfg
```

**📝 zoo.cfg配置示例**
```properties
# 基础配置
tickTime=2000
initLimit=10
syncLimit=5
dataDir=/opt/zookeeper/data
dataLogDir=/opt/zookeeper/logs
clientPort=2181

# 集群配置（3节点示例）
server.1=192.168.1.10:2888:3888
server.2=192.168.1.11:2888:3888
server.3=192.168.1.12:2888:3888
```

**🔧 集群部署关键步骤**
```bash
# 5. 创建数据目录
mkdir -p /opt/zookeeper/data
mkdir -p /opt/zookeeper/logs

# 6. 设置服务器ID（每个节点不同）
echo "1" > /opt/zookeeper/data/myid  # 第一个节点
echo "2" > /opt/zookeeper/data/myid  # 第二个节点
echo "3" > /opt/zookeeper/data/myid  # 第三个节点

# 7. 启动服务
cd /opt/zookeeper/bin
./zkServer.sh start

# 8. 检查状态
./zkServer.sh status
```

---

## 5. 💻 操作系统兼容性


### 5.1 支持的操作系统


**🔸 Linux发行版支持情况**

| 操作系统 | **支持程度** | **推荐程度** | **特殊说明** |
|---------|-------------|-------------|-------------|
| `CentOS 6/7` | ✅ 完全支持 | ⭐⭐⭐⭐ 强烈推荐 | `生产环境首选，稳定可靠` |
| `RHEL 6/7` | ✅ 完全支持 | ⭐⭐⭐⭐ 强烈推荐 | `企业级，技术支持好` |
| `Ubuntu 16/18` | ✅ 完全支持 | ⭐⭐⭐ 推荐 | `社区活跃，更新快` |
| `SUSE Linux` | ✅ 基本支持 | ⭐⭐ 可用 | `企业环境，配置较复杂` |
| `Windows` | ⚠️ 部分支持 | ⭐ 不推荐 | `仅用于开发测试` |

### 5.2 系统内核要求


**🔧 内核版本建议**
```bash
# 查看当前内核版本
uname -r

# 推荐内核版本：
CentOS 6：2.6.32及以上
CentOS 7：3.10.0及以上
Ubuntu：4.4及以上
```

**⚠️ 内核参数优化**
```bash
# 编辑系统参数
vi /etc/sysctl.conf

# 添加以下配置
net.core.somaxconn = 1024
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_max_syn_backlog = 1024
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 120
net.ipv4.tcp_tw_reuse = 1
vm.swappiness = 10

# 使配置生效
sysctl -p
```

### 5.3 系统基础组件


**📦 必需的系统工具**
```bash
# CentOS/RHEL安装
yum install -y wget curl unzip vim net-tools

# Ubuntu/Debian安装
apt-get update
apt-get install -y wget curl unzip vim net-tools

# 验证工具可用性
which wget curl unzip vim netstat
```

---

## 6. 🌐 网络连通性要求


### 6.1 网络架构规划


**🔸 Otter网络通信图**
```
网络通信关系：

    Manager节点          Node节点们           数据库
    ┌─────────┐    →    ┌─────────┐         ┌─────────┐
    │ Manager │ ←──────→│  Node1  │ ←──────→│ MySQL-A │
    │         │    ↓    │         │         │         │
    │         │ ←──────→│  Node2  │ ←──────→│ MySQL-B │
    └─────────┘    ↓    └─────────┘         └─────────┘
         ↓         ↓          ↓
    ┌─────────────────────────────┐
    │       Zookeeper集群         │
    └─────────────────────────────┘

通信要求：
🔸 Manager ↔ Zookeeper：配置管理
🔸 Node ↔ Zookeeper：状态协调
🔸 Node ↔ MySQL：数据读写
🔸 Manager ↔ Node：任务分配和监控
```

### 6.2 网络连通性测试


**🔧 基础连通性检查**
```bash
# 1. 检查网络接口
ifconfig -a

# 2. 测试节点间连通性
ping -c 4 192.168.1.10  # Manager节点
ping -c 4 192.168.1.11  # Node1节点
ping -c 4 192.168.1.12  # Node2节点

# 3. 测试DNS解析
nslookup mysql-master.company.com
nslookup mysql-slave.company.com

# 4. 测试端口连通性
telnet 192.168.1.10 8080  # Manager端口
telnet 192.168.1.11 3306  # MySQL端口
```

**📊 网络延迟要求**
```
推荐网络延迟：
同机房内：< 1ms
同城不同机房：< 10ms
异地机房：< 50ms

超过50ms延迟会显著影响同步性能
```

### 6.3 网络安全配置


**🔒 防火墙配置**
```bash
# CentOS 7 firewalld配置
# 开放Manager端口
firewall-cmd --permanent --add-port=8080/tcp
firewall-cmd --permanent --add-port=1099/tcp

# 开放Node端口
firewall-cmd --permanent --add-port=9999/tcp

# 开放Zookeeper端口
firewall-cmd --permanent --add-port=2181/tcp
firewall-cmd --permanent --add-port=2888/tcp
firewall-cmd --permanent --add-port=3888/tcp

# 重新加载配置
firewall-cmd --reload

# 验证配置
firewall-cmd --list-ports
```

---

## 7. 🔌 端口开放配置


### 7.1 Otter端口用途说明


**📋 端口分配表**

| 组件 | **端口** | **用途** | **访问方向** | **是否必需** |
|------|---------|---------|-------------|-------------|
| `Manager` | `8080` | `Web管理界面` | `外部→Manager` | ✅ 必需 |
| `Manager` | `1099` | `RMI通信` | `Node→Manager` | ✅ 必需 |
| `Node` | `9999` | `Node服务端口` | `Manager→Node` | ✅ 必需 |
| `Zookeeper` | `2181` | `客户端连接` | `Manager/Node→ZK` | ✅ 必需 |
| `Zookeeper` | `2888` | `集群通信` | `ZK节点间` | ✅ 必需 |
| `Zookeeper` | `3888` | `选举通信` | `ZK节点间` | ✅ 必需 |
| `MySQL` | `3306` | `数据库连接` | `Node→MySQL` | ✅ 必需 |

### 7.2 端口冲突检查


**🔧 端口占用检查方法**
```bash
# 1. 检查端口占用情况
netstat -tlnp | grep :8080
netstat -tlnp | grep :1099
netstat -tlnp | grep :9999
netstat -tlnp | grep :2181

# 2. 使用lsof检查（更详细）
lsof -i :8080
lsof -i :1099

# 3. 批量检查Otter相关端口
for port in 8080 1099 9999 2181 2888 3888; do
    echo "检查端口 $port:"
    netstat -tlnp | grep :$port
    echo "---"
done
```

**⚠️ 端口冲突解决方案**
```
方案1：修改冲突服务的端口（推荐）
方案2：停止冲突的服务
方案3：修改Otter组件端口（需要同步修改配置）
```

### 7.3 动态端口范围


**🔸 临时端口配置**
```bash
# 查看当前临时端口范围
cat /proc/sys/net/ipv4/ip_local_port_range

# 推荐设置
echo "32768 65535" > /proc/sys/net/ipv4/ip_local_port_range

# 永久设置
echo "net.ipv4.ip_local_port_range = 32768 65535" >> /etc/sysctl.conf
sysctl -p
```

---

## 8. 👤 用户权限准备


### 8.1 系统用户创建


**🔧 创建Otter专用用户**
```bash
# 1. 创建otter用户组
groupadd otter

# 2. 创建otter用户
useradd -g otter -m -s /bin/bash otter

# 3. 设置密码
passwd otter

# 4. 添加sudo权限（可选）
echo "otter ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

# 5. 验证用户创建
id otter
su - otter
```

### 8.2 文件系统权限


**📁 目录权限设置**
```bash
# 创建Otter相关目录
mkdir -p /opt/otter/manager
mkdir -p /opt/otter/node
mkdir -p /opt/otter/logs
mkdir -p /opt/otter/data

# 设置目录所有者
chown -R otter:otter /opt/otter/

# 设置目录权限
chmod -R 755 /opt/otter/

# 设置日志目录权限
chmod -R 777 /opt/otter/logs/
```

**⚠️ 权限设置原则**
```
🔸 最小权限原则：只给必需的权限
🔸 分离原则：不同组件使用不同用户
🔸 安全原则：避免使用root用户运行服务
```

### 8.3 数据库用户权限


**👤 MySQL用户权限细化**
```sql
-- 源库只读用户（用于数据抽取）
CREATE USER 'otter_reader'@'%' IDENTIFIED BY 'reader123!';
GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'otter_reader'@'%';

-- 目标库读写用户（用于数据写入）
CREATE USER 'otter_writer'@'%' IDENTIFIED BY 'writer123!';
GRANT SELECT, INSERT, UPDATE, DELETE ON target_db.* TO 'otter_writer'@'%';

-- 管理用户（用于配置和监控）
CREATE USER 'otter_admin'@'%' IDENTIFIED BY 'admin123!';
GRANT ALL PRIVILEGES ON otter_manager.* TO 'otter_admin'@'%';

-- 刷新权限
FLUSH PRIVILEGES;
```

---

## 9. 📁 目录结构规划


### 9.1 标准目录结构


**🏗️ Otter目录规划**
```
/opt/otter/                     # Otter根目录
├── manager/                    # Manager组件
│   ├── bin/                   # 启动脚本
│   ├── conf/                  # 配置文件
│   ├── lib/                   # 依赖包
│   └── logs/                  # 日志文件
├── node/                      # Node组件
│   ├── bin/                   # 启动脚本
│   ├── conf/                  # 配置文件
│   ├── lib/                   # 依赖包
│   └── logs/                  # 日志文件
├── zookeeper/                 # Zookeeper组件
│   ├── bin/                   # 启动脚本
│   ├── conf/                  # 配置文件
│   ├── data/                  # 数据目录
│   └── logs/                  # 日志文件
├── data/                      # 数据文件
│   ├── download/              # 下载缓存
│   └── tmp/                   # 临时文件
├── backup/                    # 备份文件
└── scripts/                   # 运维脚本
    ├── start_all.sh           # 启动所有服务
    ├── stop_all.sh            # 停止所有服务
    └── health_check.sh        # 健康检查
```

### 9.2 磁盘空间规划


**💾 存储空间评估**

| 目录 | **用途** | **预估大小** | **增长率** | **建议** |
|------|---------|-------------|-----------|---------|
| `/opt/otter/manager` | `程序文件` | `200MB` | `低` | `系统盘` |
| `/opt/otter/node` | `程序文件` | `300MB` | `低` | `系统盘` |
| `/opt/otter/logs` | `日志文件` | `1GB/天` | `线性增长` | `独立磁盘` |
| `/opt/otter/data` | `缓存数据` | `10GB+` | `波动增长` | `高速磁盘` |
| `/opt/zookeeper/data` | `元数据` | `100MB` | `低` | `系统盘` |

**📊 磁盘性能要求**
```
日志目录：顺序写入为主，要求写入速度
数据目录：随机读写，要求IOPS性能
建议使用SSD磁盘用于数据目录
```

### 9.3 目录创建脚本


**🔧 自动化目录创建**
```bash
#!/bin/bash
# create_otter_dirs.sh

# 设置基础变量
OTTER_HOME=/opt/otter
OTTER_USER=otter

echo "开始创建Otter目录结构..."

# 创建主目录结构
mkdir -p $OTTER_HOME/{manager,node,zookeeper}/{bin,conf,lib,logs}
mkdir -p $OTTER_HOME/{data/{download,tmp},backup,scripts}
mkdir -p $OTTER_HOME/zookeeper/data

echo "目录创建完成，设置权限..."

# 设置目录权限
chown -R $OTTER_USER:$OTTER_USER $OTTER_HOME
chmod -R 755 $OTTER_HOME
chmod -R 777 $OTTER_HOME/logs
chmod -R 777 $OTTER_HOME/data

echo "Otter目录结构创建完成！"
tree $OTTER_HOME -L 3
```

---

## 10. 📊 系统资源评估


### 10.1 硬件资源需求


**💻 不同规模的资源配置**

| 规模类型 | **数据量** | **CPU配置** | **内存配置** | **磁盘配置** | **网络要求** |
|---------|-----------|------------|-------------|-------------|-------------|
| `小型环境` | `< 1GB/天` | `4核` | `8GB` | `100GB SSD` | `100Mbps` |
| `中型环境` | `1-10GB/天` | `8核` | `16GB` | `500GB SSD` | `1Gbps` |
| `大型环境` | `10-100GB/天` | `16核` | `32GB` | `1TB SSD` | `10Gbps` |
| `超大型环境` | `> 100GB/天` | `32核+` | `64GB+` | `多TB SSD` | `10Gbps+` |

### 10.2 Manager节点资源需求


**🖥️ Manager节点配置**
```
Manager节点主要职责：
🔸 Web界面服务
🔸 任务配置管理
🔸 监控数据收集
🔸 节点协调管理

资源特点：
- CPU：中等需求，主要是Web请求处理
- 内存：中等需求，缓存配置信息
- 磁盘：低需求，主要存储配置和日志
- 网络：低需求，偶发的管理操作
```

**📊 Manager节点配置建议**
```
最小配置：2核CPU，4GB内存，50GB磁盘
推荐配置：4核CPU，8GB内存，100GB磁盘
高可用配置：部署多个Manager节点
```

### 10.3 Node节点资源需求


**⚡ Node节点配置**
```
Node节点主要职责：
🔸 数据抽取Extract
🔸 数据转换Transform
🔸 数据加载Load
🔸 数据传输

资源特点：
- CPU：高需求，数据处理和转换
- 内存：高需求，数据缓存和处理
- 磁盘：中等需求，临时数据存储
- 网络：高需求，大量数据传输
```

**📊 Node节点配置建议**
```
最小配置：4核CPU，8GB内存，100GB磁盘
推荐配置：8核CPU，16GB内存，200GB磁盘
高性能配置：16核CPU，32GB内存，500GB SSD
```

### 10.4 系统资源监控


**📈 资源监控指标**
```bash
# CPU监控
top -p `pgrep -f otter`
iostat -x 1

# 内存监控
free -h
ps aux --sort=-%mem | head -10

# 磁盘监控
df -h
du -sh /opt/otter/*

# 网络监控
iftop -i eth0
netstat -i
```

**⚠️ 资源告警阈值**
```
CPU使用率：> 80%
内存使用率：> 85%
磁盘使用率：> 90%
网络丢包率：> 0.1%
```

---

## 11. ✅ 环境检查清单


### 11.1 软件环境检查


**☑️ 基础软件检查清单**
```bash
#!/bin/bash
# otter_env_check.sh

echo "=== Otter环境检查脚本 ==="

# 1. JDK检查
echo "1. 检查JDK环境..."
if command -v java &> /dev/null; then
    java_version=$(java -version 2>&1 | head -n 1)
    echo "✅ JDK已安装: $java_version"
else
    echo "❌ JDK未安装"
fi

# 2. MySQL连接检查
echo "2. 检查MySQL连接..."
mysql -h localhost -u root -p -e "SELECT VERSION();" 2>/dev/null
if [ $? -eq 0 ]; then
    echo "✅ MySQL连接正常"
else
    echo "❌ MySQL连接失败"
fi

# 3. Zookeeper检查
echo "3. 检查Zookeeper..."
if command -v zkServer.sh &> /dev/null; then
    zk_status=$(zkServer.sh status 2>&1)
    echo "✅ Zookeeper状态: $zk_status"
else
    echo "❌ Zookeeper未安装"
fi

# 4. 端口检查
echo "4. 检查端口占用..."
for port in 8080 1099 9999 2181; do
    if netstat -tlnp | grep :$port &> /dev/null; then
        echo "⚠️  端口$port已被占用"
    else
        echo "✅ 端口$port可用"
    fi
done

echo "=== 检查完成 ==="
```

### 11.2 网络环境检查


**🌐 网络连通性检查**
```bash
#!/bin/bash
# network_check.sh

echo "=== 网络环境检查 ==="

# 定义主机列表
HOSTS=("192.168.1.10" "192.168.1.11" "192.168.1.12")
PORTS=(8080 1099 9999 2181 3306)

# 检查主机连通性
echo "1. 检查主机连通性..."
for host in "${HOSTS[@]}"; do
    if ping -c 2 $host &> /dev/null; then
        echo "✅ $host 连通正常"
    else
        echo "❌ $host 连通失败"
    fi
done

# 检查端口连通性
echo "2. 检查端口连通性..."
for host in "${HOSTS[@]}"; do
    for port in "${PORTS[@]}"; do
        if timeout 3 bash -c "</dev/tcp/$host/$port" &> /dev/null; then
            echo "✅ $host:$port 连通"
        else
            echo "❌ $host:$port 不通"
        fi
    done
done

echo "=== 网络检查完成 ==="
```

### 11.3 权限检查


**👤 用户权限检查**
```bash
#!/bin/bash
# permission_check.sh

echo "=== 权限检查 ==="

# 检查用户存在性
if id otter &> /dev/null; then
    echo "✅ otter用户存在"
else
    echo "❌ otter用户不存在"
fi

# 检查目录权限
OTTER_HOME="/opt/otter"
if [ -d "$OTTER_HOME" ]; then
    owner=$(stat -c '%U:%G' $OTTER_HOME)
    if [ "$owner" = "otter:otter" ]; then
        echo "✅ 目录权限正确: $owner"
    else
        echo "⚠️  目录权限需要调整: $owner"
    fi
else
    echo "❌ Otter目录不存在"
fi

# 检查文件可执行权限
if [ -x "$OTTER_HOME/manager/bin/startup.sh" ]; then
    echo "✅ Manager启动脚本可执行"
else
    echo "❌ Manager启动脚本不可执行"
fi

echo "=== 权限检查完成 ==="
```

### 11.4 综合检查报告


**📋 环境检查报告模板**
```
=== Otter环境检查报告 ===
检查时间：2025-09-12 15:30:00
检查人员：运维团队

【基础环境】
✅ 操作系统：CentOS 7.9
✅ JDK版本：1.8.0_301
✅ MySQL版本：5.7.35
✅ Zookeeper版本：3.4.14

【网络环境】
✅ 节点间网络连通性正常
✅ 端口开放配置正确
⚠️  防火墙规则需要调整

【权限配置】
✅ otter用户创建完成
✅ 目录权限设置正确
✅ 数据库权限配置完成

【资源评估】
✅ CPU资源：16核心（满足要求）
✅ 内存资源：32GB（满足要求）
✅ 磁盘空间：500GB SSD（满足要求）

【待处理问题】
1. 防火墙规则需要开放端口2888、3888
2. MySQL慢查询日志需要开启
3. 系统参数net.core.somaxconn需要调整

【总结】
环境基本满足Otter部署要求，有3个小问题需要处理。
预计1小时内可以完成环境准备工作。
```

---

## 12. 📋 核心要点总结


### 12.1 必须掌握的核心概念


```
🔸 环境准备：搭建Otter需要的基础"舞台"
🔸 JDK要求：推荐JDK 1.8，避免版本兼容问题
🔸 MySQL配置：开启binlog，设置ROW格式，创建专用用户
🔸 Zookeeper作用：总指挥部，协调各个节点工作
🔸 网络规划：确保各组件间能正常通信
🔸 权限管理：最小权限原则，安全第一
🔸 资源评估：根据数据量选择合适的硬件配置
```

### 12.2 关键理解要点


**🔹 为什么环境准备这么重要**
```
环境准备就像盖房子打地基：
- 地基不牢固 → 房子会倒塌
- 环境不完善 → Otter会出问题

90%的Otter问题都源于环境配置不当
```

**🔹 组件间的依赖关系**
```
依赖链条：
操作系统 → JDK → Zookeeper → Otter组件 → MySQL

任何一个环节有问题，整个链条都会断
```

**🔹 资源配置的平衡点**
```
配置过低：性能不足，影响同步效率
配置过高：资源浪费，成本增加
配置刚好：性能满足需求，成本可控
```

### 12.3 实际应用价值


**🎯 生产环境指导**
- **环境标准化**：建立统一的环境配置标准
- **自动化部署**：编写脚本自动化环境准备
- **监控告警**：建立环境状态监控机制
- **故障预防**：通过环境检查避免问题发生

**🔧 运维实践建议**
```
部署前：
☑️ 完整的环境检查
☑️ 详细的部署文档
☑️ 充分的资源准备

部署中：
☑️ 分步骤验证
☑️ 实时监控状态
☑️ 及时记录问题

部署后：
☑️ 全面功能测试
☑️ 性能基准测试
☑️ 建立监控体系
```

**🚀 优化建议**
- **自动化**：用脚本代替手工操作
- **标准化**：建立环境配置模板
- **文档化**：详细记录配置过程
- **监控化**：持续监控环境状态

**核心记忆**：
- 环境准备是Otter成功的基础，不能省略任何步骤
- JDK 1.8 + MySQL 5.7 + Zookeeper 3.4是最稳定的组合
- 网络连通性和权限配置是最容易出问题的地方
- 资源配置要根据实际数据量进行合理规划
- 环境检查清单是部署前必须执行的步骤