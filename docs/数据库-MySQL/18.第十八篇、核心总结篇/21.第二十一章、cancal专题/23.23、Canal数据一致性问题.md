---
title: 23ã€Canalæ•°æ®ä¸€è‡´æ€§é—®é¢˜
---
## ğŸ“š ç›®å½•

1. [Canalæ•°æ®ä¸€è‡´æ€§é—®é¢˜æ¦‚è¿°](#1-Canalæ•°æ®ä¸€è‡´æ€§é—®é¢˜æ¦‚è¿°)
2. [æ•°æ®ä¸¢å¤±æ’æŸ¥ä¸è§£å†³](#2-æ•°æ®ä¸¢å¤±æ’æŸ¥ä¸è§£å†³)
3. [æ•°æ®é‡å¤å¤„ç†æœºåˆ¶](#3-æ•°æ®é‡å¤å¤„ç†æœºåˆ¶)
4. [æ•°æ®ä¹±åºé—®é¢˜è§£å†³](#4-æ•°æ®ä¹±åºé—®é¢˜è§£å†³)
5. [äº‹åŠ¡è¾¹ç•Œé”™è¯¯å¤„ç†](#5-äº‹åŠ¡è¾¹ç•Œé”™è¯¯å¤„ç†)
6. [DDLåŒæ­¥å¼‚å¸¸å¤„ç†](#6-DDLåŒæ­¥å¼‚å¸¸å¤„ç†)
7. [å­—ç¬¦é›†ä¸æ•°æ®ç±»å‹é—®é¢˜](#7-å­—ç¬¦é›†ä¸æ•°æ®ç±»å‹é—®é¢˜)
8. [æ—¶åŒºæ—¶é—´é—®é¢˜å¤„ç†](#8-æ—¶åŒºæ—¶é—´é—®é¢˜å¤„ç†)
9. [æ•°æ®æ ¡éªŒä¸ä¸€è‡´æ€§ä¿®å¤](#9-æ•°æ®æ ¡éªŒä¸ä¸€è‡´æ€§ä¿®å¤)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” Canalæ•°æ®ä¸€è‡´æ€§é—®é¢˜æ¦‚è¿°


### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®ä¸€è‡´æ€§é—®é¢˜


**ğŸ’¡ é€šä¿—è§£é‡Š**ï¼š
æƒ³è±¡ä½ åœ¨æ‰‹æœºä¸Šè½¬è´¦ç»™æœ‹å‹ï¼Œä½ çš„è´¦æˆ·æ‰£äº†é’±ï¼Œä½†æœ‹å‹çš„è´¦æˆ·æ²¡æ”¶åˆ°é’±ã€‚è¿™å°±æ˜¯æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚åœ¨Canalä¸­ï¼Œå°±æ˜¯MySQLæ•°æ®åº“å˜åŒ–äº†ï¼Œä½†é€šè¿‡CanalåŒæ­¥åˆ°å…¶ä»–ç³»ç»Ÿçš„æ•°æ®æ²¡æœ‰æ­£ç¡®åæ˜ è¿™äº›å˜åŒ–ã€‚

**ğŸ¯ æ ¸å¿ƒå®šä¹‰**ï¼š
```
Canalæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼šæŒ‡é€šè¿‡CanalåŒæ­¥çš„æ•°æ®ä¸æºMySQLæ•°æ®åº“
ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´ä¸šåŠ¡æ•°æ®ä¸å‡†ç¡®çš„å„ç§æƒ…å†µ
```

**ğŸ“Š å¸¸è§ä¸€è‡´æ€§é—®é¢˜ç±»å‹**ï¼š
| é—®é¢˜ç±»å‹ | **è¡¨ç°** | **å½±å“ç¨‹åº¦** | **å¸¸è§åŸå› ** |
|---------|----------|-------------|-------------|
| ğŸš« **æ•°æ®ä¸¢å¤±** | `ç›®æ ‡ç«¯ç¼ºå°‘æ•°æ®` | ä¸¥é‡ | ç½‘ç»œä¸­æ–­ã€æœåŠ¡é‡å¯ |
| ğŸ”„ **æ•°æ®é‡å¤** | `åŒä¸€æ¡æ•°æ®å¤šæ¬¡åŒæ­¥` | ä¸­ç­‰ | é‡è¯•æœºåˆ¶ã€ä½ç‚¹å›é€€ |
| ğŸ”€ **æ•°æ®ä¹±åº** | `æ•°æ®åˆ°è¾¾é¡ºåºé”™è¯¯` | ä¸¥é‡ | å¹¶å‘å¤„ç†ã€ç½‘ç»œå»¶è¿Ÿ |
| âš¡ **äº‹åŠ¡è¾¹ç•Œ** | `äº‹åŠ¡å®Œæ•´æ€§ç ´å` | ä¸¥é‡ | äº‹åŠ¡åˆ‡åˆ†ã€å¼‚å¸¸ä¸­æ–­ |

### 1.2 Canalä¸€è‡´æ€§ä¿éšœæœºåˆ¶


**ğŸ”— Canalå·¥ä½œåŸç†å›é¡¾**ï¼š
```
MySQLä¸»åº“ â†’ binlogæ—¥å¿— â†’ Canal Server â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ ä¸‹æ¸¸åº”ç”¨
     â†‘                      â†‘              â†‘
   æ•°æ®æº              è§£æåŒæ­¥ç‚¹      æ¶ˆè´¹ç¡®è®¤æœºåˆ¶
```

**âš–ï¸ ä¸€è‡´æ€§ä¿éšœè¦ç´ **ï¼š
```
ğŸ”¸ ä½ç‚¹ç®¡ç†ï¼šè®°å½•åŒæ­¥è¿›åº¦ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
ğŸ”¸ äº‹åŠ¡è¾¹ç•Œï¼šä¿è¯äº‹åŠ¡çš„åŸå­æ€§åŒæ­¥
ğŸ”¸ é¡ºåºä¿è¯ï¼šç»´æŠ¤æ•°æ®å˜æ›´çš„æ—¶åºå…³ç³»
ğŸ”¸ é‡è¯•æœºåˆ¶ï¼šå¤„ç†ä¸´æ—¶æ•…éšœå’Œç½‘ç»œå¼‚å¸¸
ğŸ”¸ å¹‚ç­‰å¤„ç†ï¼šé¿å…é‡å¤åŒæ­¥é€ æˆçš„æ•°æ®é”™è¯¯
```

---

## 2. ğŸš« æ•°æ®ä¸¢å¤±æ’æŸ¥ä¸è§£å†³


### 2.1 æ•°æ®ä¸¢å¤±çš„å¸¸è§åœºæ™¯


**â“ ä»€ä¹ˆæ˜¯æ•°æ®ä¸¢å¤±**ï¼š
ç®€å•è¯´å°±æ˜¯MySQLé‡Œæœ‰çš„æ•°æ®å˜åŒ–ï¼Œä½†é€šè¿‡CanalåŒæ­¥åï¼Œç›®æ ‡ç³»ç»Ÿé‡Œæ²¡æœ‰ä½“ç°è¿™ä¸ªå˜åŒ–ã€‚å°±åƒä½ å‘äº†ä¸€æ¡å¾®ä¿¡ï¼Œä½†å¯¹æ–¹æ²¡æ”¶åˆ°ã€‚

**ğŸ¯ å…¸å‹ä¸¢å¤±åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šæœåŠ¡é‡å¯å¯¼è‡´çš„ä¸¢å¤±**
```
æ—¶é—´çº¿ï¼š
10:00 - MySQLæ’å…¥æ•°æ®A
10:01 - Canalè¯»å–binlogä½†æœªç¡®è®¤æ¶ˆè´¹
10:02 - CanalæœåŠ¡é‡å¯
10:03 - é‡å¯åä»ä¸Šä¸€ä¸ªç¡®è®¤ç‚¹å¼€å§‹ï¼Œæ•°æ®Aä¸¢å¤±

åŸå› ï¼šä½ç‚¹ç®¡ç†ä¸å½“ï¼ŒæœªåŠæ—¶ç¡®è®¤æ¶ˆè´¹è¿›åº¦
```

**åœºæ™¯2ï¼šç½‘ç»œå¼‚å¸¸å¯¼è‡´çš„ä¸¢å¤±**
```
æ­£å¸¸æµç¨‹ï¼šMySQL â†’ Canal â†’ ä¸‹æ¸¸ç³»ç»Ÿ âœ…
å¼‚å¸¸æƒ…å†µï¼šMySQL â†’ Canal â†’ [ç½‘ç»œä¸­æ–­] âŒ ä¸‹æ¸¸ç³»ç»Ÿ

ç»“æœï¼šCanalå·²è¯»å–æ•°æ®ä½†æ— æ³•å‘é€ç»™ä¸‹æ¸¸ï¼Œæ•°æ®ä¸¢å¤±
```

### 2.2 æ•°æ®ä¸¢å¤±æ’æŸ¥æ­¥éª¤


**ğŸ” æ’æŸ¥æµç¨‹**ï¼š

**Step 1** ğŸš€ **ç¡®è®¤æ•°æ®æºçŠ¶æ€**
```bash
# æ£€æŸ¥MySQL binlogæ˜¯å¦åŒ…å«ä¸¢å¤±çš„æ•°æ®
mysqlbinlog --start-datetime="2024-01-01 10:00:00" \
            --stop-datetime="2024-01-01 11:00:00" \
            mysql-bin.000001 | grep "INSERT INTO target_table"
```

**Step 2** âš™ï¸ **æ£€æŸ¥Canalä½ç‚¹ä¿¡æ¯**
```bash
# æŸ¥çœ‹Canalå½“å‰åŒæ­¥ä½ç‚¹
curl http://canal-admin:8089/api/v1/canal/config/instance_name

# å¯¹æ¯”MySQLå½“å‰binlogä½ç½®
SHOW MASTER STATUS;
```

**Step 3** ğŸ” **åˆ†æCanalæ—¥å¿—**
```bash
# æŸ¥çœ‹Canalå¤„ç†æ—¥å¿—ï¼Œå¯»æ‰¾å¼‚å¸¸ä¿¡æ¯
grep "ERROR\|WARN" canal.log | grep -A5 -B5 "ä¸¢å¤±æ•°æ®çš„æ—¶é—´æ®µ"
```

### 2.3 æ•°æ®ä¸¢å¤±è§£å†³æ–¹æ¡ˆ


**ğŸ’¡ è§£å†³ç­–ç•¥**ï¼š

**æ–¹æ¡ˆ1ï¼šä½ç‚¹å›é€€é‡æ–°åŒæ­¥**
```java
// æ‰‹åŠ¨è®¾ç½®Canalä½ç‚¹ï¼Œé‡æ–°ä»æŒ‡å®šä½ç½®å¼€å§‹åŒæ­¥
public class CanalPositionReset {
    public void resetPosition(String binlogFile, long position) {
        // åœæ­¢Canalå®ä¾‹
        canalConnector.disconnect();
        
        // é‡ç½®ä½ç‚¹
        canalConnector.rollback(); // å›æ»šæœªç¡®è®¤çš„æ•°æ®
        
        // ä»æŒ‡å®šä½ç½®é‡æ–°å¼€å§‹
        canalConnector.subscribe();
        canalConnector.connect();
    }
}
```

**æ–¹æ¡ˆ2ï¼šæ•°æ®è¡¥å¿æœºåˆ¶**
```java
// å®ç°æ•°æ®è¡¥å¿é€»è¾‘
public class DataCompensation {
    public void compensateData(Date startTime, Date endTime) {
        // 1. ä»MySQLæŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µçš„æ•°æ®
        List<DataRecord> mysqlData = queryMysqlData(startTime, endTime);
        
        // 2. ä»ç›®æ ‡ç³»ç»ŸæŸ¥è¯¢å¯¹åº”æ•°æ®
        List<DataRecord> targetData = queryTargetData(startTime, endTime);
        
        // 3. å¯¹æ¯”æ‰¾å‡ºå·®å¼‚
        List<DataRecord> missingData = findMissingData(mysqlData, targetData);
        
        // 4. è¡¥å¿ç¼ºå¤±æ•°æ®
        compensateMissingData(missingData);
    }
}
```

**æ–¹æ¡ˆ3ï¼šåŒé‡ç¡®è®¤æœºåˆ¶**
```
å®ç°æ€è·¯ï¼š
CanalåŒæ­¥ + å®šæ—¶æ ¡éªŒ = åŒé‡ä¿éšœ

Canalè´Ÿè´£å®æ—¶åŒæ­¥
å®šæ—¶ä»»åŠ¡è´Ÿè´£æ•°æ®ä¸€è‡´æ€§æ ¡éªŒå’Œè¡¥å¿
```

---

## 3. ğŸ”„ æ•°æ®é‡å¤å¤„ç†æœºåˆ¶


### 3.1 æ•°æ®é‡å¤äº§ç”ŸåŸå› 


**â“ ä»€ä¹ˆæ˜¯æ•°æ®é‡å¤**ï¼š
å°±åƒä½ ç»™æœ‹å‹è½¬è´¦ï¼Œå› ä¸ºç½‘ç»œå¡é¡¿ä½ ç‚¹äº†å¥½å‡ æ¬¡ç¡®è®¤ï¼Œç»“æœè½¬äº†å¤šç¬”é’±ã€‚åœ¨Canalä¸­ï¼ŒåŒä¸€æ¡æ•°æ®å˜æ›´è¢«å¤šæ¬¡åŒæ­¥åˆ°ç›®æ ‡ç³»ç»Ÿã€‚

**ğŸ¯ é‡å¤äº§ç”ŸåŸå› **ï¼š

**åŸå› 1ï¼šç½‘ç»œé‡è¯•æœºåˆ¶**
```
æ­£å¸¸æƒ…å†µï¼šCanal â†’ ä¸‹æ¸¸ç³»ç»Ÿ â†’ ç¡®è®¤æˆåŠŸ âœ…
å¼‚å¸¸æƒ…å†µï¼šCanal â†’ ä¸‹æ¸¸ç³»ç»Ÿ â†’ [è¶…æ—¶æ— å“åº”] â†’ é‡è¯• â†’ é‡å¤æ•°æ®
```

**åŸå› 2ï¼šä½ç‚¹å›é€€**
```
æ—¶é—´çº¿ï¼š
10:00 - åŒæ­¥æ•°æ®Aåˆ°ä½ç‚¹1000
10:01 - ç³»ç»Ÿå¼‚å¸¸ï¼Œä½ç‚¹å›é€€åˆ°900
10:02 - é‡æ–°åŒæ­¥ï¼Œæ•°æ®Aå†æ¬¡è¢«å¤„ç†
```

### 3.2 å¹‚ç­‰æ€§è®¾è®¡åŸåˆ™


**ğŸ’¡ å¹‚ç­‰æ€§å«ä¹‰**ï¼š
ä¸ç®¡æ‰§è¡Œå¤šå°‘æ¬¡ç›¸åŒæ“ä½œï¼Œç»“æœéƒ½ä¸€æ ·ã€‚å°±åƒç”µæ¢¯æŒ‰é’®ï¼ŒæŒ‰ä¸€æ¬¡å’ŒæŒ‰åæ¬¡æ•ˆæœç›¸åŒã€‚

**ğŸ”§ å¹‚ç­‰æ€§å®ç°ç­–ç•¥**ï¼š

**ç­–ç•¥1ï¼šä¸šåŠ¡ä¸»é”®å»é‡**
```java
public class IdempotentProcessor {
    // ä½¿ç”¨ä¸šåŠ¡ä¸»é”®ç¡®ä¿å¹‚ç­‰æ€§
    public void processData(DataEvent event) {
        String businessKey = generateBusinessKey(event);
        
        // æ£€æŸ¥æ˜¯å¦å·²å¤„ç†è¿‡
        if (isAlreadyProcessed(businessKey)) {
            log.info("æ•°æ®å·²å¤„ç†ï¼Œè·³è¿‡ï¼š{}", businessKey);
            return;
        }
        
        // å¤„ç†æ•°æ®
        doProcess(event);
        
        // è®°å½•å¤„ç†çŠ¶æ€
        markAsProcessed(businessKey);
    }
    
    private String generateBusinessKey(DataEvent event) {
        // æ ¹æ®è¡¨å+ä¸»é”®+æ“ä½œç±»å‹ç”Ÿæˆå”¯ä¸€æ ‡è¯†
        return event.getTable() + "_" + event.getPkValue() + "_" + event.getEventType();
    }
}
```

**ç­–ç•¥2ï¼šç‰ˆæœ¬å·æ§åˆ¶**
```java
public class VersionControlProcessor {
    public void updateData(DataEvent event) {
        // è·å–å½“å‰ç‰ˆæœ¬å·
        Long currentVersion = getCurrentVersion(event.getPkValue());
        Long eventVersion = event.getVersion();
        
        // åªå¤„ç†æ›´æ–°çš„ç‰ˆæœ¬
        if (eventVersion > currentVersion) {
            doUpdate(event);
            updateVersion(event.getPkValue(), eventVersion);
        } else {
            log.info("ç‰ˆæœ¬è¿‡æœŸï¼Œè·³è¿‡æ›´æ–°ï¼šcurrent={}, event={}", 
                    currentVersion, eventVersion);
        }
    }
}
```

### 3.3 é‡å¤æ•°æ®æ¸…ç†


**ğŸ§¹ æ¸…ç†ç­–ç•¥**ï¼š

**æ–¹æ³•1ï¼šSQLå»é‡æ¸…ç†**
```sql
-- åˆ é™¤é‡å¤è®°å½•ï¼Œä¿ç•™æœ€æ–°çš„ä¸€æ¡
DELETE t1 FROM sync_table t1
INNER JOIN sync_table t2 
WHERE t1.business_key = t2.business_key 
AND t1.create_time < t2.create_time;
```

**æ–¹æ³•2ï¼šç¨‹åºåŒ–å»é‡**
```java
public class DuplicateDataCleaner {
    public void cleanDuplicates(String tableName) {
        // 1. æŸ¥æ‰¾é‡å¤æ•°æ®
        List<DuplicateGroup> duplicates = findDuplicates(tableName);
        
        // 2. æ¯ç»„ä¿ç•™æœ€æ–°è®°å½•
        for (DuplicateGroup group : duplicates) {
            List<Record> records = group.getRecords();
            
            // æŒ‰æ—¶é—´æ’åºï¼Œä¿ç•™æœ€åä¸€æ¡
            records.sort(Comparator.comparing(Record::getCreateTime));
            
            // åˆ é™¤å…¶ä»–è®°å½•
            for (int i = 0; i < records.size() - 1; i++) {
                deleteRecord(records.get(i));
            }
        }
    }
}
```

---

## 4. ğŸ”€ æ•°æ®ä¹±åºé—®é¢˜è§£å†³


### 4.1 æ•°æ®ä¹±åºäº§ç”Ÿæœºåˆ¶


**â“ ä»€ä¹ˆæ˜¯æ•°æ®ä¹±åº**ï¼š
å°±åƒä½ æŒ‰é¡ºåºå‘äº†3æ¡å¾®ä¿¡ï¼šâ‘ ä½ å¥½ â‘¡æˆ‘æ˜¯ â‘¢å°æ˜ï¼Œä½†å¯¹æ–¹æ”¶åˆ°çš„é¡ºåºæ˜¯ï¼šâ‘¡æˆ‘æ˜¯ â‘ ä½ å¥½ â‘¢å°æ˜ã€‚åœ¨Canalä¸­ï¼Œæ•°æ®å˜æ›´çš„æ‰§è¡Œé¡ºåºä¸MySQLä¸­çš„åŸå§‹é¡ºåºä¸ä¸€è‡´ã€‚

**ğŸ¯ ä¹±åºäº§ç”ŸåŸå› **ï¼š

**åŸå› 1ï¼šå¹¶å‘å¤„ç†å¯¼è‡´**
```
MySQLä¸­çš„é¡ºåºï¼š    Canalå¤„ç†ï¼š        ç›®æ ‡ç³»ç»Ÿæ¥æ”¶ï¼š
UPDATE id=1  â†’     çº¿ç¨‹Aå¤„ç†  â†’       UPDATE id=1 (æ…¢)
UPDATE id=2  â†’     çº¿ç¨‹Bå¤„ç†  â†’       UPDATE id=2 (å¿«) âŒå…ˆåˆ°è¾¾
UPDATE id=3  â†’     çº¿ç¨‹Cå¤„ç†  â†’       UPDATE id=3
```

**åŸå› 2ï¼šç½‘ç»œå»¶è¿Ÿå·®å¼‚**
```
Canal â†’ æ¶ˆæ¯é˜Ÿåˆ— â†’ æ¶ˆè´¹è€…A â†’ ç›®æ ‡ç³»ç»Ÿ1 (ç½‘ç»œå¿«)
                â†’ æ¶ˆè´¹è€…B â†’ ç›®æ ‡ç³»ç»Ÿ2 (ç½‘ç»œæ…¢)

ç»“æœï¼šåŒæ ·çš„æ•°æ®åœ¨ä¸åŒç³»ç»Ÿä¸­é¡ºåºä¸åŒ
```

### 4.2 é¡ºåºä¿è¯ç­–ç•¥


**âš–ï¸ é¡ºåºä¿è¯çº§åˆ«**ï¼š

| ä¿è¯çº§åˆ« | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½å½±å“** | **å®ç°å¤æ‚åº¦** |
|---------|-------------|-------------|---------------|
| ğŸš€ **å…¨å±€é¡ºåº** | `å¼ºä¸€è‡´æ€§è¦æ±‚` | ä½ | é«˜ |
| ğŸ“Š **åˆ†åŒºé¡ºåº** | `æŒ‰ä¸»é”®åˆ†ç»„é¡ºåº` | ä¸­ | ä¸­ |
| ğŸ¯ **æœ€ç»ˆä¸€è‡´** | `å¯å®¹å¿çŸ­æœŸä¸ä¸€è‡´` | é«˜ | ä½ |

**ğŸ”§ å®ç°æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šå•çº¿ç¨‹é¡ºåºå¤„ç†**
```java
public class SequentialProcessor {
    private final BlockingQueue<DataEvent> eventQueue = new LinkedBlockingQueue<>();
    
    public void processSequentially() {
        // å•çº¿ç¨‹é¡ºåºå¤„ç†ï¼Œä¿è¯å…¨å±€é¡ºåº
        while (true) {
            try {
                DataEvent event = eventQueue.take();
                processEvent(event);
            } catch (Exception e) {
                log.error("å¤„ç†äº‹ä»¶å¤±è´¥", e);
            }
        }
    }
}
```

**æ–¹æ¡ˆ2ï¼šåˆ†åŒºæœ‰åºå¤„ç†**
```java
public class PartitionedProcessor {
    private final Map<String, BlockingQueue<DataEvent>> partitionQueues = new ConcurrentHashMap<>();
    
    public void processEvent(DataEvent event) {
        // æ ¹æ®ä¸»é”®åˆ†åŒºï¼Œä¿è¯åŒä¸€ä¸»é”®çš„æ•°æ®æœ‰åº
        String partitionKey = getPartitionKey(event);
        BlockingQueue<DataEvent> queue = partitionQueues.computeIfAbsent(
            partitionKey, k -> new LinkedBlockingQueue<>()
        );
        
        queue.offer(event);
    }
    
    private String getPartitionKey(DataEvent event) {
        // ä½¿ç”¨è¡¨å+ä¸»é”®ä½œä¸ºåˆ†åŒºé”®
        return event.getTable() + "_" + event.getPkValue();
    }
}
```

### 4.3 ä¹±åºæ£€æµ‹ä¸ä¿®å¤


**ğŸ” ä¹±åºæ£€æµ‹æœºåˆ¶**ï¼š
```java
public class OrderValidator {
    private final Map<String, Long> lastProcessedVersions = new ConcurrentHashMap<>();
    
    public boolean isInOrder(DataEvent event) {
        String key = event.getTable() + "_" + event.getPkValue();
        Long lastVersion = lastProcessedVersions.get(key);
        Long currentVersion = event.getVersion();
        
        if (lastVersion != null && currentVersion <= lastVersion) {
            log.warn("æ£€æµ‹åˆ°ä¹±åºæ•°æ®ï¼škey={}, last={}, current={}", 
                    key, lastVersion, currentVersion);
            return false;
        }
        
        lastProcessedVersions.put(key, currentVersion);
        return true;
    }
}
```

**ğŸ”§ ä¹±åºä¿®å¤ç­–ç•¥**ï¼š
```java
public class OrderRepairService {
    public void repairOutOfOrderData(String table, String pkValue) {
        // 1. æŸ¥è¯¢MySQLä¸­è¯¥è®°å½•çš„æœ€æ–°çŠ¶æ€
        Record latestRecord = queryLatestFromMysql(table, pkValue);
        
        // 2. æŸ¥è¯¢ç›®æ ‡ç³»ç»Ÿä¸­çš„å½“å‰çŠ¶æ€
        Record currentRecord = queryFromTarget(table, pkValue);
        
        // 3. å¯¹æ¯”å¹¶ä¿®å¤
        if (!isConsistent(latestRecord, currentRecord)) {
            log.info("ä¿®å¤ä¹±åºæ•°æ®ï¼š{}.{}", table, pkValue);
            updateTargetRecord(latestRecord);
        }
    }
}
```

---

## 5. âš¡ äº‹åŠ¡è¾¹ç•Œé”™è¯¯å¤„ç†


### 5.1 äº‹åŠ¡è¾¹ç•Œé—®é¢˜ç†è§£


**â“ ä»€ä¹ˆæ˜¯äº‹åŠ¡è¾¹ç•Œé”™è¯¯**ï¼š
æƒ³è±¡ä½ åœ¨é“¶è¡Œè½¬è´¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹"æ‰£ä½ çš„é’±"å’Œ"åŠ å¯¹æ–¹çš„é’±"è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚äº‹åŠ¡è¾¹ç•Œé”™è¯¯å°±æ˜¯åªæ‰§è¡Œäº†ä¸€åŠï¼Œæ¯”å¦‚é’±æ‰£äº†ä½†æ²¡è½¬åˆ°å¯¹æ–¹è´¦æˆ·ã€‚

**ğŸ’¡ MySQLäº‹åŠ¡ç‰¹ç‚¹**ï¼š
```
åŸå­æ€§(Atomicity)ï¼šäº‹åŠ¡è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥
ä¸€è‡´æ€§(Consistency)ï¼šäº‹åŠ¡å‰åæ•°æ®ä¿æŒä¸€è‡´
éš”ç¦»æ€§(Isolation)ï¼šå¹¶å‘äº‹åŠ¡ä¹‹é—´ç›¸äº’éš”ç¦»
æŒä¹…æ€§(Durability)ï¼šäº‹åŠ¡æäº¤åæ°¸ä¹…ä¿å­˜
```

**ğŸ¯ Canalä¸­çš„äº‹åŠ¡è¾¹ç•Œé—®é¢˜**ï¼š

**é—®é¢˜1ï¼šäº‹åŠ¡è¢«æ‹†åˆ†åŒæ­¥**
```
MySQLäº‹åŠ¡ï¼š
BEGIN;
UPDATE account SET balance = balance - 100 WHERE id = 1;
UPDATE account SET balance = balance + 100 WHERE id = 2;
COMMIT;

Canalå¯èƒ½çš„åŒæ­¥æ–¹å¼ï¼š
ç¬¬ä¸€æ¬¡åŒæ­¥ï¼šUPDATE account SET balance = balance - 100 WHERE id = 1; âŒ
[ç½‘ç»œå¼‚å¸¸æˆ–æœåŠ¡é‡å¯]
ç¬¬äºŒæ¬¡åŒæ­¥ï¼šUPDATE account SET balance = balance + 100 WHERE id = 2; âŒ

ç»“æœï¼šç ´åäº†äº‹åŠ¡çš„åŸå­æ€§
```

### 5.2 äº‹åŠ¡è¾¹ç•Œä¿æŠ¤æœºåˆ¶


**ğŸ”§ äº‹åŠ¡è¯†åˆ«ä¸å¤„ç†**ï¼š

**æ–¹æ³•1ï¼šbinlogäº‹åŠ¡æ ‡è®°è¯†åˆ«**
```java
public class TransactionBoundaryHandler {
    private List<DataEvent> currentTransaction = new ArrayList<>();
    private boolean inTransaction = false;
    
    public void handleEvent(DataEvent event) {
        if (event.getEventType() == EventType.BEGIN) {
            // äº‹åŠ¡å¼€å§‹
            inTransaction = true;
            currentTransaction.clear();
            log.debug("äº‹åŠ¡å¼€å§‹");
            
        } else if (event.getEventType() == EventType.COMMIT) {
            // äº‹åŠ¡æäº¤ï¼Œæ‰¹é‡å¤„ç†
            if (inTransaction && !currentTransaction.isEmpty()) {
                processTransactionBatch(currentTransaction);
            }
            inTransaction = false;
            currentTransaction.clear();
            log.debug("äº‹åŠ¡æäº¤ï¼Œå¤„ç†{}æ¡è®°å½•", currentTransaction.size());
            
        } else if (event.getEventType() == EventType.ROLLBACK) {
            // äº‹åŠ¡å›æ»šï¼Œä¸¢å¼ƒæ‰€æœ‰å˜æ›´
            log.debug("äº‹åŠ¡å›æ»šï¼Œä¸¢å¼ƒ{}æ¡è®°å½•", currentTransaction.size());
            inTransaction = false;
            currentTransaction.clear();
            
        } else if (inTransaction) {
            // æ™®é€šæ•°æ®å˜æ›´ï¼ŒåŠ å…¥å½“å‰äº‹åŠ¡
            currentTransaction.add(event);
        }
    }
}
```

**æ–¹æ³•2ï¼šäº‹åŠ¡å®Œæ•´æ€§æ ¡éªŒ**
```java
public class TransactionIntegrityChecker {
    public boolean validateTransaction(List<DataEvent> events) {
        // æ£€æŸ¥äº‹åŠ¡å®Œæ•´æ€§
        boolean hasBegin = events.stream()
            .anyMatch(e -> e.getEventType() == EventType.BEGIN);
        boolean hasCommit = events.stream()
            .anyMatch(e -> e.getEventType() == EventType.COMMIT);
            
        if (!hasBegin || !hasCommit) {
            log.warn("æ£€æµ‹åˆ°ä¸å®Œæ•´äº‹åŠ¡ï¼Œäº‹ä»¶æ•°é‡ï¼š{}", events.size());
            return false;
        }
        
        return true;
    }
}
```

### 5.3 äº‹åŠ¡è¡¥å¿æœºåˆ¶


**ğŸ”„ è¡¥å¿ç­–ç•¥è®¾è®¡**ï¼š

**ç­–ç•¥1ï¼šäº‹åŠ¡é‡æ”¾æœºåˆ¶**
```java
public class TransactionReplayService {
    public void replayTransaction(String transactionId) {
        // 1. æŸ¥è¯¢äº‹åŠ¡ä¸­çš„æ‰€æœ‰å˜æ›´
        List<DataEvent> transactionEvents = getTransactionEvents(transactionId);
        
        // 2. éªŒè¯äº‹åŠ¡å®Œæ•´æ€§
        if (!isTransactionComplete(transactionEvents)) {
            log.error("äº‹åŠ¡ä¸å®Œæ•´ï¼Œæ— æ³•é‡æ”¾ï¼š{}", transactionId);
            return;
        }
        
        // 3. æŒ‰é¡ºåºé‡æ–°æ‰§è¡Œäº‹åŠ¡
        executeTransaction(() -> {
            for (DataEvent event : transactionEvents) {
                processEvent(event);
            }
        });
    }
}
```

**ç­–ç•¥2ï¼šæ•°æ®ä¸€è‡´æ€§ä¿®å¤**
```java
public class ConsistencyRepairService {
    public void repairInconsistentData(String transactionId) {
        // 1. ä»MySQLæŸ¥è¯¢äº‹åŠ¡æœ€ç»ˆçŠ¶æ€
        Map<String, Record> finalState = queryFinalState(transactionId);
        
        // 2. ä»ç›®æ ‡ç³»ç»ŸæŸ¥è¯¢å½“å‰çŠ¶æ€
        Map<String, Record> currentState = queryCurrentState(transactionId);
        
        // 3. å¯¹æ¯”å¹¶ä¿®å¤å·®å¼‚
        for (String key : finalState.keySet()) {
            Record expected = finalState.get(key);
            Record actual = currentState.get(key);
            
            if (!isConsistent(expected, actual)) {
                log.info("ä¿®å¤æ•°æ®ä¸ä¸€è‡´ï¼škey={}", key);
                updateTargetData(key, expected);
            }
        }
    }
}
```

---

## 6. ğŸ› ï¸ DDLåŒæ­¥å¼‚å¸¸å¤„ç†


### 6.1 DDLåŒæ­¥é—®é¢˜åˆ†æ


**â“ ä»€ä¹ˆæ˜¯DDLåŒæ­¥å¼‚å¸¸**ï¼š
DDLæ˜¯æ•°æ®å®šä¹‰è¯­è¨€ï¼Œå°±æ˜¯ä¿®æ”¹è¡¨ç»“æ„çš„æ“ä½œï¼Œæ¯”å¦‚åŠ å­—æ®µã€åˆ å­—æ®µã€æ”¹å­—æ®µç±»å‹ç­‰ã€‚DDLåŒæ­¥å¼‚å¸¸å°±æ˜¯è¿™äº›è¡¨ç»“æ„å˜æ›´æ²¡æœ‰æ­£ç¡®åŒæ­¥åˆ°ç›®æ ‡ç³»ç»Ÿã€‚

**ğŸ“Š å¸¸è§DDLæ“ä½œåˆ†ç±»**ï¼š

| DDLç±»å‹ | **æ“ä½œç¤ºä¾‹** | **åŒæ­¥é£é™©** | **å¤„ç†ç­–ç•¥** |
|---------|-------------|-------------|-------------|
| ğŸ†• **æ–°å¢å­—æ®µ** | `ALTER TABLE ADD COLUMN` | ä½ | è‡ªåŠ¨åŒæ­¥ |
| ğŸ—‘ï¸ **åˆ é™¤å­—æ®µ** | `ALTER TABLE DROP COLUMN` | é«˜ | æ‰‹åŠ¨ç¡®è®¤ |
| ğŸ”„ **ä¿®æ”¹å­—æ®µ** | `ALTER TABLE MODIFY COLUMN` | ä¸­ | ç±»å‹å…¼å®¹æ£€æŸ¥ |
| ğŸ“‹ **æ–°å»ºè¡¨** | `CREATE TABLE` | ä½ | è‡ªåŠ¨åˆ›å»º |
| ğŸš« **åˆ é™¤è¡¨** | `DROP TABLE` | é«˜ | æ‰‹åŠ¨ç¡®è®¤ |

**ğŸ¯ DDLåŒæ­¥éš¾ç‚¹**ï¼š

**éš¾ç‚¹1ï¼šç›®æ ‡ç³»ç»Ÿä¸æ”¯æŒDDL**
```
åœºæ™¯ï¼šMySQL â†’ Elasticsearch
é—®é¢˜ï¼šESä¸æ”¯æŒç›´æ¥æ‰§è¡ŒDDLè¯­å¥
è§£å†³ï¼šéœ€è¦è½¬æ¢ä¸ºESçš„mappingæ“ä½œ
```

**éš¾ç‚¹2ï¼šDDLæ‰§è¡Œé¡ºåºæ•æ„Ÿ**
```
MySQLæ‰§è¡Œé¡ºåºï¼š
1. ALTER TABLE user ADD COLUMN age INT;
2. UPDATE user SET age = 25 WHERE id = 1;

å¦‚æœDDLåŒæ­¥å»¶è¿Ÿï¼ŒUPDATEè¯­å¥ä¼šå› ä¸ºå­—æ®µä¸å­˜åœ¨è€Œå¤±è´¥
```

### 6.2 DDLåŒæ­¥ç­–ç•¥


**ğŸ”§ åŒæ­¥ç­–ç•¥è®¾è®¡**ï¼š

**ç­–ç•¥1ï¼šDDLäº‹ä»¶æ‹¦æˆªå¤„ç†**
```java
public class DDLEventHandler {
    public void handleDDLEvent(DDLEvent ddlEvent) {
        String sql = ddlEvent.getSql();
        String table = ddlEvent.getTableName();
        
        log.info("æ£€æµ‹åˆ°DDLæ“ä½œï¼š{}", sql);
        
        // æ ¹æ®DDLç±»å‹åˆ†åˆ«å¤„ç†
        DDLType type = parseDDLType(sql);
        switch (type) {
            case ADD_COLUMN:
                handleAddColumn(table, ddlEvent);
                break;
            case DROP_COLUMN:
                handleDropColumn(table, ddlEvent);
                break;
            case MODIFY_COLUMN:
                handleModifyColumn(table, ddlEvent);
                break;
            default:
                handleGenericDDL(ddlEvent);
        }
    }
    
    private void handleAddColumn(String table, DDLEvent event) {
        // å¤„ç†æ–°å¢å­—æ®µ
        ColumnInfo newColumn = parseNewColumn(event.getSql());
        
        // åœ¨ç›®æ ‡ç³»ç»Ÿä¸­æ·»åŠ å¯¹åº”å­—æ®µ
        targetSystemAdapter.addColumn(table, newColumn);
        
        log.info("æˆåŠŸåŒæ­¥æ–°å¢å­—æ®µï¼š{}.{}", table, newColumn.getName());
    }
}
```

**ç­–ç•¥2ï¼šDDLå…¼å®¹æ€§æ£€æŸ¥**
```java
public class DDLCompatibilityChecker {
    public boolean isCompatible(DDLEvent ddlEvent, String targetSystem) {
        String sql = ddlEvent.getSql();
        
        // æ£€æŸ¥ç›®æ ‡ç³»ç»Ÿæ˜¯å¦æ”¯æŒè¯¥DDLæ“ä½œ
        if (!isSupported(sql, targetSystem)) {
            log.warn("ç›®æ ‡ç³»ç»Ÿä¸æ”¯æŒDDLæ“ä½œï¼š{}", sql);
            return false;
        }
        
        // æ£€æŸ¥æ•°æ®ç±»å‹å…¼å®¹æ€§
        if (isDataTypeIncompatible(sql, targetSystem)) {
            log.warn("æ•°æ®ç±»å‹ä¸å…¼å®¹ï¼š{}", sql);
            return false;
        }
        
        return true;
    }
}
```

### 6.3 DDLå¼‚å¸¸æ¢å¤


**ğŸ”„ æ¢å¤æœºåˆ¶**ï¼š

**æ–¹æ³•1ï¼šDDLé‡æ”¾æœºåˆ¶**
```java
public class DDLRecoveryService {
    public void recoverDDLOperations(Date fromTime, Date toTime) {
        // 1. ä»binlogä¸­æå–DDLæ“ä½œ
        List<DDLEvent> ddlEvents = extractDDLEvents(fromTime, toTime);
        
        // 2. æŒ‰æ—¶é—´é¡ºåºæ’åº
        ddlEvents.sort(Comparator.comparing(DDLEvent::getTimestamp));
        
        // 3. é‡æ–°æ‰§è¡ŒDDLæ“ä½œ
        for (DDLEvent event : ddlEvents) {
            try {
                if (needReplay(event)) {
                    replayDDL(event);
                    log.info("é‡æ”¾DDLæˆåŠŸï¼š{}", event.getSql());
                }
            } catch (Exception e) {
                log.error("é‡æ”¾DDLå¤±è´¥ï¼š{}", event.getSql(), e);
                // è®°å½•å¤±è´¥çš„DDLï¼Œç­‰å¾…æ‰‹åŠ¨å¤„ç†
                recordFailedDDL(event, e);
            }
        }
    }
}
```

**æ–¹æ³•2ï¼šè¡¨ç»“æ„å¯¹æ¯”ä¿®å¤**
```java
public class SchemaComparisonService {
    public void compareAndRepairSchema(String tableName) {
        // 1. è·å–MySQLè¡¨ç»“æ„
        TableSchema mysqlSchema = getMysqlTableSchema(tableName);
        
        // 2. è·å–ç›®æ ‡ç³»ç»Ÿè¡¨ç»“æ„
        TableSchema targetSchema = getTargetTableSchema(tableName);
        
        // 3. å¯¹æ¯”å·®å¼‚
        SchemaDiff diff = compareSchemas(mysqlSchema, targetSchema);
        
        // 4. ç”Ÿæˆä¿®å¤DDL
        List<String> repairDDLs = generateRepairDDLs(diff);
        
        // 5. æ‰§è¡Œä¿®å¤
        for (String ddl : repairDDLs) {
            executeRepairDDL(ddl);
            log.info("æ‰§è¡Œä¿®å¤DDLï¼š{}", ddl);
        }
    }
}
```

---

## 7. ğŸ”¤ å­—ç¬¦é›†ä¸æ•°æ®ç±»å‹é—®é¢˜


### 7.1 å­—ç¬¦é›†é—®é¢˜åˆ†æ


**â“ ä»€ä¹ˆæ˜¯å­—ç¬¦é›†é—®é¢˜**ï¼š
å°±åƒä½ ç”¨ä¸­æ–‡å†™å­—ï¼Œä½†å¯¹æ–¹åªèƒ½è¯†åˆ«è‹±æ–‡ï¼Œç»“æœçœ‹åˆ°çš„æ˜¯ä¹±ç ã€‚åœ¨æ•°æ®åŒæ­¥ä¸­ï¼Œå­—ç¬¦é›†é—®é¢˜ä¼šå¯¼è‡´ä¸­æ–‡ç­‰ç‰¹æ®Šå­—ç¬¦æ˜¾ç¤ºå¼‚å¸¸æˆ–åŒæ­¥å¤±è´¥ã€‚

**ğŸ¯ å¸¸è§å­—ç¬¦é›†é—®é¢˜**ï¼š

**é—®é¢˜1ï¼šå­—ç¬¦é›†ä¸åŒ¹é…**
```
MySQLï¼š    character_set_server=utf8mb4
Canalï¼š    é»˜è®¤ä½¿ç”¨utf8
ç›®æ ‡ç³»ç»Ÿï¼š  latin1

ç»“æœï¼šä¸­æ–‡å­—ç¬¦å˜æˆä¹±ç æˆ–åŒæ­¥å¤±è´¥
```

**é—®é¢˜2ï¼šemojiå­—ç¬¦å¤„ç†**
```
MySQLæ•°æ®ï¼šuser_name = "å¼ ä¸‰ğŸ˜Š"
ä½¿ç”¨utf8å­—ç¬¦é›†ï¼šemojiå­—ç¬¦ä¸¢å¤± â†’ "å¼ ä¸‰"
ä½¿ç”¨utf8mb4å­—ç¬¦é›†ï¼šæ­£å¸¸æ˜¾ç¤º â†’ "å¼ ä¸‰ğŸ˜Š"
```

### 7.2 å­—ç¬¦é›†é…ç½®ä¸å¤„ç†


**ğŸ”§ æ­£ç¡®çš„å­—ç¬¦é›†é…ç½®**ï¼š

**Canalå­—ç¬¦é›†é…ç½®**
```properties
# canal.properties
canal.instance.connectionCharset = UTF-8
canal.instance.defaultDatabaseName = 
canal.instance.filter.druid.ddl = true

# å®ä¾‹é…ç½®
canal.instance.master.address = 127.0.0.1:3306
canal.instance.dbUsername = canal
canal.instance.dbPassword = canal
canal.instance.connectionCharset = UTF-8
canal.instance.defaultDatabaseName = test
```

**å­—ç¬¦é›†å…¼å®¹å¤„ç†**
```java
public class CharsetHandler {
    public String convertCharset(String data, String fromCharset, String toCharset) {
        try {
            // å­—ç¬¦é›†è½¬æ¢
            byte[] bytes = data.getBytes(fromCharset);
            return new String(bytes, toCharset);
        } catch (UnsupportedEncodingException e) {
            log.error("å­—ç¬¦é›†è½¬æ¢å¤±è´¥ï¼šfrom={}, to={}", fromCharset, toCharset, e);
            return data; // è¿”å›åŸå§‹æ•°æ®
        }
    }
    
    public boolean isValidUtf8(String text) {
        // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºæœ‰æ•ˆçš„UTF-8ç¼–ç 
        try {
            byte[] bytes = text.getBytes("UTF-8");
            String decoded = new String(bytes, "UTF-8");
            return text.equals(decoded);
        } catch (Exception e) {
            return false;
        }
    }
}
```

### 7.3 æ•°æ®ç±»å‹è½¬æ¢é—®é¢˜


**ğŸ“Š å¸¸è§ç±»å‹è½¬æ¢é—®é¢˜**ï¼š

| MySQLç±»å‹ | **Javaç±»å‹** | **å¸¸è§é—®é¢˜** | **è§£å†³æ–¹æ¡ˆ** |
|----------|-------------|-------------|-------------|
| ğŸ”¢ **BIGINT** | `Long` | è¶…å‡ºæ•´æ•°èŒƒå›´ | ä½¿ç”¨Longç±»å‹ |
| ğŸ’° **DECIMAL** | `BigDecimal` | ç²¾åº¦ä¸¢å¤± | ä¿æŒåŸå§‹ç²¾åº¦ |
| ğŸ“… **DATETIME** | `Date/LocalDateTime` | æ—¶åŒºé—®é¢˜ | ç»Ÿä¸€æ—¶åŒºå¤„ç† |
| ğŸ“ **TEXT** | `String` | é•¿åº¦é™åˆ¶ | æ£€æŸ¥ç›®æ ‡ç³»ç»Ÿé™åˆ¶ |
| ğŸ”µ **TINYINT(1)** | `Boolean` | 0/1 vs true/false | ç±»å‹æ˜ å°„ |

**ğŸ”§ ç±»å‹è½¬æ¢å¤„ç†å™¨**ï¼š
```java
public class DataTypeConverter {
    public Object convertValue(Object value, String mysqlType, String targetType) {
        if (value == null) return null;
        
        switch (mysqlType.toUpperCase()) {
            case "TINYINT":
                // MySQLçš„TINYINT(1)é€šå¸¸è¡¨ç¤ºå¸ƒå°”å€¼
                if ("BOOLEAN".equals(targetType)) {
                    return ((Number) value).intValue() != 0;
                }
                break;
                
            case "DECIMAL":
                // ä¿æŒç²¾åº¦ï¼Œé¿å…æµ®ç‚¹æ•°è¯¯å·®
                if (value instanceof String) {
                    return new BigDecimal((String) value);
                }
                break;
                
            case "DATETIME":
            case "TIMESTAMP":
                // æ—¶é—´ç±»å‹å¤„ç†
                return convertDateTime(value, targetType);
                
            case "JSON":
                // JSONç±»å‹è½¬æ¢
                return convertJsonData(value, targetType);
        }
        
        return value;
    }
    
    private Object convertDateTime(Object value, String targetType) {
        // ç»Ÿä¸€è½¬æ¢ä¸ºISO 8601æ ¼å¼
        if (value instanceof Date) {
            Date date = (Date) value;
            return date.toInstant().toString();
        }
        return value;
    }
}
```

---

## 8. ğŸ• æ—¶åŒºæ—¶é—´é—®é¢˜å¤„ç†


### 8.1 æ—¶åŒºé—®é¢˜ç†è§£


**â“ ä»€ä¹ˆæ˜¯æ—¶åŒºé—®é¢˜**ï¼š
å°±åƒä½ åœ¨åŒ—äº¬æ—¶é—´ä¸Šåˆ10ç‚¹ç»™ç¾å›½æœ‹å‹å‘æ¶ˆæ¯è¯´"ç°åœ¨æ˜¯ä¸Šåˆ10ç‚¹"ï¼Œä½†ä»–é‚£é‡Œå®é™…æ˜¯æ™šä¸Š7ç‚¹ã€‚æ—¶åŒºé—®é¢˜å°±æ˜¯åŒä¸€ä¸ªæ—¶é—´åœ¨ä¸åŒç³»ç»Ÿä¸­æ˜¾ç¤ºä¸ä¸€è‡´ã€‚

**ğŸŒ æ—¶åŒºé—®é¢˜åœºæ™¯**ï¼š

**åœºæ™¯1ï¼šä¸åŒæ—¶åŒºçš„æœåŠ¡å™¨**
```
MySQLæœåŠ¡å™¨ï¼šä¸œå…«åŒº (Asia/Shanghai)
CanalæœåŠ¡å™¨ï¼šä¸œå…«åŒº (Asia/Shanghai)  
ç›®æ ‡ç³»ç»Ÿï¼š   UTCæ—¶åŒº (GMT+0)

MySQLæ—¶é—´ï¼š2024-01-01 10:00:00 +08:00
åŒæ­¥åæ—¶é—´ï¼š2024-01-01 10:00:00 +00:00 âŒ (åº”è¯¥æ˜¯02:00:00)
```

**åœºæ™¯2ï¼šå¤ä»¤æ—¶åˆ‡æ¢**
```
ç¾å›½ä¸œéƒ¨æ—¶é—´åœ¨3æœˆå’Œ11æœˆä¼šåˆ‡æ¢å¤ä»¤æ—¶
åŒä¸€ä¸ªUTCæ—¶é—´åœ¨åˆ‡æ¢å‰åå¯¹åº”çš„æœ¬åœ°æ—¶é—´ä¸åŒ
å¯èƒ½å¯¼è‡´æ—¶é—´åŒæ­¥å‡ºç°1å°æ—¶çš„åå·®
```

### 8.2 æ—¶åŒºé…ç½®è§£å†³æ–¹æ¡ˆ


**ğŸ”§ ç³»ç»Ÿæ—¶åŒºç»Ÿä¸€é…ç½®**ï¼š

**MySQLæ—¶åŒºé…ç½®**
```sql
-- æŸ¥çœ‹å½“å‰æ—¶åŒºè®¾ç½®
SHOW VARIABLES LIKE '%time_zone%';

-- è®¾ç½®å…¨å±€æ—¶åŒºä¸ºUTC
SET GLOBAL time_zone = '+00:00';

-- æˆ–è€…è®¾ç½®ä¸ºå…·ä½“æ—¶åŒº
SET GLOBAL time_zone = 'Asia/Shanghai';
```

**Canalæ—¶åŒºé…ç½®**
```properties
# canal.properties
# è®¾ç½®Canalä½¿ç”¨çš„æ—¶åŒº
canal.instance.connectionCharset = UTF-8
canal.instance.timezoneId = Asia/Shanghai

# JVMæ—¶åŒºå‚æ•°
-Duser.timezone=Asia/Shanghai
```

**åº”ç”¨ç¨‹åºæ—¶åŒºå¤„ç†**
```java
public class TimeZoneHandler {
    private static final String DEFAULT_TIMEZONE = "Asia/Shanghai";
    
    public Date convertToTargetTimezone(Date sourceDate, String sourceTimezone, String targetTimezone) {
        // åˆ›å»ºæ—¶åŒºå¯¹è±¡
        TimeZone sourceZone = TimeZone.getTimeZone(sourceTimezone);
        TimeZone targetZone = TimeZone.getTimeZone(targetTimezone);
        
        // è®¡ç®—æ—¶åŒºåç§»å·®
        long sourceOffset = sourceZone.getOffset(sourceDate.getTime());
        long targetOffset = targetZone.getOffset(sourceDate.getTime());
        long offsetDiff = targetOffset - sourceOffset;
        
        // è¿”å›è½¬æ¢åçš„æ—¶é—´
        return new Date(sourceDate.getTime() + offsetDiff);
    }
    
    public String formatToISO8601(Date date, String timezone) {
        // ç»Ÿä¸€ä½¿ç”¨ISO 8601æ ¼å¼ï¼ŒåŒ…å«æ—¶åŒºä¿¡æ¯
        ZonedDateTime zonedDateTime = date.toInstant()
            .atZone(ZoneId.of(timezone));
        return zonedDateTime.format(DateTimeFormatter.ISO_OFFSET_DATE_TIME);
    }
}
```

### 8.3 æ—¶é—´ä¸€è‡´æ€§æ ¡éªŒ


**ğŸ” æ—¶é—´ä¸€è‡´æ€§æ£€æŸ¥**ï¼š
```java
public class TimeConsistencyChecker {
    public boolean checkTimeConsistency(String table, String pkValue) {
        // 1. ä»MySQLæŸ¥è¯¢è®°å½•çš„æ—¶é—´å­—æ®µ
        Map<String, Date> mysqlTimes = queryMysqlTimestamps(table, pkValue);
        
        // 2. ä»ç›®æ ‡ç³»ç»ŸæŸ¥è¯¢å¯¹åº”æ—¶é—´
        Map<String, Date> targetTimes = queryTargetTimestamps(table, pkValue);
        
        // 3. å¯¹æ¯”æ—¶é—´æ˜¯å¦ä¸€è‡´(è€ƒè™‘æ—¶åŒºè½¬æ¢)
        for (String field : mysqlTimes.keySet()) {
            Date mysqlTime = mysqlTimes.get(field);
            Date targetTime = targetTimes.get(field);
            
            // è½¬æ¢ä¸ºåŒä¸€æ—¶åŒºåå¯¹æ¯”
            Date normalizedMysqlTime = normalizeTimezone(mysqlTime);
            Date normalizedTargetTime = normalizeTimezone(targetTime);
            
            long timeDiff = Math.abs(normalizedMysqlTime.getTime() - normalizedTargetTime.getTime());
            
            // å…è®¸1ç§’çš„è¯¯å·®
            if (timeDiff > 1000) {
                log.warn("æ—¶é—´ä¸ä¸€è‡´ï¼š{}.{}.{}, mysql={}, target={}, diff={}ms", 
                        table, pkValue, field, mysqlTime, targetTime, timeDiff);
                return false;
            }
        }
        
        return true;
    }
}
```

---

## 9. ğŸ” æ•°æ®æ ¡éªŒä¸ä¸€è‡´æ€§ä¿®å¤


### 9.1 æ•°æ®æ ¡éªŒæœºåˆ¶è®¾è®¡


**â“ ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®æ ¡éªŒ**ï¼š
å°±åƒä½ ç½‘è´­åä¼šæ£€æŸ¥å•†å“æ˜¯å¦å®Œå¥½ï¼Œæ•°æ®åŒæ­¥åä¹Ÿéœ€è¦æ ¡éªŒæ˜¯å¦æ­£ç¡®ã€‚æ•°æ®æ ¡éªŒæ˜¯ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æœ€åä¸€é“é˜²çº¿ã€‚

**ğŸ¯ æ ¡éªŒç»´åº¦è®¾è®¡**ï¼š

**ç»´åº¦1ï¼šæ•°æ®å®Œæ•´æ€§æ ¡éªŒ**
```
æ£€æŸ¥å†…å®¹ï¼š
â€¢ æ•°æ®æ¡æ•°æ˜¯å¦ä¸€è‡´
â€¢ ä¸»é”®æ˜¯å¦å®Œæ•´
â€¢ å¿…è¦å­—æ®µæ˜¯å¦ç¼ºå¤±
```

**ç»´åº¦2ï¼šæ•°æ®å‡†ç¡®æ€§æ ¡éªŒ**
```
æ£€æŸ¥å†…å®¹ï¼š
â€¢ å­—æ®µå€¼æ˜¯å¦ç›¸ç­‰
â€¢ æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®
â€¢ ä¸šåŠ¡é€»è¾‘æ˜¯å¦ä¸€è‡´
```

**ç»´åº¦3ï¼šæ•°æ®æ—¶æ•ˆæ€§æ ¡éªŒ**
```
æ£€æŸ¥å†…å®¹ï¼š
â€¢ åŒæ­¥å»¶è¿Ÿæ˜¯å¦åœ¨åˆç†èŒƒå›´
â€¢ æ—¶é—´æˆ³æ˜¯å¦æ­£ç¡®
â€¢ æ•°æ®ç‰ˆæœ¬æ˜¯å¦æœ€æ–°
```

### 9.2 è‡ªåŠ¨åŒ–æ ¡éªŒå®ç°


**ğŸ”§ æ ¡éªŒç­–ç•¥å®ç°**ï¼š

**ç­–ç•¥1ï¼šå®æ—¶æ ¡éªŒ**
```java
public class RealTimeValidator {
    public void validateAfterSync(DataEvent event) {
        // åŒæ­¥å®Œæˆåç«‹å³æ ¡éªŒ
        String table = event.getTableName();
        String pkValue = event.getPrimaryKeyValue();
        
        // å»¶è¿Ÿå‡ ç§’ç¡®ä¿æ•°æ®å·²ç»å†™å…¥
        Thread.sleep(2000);
        
        // æ‰§è¡Œæ ¡éªŒ
        ValidationResult result = performValidation(table, pkValue);
        
        if (!result.isValid()) {
            log.warn("å®æ—¶æ ¡éªŒå¤±è´¥ï¼š{}.{}, é”™è¯¯ï¼š{}", table, pkValue, result.getErrors());
            // è§¦å‘ä¿®å¤æµç¨‹
            triggerRepair(table, pkValue, result);
        }
    }
}
```

**ç­–ç•¥2ï¼šæ‰¹é‡å®šæ—¶æ ¡éªŒ**
```java
public class BatchValidator {
    @Scheduled(fixedRate = 300000) // æ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
    public void batchValidate() {
        // 1. è·å–æœ€è¿‘åŒæ­¥çš„æ•°æ®èŒƒå›´
        Date startTime = getLastValidationTime();
        Date endTime = new Date();
        
        // 2. åˆ†æ‰¹æ ¡éªŒ
        List<String> tables = getMonitoredTables();
        for (String table : tables) {
            validateTableData(table, startTime, endTime);
        }
        
        // 3. æ›´æ–°æ ¡éªŒæ—¶é—´
        updateLastValidationTime(endTime);
    }
    
    private void validateTableData(String table, Date start, Date end) {
        // åˆ†é¡µæŸ¥è¯¢é¿å…å†…å­˜æº¢å‡º
        int pageSize = 1000;
        int offset = 0;
        
        while (true) {
            List<String> pkValues = getChangedPrimaryKeys(table, start, end, offset, pageSize);
            if (pkValues.isEmpty()) break;
            
            // å¹¶è¡Œæ ¡éªŒæé«˜æ•ˆç‡
            pkValues.parallelStream().forEach(pk -> {
                ValidationResult result = performValidation(table, pk);
                if (!result.isValid()) {
                    recordValidationFailure(table, pk, result);
                }
            });
            
            offset += pageSize;
        }
    }
}
```

### 9.3 ä¸€è‡´æ€§ä¿®å¤ç­–ç•¥


**ğŸ”„ ä¿®å¤ç­–ç•¥è®¾è®¡**ï¼š

**ç­–ç•¥1ï¼šè‡ªåŠ¨ä¿®å¤**
```java
public class AutoRepairService {
    public void autoRepair(String table, String pkValue, ValidationResult validation) {
        // åªå¯¹ç®€å•é—®é¢˜è¿›è¡Œè‡ªåŠ¨ä¿®å¤
        for (ValidationError error : validation.getErrors()) {
            switch (error.getType()) {
                case MISSING_RECORD:
                    // ç¼ºå¤±è®°å½•ï¼šä»MySQLæŸ¥è¯¢å¹¶æ’å…¥
                    repairMissingRecord(table, pkValue);
                    break;
                    
                case FIELD_VALUE_MISMATCH:
                    // å­—æ®µå€¼ä¸ä¸€è‡´ï¼šç”¨MySQLçš„å€¼è¦†ç›–
                    repairFieldValue(table, pkValue, error.getFieldName());
                    break;
                    
                case EXTRA_RECORD:
                    // å¤šä½™è®°å½•ï¼šåˆ é™¤ç›®æ ‡ç³»ç»Ÿä¸­çš„è®°å½•
                    removeExtraRecord(table, pkValue);
                    break;
                    
                default:
                    // å¤æ‚é—®é¢˜ç•™ç»™äººå·¥å¤„ç†
                    createManualTask(table, pkValue, error);
            }
        }
    }
    
    private void repairMissingRecord(String table, String pkValue) {
        // ä»MySQLæŸ¥è¯¢å®Œæ•´è®°å½•
        Record mysqlRecord = queryFromMySQL(table, pkValue);
        
        if (mysqlRecord != null) {
            // æ’å…¥åˆ°ç›®æ ‡ç³»ç»Ÿ
            insertToTarget(table, mysqlRecord);
            log.info("è‡ªåŠ¨ä¿®å¤ç¼ºå¤±è®°å½•ï¼š{}.{}", table, pkValue);
        }
    }
}
```

**ç­–ç•¥2ï¼šæ‰‹åŠ¨ç¡®è®¤ä¿®å¤**
```java
public class ManualRepairService {
    public List<RepairTask> getPendingTasks() {
        // è·å–éœ€è¦äººå·¥å¤„ç†çš„ä¿®å¤ä»»åŠ¡
        return repairTaskRepository.findByStatus(TaskStatus.PENDING);
    }
    
    public void executeRepairTask(Long taskId, RepairAction action) {
        RepairTask task = repairTaskRepository.findById(taskId);
        
        switch (action) {
            case USE_MYSQL_DATA:
                // ä½¿ç”¨MySQLæ•°æ®è¦†ç›–ç›®æ ‡ç³»ç»Ÿ
                overwriteWithMysqlData(task);
                break;
                
            case USE_TARGET_DATA:
                // ä¿æŒç›®æ ‡ç³»ç»Ÿæ•°æ®ä¸å˜
                markAsResolved(task);
                break;
                
            case CUSTOM_REPAIR:
                // æ‰§è¡Œè‡ªå®šä¹‰ä¿®å¤é€»è¾‘
                executeCustomRepair(task);
                break;
        }
        
        task.setStatus(TaskStatus.COMPLETED);
        repairTaskRepository.save(task);
    }
}
```

### 9.4 æ ¡éªŒæŠ¥å‘Šä¸ç›‘æ§


**ğŸ“Š æ ¡éªŒæŠ¥å‘Šç”Ÿæˆ**ï¼š
```java
public class ValidationReportGenerator {
    public ValidationReport generateDailyReport(Date reportDate) {
        ValidationReport report = new ValidationReport();
        report.setReportDate(reportDate);
        
        // ç»Ÿè®¡æ ¡éªŒæ•°æ®
        report.setTotalValidations(getTotalValidations(reportDate));
        report.setFailedValidations(getFailedValidations(reportDate));
        report.setSuccessRate(calculateSuccessRate(reportDate));
        
        // æŒ‰è¡¨ç»Ÿè®¡
        Map<String, TableValidationStats> tableStats = new HashMap<>();
        for (String table : getMonitoredTables()) {
            TableValidationStats stats = calculateTableStats(table, reportDate);
            tableStats.put(table, stats);
        }
        report.setTableStats(tableStats);
        
        // å¤±è´¥åŸå› åˆ†æ
        Map<String, Integer> errorTypes = analyzeErrorTypes(reportDate);
        report.setErrorTypeDistribution(errorTypes);
        
        return report;
    }
}
```

**ğŸ“ˆ ç›‘æ§æŒ‡æ ‡è®¾è®¡**ï¼š
```java
public class ConsistencyMonitor {
    // å…³é”®æŒ‡æ ‡ç›‘æ§
    @Gauge(name = "data_consistency_rate")
    public double getConsistencyRate() {
        return calculateConsistencyRate();
    }
    
    @Counter(name = "validation_failures_total")
    private final Counter validationFailures = Counter.build()
        .name("validation_failures_total")
        .help("Total validation failures")
        .labelNames("table", "error_type")
        .register();
    
    @Timer(name = "repair_duration_seconds")
    private final Timer repairDuration = Timer.build()
        .name("repair_duration_seconds")
        .help("Time spent on data repair")
        .register();
    
    public void recordValidationFailure(String table, String errorType) {
        validationFailures.labels(table, errorType).inc();
    }
}
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ•°æ®ä¸€è‡´æ€§ï¼šCanalåŒæ­¥æ•°æ®ä¸MySQLæºæ•°æ®çš„å®Œå…¨åŒ¹é…
ğŸ”¸ æ•°æ®ä¸¢å¤±ï¼šæºæ•°æ®å˜æ›´æœªèƒ½æ­£ç¡®åŒæ­¥åˆ°ç›®æ ‡ç³»ç»Ÿ
ğŸ”¸ æ•°æ®é‡å¤ï¼šåŒä¸€å˜æ›´è¢«å¤šæ¬¡åŒæ­¥ï¼Œéœ€è¦å¹‚ç­‰æ€§è®¾è®¡
ğŸ”¸ æ•°æ®ä¹±åºï¼šå˜æ›´æ‰§è¡Œé¡ºåºä¸åŸå§‹é¡ºåºä¸ä¸€è‡´
ğŸ”¸ äº‹åŠ¡è¾¹ç•Œï¼šä¿è¯äº‹åŠ¡çš„åŸå­æ€§å®Œæ•´åŒæ­¥
ğŸ”¸ DDLåŒæ­¥ï¼šè¡¨ç»“æ„å˜æ›´çš„æ­£ç¡®åŒæ­¥å¤„ç†
ğŸ”¸ å­—ç¬¦é›†é—®é¢˜ï¼šç¼–ç ä¸ä¸€è‡´å¯¼è‡´çš„ä¹±ç æˆ–åŒæ­¥å¤±è´¥
ğŸ”¸ æ—¶åŒºé—®é¢˜ï¼šæ—¶é—´å­—æ®µåœ¨ä¸åŒæ—¶åŒºçš„æ­£ç¡®è½¬æ¢
ğŸ”¸ æ•°æ®æ ¡éªŒï¼šéªŒè¯åŒæ­¥æ•°æ®çš„æ­£ç¡®æ€§å’Œå®Œæ•´æ€§
ğŸ”¸ ä¸€è‡´æ€§ä¿®å¤ï¼šå‘ç°é—®é¢˜åçš„è‡ªåŠ¨æˆ–æ‰‹åŠ¨ä¿®å¤æœºåˆ¶
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸€è‡´æ€§é—®é¢˜çš„æ ¹æœ¬åŸå› **
```
ç½‘ç»œå› ç´ ï¼š
â€¢ ç½‘ç»œä¸­æ–­å¯¼è‡´åŒæ­¥å¤±è´¥
â€¢ ç½‘ç»œå»¶è¿Ÿé€ æˆé¡ºåºæ··ä¹±
â€¢ ç½‘ç»œé‡è¯•å¼•èµ·é‡å¤åŒæ­¥

ç³»ç»Ÿå› ç´ ï¼š
â€¢ æœåŠ¡é‡å¯ä¸¢å¤±å†…å­˜çŠ¶æ€
â€¢ é…ç½®é”™è¯¯å¯¼è‡´è§£æå¼‚å¸¸
â€¢ èµ„æºä¸è¶³å½±å“å¤„ç†æ€§èƒ½

ä¸šåŠ¡å› ç´ ï¼š
â€¢ äº‹åŠ¡è¾¹ç•Œå¤„ç†ä¸å½“
â€¢ DDLæ“ä½œå…¼å®¹æ€§é—®é¢˜
â€¢ æ•°æ®ç±»å‹è½¬æ¢é”™è¯¯
```

**ğŸ”¹ é¢„é˜²èƒœäºæ²»ç–—çš„è®¾è®¡åŸåˆ™**
```
è®¾è®¡é˜¶æ®µé¢„é˜²ï¼š
â€¢ å¹‚ç­‰æ€§è®¾è®¡é¿å…é‡å¤é—®é¢˜
â€¢ äº‹åŠ¡å®Œæ•´æ€§ä¿è¯åŸå­åŒæ­¥
â€¢ ç±»å‹å…¼å®¹æ€§æ£€æŸ¥é¿å…è½¬æ¢é”™è¯¯

è¿è¡Œé˜¶æ®µç›‘æ§ï¼š
â€¢ å®æ—¶æ ¡éªŒåŠæ—¶å‘ç°é—®é¢˜
â€¢ å®šæ—¶æ ¡éªŒç¡®ä¿é•¿æœŸä¸€è‡´æ€§
â€¢ ç›‘æ§å‘Šè­¦å¿«é€Ÿå“åº”å¼‚å¸¸

æ•…éšœåæ¢å¤ï¼š
â€¢ è‡ªåŠ¨ä¿®å¤å¤„ç†ç®€å•é—®é¢˜
â€¢ æ‰‹åŠ¨ç¡®è®¤å¤„ç†å¤æ‚é—®é¢˜
â€¢ æ•°æ®è¡¥å¿æ¢å¤ä¸¢å¤±æ•°æ®
```

**ğŸ”¹ æ€§èƒ½ä¸ä¸€è‡´æ€§çš„å¹³è¡¡**
```
å¼ºä¸€è‡´æ€§ vs é«˜æ€§èƒ½ï¼š
â€¢ å•çº¿ç¨‹é¡ºåºå¤„ç†ä¿è¯å¼ºä¸€è‡´æ€§ä½†æ€§èƒ½ä½
â€¢ å¤šçº¿ç¨‹å¹¶å‘å¤„ç†æé«˜æ€§èƒ½ä½†å¯èƒ½ä¹±åº
â€¢ åˆ†åŒºæœ‰åºå¤„ç†åœ¨ä¸¤è€…é—´å¹³è¡¡

å®æ—¶æ€§ vs å‡†ç¡®æ€§ï¼š
â€¢ å®æ—¶æ ¡éªŒä¿è¯åŠæ—¶å‘ç°é—®é¢˜
â€¢ æ‰¹é‡æ ¡éªŒå‡å°‘ç³»ç»Ÿå¼€é”€
â€¢ å¼‚æ­¥ä¿®å¤é¿å…å½±å“æ­£å¸¸åŒæ­¥
```

### 10.3 å®é™…åº”ç”¨æŒ‡å¯¼


**ğŸ’¼ é—®é¢˜æ’æŸ¥æ­¥éª¤**ï¼š
```
Step 1ï¼šé—®é¢˜å®šä½
â€¢ ç¡®å®šé—®é¢˜ç±»å‹ï¼ˆä¸¢å¤±/é‡å¤/ä¹±åºç­‰ï¼‰
â€¢ åˆ†æé—®é¢˜å½±å“èŒƒå›´å’Œä¸¥é‡ç¨‹åº¦
â€¢ æ”¶é›†ç›¸å…³æ—¥å¿—å’Œç›‘æ§æ•°æ®

Step 2ï¼šåŸå› åˆ†æ  
â€¢ æ£€æŸ¥Canalé…ç½®å’Œè¿è¡ŒçŠ¶æ€
â€¢ åˆ†æMySQL binlogå’Œç½‘ç»œçŠ¶å†µ
â€¢ ç¡®è®¤ç›®æ ‡ç³»ç»Ÿå¤„ç†èƒ½åŠ›

Step 3ï¼šè§£å†³å®æ–½
â€¢ é€‰æ‹©åˆé€‚çš„ä¿®å¤ç­–ç•¥
â€¢ æ‰§è¡Œæ•°æ®ä¿®å¤æ“ä½œ
â€¢ éªŒè¯ä¿®å¤æ•ˆæœ

Step 4ï¼šé¢„é˜²æ”¹è¿›
â€¢ ä¼˜åŒ–é…ç½®é¿å…å†æ¬¡å‘ç”Ÿ
â€¢ å®Œå–„ç›‘æ§åŠæ—¶å‘ç°é—®é¢˜
â€¢ æ›´æ–°åº”æ€¥å¤„ç†æµç¨‹
```

**ğŸ”§ æœ€ä½³å®è·µå»ºè®®**ï¼š
```
é…ç½®å±‚é¢ï¼š
â€¢ ç»Ÿä¸€å­—ç¬¦é›†ä¸ºUTF-8æˆ–UTF8MB4
â€¢ é…ç½®åˆç†çš„è¶…æ—¶å’Œé‡è¯•å‚æ•°
â€¢ å¯ç”¨äº‹åŠ¡å®Œæ•´æ€§æ£€æŸ¥

ä»£ç å±‚é¢ï¼š
â€¢ å®ç°å¹‚ç­‰æ€§å¤„ç†é€»è¾‘
â€¢ æ·»åŠ æ•°æ®æ ¡éªŒæœºåˆ¶
â€¢ è®¾è®¡é™çº§å’Œè¡¥å¿æ–¹æ¡ˆ

è¿ç»´å±‚é¢ï¼š
â€¢ å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
â€¢ åˆ¶å®šåº”æ€¥å¤„ç†æµç¨‹
â€¢ å®šæœŸè¿›è¡Œæ•°æ®ä¸€è‡´æ€§æ ¡éªŒ
```

**ğŸ¯ å…³é”®æˆåŠŸå› ç´ **ï¼š
- **å…¨é¢ç›‘æ§**ï¼šè¦†ç›–æ•°æ®åŒæ­¥çš„å„ä¸ªç¯èŠ‚
- **å¿«é€Ÿå“åº”**ï¼šé—®é¢˜å‘ç°ååŠæ—¶å¤„ç†é¿å…æ‰©å¤§å½±å“
- **è‡ªåŠ¨åŒ–å¤„ç†**ï¼šå‡å°‘äººå·¥å¹²é¢„æé«˜å¤„ç†æ•ˆç‡
- **æŒç»­ä¼˜åŒ–**ï¼šæ ¹æ®é—®é¢˜åé¦ˆä¸æ–­å®Œå–„ç³»ç»Ÿ

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- ä¸€è‡´æ€§é—®é¢˜è¦é¢„é˜²ï¼Œç›‘æ§æ ¡éªŒä¸èƒ½å¿˜
- ä¸¢å¤±é‡å¤å’Œä¹±åºï¼Œå¹‚ç­‰äº‹åŠ¡æ¥ä¿è¯  
- å­—ç¬¦æ—¶åŒºç±»å‹è½¬ï¼Œé…ç½®ç»Ÿä¸€å¾ˆé‡è¦
- è‡ªåŠ¨ä¿®å¤é…äººå·¥ï¼Œé—®é¢˜å¤„ç†è¦åŠæ—¶