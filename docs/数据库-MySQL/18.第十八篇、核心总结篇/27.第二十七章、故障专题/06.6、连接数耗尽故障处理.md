---
title: 6ã€è¿æ¥æ•°è€—å°½æ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [æ•…éšœç°è±¡ä¸åŸå› ](#1-æ•…éšœç°è±¡ä¸åŸå› )
2. [Too many connectionsé”™è¯¯è¯¦è§£](#2-Too-many-connectionsé”™è¯¯è¯¦è§£)
3. [max_connectionså‚æ•°é…ç½®](#3-max_connectionså‚æ•°é…ç½®)
4. [è¿æ¥æ•°ç›‘æ§ä¸æ£€æµ‹](#4-è¿æ¥æ•°ç›‘æ§ä¸æ£€æµ‹)
5. [è¿æ¥æ³„æ¼é—®é¢˜å¤„ç†](#5-è¿æ¥æ³„æ¼é—®é¢˜å¤„ç†)
6. [è¿æ¥æ± é…ç½®ä¼˜åŒ–](#6-è¿æ¥æ± é…ç½®ä¼˜åŒ–)
7. [åº”ç”¨å±‚è¿æ¥ç®¡ç†](#7-åº”ç”¨å±‚è¿æ¥ç®¡ç†)
8. [ç´§æ€¥æ•…éšœå¤„ç†æ–¹æ¡ˆ](#8-ç´§æ€¥æ•…éšœå¤„ç†æ–¹æ¡ˆ)
9. [é¢„é˜²ä¸ä¼˜åŒ–ç­–ç•¥](#9-é¢„é˜²ä¸ä¼˜åŒ–ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸš¨ æ•…éšœç°è±¡ä¸åŸå› 


### 1.1 ä»€ä¹ˆæ˜¯è¿æ¥æ•°è€—å°½


**ğŸ”¸ é€šä¿—è§£é‡Š**
æƒ³è±¡MySQLæ•°æ®åº“å°±åƒä¸€ä¸ªé¤å…ï¼Œæ¯ä¸ªå®¢æˆ·å°±æ˜¯ä¸€ä¸ªåº”ç”¨è¿æ¥ã€‚é¤å…åªæœ‰100å¼ æ¡Œå­ï¼ˆmax_connections=100ï¼‰ï¼Œå½“ç¬¬101ä¸ªå®¢æˆ·æ¥çš„æ—¶å€™ï¼Œé¤å…å°±ä¼šè¯´"å¯¹ä¸èµ·ï¼Œæ²¡æœ‰æ¡Œå­äº†"ã€‚è¿™å°±æ˜¯è¿æ¥æ•°è€—å°½ã€‚

**ğŸ”¸ æŠ€æœ¯å®šä¹‰**
å½“å‰æ´»è·ƒçš„æ•°æ®åº“è¿æ¥æ•°è¾¾åˆ°MySQLè®¾ç½®çš„æœ€å¤§è¿æ¥æ•°é™åˆ¶ï¼ˆmax_connectionsï¼‰ï¼Œæ–°çš„è¿æ¥è¯·æ±‚ä¼šè¢«æ‹’ç»ã€‚

### 1.2 å…¸å‹æ•…éšœç°è±¡


**ğŸš¨ ç”¨æˆ·çœ‹åˆ°çš„é”™è¯¯**
```sql
ERROR 1040 (HY000): Too many connections
```

**ğŸš¨ åº”ç”¨ç³»ç»Ÿè¡¨ç°**
- ç½‘ç«™é¡µé¢åŠ è½½å¾ˆæ…¢æˆ–æ— æ³•æ‰“å¼€
- åº”ç”¨ç¨‹åºæŠ¥"æ•°æ®åº“è¿æ¥å¤±è´¥"
- æŸäº›åŠŸèƒ½æ­£å¸¸ï¼ŒæŸäº›åŠŸèƒ½å¼‚å¸¸
- ç³»ç»Ÿå“åº”æ—¶é—´æ€¥å‰§å¢é•¿

### 1.3 æ•…éšœå‘ç”Ÿçš„æ ¹æœ¬åŸå› 


**ğŸ”¸ è¿æ¥æ²¡æœ‰åŠæ—¶é‡Šæ”¾**
```
æ­£å¸¸æƒ…å†µï¼šåº”ç”¨ â†’ è·å–è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ é‡Šæ”¾è¿æ¥
é—®é¢˜æƒ…å†µï¼šåº”ç”¨ â†’ è·å–è¿æ¥ â†’ æ‰§è¡ŒSQL â†’ å¿˜è®°é‡Šæ”¾è¿æ¥
```

**ğŸ”¸ å¹¶å‘è®¿é—®é‡çªç„¶å¢å¤§**
- ä¿ƒé”€æ´»åŠ¨å¯¼è‡´ç”¨æˆ·è®¿é—®æ¿€å¢
- çˆ¬è™«ç¨‹åºå¤§é‡è®¿é—®
- å®šæ—¶ä»»åŠ¡åŒæ—¶å¯åŠ¨

**ğŸ”¸ æ…¢æŸ¥è¯¢å ç”¨è¿æ¥è¿‡ä¹…**
- SQLè¯­å¥æ‰§è¡Œæ—¶é—´è¿‡é•¿
- é”ç­‰å¾…æ—¶é—´è¿‡é•¿
- äº‹åŠ¡é•¿æ—¶é—´æœªæäº¤

---

## 2. ğŸ“‹ Too many connectionsé”™è¯¯è¯¦è§£


### 2.1 é”™è¯¯äº§ç”Ÿæœºåˆ¶


**ğŸ”¸ MySQLè¿æ¥å¤„ç†æµç¨‹**
```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ MySQLæ£€æŸ¥å½“å‰è¿æ¥æ•° â†’ æ¯”è¾ƒmax_connections
    â†“
å¦‚æœ å½“å‰è¿æ¥æ•° >= max_connections
    â†“
è¿”å›"Too many connections"é”™è¯¯
```

**ğŸ”¸ é”™è¯¯ä»£ç å«ä¹‰**
- **é”™è¯¯å·**: 1040
- **é”™è¯¯ç±»å‹**: HY000 (ä¸€èˆ¬é”™è¯¯)
- **é”™è¯¯ä¿¡æ¯**: Too many connections

### 2.2 ä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯


**â° é«˜å³°æ—¶æ®µ**
```
æ—¶é—´æ®µï¼šä¸Šåˆ9-10ç‚¹ï¼Œä¸‹åˆ2-3ç‚¹ï¼Œæ™šä¸Š8-9ç‚¹
åŸå› ï¼šç”¨æˆ·è®¿é—®é›†ä¸­ï¼Œå¹¶å‘è¿æ¥æ•°æ¿€å¢
```

**â° ç³»ç»Ÿæ•…éšœæ—¶**
```
åœºæ™¯ï¼šæŸä¸ªåº”ç”¨æ¨¡å—å‡ºç°BUG
ç»“æœï¼šè¿æ¥è·å–åæ— æ³•æ­£å¸¸é‡Šæ”¾ï¼Œè¶Šç§¯è¶Šå¤š
```

**â° æ‰¹é‡å¤„ç†æ—¶**
```
åœºæ™¯ï¼šæ•°æ®å¯¼å…¥ã€æŠ¥è¡¨ç”Ÿæˆã€å¤‡ä»½æ“ä½œ
ç»“æœï¼šé•¿æ—¶é—´å ç”¨å¤§é‡è¿æ¥
```

### 2.3 é”™è¯¯çš„å½±å“èŒƒå›´


> ğŸ’¡ **é‡è¦ç†è§£**  
> è¿™ä¸ªé”™è¯¯ä¸æ˜¯è¯´æ•°æ®åº“å´©æºƒäº†ï¼Œè€Œæ˜¯åƒåœè½¦åœºæ»¡äº†ä¸€æ ·ï¼Œæ–°è½¦è¿›ä¸æ¥ï¼Œä½†é‡Œé¢çš„è½¦è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ã€‚

**ğŸŸ¢ ä¸å—å½±å“çš„æ“ä½œ**
- å·²ç»å»ºç«‹çš„è¿æ¥ç»§ç»­æ­£å¸¸å·¥ä½œ
- æ•°æ®åº“å†…éƒ¨æ“ä½œæ­£å¸¸è¿›è¡Œ
- å·²æœ‰è¿æ¥çš„æŸ¥è¯¢å’Œäº‹åŠ¡ç»§ç»­æ‰§è¡Œ

**ğŸ”´ å—å½±å“çš„æ“ä½œ**
- æ–°çš„åº”ç”¨è¿æ¥æ— æ³•å»ºç«‹
- ç”¨æˆ·æ— æ³•ç™»å½•æˆ–è®¿é—®æ–°é¡µé¢
- æ–°çš„å®šæ—¶ä»»åŠ¡æ— æ³•æ‰§è¡Œ

---

## 3. âš™ï¸ max_connectionså‚æ•°é…ç½®


### 3.1 ä»€ä¹ˆæ˜¯max_connections


**ğŸ”¸ å‚æ•°å«ä¹‰**
`max_connections`å°±æ˜¯MySQLå…è®¸åŒæ—¶è¿æ¥çš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡ï¼Œå°±åƒç”µå½±é™¢çš„åº§ä½æ€»æ•°ä¸€æ ·ã€‚

**ğŸ”¸ é»˜è®¤å€¼è¯´æ˜**
```sql
-- æŸ¥çœ‹å½“å‰è®¾ç½®
SHOW VARIABLES LIKE 'max_connections';

-- å¸¸è§é»˜è®¤å€¼
MySQL 5.7: 151
MySQL 8.0: 151
```

### 3.2 å¦‚ä½•åˆç†è®¾ç½®max_connections


**ğŸ”¸ è®¡ç®—å…¬å¼å‚è€ƒ**
```
max_connections = (å¯ç”¨å†…å­˜ - ç³»ç»Ÿä¿ç•™å†…å­˜) / æ¯è¿æ¥å†…å­˜æ¶ˆè€—

æ¯è¿æ¥å¤§çº¦æ¶ˆè€—: 256KB - 1MBå†…å­˜
```

**ğŸ”¸ å®é™…è®¾ç½®å»ºè®®**

| æœåŠ¡å™¨é…ç½® | **å»ºè®®è¿æ¥æ•°** | **é€‚ç”¨åœºæ™¯** |
|-----------|--------------|-------------|
| ğŸ”¸ **å°å‹æœåŠ¡å™¨(2GBå†…å­˜)** | `100-200` | `ä¸ªäººç½‘ç«™ã€å°å‹åº”ç”¨` |
| ğŸ”¸ **ä¸­å‹æœåŠ¡å™¨(8GBå†…å­˜)** | `300-500` | `ä¼ä¸šåº”ç”¨ã€ä¸­å‹ç½‘ç«™` |
| ğŸ”¸ **å¤§å‹æœåŠ¡å™¨(32GBå†…å­˜)** | `800-1500` | `é«˜å¹¶å‘åº”ç”¨ã€å¤§å‹ç³»ç»Ÿ` |

### 3.3 å‚æ•°ä¿®æ”¹æ–¹æ³•


**ğŸ”¸ ä¸´æ—¶ä¿®æ”¹ï¼ˆé‡å¯å¤±æ•ˆï¼‰**
```sql
-- éœ€è¦SUPERæƒé™
SET GLOBAL max_connections = 500;
```

**ğŸ”¸ æ°¸ä¹…ä¿®æ”¹ï¼ˆæ¨èï¼‰**
```ini
# åœ¨my.cnfé…ç½®æ–‡ä»¶ä¸­æ·»åŠ 
[mysqld]
max_connections = 500

# ä¿®æ”¹åé‡å¯MySQLæœåŠ¡
systemctl restart mysql
```

**ğŸ”¸ ä¿®æ”¹éªŒè¯**
```sql
-- æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹å½“å‰ä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Connections';
SHOW STATUS LIKE 'Threads_connected';
```

### 3.4 è®¾ç½®æ—¶çš„æ³¨æ„äº‹é¡¹


> âš ï¸ **é‡è¦æé†’**  
> è¿æ¥æ•°ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼è®¾ç½®è¿‡å¤§ä¼šæ¶ˆè€—å¤ªå¤šå†…å­˜ï¼Œåè€Œå½±å“æ€§èƒ½ã€‚

**ğŸ”¸ å†…å­˜é™åˆ¶**
```
æ¯ä¸ªè¿æ¥æ¶ˆè€—å†…å­˜ â‰ˆ 256KB + æŸ¥è¯¢ç¼“å­˜
1000ä¸ªè¿æ¥ â‰ˆ 256MB + é¢å¤–å¼€é”€
```

**ğŸ”¸ ç³»ç»Ÿé™åˆ¶**
```bash
# æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶å¥æŸ„é™åˆ¶
ulimit -n

# å¦‚æœè¿æ¥æ•°è¿‡å¤§ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´ç³»ç»Ÿé™åˆ¶
echo "mysql soft nofile 65535" >> /etc/security/limits.conf
```

---

## 4. ğŸ“Š è¿æ¥æ•°ç›‘æ§ä¸æ£€æµ‹


### 4.1 åŸºæœ¬ç›‘æ§å‘½ä»¤


**ğŸ”¸ æŸ¥çœ‹å½“å‰è¿æ¥çŠ¶æ€**
```sql
-- å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';

-- æœ€å¤§è¿æ¥æ•°é…ç½®
SHOW VARIABLES LIKE 'max_connections';

-- å†å²æœ€é«˜è¿æ¥æ•°
SHOW STATUS LIKE 'Max_used_connections';

-- è¿æ¥ä½¿ç”¨ç‡è®¡ç®—
SELECT 
  VARIABLE_VALUE as current_connections,
  $$max_connections as max_connections,
  ROUND(VARIABLE_VALUE/$$max_connections*100,2) as usage_percentage
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME='Threads_connected';
```

**ğŸ”¸ è¿æ¥è¯¦ç»†ä¿¡æ¯**
```sql
-- æŸ¥çœ‹æ‰€æœ‰å½“å‰è¿æ¥
SHOW PROCESSLIST;

-- æŸ¥çœ‹å®Œæ•´è¿æ¥ä¿¡æ¯
SELECT * FROM information_schema.PROCESSLIST;
```

### 4.2 è¿æ¥æ•°ç›‘æ§è„šæœ¬


**ğŸ”¸ ç®€å•ç›‘æ§è„šæœ¬**
```bash
#!/bin/bash
# connection_monitor.sh

while true; do
    current=$(mysql -e "SHOW STATUS LIKE 'Threads_connected';" | awk 'NR==2{print $2}')
    max=$(mysql -e "SHOW VARIABLES LIKE 'max_connections';" | awk 'NR==2{print $2}')
    usage=$(echo "scale=2; $current/$max*100" | bc)
    
    echo "$(date): è¿æ¥æ•° $current/$max (${usage}%)"
    
    # ä½¿ç”¨ç‡è¶…è¿‡80%æ—¶å‘é€å‘Šè­¦
    if (( $(echo "$usage > 80" | bc -l) )); then
        echo "è­¦å‘Šï¼šè¿æ¥ä½¿ç”¨ç‡è¿‡é«˜ï¼"
    fi
    
    sleep 10
done
```

### 4.3 ç›‘æ§å…³é”®æŒ‡æ ‡


**ğŸ“ˆ é‡è¦ç›‘æ§æŒ‡æ ‡**
```sql
-- 1. å½“å‰è¿æ¥æ•°è¶‹åŠ¿
SHOW STATUS LIKE 'Threads_connected';

-- 2. å†å²æœ€é«˜è¿æ¥æ•°
SHOW STATUS LIKE 'Max_used_connections';

-- 3. è¢«æ‹’ç»çš„è¿æ¥æ•°
SHOW STATUS LIKE 'Connection_errors_max_connections';

-- 4. è¿æ¥åˆ›å»ºé€Ÿç‡
SHOW STATUS LIKE 'Connections';

-- 5. å¹³å‡è¿æ¥æŒç»­æ—¶é—´
-- (éœ€è¦é€šè¿‡æ—¥å¿—åˆ†ææˆ–ç›‘æ§å·¥å…·è·å–)
```

**ğŸ¯ å‘Šè­¦é˜ˆå€¼å»ºè®®**
- **é»„è‰²è­¦å‘Š**: è¿æ¥ä½¿ç”¨ç‡ > 70%
- **æ©™è‰²è­¦å‘Š**: è¿æ¥ä½¿ç”¨ç‡ > 80%  
- **çº¢è‰²å‘Šè­¦**: è¿æ¥ä½¿ç”¨ç‡ > 90%

---

## 5. ğŸ” è¿æ¥æ³„æ¼é—®é¢˜å¤„ç†


### 5.1 ä»€ä¹ˆæ˜¯è¿æ¥æ³„æ¼


**ğŸ”¸ é€šä¿—è§£é‡Š**
è¿æ¥æ³„æ¼å°±åƒå€Ÿä¹¦ä¸è¿˜ã€‚åº”ç”¨ç¨‹åºä»æ•°æ®åº“"å€Ÿ"äº†è¿æ¥æ¥æŸ¥è¯¢æ•°æ®ï¼Œç”¨å®Œååº”è¯¥"å½’è¿˜"è¿æ¥ï¼Œä½†æœ‰äº›ç¨‹åºç”¨å®Œåå¿˜è®°å½’è¿˜ï¼Œè¿æ¥å°±ä¸€ç›´è¢«å ç”¨ã€‚

**ğŸ”¸ æ³„æ¼çš„è¡¨ç°**
```
æ­£å¸¸æƒ…å†µï¼šè¿æ¥æ•°æ³¢åŠ¨ï¼Œæœ‰é«˜æœ‰ä½
æ³„æ¼æƒ…å†µï¼šè¿æ¥æ•°åªå¢ä¸å‡ï¼ŒæŒç»­ä¸Šå‡
```

### 5.2 è¿æ¥æ³„æ¼æ£€æµ‹æ–¹æ³•


**ğŸ”¸ æ£€æŸ¥é•¿æ—¶é—´è¿è¡Œçš„è¿æ¥**
```sql
-- æŸ¥çœ‹è¿è¡Œæ—¶é—´è¶…è¿‡1å°æ—¶çš„è¿æ¥
SELECT 
    ID,
    USER,
    HOST,
    DB,
    COMMAND,
    TIME,
    STATE,
    INFO
FROM information_schema.PROCESSLIST 
WHERE TIME > 3600 
  AND COMMAND != 'Sleep'
ORDER BY TIME DESC;
```

**ğŸ”¸ æ£€æŸ¥SleepçŠ¶æ€çš„è¿æ¥**
```sql
-- æŸ¥çœ‹é•¿æ—¶é—´å¤„äºSleepçŠ¶æ€çš„è¿æ¥
SELECT 
    ID,
    USER,
    HOST,
    DB,
    TIME,
    STATE
FROM information_schema.PROCESSLIST 
WHERE COMMAND = 'Sleep' 
  AND TIME > 1800  -- è¶…è¿‡30åˆ†é’Ÿ
ORDER BY TIME DESC;
```

### 5.3 è¿æ¥æ³„æ¼çš„å¸¸è§åŸå› 


**ğŸ”¸ ä»£ç é—®é¢˜**
```java
// âŒ é”™è¯¯å†™æ³•ï¼šå¿˜è®°å…³é—­è¿æ¥
Connection conn = DriverManager.getConnection(url, user, password);
Statement stmt = conn.createStatement();
ResultSet rs = stmt.executeQuery("SELECT * FROM users");
// å¿˜è®°å…³é—­è¿æ¥ï¼

// âœ… æ­£ç¡®å†™æ³•ï¼šç¡®ä¿è¿æ¥å…³é—­
try (Connection conn = DriverManager.getConnection(url, user, password);
     Statement stmt = conn.createStatement();
     ResultSet rs = stmt.executeQuery("SELECT * FROM users")) {
    // å¤„ç†ç»“æœ
} // è‡ªåŠ¨å…³é—­è¿æ¥
```

**ğŸ”¸ å¼‚å¸¸å¤„ç†ä¸å½“**
```java
// âŒ é”™è¯¯å†™æ³•ï¼šå¼‚å¸¸æ—¶è¿æ¥æ²¡æœ‰å…³é—­
Connection conn = null;
try {
    conn = getConnection();
    // ä¸šåŠ¡é€»è¾‘
} catch (Exception e) {
    // å¼‚å¸¸å¤„ç†ï¼Œä½†å¿˜è®°å…³é—­è¿æ¥
    log.error("å‡ºé”™äº†", e);
}

// âœ… æ­£ç¡®å†™æ³•ï¼šä½¿ç”¨finallyç¡®ä¿å…³é—­
Connection conn = null;
try {
    conn = getConnection();
    // ä¸šåŠ¡é€»è¾‘
} catch (Exception e) {
    log.error("å‡ºé”™äº†", e);
} finally {
    if (conn != null) {
        try {
            conn.close();
        } catch (SQLException e) {
            log.error("å…³é—­è¿æ¥å¤±è´¥", e);
        }
    }
}
```

### 5.4 ç´§æ€¥å¤„ç†è¿æ¥æ³„æ¼


**ğŸš¨ å¼ºåˆ¶ç»ˆæ­¢è¿æ¥**
```sql
-- ç»ˆæ­¢ç‰¹å®šè¿æ¥
KILL è¿æ¥ID;

-- æ‰¹é‡ç»ˆæ­¢é•¿æ—¶é—´ç©ºé—²è¿æ¥
-- æ³¨æ„ï¼šè°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½å½±å“æ­£å¸¸ä¸šåŠ¡
```

**ğŸ› ï¸ è®¾ç½®è¿æ¥è¶…æ—¶**
```sql
-- è®¾ç½®äº¤äº’å¼è¿æ¥è¶…æ—¶ï¼ˆå¦‚mysqlå‘½ä»¤è¡Œï¼‰
SET GLOBAL interactive_timeout = 3600;

-- è®¾ç½®éäº¤äº’å¼è¿æ¥è¶…æ—¶ï¼ˆå¦‚åº”ç”¨ç¨‹åºï¼‰
SET GLOBAL wait_timeout = 600;
```

---

## 6. ğŸŠ è¿æ¥æ± é…ç½®ä¼˜åŒ–


### 6.1 ä»€ä¹ˆæ˜¯è¿æ¥æ± 


**ğŸ”¸ ç”Ÿæ´»æ¯”å–»**
è¿æ¥æ± å°±åƒå…±äº«å•è½¦ã€‚ä¸æ˜¯æ¯æ¬¡å‡ºé—¨éƒ½ä¹°ä¸€è¾†æ–°è‡ªè¡Œè½¦ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªè½¦æ± ï¼Œéœ€è¦æ—¶å€Ÿä¸€è¾†ï¼Œç”¨å®Œè¿˜å›å»ã€‚è¿™æ ·æ—¢èŠ‚çœèµ„æºï¼Œåˆæé«˜æ•ˆç‡ã€‚

**ğŸ”¸ è¿æ¥æ± çš„ä¼˜åŠ¿**
- **å‡å°‘è¿æ¥åˆ›å»ºå¼€é”€**ï¼šé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯è¿æ¥
- **æ§åˆ¶è¿æ¥æ•°é‡**ï¼šé˜²æ­¢è¿æ¥æ•°è¿‡å¤š
- **æé«˜å“åº”é€Ÿåº¦**ï¼šå¤ç”¨å·²æœ‰è¿æ¥
- **å¢å¼ºç¨³å®šæ€§**ï¼šè¿æ¥å¤±æ•ˆæ—¶è‡ªåŠ¨é‡å»º

### 6.2 ä¸»æµè¿æ¥æ± é…ç½®


**ğŸ”¸ HikariCPé…ç½®ï¼ˆæ¨èï¼‰**
```properties
# åŸºæœ¬è¿æ¥ä¿¡æ¯
spring.datasource.url=jdbc:mysql://localhost:3306/testdb
spring.datasource.username=root
spring.datasource.password=password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCPè¿æ¥æ± é…ç½®
spring.datasource.hikari.minimum-idle=10        # æœ€å°ç©ºé—²è¿æ¥æ•°
spring.datasource.hikari.maximum-pool-size=50   # æœ€å¤§è¿æ¥æ± å¤§å°
spring.datasource.hikari.idle-timeout=300000    # ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´(5åˆ†é’Ÿ)
spring.datasource.hikari.max-lifetime=1200000   # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´(20åˆ†é’Ÿ)
spring.datasource.hikari.connection-timeout=20000  # è·å–è¿æ¥è¶…æ—¶æ—¶é—´(20ç§’)
```

**ğŸ”¸ Druidè¿æ¥æ± é…ç½®**
```properties
# è¿æ¥æ± é…ç½®
spring.datasource.druid.initial-size=5          # åˆå§‹è¿æ¥æ•°
spring.datasource.druid.min-idle=5              # æœ€å°ç©ºé—²è¿æ¥æ•°
spring.datasource.druid.max-active=50           # æœ€å¤§æ´»è·ƒè¿æ¥æ•°
spring.datasource.druid.max-wait=60000          # è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´

# è¿æ¥æ£€æµ‹é…ç½®
spring.datasource.druid.test-on-borrow=false    # è·å–è¿æ¥æ—¶æ£€æµ‹
spring.datasource.druid.test-on-return=false    # å½’è¿˜è¿æ¥æ—¶æ£€æµ‹
spring.datasource.druid.test-while-idle=true    # ç©ºé—²æ—¶æ£€æµ‹
spring.datasource.druid.validation-query=SELECT 1  # æ£€æµ‹æŸ¥è¯¢è¯­å¥
```

### 6.3 è¿æ¥æ± å‚æ•°è°ƒä¼˜


**ğŸ“Š å…³é”®å‚æ•°è¯´æ˜**

| å‚æ•°åç§° | **ä½œç”¨è¯´æ˜** | **æ¨èå€¼** | **è°ƒä¼˜å»ºè®®** |
|---------|------------|-----------|-------------|
| ğŸ”¸ **æœ€å°è¿æ¥æ•°** | `ä¿æŒçš„æœ€å°‘è¿æ¥æ•°` | `5-10` | `æ ¹æ®å¹³æ—¶è®¿é—®é‡è®¾ç½®` |
| ğŸ”¸ **æœ€å¤§è¿æ¥æ•°** | `å…è®¸çš„æœ€å¤§è¿æ¥æ•°` | `20-50` | `ä¸è¶…è¿‡MySQL max_connectionsçš„80%` |
| ğŸ”¸ **è¿æ¥è¶…æ—¶** | `è·å–è¿æ¥çš„ç­‰å¾…æ—¶é—´` | `10-30ç§’` | `ä¸å®œè¿‡é•¿ï¼Œé¿å…ç”¨æˆ·ç­‰å¾…` |
| ğŸ”¸ **ç©ºé—²è¶…æ—¶** | `ç©ºé—²è¿æ¥å¤šä¹…è¢«å›æ”¶` | `5-10åˆ†é’Ÿ` | `æ ¹æ®è®¿é—®é¢‘ç‡è°ƒæ•´` |

**ğŸ¯ è°ƒä¼˜ç­–ç•¥**
```
é«˜å¹¶å‘åœºæ™¯ï¼š
- å¢å¤§æœ€å¤§è¿æ¥æ•°å’Œæœ€å°è¿æ¥æ•°
- å‡çŸ­ç©ºé—²è¶…æ—¶æ—¶é—´
- å¯ç”¨è¿æ¥é¢„çƒ­

ä½å¹¶å‘åœºæ™¯ï¼š
- å‡å°è¿æ¥æ± å¤§å°
- å¢é•¿ç©ºé—²è¶…æ—¶æ—¶é—´
- å…³é—­ä¸å¿…è¦çš„æ£€æµ‹
```

### 6.4 è¿æ¥æ± ç›‘æ§


**ğŸ”¸ ç›‘æ§å…³é”®æŒ‡æ ‡**
```java
// HikariCPç›‘æ§ç¤ºä¾‹
@Component
public class ConnectionPoolMonitor {
    
    @Autowired
    private HikariDataSource dataSource;
    
    @Scheduled(fixedRate = 30000) // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    public void monitorConnectionPool() {
        HikariPoolMXBean poolBean = dataSource.getHikariPoolMXBean();
        
        int activeConnections = poolBean.getActiveConnections();
        int idleConnections = poolBean.getIdleConnections();
        int totalConnections = poolBean.getTotalConnections();
        int waitingThreads = poolBean.getThreadsAwaitingConnection();
        
        logger.info("è¿æ¥æ± çŠ¶æ€ - æ´»è·ƒ:{}, ç©ºé—²:{}, æ€»è®¡:{}, ç­‰å¾…:{}", 
                   activeConnections, idleConnections, totalConnections, waitingThreads);
        
        // è¿æ¥ä½¿ç”¨ç‡è¿‡é«˜æ—¶å‘Šè­¦
        if (activeConnections > totalConnections * 0.8) {
            logger.warn("è¿æ¥æ± ä½¿ç”¨ç‡è¿‡é«˜ï¼š{}%", activeConnections * 100 / totalConnections);
        }
    }
}
```

---

## 7. ğŸ”§ åº”ç”¨å±‚è¿æ¥ç®¡ç†


### 7.1 åº”ç”¨è¿æ¥ç®¡ç†åŸåˆ™


**ğŸ”¸ æ ¸å¿ƒåŸåˆ™**
- **åŠæ—¶é‡Šæ”¾**ï¼šç”¨å®Œç«‹å³é‡Šæ”¾ï¼Œä¸è¦é•¿æ—¶é—´å ç”¨
- **å¼‚å¸¸å¤„ç†**ï¼šç¡®ä¿å¼‚å¸¸æƒ…å†µä¸‹ä¹Ÿèƒ½é‡Šæ”¾è¿æ¥
- **é¿å…æ³„æ¼**ï¼šä½¿ç”¨try-with-resourcesæˆ–è¿æ¥æ± 
- **åˆç†é…ç½®**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é…ç½®è¿æ¥å‚æ•°

### 7.2 ä»£ç å±‚é¢çš„æœ€ä½³å®è·µ


**ğŸ”¸ ä½¿ç”¨try-with-resources**
```java
// âœ… æ¨èå†™æ³•ï¼šè‡ªåŠ¨èµ„æºç®¡ç†
public List<User> getUsers() {
    String sql = "SELECT * FROM users";
    List<User> users = new ArrayList<>();
    
    try (Connection conn = dataSource.getConnection();
         PreparedStatement stmt = conn.prepareStatement(sql);
         ResultSet rs = stmt.executeQuery()) {
        
        while (rs.next()) {
            users.add(mapToUser(rs));
        }
    } catch (SQLException e) {
        logger.error("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥", e);
        throw new RuntimeException("æŸ¥è¯¢ç”¨æˆ·å¤±è´¥", e);
    }
    
    return users;
}
```

**ğŸ”¸ æ­£ç¡®çš„äº‹åŠ¡ç®¡ç†**
```java
// âœ… æ­£ç¡®çš„äº‹åŠ¡å¤„ç†
@Transactional
public void transferMoney(Long fromId, Long toId, BigDecimal amount) {
    try {
        // æ‰£å‡è½¬å‡ºè´¦æˆ·
        accountService.debit(fromId, amount);
        
        // å¢åŠ è½¬å…¥è´¦æˆ·
        accountService.credit(toId, amount);
        
        // è®°å½•è½¬è´¦æ—¥å¿—
        logService.recordTransfer(fromId, toId, amount);
        
    } catch (Exception e) {
        // Springä¼šè‡ªåŠ¨å›æ»šäº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥
        logger.error("è½¬è´¦å¤±è´¥", e);
        throw e;
    }
    // æ–¹æ³•ç»“æŸæ—¶è‡ªåŠ¨æäº¤äº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥
}
```

### 7.3 è¿æ¥è¶…æ—¶å¤„ç†


**ğŸ”¸ è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´**
```properties
# åº”ç”¨çº§åˆ«è¶…æ—¶è®¾ç½®
spring.datasource.hikari.connection-timeout=20000      # è·å–è¿æ¥è¶…æ—¶
spring.datasource.hikari.validation-timeout=5000       # è¿æ¥éªŒè¯è¶…æ—¶

# MyBatisè¶…æ—¶è®¾ç½®
mybatis.configuration.default-statement-timeout=30     # SQLæ‰§è¡Œè¶…æ—¶

# Spring Bootè¶…æ—¶è®¾ç½®
spring.transaction.default-timeout=60                  # äº‹åŠ¡è¶…æ—¶
```

**ğŸ”¸ è¶…æ—¶å¼‚å¸¸å¤„ç†**
```java
@Service
public class UserService {
    
    public User getUserById(Long id) {
        try {
            return userMapper.selectById(id);
        } catch (SQLException e) {
            if (e.getMessage().contains("timeout")) {
                logger.error("æ•°æ®åº“æŸ¥è¯¢è¶…æ—¶ï¼Œç”¨æˆ·ID: {}", id);
                throw new ServiceException("æŸ¥è¯¢è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•");
            }
            throw new ServiceException("æŸ¥è¯¢å¤±è´¥", e);
        }
    }
}
```

### 7.4 æ‰¹é‡æ“ä½œä¼˜åŒ–


**ğŸ”¸ æ‰¹é‡å¤„ç†å‡å°‘è¿æ¥ä½¿ç”¨**
```java
// âŒ é”™è¯¯åšæ³•ï¼šé¢‘ç¹è·å–é‡Šæ”¾è¿æ¥
public void insertUsers(List<User> users) {
    for (User user : users) {
        userMapper.insert(user);  // æ¯æ¬¡éƒ½è¦è·å–è¿æ¥
    }
}

// âœ… æ­£ç¡®åšæ³•ï¼šæ‰¹é‡æ“ä½œ
@Transactional
public void insertUsers(List<User> users) {
    // ä¸€æ¬¡äº‹åŠ¡å†…å®Œæˆæ‰€æœ‰æ’å…¥ï¼Œåªç”¨ä¸€ä¸ªè¿æ¥
    userMapper.insertBatch(users);
}
```

---

## 8. ğŸš¨ ç´§æ€¥æ•…éšœå¤„ç†æ–¹æ¡ˆ


### 8.1 æ•…éšœåº”æ€¥å“åº”æµç¨‹


**ğŸ”¸ ç´§æ€¥å¤„ç†æ­¥éª¤**
```
1ï¸âƒ£ ç«‹å³ç¡®è®¤æ•…éšœ â†’ æŸ¥çœ‹é”™è¯¯æ—¥å¿—å’Œç›‘æ§
2ï¸âƒ£ ä¸´æ—¶æ‰©å®¹è¿æ¥ â†’ å¢åŠ max_connections
3ï¸âƒ£ æ¸…ç†æ— æ•ˆè¿æ¥ â†’ ç»ˆæ­¢é•¿æ—¶é—´ç©ºé—²è¿æ¥
4ï¸âƒ£ é‡å¯åº”ç”¨æœåŠ¡ â†’ é‡Šæ”¾åº”ç”¨å±‚è¿æ¥æ³„æ¼
5ï¸âƒ£ æ ¹å› åˆ†æ â†’ å®šä½é—®é¢˜æ ¹æœ¬åŸå› 
```

### 8.2 å¿«é€Ÿè¯Šæ–­å‘½ä»¤


**ğŸ”¸ ä¸€é”®è¯Šæ–­è„šæœ¬**
```bash
#!/bin/bash
# mysql_connection_diagnosis.sh

echo "=== MySQLè¿æ¥è¯Šæ–­æŠ¥å‘Š ==="
echo "æ—¶é—´: $(date)"
echo

# 1. è¿æ¥æ•°ç»Ÿè®¡
echo "1. è¿æ¥æ•°ç»Ÿè®¡:"
mysql -e "
SELECT 
  'å½“å‰è¿æ¥æ•°' as metric, 
  VARIABLE_VALUE as value 
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME='Threads_connected'
UNION ALL
SELECT 
  'æœ€å¤§è¿æ¥æ•°' as metric, 
  VARIABLE_VALUE as value 
FROM information_schema.GLOBAL_VARIABLES 
WHERE VARIABLE_NAME='max_connections'
UNION ALL
SELECT 
  'å†å²æœ€é«˜è¿æ¥æ•°' as metric, 
  VARIABLE_VALUE as value 
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME='Max_used_connections';
"

# 2. è¿æ¥çŠ¶æ€åˆ†å¸ƒ
echo "2. è¿æ¥çŠ¶æ€åˆ†å¸ƒ:"
mysql -e "
SELECT 
  COMMAND, 
  COUNT(*) as count,
  ROUND(COUNT(*)*100/(SELECT COUNT(*) FROM information_schema.PROCESSLIST),2) as percentage
FROM information_schema.PROCESSLIST 
GROUP BY COMMAND 
ORDER BY count DESC;
"

# 3. é•¿æ—¶é—´è¿è¡Œçš„è¿æ¥
echo "3. é•¿æ—¶é—´è¿è¡Œçš„è¿æ¥(>10åˆ†é’Ÿ):"
mysql -e "
SELECT 
  ID, USER, HOST, DB, COMMAND, TIME, STATE 
FROM information_schema.PROCESSLIST 
WHERE TIME > 600 
ORDER BY TIME DESC 
LIMIT 10;
"
```

### 8.3 ç´§æ€¥ä¿®å¤æ“ä½œ


**ğŸ”¸ ä¸´æ—¶å¢åŠ è¿æ¥æ•°**
```sql
-- ç«‹å³ç”Ÿæ•ˆï¼Œé‡å¯åå¤±æ•ˆ
SET GLOBAL max_connections = 1000;

-- éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ
SHOW VARIABLES LIKE 'max_connections';
```

**ğŸ”¸ æ¸…ç†å¼‚å¸¸è¿æ¥**
```sql
-- æŸ¥çœ‹å¯ä»¥æ¸…ç†çš„è¿æ¥
SELECT 
  ID, USER, HOST, COMMAND, TIME, STATE 
FROM information_schema.PROCESSLIST 
WHERE (COMMAND = 'Sleep' AND TIME > 300)
   OR (TIME > 3600 AND COMMAND != 'Binlog Dump')
ORDER BY TIME DESC;

-- é€ä¸ªç»ˆæ­¢è¿æ¥ï¼ˆå°å¿ƒæ“ä½œï¼‰
KILL è¿æ¥ID;
```

**ğŸ”¸ åº”ç”¨æœåŠ¡é‡å¯**
```bash
# é‡å¯åº”ç”¨æœåŠ¡ï¼ˆæ ¹æ®å®é™…ç¯å¢ƒè°ƒæ•´ï¼‰
systemctl restart your-application

# æˆ–è€…ä½¿ç”¨ä¼˜é›…åœæœº
kill -SIGTERM `cat /var/run/your-app.pid`
```

### 8.4 æ•…éšœé¢„é˜²æœºåˆ¶


**ğŸ”¸ è¿æ¥æ•°å‘Šè­¦è®¾ç½®**
```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
*/5 * * * * /path/to/connection_alert.sh

# connection_alert.shå†…å®¹
#!/bin/bash
CURRENT=$(mysql -e "SHOW STATUS LIKE 'Threads_connected';" | awk 'NR==2{print $2}')
MAX=$(mysql -e "SHOW VARIABLES LIKE 'max_connections';" | awk 'NR==2{print $2}')
USAGE=$(echo "scale=2; $CURRENT/$MAX*100" | bc)

if (( $(echo "$USAGE > 80" | bc -l) )); then
    echo "è­¦å‘Šï¼šè¿æ¥ä½¿ç”¨ç‡ ${USAGE}%ï¼Œå½“å‰è¿æ¥æ•° ${CURRENT}/${MAX}" | \
    mail -s "MySQLè¿æ¥æ•°å‘Šè­¦" admin@company.com
fi
```

---

## 9. ğŸ›¡ï¸ é¢„é˜²ä¸ä¼˜åŒ–ç­–ç•¥


### 9.1 å®¹é‡è§„åˆ’


**ğŸ”¸ è¿æ¥æ•°å®¹é‡è®¡ç®—**
```
é¢„æœŸå¹¶å‘ç”¨æˆ·æ•° Ã— æ¯ç”¨æˆ·å¹³å‡è¿æ¥æ•° Ã— å®‰å…¨ç³»æ•° = æ‰€éœ€è¿æ¥æ•°

ç¤ºä¾‹ï¼š
1000ä¸ªå¹¶å‘ç”¨æˆ· Ã— 1.2ä¸ªè¿æ¥/ç”¨æˆ· Ã— 1.5å®‰å…¨ç³»æ•° = 1800ä¸ªè¿æ¥
```

**ğŸ”¸ åˆ†å±‚è¿æ¥ç®¡ç†**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯å±‚        â”‚ â† ç”¨æˆ·è¯·æ±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº”ç”¨å±‚        â”‚ â† è¿æ¥æ± ç®¡ç†(20-50ä¸ªè¿æ¥)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ•°æ®åº“å±‚      â”‚ â† max_connections(500ä¸ªè¿æ¥)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 æ¶æ„ä¼˜åŒ–


**ğŸ”¸ è¯»å†™åˆ†ç¦»**
```
ä¸»åº“ï¼šå¤„ç†å†™æ“ä½œï¼Œè¿æ¥æ•°è¦æ±‚è¾ƒé«˜
ä»åº“ï¼šå¤„ç†è¯»æ“ä½œï¼Œå¯ä»¥åˆ†æ•£è¿æ¥å‹åŠ›

é…ç½®ç¤ºä¾‹ï¼š
ä¸»åº“max_connections = 500
ä»åº“max_connections = 300 (å¤šä¸ªä»åº“)
```

**ğŸ”¸ è¿æ¥æ± åˆ†ç¦»**
```java
// ä¸åŒä¸šåŠ¡ä½¿ç”¨ä¸åŒè¿æ¥æ± 
@Configuration
public class DataSourceConfig {
    
    @Bean("userDataSource")
    public DataSource userDataSource() {
        // ç”¨æˆ·ç›¸å…³ä¸šåŠ¡è¿æ¥æ± 
        HikariConfig config = new HikariConfig();
        config.setMaximumPoolSize(30);
        return new HikariDataSource(config);
    }
    
    @Bean("reportDataSource") 
    public DataSource reportDataSource() {
        // æŠ¥è¡¨ä¸šåŠ¡è¿æ¥æ± 
        HikariConfig config = new HikariConfig();
        config.setMaximumPoolSize(10);
        return new HikariDataSource(config);
    }
}
```

### 9.3 ä»£ç ä¼˜åŒ–å»ºè®®


**ğŸ”¸ å‡å°‘è¿æ¥æŒæœ‰æ—¶é—´**
```java
// âŒ é”™è¯¯ï¼šè¿æ¥æŒæœ‰æ—¶é—´è¿‡é•¿
public void processUsers() {
    Connection conn = getConnection();
    List<User> users = queryUsers(conn);
    
    for (User user : users) {
        // é•¿æ—¶é—´çš„ä¸šåŠ¡å¤„ç†
        processBusinessLogic(user);  // å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ
    }
    
    conn.close(); // è¿æ¥è¢«é•¿æ—¶é—´å ç”¨
}

// âœ… æ­£ç¡®ï¼šå°½å¿«é‡Šæ”¾è¿æ¥
public void processUsers() {
    List<User> users;
    
    // å¿«é€Ÿè·å–æ•°æ®åç«‹å³é‡Šæ”¾è¿æ¥
    try (Connection conn = getConnection()) {
        users = queryUsers(conn);
    }
    
    // ä¸šåŠ¡å¤„ç†ä¸å ç”¨æ•°æ®åº“è¿æ¥
    for (User user : users) {
        processBusinessLogic(user);
    }
}
```

**ğŸ”¸ å¼‚æ­¥å¤„ç†ä¼˜åŒ–**
```java
@Service
public class AsyncUserService {
    
    @Async
    public CompletableFuture<Void> processUserAsync(User user) {
        // å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹å’Œè¿æ¥
        return CompletableFuture.runAsync(() -> {
            // å¤„ç†ä¸šåŠ¡é€»è¾‘
            processUser(user);
        });
    }
}
```

### 9.4 ç›‘æ§å’Œå‘Šè­¦ä½“ç³»


**ğŸ“Š å…³é”®ç›‘æ§æŒ‡æ ‡**
- **è¿æ¥ä½¿ç”¨ç‡**ï¼šå½“å‰è¿æ¥æ•°/æœ€å¤§è¿æ¥æ•°
- **è¿æ¥è·å–è€—æ—¶**ï¼šä»è¿æ¥æ± è·å–è¿æ¥çš„æ—¶é—´
- **è¿æ¥ç­‰å¾…æ•°**ï¼šç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹æ•°
- **è¿æ¥åˆ›å»ºé¢‘ç‡**ï¼šå•ä½æ—¶é—´å†…åˆ›å»ºçš„æ–°è¿æ¥æ•°
- **æ…¢æŸ¥è¯¢æ•°é‡**ï¼šæ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æŸ¥è¯¢æ•°

**ğŸš¨ å‘Šè­¦ç­–ç•¥**
```yaml
# å‘Šè­¦é…ç½®ç¤ºä¾‹
alerts:
  connection_usage:
    warning: 70%    # è¿æ¥ä½¿ç”¨ç‡è¶…è¿‡70%è­¦å‘Š
    critical: 85%   # è¿æ¥ä½¿ç”¨ç‡è¶…è¿‡85%ä¸¥é‡å‘Šè­¦
  
  connection_wait:
    warning: 10     # ç­‰å¾…è¿æ¥çš„çº¿ç¨‹è¶…è¿‡10ä¸ª
    critical: 20    # ç­‰å¾…è¿æ¥çš„çº¿ç¨‹è¶…è¿‡20ä¸ª
  
  slow_query:
    warning: 10s    # æŸ¥è¯¢æ—¶é—´è¶…è¿‡10ç§’
    critical: 30s   # æŸ¥è¯¢æ—¶é—´è¶…è¿‡30ç§’
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„å…³é”®çŸ¥è¯†


**ğŸ”¸ æ•…éšœç°è±¡è¯†åˆ«**
- `Too many connections`é”™è¯¯çš„å«ä¹‰å’Œå½±å“
- è¿æ¥æ•°è€—å°½ä¸å…¶ä»–æ•…éšœçš„åŒºåˆ«
- æ•…éšœå‘ç”Ÿçš„å…¸å‹æ—¶é—´å’Œåœºæ™¯

**ğŸ”¸ å‚æ•°é…ç½®è¦ç‚¹**
- `max_connections`çš„åˆç†è®¾ç½®æ–¹æ³•
- è¿æ¥æ± æ ¸å¿ƒå‚æ•°çš„å«ä¹‰å’Œè°ƒä¼˜
- è¶…æ—¶å‚æ•°çš„é…ç½®åŸåˆ™

**ğŸ”¸ ç›‘æ§æ£€æµ‹æ–¹æ³•**
- è¿æ¥æ•°ç›‘æ§çš„å…³é”®SQLå‘½ä»¤
- è¿æ¥æ³„æ¼çš„æ£€æµ‹å’Œå®šä½æ–¹æ³•
- å‘Šè­¦é˜ˆå€¼çš„è®¾å®šåŸåˆ™

### 10.2 æ•…éšœå¤„ç†æµç¨‹


**ğŸš¨ ç´§æ€¥å¤„ç†**
```
å‘ç°æ•…éšœ â†’ å¿«é€Ÿè¯Šæ–­ â†’ ä¸´æ—¶æ‰©å®¹ â†’ æ¸…ç†è¿æ¥ â†’ åº”ç”¨é‡å¯
```

**ğŸ” æ ¹å› åˆ†æ**
```
æ”¶é›†æ—¥å¿— â†’ åˆ†æè¿æ¥ä½¿ç”¨æ¨¡å¼ â†’ å®šä½ä»£ç é—®é¢˜ â†’ åˆ¶å®šä¼˜åŒ–æ–¹æ¡ˆ
```

**ğŸ›¡ï¸ é¢„é˜²æªæ–½**
```
å®¹é‡è§„åˆ’ â†’ ä»£ç è§„èŒƒ â†’ ç›‘æ§å‘Šè­¦ â†’ å®šæœŸå·¡æ£€
```

### 10.3 æœ€ä½³å®è·µæ€»ç»“


> ğŸ’¡ **æ ¸å¿ƒåŸåˆ™**  
> è¿æ¥æ˜¯å®è´µèµ„æºï¼Œè¦åƒä½¿ç”¨é‡‘é’±ä¸€æ ·è°¨æ…ï¼šåŠæ—¶è·å–ã€å¿«é€Ÿä½¿ç”¨ã€ç«‹å³å½’è¿˜ã€‚

**ğŸ”¸ å¼€å‘å±‚é¢**
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†è¿æ¥
- åŠæ—¶é‡Šæ”¾è¿æ¥èµ„æº
- æ­£ç¡®å¤„ç†å¼‚å¸¸æƒ…å†µ
- é¿å…é•¿æ—¶é—´å ç”¨è¿æ¥

**ğŸ”¸ è¿ç»´å±‚é¢**  
- åˆç†è®¾ç½®è¿æ¥æ•°å‚æ•°
- å»ºç«‹å®Œå–„çš„ç›‘æ§ä½“ç³»
- åˆ¶å®šåº”æ€¥å¤„ç†é¢„æ¡ˆ
- å®šæœŸæ£€æŸ¥å’Œä¼˜åŒ–

**ğŸ”¸ æ¶æ„å±‚é¢**
- è€ƒè™‘è¯»å†™åˆ†ç¦»å‡å‹
- ä½¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®
- å¼‚æ­¥å¤„ç†è€—æ—¶æ“ä½œ
- åˆ†å±‚è®¾è®¡è¿æ¥ç®¡ç†

### 10.4 å¸¸è§è¯¯åŒºé¿å…


âŒ **é”™è¯¯è®¤çŸ¥**ï¼šè¿æ¥æ•°è¶Šå¤§è¶Šå¥½  
âœ… **æ­£ç¡®ç†è§£**ï¼šè¿æ¥æ•°è¦æ ¹æ®å†…å­˜å’Œå¹¶å‘é‡åˆç†è®¾ç½®

âŒ **é”™è¯¯è®¤çŸ¥**ï¼šå‡ºç°è¿æ¥æ•°è€—å°½å°±è¯´æ˜æ•°æ®åº“æœ‰é—®é¢˜  
âœ… **æ­£ç¡®ç†è§£**ï¼šé€šå¸¸æ˜¯åº”ç”¨å±‚è¿æ¥ç®¡ç†ä¸å½“å¯¼è‡´

âŒ **é”™è¯¯è®¤çŸ¥**ï¼šé‡å¯æ•°æ®åº“å°±èƒ½è§£å†³è¿æ¥é—®é¢˜  
âœ… **æ­£ç¡®ç†è§£**ï¼šåº”è¯¥å…ˆåˆ†æåŸå› ï¼Œé‡å¯å¯èƒ½å½±å“å…¶ä»–æ­£å¸¸è¿æ¥

**è®°å¿†è¦ç‚¹**ï¼š
- è¿æ¥å¦‚é‡‘é’±ï¼Œçæƒœæ¯ä¸€ä¸ª
- ç›‘æ§è¦åŠæ—¶ï¼Œå‘Šè­¦è¦å‡†ç¡®  
- ä»£ç è¦è§„èŒƒï¼Œé‡Šæ”¾è¦å½»åº•
- å®¹é‡è¦è§„åˆ’ï¼Œæ¶æ„è¦åˆç†