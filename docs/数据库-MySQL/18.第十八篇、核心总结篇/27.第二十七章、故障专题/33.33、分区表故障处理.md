---
title: 33ã€åˆ†åŒºè¡¨æ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [åˆ†åŒºè¡¨åŸºç¡€æ¦‚å¿µ](#1-åˆ†åŒºè¡¨åŸºç¡€æ¦‚å¿µ)
2. [åˆ†åŒºè¡¨æŸåä¿®å¤](#2-åˆ†åŒºè¡¨æŸåä¿®å¤)
3. [åˆ†åŒºå‰ªæå¤±æ•ˆé—®é¢˜](#3-åˆ†åŒºå‰ªæå¤±æ•ˆé—®é¢˜)
4. [åˆ†åŒºæ•°æ®ä¸å‡è¡¡å¤„ç†](#4-åˆ†åŒºæ•°æ®ä¸å‡è¡¡å¤„ç†)
5. [åˆ†åŒºè¡¨é”ç­‰å¾…è§£å†³](#5-åˆ†åŒºè¡¨é”ç­‰å¾…è§£å†³)
6. [åˆ†åŒºæ·»åŠ å¤±è´¥å¤„ç†](#6-åˆ†åŒºæ·»åŠ å¤±è´¥å¤„ç†)
7. [åˆ†åŒºç»Ÿè®¡ä¿¡æ¯é”™è¯¯](#7-åˆ†åŒºç»Ÿè®¡ä¿¡æ¯é”™è¯¯)
8. [åˆ†åŒºæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–](#8-åˆ†åŒºæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–)
9. [åˆ†åŒºè¡¨ç»´æŠ¤æ•…éšœ](#9-åˆ†åŒºè¡¨ç»´æŠ¤æ•…éšœ)
10. [åˆ†åŒºç­–ç•¥è°ƒæ•´æŒ‡å—](#10-åˆ†åŒºç­–ç•¥è°ƒæ•´æŒ‡å—)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ åˆ†åŒºè¡¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯åˆ†åŒºè¡¨

**åˆ†åŒºè¡¨**å°±åƒæŠŠä¸€ä¸ªå·¨å¤§çš„ä»“åº“æŒ‰ç…§ä¸åŒè§„åˆ™åˆ†æˆè‹¥å¹²ä¸ªå°æˆ¿é—´ï¼Œæ¯ä¸ªæˆ¿é—´å­˜æ”¾ç‰¹å®šç±»å‹çš„è´§ç‰©ã€‚

```
æ™®é€šè¡¨ï¼š                    åˆ†åŒºè¡¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚   å…¨éƒ¨æ•°æ®       â”‚         â”‚ åˆ†åŒº1 â”‚ åˆ†åŒº2 â”‚ åˆ†åŒº3 â”‚
â”‚   (500ä¸‡è¡Œ)     â”‚   â†’     â”‚(1æœˆ) â”‚(2æœˆ) â”‚(3æœˆ) â”‚
â”‚                 â”‚         â”‚      â”‚      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

å¥½å¤„ï¼šæŸ¥è¯¢æ—¶åªéœ€è¦æ£€æŸ¥ç›¸å…³åˆ†åŒºï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¡¨
```

### 1.2 åˆ†åŒºè¡¨çš„æ ¸å¿ƒä½œç”¨

**ğŸ”¸ æé«˜æŸ¥è¯¢æ€§èƒ½**
- åªæŸ¥è¯¢ç›¸å…³åˆ†åŒºï¼Œå‡å°‘æ•°æ®æ‰«æé‡
- å¹¶è¡Œå¤„ç†ä¸åŒåˆ†åŒºçš„æ•°æ®

**ğŸ”¸ ç®€åŒ–æ•°æ®ç»´æŠ¤**
- å¯ä»¥å•ç‹¬åˆ é™¤æ•´ä¸ªåˆ†åŒºçš„æ•°æ®
- åˆ†åŒºçº§åˆ«çš„å¤‡ä»½å’Œæ¢å¤

**ğŸ”¸ æå‡ç®¡ç†æ•ˆç‡**
- å†å²æ•°æ®æŒ‰æ—¶é—´åˆ†åŒºå­˜æ”¾
- ä¾¿äºæ•°æ®å½’æ¡£å’Œæ¸…ç†

### 1.3 å¸¸è§åˆ†åŒºç±»å‹


**æŒ‰æ—¶é—´åˆ†åŒºï¼ˆæœ€å¸¸ç”¨ï¼‰**
```sql
-- æŒ‰æœˆåˆ†åŒºçš„è®¢å•è¡¨
CREATE TABLE orders (
    id INT,
    order_date DATE,
    amount DECIMAL(10,2)
) 
PARTITION BY RANGE (YEAR(order_date)*100 + MONTH(order_date)) (
    PARTITION p202301 VALUES LESS THAN (202302),
    PARTITION p202302 VALUES LESS THAN (202303),
    PARTITION p202303 VALUES LESS THAN (202304)
);
```

**æŒ‰èŒƒå›´åˆ†åŒº**
```sql
-- æŒ‰ç”¨æˆ·IDåˆ†åŒº
PARTITION BY RANGE (user_id) (
    PARTITION p1 VALUES LESS THAN (10000),
    PARTITION p2 VALUES LESS THAN (20000),
    PARTITION p3 VALUES LESS THAN (MAXVALUE)
);
```

---

## 2. ğŸ”§ åˆ†åŒºè¡¨æŸåä¿®å¤


### 2.1 å¦‚ä½•å‘ç°åˆ†åŒºè¡¨æŸå


**å¸¸è§æŸåç—‡çŠ¶**
```
ğŸš¨ æŠ¥é”™ä¿¡æ¯ï¼š
- "Table is marked as crashed"
- "Incorrect key file for table"
- "Can't find record in partition"

ğŸ” æ£€æŸ¥å‘½ä»¤ï¼š
mysql> CHECK TABLE table_name;
mysql> SHOW TABLE STATUS LIKE 'table_name';
```

**æ£€æŸ¥ç‰¹å®šåˆ†åŒºçŠ¶æ€**
```sql
-- æ£€æŸ¥åˆ†åŒºä¿¡æ¯
SELECT 
    TABLE_NAME,
    PARTITION_NAME,
    TABLE_ROWS,
    DATA_LENGTH,
    INDEX_LENGTH
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'your_table_name';
```

### 2.2 åˆ†åŒºæŸåä¿®å¤æ­¥éª¤


**æ­¥éª¤1ï¼šç¡®å®šæŸååˆ†åŒº**
```sql
-- é€ä¸ªæ£€æŸ¥åˆ†åŒº
ALTER TABLE orders CHECK PARTITION p202301;
ALTER TABLE orders CHECK PARTITION p202302;
```

**æ­¥éª¤2ï¼šä¿®å¤æŸååˆ†åŒº**
```sql
-- ä¿®å¤ç‰¹å®šåˆ†åŒº
ALTER TABLE orders REPAIR PARTITION p202301;

-- å¦‚æœä¿®å¤å¤±è´¥ï¼Œå¼ºåˆ¶ä¿®å¤
ALTER TABLE orders REPAIR PARTITION p202301 EXTENDED;
```

**æ­¥éª¤3ï¼šéªŒè¯ä¿®å¤ç»“æœ**
```sql
-- å†æ¬¡æ£€æŸ¥åˆ†åŒº
ALTER TABLE orders CHECK PARTITION p202301;

-- æŸ¥çœ‹åˆ†åŒºæ•°æ®
SELECT COUNT(*) FROM orders PARTITION(p202301);
```

### 2.3 ä¸¥é‡æŸåçš„å¤„ç†æ–¹æ¡ˆ


**æ–¹æ¡ˆä¸€ï¼šé‡å»ºåˆ†åŒº**
```sql
-- 1. å¯¼å‡ºåˆ†åŒºæ•°æ®
mysqldump -u root -p database_name table_name --where="order_date >= '2023-01-01' AND order_date < '2023-02-01'" > p202301.sql

-- 2. åˆ é™¤æŸååˆ†åŒº
ALTER TABLE orders DROP PARTITION p202301;

-- 3. é‡æ–°æ·»åŠ åˆ†åŒº
ALTER TABLE orders ADD PARTITION (
    PARTITION p202301 VALUES LESS THAN (202302)
);

-- 4. å¯¼å…¥æ•°æ®
mysql -u root -p database_name < p202301.sql
```

**æ–¹æ¡ˆäºŒï¼šä½¿ç”¨å¤‡ä»½æ¢å¤**
```sql
-- ä»å¤‡ä»½ä¸­æ¢å¤ç‰¹å®šåˆ†åŒºçš„æ•°æ®
-- è¿™éœ€è¦äº‹å…ˆæœ‰åˆ†åŒºçº§åˆ«çš„å¤‡ä»½
```

---

## 3. âš¡ åˆ†åŒºå‰ªæå¤±æ•ˆé—®é¢˜


### 3.1 ä»€ä¹ˆæ˜¯åˆ†åŒºå‰ªæ

**åˆ†åŒºå‰ªæ**å°±åƒæ˜¯ä¸€ä¸ªèªæ˜çš„å¯¼è´­å‘˜ï¼Œèƒ½å¤Ÿç›´æ¥å‘Šè¯‰ä½ è¦æ‰¾çš„å•†å“åœ¨å“ªä¸ªåŒºåŸŸï¼Œè€Œä¸éœ€è¦åœ¨æ•´ä¸ªå•†åœºé‡Œæ‰¾ã€‚

```
æŸ¥è¯¢ï¼šSELECT * FROM orders WHERE order_date = '2023-01-15'

æ²¡æœ‰åˆ†åŒºå‰ªæï¼š                æœ‰åˆ†åŒºå‰ªæï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æŸ¥ â”‚ æ£€æŸ¥ â”‚ æ£€æŸ¥ â”‚         â”‚ è·³è¿‡ â”‚ æ£€æŸ¥ â”‚ è·³è¿‡ â”‚
â”‚ åˆ†åŒº1â”‚ åˆ†åŒº2â”‚ åˆ†åŒº3â”‚         â”‚ åˆ†åŒº1â”‚ åˆ†åŒº2â”‚ åˆ†åŒº3â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
æ‰«æ3ä¸ªåˆ†åŒº                    åªæ‰«æ1ä¸ªåˆ†åŒº
```

### 3.2 åˆ†åŒºå‰ªæå¤±æ•ˆçš„åŸå› 


**åŸå› 1ï¼šæŸ¥è¯¢æ¡ä»¶ä¸åŒ…å«åˆ†åŒºé”®**
```sql
-- âŒ é”™è¯¯ï¼šæ²¡æœ‰ä½¿ç”¨åˆ†åŒºé”®order_date
SELECT * FROM orders WHERE customer_id = 123;

-- âœ… æ­£ç¡®ï¼šåŒ…å«åˆ†åŒºé”®
SELECT * FROM orders WHERE order_date = '2023-01-15' AND customer_id = 123;
```

**åŸå› 2ï¼šå¯¹åˆ†åŒºé”®ä½¿ç”¨å‡½æ•°**
```sql
-- âŒ é”™è¯¯ï¼šå¯¹åˆ†åŒºé”®ä½¿ç”¨å‡½æ•°
SELECT * FROM orders WHERE MONTH(order_date) = 1;

-- âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨åˆ†åŒºé”®èŒƒå›´
SELECT * FROM orders WHERE order_date >= '2023-01-01' AND order_date < '2023-02-01';
```

**åŸå› 3ï¼šåˆ†åŒºé”®æ•°æ®ç±»å‹ä¸åŒ¹é…**
```sql
-- âŒ é”™è¯¯ï¼šå­—ç¬¦ä¸²ä¸æ—¥æœŸæ¯”è¾ƒ
SELECT * FROM orders WHERE order_date = '20230115';

-- âœ… æ­£ç¡®ï¼šä½¿ç”¨æ­£ç¡®çš„æ—¥æœŸæ ¼å¼
SELECT * FROM orders WHERE order_date = '2023-01-15';
```

### 3.3 è¯Šæ–­åˆ†åŒºå‰ªæé—®é¢˜


**ä½¿ç”¨EXPLAINæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’**
```sql
EXPLAIN PARTITIONS 
SELECT * FROM orders 
WHERE order_date = '2023-01-15';

-- æŸ¥çœ‹partitionsåˆ—ï¼Œåº”è¯¥åªæ˜¾ç¤ºç›¸å…³åˆ†åŒº
-- å¦‚æœæ˜¾ç¤ºAllï¼Œè¯´æ˜åˆ†åŒºå‰ªæå¤±æ•ˆ
```

**è¯¦ç»†æ‰§è¡Œè®¡åˆ’åˆ†æ**
```sql
EXPLAIN FORMAT=JSON 
SELECT * FROM orders 
WHERE order_date BETWEEN '2023-01-01' AND '2023-01-31';

-- æŸ¥çœ‹"used_partitions"å­—æ®µ
```

### 3.4 ä¿®å¤åˆ†åŒºå‰ªæå¤±æ•ˆ


**ä¿®å¤æ–¹æ¡ˆ1ï¼šæ”¹å†™æŸ¥è¯¢æ¡ä»¶**
```sql
-- åŸæŸ¥è¯¢ï¼ˆåˆ†åŒºå‰ªæå¤±æ•ˆï¼‰
SELECT * FROM orders WHERE YEAR(order_date) = 2023 AND MONTH(order_date) = 1;

-- ä¿®å¤åï¼ˆåˆ†åŒºå‰ªæç”Ÿæ•ˆï¼‰
SELECT * FROM orders WHERE order_date >= '2023-01-01' AND order_date <= '2023-01-31';
```

**ä¿®å¤æ–¹æ¡ˆ2ï¼šè°ƒæ•´åˆ†åŒºç­–ç•¥**
```sql
-- å¦‚æœç»å¸¸æŒ‰æœˆæŸ¥è¯¢ï¼Œè€ƒè™‘ä¿®æ”¹åˆ†åŒºè¡¨è¾¾å¼
ALTER TABLE orders 
PARTITION BY RANGE (TO_DAYS(order_date)) (
    PARTITION p202301 VALUES LESS THAN (TO_DAYS('2023-02-01')),
    PARTITION p202302 VALUES LESS THAN (TO_DAYS('2023-03-01'))
);
```

---

## 4. ğŸ“Š åˆ†åŒºæ•°æ®ä¸å‡è¡¡å¤„ç†


### 4.1 æ•°æ®ä¸å‡è¡¡çš„è¡¨ç°


**æ£€æŸ¥å„åˆ†åŒºæ•°æ®é‡**
```sql
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    ROUND(DATA_LENGTH/1024/1024, 2) AS 'Size_MB',
    ROUND(INDEX_LENGTH/1024/1024, 2) AS 'Index_MB'
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders' 
ORDER BY TABLE_ROWS DESC;

-- ç»“æœç¤ºä¾‹ï¼š
-- p202301: 1,000,000 è¡Œ  (100MB)
-- p202302: 50,000 è¡Œ     (5MB)    â† æ•°æ®é‡ç›¸å·®å¾ˆå¤§
-- p202303: 800,000 è¡Œ    (80MB)
```

### 4.2 æ•°æ®ä¸å‡è¡¡çš„å±å®³


```
æ€§èƒ½é—®é¢˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤§åˆ†åŒº     â”‚  â”‚å°åˆ†åŒºâ”‚  â”‚  å¤§åˆ†åŒº     â”‚
â”‚ (çƒ­ç‚¹æ•°æ®)  â”‚  â”‚     â”‚  â”‚ (çƒ­ç‚¹æ•°æ®)  â”‚
â”‚ æŸ¥è¯¢æ…¢      â”‚  â”‚é—²ç½® â”‚  â”‚ æŸ¥è¯¢æ…¢      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å­˜å‚¨é—®é¢˜ï¼š
- æŸäº›åˆ†åŒºå ç”¨è¿‡å¤šç£ç›˜ç©ºé—´
- æŸäº›åˆ†åŒºå‡ ä¹ä¸ºç©ºï¼Œæµªè´¹èµ„æº
```

### 4.3 é‡æ–°å¹³è¡¡åˆ†åŒºæ•°æ®


**æ–¹æ¡ˆ1ï¼šè°ƒæ•´åˆ†åŒºè¾¹ç•Œ**
```sql
-- æŸ¥çœ‹å½“å‰åˆ†åŒºå®šä¹‰
SHOW CREATE TABLE orders;

-- é‡æ–°ç»„ç»‡åˆ†åŒºï¼ˆéœ€è¦åœæœºï¼‰
ALTER TABLE orders REORGANIZE PARTITION p202301,p202302 INTO (
    PARTITION p202301_new VALUES LESS THAN (202302),
    PARTITION p202302_new VALUES LESS THAN (202303)
);
```

**æ–¹æ¡ˆ2ï¼šæ·»åŠ æ–°åˆ†åŒºåˆ†æ•£æ•°æ®**
```sql
-- åœ¨æ•°æ®é›†ä¸­çš„åˆ†åŒºå‰åæ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders ADD PARTITION (
    PARTITION p202301_1 VALUES LESS THAN (202301.5),
    PARTITION p202301_2 VALUES LESS THAN (202302)
);
```

**æ–¹æ¡ˆ3ï¼šä¿®æ”¹åˆ†åŒºç­–ç•¥**
```sql
-- ä»æŒ‰æœˆåˆ†åŒºæ”¹ä¸ºæŒ‰å‘¨åˆ†åŒº
CREATE TABLE orders_new (
    id INT,
    order_date DATE,
    amount DECIMAL(10,2)
) 
PARTITION BY RANGE (WEEKOFYEAR(order_date)) (
    PARTITION p01 VALUES LESS THAN (2),
    PARTITION p02 VALUES LESS THAN (3),
    -- ... æ›´å¤šåˆ†åŒº
);

-- è¿ç§»æ•°æ®
INSERT INTO orders_new SELECT * FROM orders;
```

### 4.4 é¢„é˜²æ•°æ®ä¸å‡è¡¡


**åˆç†é€‰æ‹©åˆ†åŒºé”®**
```sql
-- âŒ ä¸å¥½çš„åˆ†åŒºé”®ï¼šæ•°æ®åˆ†å¸ƒä¸å‡
PARTITION BY RANGE (customer_type) (
    PARTITION p1 VALUES LESS THAN (1),  -- VIPå®¢æˆ·å¾ˆå°‘
    PARTITION p2 VALUES LESS THAN (2)   -- æ™®é€šå®¢æˆ·å¾ˆå¤š
);

-- âœ… å¥½çš„åˆ†åŒºé”®ï¼šæ•°æ®åˆ†å¸ƒç›¸å¯¹å‡åŒ€
PARTITION BY HASH(customer_id) PARTITIONS 4;
```

---

## 5. ğŸ”’ åˆ†åŒºè¡¨é”ç­‰å¾…è§£å†³


### 5.1 åˆ†åŒºè¡¨é”ç­‰å¾…çš„åŸå› 


**å…¨è¡¨æ“ä½œå¼•èµ·çš„é”ç­‰å¾…**
```
æƒ…å†µ1ï¼šALTER TABLE æ“ä½œ
ç”¨æˆ·A: ALTER TABLE orders ADD COLUMN new_col INT;  â† é”ä½æ•´ä¸ªè¡¨
ç”¨æˆ·B: SELECT * FROM orders PARTITION(p202301);    â† ç­‰å¾…

æƒ…å†µ2ï¼šåˆ†åŒºç»´æŠ¤æ“ä½œ
ç”¨æˆ·A: ALTER TABLE orders DROP PARTITION p202301;  â† é”ä½æ•´ä¸ªè¡¨
ç”¨æˆ·B: INSERT INTO orders VALUES (...);           â† ç­‰å¾…
```

### 5.2 è¯Šæ–­åˆ†åŒºè¡¨é”ç­‰å¾…


**æŸ¥çœ‹å½“å‰é”ç­‰å¾…æƒ…å†µ**
```sql
-- æŸ¥çœ‹æ­£åœ¨ç­‰å¾…çš„äº‹åŠ¡
SELECT 
    r.trx_id AS waiting_trx_id,
    r.trx_mysql_thread_id AS waiting_thread,
    r.trx_query AS waiting_query,
    b.trx_id AS blocking_trx_id,
    b.trx_mysql_thread_id AS blocking_thread,
    b.trx_query AS blocking_query
FROM information_schema.innodb_lock_waits w
INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;
```

**æŸ¥çœ‹åˆ†åŒºçº§åˆ«çš„é”ä¿¡æ¯**
```sql
-- æŸ¥çœ‹è¡¨çº§åˆ«é”
SHOW OPEN TABLES WHERE In_use > 0;

-- æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
SHOW PROCESSLIST;
```

### 5.3 è§£å†³åˆ†åŒºè¡¨é”ç­‰å¾…


**ç«‹å³è§£å†³æ–¹æ¡ˆ**
```sql
-- 1. æ‰¾åˆ°é˜»å¡çš„çº¿ç¨‹ID
SHOW PROCESSLIST;

-- 2. æ€æ‰é•¿æ—¶é—´è¿è¡Œçš„æ“ä½œ
KILL 12345;  -- 12345æ˜¯çº¿ç¨‹ID

-- 3. æ£€æŸ¥æ˜¯å¦è¿˜æœ‰é”ç­‰å¾…
SHOW PROCESSLIST;
```

**é¢„é˜²é”ç­‰å¾…çš„ç­–ç•¥**
```sql
-- 1. åˆ†åŒºæ“ä½œåœ¨ä¸šåŠ¡ä½å³°æœŸè¿›è¡Œ
-- 2. ä½¿ç”¨åœ¨çº¿DDLï¼ˆMySQL 5.6+ï¼‰
ALTER TABLE orders 
ADD COLUMN new_col INT,
ALGORITHM=INPLACE, 
LOCK=NONE;

-- 3. åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
-- è€Œä¸æ˜¯ä¸€æ¬¡æ€§æ“ä½œ
```

### 5.4 åˆ†åŒºè¡¨é”ç­‰å¾…æœ€ä½³å®è·µ


**åˆ†åŒºç»´æŠ¤æ—¶é—´çª—å£**
```sql
-- 1. è®¾ç½®ç»´æŠ¤çª—å£
SET SESSION lock_wait_timeout = 300;  -- 5åˆ†é’Ÿè¶…æ—¶

-- 2. æ£€æŸ¥æ´»è·ƒè¿æ¥
SELECT COUNT(*) FROM information_schema.processlist 
WHERE command != 'Sleep';

-- 3. ç¡®è®¤æ— æ´»è·ƒäº‹åŠ¡åæ‰§è¡Œåˆ†åŒºæ“ä½œ
```

---

## 6. â• åˆ†åŒºæ·»åŠ å¤±è´¥å¤„ç†


### 6.1 åˆ†åŒºæ·»åŠ å¤±è´¥çš„å¸¸è§åŸå› 


**åŸå› 1ï¼šåˆ†åŒºå€¼èŒƒå›´é‡å **
```sql
-- âŒ é”™è¯¯ç¤ºä¾‹ï¼šåˆ†åŒºå€¼é‡å 
ALTER TABLE orders ADD PARTITION (
    PARTITION p202304 VALUES LESS THAN (202303)  -- é”™è¯¯ï¼šå°äºå·²æœ‰åˆ†åŒº
);

-- é”™è¯¯ä¿¡æ¯ï¼šVALUES LESS THAN value must be strictly increasing for each partition
```

**åŸå› 2ï¼šè¶…å‡ºæœ€å¤§åˆ†åŒºæ•°é™åˆ¶**
```sql
-- MySQLæœ€å¤§åˆ†åŒºæ•°ï¼š8192ä¸ª
SELECT COUNT(*) FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders';

-- å¦‚æœæ¥è¿‘8192ï¼Œéœ€è¦åˆå¹¶æˆ–åˆ é™¤æ—§åˆ†åŒº
```

**åŸå› 3ï¼šåˆ†åŒºè¡¨è¾¾å¼ä¸å…¼å®¹**
```sql
-- âŒ é”™è¯¯ï¼šåˆ†åŒºè¡¨è¾¾å¼ç±»å‹ä¸åŒ¹é…
ALTER TABLE orders ADD PARTITION (
    PARTITION p202304 VALUES LESS THAN ('2023-04-01')  -- åº”è¯¥ç”¨æ•°å­—
);
```

### 6.2 è¯Šæ–­åˆ†åŒºæ·»åŠ å¤±è´¥


**æ£€æŸ¥å½“å‰åˆ†åŒºå®šä¹‰**
```sql
-- æŸ¥çœ‹åˆ†åŒºè¡¨ç»“æ„
SHOW CREATE TABLE orders;

-- æŸ¥çœ‹åˆ†åŒºè¾¹ç•Œå€¼
SELECT 
    PARTITION_NAME,
    PARTITION_EXPRESSION,
    PARTITION_DESCRIPTION
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders'
ORDER BY PARTITION_ORDINAL_POSITION;
```

**éªŒè¯æ–°åˆ†åŒºå®šä¹‰**
```sql
-- ç¡®è®¤æœ€å¤§åˆ†åŒºå€¼
SELECT MAX(PARTITION_DESCRIPTION) 
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders';

-- æ–°åˆ†åŒºå€¼å¿…é¡»å¤§äºè¿™ä¸ªæœ€å¤§å€¼
```

### 6.3 ä¿®å¤åˆ†åŒºæ·»åŠ å¤±è´¥


**ä¿®å¤æ–¹æ¡ˆ1ï¼šè°ƒæ•´åˆ†åŒºå€¼**
```sql
-- æŸ¥çœ‹å½“å‰æœ€å¤§åˆ†åŒºå€¼
-- å‡è®¾æœ€å¤§å€¼æ˜¯202303

-- æ­£ç¡®æ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders ADD PARTITION (
    PARTITION p202304 VALUES LESS THAN (202305)  -- æ­£ç¡®ï¼šå¤§äºæœ€å¤§å€¼
);
```

**ä¿®å¤æ–¹æ¡ˆ2ï¼šé‡ç»„ç°æœ‰åˆ†åŒº**
```sql
-- å¦‚æœéœ€è¦åœ¨ä¸­é—´æ’å…¥åˆ†åŒºï¼Œéœ€è¦é‡ç»„
ALTER TABLE orders REORGANIZE PARTITION p202303 INTO (
    PARTITION p202303 VALUES LESS THAN (202304),
    PARTITION p202304 VALUES LESS THAN (202305)
);
```

**ä¿®å¤æ–¹æ¡ˆ3ï¼šæ¸…ç†æ—§åˆ†åŒºåæ·»åŠ **
```sql
-- 1. å¤‡ä»½è¦åˆ é™¤çš„åˆ†åŒºæ•°æ®
CREATE TABLE orders_backup_p202301 AS 
SELECT * FROM orders PARTITION(p202301);

-- 2. åˆ é™¤æ—§åˆ†åŒº
ALTER TABLE orders DROP PARTITION p202301;

-- 3. æ·»åŠ æ–°åˆ†åŒº
ALTER TABLE orders ADD PARTITION (
    PARTITION p202304 VALUES LESS THAN (202305)
);
```

### 6.4 åˆ†åŒºæ·»åŠ çš„æœ€ä½³å®è·µ


**è‡ªåŠ¨åŒ–åˆ†åŒºç®¡ç†**
```sql
-- åˆ›å»ºå­˜å‚¨è¿‡ç¨‹è‡ªåŠ¨æ·»åŠ åˆ†åŒº
DELIMITER //
CREATE PROCEDURE AddMonthlyPartition(IN table_name VARCHAR(64))
BEGIN
    DECLARE next_month INT;
    DECLARE partition_name VARCHAR(64);
    
    -- è®¡ç®—ä¸‹ä¸ªæœˆçš„åˆ†åŒºå€¼
    SET next_month = (YEAR(CURDATE()) * 100) + MONTH(CURDATE()) + 1;
    SET partition_name = CONCAT('p', next_month);
    
    -- æ·»åŠ åˆ†åŒº
    SET @sql = CONCAT('ALTER TABLE ', table_name, 
                     ' ADD PARTITION (PARTITION ', partition_name,
                     ' VALUES LESS THAN (', next_month + 1, '))');
    PREPARE stmt FROM @sql;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;
END //
DELIMITER ;

-- ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹
CALL AddMonthlyPartition('orders');
```

---

## 7. ğŸ“ˆ åˆ†åŒºç»Ÿè®¡ä¿¡æ¯é”™è¯¯


### 7.1 åˆ†åŒºç»Ÿè®¡ä¿¡æ¯çš„ä½œç”¨


**ç»Ÿè®¡ä¿¡æ¯å°±åƒå•†å“æ ‡ç­¾**ï¼Œå‘Šè¯‰MySQLæ¯ä¸ªåˆ†åŒºé‡Œæœ‰å¤šå°‘æ•°æ®ï¼Œå¸®åŠ©é€‰æ‹©æœ€ä½³æŸ¥è¯¢è®¡åˆ’ã€‚

```
åˆ†åŒºç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ†åŒºA           â”‚
â”‚ - è¡Œæ•°: 100ä¸‡   â”‚  â† è¿™äº›ä¿¡æ¯å¸®åŠ©MySQL
â”‚ - ç´¢å¼•ä¿¡æ¯      â”‚    å†³å®šå¦‚ä½•æŸ¥è¯¢
â”‚ - æ•°æ®åˆ†å¸ƒ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 ç»Ÿè®¡ä¿¡æ¯é”™è¯¯çš„è¡¨ç°


**æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯**
```sql
-- æŸ¥çœ‹å„åˆ†åŒºç»Ÿè®¡ä¿¡æ¯
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    AVG_ROW_LENGTH,
    DATA_LENGTH,
    INDEX_LENGTH,
    UPDATE_TIME
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders';
```

**å‘ç°é—®é¢˜çš„æ ‡å¿—**
```sql
-- ç»Ÿè®¡è¡Œæ•°ä¸å®é™…è¡Œæ•°å·®å¼‚å¾ˆå¤§
SELECT 
    PARTITION_NAME,
    TABLE_ROWS AS 'Stat_Rows',
    (SELECT COUNT(*) FROM orders PARTITION(p202301)) AS 'Actual_Rows'
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders' AND PARTITION_NAME = 'p202301';

-- å¦‚æœå·®å¼‚è¶…è¿‡20%ï¼Œè¯´æ˜ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®
```

### 7.3 æ›´æ–°åˆ†åŒºç»Ÿè®¡ä¿¡æ¯


**æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯**
```sql
-- æ›´æ–°æ•´ä¸ªè¡¨çš„ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE orders;

-- æ›´æ–°ç‰¹å®šåˆ†åŒºçš„ç»Ÿè®¡ä¿¡æ¯
ALTER TABLE orders ANALYZE PARTITION p202301;

-- æ‰¹é‡æ›´æ–°å¤šä¸ªåˆ†åŒº
ALTER TABLE orders ANALYZE PARTITION p202301, p202302, p202303;
```

**è‡ªåŠ¨æ›´æ–°é…ç½®**
```sql
-- æŸ¥çœ‹è‡ªåŠ¨ç»Ÿè®¡ä¿¡æ¯é…ç½®
SHOW VARIABLES LIKE 'innodb_stats%';

-- è®¾ç½®è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
SET GLOBAL innodb_stats_auto_recalc = ON;
SET GLOBAL innodb_stats_persistent = ON;
```

### 7.4 ç»Ÿè®¡ä¿¡æ¯ä¼˜åŒ–ç­–ç•¥


**å®šæœŸç»´æŠ¤è®¡åˆ’**
```sql
-- åˆ›å»ºå®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯çš„äº‹ä»¶
CREATE EVENT update_partition_stats
ON SCHEDULE EVERY 1 DAY
STARTS '2023-01-01 02:00:00'
DO
BEGIN
    -- æ›´æ–°ä¸»è¦åˆ†åŒºè¡¨çš„ç»Ÿè®¡ä¿¡æ¯
    ANALYZE TABLE orders;
    ANALYZE TABLE order_items;
    ANALYZE TABLE customers;
END;

-- å¯ç”¨äº‹ä»¶è°ƒåº¦å™¨
SET GLOBAL event_scheduler = ON;
```

---

## 8. ğŸš€ åˆ†åŒºæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–


### 8.1 åˆ†åŒºæŸ¥è¯¢æ€§èƒ½é—®é¢˜è¯Šæ–­


**è¯†åˆ«æ€§èƒ½é—®é¢˜**
```sql
-- å¼€å¯æŸ¥è¯¢æ—¥å¿—åˆ†ææ…¢æŸ¥è¯¢
SET GLOBAL slow_query_log = ON;
SET GLOBAL long_query_time = 1;  -- 1ç§’ä»¥ä¸Šçš„æŸ¥è¯¢

-- æŸ¥çœ‹åˆ†åŒºæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’
EXPLAIN PARTITIONS 
SELECT * FROM orders 
WHERE order_date BETWEEN '2023-01-01' AND '2023-01-31';
```

**æ€§èƒ½åŸºå‡†æµ‹è¯•**
```sql
-- æµ‹è¯•åˆ†åŒºè¡¨æŸ¥è¯¢æ€§èƒ½
SELECT SQL_NO_CACHE COUNT(*) 
FROM orders 
WHERE order_date = '2023-01-15';

-- å¯¹æ¯”éåˆ†åŒºè¡¨æ€§èƒ½
-- è®°å½•æ‰§è¡Œæ—¶é—´å’Œèµ„æºä½¿ç”¨æƒ…å†µ
```

### 8.2 åˆ†åŒºæŸ¥è¯¢ä¼˜åŒ–æŠ€å·§


**ä¼˜åŒ–1ï¼šç¡®ä¿åˆ†åŒºå‰ªæç”Ÿæ•ˆ**
```sql
-- âŒ æ€§èƒ½å·®ï¼šæ‰«ææ‰€æœ‰åˆ†åŒº
SELECT * FROM orders WHERE customer_id = 123;

-- âœ… æ€§èƒ½å¥½ï¼šåªæ‰«æç›¸å…³åˆ†åŒº
SELECT * FROM orders 
WHERE order_date >= '2023-01-01' 
  AND order_date <= '2023-01-31'
  AND customer_id = 123;
```

**ä¼˜åŒ–2ï¼šåˆç†ä½¿ç”¨åˆ†åŒºç´¢å¼•**
```sql
-- åœ¨æ¯ä¸ªåˆ†åŒºä¸Šåˆ›å»ºåˆé€‚çš„ç´¢å¼•
ALTER TABLE orders ADD INDEX idx_customer_date (customer_id, order_date);

-- æŸ¥çœ‹åˆ†åŒºç´¢å¼•ä½¿ç”¨æƒ…å†µ
EXPLAIN PARTITIONS 
SELECT * FROM orders 
WHERE customer_id = 123 AND order_date = '2023-01-15';
```

**ä¼˜åŒ–3ï¼šå¹¶è¡ŒæŸ¥è¯¢åˆ†åŒº**
```sql
-- å¯¹äºèšåˆæŸ¥è¯¢ï¼Œå¯ä»¥å¹¶è¡Œå¤„ç†ä¸åŒåˆ†åŒº
-- ç„¶ååˆå¹¶ç»“æœ

-- åˆ†åŒº1çš„æŸ¥è¯¢
SELECT COUNT(*), SUM(amount) FROM orders PARTITION(p202301);

-- åˆ†åŒº2çš„æŸ¥è¯¢
SELECT COUNT(*), SUM(amount) FROM orders PARTITION(p202302);

-- åº”ç”¨å±‚åˆå¹¶ç»“æœ
```

### 8.3 åˆ†åŒºè¡¨JOINä¼˜åŒ–


**åˆ†åŒºè¡¨ä¸æ™®é€šè¡¨JOIN**
```sql
-- ç¡®ä¿JOINæ¡ä»¶åŒ…å«åˆ†åŒºé”®
SELECT o.*, c.customer_name
FROM orders o
JOIN customers c ON o.customer_id = c.id
WHERE o.order_date >= '2023-01-01'  -- åˆ†åŒºå‰ªææ¡ä»¶
  AND o.order_date <= '2023-01-31';
```

**ä¸¤ä¸ªåˆ†åŒºè¡¨ä¹‹é—´JOIN**
```sql
-- ç¡®ä¿ä¸¤ä¸ªè¡¨ä½¿ç”¨ç›¸åŒçš„åˆ†åŒºç­–ç•¥
-- è¿™æ ·å¯ä»¥å®ç°åˆ†åŒºçº§åˆ«çš„å¹¶è¡ŒJOIN

CREATE TABLE order_items (
    order_id INT,
    item_id INT,
    order_date DATE  -- ä¸ordersè¡¨ä½¿ç”¨ç›¸åŒçš„åˆ†åŒºé”®
) 
PARTITION BY RANGE (YEAR(order_date)*100 + MONTH(order_date)) (
    -- ä¸ordersè¡¨ç›¸åŒçš„åˆ†åŒºå®šä¹‰
    PARTITION p202301 VALUES LESS THAN (202302),
    PARTITION p202302 VALUES LESS THAN (202303)
);
```

---

## 9. ğŸ”§ åˆ†åŒºè¡¨ç»´æŠ¤æ•…éšœ


### 9.1 å¸¸è§ç»´æŠ¤æ•…éšœç±»å‹


**ç»´æŠ¤æ“ä½œå¤±è´¥**
```
å¸¸è§æ•…éšœï¼š
1. åˆ†åŒºåˆ é™¤å¤±è´¥    - DROP PARTITION hangä½
2. åˆ†åŒºé‡ç»„å¤±è´¥    - REORGANIZE PARTITIONå‡ºé”™
3. åˆ†åŒºåˆå¹¶å¤±è´¥    - æ•°æ®å†²çªæˆ–ç©ºé—´ä¸è¶³
4. ç´¢å¼•é‡å»ºå¤±è´¥    - åˆ†åŒºç´¢å¼•æŸå
```

### 9.2 åˆ†åŒºåˆ é™¤æ•…éšœå¤„ç†


**æ•…éšœç°è±¡ï¼šåˆ é™¤åˆ†åŒºhangä½**
```sql
-- æŸ¥çœ‹æ­£åœ¨æ‰§è¡Œçš„æ“ä½œ
SHOW PROCESSLIST;

-- æŸ¥çœ‹è¡¨é”çŠ¶æ€
SHOW OPEN TABLES WHERE In_use > 0;
```

**è§£å†³æ–¹æ¡ˆ**
```sql
-- 1. æ£€æŸ¥æ˜¯å¦æœ‰é•¿äº‹åŠ¡é˜»å¡
SELECT 
    trx_id,
    trx_started,
    trx_query,
    trx_mysql_thread_id
FROM information_schema.innodb_trx
WHERE trx_started < NOW() - INTERVAL 1 HOUR;

-- 2. æ€æ‰é˜»å¡çš„äº‹åŠ¡
KILL 12345;

-- 3. é‡æ–°å°è¯•åˆ é™¤åˆ†åŒº
ALTER TABLE orders DROP PARTITION p202301;
```

### 9.3 åˆ†åŒºé‡ç»„æ•…éšœå¤„ç†


**æ•…éšœç°è±¡ï¼šé‡ç»„æ“ä½œå¤±è´¥**
```sql
-- å…¸å‹é”™è¯¯ä¿¡æ¯
-- "Table is full" æˆ– "Disk full"
-- "Lock wait timeout exceeded"
```

**é¢„é˜²å’Œè§£å†³**
```sql
-- 1. æ£€æŸ¥ç£ç›˜ç©ºé—´
SHOW VARIABLES LIKE 'datadir';
-- ç³»ç»Ÿå‘½ä»¤æ£€æŸ¥ç£ç›˜ç©ºé—´ï¼šdf -h

-- 2. å¢åŠ é”ç­‰å¾…è¶…æ—¶æ—¶é—´
SET SESSION lock_wait_timeout = 3600;  -- 1å°æ—¶

-- 3. åˆ†æ­¥éª¤é‡ç»„ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§é‡ç»„å¤§é‡æ•°æ®
ALTER TABLE orders REORGANIZE PARTITION p202301 INTO (
    PARTITION p202301_1 VALUES LESS THAN (202301.5),
    PARTITION p202301_2 VALUES LESS THAN (202302)
);
```

### 9.4 åˆ†åŒºç»´æŠ¤æœ€ä½³å®è·µ


**ç»´æŠ¤æ—¶é—´çª—å£è§„åˆ’**
```sql
-- 1. é€‰æ‹©ä¸šåŠ¡ä½å³°æœŸ
-- 2. æå‰é€šçŸ¥ç›¸å…³äººå‘˜
-- 3. å‡†å¤‡å›æ»šæ–¹æ¡ˆ

-- ç»´æŠ¤å‰æ£€æŸ¥æ¸…å•
SELECT 
    TABLE_NAME,
    PARTITION_NAME,
    TABLE_ROWS,
    ROUND(DATA_LENGTH/1024/1024/1024, 2) AS 'Size_GB'
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders'
ORDER BY TABLE_ROWS DESC;
```

**è‡ªåŠ¨åŒ–ç»´æŠ¤è„šæœ¬**
```bash
#!/bin/bash
# åˆ†åŒºç»´æŠ¤è„šæœ¬ç¤ºä¾‹

# 1. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
load_avg=$(uptime | awk '{print $10}' | sed 's/,//')
if (( $(echo "$load_avg > 2.0" | bc -l) )); then
    echo "ç³»ç»Ÿè´Ÿè½½è¿‡é«˜ï¼Œè·³è¿‡ç»´æŠ¤"
    exit 1
fi

# 2. æ‰§è¡Œåˆ†åŒºç»´æŠ¤
mysql -u root -p database_name << EOF
    -- åˆ é™¤3ä¸ªæœˆå‰çš„åˆ†åŒº
    ALTER TABLE orders DROP PARTITION p202301;
    
    -- æ·»åŠ ä¸‹ä¸ªæœˆçš„åˆ†åŒº
    CALL AddMonthlyPartition('orders');
EOF

echo "åˆ†åŒºç»´æŠ¤å®Œæˆ"
```

---

## 10. ğŸ”„ åˆ†åŒºç­–ç•¥è°ƒæ•´æŒ‡å—


### 10.1 ä½•æ—¶éœ€è¦è°ƒæ•´åˆ†åŒºç­–ç•¥


**æ€§èƒ½æŒ‡æ ‡æ¶åŒ–**
```sql
-- ç›‘æ§æŸ¥è¯¢æ€§èƒ½è¶‹åŠ¿
SELECT 
    DATE(start_time) as query_date,
    AVG(query_time) as avg_query_time,
    COUNT(*) as query_count
FROM mysql.slow_log 
WHERE sql_text LIKE '%orders%'
GROUP BY DATE(start_time)
ORDER BY query_date DESC;
```

**æ•°æ®å¢é•¿æ¨¡å¼å˜åŒ–**
```sql
-- åˆ†ææ•°æ®å¢é•¿è¶‹åŠ¿
SELECT 
    PARTITION_NAME,
    TABLE_ROWS,
    ROUND(TABLE_ROWS * 100.0 / SUM(TABLE_ROWS) OVER(), 2) AS percentage
FROM information_schema.PARTITIONS 
WHERE TABLE_NAME = 'orders'
ORDER BY TABLE_ROWS DESC;
```

### 10.2 åˆ†åŒºç­–ç•¥è°ƒæ•´æ–¹æ¡ˆ


**ä»æŒ‰æœˆæ”¹ä¸ºæŒ‰å‘¨åˆ†åŒº**
```sql
-- é€‚ç”¨äºæ•°æ®å¢é•¿å¾ˆå¿«çš„æƒ…å†µ

-- 1. åˆ›å»ºæ–°çš„åˆ†åŒºè¡¨
CREATE TABLE orders_weekly (
    id INT AUTO_INCREMENT,
    order_date DATE,
    customer_id INT,
    amount DECIMAL(10,2),
    PRIMARY KEY (id, order_date)
) 
PARTITION BY RANGE (TO_DAYS(order_date)) (
    PARTITION p2023w01 VALUES LESS THAN (TO_DAYS('2023-01-08')),
    PARTITION p2023w02 VALUES LESS THAN (TO_DAYS('2023-01-15')),
    PARTITION p2023w03 VALUES LESS THAN (TO_DAYS('2023-01-22'))
);

-- 2. è¿ç§»æ•°æ®
INSERT INTO orders_weekly SELECT * FROM orders;

-- 3. åˆ‡æ¢è¡¨åï¼ˆåœ¨ç»´æŠ¤çª—å£å†…ï¼‰
RENAME TABLE orders TO orders_old, orders_weekly TO orders;
```

**ä»RANGEæ”¹ä¸ºHASHåˆ†åŒº**
```sql
-- é€‚ç”¨äºæŒ‰æ—¶é—´æŸ¥è¯¢ä¸é¢‘ç¹ï¼Œä½†æ•°æ®åˆ†å¸ƒä¸å‡çš„æƒ…å†µ

CREATE TABLE orders_hash (
    id INT AUTO_INCREMENT,
    order_date DATE,
    customer_id INT,
    amount DECIMAL(10,2),
    PRIMARY KEY (id, customer_id)  -- æ³¨æ„ï¼šä¸»é”®å¿…é¡»åŒ…å«åˆ†åŒºé”®
) 
PARTITION BY HASH(customer_id) 
PARTITIONS 8;  -- 8ä¸ªåˆ†åŒºï¼Œæ•°æ®åˆ†å¸ƒæ›´å‡åŒ€
```

### 10.3 åˆ†åŒºç­–ç•¥é€‰æ‹©æŒ‡å—


**æŒ‰ä¸šåŠ¡è®¿é—®æ¨¡å¼é€‰æ‹©**
```
æŸ¥è¯¢æ¨¡å¼                    æ¨èåˆ†åŒºç­–ç•¥
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢              RANGE(æ—¥æœŸ)
æŒ‰ç”¨æˆ·IDæŸ¥è¯¢                HASH(user_id)
æŒ‰åœ°åŒºæŸ¥è¯¢                  LIST(region)
æ··åˆæŸ¥è¯¢æ¨¡å¼                å¤åˆåˆ†åŒº
æ•°æ®å½’æ¡£éœ€æ±‚                RANGE(æ—¥æœŸ)
```

**åˆ†åŒºæ•°é‡è§„åˆ’**
```sql
-- åˆ†åŒºæ•°é‡å»ºè®®ï¼š
-- 1. å•ä¸ªåˆ†åŒºæ•°æ®é‡ï¼š100ä¸‡-1000ä¸‡è¡Œ
-- 2. æ€»åˆ†åŒºæ•°ï¼šä¸è¶…è¿‡100ä¸ªï¼ˆä¾¿äºç®¡ç†ï¼‰
-- 3. æ¯ä¸ªåˆ†åŒºå¤§å°ï¼š1GB-10GB

-- è®¡ç®—å»ºè®®åˆ†åŒºæ•°
SELECT 
    CEIL(COUNT(*) / 5000000) AS suggested_partitions,  -- æ¯åˆ†åŒº500ä¸‡è¡Œ
    COUNT(*) as total_rows,
    ROUND(COUNT(*) / 5000000, 2) as partition_size_ratio
FROM orders;
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 åˆ†åŒºè¡¨æ•…éšœå¤„ç†è¦ç‚¹


**ğŸ”¸ æ•…éšœè¯Šæ–­ä¸‰æ­¥æ³•**
```
1. ç¡®å®šæ•…éšœç±»å‹ - æŸåã€é”ç­‰å¾…ã€æ€§èƒ½é—®é¢˜
2. å®šä½é—®é¢˜èŒƒå›´ - æ•´è¡¨è¿˜æ˜¯ç‰¹å®šåˆ†åŒº
3. é€‰æ‹©ä¿®å¤æ–¹æ¡ˆ - ä¿®å¤ã€é‡å»ºã€è°ƒæ•´ç­–ç•¥
```

**ğŸ”¸ å¸¸ç”¨è¯Šæ–­å‘½ä»¤**
```sql
-- æ£€æŸ¥åˆ†åŒºçŠ¶æ€
CHECK TABLE table_name;
SHOW TABLE STATUS;

-- æŸ¥çœ‹åˆ†åŒºä¿¡æ¯
SELECT * FROM information_schema.PARTITIONS;

-- åˆ†ææ‰§è¡Œè®¡åˆ’
EXPLAIN PARTITIONS SELECT ...;
```

### 11.2 æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹


**ğŸ”¹ ç¡®ä¿åˆ†åŒºå‰ªæç”Ÿæ•ˆ**
- æŸ¥è¯¢æ¡ä»¶å¿…é¡»åŒ…å«åˆ†åŒºé”®
- é¿å…å¯¹åˆ†åŒºé”®ä½¿ç”¨å‡½æ•°
- ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹

**ğŸ”¹ åˆç†çš„åˆ†åŒºç­–ç•¥**
- æ ¹æ®æŸ¥è¯¢æ¨¡å¼é€‰æ‹©åˆ†åŒºç±»å‹
- æ§åˆ¶åˆ†åŒºæ•°é‡å’Œå¤§å°
- å®šæœŸè¯„ä¼°å’Œè°ƒæ•´

### 11.3 ç»´æŠ¤æœ€ä½³å®è·µ


**ğŸ”§ é¢„é˜²æ€§ç»´æŠ¤**
```
å®šæœŸæ£€æŸ¥ï¼š
- åˆ†åŒºæ•°æ®åˆ†å¸ƒæ˜¯å¦å‡è¡¡
- ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦å‡†ç¡®
- æŸ¥è¯¢æ€§èƒ½æ˜¯å¦ä¸‹é™

è‡ªåŠ¨åŒ–ç®¡ç†ï¼š
- è‡ªåŠ¨æ·»åŠ æ–°åˆ†åŒº
- è‡ªåŠ¨æ¸…ç†å†å²åˆ†åŒº
- å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
```

**ğŸš¨ æ•…éšœåº”æ€¥å¤„ç†**
```
ç´§æ€¥æƒ…å†µå¤„ç†æ­¥éª¤ï¼š
1. ç«‹å³è¯„ä¼°å½±å“èŒƒå›´
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—å’Œç³»ç»ŸçŠ¶æ€
3. å°è¯•æœ€å°å½±å“çš„ä¿®å¤æ–¹æ¡ˆ
4. å¦‚æ— æ³•å¿«é€Ÿä¿®å¤ï¼Œè€ƒè™‘å›æ»š
5. ä¿®å¤åéªŒè¯æ•°æ®å®Œæ•´æ€§
```

### 11.4 åˆ†åŒºè¡¨ä½¿ç”¨å»ºè®®


**âœ… é€‚åˆä½¿ç”¨åˆ†åŒºè¡¨çš„åœºæ™¯**
- å¤§è¡¨ï¼ˆè¶…è¿‡100ä¸‡è¡Œï¼‰
- æœ‰æ˜ç¡®çš„æ•°æ®è®¿é—®æ¨¡å¼
- éœ€è¦æ•°æ®å½’æ¡£å’Œæ¸…ç†
- æŸ¥è¯¢ç»å¸¸æ¶‰åŠæ—¶é—´èŒƒå›´

**âŒ ä¸é€‚åˆåˆ†åŒºè¡¨çš„åœºæ™¯**
- å°è¡¨ï¼ˆå°‘äº100ä¸‡è¡Œï¼‰
- æ²¡æœ‰æ˜ç¡®çš„åˆ†åŒºé”®
- é¢‘ç¹çš„è·¨åˆ†åŒºJOINæ“ä½œ
- å¤§é‡éšæœºè®¿é—®æ¨¡å¼

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- åˆ†åŒºè¡¨å¥½å¤„å¤šï¼Œç»´æŠ¤æ•…éšœè¦é¢„é˜²
- è¯Šæ–­é—®é¢˜çœ‹æ—¥å¿—ï¼Œæ‰§è¡Œè®¡åˆ’è¦åˆ†æ  
- åˆ†åŒºå‰ªææ˜¯å…³é”®ï¼ŒæŸ¥è¯¢æ¡ä»¶è¦åŒ…å«
- æ•°æ®å‡è¡¡æ€§èƒ½å¥½ï¼Œå®šæœŸç»´æŠ¤ä¸å¯å°‘