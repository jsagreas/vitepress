---
title: 24ã€ç´¢å¼•æŸåæ•…éšœå¤„ç†
---
## ğŸ“š ç›®å½•

1. [ç´¢å¼•æŸååŸºç¡€è®¤çŸ¥](#1-ç´¢å¼•æŸååŸºç¡€è®¤çŸ¥)
2. [ç´¢å¼•ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•](#2-ç´¢å¼•ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•)
3. [ç´¢å¼•æŸåè¯Šæ–­åˆ†æ](#3-ç´¢å¼•æŸåè¯Šæ–­åˆ†æ)
4. [ç´¢å¼•é‡å»ºæ“ä½œè¯¦è§£](#4-ç´¢å¼•é‡å»ºæ“ä½œè¯¦è§£)
5. [ä¸åŒç±»å‹ç´¢å¼•æ•…éšœå¤„ç†](#5-ä¸åŒç±»å‹ç´¢å¼•æ•…éšœå¤„ç†)
6. [ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§ç­–ç•¥](#6-ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§ç­–ç•¥)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” ç´¢å¼•æŸååŸºç¡€è®¤çŸ¥


### 1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•æŸå


**ğŸ¯ é€šä¿—ç†è§£**ï¼š
ç´¢å¼•æŸåå°±åƒå›¾ä¹¦é¦†çš„ç›®å½•å†Œå‡ºäº†é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼š
```
æ­£å¸¸æƒ…å†µï¼š
å›¾ä¹¦ç›®å½• â†’ æŒ‡å‘æ­£ç¡®çš„ä¹¦æ¶ä½ç½® â†’ å¿«é€Ÿæ‰¾åˆ°ä¹¦

ç´¢å¼•æŸåï¼š
å›¾ä¹¦ç›®å½• â†’ æŒ‡å‘é”™è¯¯ä½ç½®æˆ–ç¼ºå¤± â†’ æ‰¾ä¸åˆ°ä¹¦æˆ–æ‰¾é”™ä¹¦
```

**ğŸ“‹ ä¸“ä¸šå®šä¹‰**ï¼š
ç´¢å¼•æŸåæ˜¯æŒ‡MySQLä¸­çš„ç´¢å¼•ç»“æ„ä¸å®é™…æ•°æ®ä¸ä¸€è‡´ï¼Œå¯¼è‡´æŸ¥è¯¢ç»“æœé”™è¯¯æˆ–æ€§èƒ½ä¸¥é‡ä¸‹é™çš„æ•…éšœã€‚

### 1.2 ç´¢å¼•æŸåçš„è¡¨ç°ç—‡çŠ¶


**ğŸš¨ ç”¨æˆ·èƒ½æ„Ÿå—åˆ°çš„é—®é¢˜**ï¼š
- æŸ¥è¯¢çªç„¶å˜å¾—éå¸¸æ…¢ï¼ˆåŸæœ¬1ç§’çš„æŸ¥è¯¢å˜æˆå‡ åˆ†é’Ÿï¼‰
- æŸ¥è¯¢ç»“æœä¸å®Œæ•´æˆ–é”™è¯¯
- æ•°æ®åº“è¿æ¥è¶…æ—¶
- åº”ç”¨ç¨‹åºé¢‘ç¹æŠ¥é”™

**ğŸ”§ æŠ€æœ¯å±‚é¢çš„ç—‡çŠ¶**ï¼š
```
æ€§èƒ½ç—‡çŠ¶ï¼š
â€¢ æŸ¥è¯¢æ‰§è¡Œæ—¶é—´å¼‚å¸¸å¢é•¿
â€¢ CPUä½¿ç”¨ç‡çªç„¶é£™å‡
â€¢ ç£ç›˜IOå¤§å¹…å¢åŠ 
â€¢ å†…å­˜ä½¿ç”¨å¼‚å¸¸

æ•°æ®ç—‡çŠ¶ï¼š
â€¢ SELECT COUNT(*) ç»“æœä¸ä¸€è‡´
â€¢ åŒæ ·çš„æŸ¥è¯¢è¿”å›ä¸åŒç»“æœ
â€¢ å”¯ä¸€çº¦æŸæ£€æŸ¥å¤±æ•ˆ
â€¢ å¤–é”®å…³ç³»éªŒè¯é”™è¯¯
```

### 1.3 ç´¢å¼•æŸåçš„å¸¸è§åŸå› 


**ğŸ’¾ ç¡¬ä»¶å±‚é¢åŸå› **ï¼š
```
ç£ç›˜æ•…éšœï¼š
â€¢ ç£ç›˜åé“å¯¼è‡´æ•°æ®å†™å…¥é”™è¯¯
â€¢ ç£ç›˜ç©ºé—´ä¸è¶³å¯¼è‡´å†™å…¥ä¸­æ–­
â€¢ ç¡¬ä»¶æ•…éšœå¯¼è‡´æ•°æ®æŸå

å†…å­˜é—®é¢˜ï¼š
â€¢ å†…å­˜æ•…éšœå¯¼è‡´ç´¢å¼•ç¼“å­˜é”™è¯¯
â€¢ å†…å­˜ä¸è¶³å¯¼è‡´ç´¢å¼•åŠ è½½å¤±è´¥
```

**âš¡ è½¯ä»¶å±‚é¢åŸå› **ï¼š
```
å¼‚å¸¸å…³é—­ï¼š
â€¢ çªç„¶æ–­ç”µæˆ–å¼ºåˆ¶å…³é—­æ•°æ®åº“
â€¢ æ“ä½œç³»ç»Ÿå´©æºƒ
â€¢ MySQLè¿›ç¨‹è¢«å¼ºåˆ¶ç»ˆæ­¢

å¹¶å‘é—®é¢˜ï¼š
â€¢ å¤§é‡å¹¶å‘å†™å…¥æ“ä½œ
â€¢ é•¿äº‹åŠ¡é˜»å¡ç´¢å¼•ç»´æŠ¤
â€¢ æ­»é”å¯¼è‡´ç´¢å¼•æ›´æ–°å¤±è´¥
```

---

## 2. ğŸ” ç´¢å¼•ä¸€è‡´æ€§æ£€æŸ¥æ–¹æ³•


### 2.1 åŸºç¡€æ£€æŸ¥å‘½ä»¤


**ğŸ” CHECK TABLEå‘½ä»¤è¯¦è§£**ï¼š

è¿™æ˜¯æœ€å¸¸ç”¨çš„ç´¢å¼•æ£€æŸ¥å·¥å…·ï¼Œå°±åƒç»™å›¾ä¹¦é¦†åšå…¨é¢ä½“æ£€ï¼š

```sql
-- åŸºç¡€æ£€æŸ¥ï¼šå¿«é€Ÿæ£€æŸ¥è¡¨å’Œç´¢å¼•æ˜¯å¦æœ‰æ˜æ˜¾é—®é¢˜
CHECK TABLE user_table;

-- ä¸­ç­‰æ£€æŸ¥ï¼šæ›´æ·±å…¥çš„æ£€æŸ¥ï¼Œè€—æ—¶è¾ƒé•¿
CHECK TABLE user_table MEDIUM;

-- æ‰©å±•æ£€æŸ¥ï¼šæœ€å…¨é¢çš„æ£€æŸ¥ï¼Œé€‚åˆæ•…éšœæ’æŸ¥
CHECK TABLE user_table EXTENDED;
```

**ğŸ“Š æ£€æŸ¥ç»“æœè§£è¯»**ï¼š
```
æ­£å¸¸ç»“æœï¼š
Table: mydb.user_table
Op: check
Msg_type: status  
Msg_text: OK

å¼‚å¸¸ç»“æœï¼š
Table: mydb.user_table
Op: check
Msg_type: error
Msg_text: Corrupt index
```

### 2.2 æ·±åº¦æ£€æŸ¥æ–¹æ³•


**ğŸ› ï¸ ANALYZE TABLEå‘½ä»¤**ï¼š

è¿™ä¸ªå‘½ä»¤é‡æ–°ç»Ÿè®¡ç´¢å¼•ä¿¡æ¯ï¼Œå°±åƒé‡æ–°æ•´ç†å›¾ä¹¦é¦†ç›®å½•ï¼š

```sql
-- é‡æ–°ç»Ÿè®¡ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE user_table;

-- æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦å‡†ç¡®
SELECT 
    table_name,
    index_name,
    cardinality,
    last_update
FROM information_schema.STATISTICS 
WHERE table_schema = 'mydb' 
  AND table_name = 'user_table';
```

**ğŸ”¬ ç´¢å¼•ä½¿ç”¨æƒ…å†µæ£€æŸ¥**ï¼š
```sql
-- æŸ¥çœ‹ç´¢å¼•æ˜¯å¦è¢«æ­£å¸¸ä½¿ç”¨
EXPLAIN SELECT * FROM user_table WHERE user_id = 12345;

-- æ£€æŸ¥ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
SHOW INDEX FROM user_table;
```

### 2.3 è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬


**ğŸ“‹ æ‰¹é‡è¡¨æ£€æŸ¥**ï¼š
```sql
-- æ£€æŸ¥æ•°æ®åº“ä¸­æ‰€æœ‰è¡¨
SELECT 
    CONCAT('CHECK TABLE ', table_schema, '.', table_name, ';') as check_sql
FROM information_schema.tables 
WHERE table_schema = 'mydb' 
  AND table_type = 'BASE TABLE';
```

---

## 3. ğŸ” ç´¢å¼•æŸåè¯Šæ–­åˆ†æ


### 3.1 è¯Šæ–­æµç¨‹æ¡†æ¶


**ğŸ¯ ç³»ç»ŸåŒ–è¯Šæ–­æ­¥éª¤**ï¼š
```
Step 1: ç—‡çŠ¶ç¡®è®¤ â†’ ç¡®å®šå…·ä½“è¡¨ç°
Step 2: å½±å“èŒƒå›´ â†’ ç¡®å®šå—å½±å“çš„è¡¨å’Œç´¢å¼•  
Step 3: åŸå› åˆ†æ â†’ æ‰¾å‡ºæŸåæ ¹æœ¬åŸå› 
Step 4: ä¿®å¤æ–¹æ¡ˆ â†’ åˆ¶å®šé’ˆå¯¹æ€§ä¿®å¤ç­–ç•¥
```

### 3.2 ç—‡çŠ¶åˆ†æä¸å®šä½


**ğŸš¨ æ€§èƒ½å¼‚å¸¸è¯Šæ–­**ï¼š

å½“æŸ¥è¯¢çªç„¶å˜æ…¢æ—¶ï¼Œè¿™æ ·åˆ†æï¼š

```sql
-- 1. æ£€æŸ¥å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ…¢æŸ¥è¯¢
SHOW PROCESSLIST;

-- 2. æŸ¥çœ‹æœ€è¿‘çš„æ…¢æŸ¥è¯¢æ—¥å¿—
SELECT 
    sql_text,
    exec_count,
    avg_timer_wait/1000000000 as avg_time_sec
FROM performance_schema.events_statements_summary_by_digest 
WHERE avg_timer_wait > 1000000000  -- è¶…è¿‡1ç§’çš„æŸ¥è¯¢
ORDER BY avg_timer_wait DESC;

-- 3. æ£€æŸ¥ç‰¹å®šè¡¨çš„ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    object_schema,
    object_name,
    index_name,
    count_read,
    count_insert,
    count_update,
    count_delete
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'mydb' AND object_name = 'user_table';
```

### 3.3 é”™è¯¯æ—¥å¿—åˆ†æ


**ğŸ“œ MySQLé”™è¯¯æ—¥å¿—å…³é”®ä¿¡æ¯**ï¼š

è¿™äº›æ—¥å¿—ä¿¡æ¯æç¤ºç´¢å¼•é—®é¢˜ï¼š
```
å…³é”®é”™è¯¯ä¿¡æ¯ï¼š
â€¢ "Incorrect key file for table"
â€¢ "Index is corrupt"  
â€¢ "Table crashed and needs repair"
â€¢ "Found wrong number of deleted records"
â€¢ "Found wrong record count"
```

**ğŸ” æ—¥å¿—åˆ†æå®ä¾‹**ï¼š
```bash
# æŸ¥çœ‹MySQLé”™è¯¯æ—¥å¿—ä¸­çš„ç´¢å¼•ç›¸å…³é”™è¯¯
grep -i "corrupt\|crash\|repair\|key file" /var/log/mysql/error.log

# æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯ä¿¡æ¯
tail -100 /var/log/mysql/error.log | grep -i "index\|corrupt"
```

---

## 4. ğŸ”§ ç´¢å¼•é‡å»ºæ“ä½œè¯¦è§£


### 4.1 ç´¢å¼•é‡å»ºåŸºæœ¬æ–¹æ³•


**âš¡ å¿«é€Ÿé‡å»ºæ–¹æ³•**ï¼š

```sql
-- æ–¹æ³•1: åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•ï¼ˆæ¨èï¼‰
-- å…ˆè®°å½•åŸç´¢å¼•å®šä¹‰
SHOW CREATE TABLE user_table;

-- åˆ é™¤æŸåçš„ç´¢å¼•
ALTER TABLE user_table DROP INDEX idx_username;

-- é‡æ–°åˆ›å»ºç´¢å¼•
ALTER TABLE user_table ADD INDEX idx_username (username);
```

**ğŸ”„ åœ¨çº¿é‡å»ºæ–¹æ³•**ï¼š
```sql
-- ä½¿ç”¨ALGORITHM=INPLACEè¿›è¡Œåœ¨çº¿é‡å»º
ALTER TABLE user_table 
DROP INDEX idx_username,
ADD INDEX idx_username (username),
ALGORITHM=INPLACE, LOCK=NONE;
```

### 4.2 ä¸»é”®ç´¢å¼•é‡å»º


**ğŸ”‘ ä¸»é”®ç´¢å¼•ç‰¹æ®Šå¤„ç†**ï¼š

ä¸»é”®ç´¢å¼•æŸåæ¯”è¾ƒä¸¥é‡ï¼Œéœ€è¦ç‰¹åˆ«å°å¿ƒï¼š

```sql
-- 1. é¦–å…ˆå¤‡ä»½æ•°æ®
CREATE TABLE user_table_backup AS SELECT * FROM user_table;

-- 2. æ£€æŸ¥ä¸»é”®å®šä¹‰
SHOW CREATE TABLE user_table;

-- 3. é‡å»ºä¸»é”®ï¼ˆæ³¨æ„ï¼šè¿™ä¼šé‡å»ºæ•´ä¸ªè¡¨ï¼‰
ALTER TABLE user_table DROP PRIMARY KEY, ADD PRIMARY KEY (user_id);
```

**âš ï¸ ä¸»é”®é‡å»ºæ³¨æ„äº‹é¡¹**ï¼š
```
é‡è¦æé†’ï¼š
â€¢ ä¸»é”®é‡å»ºä¼šé”è¡¨ï¼Œå½±å“ä¸šåŠ¡
â€¢ è‡ªå¢ä¸»é”®éœ€è¦ä¿æŒè¿ç»­æ€§
â€¢ å¤–é”®å…³è”éœ€è¦æš‚æ—¶åˆ é™¤
â€¢ æ“ä½œå‰å¿…é¡»åšå®Œæ•´å¤‡ä»½
```

### 4.3 æ‰¹é‡ç´¢å¼•é‡å»º


**ğŸ“Š æ•´è¡¨ç´¢å¼•é‡å»º**ï¼š
```sql
-- è·å–è¡¨çš„æ‰€æœ‰ç´¢å¼•ä¿¡æ¯
SELECT 
    INDEX_NAME,
    COLUMN_NAME,
    NON_UNIQUE,
    INDEX_TYPE
FROM information_schema.STATISTICS 
WHERE TABLE_SCHEMA = 'mydb' 
  AND TABLE_NAME = 'user_table'
  AND INDEX_NAME != 'PRIMARY'
ORDER BY INDEX_NAME, SEQ_IN_INDEX;

-- ä½¿ç”¨OPTIMIZE TABLEé‡å»ºæ‰€æœ‰ç´¢å¼•
OPTIMIZE TABLE user_table;
```

---

## 5. ğŸ› ï¸ ä¸åŒç±»å‹ç´¢å¼•æ•…éšœå¤„ç†


### 5.1 äºŒçº§ç´¢å¼•æŸåå¤„ç†


**ğŸ“‹ äºŒçº§ç´¢å¼•é—®é¢˜ç‰¹å¾**ï¼š

äºŒçº§ç´¢å¼•æŸåé€šå¸¸è¡¨ç°ä¸ºï¼š
- æŸ¥è¯¢èƒ½è¿”å›ç»“æœï¼Œä½†å¯èƒ½ä¸å®Œæ•´
- ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢å˜æ…¢
- ç´¢å¼•é€‰æ‹©å™¨é€‰æ‹©é”™è¯¯çš„æ‰§è¡Œè®¡åˆ’

**ğŸ”§ å¤„ç†æ–¹æ³•**ï¼š
```sql
-- 1. ç¡®è®¤é—®é¢˜ç´¢å¼•
EXPLAIN SELECT * FROM user_table WHERE username = 'john';

-- 2. å¼ºåˆ¶ä¸ä½¿ç”¨è¯¥ç´¢å¼•ï¼Œå¯¹æ¯”æ€§èƒ½
EXPLAIN SELECT * FROM user_table IGNORE INDEX(idx_username) 
WHERE username = 'john';

-- 3. é‡å»ºæŸåçš„äºŒçº§ç´¢å¼•
ALTER TABLE user_table DROP INDEX idx_username;
ALTER TABLE user_table ADD INDEX idx_username (username);

-- 4. éªŒè¯ä¿®å¤æ•ˆæœ
EXPLAIN SELECT * FROM user_table WHERE username = 'john';
```

### 5.2 å¤åˆç´¢å¼•æŸåå¤„ç†


**ğŸ”— å¤åˆç´¢å¼•ç‰¹æ®Šæ€§**ï¼š

å¤åˆç´¢å¼•æŸåå¯èƒ½åªå½±å“éƒ¨åˆ†åˆ—çš„æŸ¥è¯¢ï¼š

```sql
-- åŸå¤åˆç´¢å¼•å®šä¹‰
-- KEY idx_user_info (username, email, create_time)

-- æ£€æŸ¥ä¸åŒæŸ¥è¯¢çš„è¡¨ç°
EXPLAIN SELECT * FROM user_table WHERE username = 'john';
EXPLAIN SELECT * FROM user_table WHERE username = 'john' AND email = 'john@email.com';
EXPLAIN SELECT * FROM user_table WHERE email = 'john@email.com';

-- é‡å»ºå¤åˆç´¢å¼•
ALTER TABLE user_table DROP INDEX idx_user_info;
ALTER TABLE user_table ADD INDEX idx_user_info (username, email, create_time);
```

### 5.3 å¤–é”®çº¦æŸé”™è¯¯å¤„ç†


**ğŸ”— å¤–é”®ç´¢å¼•é—®é¢˜**ï¼š

å¤–é”®çº¦æŸä¾èµ–ç´¢å¼•ï¼Œç´¢å¼•æŸåä¼šå¯¼è‡´å¤–é”®é”™è¯¯ï¼š

```sql
-- 1. æ£€æŸ¥å¤–é”®çº¦æŸçŠ¶æ€
SELECT 
    CONSTRAINT_NAME,
    TABLE_NAME,
    COLUMN_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM information_schema.KEY_COLUMN_USAGE 
WHERE CONSTRAINT_SCHEMA = 'mydb' 
  AND REFERENCED_TABLE_NAME IS NOT NULL;

-- 2. æš‚æ—¶ç¦ç”¨å¤–é”®æ£€æŸ¥
SET foreign_key_checks = 0;

-- 3. é‡å»ºç›¸å…³ç´¢å¼•
ALTER TABLE order_table DROP INDEX fk_user_id;
ALTER TABLE order_table ADD INDEX fk_user_id (user_id);

-- 4. é‡æ–°å¯ç”¨å¤–é”®æ£€æŸ¥
SET foreign_key_checks = 1;

-- 5. éªŒè¯å¤–é”®çº¦æŸ
SELECT * FROM order_table o 
LEFT JOIN user_table u ON o.user_id = u.user_id 
WHERE u.user_id IS NULL;
```

---

## 6. ğŸ“Š ç´¢å¼•ç»´æŠ¤ä¸ç›‘æ§ç­–ç•¥


### 6.1 é¢„é˜²æ€§ç»´æŠ¤è®¡åˆ’


**ğŸ• å®šæœŸç»´æŠ¤ä»»åŠ¡**ï¼š

å»ºç«‹å®šæœŸçš„ç´¢å¼•ç»´æŠ¤åˆ¶åº¦ï¼š

```sql
-- æ¯å‘¨æ‰§è¡Œçš„ç»´æŠ¤è„šæœ¬
-- 1. æ›´æ–°ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE user_table, order_table, product_table;

-- 2. æ£€æŸ¥è¡¨å®Œæ•´æ€§
CHECK TABLE user_table, order_table, product_table;

-- 3. ä¼˜åŒ–è¡¨ç»“æ„ï¼ˆç¢ç‰‡æ•´ç†ï¼‰
OPTIMIZE TABLE user_table, order_table, product_table;
```

**ğŸ“… ç»´æŠ¤è®¡åˆ’è¡¨**ï¼š
| é¢‘ç‡ | ç»´æŠ¤å†…å®¹ | å½±å“ç¨‹åº¦ | æœ€ä½³æ—¶é—´ |
|------|----------|----------|----------|
| ğŸŸ¢ **æ¯æ—¥** | `ç»Ÿè®¡ä¿¡æ¯æ›´æ–°` | ä½ | ä¸šåŠ¡ä½å³°æœŸ |
| ğŸŸ¡ **æ¯å‘¨** | `è¡¨å®Œæ•´æ€§æ£€æŸ¥` | ä¸­ | å‘¨æœ«ç»´æŠ¤çª—å£ |
| ğŸ”´ **æ¯æœˆ** | `ç´¢å¼•é‡å»ºä¼˜åŒ–` | é«˜ | è®¡åˆ’ç»´æŠ¤æ—¶é—´ |

### 6.2 ç›‘æ§æŒ‡æ ‡ä½“ç³»


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**ï¼š

```sql
-- 1. ç´¢å¼•ä½¿ç”¨ç‡ç›‘æ§
SELECT 
    OBJECT_SCHEMA as db_name,
    OBJECT_NAME as table_name,
    INDEX_NAME,
    COUNT_READ,
    COUNT_INSERT,
    COUNT_UPDATE,
    COUNT_DELETE,
    CASE 
        WHEN COUNT_READ = 0 THEN 'UNUSED'
        WHEN COUNT_READ < 100 THEN 'LOW_USAGE'
        ELSE 'ACTIVE'
    END as usage_status
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE OBJECT_SCHEMA NOT IN ('mysql', 'performance_schema', 'sys')
ORDER BY COUNT_READ DESC;

-- 2. æŸ¥è¯¢æ€§èƒ½ç›‘æ§
SELECT 
    DIGEST_TEXT,
    COUNT_STAR as exec_count,
    AVG_TIMER_WAIT/1000000000 as avg_time_sec,
    MAX_TIMER_WAIT/1000000000 as max_time_sec,
    SUM_ROWS_EXAMINED/COUNT_STAR as avg_rows_examined
FROM performance_schema.events_statements_summary_by_digest 
WHERE AVG_TIMER_WAIT > 1000000000  -- è¶…è¿‡1ç§’
ORDER BY AVG_TIMER_WAIT DESC
LIMIT 10;
```

### 6.3 è‡ªåŠ¨åŒ–ç›‘æ§è„šæœ¬


**ğŸ¤– ç›‘æ§è„šæœ¬ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# MySQLç´¢å¼•å¥åº·æ£€æŸ¥è„šæœ¬

# é…ç½®ä¿¡æ¯
MYSQL_USER="monitor"
MYSQL_PASS="password" 
MYSQL_HOST="localhost"
LOG_FILE="/var/log/mysql_index_check.log"

# æ£€æŸ¥å‡½æ•°
check_table_integrity() {
    echo "$(date): å¼€å§‹è¡¨å®Œæ•´æ€§æ£€æŸ¥" >> $LOG_FILE
    
    mysql -u$MYSQL_USER -p$MYSQL_PASS -h$MYSQL_HOST << EOF
    SELECT 
        CONCAT('CHECK TABLE ', table_schema, '.', table_name, ';') as check_sql
    FROM information_schema.tables 
    WHERE table_schema = 'mydb' 
      AND table_type = 'BASE TABLE';
EOF
}

# æ‰§è¡Œæ£€æŸ¥
check_table_integrity

echo "ç´¢å¼•æ£€æŸ¥å®Œæˆï¼Œè¯¦æƒ…æŸ¥çœ‹æ—¥å¿—: $LOG_FILE"
```

### 6.4 å‘Šè­¦æœºåˆ¶è®¾ç½®


**ğŸš¨ å‘Šè­¦è§¦å‘æ¡ä»¶**ï¼š

```sql
-- åˆ›å»ºç›‘æ§è§†å›¾
CREATE VIEW v_index_health_monitor AS
SELECT 
    TABLE_SCHEMA,
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    CASE 
        WHEN CARDINALITY = 0 THEN 'CRITICAL'
        WHEN CARDINALITY < 10 THEN 'WARNING'  
        ELSE 'NORMAL'
    END as health_status
FROM information_schema.STATISTICS 
WHERE TABLE_SCHEMA NOT IN ('mysql', 'performance_schema', 'sys');

-- æŸ¥è¯¢éœ€è¦å‘Šè­¦çš„ç´¢å¼•
SELECT * FROM v_index_health_monitor 
WHERE health_status IN ('CRITICAL', 'WARNING');
```

**ğŸ“§ å‘Šè­¦é€šçŸ¥ç¤ºä¾‹**ï¼š
```
å‘Šè­¦çº§åˆ«ï¼šä¸¥é‡
å‘Šè­¦å†…å®¹ï¼šmydb.user_table è¡¨çš„ idx_username ç´¢å¼•åŸºæ•°ä¸º0ï¼Œå¯èƒ½å·²æŸå
å½±å“èŒƒå›´ï¼šç”¨æˆ·æŸ¥è¯¢åŠŸèƒ½å—å½±å“  
å»ºè®®æ“ä½œï¼šç«‹å³æ‰§è¡Œç´¢å¼•é‡å»º
å¤„ç†å‘½ä»¤ï¼šALTER TABLE user_table DROP INDEX idx_username, ADD INDEX idx_username (username);
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 ç´¢å¼•æŸåè¯†åˆ«è¦ç‚¹


**ğŸ¯ å¿«é€Ÿè¯†åˆ«æ–¹æ³•**ï¼š
```
æ€§èƒ½è¡¨ç°ï¼š
âœ… æŸ¥è¯¢çªç„¶å˜æ…¢ï¼ˆåŸæœ¬æ¯«ç§’çº§å˜æˆç§’çº§ï¼‰
âœ… CPUå’ŒIOä½¿ç”¨ç‡å¼‚å¸¸å‡é«˜
âœ… è¿æ¥æ•°å¢åŠ ï¼ŒæŸ¥è¯¢å †ç§¯

åŠŸèƒ½è¡¨ç°ï¼š  
âœ… æŸ¥è¯¢ç»“æœä¸å®Œæ•´æˆ–é”™è¯¯
âœ… å”¯ä¸€çº¦æŸå¤±æ•ˆ
âœ… å¤–é”®çº¦æŸæ£€æŸ¥å¼‚å¸¸
```

### 7.2 å¤„ç†æµç¨‹è¦ç‚¹


**ğŸ”„ æ ‡å‡†å¤„ç†æµç¨‹**ï¼š
```
1ï¸âƒ£ é—®é¢˜ç¡®è®¤ï¼šCHECK TABLE å¿«é€Ÿæ£€æŸ¥
2ï¸âƒ£ å½±å“è¯„ä¼°ï¼šç¡®å®šä¸šåŠ¡å½±å“èŒƒå›´
3ï¸âƒ£ å¤‡ä»½ä¿æŠ¤ï¼šå¤‡ä»½ç›¸å…³æ•°æ®
4ï¸âƒ£ ç´¢å¼•é‡å»ºï¼šé€‰æ‹©åˆé€‚çš„é‡å»ºæ–¹æ³•
5ï¸âƒ£ æ•ˆæœéªŒè¯ï¼šç¡®è®¤ä¿®å¤æ•ˆæœ
6ï¸âƒ£ ç›‘æ§è·Ÿè¸ªï¼šåç»­æŒç»­ç›‘æ§
```

### 7.3 å…³é”®å‘½ä»¤é€ŸæŸ¥


**ğŸ”§ å¸¸ç”¨ä¿®å¤å‘½ä»¤**ï¼š
```sql
-- å¿«é€Ÿæ£€æŸ¥
CHECK TABLE table_name;

-- é‡å»ºç»Ÿè®¡ä¿¡æ¯  
ANALYZE TABLE table_name;

-- å•ä¸ªç´¢å¼•é‡å»º
ALTER TABLE table_name DROP INDEX index_name, ADD INDEX index_name (column_name);

-- æ•´è¡¨ä¼˜åŒ–
OPTIMIZE TABLE table_name;

-- æ‰¹é‡æ£€æŸ¥
SELECT CONCAT('CHECK TABLE ', table_schema, '.', table_name, ';') 
FROM information_schema.tables WHERE table_schema = 'your_db';
```

### 7.4 é¢„é˜²æªæ–½è¦ç‚¹


**ğŸ›¡ï¸ é¢„é˜²ç­–ç•¥**ï¼š
```
ç¡¬ä»¶å±‚é¢ï¼š
â€¢ ä½¿ç”¨é«˜è´¨é‡å­˜å‚¨è®¾å¤‡
â€¢ å®šæœŸæ£€æŸ¥ç£ç›˜å¥åº·çŠ¶æ€  
â€¢ ç¡®ä¿å……è¶³çš„ç£ç›˜ç©ºé—´

è½¯ä»¶å±‚é¢ï¼š
â€¢ è§„èŒƒåŒ–æ•°æ®åº“å…³é—­æµç¨‹
â€¢ é¿å…å¼ºåˆ¶ç»ˆæ­¢MySQLè¿›ç¨‹
â€¢ åˆç†è®¾ç½®innodb_buffer_pool_size

ç»´æŠ¤å±‚é¢ï¼š
â€¢ å»ºç«‹å®šæœŸç»´æŠ¤è®¡åˆ’
â€¢ å®æ–½æŒç»­ç›‘æ§æœºåˆ¶
â€¢ åˆ¶å®šåº”æ€¥å“åº”æµç¨‹
```

### 7.5 åº”æ€¥å¤„ç†è¦ç‚¹


**ğŸš¨ ç´§æ€¥æƒ…å†µå¤„ç†**ï¼š

å½“å‘ç°ç´¢å¼•æŸåæ—¶çš„ä¼˜å…ˆçº§å¤„ç†ï¼š

```
ğŸ”´ ç´§æ€¥å¤„ç†ï¼ˆä¸šåŠ¡ä¸­æ–­ï¼‰ï¼š
1. ç«‹å³åˆ‡æ¢åˆ°å¤‡åº“æˆ–åªè¯»æ¨¡å¼
2. å¿«é€Ÿè¯„ä¼°æŸåèŒƒå›´
3. é€‰æ‹©æœ€å¿«çš„ä¿®å¤æ–¹æ¡ˆ

ğŸŸ¡ å¸¸è§„å¤„ç†ï¼ˆä¸šåŠ¡å—å½±å“ï¼‰ï¼š
1. é€šçŸ¥ç›¸å…³ä¸šåŠ¡æ–¹
2. å®‰æ’ç»´æŠ¤çª—å£
3. æŒ‰æ ‡å‡†æµç¨‹ä¿®å¤

ğŸŸ¢ é¢„é˜²å¤„ç†ï¼ˆæ½œåœ¨é£é™©ï¼‰ï¼š
1. åŠ å¼ºç›‘æ§é¢‘ç‡
2. åˆ¶å®šè¯¦ç»†ä¿®å¤è®¡åˆ’  
3. æ‹©æœºè¿›è¡Œç»´æŠ¤
```

**ğŸ’¡ æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- ç´¢å¼•æŸå = æ•°æ®åº“çš„"ç›®å½•å†Œ"å‡ºé—®é¢˜ï¼ŒæŸ¥è¯¢å˜æ…¢æˆ–å‡ºé”™
- CHECK TABLE æ˜¯è¯Šæ–­çš„ç¬¬ä¸€å·¥å…·ï¼Œå¿«é€Ÿå‘ç°é—®é¢˜
- ç´¢å¼•é‡å»ºè¦å…ˆå¤‡ä»½ï¼Œé€‰æ‹©åˆé€‚æ—¶æœºï¼Œé¿å…ä¸šåŠ¡å½±å“  
- é¢„é˜²èƒœäºæ²»ç–—ï¼Œå®šæœŸç»´æŠ¤å’Œç›‘æ§æ˜¯å…³é”®
- ä¸»é”®ç´¢å¼•æŸåæœ€ä¸¥é‡ï¼ŒäºŒçº§ç´¢å¼•æŸåç›¸å¯¹å®¹æ˜“ä¿®å¤