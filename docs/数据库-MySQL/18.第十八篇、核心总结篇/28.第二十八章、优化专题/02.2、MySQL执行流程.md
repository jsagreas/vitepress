---
title: 2ã€MySQLæ‰§è¡Œæµç¨‹
---
## ğŸ“š ç›®å½•

1. [MySQLæ‰§è¡Œæµç¨‹æ¦‚è§ˆ](#1-MySQLæ‰§è¡Œæµç¨‹æ¦‚è§ˆ)
2. [SQLè§£æå™¨æ€§èƒ½å½±å“](#2-SQLè§£æå™¨æ€§èƒ½å½±å“)
3. [æŸ¥è¯¢ä¼˜åŒ–å™¨å·¥ä½œåŸç†](#3-æŸ¥è¯¢ä¼˜åŒ–å™¨å·¥ä½œåŸç†)
4. [æ‰§è¡Œå¼•æ“æ€§èƒ½è¦ç´ ](#4-æ‰§è¡Œå¼•æ“æ€§èƒ½è¦ç´ )
5. [å­˜å‚¨å¼•æ“è°ƒç”¨å¼€é”€](#5-å­˜å‚¨å¼•æ“è°ƒç”¨å¼€é”€)
6. [ç½‘ç»œä¼ è¾“ä¸è¿æ¥æ€§èƒ½](#6-ç½‘ç»œä¼ è¾“ä¸è¿æ¥æ€§èƒ½)
7. [ç¼“å­˜å‘½ä¸­æœºåˆ¶](#7-ç¼“å­˜å‘½ä¸­æœºåˆ¶)
8. [ç£ç›˜IOæ€§èƒ½å½±å“](#8-ç£ç›˜IOæ€§èƒ½å½±å“)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ”„ MySQLæ‰§è¡Œæµç¨‹æ¦‚è§ˆ


### 1.1 ä»€ä¹ˆæ˜¯MySQLæ‰§è¡Œæµç¨‹


**ç®€å•ç†è§£**ï¼šå°±åƒä½ åœ¨é¤å…ç‚¹é¤ä¸€æ ·ï¼ŒSQLæ‰§è¡Œä¹Ÿæœ‰ä¸€å¥—å›ºå®šçš„æµç¨‹æ­¥éª¤ã€‚

```
ä½ çš„SQLæŸ¥è¯¢ â†’ MySQLæœåŠ¡å™¨ â†’ è¿”å›ç»“æœ

å°±åƒï¼š
ä½ ç‚¹èœ â†’ æœåŠ¡å‘˜è®°å½• â†’ å¨å¸ˆåšèœ â†’ æœåŠ¡å‘˜ä¸Šèœ â†’ ä½ äº«ç”¨
```

### 1.2 å®Œæ•´æ‰§è¡Œæµç¨‹å›¾ç¤º


```
å®¢æˆ·ç«¯åº”ç”¨
    â†“ [å‘é€SQL]
è¿æ¥å™¨ â†â†’ è¿æ¥æ± 
    â†“ [éªŒè¯æƒé™]
æŸ¥è¯¢ç¼“å­˜ (MySQL 8.0å·²ç§»é™¤)
    â†“ [ç¼“å­˜æœªå‘½ä¸­]
è§£æå™¨
    â†“ [è¯­æ³•åˆ†æ]
é¢„å¤„ç†å™¨ 
    â†“ [è¯­ä¹‰æ£€æŸ¥]
ä¼˜åŒ–å™¨
    â†“ [æ‰§è¡Œè®¡åˆ’]
æ‰§è¡Œå™¨
    â†“ [è°ƒç”¨å­˜å‚¨å¼•æ“]
å­˜å‚¨å¼•æ“ (InnoDB/MyISAMç­‰)
    â†“ [æ•°æ®è¯»å†™]
ç£ç›˜æ–‡ä»¶
```

### 1.3 æ ¸å¿ƒæµç¨‹æ­¥éª¤è¯´æ˜


| **æ­¥éª¤** | **ä¸»è¦ä½œç”¨** | **æ€§èƒ½å½±å“** |
|---------|-------------|-------------|
| **è¿æ¥å™¨** | `éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå»ºç«‹è¿æ¥` | `è¿æ¥æ•°è¿‡å¤šå½±å“æ€§èƒ½` |
| **è§£æå™¨** | `æ£€æŸ¥SQLè¯­æ³•ï¼Œç”Ÿæˆè¯­æ³•æ ‘` | `å¤æ‚SQLè§£æè€—æ—¶` |
| **ä¼˜åŒ–å™¨** | `é€‰æ‹©æœ€ä¼˜æ‰§è¡Œè®¡åˆ’` | `ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯å½±å“å·¨å¤§` |
| **æ‰§è¡Œå™¨** | `æ‰§è¡Œå…·ä½“æ“ä½œ` | `æƒé™æ£€æŸ¥ã€å¼•æ“è°ƒç”¨å¼€é”€` |
| **å­˜å‚¨å¼•æ“** | `å®é™…æ•°æ®å­˜å‚¨å’Œæ£€ç´¢` | `å¼•æ“ç‰¹æ€§ç›´æ¥å½±å“æ€§èƒ½` |

---

## 2. ğŸ” SQLè§£æå™¨æ€§èƒ½å½±å“


### 2.1 è§£æå™¨æ˜¯åšä»€ä¹ˆçš„


**é€šä¿—è§£é‡Š**ï¼šè§£æå™¨å°±åƒè¯­æ–‡è€å¸ˆæ£€æŸ¥ä½œæ–‡è¯­æ³•ä¸€æ ·ï¼Œå®ƒè¦æ£€æŸ¥ä½ çš„SQLè¯­å¥æ˜¯å¦ç¬¦åˆMySQLçš„"è¯­æ³•è§„åˆ™"ã€‚

```
ä½ å†™çš„SQLï¼šSELECT * FROM users WHERE age > 18
è§£æå™¨æ£€æŸ¥ï¼š
âœ“ SELECTå…³é”®å­—æ­£ç¡®
âœ“ FROMå­å¥å­˜åœ¨
âœ“ WHEREæ¡ä»¶è¯­æ³•æ­£ç¡®
âœ“ æ•´ä½“ç»“æ„ç¬¦åˆè§„èŒƒ
```

### 2.2 è§£æè¿‡ç¨‹è¯¦è§£


**ğŸ”¸ è¯æ³•åˆ†æé˜¶æ®µ**
```
åŸSQLï¼šSELECT name FROM users WHERE id = 1

è¯æ³•åˆ†æç»“æœï¼š
[SELECT] [name] [FROM] [users] [WHERE] [id] [=] [1]
   â†“       â†“      â†“      â†“       â†“     â†“   â†“   â†“
å…³é”®å­—   å­—æ®µå  å…³é”®å­—  è¡¨å   å…³é”®å­—  å­—æ®µ æ“ä½œç¬¦ å€¼
```

**ğŸ”¸ è¯­æ³•åˆ†æé˜¶æ®µ**
```
ç”Ÿæˆè¯­æ³•æ ‘ï¼š
           SELECT
          /      \
      å­—æ®µåˆ—è¡¨    FROMå­å¥
        |          |
       name      usersè¡¨
                    |
                 WHEREå­å¥
                    |
                 æ¡ä»¶è¡¨è¾¾å¼
                 /    |    \
               id     =      1
```

### 2.3 è§£æå™¨æ€§èƒ½å½±å“å› ç´ 


**âš¡ å½±å“æ€§èƒ½çš„æƒ…å†µ**

| **åœºæ™¯** | **æ€§èƒ½å½±å“** | **ä¼˜åŒ–å»ºè®®** |
|---------|-------------|-------------|
| **å¤æ‚åµŒå¥—æŸ¥è¯¢** | `è§£ææ—¶é—´æ˜¾è‘—å¢é•¿` | `ç®€åŒ–SQLç»“æ„ï¼Œå‡å°‘åµŒå¥—å±‚æ¬¡` |
| **é•¿SQLè¯­å¥** | `è¯æ³•åˆ†æè€—æ—¶` | `åˆç†æ‹†åˆ†å¤æ‚æŸ¥è¯¢` |
| **å¤§é‡å‡½æ•°è°ƒç”¨** | `è¯­æ³•æ ‘å¤æ‚` | `å‡å°‘ä¸å¿…è¦çš„å‡½æ•°ä½¿ç”¨` |
| **è¯­æ³•é”™è¯¯é¢‘ç¹** | `é‡å¤è§£æå¼€é”€` | `SQLè¯­å¥é¢„æ£€æŸ¥` |

**ğŸ’¡ å®é™…æ¡ˆä¾‹å¯¹æ¯”**

```sql
-- âŒ è§£æå¤æ‚çš„åµŒå¥—æŸ¥è¯¢
SELECT u.name, 
       (SELECT COUNT(*) FROM orders o1 WHERE o1.user_id = u.id) as order_count,
       (SELECT AVG(amount) FROM orders o2 WHERE o2.user_id = u.id) as avg_amount
FROM users u 
WHERE u.id IN (SELECT DISTINCT user_id FROM orders WHERE amount > 1000);

-- âœ… è§£æç®€å•çš„JOINæŸ¥è¯¢
SELECT u.name, o.order_count, o.avg_amount
FROM users u
JOIN order_stats o ON u.id = o.user_id 
WHERE o.avg_amount > 1000;
```

---

## 3. ğŸ§  æŸ¥è¯¢ä¼˜åŒ–å™¨å·¥ä½œåŸç†


### 3.1 ä¼˜åŒ–å™¨çš„ä½œç”¨


**å½¢è±¡æ¯”å–»**ï¼šä¼˜åŒ–å™¨å°±åƒå¯¼èˆªè½¯ä»¶ï¼Œç»™ä½ æ‰¾ä»Aåˆ°Bçš„æœ€å¿«è·¯çº¿ã€‚

```
ä½ çš„ç›®æ ‡ï¼šæŸ¥æ‰¾å¹´é¾„å¤§äº25çš„ç”¨æˆ·ä¿¡æ¯
å¯èƒ½çš„è·¯å¾„ï¼š
è·¯å¾„1ï¼šå…¨è¡¨æ‰«æ â†’ è¿‡æ»¤æ¡ä»¶ (è€—æ—¶é•¿)
è·¯å¾„2ï¼šä½¿ç”¨å¹´é¾„ç´¢å¼• â†’ ç›´æ¥å®šä½ (è€—æ—¶çŸ­)

ä¼˜åŒ–å™¨é€‰æ‹©ï¼šè·¯å¾„2 (æœ€ä¼˜æ‰§è¡Œè®¡åˆ’)
```

### 3.2 ä¼˜åŒ–å™¨å·¥ä½œæµç¨‹


```
æ¥æ”¶è§£æåçš„SQLè¯­å¥
        â†“
ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
â”œâ”€â”€ è¡¨è¡Œæ•°ç»Ÿè®¡
â”œâ”€â”€ ç´¢å¼•é€‰æ‹©æ€§
â”œâ”€â”€ æ•°æ®åˆ†å¸ƒæƒ…å†µ
â””â”€â”€ å†å²æŸ¥è¯¢æ¨¡å¼
        â†“
ç”Ÿæˆå¤šä¸ªæ‰§è¡Œè®¡åˆ’
â”œâ”€â”€ è®¡åˆ’Aï¼šå…¨è¡¨æ‰«æ
â”œâ”€â”€ è®¡åˆ’Bï¼šä½¿ç”¨ç´¢å¼•A
â”œâ”€â”€ è®¡åˆ’Cï¼šä½¿ç”¨ç´¢å¼•B
â””â”€â”€ è®¡åˆ’Dï¼šå¤šè¡¨JOINé¡ºåº
        â†“
æˆæœ¬ä¼°ç®—ï¼ˆCBO - Cost Based Optimizerï¼‰
â”œâ”€â”€ CPUæˆæœ¬
â”œâ”€â”€ IOæˆæœ¬  
â”œâ”€â”€ ç½‘ç»œæˆæœ¬
â””â”€â”€ å†…å­˜æˆæœ¬
        â†“
é€‰æ‹©æœ€ä¼˜æ‰§è¡Œè®¡åˆ’
```

### 3.3 ä¼˜åŒ–å™¨å†³ç­–ä¾æ®


**ğŸ”¸ ç»Ÿè®¡ä¿¡æ¯çš„é‡è¦æ€§**

```sql
-- æŸ¥çœ‹è¡¨çš„ç»Ÿè®¡ä¿¡æ¯
SHOW TABLE STATUS LIKE 'users';

-- æŸ¥çœ‹ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯  
SHOW INDEX FROM users;

-- åˆ†æè¡¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ›´æ–°ç»Ÿè®¡ï¼‰
ANALYZE TABLE users;
```

**ğŸ“Š æˆæœ¬è®¡ç®—ç¤ºä¾‹**

| **æ‰§è¡Œæ–¹æ¡ˆ** | **é¢„è®¡æˆæœ¬** | **è¯´æ˜** |
|-------------|-------------|---------|
| **å…¨è¡¨æ‰«æ** | `1000.00` | `è¯»å–æ‰€æœ‰è¡Œï¼ŒCPUå¤„ç†æˆæœ¬é«˜` |
| **ä¸»é”®ç´¢å¼•** | `10.50` | `ç›´æ¥å®šä½ï¼ŒIOæˆæœ¬ä½` |
| **æ™®é€šç´¢å¼•** | `25.30` | `ç´¢å¼•æŸ¥æ‰¾+å›è¡¨ï¼Œä¸­ç­‰æˆæœ¬` |
| **è¦†ç›–ç´¢å¼•** | `8.20` | `æ— éœ€å›è¡¨ï¼Œæˆæœ¬æœ€ä½` |

### 3.4 ä¼˜åŒ–å™¨å¸¸è§é—®é¢˜


**âš ï¸ ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯çš„æƒ…å†µ**

```sql
-- ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶å¯¼è‡´é”™è¯¯é€‰æ‹©
-- å®é™…æƒ…å†µï¼šè¡¨æœ‰100ä¸‡è¡Œï¼ŒWHEREæ¡ä»¶èƒ½è¿‡æ»¤åˆ°åªå‰©10è¡Œ
-- ä½†ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºï¼šè¡¨åªæœ‰1ä¸‡è¡Œ
-- ä¼˜åŒ–å™¨è¯¯åˆ¤ï¼šé€‰æ‹©å…¨è¡¨æ‰«æè€Œä¸æ˜¯ç´¢å¼•

-- è§£å†³æ–¹æ¡ˆï¼š
ANALYZE TABLE large_table;  -- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
```

**ğŸ’¡ å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç´¢å¼•**

```sql
-- å½“ä¼˜åŒ–å™¨é€‰æ‹©é”™è¯¯æ—¶ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‡å®š
SELECT * FROM users USE INDEX(idx_age) WHERE age > 25;

-- æˆ–è€…ç¦ç”¨æŸä¸ªç´¢å¼•
SELECT * FROM users IGNORE INDEX(idx_name) WHERE age > 25;
```

---

## 4. âš™ï¸ æ‰§è¡Œå¼•æ“æ€§èƒ½è¦ç´ 


### 4.1 æ‰§è¡Œå¼•æ“çš„èŒè´£


**ç®€å•ç†è§£**ï¼šæ‰§è¡Œå¼•æ“å°±åƒå·¥å‚è½¦é—´çš„ç­ç»„é•¿ï¼Œè´Ÿè´£æŒ‰ç…§ç”Ÿäº§è®¡åˆ’ï¼ˆæ‰§è¡Œè®¡åˆ’ï¼‰æŒ‡æŒ¥å·¥äººï¼ˆå­˜å‚¨å¼•æ“ï¼‰å¹²æ´»ã€‚

```
ä¼˜åŒ–å™¨åˆ¶å®šè®¡åˆ’ï¼šå…ˆæŸ¥ç”¨æˆ·è¡¨ï¼Œå†å…³è”è®¢å•è¡¨
æ‰§è¡Œå¼•æ“æ‰§è¡Œï¼š
1. è°ƒç”¨å­˜å‚¨å¼•æ“è¯»å–ç”¨æˆ·æ•°æ®
2. æ£€æŸ¥æƒé™
3. è°ƒç”¨å­˜å‚¨å¼•æ“è¯»å–è®¢å•æ•°æ®  
4. æ‰§è¡ŒJOINæ“ä½œ
5. è¿”å›æœ€ç»ˆç»“æœ
```

### 4.2 æ‰§è¡Œå¼•æ“å·¥ä½œæµç¨‹


```
æ¥æ”¶æ‰§è¡Œè®¡åˆ’
    â†“
æƒé™éªŒè¯
â”œâ”€â”€ è¡¨æƒé™æ£€æŸ¥
â”œâ”€â”€ åˆ—æƒé™æ£€æŸ¥  
â””â”€â”€ æ“ä½œæƒé™æ£€æŸ¥
    â†“
è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£
â”œâ”€â”€ handler->rnd_init() -- åˆå§‹åŒ–
â”œâ”€â”€ handler->rnd_next() -- è¯»å–ä¸‹ä¸€è¡Œ
â”œâ”€â”€ handler->index_read() -- ç´¢å¼•è¯»å–
â””â”€â”€ handler->write_row() -- å†™å…¥æ•°æ®
    â†“
æ•°æ®å¤„ç†
â”œâ”€â”€ è¿‡æ»¤æ¡ä»¶åº”ç”¨
â”œâ”€â”€ æ’åºæ“ä½œ
â”œâ”€â”€ åˆ†ç»„ç»Ÿè®¡
â””â”€â”€ å‡½æ•°è®¡ç®—
    â†“
ç»“æœé›†æ„å»º
```

### 4.3 æ‰§è¡Œå¼•æ“æ€§èƒ½å½±å“


**ğŸ”¸ ä¸»è¦æ€§èƒ½å¼€é”€**

| **æ“ä½œç±»å‹** | **æ€§èƒ½å¼€é”€** | **ä¼˜åŒ–æ–¹å‘** |
|-------------|-------------|-------------|
| **æƒé™æ£€æŸ¥** | `æ¯è¡Œæ•°æ®éƒ½è¦æ£€æŸ¥` | `åˆç†è®¾ç½®æƒé™ç²’åº¦` |
| **å¼•æ“è°ƒç”¨** | `å‡½æ•°è°ƒç”¨å¼€é”€` | `å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨` |
| **å†…å­˜æ“ä½œ** | `å¤§ç»“æœé›†å†…å­˜æ¶ˆè€—` | `ä½¿ç”¨LIMITæ§åˆ¶ç»“æœé›†å¤§å°` |
| **ä¸´æ—¶è¡¨** | `æ’åºå’Œåˆ†ç»„å¼€é”€` | `åˆç†ä½¿ç”¨ç´¢å¼•é¿å…ä¸´æ—¶è¡¨` |

**ğŸ’¡ æ‰§è¡Œå¼•æ“ä¼˜åŒ–ç¤ºä¾‹**

```sql
-- âŒ æ‰§è¡Œå¼•æ“å‹åŠ›å¤§çš„æŸ¥è¯¢
SELECT * FROM orders 
WHERE YEAR(create_time) = 2023  -- æ¯è¡Œéƒ½è¦è®¡ç®—å‡½æ•°
ORDER BY amount DESC;           -- éœ€è¦æ’åºå¤§é‡æ•°æ®

-- âœ… æ‰§è¡Œå¼•æ“å‹å¥½çš„æŸ¥è¯¢
SELECT order_id, amount, create_time FROM orders 
WHERE create_time >= '2023-01-01' 
  AND create_time < '2024-01-01'   -- å¯ä»¥ä½¿ç”¨ç´¢å¼•
ORDER BY amount DESC 
LIMIT 100;                       -- é™åˆ¶ç»“æœé›†å¤§å°
```

---

## 5. ğŸ’¾ å­˜å‚¨å¼•æ“è°ƒç”¨å¼€é”€


### 5.1 ä»€ä¹ˆæ˜¯å­˜å‚¨å¼•æ“


**ç”Ÿæ´»åŒ–æ¯”å–»**ï¼šå­˜å‚¨å¼•æ“å°±åƒä¸åŒçš„ä»“åº“ç®¡ç†ç³»ç»Ÿï¼Œæœ‰çš„æ“…é•¿å¿«é€ŸæŸ¥æ‰¾ï¼ˆInnoDBï¼‰ï¼Œæœ‰çš„æ“…é•¿æ‰¹é‡è¯»å–ï¼ˆMyISAMï¼‰ã€‚

```
MySQL Serverå±‚ (ç»Ÿä¸€æ¥å£)
        â†“
å­˜å‚¨å¼•æ“å±‚ (å…·ä½“å®ç°)
â”œâ”€â”€ InnoDB  -- æ”¯æŒäº‹åŠ¡ï¼Œè¡Œçº§é”
â”œâ”€â”€ MyISAM  -- æŸ¥è¯¢å¿«ï¼Œè¡¨çº§é”
â”œâ”€â”€ Memory  -- å†…å­˜å­˜å‚¨ï¼Œé€Ÿåº¦æå¿«
â””â”€â”€ Archive -- å‹ç¼©å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´
```

### 5.2 å­˜å‚¨å¼•æ“æ¥å£è°ƒç”¨


**ğŸ”¸ å¸¸ç”¨æ¥å£è°ƒç”¨æµç¨‹**

```
æ‰§è¡Œå¼•æ“è¯·æ±‚æ•°æ®
        â†“
handler->index_read_map()  -- ç´¢å¼•æŸ¥æ‰¾
        â†“
InnoDBå­˜å‚¨å¼•æ“
â”œâ”€â”€ æ£€æŸ¥Buffer Pool
â”œâ”€â”€ å¦‚æœä¸åœ¨å†…å­˜ï¼Œä»ç£ç›˜è¯»å–
â”œâ”€â”€ åº”ç”¨è¡Œé”
â””â”€â”€ è¿”å›æ•°æ®è¡Œ
        â†“
æ‰§è¡Œå¼•æ“ç»§ç»­å¤„ç†
```

### 5.3 ä¸åŒå¼•æ“çš„æ€§èƒ½ç‰¹ç‚¹


**ğŸ“Š ä¸»è¦å­˜å‚¨å¼•æ“å¯¹æ¯”**

| **å¼•æ“ç±»å‹** | **è°ƒç”¨å¼€é”€** | **é€‚ç”¨åœºæ™¯** | **æ€§èƒ½ç‰¹ç‚¹** |
|-------------|-------------|-------------|-------------|
| **InnoDB** | `äº‹åŠ¡å¤„ç†å¼€é”€è¾ƒé«˜` | `OLTPç³»ç»Ÿï¼Œé«˜å¹¶å‘` | `æ”¯æŒäº‹åŠ¡ï¼Œå´©æºƒæ¢å¤` |
| **MyISAM** | `ç®€å•æ“ä½œå¼€é”€ä½` | `è¯»å¤šå†™å°‘åœºæ™¯` | `æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œä¸æ”¯æŒäº‹åŠ¡` |
| **Memory** | `å†…å­˜è®¿é—®ï¼Œå¼€é”€æä½` | `ä¸´æ—¶æ•°æ®ï¼Œç¼“å­˜` | `æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­` |
| **Archive** | `å‹ç¼©è§£å‹å¼€é”€` | `å†å²æ•°æ®å­˜æ¡£` | `é«˜å‹ç¼©æ¯”ï¼ŒæŸ¥è¯¢è¾ƒæ…¢` |

### 5.4 å­˜å‚¨å¼•æ“æ€§èƒ½ä¼˜åŒ–


**ğŸ”¸ InnoDBæ€§èƒ½è°ƒä¼˜**

```sql
-- æŸ¥çœ‹InnoDBçŠ¶æ€
SHOW ENGINE INNODB STATUS;

-- å…³é”®æ€§èƒ½å‚æ•°
SHOW VARIABLES LIKE 'innodb_buffer_pool_size';  -- ç¼“å†²æ± å¤§å°
SHOW VARIABLES LIKE 'innodb_log_file_size';     -- æ—¥å¿—æ–‡ä»¶å¤§å°
SHOW VARIABLES LIKE 'innodb_flush_log_at_trx_commit';  -- äº‹åŠ¡æäº¤æ–¹å¼
```

**âš¡ å‡å°‘å­˜å‚¨å¼•æ“è°ƒç”¨å¼€é”€çš„æ–¹æ³•**

```sql
-- âŒ é¢‘ç¹çš„å•è¡Œæ“ä½œ
INSERT INTO users VALUES (1, 'Tom');
INSERT INTO users VALUES (2, 'Jerry'); 
INSERT INTO users VALUES (3, 'Bob');

-- âœ… æ‰¹é‡æ“ä½œå‡å°‘è°ƒç”¨æ¬¡æ•°
INSERT INTO users VALUES 
(1, 'Tom'), (2, 'Jerry'), (3, 'Bob');

-- âŒ é€è¡ŒæŸ¥è¯¢
SELECT * FROM users WHERE id = 1;
SELECT * FROM users WHERE id = 2;

-- âœ… æ‰¹é‡æŸ¥è¯¢
SELECT * FROM users WHERE id IN (1, 2);
```

---

## 6. ğŸŒ ç½‘ç»œä¼ è¾“ä¸è¿æ¥æ€§èƒ½


### 6.1 ç½‘ç»œä¼ è¾“åŸºç¡€æ¦‚å¿µ


**å½¢è±¡ç†è§£**ï¼šç½‘ç»œä¼ è¾“å°±åƒå¿«é€’è¿è¾“ï¼Œæ•°æ®åŒ…å°±æ˜¯åŒ…è£¹ï¼Œç½‘ç»œå°±æ˜¯è¿è¾“è·¯çº¿ã€‚

```
åº”ç”¨ç¨‹åº â†’ ç½‘ç»œ â†’ MySQLæœåŠ¡å™¨
    â†“         â†“         â†“
 å‘é€SQL   ç½‘ç»œä¼ è¾“   æ¥æ”¶å¤„ç†
 ç­‰å¾…ç»“æœ   ç½‘ç»œä¼ è¾“   è¿”å›æ•°æ®
```

### 6.2 å®¢æˆ·ç«¯è¿æ¥å¼€é”€


**ğŸ”¸ è¿æ¥å»ºç«‹è¿‡ç¨‹**

```
å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚
        â†“
TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥
â”œâ”€â”€ SYN    -- å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥
â”œâ”€â”€ SYN+ACK -- æœåŠ¡å™¨ç¡®è®¤
â””â”€â”€ ACK    -- å®¢æˆ·ç«¯ç¡®è®¤
        â†“
MySQLèº«ä»½éªŒè¯
â”œâ”€â”€ ç”¨æˆ·åå¯†ç éªŒè¯
â”œâ”€â”€ æƒé™æ£€æŸ¥
â””â”€â”€ åˆ†é…è¿æ¥èµ„æº
        â†“
è¿æ¥å»ºç«‹æˆåŠŸ
```

**âš¡ è¿æ¥å¼€é”€å½±å“å› ç´ **

| **å› ç´ ** | **æ€§èƒ½å½±å“** | **ä¼˜åŒ–ç­–ç•¥** |
|---------|-------------|-------------|
| **è¿æ¥æ•°è¿‡å¤š** | `å†…å­˜æ¶ˆè€—å¤§ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹` | `ä½¿ç”¨è¿æ¥æ± ç®¡ç†` |
| **é¢‘ç¹è¿æ¥æ–­å¼€** | `TCPæ¡æ‰‹å¼€é”€` | `ä¿æŒé•¿è¿æ¥` |
| **ç½‘ç»œå»¶è¿Ÿé«˜** | `å“åº”æ—¶é—´å¢é•¿` | `å‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°` |
| **ç»“æœé›†è¿‡å¤§** | `ç½‘ç»œä¼ è¾“æ—¶é—´é•¿` | `ä½¿ç”¨LIMITæ§åˆ¶æ•°æ®é‡` |

### 6.3 ç½‘ç»œä¼ è¾“ä¼˜åŒ–ç­–ç•¥


**ğŸ’¡ è¿æ¥æ± ä½¿ç”¨ç¤ºä¾‹**

```java
// âŒ æ¯æ¬¡æ“ä½œéƒ½åˆ›å»ºæ–°è¿æ¥
public void badQuery() {
    Connection conn = DriverManager.getConnection(url, user, pwd);
    // æ‰§è¡ŒæŸ¥è¯¢
    conn.close();  // è¿æ¥å¼€é”€å¤§
}

// âœ… ä½¿ç”¨è¿æ¥æ± å¤ç”¨è¿æ¥
DataSource dataSource = new HikariDataSource();
public void goodQuery() {
    Connection conn = dataSource.getConnection();  // ä»æ± ä¸­è·å–
    // æ‰§è¡ŒæŸ¥è¯¢
    conn.close();  // è¿”å›æ± ä¸­ï¼Œä¸æ˜¯çœŸæ­£å…³é—­
}
```

**ğŸ”¸ å‡å°‘ç½‘ç»œå¾€è¿”**

```sql
-- âŒ å¤šæ¬¡ç½‘ç»œå¾€è¿”
SELECT COUNT(*) FROM users WHERE age > 25;
SELECT AVG(age) FROM users WHERE age > 25;
SELECT MAX(age) FROM users WHERE age > 25;

-- âœ… ä¸€æ¬¡æŸ¥è¯¢è·å–å¤šä¸ªç»“æœ
SELECT COUNT(*), AVG(age), MAX(age) 
FROM users WHERE age > 25;
```

---

## 7. ğŸ”„ ç¼“å­˜å‘½ä¸­æœºåˆ¶


### 7.1 MySQLç¼“å­˜ä½“ç³»


**æ•´ä½“ç¼“å­˜æ¶æ„**ï¼šå°±åƒå¤šçº§ä»“åº“ç³»ç»Ÿï¼Œè¶Šé å‰çš„ä»“åº“å®¹é‡è¶Šå°ä½†é€Ÿåº¦è¶Šå¿«ã€‚

```
è®¿é—®é€Ÿåº¦ï¼ˆå¿«â†’æ…¢ï¼‰
    â†“
æŸ¥è¯¢ç¼“å­˜ (MySQL 8.0å·²åºŸå¼ƒ)
    â†“
Buffer Pool (InnoDBç¼“å†²æ± )
    â†“  
æ“ä½œç³»ç»Ÿç¼“å­˜
    â†“
ç£ç›˜å­˜å‚¨
```

### 7.2 InnoDB Buffer Poolè¯¦è§£


**ğŸ”¸ Buffer Poolä½œç”¨**

```
å†…å­˜ä¸­çš„æ•°æ®é¡µç¼“å­˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Buffer Pool              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®é¡µ â”‚ ç´¢å¼•é¡µ â”‚ æ’å…¥ç¼“å†² â”‚ é”ä¿¡æ¯  â”‚
â”‚  Page1  â”‚ Index1 â”‚ Change   â”‚ Locks  â”‚
â”‚  Page2  â”‚ Index2 â”‚ Buffer   â”‚ ...    â”‚
â”‚  ...    â”‚ ...    â”‚ ...      â”‚ ...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—**

```sql
-- æŸ¥çœ‹Buffer PoolçŠ¶æ€
SHOW ENGINE INNODB STATUS\G

-- å…³é”®æŒ‡æ ‡
-- Buffer pool hit rate: ç¼“å­˜å‘½ä¸­ç‡
-- è®¡ç®—å…¬å¼: (æ€»è¯»å– - ç£ç›˜è¯»å–) / æ€»è¯»å– * 100%
-- å¥åº·å€¼: > 99%

-- æŸ¥çœ‹å…·ä½“æ•°å€¼
SHOW STATUS LIKE 'Innodb_buffer_pool%';
```

### 7.3 ç¼“å­˜æ€§èƒ½ä¼˜åŒ–


**âš¡ æé«˜ç¼“å­˜å‘½ä¸­ç‡çš„æ–¹æ³•**

| **ä¼˜åŒ–ç­–ç•¥** | **å®ç°æ–¹æ³•** | **æ•ˆæœ** |
|-------------|-------------|---------|
| **å¢å¤§ç¼“å†²æ± ** | `è°ƒæ•´innodb_buffer_pool_size` | `æ›´å¤šçƒ­ç‚¹æ•°æ®å¸¸é©»å†…å­˜` |
| **é¢„çƒ­ç¼“å­˜** | `ç³»ç»Ÿå¯åŠ¨æ—¶æ‰§è¡Œå¸¸ç”¨æŸ¥è¯¢` | `é¿å…å†·å¯åŠ¨æ€§èƒ½é—®é¢˜` |
| **ä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼** | `é¿å…éšæœºè®¿é—®ï¼Œå¢åŠ é¡ºåºè®¿é—®` | `æé«˜é¡µé¢å¤ç”¨ç‡` |
| **åˆç†åˆ†åŒº** | `æŒ‰è®¿é—®æ¨¡å¼åˆ†åŒºå­˜å‚¨` | `æé«˜çƒ­ç‚¹æ•°æ®é›†ä¸­åº¦` |

**ğŸ’¡ ç¼“å­˜å‹å¥½çš„æŸ¥è¯¢æ¨¡å¼**

```sql
-- âŒ ç¼“å­˜ä¸å‹å¥½ï¼šéšæœºè®¿é—®
SELECT * FROM orders WHERE id = FLOOR(RAND() * 1000000);

-- âœ… ç¼“å­˜å‹å¥½ï¼šé¡ºåºè®¿é—®æˆ–èŒƒå›´æŸ¥è¯¢
SELECT * FROM orders 
WHERE create_time >= '2023-12-01' 
  AND create_time < '2023-12-02'
ORDER BY id;
```

---

## 8. ğŸ’¿ ç£ç›˜IOæ€§èƒ½å½±å“


### 8.1 ç£ç›˜IOåŸºç¡€æ¦‚å¿µ


**ç®€å•ç†è§£**ï¼šç£ç›˜IOå°±åƒå›¾ä¹¦é¦†å€Ÿä¹¦ï¼Œæ‰¾ä¹¦ï¼ˆå¯»é“ï¼‰å’Œç¿»é¡µï¼ˆè¯»å–ï¼‰éƒ½éœ€è¦æ—¶é—´ã€‚

```
å†…å­˜è®¿é—®ï¼šçº³ç§’çº§ (ns)    -- å°±åƒä»å£è¢‹æä¸œè¥¿
SSDè®¿é—®ï¼š  å¾®ç§’çº§ (Î¼s)   -- å°±åƒä»æ¡Œä¸Šæ‹¿ä¸œè¥¿  
æœºæ¢°ç¡¬ç›˜ï¼š æ¯«ç§’çº§ (ms)   -- å°±åƒä»ä¹¦æ¶æ‰¾ä¹¦

æ€§èƒ½å·®è·ï¼š1:1000:1000000
```

### 8.2 MySQLç£ç›˜IOæ“ä½œç±»å‹


**ğŸ”¸ ä¸»è¦IOæ“ä½œ**

```
æ•°æ®æ–‡ä»¶IO
â”œâ”€â”€ æ•°æ®é¡µè¯»å– (.ibdæ–‡ä»¶)
â”œâ”€â”€ ç´¢å¼•é¡µè¯»å–  
â””â”€â”€ è¡¨ç©ºé—´ç®¡ç†

æ—¥å¿—æ–‡ä»¶IO  
â”œâ”€â”€ Redo Logå†™å…¥ (äº‹åŠ¡æ—¥å¿—)
â”œâ”€â”€ Undo Logå†™å…¥ (å›æ»šæ—¥å¿—)
â””â”€â”€ Binary Logå†™å…¥ (ä¸»ä»å¤åˆ¶)

ä¸´æ—¶æ–‡ä»¶IO
â”œâ”€â”€ æ’åºä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ åˆ†ç»„ä¸´æ—¶æ–‡ä»¶  
â””â”€â”€ JOINä¸´æ—¶æ–‡ä»¶
```

### 8.3 IOæ€§èƒ½å½±å“å› ç´ 


**ğŸ“Š å½±å“IOæ€§èƒ½çš„å…³é”®å› ç´ **

| **å› ç´ ** | **æ€§èƒ½å½±å“** | **ä¼˜åŒ–æ–¹å‘** |
|---------|-------------|-------------|
| **éšæœºIO vs é¡ºåºIO** | `éšæœºIOæ€§èƒ½å·®100å€` | `å°½é‡ä½¿ç”¨é¡ºåºè®¿é—®` |
| **ç£ç›˜ç±»å‹** | `SSDæ¯”æœºæ¢°ç¡¬ç›˜å¿«100å€` | `ä½¿ç”¨SSDå­˜å‚¨` |
| **IOå¤§å°** | `å¤§å—IOæ•ˆç‡æ›´é«˜` | `åˆç†è®¾ç½®é¡µé¢å¤§å°` |
| **å¹¶å‘IO** | `è¿‡å¤šå¹¶å‘å¯¼è‡´ç«äº‰` | `æ§åˆ¶å¹¶å‘åº¦` |

### 8.4 å‡å°‘ç£ç›˜IOçš„ç­–ç•¥


**âš¡ IOä¼˜åŒ–å®è·µ**

```sql
-- âŒ äº§ç”Ÿå¤§é‡éšæœºIO
SELECT * FROM users ORDER BY RAND() LIMIT 10;

-- âœ… ä½¿ç”¨ç´¢å¼•å‡å°‘IO
SELECT * FROM users WHERE create_time > '2023-01-01' 
ORDER BY create_time LIMIT 10;

-- âŒ å¯¼è‡´ä¸´æ—¶æ–‡ä»¶IO
SELECT user_id, COUNT(*) 
FROM large_table 
GROUP BY user_id 
HAVING COUNT(*) > 100;

-- âœ… ä½¿ç”¨ç´¢å¼•é¿å…ä¸´æ—¶è¡¨
-- åˆ›å»ºåˆé€‚çš„å¤åˆç´¢å¼•
CREATE INDEX idx_user_composite ON large_table(user_id, status);
```

**ğŸ”¸ å­˜å‚¨é…ç½®ä¼˜åŒ–**

```sql
-- æŸ¥çœ‹IOç›¸å…³é…ç½®
SHOW VARIABLES LIKE 'innodb_page_size';          -- é¡µé¢å¤§å°
SHOW VARIABLES LIKE 'innodb_io_capacity';        -- IOå®¹é‡
SHOW VARIABLES LIKE 'innodb_flush_method';       -- åˆ·æ–°æ–¹æ³•

-- ç›‘æ§IOçŠ¶æ€
SHOW STATUS LIKE 'Innodb_data_read%';            -- è¯»å–é‡
SHOW STATUS LIKE 'Innodb_data_written%';         -- å†™å…¥é‡
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 MySQLæ€§èƒ½ç“¶é¢ˆè¯†åˆ«


**ğŸ¯ æ€§èƒ½é—®é¢˜è¯Šæ–­æ€è·¯**

```
æ€§èƒ½é—®é¢˜å‡ºç°
        â†“
ç¡®å®šç“¶é¢ˆä½ç½®
â”œâ”€â”€ CPUä½¿ç”¨ç‡é«˜ â†’ æŸ¥è¯¢ä¼˜åŒ–å™¨ã€å¤æ‚è®¡ç®—
â”œâ”€â”€ å†…å­˜ä¸è¶³ â†’ Buffer Poolã€è¿æ¥æ•°
â”œâ”€â”€ IOç­‰å¾…é«˜ â†’ ç£ç›˜æ€§èƒ½ã€ç´¢å¼•è®¾è®¡
â””â”€â”€ ç½‘ç»œå»¶è¿Ÿ â†’ ç»“æœé›†å¤§å°ã€è¿æ¥ç®¡ç†
        â†“
é’ˆå¯¹æ€§ä¼˜åŒ–
```

### 9.2 å…³é”®æ€§èƒ½æŒ‡æ ‡


| **æŒ‡æ ‡ç±»åˆ«** | **å…³é”®æŒ‡æ ‡** | **å¥åº·æ ‡å‡†** | **ä¼˜åŒ–é‡ç‚¹** |
|-------------|-------------|-------------|-------------|
| **ç¼“å­˜æ€§èƒ½** | `Buffer Poolå‘½ä¸­ç‡` | `> 99%` | `å¢å¤§ç¼“å†²æ± ï¼Œä¼˜åŒ–æŸ¥è¯¢` |
| **IOæ€§èƒ½** | `ç£ç›˜IOç­‰å¾…æ—¶é—´` | `< 10ms` | `ä½¿ç”¨SSDï¼Œä¼˜åŒ–ç´¢å¼•` |
| **è¿æ¥æ€§èƒ½** | `è¿æ¥ä½¿ç”¨ç‡` | `< 80%` | `ä½¿ç”¨è¿æ¥æ± ï¼Œä¼˜åŒ–è¿æ¥æ•°` |
| **æŸ¥è¯¢æ€§èƒ½** | `æ…¢æŸ¥è¯¢æ¯”ä¾‹` | `< 1%` | `ç´¢å¼•ä¼˜åŒ–ï¼ŒæŸ¥è¯¢é‡å†™` |

### 9.3 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ


**ğŸ’¡ æ ¸å¿ƒä¼˜åŒ–åŸåˆ™**

```
ğŸ”¸ å‡å°‘æ•°æ®è®¿é—®é‡
â€¢ ä½¿ç”¨LIMITé™åˆ¶ç»“æœé›†
â€¢ åªæŸ¥è¯¢éœ€è¦çš„åˆ—
â€¢ åˆç†ä½¿ç”¨WHEREæ¡ä»¶

ğŸ”¸ æé«˜ç¼“å­˜å‘½ä¸­ç‡  
â€¢ å¢å¤§Buffer Pool
â€¢ ä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼
â€¢ å‡å°‘å†·æ•°æ®è®¿é—®

ğŸ”¸ å‡å°‘IOæ“ä½œ
â€¢ åˆ›å»ºåˆé€‚ç´¢å¼•
â€¢ é¿å…ä¸´æ—¶è¡¨ç”Ÿæˆ
â€¢ æ‰¹é‡æ“ä½œä»£æ›¿å•è¡Œæ“ä½œ

ğŸ”¸ ä¼˜åŒ–ç½‘ç»œä¼ è¾“
â€¢ ä½¿ç”¨è¿æ¥æ± 
â€¢ å‡å°‘ç½‘ç»œå¾€è¿”
â€¢ æ§åˆ¶ç»“æœé›†å¤§å°
```

### 9.4 æ€§èƒ½ç›‘æ§è¦ç‚¹


**ğŸ“Š æ—¥å¸¸ç›‘æ§æŒ‡æ ‡**

```sql
-- æ¯æ—¥å¿…æ£€æŒ‡æ ‡
SHOW STATUS LIKE 'Threads_connected';     -- å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Slow_queries';          -- æ…¢æŸ¥è¯¢æ•°é‡
SHOW STATUS LIKE 'Questions';             -- æ€»æŸ¥è¯¢æ•°
SHOW PROCESSLIST;                         -- å½“å‰æ‰§è¡Œçš„æŸ¥è¯¢

-- ç¼“å­˜æ€§èƒ½ç›‘æ§  
SHOW STATUS LIKE 'Innodb_buffer_pool_read_requests';
SHOW STATUS LIKE 'Innodb_buffer_pool_reads';

-- IOæ€§èƒ½ç›‘æ§
SHOW STATUS LIKE 'Innodb_data%';          -- æ•°æ®è¯»å†™ç»Ÿè®¡
```

**æ ¸å¿ƒè®°å¿†è¦ç‚¹**ï¼š
- **æ‰§è¡Œæµç¨‹**ï¼šè¿æ¥â†’è§£æâ†’ä¼˜åŒ–â†’æ‰§è¡Œâ†’å­˜å‚¨å¼•æ“â†’è¿”å›ç»“æœ
- **æ€§èƒ½ç“¶é¢ˆ**ï¼šIOæ“ä½œæ˜¯æœ€å¤§ç“¶é¢ˆï¼Œç¼“å­˜å‘½ä¸­æ˜¯å…³é”®ä¼˜åŒ–ç‚¹
- **ä¼˜åŒ–æ€è·¯**ï¼šå‡å°‘è®¿é—®é‡â†’æé«˜å‘½ä¸­ç‡â†’å‡å°‘IOâ†’ä¼˜åŒ–ç½‘ç»œ
- **ç›‘æ§é‡ç‚¹**ï¼šç¼“å­˜å‘½ä¸­ç‡ã€IOç­‰å¾…ã€è¿æ¥æ•°ã€æ…¢æŸ¥è¯¢æ¯”ä¾‹