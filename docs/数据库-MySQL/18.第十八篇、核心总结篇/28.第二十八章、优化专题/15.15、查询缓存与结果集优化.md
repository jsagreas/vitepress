---
title: 15ã€æŸ¥è¯¢ç¼“å­˜ä¸ç»“æœé›†ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [æŸ¥è¯¢ç¼“å­˜åŸºç¡€æ¦‚å¿µ](#1-æŸ¥è¯¢ç¼“å­˜åŸºç¡€æ¦‚å¿µ)
2. [Query Cacheé…ç½®ä½¿ç”¨](#2-Query-Cacheé…ç½®ä½¿ç”¨)
3. [æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ä¼˜åŒ–](#3-æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ä¼˜åŒ–)
4. [ç»“æœé›†ç¼“å­˜ç­–ç•¥](#4-ç»“æœé›†ç¼“å­˜ç­–ç•¥)
5. [åº”ç”¨å±‚ç¼“å­˜é›†æˆ](#5-åº”ç”¨å±‚ç¼“å­˜é›†æˆ)
6. [ç¼“å­˜å¤±æ•ˆæœºåˆ¶](#6-ç¼“å­˜å¤±æ•ˆæœºåˆ¶)
7. [ç¼“å­˜æ€§èƒ½ç›‘æ§](#7-ç¼“å­˜æ€§èƒ½ç›‘æ§)
8. [ç¼“å­˜ç©¿é€é¢„é˜²](#8-ç¼“å­˜ç©¿é€é¢„é˜²)
9. [ç¼“å­˜æ›´æ–°ç­–ç•¥](#9-ç¼“å­˜æ›´æ–°ç­–ç•¥)
10. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#10-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ æŸ¥è¯¢ç¼“å­˜åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯MySQLæŸ¥è¯¢ç¼“å­˜


**ğŸ”¸ æ ¸å¿ƒå®šä¹‰**
```
MySQLæŸ¥è¯¢ç¼“å­˜ï¼ˆQuery Cacheï¼‰ï¼š
ä¸€ç§å°†SELECTè¯­å¥çš„æ‰§è¡Œç»“æœç›´æ¥å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æœºåˆ¶
å½“ç›¸åŒçš„æŸ¥è¯¢å†æ¬¡æ‰§è¡Œæ—¶ï¼Œç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼Œè·³è¿‡è§£æã€ä¼˜åŒ–ã€æ‰§è¡Œæ­¥éª¤

ç®€å•ç†è§£ï¼šæŠŠæŸ¥è¯¢ç»“æœ"è®°ä½"ï¼Œä¸‹æ¬¡åŒæ ·æŸ¥è¯¢ç›´æ¥ç»™ç­”æ¡ˆ
```

**ğŸ’¡ å·¥ä½œåŸç†å›¾ç¤º**
```
å®¢æˆ·ç«¯æŸ¥è¯¢ â†’ MySQLæœåŠ¡å™¨
              â†“
          æŸ¥è¯¢ç¼“å­˜æ£€æŸ¥
              â†“
    æœ‰ç¼“å­˜ï¼Ÿ â†â€”â€” æ˜¯ â€”â€”â†’ ç›´æ¥è¿”å›ç»“æœ
       â†“å¦
    æ‰§è¡ŒæŸ¥è¯¢å¼•æ“
       â†“
    å­˜å‚¨ç»“æœåˆ°ç¼“å­˜
       â†“
    è¿”å›ç»“æœç»™å®¢æˆ·ç«¯
```

### 1.2 æŸ¥è¯¢ç¼“å­˜çš„ä»·å€¼


**âš¡ æ€§èƒ½æå‡**
```
ä¼ ç»ŸæŸ¥è¯¢æµç¨‹ï¼š
SQLè§£æ â†’ ä¼˜åŒ–å™¨å¤„ç† â†’ å­˜å‚¨å¼•æ“æ‰§è¡Œ â†’ è¿”å›ç»“æœ
è€—æ—¶ï¼šé€šå¸¸å‡ æ¯«ç§’åˆ°å‡ ç§’

ç¼“å­˜å‘½ä¸­æµç¨‹ï¼š
ç¼“å­˜æŸ¥æ‰¾ â†’ ç›´æ¥è¿”å›ç»“æœ
è€—æ—¶ï¼šé€šå¸¸å‡ å¾®ç§’

æ€§èƒ½æå‡ï¼šå¯è¾¾10-100å€é€Ÿåº¦æå‡ï¼ˆç®€å•æŸ¥è¯¢ï¼‰
```

**ğŸ¯ é€‚ç”¨åœºæ™¯**
- **è¯»å¤šå†™å°‘**ï¼šæŸ¥è¯¢é¢‘ç¹ï¼Œæ›´æ–°ä¸é¢‘ç¹çš„åœºæ™¯
- **é‡å¤æŸ¥è¯¢**ï¼šç›¸åŒSQLè¯­å¥è¢«å¤šæ¬¡æ‰§è¡Œ
- **ç®€å•æŸ¥è¯¢**ï¼šå¤æ‚åº¦ä¸é«˜çš„SELECTè¯­å¥
- **ç›¸å¯¹é™æ€æ•°æ®**ï¼šæ•°æ®å˜åŒ–ä¸é¢‘ç¹çš„è¡¨

### 1.3 æŸ¥è¯¢ç¼“å­˜çš„å±€é™æ€§


> âš ï¸ **é‡è¦è¯´æ˜**ï¼šMySQL 8.0å·²ç»ç§»é™¤äº†æŸ¥è¯¢ç¼“å­˜åŠŸèƒ½ï¼Œå› ä¸ºåœ¨ç°ä»£é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„é”ç«äº‰é—®é¢˜è¶…è¿‡äº†å…¶å¸¦æ¥çš„æ€§èƒ½æ”¶ç›Šã€‚

**ğŸš« ä¸»è¦é—®é¢˜**
```
1. é”ç«äº‰ä¸¥é‡ï¼š
   - ç¼“å­˜è¯»å†™éœ€è¦å…¨å±€é”
   - é«˜å¹¶å‘æ—¶æˆä¸ºæ€§èƒ½ç“¶é¢ˆ

2. ç¼“å­˜å¤±æ•ˆé¢‘ç¹ï¼š
   - è¡¨æœ‰ä»»ä½•æ›´æ–°ï¼Œæ‰€æœ‰ç›¸å…³ç¼“å­˜å¤±æ•ˆ
   - å¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä½

3. å†…å­˜ä½¿ç”¨ä½æ•ˆï¼š
   - ç¼“å­˜ç²’åº¦ç²—ï¼Œæµªè´¹å†…å­˜
   - æ— æ³•ç²¾ç¡®æ§åˆ¶ç¼“å­˜å†…å®¹
```

---

## 2. âš™ï¸ Query Cacheé…ç½®ä½¿ç”¨


### 2.1 æŸ¥è¯¢ç¼“å­˜é…ç½®å‚æ•°


**ğŸ“‹ æ ¸å¿ƒé…ç½®å‚æ•°**
```sql
-- æŸ¥çœ‹å½“å‰æŸ¥è¯¢ç¼“å­˜çŠ¶æ€
SHOW VARIABLES LIKE 'query_cache%';

-- ä¸»è¦å‚æ•°è¯´æ˜ï¼š
query_cache_type        -- æŸ¥è¯¢ç¼“å­˜ç±»å‹
query_cache_size        -- ç¼“å­˜æ€»å¤§å°
query_cache_limit       -- å•ä¸ªæŸ¥è¯¢ç»“æœæœ€å¤§ç¼“å­˜å¤§å°
query_cache_min_res_unit -- ç¼“å­˜å—æœ€å°åˆ†é…å•ä½
```

**ğŸ”§ é…ç½®è¯¦è§£**
```ini
# MySQLé…ç½®æ–‡ä»¶ my.cnf ç¤ºä¾‹
[mysqld]
# å¯ç”¨æŸ¥è¯¢ç¼“å­˜
query_cache_type = 1

# è®¾ç½®ç¼“å­˜å¤§å°ï¼ˆ64MBï¼‰
query_cache_size = 64M

# å•ä¸ªæŸ¥è¯¢ç»“æœæœ€å¤§ç¼“å­˜1MB
query_cache_limit = 1M

# ç¼“å­˜å—æœ€å°å•ä½4KB
query_cache_min_res_unit = 4K
```

### 2.2 query_cache_typeå‚æ•°è¯¦è§£


**ğŸ›ï¸ ç¼“å­˜ç±»å‹é€‰é¡¹**
```
0 (OFF)ï¼šå®Œå…¨å…³é—­æŸ¥è¯¢ç¼“å­˜
1 (ON)ï¼šå¼€å¯æŸ¥è¯¢ç¼“å­˜ï¼Œé™¤éä½¿ç”¨SQL_NO_CACHE
2 (DEMAND)ï¼šåªæœ‰ä½¿ç”¨SQL_CACHEæ‰ç¼“å­˜
```

**ğŸ’¡ å®é™…åº”ç”¨ç¤ºä¾‹**
```sql
-- å½“query_cache_type=1æ—¶
SELECT * FROM users WHERE id=1;     -- ä¼šè¢«ç¼“å­˜
SELECT SQL_NO_CACHE * FROM users;  -- ä¸ä¼šè¢«ç¼“å­˜

-- å½“query_cache_type=2æ—¶
SELECT * FROM users WHERE id=1;           -- ä¸ä¼šè¢«ç¼“å­˜  
SELECT SQL_CACHE * FROM users WHERE id=1; -- ä¼šè¢«ç¼“å­˜
```

### 2.3 åŠ¨æ€é…ç½®ä¸ç›‘æ§


**âš¡ åŠ¨æ€è°ƒæ•´é…ç½®**
```sql
-- è¿è¡Œæ—¶è°ƒæ•´ç¼“å­˜å¤§å°
SET GLOBAL query_cache_size = 128*1024*1024; -- 128MB

-- æ¸…ç©ºæŸ¥è¯¢ç¼“å­˜
FLUSH QUERY CACHE;

-- é‡ç½®æŸ¥è¯¢ç¼“å­˜
RESET QUERY CACHE;
```

**ğŸ“Š ç¼“å­˜çŠ¶æ€ç›‘æ§**
```sql
-- æŸ¥çœ‹ç¼“å­˜ä½¿ç”¨æƒ…å†µ
SHOW STATUS LIKE 'Qcache%';

-- ä¸»è¦æŒ‡æ ‡å«ä¹‰ï¼š
-- Qcache_hitsï¼šç¼“å­˜å‘½ä¸­æ¬¡æ•°
-- Qcache_insertsï¼šç¼“å­˜æ’å…¥æ¬¡æ•°  
-- Qcache_not_cachedï¼šæœªè¢«ç¼“å­˜çš„æŸ¥è¯¢æ•°
-- Qcache_queries_in_cacheï¼šå½“å‰ç¼“å­˜ä¸­çš„æŸ¥è¯¢æ•°
```

---

## 3. ğŸ¯ æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ä¼˜åŒ–


### 3.1 å½±å“ç¼“å­˜å‘½ä¸­çš„å› ç´ 


**ğŸ”¸ SQLè¯­å¥å®Œå…¨åŒ¹é…**
```sql
-- è¿™ä¸¤ä¸ªæŸ¥è¯¢è¢«è§†ä¸ºä¸åŒï¼Œä¸ä¼šå…±äº«ç¼“å­˜
SELECT * FROM users WHERE id = 1;
SELECT * FROM users WHERE id=1;    -- ç©ºæ ¼ä¸åŒ

-- å¤§å°å†™ä¹Ÿå½±å“åŒ¹é…
select * from users where id = 1;  -- å°å†™
SELECT * FROM users WHERE id = 1;  -- å¤§å†™
```

**ğŸ’¡ è§£å†³æ–¹æ¡ˆ**
```
1. ç»Ÿä¸€SQLæ ¼å¼ï¼š
   - ä¿æŒä¸€è‡´çš„ç©ºæ ¼ã€æ¢è¡Œ
   - ç»Ÿä¸€å¤§å°å†™é£æ ¼
   - ä½¿ç”¨ç›¸åŒçš„å¼•å·é£æ ¼

2. ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼š
   - å‡å°‘SQLå˜ä½“
   - æé«˜ç¼“å­˜å¤ç”¨ç‡
```

### 3.2 æé«˜å‘½ä¸­ç‡çš„æŠ€å·§


**ğŸ“ˆ ä¼˜åŒ–ç­–ç•¥**
```sql
-- âŒ é¿å…ä½¿ç”¨å‡½æ•°å’Œè¡¨è¾¾å¼
SELECT * FROM orders WHERE DATE(create_time) = '2023-01-01';

-- âœ… ä½¿ç”¨èŒƒå›´æŸ¥è¯¢
SELECT * FROM orders WHERE create_time >= '2023-01-01' 
AND create_time < '2023-01-02';

-- âŒ é¿å…ä½¿ç”¨ä¸ç¡®å®šå‡½æ•°
SELECT * FROM users WHERE last_login > NOW() - INTERVAL 1 DAY;

-- âœ… ä½¿ç”¨å…·ä½“æ—¶é—´
SELECT * FROM users WHERE last_login > '2023-01-01 00:00:00';
```

**ğŸ¯ ç¼“å­˜å‹å¥½çš„SQLæ¨¡å¼**
```sql
-- è‰¯å¥½çš„ç¼“å­˜æ¨¡å¼
SELECT id, name, email FROM users WHERE status = 'active';
SELECT COUNT(*) FROM products WHERE category_id = 1;
SELECT * FROM articles WHERE published = 1 ORDER BY created_at DESC LIMIT 10;
```

### 3.3 ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—


**ğŸ“Š å‘½ä¸­ç‡å…¬å¼**
```sql
-- æŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡è®¡ç®—
SELECT 
  ROUND(Qcache_hits / (Qcache_hits + Qcache_inserts) * 100, 2) AS hit_rate
FROM (
  SELECT 
    VARIABLE_VALUE AS Qcache_hits
  FROM information_schema.GLOBAL_STATUS 
  WHERE VARIABLE_NAME = 'Qcache_hits'
) h,
(
  SELECT 
    VARIABLE_VALUE AS Qcache_inserts  
  FROM information_schema.GLOBAL_STATUS
  WHERE VARIABLE_NAME = 'Qcache_inserts'
) i;
```

**âœ… ç†æƒ³æŒ‡æ ‡**
- **å‘½ä¸­ç‡ > 80%**ï¼šæŸ¥è¯¢ç¼“å­˜æ•ˆæœè‰¯å¥½
- **å‘½ä¸­ç‡ < 50%**ï¼šè€ƒè™‘å…³é—­æŸ¥è¯¢ç¼“å­˜æˆ–ä¼˜åŒ–æŸ¥è¯¢æ¨¡å¼
- **Qcache_lowmem_prunesé«˜**ï¼šéœ€è¦å¢åŠ ç¼“å­˜å¤§å°

---

## 4. ğŸ“¦ ç»“æœé›†ç¼“å­˜ç­–ç•¥


### 4.1 åº”ç”¨å±‚ç»“æœé›†ç¼“å­˜


**ğŸ”¸ Redisç¼“å­˜å®ç°**
```python
import redis
import json
import hashlib

class QueryCache:
    def __init__(self):
        self.redis_client = redis.Redis(host='localhost', port=6379, db=0)
        self.cache_expire = 3600  # 1å°æ—¶è¿‡æœŸ
    
    def get_cache_key(self, sql, params):
        """ç”Ÿæˆç¼“å­˜é”®"""
        query_string = sql + str(sorted(params.items()) if params else '')
        return f"query_cache:{hashlib.md5(query_string.encode()).hexdigest()}"
    
    def get_cached_result(self, sql, params=None):
        """è·å–ç¼“å­˜ç»“æœ"""
        cache_key = self.get_cache_key(sql, params)
        cached_data = self.redis_client.get(cache_key)
        
        if cached_data:
            return json.loads(cached_data)
        return None
    
    def cache_result(self, sql, params, result):
        """ç¼“å­˜æŸ¥è¯¢ç»“æœ"""
        cache_key = self.get_cache_key(sql, params)
        self.redis_client.setex(
            cache_key, 
            self.cache_expire, 
            json.dumps(result, default=str)
        )
```

### 4.2 åˆ†å±‚ç¼“å­˜ç­–ç•¥


**ğŸ—ï¸ å¤šçº§ç¼“å­˜æ¶æ„**
```
åº”ç”¨å†…å­˜ç¼“å­˜ï¼ˆL1ï¼‰
    â†“ æœªå‘½ä¸­
Redisç¼“å­˜ï¼ˆL2ï¼‰  
    â†“ æœªå‘½ä¸­
MySQLæ•°æ®åº“
    â†“
ç¼“å­˜å›å¡«
```

**ğŸ’¡ å®ç°ç¤ºä¾‹**
```python
class MultiLevelCache:
    def __init__(self):
        self.local_cache = {}  # L1: æœ¬åœ°å†…å­˜ç¼“å­˜
        self.redis_cache = redis.Redis()  # L2: Redisç¼“å­˜
        
    def get_data(self, key):
        # L1ç¼“å­˜æ£€æŸ¥
        if key in self.local_cache:
            return self.local_cache[key]
            
        # L2ç¼“å­˜æ£€æŸ¥
        redis_data = self.redis_cache.get(key)
        if redis_data:
            result = json.loads(redis_data)
            # å›å¡«L1ç¼“å­˜
            self.local_cache[key] = result
            return result
            
        # æ•°æ®åº“æŸ¥è¯¢
        result = self.query_database(key)
        
        # å›å¡«æ‰€æœ‰ç¼“å­˜å±‚
        self.local_cache[key] = result
        self.redis_cache.setex(key, 3600, json.dumps(result))
        
        return result
```

### 4.3 ç¼“å­˜ç²’åº¦æ§åˆ¶


**ğŸ¯ ä¸åŒç²’åº¦çš„ç¼“å­˜ç­–ç•¥**

| ç¼“å­˜ç²’åº¦ | **åº”ç”¨åœºæ™¯** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** |
|---------|------------|---------|----------|
| **é¡µé¢çº§** | `é™æ€é¡µé¢ï¼ŒæŠ¥è¡¨é¡µ` | `å‘½ä¸­ç‡é«˜ï¼Œå®ç°ç®€å•` | `æ›´æ–°ç²’åº¦ç²—ï¼Œå†…å­˜å ç”¨å¤§` |
| **æŸ¥è¯¢çº§** | `å¤æ‚æŸ¥è¯¢ï¼ŒèšåˆæŸ¥è¯¢` | `ç²¾ç¡®æ§åˆ¶ï¼Œçµæ´»æ€§å¥½` | `å‘½ä¸­ç‡ç›¸å¯¹è¾ƒä½` |
| **å¯¹è±¡çº§** | `ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“è¯¦æƒ…` | `æ›´æ–°ç²¾ç¡®ï¼Œå¤ç”¨æ€§å¥½` | `å®ç°å¤æ‚ï¼Œä¸€è‡´æ€§è¦æ±‚é«˜` |
| **å­—æ®µçº§** | `é…ç½®é¡¹ï¼Œå­—å…¸æ•°æ®` | `é¢—ç²’åº¦æœ€ç»†ï¼Œæ•ˆç‡é«˜` | `ç®¡ç†å¤æ‚ï¼Œå¼€é”€å¤§` |

---

## 5. ğŸ”Œ åº”ç”¨å±‚ç¼“å­˜é›†æˆ


### 5.1 ORMæ¡†æ¶ç¼“å­˜é›†æˆ


**ğŸ”¸ MyBatisç¼“å­˜é…ç½®**
```xml
<!-- mybatis-config.xml -->
<configuration>
    <settings>
        <!-- å¼€å¯äºŒçº§ç¼“å­˜ -->
        <setting name="cacheEnabled" value="true"/>
    </settings>
</configuration>

<!-- Mapper.xml -->
<mapper namespace="com.example.UserMapper">
    <!-- é…ç½®ç¼“å­˜ -->
    <cache 
        eviction="LRU"
        flushInterval="60000"
        size="512"
        readOnly="false"/>
        
    <select id="getUserById" resultType="User" useCache="true">
        SELECT * FROM users WHERE id = #{id}
    </select>
</mapper>
```

**âš¡ Spring Cacheé›†æˆ**
```java
@Service
public class UserService {
    
    @Cacheable(value = "users", key = "#id")
    public User getUserById(Long id) {
        return userRepository.findById(id);
    }
    
    @CacheEvict(value = "users", key = "#user.id")
    public void updateUser(User user) {
        userRepository.save(user);
    }
    
    @Caching(evict = {
        @CacheEvict(value = "users", key = "#user.id"),
        @CacheEvict(value = "userList", allEntries = true)
    })
    public void deleteUser(User user) {
        userRepository.delete(user);
    }
}
```

### 5.2 ç¼“å­˜é…ç½®æœ€ä½³å®è·µ


**ğŸ¯ é…ç½®ä¼˜åŒ–**
```yaml
# application.yml
spring:
  cache:
    type: redis
    redis:
      time-to-live: 600000  # 10åˆ†é’Ÿè¿‡æœŸ
      cache-null-values: false  # ä¸ç¼“å­˜nullå€¼
      key-prefix: "app_cache:"
      use-key-prefix: true
      
  redis:
    host: localhost
    port: 6379
    database: 0
    jedis:
      pool:
        max-active: 100
        max-idle: 10
        min-idle: 5
        max-wait: 3000ms
```

**ğŸ’¡ ç¼“å­˜é”®å‘½åè§„èŒƒ**
```java
public class CacheKeyGenerator {
    
    public static String generateUserKey(Long userId) {
        return String.format("user:id:%d", userId);
    }
    
    public static String generateUserListKey(String status, int page, int size) {
        return String.format("user:list:%s:%d:%d", status, page, size);
    }
    
    public static String generateProductKey(Long productId) {
        return String.format("product:id:%d:v%d", productId, getDataVersion());
    }
}
```

---

## 6. âŒ ç¼“å­˜å¤±æ•ˆæœºåˆ¶


### 6.1 MySQLæŸ¥è¯¢ç¼“å­˜å¤±æ•ˆè§„åˆ™


**ğŸ”¸ å¤±æ•ˆè§¦å‘æ¡ä»¶**
```
è¡¨çº§å¤±æ•ˆï¼š
- ä»»ä½•INSERTã€UPDATEã€DELETEæ“ä½œ
- ALTER TABLEç»“æ„å˜æ›´
- TRUNCATE TABLEæ“ä½œ
- è¡¨æƒé™å˜æ›´

æŸ¥è¯¢çº§å¤±æ•ˆï¼š
- ä½¿ç”¨ç”¨æˆ·å˜é‡çš„æŸ¥è¯¢
- è°ƒç”¨ä¸ç¡®å®šå‡½æ•°ï¼ˆNOW()ã€RAND()ç­‰ï¼‰
- ä¸´æ—¶è¡¨ç›¸å…³æŸ¥è¯¢
```

**ğŸ’¡ å¤±æ•ˆç¤ºä¾‹**
```sql
-- ç¼“å­˜æœ‰æ•ˆçš„æŸ¥è¯¢
SELECT * FROM products WHERE category_id = 1;

-- æ‰§è¡Œæ›´æ–°æ“ä½œ
UPDATE products SET price = 99.9 WHERE id = 1;

-- ä¹‹å‰çš„ç¼“å­˜å…¨éƒ¨å¤±æ•ˆ
-- ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦é‡æ–°æ‰§è¡Œ
SELECT * FROM products WHERE category_id = 1;  -- ä¸ä¼šå‘½ä¸­ç¼“å­˜
```

### 6.2 åº”ç”¨å±‚ç¼“å­˜å¤±æ•ˆç­–ç•¥


**â° TTLè¿‡æœŸç­–ç•¥**
```python
class TTLCache:
    def __init__(self):
        self.cache = {}
        self.expire_times = {}
    
    def set(self, key, value, ttl_seconds):
        import time
        self.cache[key] = value
        self.expire_times[key] = time.time() + ttl_seconds
    
    def get(self, key):
        import time
        if key in self.cache:
            if time.time() < self.expire_times[key]:
                return self.cache[key]
            else:
                # è¿‡æœŸåˆ é™¤
                del self.cache[key]
                del self.expire_times[key]
        return None
```

**ğŸ¯ æ ‡ç­¾å¤±æ•ˆç­–ç•¥**
```python
class TaggedCache:
    def __init__(self):
        self.cache = {}
        self.tag_mapping = {}  # æ ‡ç­¾åˆ°é”®çš„æ˜ å°„
    
    def set(self, key, value, tags=None):
        self.cache[key] = value
        if tags:
            for tag in tags:
                if tag not in self.tag_mapping:
                    self.tag_mapping[tag] = set()
                self.tag_mapping[tag].add(key)
    
    def invalidate_by_tag(self, tag):
        """æ ¹æ®æ ‡ç­¾å¤±æ•ˆç¼“å­˜"""
        if tag in self.tag_mapping:
            for key in self.tag_mapping[tag]:
                if key in self.cache:
                    del self.cache[key]
            del self.tag_mapping[tag]
```

### 6.3 ä¸»åŠ¨å¤±æ•ˆç­–ç•¥


**ğŸ”„ ä¸šåŠ¡è§¦å‘å¤±æ•ˆ**
```java
@Service
public class ProductService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    public void updateProduct(Product product) {
        // æ›´æ–°æ•°æ®åº“
        productRepository.save(product);
        
        // ä¸»åŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜
        String productKey = "product:" + product.getId();
        String categoryKey = "category:" + product.getCategoryId() + ":products";
        
        redisTemplate.delete(productKey);
        redisTemplate.delete(categoryKey);
        
        // æ¸…é™¤æ¨¡ç³ŠåŒ¹é…çš„ç¼“å­˜
        Set<String> keys = redisTemplate.keys("product:list:*");
        if (!keys.isEmpty()) {
            redisTemplate.delete(keys);
        }
    }
}
```

---

## 7. ğŸ“Š ç¼“å­˜æ€§èƒ½ç›‘æ§


### 7.1 MySQLæŸ¥è¯¢ç¼“å­˜ç›‘æ§


**ğŸ“ˆ å…³é”®ç›‘æ§æŒ‡æ ‡**
```sql
-- ç¼“å­˜æ•ˆç‡ç›‘æ§æŸ¥è¯¢
SELECT 
  -- ç¼“å­˜å‘½ä¸­ç‡
  ROUND(
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Qcache_hits') /
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Qcache_hits') +
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Qcache_inserts')
    * 100, 2
  ) AS hit_rate_percent,
  
  -- ç¼“å­˜ä½¿ç”¨ç‡
  ROUND(
    ((SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_VARIABLES WHERE VARIABLE_NAME = 'query_cache_size') -
     (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_STATUS WHERE VARIABLE_NAME = 'Qcache_free_memory')) /
    (SELECT VARIABLE_VALUE FROM information_schema.GLOBAL_VARIABLES WHERE VARIABLE_NAME = 'query_cache_size')
    * 100, 2
  ) AS memory_usage_percent;
```

**âš¡ ç›‘æ§è„šæœ¬ç¤ºä¾‹**
```bash
#!/bin/bash
# MySQLæŸ¥è¯¢ç¼“å­˜ç›‘æ§è„šæœ¬

mysql -u root -p -e "
SELECT 
  'Query Cache Status' as Metric,
  '' as Value
UNION ALL
SELECT 'Hit Rate %', 
  ROUND(Qcache_hits/(Qcache_hits + Qcache_inserts)*100,2)
FROM information_schema.GLOBAL_STATUS 
WHERE VARIABLE_NAME IN ('Qcache_hits','Qcache_inserts')
UNION ALL  
SELECT 'Memory Usage %',
  ROUND((query_cache_size - Qcache_free_memory)/query_cache_size*100,2)
FROM information_schema.GLOBAL_STATUS s1, information_schema.GLOBAL_VARIABLES v1
WHERE s1.VARIABLE_NAME = 'Qcache_free_memory' 
AND v1.VARIABLE_NAME = 'query_cache_size';
"
```

### 7.2 åº”ç”¨å±‚ç¼“å­˜ç›‘æ§


**ğŸ“Š Redisç¼“å­˜ç›‘æ§**
```python
import redis

class CacheMonitor:
    def __init__(self, redis_client):
        self.redis = redis_client
        
    def get_cache_stats(self):
        info = self.redis.info()
        
        stats = {
            'hit_rate': self.calculate_hit_rate(info),
            'memory_usage': info.get('used_memory_human', 'N/A'),
            'connected_clients': info.get('connected_clients', 0),
            'total_commands': info.get('total_commands_processed', 0),
            'keyspace_hits': info.get('keyspace_hits', 0),
            'keyspace_misses': info.get('keyspace_misses', 0)
        }
        
        return stats
    
    def calculate_hit_rate(self, info):
        hits = info.get('keyspace_hits', 0)
        misses = info.get('keyspace_misses', 0)
        
        if hits + misses == 0:
            return 0
            
        return round(hits / (hits + misses) * 100, 2)
```

### 7.3 ç›‘æ§å‘Šè­¦é…ç½®


**ğŸš¨ å…³é”®å‘Šè­¦é˜ˆå€¼**
```yaml
# ç›‘æ§é…ç½®ç¤ºä¾‹
cache_monitoring:
  mysql_query_cache:
    hit_rate_threshold: 70  # å‘½ä¸­ç‡ä½äº70%å‘Šè­¦
    memory_usage_threshold: 90  # å†…å­˜ä½¿ç”¨è¶…è¿‡90%å‘Šè­¦
    
  redis_cache:
    hit_rate_threshold: 80  # å‘½ä¸­ç‡ä½äº80%å‘Šè­¦
    memory_usage_threshold: 85  # å†…å­˜ä½¿ç”¨è¶…è¿‡85%å‘Šè­¦
    connection_threshold: 1000  # è¿æ¥æ•°è¶…è¿‡1000å‘Šè­¦
    
  alert_channels:
    - email: admin@example.com
    - slack: "#alerts"
```

---

## 8. ğŸ›¡ï¸ ç¼“å­˜ç©¿é€é¢„é˜²


### 8.1 ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€


**ğŸ”¸ é—®é¢˜æè¿°**
```
ç¼“å­˜ç©¿é€ï¼šæŸ¥è¯¢ä¸€ä¸ªè‚¯å®šä¸å­˜åœ¨çš„æ•°æ®

æµç¨‹ï¼š
åº”ç”¨æŸ¥è¯¢ â†’ ç¼“å­˜æœªå‘½ä¸­ â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ è¿”å›ç©ºç»“æœ â†’ ä¸ç¼“å­˜ç©ºç»“æœ
ä¸‹æ¬¡ç›¸åŒæŸ¥è¯¢é‡å¤ä¸Šè¿°æµç¨‹

å±å®³ï¼š
- å¤§é‡æ— æ•ˆæŸ¥è¯¢ç›´è¾¾æ•°æ®åº“
- å¯èƒ½è¢«æ¶æ„åˆ©ç”¨è¿›è¡Œæ”»å‡»
- æ•°æ®åº“å‹åŠ›æ¿€å¢
```

**ğŸ’¡ å…¸å‹åœºæ™¯**
```sql
-- æ¶æ„æŸ¥è¯¢ä¸å­˜åœ¨çš„ç”¨æˆ·ID
SELECT * FROM users WHERE id = -1;
SELECT * FROM users WHERE id = 99999999;

-- æŸ¥è¯¢ä¸å­˜åœ¨çš„å•†å“
SELECT * FROM products WHERE id = 'invalid_id';
```

### 8.2 ç¼“å­˜ç©ºå€¼ç­–ç•¥


**âœ… ç©ºå€¼ç¼“å­˜å®ç°**
```python
class AntiPenetrationCache:
    def __init__(self, redis_client):
        self.redis = redis_client
        self.null_cache_ttl = 300  # ç©ºå€¼ç¼“å­˜5åˆ†é’Ÿ
        
    def get_user(self, user_id):
        cache_key = f"user:{user_id}"
        
        # æ£€æŸ¥ç¼“å­˜
        cached_data = self.redis.get(cache_key)
        if cached_data:
            if cached_data == "NULL":
                return None  # ç¼“å­˜çš„ç©ºå€¼
            return json.loads(cached_data)
        
        # æŸ¥è¯¢æ•°æ®åº“
        user = self.query_user_from_db(user_id)
        
        if user:
            # ç¼“å­˜çœŸå®æ•°æ®
            self.redis.setex(cache_key, 3600, json.dumps(user))
        else:
            # ç¼“å­˜ç©ºå€¼ï¼Œè®¾ç½®è¾ƒçŸ­TTL
            self.redis.setex(cache_key, self.null_cache_ttl, "NULL")
            
        return user
```

### 8.3 å¸ƒéš†è¿‡æ»¤å™¨é¢„é˜²


**ğŸ” å¸ƒéš†è¿‡æ»¤å™¨å®ç°**
```python
import redis
import mmh3  # MurmurHash

class BloomFilter:
    def __init__(self, redis_client, key_prefix, capacity=1000000, error_rate=0.001):
        self.redis = redis_client
        self.key = key_prefix
        self.capacity = capacity
        self.error_rate = error_rate
        
        # è®¡ç®—å¸ƒéš†è¿‡æ»¤å™¨å‚æ•°
        self.bit_size = self.calculate_bit_size()
        self.hash_count = self.calculate_hash_count()
    
    def add(self, item):
        """æ·»åŠ å…ƒç´ åˆ°å¸ƒéš†è¿‡æ»¤å™¨"""
        for i in range(self.hash_count):
            digest = mmh3.hash(str(item), i) % self.bit_size
            self.redis.setbit(self.key, digest, 1)
    
    def contains(self, item):
        """æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯èƒ½å­˜åœ¨"""
        for i in range(self.hash_count):
            digest = mmh3.hash(str(item), i) % self.bit_size
            if not self.redis.getbit(self.key, digest):
                return False
        return True

# ä½¿ç”¨ç¤ºä¾‹
class UserService:
    def __init__(self):
        self.redis = redis.Redis()
        self.bloom_filter = BloomFilter(self.redis, "user_bloom", 1000000)
        
    def get_user(self, user_id):
        # å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨
        if not self.bloom_filter.contains(user_id):
            return None  # è‚¯å®šä¸å­˜åœ¨
            
        # å¯èƒ½å­˜åœ¨ï¼Œç»§ç»­æ­£å¸¸æŸ¥è¯¢æµç¨‹
        return self.query_user_with_cache(user_id)
```

### 8.4 å‚æ•°æ ¡éªŒé¢„é˜²


**ğŸ›¡ï¸ è¾“å…¥éªŒè¯**
```java
@RestController
public class UserController {
    
    @GetMapping("/user/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        // å‚æ•°æ ¡éªŒ
        if (id == null || id <= 0 || id > 1000000) {
            return ResponseEntity.badRequest().build();
        }
        
        User user = userService.getUser(id);
        if (user == null) {
            return ResponseEntity.notFound().build();
        }
        
        return ResponseEntity.ok(user);
    }
}
```

---

## 9. ğŸ”„ ç¼“å­˜æ›´æ–°ç­–ç•¥


### 9.1 æ›´æ–°ç­–ç•¥å¯¹æ¯”


**ğŸ“‹ å¸¸è§æ›´æ–°æ¨¡å¼**

| ç­–ç•¥ | **æè¿°** | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|------|----------|----------|----------|-------------|
| **Cache Aside** | `åº”ç”¨åŒæ—¶ç»´æŠ¤ç¼“å­˜å’Œæ•°æ®åº“` | `ç®€å•ç›´è§‚ï¼Œä¸€è‡´æ€§å¥½` | `ä»£ç è€¦åˆåº¦é«˜` | `è¯»å¤šå†™å°‘åœºæ™¯` |
| **Write Through** | `å†™å…¥æ—¶åŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“` | `ä¸€è‡´æ€§å¼º` | `å†™å…¥å»¶è¿Ÿé«˜` | `å¼ºä¸€è‡´æ€§è¦æ±‚` |
| **Write Behind** | `å…ˆå†™ç¼“å­˜ï¼Œå¼‚æ­¥å†™æ•°æ®åº“` | `å†™å…¥æ€§èƒ½å¥½` | `å¯èƒ½ä¸¢å¤±æ•°æ®` | `é«˜æ€§èƒ½å†™å…¥åœºæ™¯` |
| **Refresh Ahead** | `ç¼“å­˜åˆ°æœŸå‰ä¸»åŠ¨åˆ·æ–°` | `ç”¨æˆ·ä½“éªŒå¥½` | `å®ç°å¤æ‚` | `çƒ­ç‚¹æ•°æ®åœºæ™¯` |

### 9.2 Cache Asideæ¨¡å¼å®ç°


**ğŸ”¸ è¯»æµç¨‹**
```python
def get_user(user_id):
    # 1. å…ˆæŸ¥ç¼“å­˜
    cache_key = f"user:{user_id}"
    user = redis_client.get(cache_key)
    
    if user:
        return json.loads(user)
    
    # 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
    user = db.query("SELECT * FROM users WHERE id = %s", user_id)
    
    if user:
        # 3. æ›´æ–°ç¼“å­˜
        redis_client.setex(cache_key, 3600, json.dumps(user))
    
    return user
```

**ğŸ”¸ å†™æµç¨‹**
```python
def update_user(user_id, user_data):
    # 1. å…ˆæ›´æ–°æ•°æ®åº“
    db.execute("UPDATE users SET name=%s WHERE id=%s", 
               user_data['name'], user_id)
    
    # 2. åˆ é™¤ç¼“å­˜ï¼ˆä¸‹æ¬¡è¯»å–æ—¶é‡æ–°åŠ è½½ï¼‰
    cache_key = f"user:{user_id}"
    redis_client.delete(cache_key)
    
    # æˆ–è€…é€‰æ‹©æ›´æ–°ç¼“å­˜
    # redis_client.setex(cache_key, 3600, json.dumps(user_data))
```

### 9.3 å¼‚æ­¥æ›´æ–°ç­–ç•¥


**âš¡ æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥æ›´æ–°**
```python
import pika

class AsyncCacheUpdater:
    def __init__(self):
        self.connection = pika.BlockingConnection(
            pika.ConnectionParameters('localhost'))
        self.channel = self.connection.channel()
        self.channel.queue_declare(queue='cache_update')
    
    def publish_update(self, operation, table, record_id, data=None):
        message = {
            'operation': operation,  # 'update', 'delete'
            'table': table,
            'record_id': record_id,
            'data': data,
            'timestamp': time.time()
        }
        
        self.channel.basic_publish(
            exchange='',
            routing_key='cache_update',
            body=json.dumps(message)
        )
    
    def process_cache_updates(self):
        def callback(ch, method, properties, body):
            message = json.loads(body)
            
            if message['operation'] == 'update':
                self.update_cache(message)
            elif message['operation'] == 'delete':
                self.delete_cache(message)
                
            ch.basic_ack(delivery_tag=method.delivery_tag)
        
        self.channel.basic_qos(prefetch_count=1)
        self.channel.basic_consume(queue='cache_update', on_message_callback=callback)
        self.channel.start_consuming()
```

### 9.4 ç¼“å­˜é¢„çƒ­ç­–ç•¥


**ğŸ”¥ åº”ç”¨å¯åŠ¨é¢„çƒ­**
```python
class CacheWarmer:
    def __init__(self, redis_client, db_client):
        self.redis = redis_client
        self.db = db_client
    
    def warm_up_hot_data(self):
        """é¢„çƒ­çƒ­ç‚¹æ•°æ®"""
        
        # 1. é¢„çƒ­çƒ­é—¨å•†å“
        hot_products = self.db.query("""
            SELECT * FROM products 
            WHERE view_count > 1000 
            ORDER BY view_count DESC 
            LIMIT 100
        """)
        
        for product in hot_products:
            cache_key = f"product:{product['id']}"
            self.redis.setex(cache_key, 7200, json.dumps(product))
        
        # 2. é¢„çƒ­ç³»ç»Ÿé…ç½®
        configs = self.db.query("SELECT * FROM system_config")
        for config in configs:
            cache_key = f"config:{config['key']}"
            self.redis.setex(cache_key, 86400, config['value'])
        
        # 3. é¢„çƒ­ç”¨æˆ·ä¼šè¯æ•°æ®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        active_sessions = self.db.query("""
            SELECT user_id FROM user_sessions 
            WHERE last_active > NOW() - INTERVAL 1 HOUR
        """)
        
        for session in active_sessions:
            user = self.get_user_info(session['user_id'])
            if user:
                cache_key = f"user:{session['user_id']}"
                self.redis.setex(cache_key, 3600, json.dumps(user))
```

---

## 10. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 10.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æŸ¥è¯¢ç¼“å­˜æœ¬è´¨ï¼šå°†æŸ¥è¯¢ç»“æœå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé¿å…é‡å¤æ‰§è¡Œ
ğŸ”¸ ç¼“å­˜å‘½ä¸­æ¡ä»¶ï¼šSQLè¯­å¥å®Œå…¨åŒ¹é…ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€å¤§å°å†™
ğŸ”¸ ç¼“å­˜å¤±æ•ˆæœºåˆ¶ï¼šè¡¨çº§å¤±æ•ˆï¼Œä»»ä½•å†™æ“ä½œéƒ½ä¼šæ¸…ç©ºç›¸å…³ç¼“å­˜
ğŸ”¸ åº”ç”¨å±‚ç¼“å­˜ï¼šRedisã€Memcachedç­‰ç‹¬ç«‹ç¼“å­˜ç³»ç»Ÿ
ğŸ”¸ ç¼“å­˜ç©¿é€ï¼šæŸ¥è¯¢ä¸å­˜åœ¨æ•°æ®å¯¼è‡´çš„ç¼“å­˜ç»•è¿‡é—®é¢˜
ğŸ”¸ æ›´æ–°ç­–ç•¥ï¼šCache Asideã€Write Throughã€Write Behindç­‰æ¨¡å¼
```

### 10.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ MySQLæŸ¥è¯¢ç¼“å­˜çš„é€‚ç”¨æ€§**
```
é€‚ç”¨åœºæ™¯ï¼š
âœ… è¯»å¤šå†™å°‘çš„åº”ç”¨
âœ… é‡å¤æŸ¥è¯¢è¾ƒå¤š  
âœ… æŸ¥è¯¢ç›¸å¯¹ç®€å•
âœ… æ•°æ®å˜åŒ–ä¸é¢‘ç¹

ä¸é€‚ç”¨åœºæ™¯ï¼š
âŒ é«˜å¹¶å‘å†™å…¥åœºæ™¯
âŒ æŸ¥è¯¢æ¨¡å¼å¤šæ ·åŒ–
âŒ å®æ—¶æ€§è¦æ±‚æé«˜
âŒ MySQL 8.0+ï¼ˆå·²ç§»é™¤åŠŸèƒ½ï¼‰
```

**ğŸ”¹ åº”ç”¨å±‚ç¼“å­˜è®¾è®¡åŸåˆ™**
```
è®¾è®¡è€ƒè™‘ï¼š
- ç¼“å­˜ç²’åº¦ï¼šé¡µé¢çº§ vs å¯¹è±¡çº§ vs å­—æ®µçº§
- è¿‡æœŸç­–ç•¥ï¼šTTL vs ä¸»åŠ¨å¤±æ•ˆ
- ä¸€è‡´æ€§ï¼šå¼ºä¸€è‡´ vs æœ€ç»ˆä¸€è‡´
- å®¹é”™æœºåˆ¶ï¼šç¼“å­˜é›ªå´©ã€ç©¿é€ã€å‡»ç©¿é¢„é˜²
```

**ğŸ”¹ æ€§èƒ½ä¼˜åŒ–è¦ç‚¹**
```
ç›‘æ§æŒ‡æ ‡ï¼š
- ç¼“å­˜å‘½ä¸­ç‡ > 80%
- å†…å­˜ä½¿ç”¨ç‡ < 85%  
- å“åº”æ—¶é—´ < 100ms
- é”™è¯¯ç‡ < 0.1%
```

### 10.3 å®é™…åº”ç”¨ä»·å€¼


**ğŸ¯ ä¸šåŠ¡åœºæ™¯åº”ç”¨**
- **ç”µå•†ç³»ç»Ÿ**ï¼šå•†å“è¯¦æƒ…ã€åˆ†ç±»åˆ—è¡¨ã€ç”¨æˆ·è´­ç‰©è½¦
- **å†…å®¹ç®¡ç†**ï¼šæ–‡ç« å†…å®¹ã€è¯„è®ºåˆ—è¡¨ã€æ ‡ç­¾åˆ†ç±»
- **ç”¨æˆ·ç³»ç»Ÿ**ï¼šç”¨æˆ·ä¿¡æ¯ã€æƒé™æ•°æ®ã€ä¼šè¯çŠ¶æ€
- **é…ç½®ç®¡ç†**ï¼šç³»ç»Ÿé…ç½®ã€å­—å…¸æ•°æ®ã€è§„åˆ™å¼•æ“

**ğŸ”§ è¿ç»´å®è·µ**
- **å®¹é‡è§„åˆ’**ï¼šæ ¹æ®ä¸šåŠ¡é‡è¯„ä¼°ç¼“å­˜éœ€æ±‚
- **æ€§èƒ½è°ƒä¼˜**ï¼šåŸºäºç›‘æ§æ•°æ®ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
- **æ•…éšœå¤„ç†**ï¼šå»ºç«‹ç¼“å­˜æ•…éšœåº”æ€¥é¢„æ¡ˆ
- **æˆæœ¬æ§åˆ¶**ï¼šå¹³è¡¡ç¼“å­˜æ”¶ç›Šä¸èµ„æºæŠ•å…¥

**æ ¸å¿ƒè®°å¿†**ï¼š
- ç¼“å­˜æ˜¯æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ‰‹æ®µï¼Œä½†ä¸æ˜¯é“¶å¼¹
- åˆç†çš„ç¼“å­˜ç­–ç•¥éœ€è¦ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯
- ç›‘æ§å’Œè¿ç»´æ˜¯ä¿éšœç¼“å­˜æ•ˆæœçš„å…³é”®
- ç¼“å­˜ä¸€è‡´æ€§å’Œæ•°æ®å‡†ç¡®æ€§éœ€è¦ä»”ç»†å¹³è¡¡