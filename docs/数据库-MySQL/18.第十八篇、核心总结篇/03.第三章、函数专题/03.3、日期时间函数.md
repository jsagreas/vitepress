---
title: 3、日期时间函数
---
## 📚 目录

1. [获取当前时间](#1-获取当前时间)
2. [时间格式化](#2-时间格式化)
3. [时间计算](#3-时间计算)
4. [时间提取](#4-时间提取)
5. [时间戳转换](#5-时间戳转换)
6. [核心要点总结](#6-核心要点总结)

---

## 1. ⏰ 获取当前时间


### 1.1 什么是当前时间函数


**🔸 核心概念**
```
当前时间函数：MySQL内置的获取系统当前时间的函数
作用：在SQL查询中动态获取执行时的时间信息
应用场景：记录操作时间、生成时间戳、时间条件查询
```

当前时间函数就像是MySQL的"时钟"，告诉你现在是什么时候。就好比你看手机上的时间一样，每次调用这些函数都会返回当前的时间信息。

### 1.2 NOW() - 当前日期时间


**💡 NOW()函数详解**
```sql
-- 基本用法
SELECT NOW();
-- 结果：2025-01-15 14:30:25

-- 插入记录时使用
INSERT INTO orders (order_id, create_time) 
VALUES (1001, NOW());

-- 查询条件中使用
SELECT * FROM users 
WHERE register_time >= NOW() - INTERVAL 7 DAY;
```

**🔍 NOW()特点**
- **返回格式**：`YYYY-MM-DD HH:MM:SS`（年-月-日 时:分:秒）
- **精确度**：精确到秒
- **用途**：最常用的时间函数，同时包含日期和时间信息

> 💡 **通俗理解**  
> NOW()就像问"现在几点了？"，它会告诉你完整的日期和时间，比如"2025年1月15日下午2点30分25秒"

### 1.3 CURDATE() - 当前日期


**📅 CURDATE()函数详解**
```sql
-- 基本用法
SELECT CURDATE();
-- 结果：2025-01-15

-- 查询今天的订单
SELECT * FROM orders 
WHERE DATE(create_time) = CURDATE();

-- 计算年龄
SELECT name, 
       YEAR(CURDATE()) - YEAR(birthday) AS age
FROM users;
```

**🔍 CURDATE()特点**
- **返回格式**：`YYYY-MM-DD`（只有日期，没有时间）
- **等价写法**：`CURRENT_DATE`和`CURRENT_DATE()`
- **用途**：只需要日期信息时使用

> 💡 **通俗理解**  
> CURDATE()就像看日历，只告诉你今天是哪一天，不关心具体的时间点

### 1.4 CURTIME() - 当前时间


**🕐 CURTIME()函数详解**
```sql
-- 基本用法
SELECT CURTIME();
-- 结果：14:30:25

-- 记录操作时间（只关心时间不关心日期）
UPDATE settings 
SET last_update_time = CURTIME() 
WHERE setting_name = 'theme';

-- 查询特定时间段的数据
SELECT * FROM logs 
WHERE TIME(create_time) BETWEEN '09:00:00' AND CURTIME();
```

**🔍 CURTIME()特点**
- **返回格式**：`HH:MM:SS`（只有时间，没有日期）
- **等价写法**：`CURRENT_TIME`和`CURRENT_TIME()`
- **用途**：只需要时间信息时使用

> 💡 **通俗理解**  
> CURTIME()就像只看手表的时针，只告诉你现在是几点几分，不管是哪一天

### 1.5 CURRENT_TIMESTAMP - 当前时间戳


**⏱️ CURRENT_TIMESTAMP详解**
```sql
-- 基本用法
SELECT CURRENT_TIMESTAMP;
-- 结果：2025-01-15 14:30:25

-- 在表结构中设置默认值
CREATE TABLE user_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 更新时自动记录时间
CREATE TABLE articles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

**🔍 CURRENT_TIMESTAMP特点**
- **功能**：与NOW()完全相同
- **优势**：符合SQL标准，兼容性更好
- **常用场景**：表结构定义中的默认值

### 1.6 函数对比总结


| 函数 | **返回格式** | **包含内容** | **典型用途** |
|------|-------------|-------------|-------------|
| `NOW()` | `2025-01-15 14:30:25` | 日期+时间 | 通用时间记录 |
| `CURDATE()` | `2025-01-15` | 仅日期 | 日期计算、筛选 |
| `CURTIME()` | `14:30:25` | 仅时间 | 时间段分析 |
| `CURRENT_TIMESTAMP` | `2025-01-15 14:30:25` | 日期+时间 | 表结构默认值 |

**📝 使用建议**
```sql
-- ✅ 推荐：记录完整操作时间
INSERT INTO logs (message, create_time) VALUES ('用户登录', NOW());

-- ✅ 推荐：只需要日期的场景
SELECT COUNT(*) FROM orders WHERE create_date = CURDATE();

-- ✅ 推荐：表结构中使用标准函数
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
```

---

## 2. 🎨 时间格式化


### 2.1 什么是时间格式化


**🔸 核心概念**
```
时间格式化：将日期时间数据转换为指定格式的字符串
作用：让时间数据以用户友好的方式显示
应用场景：报表生成、界面显示、数据导出
```

时间格式化就像给时间"换衣服"，同样的时间可以用不同的方式展示。比如同样是2025年1月15日，可以显示为"2025-01-15"、"2025年1月15日"、"Jan 15, 2025"等不同格式。

### 2.2 DATE_FORMAT() - 日期格式化


**🎯 DATE_FORMAT()函数详解**
```sql
-- 基本语法
DATE_FORMAT(date, format)

-- 常用格式示例
SELECT 
    NOW() AS original_time,
    DATE_FORMAT(NOW(), '%Y-%m-%d') AS date_only,
    DATE_FORMAT(NOW(), '%Y年%m月%d日') AS chinese_date,
    DATE_FORMAT(NOW(), '%H:%i:%s') AS time_only,
    DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i') AS datetime_short;
```

**📋 常用格式符号**

| 格式符 | **含义** | **示例** | **说明** |
|--------|---------|---------|---------|
| `%Y` | 4位年份 | `2025` | 完整年份 |
| `%y` | 2位年份 | `25` | 年份后两位 |
| `%m` | 月份(01-12) | `01` | 带前导零 |
| `%c` | 月份(1-12) | `1` | 不带前导零 |
| `%d` | 日期(01-31) | `15` | 带前导零 |
| `%e` | 日期(1-31) | `15` | 不带前导零 |
| `%H` | 小时(00-23) | `14` | 24小时制 |
| `%h` | 小时(01-12) | `02` | 12小时制 |
| `%i` | 分钟(00-59) | `30` | 带前导零 |
| `%s` | 秒数(00-59) | `25` | 带前导零 |
| `%W` | 星期名称 | `Wednesday` | 英文全称 |
| `%w` | 星期数字 | `3` | 0=Sunday |

**💼 实际应用示例**
```sql
-- 生成友好的日期显示
SELECT 
    order_id,
    DATE_FORMAT(create_time, '%Y年%m月%d日 %H:%i') AS 创建时间,
    DATE_FORMAT(create_time, '%W, %M %d, %Y') AS 英文日期
FROM orders;

-- 按月份统计（格式化用于分组）
SELECT 
    DATE_FORMAT(create_time, '%Y-%m') AS month,
    COUNT(*) AS order_count
FROM orders 
GROUP BY DATE_FORMAT(create_time, '%Y-%m');

-- 生成文件名格式
SELECT 
    CONCAT('report_', DATE_FORMAT(NOW(), '%Y%m%d_%H%i'), '.csv') AS filename;
-- 结果：report_20250115_1430.csv
```

### 2.3 STR_TO_DATE() - 字符串转日期


**🔄 STR_TO_DATE()函数详解**
```sql
-- 基本语法
STR_TO_DATE(str, format)

-- 转换不同格式的字符串
SELECT 
    STR_TO_DATE('2025-01-15', '%Y-%m-%d') AS date1,
    STR_TO_DATE('2025年1月15日', '%Y年%m月%d日') AS date2,
    STR_TO_DATE('15/01/2025 14:30', '%d/%m/%Y %H:%i') AS datetime1;
```

**🔍 STR_TO_DATE()特点**
- **作用**：将字符串按指定格式解析为日期
- **返回值**：DATE或DATETIME类型
- **错误处理**：格式不匹配时返回NULL

**💼 实际应用场景**
```sql
-- 数据导入时格式转换
INSERT INTO events (event_name, event_date)
SELECT 
    event_name,
    STR_TO_DATE(date_string, '%m/%d/%Y')
FROM temp_import_table;

-- 处理用户输入的日期
SELECT * FROM bookings 
WHERE booking_date = STR_TO_DATE('2025年1月15日', '%Y年%m月%d日');

-- 灵活的日期查询
SET @date_input = '15-Jan-2025';
SELECT * FROM logs 
WHERE DATE(create_time) = STR_TO_DATE(@date_input, '%d-%b-%Y');
```

### 2.4 格式化最佳实践


**✅ 推荐做法**
```sql
-- 用户界面显示
SELECT 
    name,
    DATE_FORMAT(birthday, '%Y年%m月%d日') AS 生日,
    DATE_FORMAT(register_time, '%Y-%m-%d %H:%i') AS 注册时间
FROM users;

-- 报表中的时间分组
SELECT 
    DATE_FORMAT(create_time, '%Y年第%u周') AS 周期,
    SUM(amount) AS 总金额
FROM orders 
GROUP BY DATE_FORMAT(create_time, '%Y%u');
```

**⚠️ 注意事项**
- 格式符大小写敏感（%Y和%y不同）
- 字符串转日期时格式必须完全匹配
- 无效日期会返回NULL值

---

## 3. ➕ 时间计算


### 3.1 什么是时间计算


**🔸 核心概念**
```
时间计算：对日期时间进行加减运算
作用：计算过去或未来的时间点、计算时间间隔
应用场景：有效期计算、统计分析、业务逻辑判断
```

时间计算就像做数学题，但操作的是时间。比如"3天后是几号？"、"两个日期相差多少天？"这类问题，MySQL的时间计算函数可以轻松解决。

### 3.2 DATE_ADD() - 日期加法


**➕ DATE_ADD()函数详解**
```sql
-- 基本语法
DATE_ADD(date, INTERVAL expr unit)

-- 各种时间单位的加法
SELECT 
    NOW() AS 当前时间,
    DATE_ADD(NOW(), INTERVAL 1 DAY) AS 明天,
    DATE_ADD(NOW(), INTERVAL 1 WEEK) AS 一周后,
    DATE_ADD(NOW(), INTERVAL 1 MONTH) AS 一个月后,
    DATE_ADD(NOW(), INTERVAL 1 YEAR) AS 一年后,
    DATE_ADD(NOW(), INTERVAL 2 HOUR) AS 两小时后;
```

**📅 支持的时间单位**

| 单位 | **说明** | **示例** | **用途** |
|------|---------|---------|---------|
| `YEAR` | 年 | `INTERVAL 1 YEAR` | 年度计算 |
| `MONTH` | 月 | `INTERVAL 3 MONTH` | 季度、月度 |
| `WEEK` | 周 | `INTERVAL 2 WEEK` | 周期性任务 |
| `DAY` | 天 | `INTERVAL 7 DAY` | 日常计算 |
| `HOUR` | 小时 | `INTERVAL 12 HOUR` | 时段分析 |
| `MINUTE` | 分钟 | `INTERVAL 30 MINUTE` | 短时间间隔 |
| `SECOND` | 秒 | `INTERVAL 45 SECOND` | 精确计算 |

**💼 实际应用示例**
```sql
-- 计算订单有效期（7天后过期）
UPDATE orders 
SET expire_time = DATE_ADD(create_time, INTERVAL 7 DAY)
WHERE expire_time IS NULL;

-- 查询最近30天的数据
SELECT * FROM sales 
WHERE sale_date >= DATE_ADD(CURDATE(), INTERVAL -30 DAY);

-- 计算员工试用期结束时间（3个月后）
SELECT 
    name,
    hire_date,
    DATE_ADD(hire_date, INTERVAL 3 MONTH) AS 试用期结束
FROM employees;

-- 预约时间加上服务时长
SELECT 
    booking_id,
    start_time,
    DATE_ADD(start_time, INTERVAL duration MINUTE) AS end_time
FROM appointments;
```

### 3.3 DATE_SUB() - 日期减法


**➖ DATE_SUB()函数详解**
```sql
-- 基本语法
DATE_SUB(date, INTERVAL expr unit)

-- 各种时间的减法
SELECT 
    NOW() AS 当前时间,
    DATE_SUB(NOW(), INTERVAL 1 DAY) AS 昨天,
    DATE_SUB(NOW(), INTERVAL 1 WEEK) AS 一周前,
    DATE_SUB(NOW(), INTERVAL 1 MONTH) AS 一个月前,
    DATE_SUB(NOW(), INTERVAL 1 YEAR) AS 一年前;
```

**💼 实际应用示例**
```sql
-- 查询过去7天的新用户
SELECT COUNT(*) AS 新用户数
FROM users 
WHERE register_time >= DATE_SUB(NOW(), INTERVAL 7 DAY);

-- 计算商品上架后的销售天数
SELECT 
    product_name,
    DATEDIFF(NOW(), launch_date) AS 上架天数
FROM products;

-- 查询即将过期的优惠券（3天内过期）
SELECT * FROM coupons 
WHERE expire_date BETWEEN NOW() 
    AND DATE_ADD(NOW(), INTERVAL 3 DAY);
```

### 3.4 DATEDIFF() - 日期差值


**📊 DATEDIFF()函数详解**
```sql
-- 基本语法
DATEDIFF(date1, date2)  -- 返回 date1 - date2 的天数

-- 计算日期差值
SELECT 
    DATEDIFF('2025-01-15', '2025-01-01') AS 天数差,  -- 结果：14
    DATEDIFF(NOW(), '2025-01-01') AS 今年已过天数,
    DATEDIFF('2025-12-31', NOW()) AS 今年剩余天数;

-- 计算年龄（以天为单位）
SELECT 
    name,
    birthday,
    DATEDIFF(NOW(), birthday) AS 出生天数,
    FLOOR(DATEDIFF(NOW(), birthday) / 365) AS 大致年龄
FROM users;
```

**🔍 DATEDIFF()特点**
- **返回值**：整数（天数）
- **正负值**：date1 > date2 返回正数，反之返回负数
- **只计算日期**：忽略时间部分

### 3.5 TIMESTAMPDIFF() - 时间戳差值


**⏱️ TIMESTAMPDIFF()函数详解**
```sql
-- 基本语法
TIMESTAMPDIFF(unit, datetime1, datetime2)

-- 不同单位的时间差计算
SELECT 
    TIMESTAMPDIFF(YEAR, '1990-01-01', NOW()) AS 年龄,
    TIMESTAMPDIFF(MONTH, '2025-01-01', NOW()) AS 本年月数,
    TIMESTAMPDIFF(DAY, '2025-01-01', NOW()) AS 本年天数,
    TIMESTAMPDIFF(HOUR, '2025-01-15 09:00:00', NOW()) AS 小时差,
    TIMESTAMPDIFF(MINUTE, '2025-01-15 14:00:00', NOW()) AS 分钟差;
```

**💼 实际应用示例**
```sql
-- 精确计算年龄
SELECT 
    name,
    birthday,
    TIMESTAMPDIFF(YEAR, birthday, NOW()) AS 精确年龄
FROM users;

-- 计算订单处理时长
SELECT 
    order_id,
    create_time,
    complete_time,
    TIMESTAMPDIFF(HOUR, create_time, complete_time) AS 处理小时数
FROM orders 
WHERE complete_time IS NOT NULL;

-- 会员等级计算（基于注册时长）
SELECT 
    user_id,
    register_time,
    CASE 
        WHEN TIMESTAMPDIFF(YEAR, register_time, NOW()) >= 5 THEN '钻石会员'
        WHEN TIMESTAMPDIFF(YEAR, register_time, NOW()) >= 2 THEN '金牌会员'
        WHEN TIMESTAMPDIFF(MONTH, register_time, NOW()) >= 6 THEN '银牌会员'
        ELSE '普通会员'
    END AS 会员等级
FROM users;
```

### 3.6 时间计算对比总结


| 函数 | **用途** | **返回单位** | **示例** |
|------|---------|-------------|---------|
| `DATE_ADD()` | 日期加法 | 日期时间 | 计算未来时间点 |
| `DATE_SUB()` | 日期减法 | 日期时间 | 计算过去时间点 |
| `DATEDIFF()` | 日期差值 | 天数(整数) | 计算间隔天数 |
| `TIMESTAMPDIFF()` | 时间差值 | 指定单位 | 精确时间间隔 |

**🎯 选择建议**
```sql
-- ✅ 计算未来/过去的时间点
DATE_ADD(NOW(), INTERVAL 30 DAY)  -- 30天后

-- ✅ 只需要天数差
DATEDIFF('2025-02-01', '2025-01-01')  -- 相差31天

-- ✅ 需要精确的年月日时分秒差
TIMESTAMPDIFF(HOUR, start_time, end_time)  -- 精确小时差
```

---

## 4. 🔍 时间提取


### 4.1 什么是时间提取


**🔸 核心概念**
```
时间提取：从完整的日期时间中提取特定部分
作用：获取年份、月份、日期、小时等具体数值
应用场景：数据分析、分组统计、条件筛选
```

时间提取就像从一个完整的地址中提取省份、城市一样。比如从"2025-01-15 14:30:25"中提取出年份"2025"、月份"1"、小时"14"等单独的信息。

### 4.2 年月日提取函数


**📅 YEAR()、MONTH()、DAY()函数详解**
```sql
-- 基本用法
SELECT 
    NOW() AS 完整时间,
    YEAR(NOW()) AS 年份,
    MONTH(NOW()) AS 月份,
    DAY(NOW()) AS 日期;
-- 结果示例：
-- 完整时间: 2025-01-15 14:30:25
-- 年份: 2025
-- 月份: 1  
-- 日期: 15

-- 实际应用：按年份统计订单
SELECT 
    YEAR(create_time) AS 年份,
    COUNT(*) AS 订单数量,
    SUM(amount) AS 总金额
FROM orders 
GROUP BY YEAR(create_time)
ORDER BY 年份;

-- 按月份分析销售趋势
SELECT 
    YEAR(sale_date) AS 年份,
    MONTH(sale_date) AS 月份,
    AVG(amount) AS 平均销售额
FROM sales 
WHERE YEAR(sale_date) = 2025
GROUP BY YEAR(sale_date), MONTH(sale_date);
```

**💼 实际应用示例**
```sql
-- 查询生日在本月的用户
SELECT name, birthday 
FROM users 
WHERE MONTH(birthday) = MONTH(NOW());

-- 按年度和季度统计
SELECT 
    YEAR(order_date) AS 年份,
    QUARTER(order_date) AS 季度,
    COUNT(*) AS 订单数
FROM orders 
GROUP BY YEAR(order_date), QUARTER(order_date);

-- 查找特定日期的记录
SELECT * FROM logs 
WHERE YEAR(create_time) = 2025 
  AND MONTH(create_time) = 1 
  AND DAY(create_time) = 15;
```

### 4.3 时分秒提取函数


**🕐 HOUR()、MINUTE()、SECOND()函数详解**
```sql
-- 基本用法
SELECT 
    NOW() AS 完整时间,
    HOUR(NOW()) AS 小时,
    MINUTE(NOW()) AS 分钟,
    SECOND(NOW()) AS 秒数;
-- 结果示例：
-- 完整时间: 2025-01-15 14:30:25
-- 小时: 14
-- 分钟: 30
-- 秒数: 25

-- 分析访问高峰时段
SELECT 
    HOUR(access_time) AS 小时,
    COUNT(*) AS 访问次数
FROM user_logs 
WHERE DATE(access_time) = CURDATE()
GROUP BY HOUR(access_time)
ORDER BY 小时;
```

**📊 时段分析应用**
```sql
-- 按时间段分类（早中晚）
SELECT 
    CASE 
        WHEN HOUR(login_time) BETWEEN 6 AND 11 THEN '上午'
        WHEN HOUR(login_time) BETWEEN 12 AND 17 THEN '下午'
        WHEN HOUR(login_time) BETWEEN 18 AND 23 THEN '晚上'
        ELSE '深夜'
    END AS 时间段,
    COUNT(*) AS 登录次数
FROM user_logins 
GROUP BY 时间段;

-- 查找在特定时间范围内的操作
SELECT * FROM transactions 
WHERE HOUR(create_time) BETWEEN 9 AND 17  -- 工作时间
  AND MINUTE(create_time) BETWEEN 0 AND 30;  -- 前半小时
```

### 4.4 星期相关函数


**📆 DAYOFWEEK()和WEEKDAY()详解**

**🔸 DAYOFWEEK() - 星期几(1-7)**
```sql
-- DAYOFWEEK(): 1=周日, 2=周一, ..., 7=周六
SELECT 
    NOW() AS 当前时间,
    DAYOFWEEK(NOW()) AS 星期数字,
    CASE DAYOFWEEK(NOW())
        WHEN 1 THEN '周日'
        WHEN 2 THEN '周一'
        WHEN 3 THEN '周二'
        WHEN 4 THEN '周三'
        WHEN 5 THEN '周四'
        WHEN 6 THEN '周五'
        WHEN 7 THEN '周六'
    END AS 中文星期;
```

**🔸 WEEKDAY() - 工作日(0-6)**
```sql
-- WEEKDAY(): 0=周一, 1=周二, ..., 6=周日
SELECT 
    NOW() AS 当前时间,
    WEEKDAY(NOW()) AS 工作日数字,
    CASE WEEKDAY(NOW())
        WHEN 0 THEN '周一'
        WHEN 1 THEN '周二'
        WHEN 2 THEN '周三'
        WHEN 3 THEN '周四'
        WHEN 4 THEN '周五'
        WHEN 5 THEN '周六'
        WHEN 6 THEN '周日'
    END AS 中文星期;
```

**💼 星期函数实际应用**
```sql
-- 分析不同星期的销售情况
SELECT 
    CASE DAYOFWEEK(sale_date)
        WHEN 1 THEN '周日'
        WHEN 2 THEN '周一'
        WHEN 3 THEN '周二'
        WHEN 4 THEN '周三'
        WHEN 5 THEN '周四'
        WHEN 6 THEN '周五'
        WHEN 7 THEN '周六'
    END AS 星期,
    AVG(amount) AS 平均销售额,
    COUNT(*) AS 销售数量
FROM sales 
GROUP BY DAYOFWEEK(sale_date)
ORDER BY DAYOFWEEK(sale_date);

-- 查询工作日的数据
SELECT * FROM employee_attendance 
WHERE WEEKDAY(attendance_date) < 5;  -- 0-4代表周一到周五

-- 周末特别优惠的订单
SELECT * FROM orders 
WHERE DAYOFWEEK(order_date) IN (1, 7);  -- 周日和周六
```

### 4.5 其他常用提取函数


**📊 额外的时间提取函数**
```sql
-- QUARTER() - 季度
SELECT 
    order_date,
    QUARTER(order_date) AS 季度
FROM orders;

-- WEEK() - 年度第几周
SELECT 
    create_time,
    WEEK(create_time) AS 年度周数
FROM posts;

-- DAYOFYEAR() - 年度第几天
SELECT 
    birthday,
    DAYOFYEAR(birthday) AS 年度第几天
FROM users;

-- LAST_DAY() - 月份最后一天
SELECT 
    NOW() AS 当前时间,
    LAST_DAY(NOW()) AS 本月最后一天;
```

### 4.6 时间提取函数对比


| 函数 | **返回值范围** | **说明** | **常用场景** |
|------|-------------|---------|-------------|
| `YEAR()` | 1000-9999 | 4位年份 | 年度统计 |
| `MONTH()` | 1-12 | 月份数字 | 月度分析 |
| `DAY()` | 1-31 | 日期数字 | 日期筛选 |
| `HOUR()` | 0-23 | 24小时制 | 时段分析 |
| `MINUTE()` | 0-59 | 分钟数 | 精确时间 |
| `SECOND()` | 0-59 | 秒数 | 精确时间 |
| `DAYOFWEEK()` | 1-7 | 1=周日 | 星期分析 |
| `WEEKDAY()` | 0-6 | 0=周一 | 工作日分析 |

**✅ 最佳实践**
```sql
-- 组合使用创建复合条件
SELECT * FROM events 
WHERE YEAR(event_date) = 2025 
  AND MONTH(event_date) IN (6, 7, 8)  -- 夏季活动
  AND DAYOFWEEK(event_date) = 1;      -- 周日举办

-- 用于索引优化的写法
SELECT * FROM orders 
WHERE create_time >= '2025-01-01' 
  AND create_time < '2025-02-01'
  AND HOUR(create_time) BETWEEN 9 AND 17;
```

---

## 5. 🔄 时间戳转换


### 5.1 什么是时间戳


**🔸 核心概念**
```
时间戳(Timestamp)：从1970年1月1日00:00:00 UTC开始计算的秒数
作用：统一的时间表示方法，便于存储和计算
特点：与时区无关，是一个纯数字
```

时间戳就像是时间的"身份证号"，全世界统一标准。比如时间戳`1705312225`对应的就是`2025-01-15 14:30:25`，无论在哪个国家看到这个数字，代表的都是同一个时刻。

**💡 为什么需要时间戳？**
```
传统时间表示：2025-01-15 14:30:25
问题：不同时区、不同格式、存储复杂

时间戳表示：1705312225
优势：统一标准、便于计算、跨平台兼容
```

### 5.2 UNIX_TIMESTAMP() - 获取时间戳


**⏰ UNIX_TIMESTAMP()函数详解**

**🔸 获取当前时间戳**
```sql
-- 获取当前时间戳
SELECT UNIX_TIMESTAMP();
-- 结果：1705312225 (当前时间的时间戳)

SELECT 
    NOW() AS 当前时间,
    UNIX_TIMESTAMP() AS 当前时间戳;
-- 结果：
-- 当前时间: 2025-01-15 14:30:25
-- 当前时间戳: 1705312225
```

**🔸 指定日期的时间戳**
```sql
-- 将指定日期转换为时间戳
SELECT 
    '2025-01-01 00:00:00' AS 日期时间,
    UNIX_TIMESTAMP('2025-01-01 00:00:00') AS 时间戳;

-- 批量转换
SELECT 
    order_id,
    create_time,
    UNIX_TIMESTAMP(create_time) AS create_timestamp
FROM orders;
```

**💼 实际应用示例**
```sql
-- 记录操作时间戳（便于API返回）
INSERT INTO user_actions (user_id, action, timestamp)
VALUES (1001, 'login', UNIX_TIMESTAMP());

-- 计算时间差（以秒为单位）
SELECT 
    order_id,
    (UNIX_TIMESTAMP(complete_time) - UNIX_TIMESTAMP(create_time)) AS 处理秒数
FROM orders 
WHERE complete_time IS NOT NULL;

-- 时间戳范围查询（更高效）
SELECT * FROM logs 
WHERE UNIX_TIMESTAMP(create_time) BETWEEN 
      UNIX_TIMESTAMP('2025-01-01') 
      AND UNIX_TIMESTAMP('2025-01-31');
```

### 5.3 FROM_UNIXTIME() - 时间戳转日期


**📅 FROM_UNIXTIME()函数详解**

**🔸 基本转换**
```sql
-- 将时间戳转换为标准日期时间
SELECT 
    1705312225 AS 时间戳,
    FROM_UNIXTIME(1705312225) AS 标准时间;
-- 结果：
-- 时间戳: 1705312225
-- 标准时间: 2025-01-15 14:30:25

-- 批量转换时间戳字段
SELECT 
    log_id,
    timestamp_field,
    FROM_UNIXTIME(timestamp_field) AS 可读时间
FROM system_logs;
```

**🔸 带格式的转换**
```sql
-- 转换为指定格式
SELECT 
    FROM_UNIXTIME(1705312225, '%Y年%m月%d日 %H:%i:%s') AS 中文格式,
    FROM_UNIXTIME(1705312225, '%Y-%m-%d') AS 日期格式,
    FROM_UNIXTIME(1705312225, '%H:%i:%s') AS 时间格式;
```

**💼 实际应用场景**
```sql
-- API数据处理（前端传递时间戳）
SELECT 
    user_id,
    action_type,
    FROM_UNIXTIME(action_timestamp) AS 操作时间
FROM user_actions 
WHERE action_timestamp > UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 1 DAY));

-- 日志分析（时间戳格式的日志）
SELECT 
    FROM_UNIXTIME(log_timestamp, '%Y-%m-%d %H:00:00') AS 小时段,
    COUNT(*) AS 日志数量
FROM system_logs 
GROUP BY FROM_UNIXTIME(log_timestamp, '%Y-%m-%d %H:00:00');

-- 缓存过期时间判断
SELECT 
    cache_key,
    FROM_UNIXTIME(expire_timestamp) AS 过期时间,
    CASE 
        WHEN expire_timestamp < UNIX_TIMESTAMP() THEN '已过期'
        ELSE '有效'
    END AS 状态
FROM cache_table;
```

### 5.4 时间戳与日期的转换对比


```
转换方向对比图：

日期时间 ←―――――――――――――――――――――――――――――――――――――――――――――→ 时间戳
'2025-01-15 14:30:25'                                1705312225

FROM_UNIXTIME()                                  UNIX_TIMESTAMP()
    ↓                                                    ↓
时间戳 → 日期时间                                  日期时间 → 时间戳
便于阅读显示                                      便于存储计算
```

| 函数 | **输入** | **输出** | **用途** |
|------|---------|---------|---------|
| `UNIX_TIMESTAMP()` | 无参数 | 当前时间戳 | 获取现在的时间戳 |
| `UNIX_TIMESTAMP(date)` | 日期时间 | 时间戳数字 | 日期转时间戳 |
| `FROM_UNIXTIME(timestamp)` | 时间戳数字 | 标准日期时间 | 时间戳转日期 |
| `FROM_UNIXTIME(timestamp, format)` | 时间戳+格式 | 格式化日期 | 时间戳转指定格式 |

### 5.5 时间戳的优势与应用场景


**✅ 时间戳的优势**
```sql
-- 1. 存储效率高（INT类型，4字节）
CREATE TABLE events (
    id INT PRIMARY KEY,
    event_name VARCHAR(100),
    event_time INT,  -- 时间戳存储
    INDEX idx_time (event_time)  -- 整数索引更快
);

-- 2. 计算简便（直接数字运算）
SELECT 
    event_name,
    (1705312225 - event_time) AS 距离秒数
FROM events;

-- 3. 跨时区兼容（UTC标准）
-- 在不同时区显示相同时间戳
SELECT FROM_UNIXTIME(1705312225);  -- 各地显示当地时间
```

**💼 主要应用场景**

**🔸 API接口数据**
```sql
-- 前端JavaScript传递时间戳
INSERT INTO bookings (user_id, booking_timestamp)
VALUES (1001, 1705312225);

-- 返回时间戳给前端处理
SELECT 
    booking_id,
    UNIX_TIMESTAMP(booking_time) AS timestamp
FROM bookings;
```

**🔸 数据同步与备份**
```sql
-- 增量同步（基于时间戳）
SELECT * FROM user_data 
WHERE UNIX_TIMESTAMP(update_time) > 1705200000;

-- 定期清理旧数据
DELETE FROM temporary_logs 
WHERE UNIX_TIMESTAMP(create_time) < UNIX_TIMESTAMP(DATE_SUB(NOW(), INTERVAL 30 DAY));
```

**🔸 性能优化场景**
```sql
-- 时间戳范围查询（比日期字符串快）
SELECT * FROM large_table 
WHERE timestamp_field BETWEEN 1705200000 AND 1705300000;

-- 分区表基于时间戳
CREATE TABLE logs_partitioned (
    id INT,
    log_data TEXT,
    log_timestamp INT
) PARTITION BY RANGE (log_timestamp) (
    PARTITION p202501 VALUES LESS THAN (1706745600),
    PARTITION p202502 VALUES LESS THAN (1709251200)
);
```

### 5.6 时间戳使用建议


**✅ 推荐做法**
```sql
-- 存储：使用时间戳存储，节省空间
CREATE TABLE activities (
    id INT PRIMARY KEY,
    activity_name VARCHAR(100),
    start_timestamp INT,
    end_timestamp INT
);

-- 显示：转换为友好格式显示
SELECT 
    activity_name,
    FROM_UNIXTIME(start_timestamp, '%Y-%m-%d %H:%i') AS 开始时间
FROM activities;

-- 计算：直接使用时间戳数字计算
SELECT 
    activity_name,
    (end_timestamp - start_timestamp) / 60 AS 持续分钟数
FROM activities;
```

**⚠️ 注意事项**
- 时间戳是32位整数，最大值到2038年（考虑使用BIGINT）
- 时间戳基于UTC时间，显示时注意时区转换
- 精度只到秒级，需要毫秒精度时使用BIGINT存储毫秒时间戳

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心概念


```
🔸 当前时间：NOW()完整时间，CURDATE()仅日期，CURTIME()仅时间
🔸 时间格式化：DATE_FORMAT()显示，STR_TO_DATE()解析
🔸 时间计算：DATE_ADD()加法，DATE_SUB()减法，DATEDIFF()天数差
🔸 时间提取：YEAR()年份，MONTH()月份，HOUR()小时等
🔸 时间戳转换：UNIX_TIMESTAMP()转时间戳，FROM_UNIXTIME()转日期
```

### 6.2 关键理解要点


**🔹 函数分类与选择**
```
获取时间：根据需要选择完整时间还是部分时间
格式化：显示给用户时格式化，存储时保持标准格式
计算运算：未来时间用ADD，过去时间用SUB，间隔用DIFF
提取分析：按年月日时分组统计，按星期分析规律
时间戳：API接口、性能优化、跨时区场景使用
```

**🔹 性能优化原则**
```
索引友好：时间戳比字符串快，范围查询比函数计算快
避免函数：WHERE条件中避免对字段使用函数
合理存储：根据精度需求选择DATETIME、TIMESTAMP或INT
分区策略：大表可按时间分区提高查询效率
```

### 6.3 实际应用指导


**📊 常见业务场景**
```sql
-- ✅ 用户注册统计
SELECT 
    DATE_FORMAT(register_time, '%Y-%m') AS 月份,
    COUNT(*) AS 新用户数
FROM users 
GROUP BY DATE_FORMAT(register_time, '%Y-%m');

-- ✅ 订单有效期管理
UPDATE orders 
SET expire_time = DATE_ADD(create_time, INTERVAL 7 DAY)
WHERE status = 'pending';

-- ✅ 会员年龄计算
SELECT 
    user_id,
    TIMESTAMPDIFF(YEAR, birthday, NOW()) AS age
FROM users;

-- ✅ 系统日志分析
SELECT 
    HOUR(log_time) AS 小时,
    COUNT(*) AS 日志数量
FROM system_logs 
WHERE DATE(log_time) = CURDATE()
GROUP BY HOUR(log_time);
```

**🛠️ 最佳实践模板**
```sql
-- 时间字段设计
CREATE TABLE business_table (
    id INT PRIMARY KEY,
    -- 使用DATETIME存储精确时间
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    -- 使用TIMESTAMP自动更新
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    -- 使用INT存储时间戳（API场景）
    event_timestamp INT,
    -- 添加时间索引
    INDEX idx_create_time (create_time),
    INDEX idx_timestamp (event_timestamp)
);
```

### 6.4 学习检查清单


**🎯 基础掌握清单**
- [x] 理解四个获取当前时间的函数差异
- [x] 会使用DATE_FORMAT()格式化时间显示
- [x] 掌握DATE_ADD()和DATE_SUB()进行时间计算
- [x] 熟练使用YEAR()、MONTH()等提取函数
- [x] 理解时间戳概念及转换方法

**🎯 进阶应用清单**
- [x] 能够设计合理的时间字段存储方案
- [x] 熟练编写时间相关的查询和统计SQL
- [x] 理解不同时间函数的性能特点
- [x] 掌握时区处理和时间戳优化技巧

**核心记忆口诀**：
```
NOW当前取完整，CURDATE日期CURTIME时
FORMAT格式化显示，ADD SUB计算时间差
YEAR MONTH DAY提取，HOUR MINUTE很精细
时间戳存储高效，UNIX转换记心里
```

**🚀 实践建议**
- 多练习不同场景的时间查询
- 熟悉常用的时间格式化模式
- 理解业务需求选择合适的时间函数
- 注意时间函数对查询性能的影响