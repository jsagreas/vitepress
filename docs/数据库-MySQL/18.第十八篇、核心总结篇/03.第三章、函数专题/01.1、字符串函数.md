---
title: 1、字符串函数
---
## 📚 目录

1. [基础字符串操作](#1-基础字符串操作)
2. [字符串长度与格式处理](#2-字符串长度与格式处理)
3. [字符串替换与处理](#3-字符串替换与处理)
4. [核心要点总结](#4-核心要点总结)

---

## 1. 🔗 基础字符串操作


### 1.1 连接函数：把多个字符串拼在一起


**🔸 CONCAT：最基本的字符串连接**

> **作用**：把多个字符串像拼积木一样连接成一个完整的字符串

```sql
-- 基本用法：把姓和名连接起来
SELECT CONCAT('张', '三') AS full_name;
-- 结果：张三

-- 实际应用：连接用户的姓和名
SELECT CONCAT(first_name, last_name) AS full_name 
FROM users;
-- 如果first_name='李'，last_name='四'，结果就是：李四
```

**💡 通俗理解**：
- `CONCAT`就像是胶水，把几段文字粘在一起
- 可以连接2个、3个、甚至更多个字符串
- 如果其中任何一个是`NULL`，整个结果就变成`NULL`

```sql
-- 多个字符串连接
SELECT CONCAT('用户名：', username, '，邮箱：', email) 
FROM users;
-- 结果：用户名：张三，邮箱：zhangsan@qq.com

-- 注意：如果有NULL值
SELECT CONCAT('姓名：', NULL, '年龄：', '25');
-- 结果：NULL（因为包含NULL）
```

**🔸 CONCAT_WS：带分隔符的智能连接**

> **作用**：`WS`是`With Separator`的意思，就是用指定的符号把字符串分开连接

```sql
-- 用逗号分隔连接
SELECT CONCAT_WS(',', '苹果', '香蕉', '橘子') AS fruits;
-- 结果：苹果,香蕉,橘子

-- 实际应用：格式化用户信息
SELECT CONCAT_WS(' | ', username, email, phone) AS user_info
FROM users;
-- 结果：张三 | zhangsan@qq.com | 13800138000
```

**💡 CONCAT_WS的优势**：
- **自动忽略NULL值**：不会因为一个NULL就让整个结果变NULL
- **统一分隔符**：不用每次都写分隔符，简化代码

```sql
-- CONCAT_WS会忽略NULL值
SELECT CONCAT_WS(',', '张三', NULL, '25岁', '男');
-- 结果：张三,25岁,男（自动跳过了NULL）

-- 如果用普通CONCAT
SELECT CONCAT('张三', ',', NULL, ',', '25岁');
-- 结果：NULL（因为包含NULL）
```

### 1.2 截取函数：从字符串中取出需要的部分


**🔸 SUBSTRING：最灵活的字符串截取**

> **作用**：从一个长字符串中截取指定位置和长度的部分，就像用剪刀剪纸一样

```sql
-- 基本语法：SUBSTRING(字符串, 起始位置, 截取长度)
SELECT SUBSTRING('Hello World', 1, 5) AS result;
-- 结果：Hello

-- 实际应用：截取手机号前3位
SELECT SUBSTRING(phone, 1, 3) AS area_code 
FROM users;
-- 如果phone='13800138000'，结果：138
```

**💡 位置说明**：
- MySQL中字符串位置从**1**开始计算（不是0）
- 如果不指定长度，就从起始位置截取到字符串末尾

```sql
-- 从第7个位置开始截取到末尾
SELECT SUBSTRING('Hello World', 7) AS result;
-- 结果：World

-- 截取身份证后4位
SELECT SUBSTRING(id_card, -4) AS last_four
FROM users;
-- 负数表示从末尾开始计算
```

**🔸 LEFT：从左边开始截取**

> **作用**：从字符串左边开始，截取指定长度的字符

```sql
-- 截取姓名的姓氏（假设都是单姓）
SELECT LEFT(full_name, 1) AS surname 
FROM users;
-- 如果full_name='张三'，结果：张

-- 截取文件名（假设都是3位扩展名）
SELECT LEFT(filename, LENGTH(filename) - 4) AS name_only
FROM files;
-- 如果filename='document.pdf'，结果：document
```

**🔸 RIGHT：从右边开始截取**

> **作用**：从字符串右边开始，截取指定长度的字符

```sql
-- 截取文件扩展名
SELECT RIGHT(filename, 3) AS extension 
FROM files;
-- 如果filename='photo.jpg'，结果：jpg

-- 截取银行卡后4位（用于显示）
SELECT CONCAT('****', RIGHT(card_number, 4)) AS masked_card
FROM accounts;
-- 如果card_number='1234567890123456'，结果：****3456
```

### 1.3 查找函数：在字符串中找特定内容的位置


**🔸 LOCATE：查找子字符串的位置**

> **作用**：在一个字符串中查找另一个字符串的位置，找到返回位置号，找不到返回0

```sql
-- 基本用法
SELECT LOCATE('o', 'Hello World') AS position;
-- 结果：5（第一个'o'在第5个位置）

-- 实际应用：检查邮箱格式
SELECT email, LOCATE('@', email) AS at_position 
FROM users 
WHERE LOCATE('@', email) > 0;
-- 只显示包含@符号的邮箱
```

**💡 实用技巧**：
- 返回0表示没找到
- 返回大于0的数字表示找到了，数字就是位置
- 区分大小写

```sql
-- 检查手机号是否以13开头
SELECT phone 
FROM users 
WHERE LOCATE('13', phone) = 1;
-- 只有以13开头的手机号才会被选出来

-- 查找文件名中的点号位置（用于分离文件名和扩展名）
SELECT filename,
       LOCATE('.', filename) AS dot_position
FROM files;
```

**🔸 INSTR：另一种查找方式**

> **作用**：功能和LOCATE一样，只是参数顺序不同

```sql
-- INSTR的参数顺序和LOCATE相反
SELECT INSTR('Hello World', 'o') AS position;
-- 结果：5

-- 实际应用：查找域名中的点号
SELECT INSTR(website, '.') AS dot_position 
FROM companies;
```

**📊 LOCATE vs INSTR 对比**

| **函数** | **语法格式** | **说明** | **使用场景** |
|---------|-------------|---------|-------------|
| `LOCATE` | `LOCATE(要找的字符, 在哪里找)` | `标准SQL函数` | `跨数据库兼容` |
| `INSTR` | `INSTR(在哪里找, 要找的字符)` | `MySQL特有函数` | `符合直觉的参数顺序` |

---

## 2. 📏 字符串长度与格式处理


### 2.1 长度函数：测量字符串有多长


**🔸 LENGTH：计算字节长度**

> **作用**：计算字符串占用多少个字节，主要用于存储和传输

```sql
-- 英文字符，一个字符=1个字节
SELECT LENGTH('Hello') AS byte_length;
-- 结果：5

-- 中文字符，一个汉字=3个字节（UTF-8编码）
SELECT LENGTH('你好') AS byte_length;
-- 结果：6（每个汉字3字节）
```

**💡 实际应用场景**：
- 检查数据库字段是否超过存储限制
- 网络传输时计算数据大小
- 文件大小估算

```sql
-- 检查用户名长度是否超过数据库限制
SELECT username 
FROM users 
WHERE LENGTH(username) > 50;
-- 找出用户名字节长度超过50的记录

-- 计算所有用户描述信息的总字节数
SELECT SUM(LENGTH(description)) AS total_bytes 
FROM user_profiles;
```

**🔸 CHAR_LENGTH：计算字符个数**

> **作用**：计算字符串包含多少个字符，不管是中文还是英文都按1个字符计算

```sql
-- 英文字符
SELECT CHAR_LENGTH('Hello') AS char_count;
-- 结果：5

-- 中文字符
SELECT CHAR_LENGTH('你好') AS char_count;
-- 结果：2（2个汉字）

-- 混合字符
SELECT CHAR_LENGTH('Hello你好') AS char_count;
-- 结果：7（5个英文+2个汉字）
```

**💡 实际应用场景**：
- 用户界面显示字符限制（比如微博140字）
- 表单验证
- 文本统计

```sql
-- 检查评论是否超过200字符限制
SELECT comment_text 
FROM comments 
WHERE CHAR_LENGTH(comment_text) > 200;

-- 统计标题字符数分布
SELECT 
    CASE 
        WHEN CHAR_LENGTH(title) <= 10 THEN '短标题'
        WHEN CHAR_LENGTH(title) <= 20 THEN '中等标题'
        ELSE '长标题'
    END AS title_type,
    COUNT(*) AS count
FROM articles 
GROUP BY title_type;
```

**📊 LENGTH vs CHAR_LENGTH 对比表**

| **函数** | **计算单位** | **中文"你好"** | **英文"Hi"** | **主要用途** |
|---------|-------------|--------------|-------------|-------------|
| `LENGTH` | `字节` | `6字节` | `2字节` | `存储空间计算` |
| `CHAR_LENGTH` | `字符` | `2字符` | `2字符` | `用户界面显示` |

### 2.2 格式处理：改变字符串的样式


**🔸 大小写转换函数**

```sql
-- UPPER：转换为大写
SELECT UPPER('Hello World') AS uppercase;
-- 结果：HELLO WORLD

-- LOWER：转换为小写  
SELECT LOWER('Hello World') AS lowercase;
-- 结果：hello world

-- 实际应用：统一邮箱格式（邮箱不区分大小写）
SELECT LOWER(email) AS normalized_email 
FROM users;
-- 把所有邮箱都转为小写，方便比较和查询
```

**💡 实用场景**：
- **邮箱地址标准化**：避免因大小写导致的重复注册
- **用户名查询**：不区分大小写的搜索
- **代码规范化**：统一代码格式

```sql
-- 不区分大小写的用户名查询
SELECT * FROM users 
WHERE LOWER(username) = LOWER('JohnDoe');
-- 无论用户输入john、JOHN、JohnDoe都能找到

-- 检查是否有重复的邮箱（忽略大小写）
SELECT LOWER(email) AS email, COUNT(*) AS count
FROM users 
GROUP BY LOWER(email)
HAVING COUNT(*) > 1;
```

**🔸 空格处理函数**

```sql
-- TRIM：去除两端空格
SELECT TRIM('  Hello World  ') AS trimmed;
-- 结果：'Hello World'

-- LTRIM：只去除左侧空格
SELECT LTRIM('  Hello World  ') AS left_trimmed;
-- 结果：'Hello World  '

-- RTRIM：只去除右侧空格
SELECT RTRIM('  Hello World  ') AS right_trimmed;
-- 结果：'  Hello World'
```

**💡 为什么要去空格**：
- **用户输入清理**：用户经常无意中输入多余空格
- **数据对比准确**：避免因空格导致的匹配失败
- **存储优化**：减少不必要的空格占用

```sql
-- 清理用户输入的姓名
UPDATE users 
SET username = TRIM(username), 
    email = TRIM(LOWER(email));
-- 同时去空格和转小写

-- 查找可能有多余空格的记录
SELECT username FROM users 
WHERE username != TRIM(username);
```

### 2.3 填充与重复：给字符串增加内容


**🔸 LPAD：左侧填充**

> **作用**：在字符串左边填充指定字符，直到达到指定长度

```sql
-- 基本用法：用0填充数字，保持固定位数
SELECT LPAD('123', 6, '0') AS padded_number;
-- 结果：000123

-- 实际应用：生成固定长度的订单号
SELECT LPAD(order_id, 8, '0') AS formatted_order_id 
FROM orders;
-- 如果order_id=456，结果：00000456
```

**🔸 RPAD：右侧填充**

> **作用**：在字符串右边填充指定字符

```sql
-- 右侧填充星号
SELECT RPAD('张三', 10, '*') AS padded_name;
-- 结果：张三********

-- 实际应用：格式化报表显示
SELECT RPAD(product_name, 20, '.') AS formatted_name,
       price 
FROM products;
-- 结果：苹果................  5.00
```

**💡 填充的实用场景**：
- **报表格式化**：让数据对齐显示
- **编号统一**：所有编号保持相同位数
- **数据脱敏**：用星号隐藏敏感信息

```sql
-- 生成格式化的会员卡号
SELECT CONCAT('VIP', LPAD(member_id, 6, '0')) AS card_number
FROM members;
-- 如果member_id=123，结果：VIP000123

-- 隐藏手机号中间4位
SELECT CONCAT(LEFT(phone, 3), '****', RIGHT(phone, 4)) AS masked_phone
FROM users;
-- 如果phone=13800138000，结果：138****8000
```

**🔸 REPEAT：重复字符串**

> **作用**：把一个字符串重复指定次数

```sql
-- 基本用法
SELECT REPEAT('Hello', 3) AS repeated;
-- 结果：HelloHelloHello

-- 实际应用：生成分隔线
SELECT REPEAT('-', 50) AS separator;
-- 结果：--------------------------------------------------

-- 生成星级评分显示
SELECT product_name,
       CONCAT(REPEAT('★', rating), REPEAT('☆', 5-rating)) AS stars
FROM product_reviews;
-- 如果rating=3，结果：★★★☆☆
```

---

## 3. 🔄 字符串替换与处理


### 3.1 替换函数：修改字符串内容


**🔸 REPLACE：字符串替换**

> **作用**：在字符串中找到指定内容，然后替换成新内容，所有匹配的地方都会被替换

```sql
-- 基本语法：REPLACE(原字符串, 要替换的内容, 新内容)
SELECT REPLACE('Hello World World', 'World', 'MySQL') AS result;
-- 结果：Hello MySQL MySQL

-- 实际应用：替换敏感词
SELECT REPLACE(comment_text, '敏感词', '***') AS filtered_comment
FROM comments;
```

**💡 REPLACE的特点**：
- **全部替换**：会替换所有找到的匹配项
- **区分大小写**：'Hello'和'hello'被认为是不同的
- **精确匹配**：只替换完全匹配的内容

```sql
-- 数据清理：统一格式
UPDATE products 
SET description = REPLACE(description, '　', ' ');
-- 把全角空格替换为半角空格

-- 批量修改URL
UPDATE websites 
SET url = REPLACE(url, 'http://', 'https://');
-- 把所有http协议改为https

-- 电话号码格式化
SELECT REPLACE(REPLACE(phone, '-', ''), ' ', '') AS clean_phone
FROM contacts;
-- 移除电话号码中的横线和空格
```

**实用技巧**：
```sql
-- 链式替换：先替换A为B，再替换C为D
SELECT REPLACE(REPLACE(text, 'old1', 'new1'), 'old2', 'new2') AS result
FROM table_name;

-- 移除特殊字符
SELECT REPLACE(REPLACE(REPLACE(input_text, ',', ''), ';', ''), ':', '') AS clean_text
FROM data_table;
```

### 3.2 其他字符串处理


**🔸 REVERSE：反转字符串**

> **作用**：把字符串从后往前倒过来排列

```sql
-- 基本用法
SELECT REVERSE('Hello') AS reversed;
-- 结果：olleH

-- 实际应用：检查回文字符串
SELECT word,
       CASE 
           WHEN word = REVERSE(word) THEN '是回文'
           ELSE '不是回文'
       END AS is_palindrome
FROM words;
-- 如果word='level'，结果：是回文
```

**💡 REVERSE的实用场景**：
- **数据验证**：检查回文数据
- **算法题目**：字符串处理练习
- **趣味功能**：文字游戏

```sql
-- 找出所有回文用户名
SELECT username 
FROM users 
WHERE LOWER(username) = LOWER(REVERSE(username));

-- 生成镜像文本效果
SELECT CONCAT(text, ' | ', REVERSE(text)) AS mirror_text
FROM messages;
-- 如果text='Hello'，结果：Hello | olleH
```

**🔧 综合应用示例**

```sql
-- 用户数据清理和格式化
SELECT 
    user_id,
    TRIM(UPPER(LEFT(first_name, 1))) AS first_initial,
    TRIM(LOWER(email)) AS clean_email,
    CONCAT('+86-', 
           LEFT(phone, 3), '-', 
           SUBSTRING(phone, 4, 4), '-',
           RIGHT(phone, 4)) AS formatted_phone,
    REPLACE(REPLACE(address, '　', ' '), '  ', ' ') AS clean_address
FROM users;

-- 商品信息处理
SELECT 
    product_id,
    CONCAT(UPPER(LEFT(product_name, 1)), 
           LOWER(SUBSTRING(product_name, 2))) AS title_case_name,
    CONCAT('¥', FORMAT(price, 2)) AS formatted_price,
    CONCAT(REPEAT('★', FLOOR(rating)), 
           REPEAT('☆', 5-FLOOR(rating))) AS star_rating
FROM products;
```

---

## 4. 📋 核心要点总结


### 4.1 必须掌握的核心概念


```
🔸 连接函数：CONCAT拼接字符串，CONCAT_WS带分隔符拼接
🔸 截取函数：SUBSTRING灵活截取，LEFT/RIGHT从两端截取
🔸 查找函数：LOCATE/INSTR找子串位置，返回0表示未找到
🔸 长度函数：LENGTH算字节数，CHAR_LENGTH算字符数
🔸 格式函数：UPPER/LOWER转大小写，TRIM系列去空格
🔸 填充函数：LPAD/RPAD填充字符，REPEAT重复字符串
🔸 替换函数：REPLACE替换字符串内容，REVERSE反转字符串
```

### 4.2 关键理解要点


**🔹 字节 vs 字符的区别**
```
英文字符：1个字符 = 1个字节
中文字符：1个字符 = 3个字节（UTF-8）
LENGTH()算字节，CHAR_LENGTH()算字符
数据库存储限制通常按字节计算
用户界面显示限制通常按字符计算
```

**🔹 NULL值的处理规律**
```
CONCAT遇到NULL整个结果变NULL
CONCAT_WS会忽略NULL值继续处理
大部分字符串函数遇到NULL返回NULL
要特别注意NULL值对结果的影响
```

**🔹 位置计算的规则**
```
MySQL字符串位置从1开始（不是0）
负数位置从末尾开始计算
LOCATE返回0表示没找到
SUBSTRING位置超出范围返回空字符串
```

### 4.3 实际应用价值


**💼 数据清理和标准化**
- **用户输入处理**：去空格、统一大小写、格式验证
- **数据导入清理**：批量替换、格式统一
- **历史数据修复**：修正格式错误、编码问题

**🎯 业务功能实现**
- **搜索功能**：不区分大小写的模糊查询
- **显示格式化**：手机号脱敏、价格格式化
- **编号生成**：订单号、会员卡号格式化

**📊 报表和展示**
- **数据对齐**：使用填充函数让报表整齐
- **信息组合**：把多个字段组合成易读格式
- **敏感信息处理**：部分隐藏个人信息

### 4.4 使用注意事项


**⚠️ 性能考虑**
```
字符串函数会增加CPU负担
大量数据处理时要注意性能
能在应用层处理的尽量不在数据库层处理
使用索引时要注意函数会让索引失效
```

**💡 最佳实践**
```
数据入库前先清理格式
建立数据清理的标准流程
对敏感数据要谨慎处理
测试不同字符集下的函数行为
```

**🔧 常见问题解决**
```
中文字符长度问题：用CHAR_LENGTH而不是LENGTH
NULL值影响结果：使用IFNULL或COALESCE处理
大小写敏感问题：统一转换大小写后比较
特殊字符处理：注意转义和编码问题
```

**核心记忆口诀**：
```
连接用CONCAT带分隔WS，截取SUBSTRING左右分
查找LOCATE位置明，长度LENGTH字符CHAR
大小写UPPER LOWER转，空格TRIM左右清
填充LPAD RPAD齐，重复REPEAT替换REPLACE行
字符串函数很实用，数据处理效率增
```