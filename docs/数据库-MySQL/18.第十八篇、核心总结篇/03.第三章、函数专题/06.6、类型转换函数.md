---
title: 6、类型转换函数
---
## 📚 目录

1. [类型转换基础概念](#1-类型转换基础概念)
2. [CAST函数详解](#2-CAST函数详解)
3. [CONVERT函数详解](#3-CONVERT函数详解)
4. [常用类型转换场景](#4-常用类型转换场景)
5. [实战应用案例](#5-实战应用案例)
6. [核心要点总结](#6-核心要点总结)

---

## 1. 🔄 类型转换基础概念


### 1.1 什么是数据类型转换


**🔸 通俗理解**
数据类型转换就像是"翻译"，把一种格式的数据转换成另一种格式。比如把数字"123"转换成文本"123"，或者把文本"2023-12-25"转换成日期格式。

**🔸 为什么需要类型转换**
```
现实场景举例：
📝 用户输入: "25" (文本形式)
🔢 数据库存储: 25 (数字形式)
📊 计算需求: 需要进行数学运算

解决方案: 类型转换！
```

### 1.2 MySQL中的类型转换


**🔸 转换方式分类**
```
隐式转换 (自动转换):
MySQL自动判断并转换
例: SELECT "10" + 5;  结果: 15

显式转换 (手动转换):
程序员明确指定转换
例: SELECT CAST("10" AS SIGNED) + 5;
```

> 💡 **核心理解**  
> 隐式转换虽然方便，但可能导致意外结果。显式转换更安全、更清晰！

### 1.3 支持的数据类型


**📋 MySQL主要数据类型对照表**

| 类型分类 | **具体类型** | **含义说明** | **使用场景** |
|---------|-------------|-------------|-------------|
| 🔢 **整数类型** | `SIGNED` | `有符号整数` | `正负整数转换` |
| 🔢 **整数类型** | `UNSIGNED` | `无符号整数` | `只存正整数` |
| 💰 **小数类型** | `DECIMAL` | `精确小数` | `金额、精度要求高` |
| 📝 **字符类型** | `CHAR` | `固定长度字符` | `身份证、手机号` |
| 📝 **字符类型** | `VARCHAR` | `可变长度字符` | `姓名、地址` |
| 📅 **时间类型** | `DATE` | `日期` | `生日、入职日期` |
| 📅 **时间类型** | `DATETIME` | `日期时间` | `创建时间、更新时间` |
| ⏰ **时间类型** | `TIME` | `时间` | `上班时间、持续时长` |

---

## 2. 🎯 CAST函数详解


### 2.1 CAST函数基本语法


**🔸 函数格式**
```sql
CAST(要转换的数据 AS 目标数据类型)
```

**🔸 语法解读**
- `CAST`: 函数名，意思是"投射、转换"
- `要转换的数据`: 可以是字段、常量、表达式
- `AS`: 关键字，意思是"转换为"
- `目标数据类型`: 想要转换成的数据类型

> 🧠 **记忆技巧**  
> CAST AS 就像说"把这个数据投射(CAST)为(AS)那个类型"

### 2.2 CAST函数常用转换


##### 2.2.1 文本转数字


**🔸 基础转换示例**
```sql
-- 把文本"123"转换成整数
SELECT CAST('123' AS SIGNED);
-- 结果: 123 (数字类型)

-- 把文本"45.67"转换成小数
SELECT CAST('45.67' AS DECIMAL(10,2));
-- 结果: 45.67 (小数类型，总长度10位，小数点后2位)
```

**🔸 实际应用场景**
```sql
-- 场景: 用户输入的年龄是文本，需要进行数值比较
SELECT * FROM users 
WHERE CAST(age AS SIGNED) > 18;

-- 场景: 计算文本形式的价格总和
SELECT SUM(CAST(price AS DECIMAL(10,2))) as total_price
FROM products;
```

##### 2.2.2 数字转文本


**🔸 基础转换示例**
```sql
-- 把整数123转换成文本
SELECT CAST(123 AS CHAR);
-- 结果: "123" (文本类型)

-- 把小数转换成固定长度文本
SELECT CAST(45.67 AS CHAR(10));
-- 结果: "45.67     " (10个字符长度，不足的用空格补齐)
```

**🔸 实际应用场景**
```sql
-- 场景: 生成用户编号 (数字ID + 文本前缀)
SELECT CONCAT('USER_', CAST(user_id AS CHAR)) as user_code
FROM users;
-- 结果: USER_1001, USER_1002...
```

##### 2.2.3 日期时间转换


**🔸 文本转日期**
```sql
-- 把文本转换成日期
SELECT CAST('2023-12-25' AS DATE);
-- 结果: 2023-12-25 (日期类型)

-- 把文本转换成完整日期时间
SELECT CAST('2023-12-25 15:30:45' AS DATETIME);
-- 结果: 2023-12-25 15:30:45 (日期时间类型)
```

**🔸 实际应用场景**
```sql
-- 场景: 用户输入的生日文本转换成日期进行计算
SELECT name, 
       CAST(birthday AS DATE) as birth_date,
       YEAR(CURDATE()) - YEAR(CAST(birthday AS DATE)) as age
FROM users;
```

### 2.3 CAST转换注意事项


**⚠️ 常见转换失败情况**
```sql
-- 无法转换的文本
SELECT CAST('abc' AS SIGNED);
-- 结果: 0 (转换失败，返回0)

-- 日期格式错误
SELECT CAST('2023/25/12' AS DATE);
-- 结果: NULL (格式不正确，返回NULL)
```

> 🚨 **重要提醒**  
> 转换失败时，数字类型返回0，日期类型返回NULL。建议在转换前先验证数据格式！

---

## 3. 🔧 CONVERT函数详解


### 3.1 CONVERT函数基本语法


**🔸 函数格式**
```sql
CONVERT(要转换的数据, 目标数据类型)
```

**🔸 与CAST的区别**
```
CAST语法:   CAST(数据 AS 类型)
CONVERT语法: CONVERT(数据, 类型)

功能上完全相同，只是写法不同！
```

> 💡 **选择建议**  
> CAST是SQL标准语法，更通用；CONVERT是MySQL特有语法，写法更简洁。

### 3.2 CONVERT函数使用示例


##### 3.2.1 基础数据类型转换


**🔸 数字转换**
```sql
-- 文本转整数
SELECT CONVERT('456', SIGNED);
-- 结果: 456

-- 文本转小数
SELECT CONVERT('78.90', DECIMAL(8,2));
-- 结果: 78.90
```

**🔸 文本转换**
```sql
-- 数字转文本
SELECT CONVERT(789, CHAR);
-- 结果: "789"

-- 指定文本长度
SELECT CONVERT(123.45, CHAR(20));
-- 结果: "123.45              "
```

##### 3.2.2 日期时间转换


**🔸 常用日期转换**
```sql
-- 文本转日期
SELECT CONVERT('2024-01-01', DATE);
-- 结果: 2024-01-01

-- 文本转时间
SELECT CONVERT('14:30:00', TIME);
-- 结果: 14:30:00

-- 文本转日期时间
SELECT CONVERT('2024-01-01 14:30:00', DATETIME);
-- 结果: 2024-01-01 14:30:00
```

### 3.3 CONVERT的字符集转换功能


**🔸 字符编码转换**
```sql
-- 转换字符集 (MySQL特有功能)
SELECT CONVERT('中文测试' USING utf8mb4);

-- 查看字符集
SELECT CHARSET(CONVERT('测试' USING latin1));
```

> 📝 **说明**  
> 字符集转换主要用于处理不同编码的文本数据，在处理中文时特别有用。

---

## 4. 🎪 常用类型转换场景


### 4.1 数据清洗场景


**🔸 处理脏数据**
```sql
-- 原始数据表
┌─────────┬──────────┬─────────┐
│ user_id │   age    │  salary │
├─────────┼──────────┼─────────┤
│   1001  │   "25"   │ "5000"  │ ← 文本格式
│   1002  │   "30"   │ "6000"  │ ← 文本格式  
│   1003  │   "abc"  │ "7000"  │ ← 无效数据
└─────────┴──────────┴─────────┘

-- 数据清洗查询
SELECT user_id,
       CASE 
         WHEN age REGEXP '^[0-9]+$' THEN CAST(age AS SIGNED)
         ELSE NULL 
       END as clean_age,
       CAST(salary AS DECIMAL(10,2)) as clean_salary
FROM users;
```

### 4.2 数据比较场景


**🔸 文本数字比较**
```sql
-- 错误的比较方式 (文本比较)
SELECT '9' > '10';  -- 结果: 1 (错误! 文本'9'比'10'大)

-- 正确的比较方式 (数字比较)
SELECT CAST('9' AS SIGNED) > CAST('10' AS SIGNED);  -- 结果: 0 (正确)
```

**🔸 日期范围查询**
```sql
-- 查询指定日期范围的订单
SELECT * FROM orders 
WHERE CAST(order_date AS DATE) BETWEEN '2024-01-01' AND '2024-12-31';
```

### 4.3 数据统计场景


**🔸 数值统计**
```sql
-- 统计平均年龄 (假设age字段是文本类型)
SELECT AVG(CAST(age AS SIGNED)) as avg_age
FROM users
WHERE age REGEXP '^[0-9]+$';  -- 只统计有效数字

-- 统计总销售额 (假设amount字段是文本类型)  
SELECT SUM(CAST(amount AS DECIMAL(15,2))) as total_sales
FROM sales
WHERE amount IS NOT NULL;
```

### 4.4 数据展示场景


**🔸 格式化显示**
```sql
-- 生成格式化的用户信息
SELECT CONCAT(
    '用户编号: ', CAST(user_id AS CHAR),
    ', 年龄: ', CAST(age AS CHAR), '岁',
    ', 工资: ¥', CAST(salary AS CHAR)
) as user_info
FROM users;

-- 结果示例: "用户编号: 1001, 年龄: 25岁, 工资: ¥5000"
```

---

## 5. 🚀 实战应用案例


### 5.1 电商订单数据处理


**🔸 业务场景**
```
电商系统中，订单金额可能以文本形式存储，
需要转换为数字进行统计分析。
```

**🔸 示例数据**
```sql
-- 订单表结构
CREATE TABLE orders (
    order_id VARCHAR(20),
    customer_id INT,
    order_amount VARCHAR(20),  -- 文本格式金额
    order_date VARCHAR(20),    -- 文本格式日期
    status VARCHAR(10)
);

-- 样本数据
INSERT INTO orders VALUES 
('ORD001', 1001, '299.50', '2024-01-15', 'paid'),
('ORD002', 1002, '1580.00', '2024-01-16', 'paid'),
('ORD003', 1003, '45.80', '2024-01-17', 'pending');
```

**🔸 数据分析查询**
```sql
-- 1. 计算总销售额
SELECT SUM(CAST(order_amount AS DECIMAL(10,2))) as total_sales
FROM orders 
WHERE status = 'paid';

-- 2. 按月统计销售情况
SELECT 
    DATE_FORMAT(CAST(order_date AS DATE), '%Y-%m') as month,
    COUNT(*) as order_count,
    SUM(CAST(order_amount AS DECIMAL(10,2))) as month_sales
FROM orders 
WHERE status = 'paid'
GROUP BY DATE_FORMAT(CAST(order_date AS DATE), '%Y-%m');

-- 3. 查找大额订单 (金额>1000)
SELECT order_id, customer_id, order_amount
FROM orders 
WHERE CAST(order_amount AS DECIMAL(10,2)) > 1000;
```

### 5.2 用户年龄统计分析


**🔸 业务场景**
```
用户注册时输入的生日是文本格式，
需要转换为日期计算年龄并进行统计。
```

**🔸 示例查询**
```sql
-- 计算用户年龄并分组统计
SELECT 
    CASE 
        WHEN YEAR(CURDATE()) - YEAR(CAST(birthday AS DATE)) < 18 THEN '未成年'
        WHEN YEAR(CURDATE()) - YEAR(CAST(birthday AS DATE)) BETWEEN 18 AND 30 THEN '青年'
        WHEN YEAR(CURDATE()) - YEAR(CAST(birthday AS DATE)) BETWEEN 31 AND 50 THEN '中年'
        ELSE '老年'
    END as age_group,
    COUNT(*) as user_count
FROM users 
WHERE birthday IS NOT NULL 
  AND birthday != ''
GROUP BY age_group;
```

### 5.3 数据导入格式统一


**🔸 业务场景**
```
从Excel导入的数据都是文本格式，
需要转换为合适的数据类型存储。
```

**🔸 数据转换脚本**
```sql
-- 创建临时导入表 (全文本字段)
CREATE TABLE temp_import (
    id_str VARCHAR(20),
    name_str VARCHAR(100), 
    age_str VARCHAR(10),
    salary_str VARCHAR(20),
    join_date_str VARCHAR(20)
);

-- 转换并插入到正式表
INSERT INTO employees (id, name, age, salary, join_date)
SELECT 
    CAST(id_str AS SIGNED),                           -- ID转整数
    name_str,                                         -- 姓名保持文本
    CAST(age_str AS SIGNED),                         -- 年龄转整数
    CAST(salary_str AS DECIMAL(10,2)),               -- 工资转小数
    CAST(join_date_str AS DATE)                      -- 入职日期转日期
FROM temp_import
WHERE id_str REGEXP '^[0-9]+$'                      -- 验证ID是数字
  AND age_str REGEXP '^[0-9]+$'                     -- 验证年龄是数字
  AND salary_str REGEXP '^[0-9]+\.?[0-9]*$'         -- 验证工资格式
  AND STR_TO_DATE(join_date_str, '%Y-%m-%d') IS NOT NULL; -- 验证日期格式
```

---

## 6. 📋 核心要点总结


### 6.1 必须掌握的核心概念


```
🔸 类型转换目的: 统一数据格式，确保计算和比较的准确性
🔸 CAST语法: CAST(数据 AS 类型) - SQL标准，通用性好
🔸 CONVERT语法: CONVERT(数据, 类型) - MySQL特有，写法简洁
🔸 常用类型: SIGNED(整数)、DECIMAL(小数)、CHAR(文本)、DATE(日期)
🔸 转换失败: 数字类型返回0，日期类型返回NULL
```

### 6.2 实际应用要点


**🔹 数据验证很重要**
```sql
-- 转换前先验证数据格式
WHERE field REGEXP '^[0-9]+$'  -- 验证是否为纯数字
WHERE STR_TO_DATE(field, '%Y-%m-%d') IS NOT NULL  -- 验证日期格式
```

**🔹 选择合适的数据类型**
```sql
金额字段: DECIMAL(15,2)    -- 精确小数，避免浮点误差
整数字段: SIGNED           -- 支持正负数
文本字段: VARCHAR(长度)     -- 根据实际需求设置长度
日期字段: DATE 或 DATETIME  -- 根据是否需要时间决定
```

**🔹 处理异常数据**
```sql
-- 使用CASE语句处理异常情况
CASE 
    WHEN field IS NULL OR field = '' THEN 0
    WHEN field REGEXP '^[0-9]+$' THEN CAST(field AS SIGNED)
    ELSE 0
END
```

### 6.3 最佳实践建议


**🎯 设计阶段**
- 💡 **数据库设计时就确定合适的数据类型**，避免后期频繁转换
- 💡 **导入数据前进行格式验证**，确保数据质量

**🎯 开发阶段**  
- 💡 **优先使用CAST函数**，兼容性更好
- 💡 **转换前先验证数据格式**，避免转换失败
- 💡 **在WHERE子句中谨慎使用类型转换**，可能影响索引效率

**🎯 维护阶段**
- 💡 **定期检查转换失败的数据**，及时清理异常数据
- 💡 **监控转换性能**，大批量数据转换时考虑分批处理

> 🧠 **记忆口诀**  
> "CAST AS 类型转换，CONVERT 简洁方便；  
> 数字文本日期转，验证格式很关键；  
> 失败返回零或空，异常处理要周全！"

### 6.4 扩展学习方向


**🔗 相关知识点**
- [MySQL数据类型详解](#mysql-data-types) 
- [字符串函数应用](#string-functions)
- [日期时间函数](#datetime-functions)
- [条件判断函数](#conditional-functions)

**💪 实战练习建议**
1. 创建包含各种数据类型的测试表
2. 练习不同类型间的相互转换
3. 模拟实际业务场景进行数据处理
4. 分析转换对查询性能的影响

**核心掌握标准**：
- ✅ 能说出CAST和CONVERT的语法差异
- ✅ 能处理常见的数据类型转换需求  
- ✅ 能识别和处理转换异常情况
- ✅ 能在实际项目中合理使用类型转换