---
title: 4ã€OAuth2.0æˆæƒæµç¨‹
---
## ğŸ“š ç›®å½•

1. [OAuth2.0æ˜¯ä»€ä¹ˆ](#1-OAuth20æ˜¯ä»€ä¹ˆ)
2. [æ ¸å¿ƒè§’è‰²ç†è§£](#2-æ ¸å¿ƒè§’è‰²ç†è§£)
3. [æˆæƒç æµç¨‹è¯¦è§£](#3-æˆæƒç æµç¨‹è¯¦è§£)
4. [å…¶ä»–æˆæƒæ–¹å¼](#4-å…¶ä»–æˆæƒæ–¹å¼)
5. [ä½œç”¨åŸŸæƒé™è®¾è®¡](#5-ä½œç”¨åŸŸæƒé™è®¾è®¡)
6. [ç¬¬ä¸‰æ–¹ç™»å½•å®æˆ˜](#6-ç¬¬ä¸‰æ–¹ç™»å½•å®æˆ˜)
7. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#7-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ” OAuth2.0æ˜¯ä»€ä¹ˆ


### 1.1 é€šä¿—ç†è§£OAuth2.0


**ğŸ  ç”Ÿæ´»åœºæ™¯æ¯”å–»**ï¼š
æƒ³è±¡ä½ ä½åœ¨ä¸€ä¸ªå°åŒºï¼Œä½ æƒ³è®©å¿«é€’å‘˜æŠŠåŒ…è£¹é€åˆ°ä½ å®¶ï¼Œä½†ä¸æƒ³ç»™ä»–ä½ å®¶çš„é’¥åŒ™ã€‚è¿™æ—¶å€™ä½ å¯ä»¥ï¼š
- ç»™å¿«é€’å‘˜ä¸€ä¸ª**ä¸´æ—¶é—¨ç¦å¡**
- è¿™ä¸ªå¡åªèƒ½**ä»Šå¤©ä½¿ç”¨**
- åªèƒ½**è¿›å…¥ä½ çš„æ¥¼å±‚**ï¼Œä¸èƒ½å»å…¶ä»–åœ°æ–¹

OAuth2.0å°±æ˜¯è¿™æ ·çš„"ä¸´æ—¶é—¨ç¦å¡"ç³»ç»Ÿï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼šç”¨æˆ·æŠŠç”¨æˆ·åå¯†ç å‘Šè¯‰ç¬¬ä¸‰æ–¹åº”ç”¨ï¼ˆå±é™©ï¼ï¼‰
OAuthæ–¹å¼ï¼šç”¨æˆ·æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è·å¾—"ä¸´æ—¶é€šè¡Œè¯"ï¼ˆå®‰å…¨ï¼ï¼‰
```

### 1.2 OAuth2.0è§£å†³çš„é—®é¢˜


**ğŸ”¸ æ ¸å¿ƒé—®é¢˜**ï¼šå¦‚ä½•å®‰å…¨åœ°è®©ç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®ç”¨æˆ·çš„æ•°æ®ï¼Ÿ

**ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜**ï¼š
```
ç”¨æˆ·ï¼šæˆ‘æƒ³ç”¨ç¾å›¾ç§€ç§€ç¼–è¾‘å¾®ä¿¡å¤´åƒ
ä¼ ç»Ÿåšæ³•ï¼šæŠŠå¾®ä¿¡ç”¨æˆ·åå¯†ç å‘Šè¯‰ç¾å›¾ç§€ç§€
é—®é¢˜ï¼š
âŒ ç¾å›¾ç§€ç§€çŸ¥é“äº†ä½ çš„å¯†ç 
âŒ ç¾å›¾ç§€ç§€å¯ä»¥åšä»»ä½•äº‹æƒ…
âŒ æƒ³æ’¤å›æƒé™ï¼Œå¿…é¡»æ”¹å¯†ç 
```

**OAuth2.0çš„è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ·ï¼šæˆ‘æƒ³ç”¨ç¾å›¾ç§€ç§€ç¼–è¾‘å¾®ä¿¡å¤´åƒ
OAuthåšæ³•ï¼šå¾®ä¿¡ç»™ç¾å›¾ç§€ç§€ä¸€ä¸ª"ä¸´æ—¶ä»¤ç‰Œ"
ä¼˜åŠ¿ï¼š
âœ… ç¾å›¾ç§€ç§€ä¸çŸ¥é“ä½ çš„å¯†ç 
âœ… åªèƒ½è®¿é—®å¤´åƒï¼Œä¸èƒ½å‘æœ‹å‹åœˆ
âœ… å¯ä»¥éšæ—¶æ’¤å›æƒé™
```

---

## 2. ğŸ‘¥ æ ¸å¿ƒè§’è‰²ç†è§£


### 2.1 å››ä¸ªæ ¸å¿ƒè§’è‰²


OAuth2.0å°±åƒä¸€å‡ºæˆï¼Œæœ‰å››ä¸ªä¸»è¦è§’è‰²ï¼š

```
ğŸ­ OAuth2.0 çš„å››ä¸ªæ¼”å‘˜

ğŸ‘¤ ç”¨æˆ· (Resource Owner)
   â†“ "æˆ‘æƒ³ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨"
   
ğŸ“± ç¬¬ä¸‰æ–¹åº”ç”¨ (Client)  
   â†“ "æˆ‘æƒ³è®¿é—®ç”¨æˆ·æ•°æ®"
   
ğŸ›ï¸ æˆæƒæœåŠ¡å™¨ (Authorization Server)
   â†“ "æˆ‘æ¥éªŒè¯èº«ä»½å’Œå‘æ”¾ä»¤ç‰Œ"
   
ğŸ’¾ èµ„æºæœåŠ¡å™¨ (Resource Server)
   â†“ "æˆ‘å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œå‡­ä»¤ç‰Œæä¾›æœåŠ¡"
```

### 2.2 è§’è‰²è¯¦è§£


**ğŸ‘¤ ç”¨æˆ· (Resource Owner)**
```
ç®€å•è¯´ï¼šå°±æ˜¯ä½ è‡ªå·±
ä½œç”¨ï¼šæ‹¥æœ‰æ•°æ®çš„äººï¼Œå†³å®šæ˜¯å¦æˆæƒ
ä¾‹å­ï¼šä½ æœ‰å¾®ä¿¡è´¦å·ï¼Œä½ çš„å¤´åƒã€æœ‹å‹åœˆéƒ½æ˜¯ä½ çš„èµ„æº
```

**ğŸ“± ç¬¬ä¸‰æ–¹åº”ç”¨ (Client)**  
```
ç®€å•è¯´ï¼šæƒ³è¦è®¿é—®ä½ æ•°æ®çš„åº”ç”¨
ä½œç”¨ï¼šä»£è¡¨ç”¨æˆ·å»è®¿é—®èµ„æº
ä¾‹å­ï¼šç¾å›¾ç§€ç§€æƒ³è®¿é—®ä½ çš„å¾®ä¿¡å¤´åƒæ¥ç¼–è¾‘
```

**ğŸ›ï¸ æˆæƒæœåŠ¡å™¨ (Authorization Server)**
```
ç®€å•è¯´ï¼šéªŒè¯èº«ä»½ã€å‘æ”¾"é€šè¡Œè¯"çš„åœ°æ–¹
ä½œç”¨ï¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå‘æ”¾è®¿é—®ä»¤ç‰Œ
ä¾‹å­ï¼šå¾®ä¿¡çš„ç™»å½•éªŒè¯ç³»ç»Ÿ
```

**ğŸ’¾ èµ„æºæœåŠ¡å™¨ (Resource Server)**
```
ç®€å•è¯´ï¼šå­˜æ”¾ä½ æ•°æ®çš„åœ°æ–¹
ä½œç”¨ï¼šä¿æŠ¤ç”¨æˆ·èµ„æºï¼ŒéªŒè¯ä»¤ç‰Œåæä¾›æ•°æ®
ä¾‹å­ï¼šå­˜å‚¨ä½ å¾®ä¿¡å¤´åƒçš„æœåŠ¡å™¨
```

### 2.3 è§’è‰²å…³ç³»å›¾


```
ç°å®åœºæ™¯ï¼šç”¨ç¾å›¾ç§€ç§€ç¼–è¾‘å¾®ä¿¡å¤´åƒ

ä½ ï¼ˆç”¨æˆ·ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€"æˆ‘è¦ç”¨ç¾å›¾ç§€ç§€"â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç¾å›¾ç§€ç§€ï¼ˆç¬¬ä¸‰æ–¹åº”ç”¨ï¼‰
    â”‚                                           â”‚
    â”‚"è¯·è¾“å…¥å¾®ä¿¡è´¦å·å¯†ç "                          â”‚"æˆ‘éœ€è¦è®¿é—®ç”¨æˆ·å¤´åƒ"
    â†“                                           â†“
å¾®ä¿¡ç™»å½•é¡µé¢ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€æˆæƒè¯·æ±‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
(æˆæƒæœåŠ¡å™¨)
    â”‚
    â”‚"éªŒè¯é€šè¿‡ï¼Œè¿™æ˜¯ä»¤ç‰Œ"
    â†“                    
å¾®ä¿¡å­˜å‚¨æœåŠ¡å™¨ â†â”€â”€â”€â”€â”€ä»¤ç‰ŒéªŒè¯â”€â”€â”€â”€â”€â”€â”€ ç¾å›¾ç§€ç§€
(èµ„æºæœåŠ¡å™¨)   â”€â”€â”€â”€å¤´åƒæ•°æ®â”€â”€â”€â”€â†’   (ç¬¬ä¸‰æ–¹åº”ç”¨)
```

---

## 3. ğŸ”„ æˆæƒç æµç¨‹è¯¦è§£


### 3.1 æˆæƒç æ¨¡å¼æ˜¯ä»€ä¹ˆ


**ğŸ¯ æœ€å®‰å…¨ã€æœ€å¸¸ç”¨çš„æˆæƒæ–¹å¼**

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒå»é“¶è¡ŒåŠä¸šåŠ¡ï¼Œéœ€è¦å…ˆæ‹¿å·ï¼Œå†ç”¨å·ç åŠäº‹

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- ğŸ”¸ **ä¸¤æ­¥éªŒè¯**ï¼šå…ˆè·å–æˆæƒç ï¼Œå†ç”¨æˆæƒç æ¢ä»¤ç‰Œ
- ğŸ”¸ **åç«¯å®‰å…¨**ï¼šæ•æ„Ÿæ“ä½œåœ¨åç«¯è¿›è¡Œ
- ğŸ”¸ **é€‚ç”¨åœºæ™¯**ï¼šæœ‰åç«¯æœåŠ¡çš„Webåº”ç”¨

### 3.2 è¯¦ç»†æµç¨‹æ­¥éª¤


**ğŸ“ 6æ­¥æˆæƒæµç¨‹**ï¼š

```
æ­¥éª¤1: ç”¨æˆ·ç‚¹å‡»"å¾®ä¿¡ç™»å½•"
   ç”¨æˆ· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç¬¬ä¸‰æ–¹åº”ç”¨
        "æˆ‘è¦ç”¨å¾®ä¿¡ç™»å½•"

æ­¥éª¤2: è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢  
   ç¬¬ä¸‰æ–¹åº”ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¾®ä¿¡æˆæƒæœåŠ¡å™¨
              "è¯·ç”¨æˆ·æˆæƒè®¿é—®å¤´åƒ"

æ­¥éª¤3: ç”¨æˆ·ç¡®è®¤æˆæƒ
   ç”¨æˆ· â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¾®ä¿¡æˆæƒæœåŠ¡å™¨  
        "æˆ‘åŒæ„æˆæƒ"

æ­¥éª¤4: è¿”å›æˆæƒç 
   å¾®ä¿¡æˆæƒæœåŠ¡å™¨ â”€â”€â”€â†’ ç¬¬ä¸‰æ–¹åº”ç”¨
                "è¿™æ˜¯æˆæƒç : ABC123"

æ­¥éª¤5: ç”¨æˆæƒç æ¢å–ä»¤ç‰Œ
   ç¬¬ä¸‰æ–¹åº”ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¾®ä¿¡æˆæƒæœåŠ¡å™¨
              "ç”¨æˆæƒç ABC123æ¢ä»¤ç‰Œ"

æ­¥éª¤6: ç”¨ä»¤ç‰Œè®¿é—®æ•°æ®
   ç¬¬ä¸‰æ–¹åº”ç”¨ â”€â”€â”€â”€â”€â”€â”€â”€â†’ å¾®ä¿¡èµ„æºæœåŠ¡å™¨
              "ç”¨ä»¤ç‰Œè·å–ç”¨æˆ·å¤´åƒ"
```

### 3.3 å®é™…è¯·æ±‚ç¤ºä¾‹


**æ­¥éª¤2ï¼šè·³è½¬æˆæƒé¡µé¢**
```http
GET https://open.weixin.qq.com/connect/oauth2/authorize?
  response_type=code&           # è¡¨ç¤ºè¦æˆæƒç 
  client_id=ä½ çš„åº”ç”¨ID&         # ç¬¬ä¸‰æ–¹åº”ç”¨æ ‡è¯†  
  redirect_uri=å›è°ƒåœ°å€&        # æˆæƒåè·³è½¬çš„åœ°å€
  scope=snsapi_userinfo&       # è¦è®¿é—®çš„æƒé™èŒƒå›´
  state=éšæœºå­—ç¬¦ä¸²              # é˜²æ­¢æ”»å‡»çš„å‚æ•°
```

**æ­¥éª¤4ï¼šè¿”å›æˆæƒç **
```http
# ç”¨æˆ·æˆæƒåï¼Œå¾®ä¿¡ä¼šè·³è½¬åˆ°ä½ æŒ‡å®šçš„å›è°ƒåœ°å€
GET https://ä½ çš„ç½‘ç«™.com/callback?
  code=AUTHORIZATION_CODE&     # è¿™å°±æ˜¯æˆæƒç 
  state=ä½ ä¹‹å‰çš„éšæœºå­—ç¬¦ä¸²
```

**æ­¥éª¤5ï¼šç”¨æˆæƒç æ¢ä»¤ç‰Œ**
```http
POST https://api.weixin.qq.com/sns/oauth2/access_token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&  # è¡¨ç¤ºç”¨æˆæƒç æ¢ä»¤ç‰Œ
code=åˆšæ‰å¾—åˆ°çš„æˆæƒç &         # æˆæƒç 
client_id=ä½ çš„åº”ç”¨ID&          # åº”ç”¨æ ‡è¯†
client_secret=ä½ çš„åº”ç”¨å¯†é’¥&    # åº”ç”¨å¯†é’¥
redirect_uri=ä¹‹å‰çš„å›è°ƒåœ°å€     # å¿…é¡»ä¸€è‡´
```

**æ­¥éª¤6ï¼šè·å–ç”¨æˆ·ä¿¡æ¯**
```http
GET https://api.weixin.qq.com/sns/userinfo?
  access_token=åˆšæ‰å¾—åˆ°çš„ä»¤ç‰Œ&  # è®¿é—®ä»¤ç‰Œ
  openid=ç”¨æˆ·æ ‡è¯†              # ç”¨æˆ·ID
```

---

## 4. ğŸ”€ å…¶ä»–æˆæƒæ–¹å¼


### 4.1 éšå¼æˆæƒæµç¨‹ (Implicit Grant)


**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šçº¯å‰ç«¯åº”ç”¨ï¼ˆå¦‚å•é¡µé¢åº”ç”¨ï¼‰

**ğŸ”¸ ç‰¹ç‚¹**ï¼š
- æ²¡æœ‰åç«¯æœåŠ¡å™¨
- ç›´æ¥è¿”å›ä»¤ç‰Œï¼Œä¸è¿”å›æˆæƒç 
- å®‰å…¨æ€§è¾ƒä½ï¼Œä»¤ç‰Œæš´éœ²åœ¨URLä¸­

**ğŸ’» æµç¨‹å¯¹æ¯”**ï¼š
```
æˆæƒç æ¨¡å¼ï¼š
ç”¨æˆ·æˆæƒ â†’ è¿”å›æˆæƒç  â†’ åç«¯ç”¨æˆæƒç æ¢ä»¤ç‰Œ â†’ ä½¿ç”¨ä»¤ç‰Œ

éšå¼æ¨¡å¼ï¼š
ç”¨æˆ·æˆæƒ â†’ ç›´æ¥è¿”å›ä»¤ç‰Œ â†’ ä½¿ç”¨ä»¤ç‰Œ
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
GET https://open.weixin.qq.com/connect/oauth2/authorize?
  response_type=token&          # ç›´æ¥è¦ä»¤ç‰Œ
  client_id=ä½ çš„åº”ç”¨ID&
  redirect_uri=å›è°ƒåœ°å€&
  scope=snsapi_base
```

### 4.2 å¯†ç æ¨¡å¼ (Password Credentials)


**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šåº”ç”¨å’ŒæˆæƒæœåŠ¡å™¨æ˜¯åŒä¸€å®¶å…¬å¸

**ğŸ”¸ ç‰¹ç‚¹**ï¼š
- ç”¨æˆ·ç›´æ¥æŠŠç”¨æˆ·åå¯†ç ç»™ç¬¬ä¸‰æ–¹åº”ç”¨
- ç¬¬ä¸‰æ–¹åº”ç”¨ç”¨ç”¨æˆ·åå¯†ç æ¢å–ä»¤ç‰Œ  
- åªèƒ½åœ¨ç»å¯¹ä¿¡ä»»çš„æƒ…å†µä¸‹ä½¿ç”¨

> âš ï¸ **æ³¨æ„**ï¼šè¿™ç§æ¨¡å¼å¾ˆå±é™©ï¼Œä¸€èˆ¬ä¸æ¨èä½¿ç”¨

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
POST https://api.weixin.qq.com/token
Content-Type: application/x-www-form-urlencoded

grant_type=password&
username=ç”¨æˆ·æ‰‹æœºå·&
password=ç”¨æˆ·å¯†ç &
client_id=åº”ç”¨ID&
client_secret=åº”ç”¨å¯†é’¥
```

### 4.3 å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼ (Client Credentials)


**ğŸ¯ é€‚ç”¨åœºæ™¯**ï¼šåº”ç”¨è®¿é—®è‡ªå·±çš„èµ„æºï¼Œä¸æ¶‰åŠç”¨æˆ·

**ğŸ”¸ ç‰¹ç‚¹**ï¼š
- æ²¡æœ‰ç”¨æˆ·å‚ä¸
- åº”ç”¨ç›´æ¥ç”¨è‡ªå·±çš„å‡­è¯è·å–ä»¤ç‰Œ
- é€‚åˆæœåŠ¡å™¨å¯¹æœåŠ¡å™¨çš„é€šä¿¡

**ğŸ’» åº”ç”¨åœºæ™¯**ï¼š
```
ä¾‹å­ï¼šå¤©æ°”åº”ç”¨æƒ³è·å–å¤©æ°”æ•°æ®
- ä¸éœ€è¦ç”¨æˆ·æˆæƒ
- ç›´æ¥ç”¨åº”ç”¨å‡­è¯è·å–ä»¤ç‰Œ
- ç”¨ä»¤ç‰Œè°ƒç”¨å¤©æ°”API
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```http
POST https://api.weather.com/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials&
client_id=ä½ çš„åº”ç”¨ID&
client_secret=ä½ çš„åº”ç”¨å¯†é’¥&
scope=weather_data
```

---

## 5. ğŸ¯ ä½œç”¨åŸŸæƒé™è®¾è®¡


### 5.1 ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸ (Scope)


**ğŸ”¸ é€šä¿—ç†è§£**ï¼šä½œç”¨åŸŸå°±åƒ"æƒé™æ¸…å•"ï¼Œè§„å®šç¬¬ä¸‰æ–¹åº”ç”¨èƒ½åšä»€ä¹ˆ

```
ç”Ÿæ´»æ¯”å–»ï¼š
ä¸´æ—¶é—¨ç¦å¡å¯ä»¥è®¾ç½®æƒé™ï¼š
âœ… å¯ä»¥è¿›1æ¥¼å¤§å…
âœ… å¯ä»¥ä¹˜åç”µæ¢¯
âŒ ä¸èƒ½è¿›åœ°ä¸‹è½¦åº“  
âŒ ä¸èƒ½è¿›å…¶ä»–æ¥¼å±‚
```

### 5.2 å¸¸è§ä½œç”¨åŸŸè®¾è®¡


**ğŸ“± å¾®ä¿¡å°ç¨‹åºä½œç”¨åŸŸ**ï¼š
```
snsapi_base     # åŸºç¡€ä¿¡æ¯ï¼ˆç”¨æˆ·IDï¼‰
snsapi_userinfo # ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒï¼‰
snsapi_login    # ç™»å½•æƒé™
```

**ğŸ“§ é‚®ä»¶ç³»ç»Ÿä½œç”¨åŸŸ**ï¼š
```
read_email      # è¯»å–é‚®ä»¶
send_email      # å‘é€é‚®ä»¶  
manage_contacts # ç®¡ç†è”ç³»äºº
admin_account   # ç®¡ç†è´¦æˆ·
```

**â˜ï¸ äº‘å­˜å‚¨ä½œç”¨åŸŸ**ï¼š
```
read_files      # è¯»å–æ–‡ä»¶
write_files     # å†™å…¥æ–‡ä»¶
delete_files    # åˆ é™¤æ–‡ä»¶
admin_storage   # å­˜å‚¨ç®¡ç†
```

### 5.3 ä½œç”¨åŸŸæœ€ä½³å®è·µ


**ğŸ”¸ æœ€å°æƒé™åŸåˆ™**ï¼š
```javascript
// âŒ ç”³è¯·è¿‡å¤šæƒé™
const badScopes = [
  'read_profile',
  'read_email', 
  'send_email',
  'manage_friends',
  'admin_account'  // ç¬¬ä¸‰æ–¹åº”ç”¨ä¸éœ€è¦è¿™ä¸ª
];

// âœ… åªç”³è¯·å¿…è¦æƒé™
const goodScopes = [
  'read_profile',  // åªè¦ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  'read_email'     // åªè¦è¯»å–é‚®ä»¶æƒé™
];
```

**ğŸ”¸ æƒé™åˆ†çº§**ï¼š
```
åŸºç¡€çº§åˆ«ï¼šread_basicï¼ˆåŸºæœ¬ä¿¡æ¯ï¼‰
æ ‡å‡†çº§åˆ«ï¼šread_profileï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰  
é«˜çº§çº§åˆ«ï¼šmanage_accountï¼ˆè´¦æˆ·ç®¡ç†ï¼‰
ç®¡ç†çº§åˆ«ï¼šadmin_fullï¼ˆå®Œå…¨æ§åˆ¶ï¼‰
```

---

## 6. ğŸš€ ç¬¬ä¸‰æ–¹ç™»å½•å®æˆ˜


### 6.1 é›†æˆå¾®ä¿¡ç™»å½•


**ğŸ“ å‡†å¤‡å·¥ä½œ**ï¼š
1. åœ¨å¾®ä¿¡å¼€æ”¾å¹³å°æ³¨å†Œåº”ç”¨
2. è·å– `client_id` å’Œ `client_secret`
3. é…ç½®å›è°ƒåœ°å€

**å‰ç«¯ä»£ç ç¤ºä¾‹**ï¼š
```html
<!-- å¾®ä¿¡ç™»å½•æŒ‰é’® -->
<button onclick="wechatLogin()">
  <img src="wechat-icon.png" alt="å¾®ä¿¡">
  å¾®ä¿¡ç™»å½•
</button>

<script>
function wechatLogin() {
  // æ„é€ æˆæƒURL
  const authUrl = 'https://open.weixin.qq.com/connect/qrconnect?' + 
    'appid=ä½ çš„åº”ç”¨ID&' +
    'redirect_uri=' + encodeURIComponent('https://yoursite.com/callback') + '&' +
    'response_type=code&' +
    'scope=snsapi_login&' +
    'state=é˜²æ”»å‡»éšæœºå­—ç¬¦ä¸²';
  
  // è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢
  window.location.href = authUrl;
}
</script>
```

**åç«¯å¤„ç†å›è°ƒ**ï¼š
```javascript
// Node.js + Express ç¤ºä¾‹
app.get('/callback', async (req, res) => {
  const { code, state } = req.query;
  
  // 1. éªŒè¯ state å‚æ•°ï¼ˆé˜²æ­¢æ”»å‡»ï¼‰
  if (state !== 'ä½ çš„éšæœºå­—ç¬¦ä¸²') {
    return res.status(400).json({ error: 'æ— æ•ˆè¯·æ±‚' });
  }
  
  try {
    // 2. ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
    const tokenResponse = await fetch('https://api.weixin.qq.com/sns/oauth2/access_token', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: `grant_type=authorization_code&code=${code}&appid=ä½ çš„åº”ç”¨ID&secret=ä½ çš„åº”ç”¨å¯†é’¥`
    });
    
    const tokenData = await tokenResponse.json();
    
    // 3. ç”¨è®¿é—®ä»¤ç‰Œè·å–ç”¨æˆ·ä¿¡æ¯
    const userResponse = await fetch(
      `https://api.weixin.qq.com/sns/userinfo?access_token=${tokenData.access_token}&openid=${tokenData.openid}`
    );
    
    const userData = await userResponse.json();
    
    // 4. åˆ›å»ºæœ¬åœ°ç”¨æˆ·ä¼šè¯
    req.session.user = {
      id: userData.openid,
      name: userData.nickname,
      avatar: userData.headimgurl
    };
    
    // 5. è·³è½¬åˆ°åº”ç”¨é¦–é¡µ
    res.redirect('/dashboard');
    
  } catch (error) {
    res.status(500).json({ error: 'ç™»å½•å¤±è´¥' });
  }
});
```

### 6.2 é›†æˆGitHubç™»å½•


**GitHub OAuthé…ç½®**ï¼š
```javascript
const githubConfig = {
  clientId: 'ä½ çš„GitHubåº”ç”¨ID',
  clientSecret: 'ä½ çš„GitHubåº”ç”¨å¯†é’¥',
  authUrl: 'https://github.com/login/oauth/authorize',
  tokenUrl: 'https://github.com/login/oauth/access_token',
  userUrl: 'https://api.github.com/user'
};

// ç”ŸæˆæˆæƒURL
function getGitHubAuthUrl() {
  const params = new URLSearchParams({
    client_id: githubConfig.clientId,
    redirect_uri: 'https://yoursite.com/auth/github/callback',
    scope: 'user:email',  // è¯·æ±‚é‚®ç®±æƒé™
    state: generateRandomString()
  });
  
  return `${githubConfig.authUrl}?${params}`;
}
```

### 6.3 å¤šå¹³å°ç™»å½•ç»Ÿä¸€å¤„ç†


**ğŸ”§ ç»Ÿä¸€ç™»å½•æ¥å£**ï¼š
```javascript
class OAuthManager {
  constructor() {
    this.providers = {
      wechat: {
        authUrl: 'https://open.weixin.qq.com/connect/qrconnect',
        tokenUrl: 'https://api.weixin.qq.com/sns/oauth2/access_token',
        userUrl: 'https://api.weixin.qq.com/sns/userinfo'
      },
      github: {
        authUrl: 'https://github.com/login/oauth/authorize',
        tokenUrl: 'https://github.com/login/oauth/access_token',
        userUrl: 'https://api.github.com/user'
      }
    };
  }
  
  // ç”ŸæˆæˆæƒURL
  getAuthUrl(provider, redirectUri) {
    const config = this.providers[provider];
    if (!config) throw new Error('ä¸æ”¯æŒçš„ç™»å½•æ–¹å¼');
    
    // æ ¹æ®ä¸åŒå¹³å°æ„é€ ç›¸åº”çš„æˆæƒURL
    // ...
  }
  
  // å¤„ç†å›è°ƒ
  async handleCallback(provider, code) {
    const config = this.providers[provider];
    
    // 1. æ¢å–è®¿é—®ä»¤ç‰Œ
    const token = await this.exchangeToken(config, code);
    
    // 2. è·å–ç”¨æˆ·ä¿¡æ¯  
    const user = await this.fetchUser(config, token);
    
    return this.normalizeUser(provider, user);
  }
}
```

---

## 7. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 7.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ OAuth2.0æœ¬è´¨ï¼šå®‰å…¨çš„ç¬¬ä¸‰æ–¹æˆæƒåè®®ï¼Œé¿å…å¯†ç æ³„éœ²
ğŸ”¸ å››ä¸ªè§’è‰²ï¼šç”¨æˆ·ã€ç¬¬ä¸‰æ–¹åº”ç”¨ã€æˆæƒæœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨
ğŸ”¸ æˆæƒç æ¨¡å¼ï¼šæœ€å®‰å…¨çš„æˆæƒæ–¹å¼ï¼Œé€‚åˆæœ‰åç«¯çš„åº”ç”¨
ğŸ”¸ è®¿é—®ä»¤ç‰Œï¼šä¸´æ—¶çš„"é€šè¡Œè¯"ï¼Œæœ‰æ—¶æ•ˆæ€§å’Œæƒé™é™åˆ¶
ğŸ”¸ ä½œç”¨åŸŸè®¾è®¡ï¼šæƒé™æœ€å°åŒ–åŸåˆ™ï¼Œåªç”³è¯·å¿…è¦çš„æƒé™
```

### 7.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ ä¸ºä»€ä¹ˆéœ€è¦OAuth2.0**
```
è§£å†³é—®é¢˜ï¼š
- é¿å…ç”¨æˆ·å¯†ç æ³„éœ²ç»™ç¬¬ä¸‰æ–¹
- æä¾›ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
- æ”¯æŒä»¤ç‰Œçš„æ’¤å›å’Œæ›´æ–°

æ ¸å¿ƒä»·å€¼ï¼š
- å®‰å…¨æ€§ï¼šä¸æš´éœ²ç”¨æˆ·å¯†ç 
- çµæ´»æ€§ï¼šå¯æ§åˆ¶è®¿é—®æƒé™
- ä¾¿åˆ©æ€§ï¼šç»Ÿä¸€çš„æˆæƒæ ‡å‡†
```

**ğŸ”¹ æˆæƒç  vs è®¿é—®ä»¤ç‰Œ**
```
æˆæƒç ï¼š
- ä¸€æ¬¡æ€§ä½¿ç”¨
- ç”¨æ¥æ¢å–è®¿é—®ä»¤ç‰Œ
- æœ‰æ•ˆæœŸå¾ˆçŸ­ï¼ˆå‡ åˆ†é’Ÿï¼‰

è®¿é—®ä»¤ç‰Œï¼š
- å¯å¤šæ¬¡ä½¿ç”¨
- ç”¨æ¥è®¿é—®ç”¨æˆ·èµ„æº  
- æœ‰æ•ˆæœŸè¾ƒé•¿ï¼ˆ1-2å°æ—¶ï¼‰
```

**ğŸ”¹ å®‰å…¨æ³¨æ„äº‹é¡¹**
```
å¿…é¡»éªŒè¯ï¼š
âœ… stateå‚æ•°ï¼ˆé˜²æ­¢CSRFæ”»å‡»ï¼‰
âœ… redirect_uriä¸€è‡´æ€§
âœ… ä»¤ç‰Œæœ‰æ•ˆæœŸ
âœ… æƒé™èŒƒå›´åˆç†æ€§

é¿å…é”™è¯¯ï¼š
âŒ åœ¨å‰ç«¯å­˜å‚¨client_secret
âŒ ä½¿ç”¨HTTPä¼ è¾“æ•æ„Ÿä¿¡æ¯
âŒ ç”³è¯·è¿‡å¤šä¸å¿…è¦çš„æƒé™
```

### 7.3 å®é™…åº”ç”¨åœºæ™¯


**ğŸ¯ å¸¸è§åº”ç”¨**ï¼š
- **ç¤¾äº¤ç™»å½•**ï¼šå¾®ä¿¡ã€QQã€GitHubç™»å½•
- **APIè®¿é—®**ï¼šç¬¬ä¸‰æ–¹åº”ç”¨è®¿é—®å¹³å°API
- **å•ç‚¹ç™»å½•**ï¼šä¼ä¸šå†…éƒ¨ç³»ç»Ÿç»Ÿä¸€ç™»å½•
- **ç§»åŠ¨åº”ç”¨**ï¼šAppæˆæƒè®¿é—®äº‘æœåŠ¡

**ğŸ”§ é€‰æ‹©æˆæƒæ¨¡å¼**ï¼š
```
æœ‰åç«¯æœåŠ¡ â†’ æˆæƒç æ¨¡å¼ï¼ˆæ¨èï¼‰
çº¯å‰ç«¯åº”ç”¨ â†’ éšå¼æˆæƒæ¨¡å¼
åŒå…¬å¸äº§å“ â†’ å¯†ç æ¨¡å¼ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
æœåŠ¡å™¨é€šä¿¡ â†’ å®¢æˆ·ç«¯å‡­è¯æ¨¡å¼
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- OAuth2.0æ˜¯"ä¸´æ—¶é€šè¡Œè¯"ç³»ç»Ÿ
- æˆæƒç æ¨¡å¼åˆ†ä¸¤æ­¥ï¼šå…ˆæ‹¿ç ï¼Œå†æ¢ä»¤ç‰Œ  
- æƒé™æœ€å°åŒ–ï¼Œå®‰å…¨ç¬¬ä¸€
- ä¸åŒåœºæ™¯é€‰æ‹©ä¸åŒçš„æˆæƒæ¨¡å¼