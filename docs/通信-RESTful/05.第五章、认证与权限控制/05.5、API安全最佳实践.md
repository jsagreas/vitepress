---
title: 5ã€APIå®‰å…¨æœ€ä½³å®è·µ
---
## ğŸ“š ç›®å½•

1. [APIå®‰å…¨åŸºç¡€æ¦‚å¿µ](#1-APIå®‰å…¨åŸºç¡€æ¦‚å¿µ)
2. [HTTPSä¼ è¾“å®‰å…¨](#2-HTTPSä¼ è¾“å®‰å…¨)
3. [è¾“å…¥éªŒè¯ä¸é˜²æŠ¤](#3-è¾“å…¥éªŒè¯ä¸é˜²æŠ¤)
4. [æ•æ„Ÿä¿¡æ¯ä¿æŠ¤](#4-æ•æ„Ÿä¿¡æ¯ä¿æŠ¤)
5. [é¢‘ç‡é™åˆ¶ä¸é˜²åˆ·](#5-é¢‘ç‡é™åˆ¶ä¸é˜²åˆ·)
6. [é”™è¯¯ä¿¡æ¯å®‰å…¨](#6-é”™è¯¯ä¿¡æ¯å®‰å…¨)
7. [æ—¥å¿—è®°å½•ä¸å®¡è®¡](#7-æ—¥å¿—è®°å½•ä¸å®¡è®¡)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ›¡ï¸ APIå®‰å…¨åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯APIå®‰å…¨


**é€šä¿—ç†è§£**ï¼šå°±åƒä¿æŠ¤ä½ å®¶çš„é—¨çª—ä¸€æ ·ï¼ŒAPIå®‰å…¨æ˜¯ä¿æŠ¤ç½‘ç»œæ¥å£ä¸è¢«åäººåˆ©ç”¨çš„ä¸€å¥—æ–¹æ³•ã€‚

```
ç”Ÿæ´»ç±»æ¯”ï¼š
ğŸ  ä½ çš„æˆ¿å­ = ä½ çš„æœåŠ¡å™¨
ğŸšª æˆ¿é—¨çª—æˆ· = APIæ¥å£
ğŸ”’ é—¨é”é˜²ç›— = å®‰å…¨é˜²æŠ¤æªæ–½
ğŸ‘® ä¿å®‰å·¡é€» = ç›‘æ§å’Œæ—¥å¿—
```

### 1.2 ä¸ºä»€ä¹ˆAPIéœ€è¦å®‰å…¨é˜²æŠ¤


**æ ¸å¿ƒåŸå› **ï¼š
- ğŸ”¸ **æ•°æ®æ³„éœ²é£é™©** - ç”¨æˆ·ä¿¡æ¯ã€å•†ä¸šæœºå¯†å¯èƒ½è¢«çªƒå–
- ğŸ”¸ **æ¶æ„æ”»å‡»å¨èƒ** - é»‘å®¢å¯èƒ½ç ´åç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- ğŸ”¸ **èµ„æºæ»¥ç”¨é—®é¢˜** - æ¥å£è¢«å¤§é‡è°ƒç”¨å½±å“æ€§èƒ½
- ğŸ”¸ **æ³•å¾‹åˆè§„è¦æ±‚** - æ•°æ®ä¿æŠ¤æ³•å¾‹çš„å¼ºåˆ¶è¦æ±‚

### 1.3 APIå®‰å…¨çš„æ ¸å¿ƒåŸåˆ™


```
å®‰å…¨ä¸‰è¦ç´ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœºå¯†æ€§     â”‚    â”‚  å®Œæ•´æ€§     â”‚    â”‚  å¯ç”¨æ€§     â”‚
â”‚ (ä¿å¯†ä¸æ³„éœ²) â”‚    â”‚ (æ•°æ®ä¸ç¯¡æ”¹) â”‚    â”‚ (æœåŠ¡å¯è®¿é—®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“                 â†“                 â†“
   HTTPSåŠ å¯†          è¾“å…¥éªŒè¯          é¢‘ç‡é™åˆ¶
   ä¿¡æ¯è„±æ•          æ•°å­—ç­¾å          è´Ÿè½½å‡è¡¡
```

---

## 2. ğŸ”’ HTTPSä¼ è¾“å®‰å…¨


### 2.1 ä»€ä¹ˆæ˜¯HTTPS


**é€šä¿—è§£é‡Š**ï¼šHTTPSå°±åƒç»™ä½ çš„æ•°æ®ç©¿ä¸Šäº†ä¸€ä»¶"éšèº«è¡£"ï¼Œè®©åäººçœ‹ä¸åˆ°ä½ ä¼ è¾“çš„å†…å®¹ã€‚

```
HTTP vs HTTPSå¯¹æ¯”ï¼š

HTTPä¼ è¾“ï¼ˆæ˜æ–‡ï¼‰ï¼š
å®¢æˆ·ç«¯ ----[ç”¨æˆ·å:admin,å¯†ç :123456]----> æœåŠ¡å™¨
          â†‘ è¿™äº›ä¿¡æ¯ä»»ä½•äººéƒ½èƒ½çœ‹åˆ°ï¼

HTTPSä¼ è¾“ï¼ˆåŠ å¯†ï¼‰ï¼š
å®¢æˆ·ç«¯ ----[#$%@!*&^%$#@!]----> æœåŠ¡å™¨
          â†‘ åŠ å¯†åçš„ä¹±ç ï¼Œå®‰å…¨ï¼
```

### 2.2 ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨HTTPS


**ğŸš¨ HTTPçš„å±é™©**ï¼š
```
çœŸå®åœºæ™¯ä¸¾ä¾‹ï¼š
ä½ åœ¨å’–å•¡å…ç”¨WiFiç™»å½•é“¶è¡ŒAPP
â†’ å¦‚æœç”¨HTTPï¼Œé»‘å®¢èƒ½çœ‹åˆ°ä½ çš„è´¦å·å¯†ç 
â†’ å¦‚æœç”¨HTTPSï¼Œé»‘å®¢åªèƒ½çœ‹åˆ°ä¸€å †ä¹±ç 
```

**âœ… HTTPSçš„å¥½å¤„**ï¼š
- **æ•°æ®åŠ å¯†**ï¼šä¼ è¾“å†…å®¹è¢«åŠ å¯†ä¿æŠ¤
- **èº«ä»½éªŒè¯**ï¼šç¡®è®¤æœåŠ¡å™¨æ˜¯çœŸå®çš„
- **æ•°æ®å®Œæ•´æ€§**ï¼šé˜²æ­¢ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹
- **æœç´¢å¼•æ“å‹å¥½**ï¼šGoogleç­‰æœç´¢å¼•æ“æ›´å–œæ¬¢HTTPSç½‘ç«™

### 2.3 HTTPSå®æ–½è¦ç‚¹


**è¯ä¹¦é…ç½®**ï¼š
```bash
# ç”³è¯·SSLè¯ä¹¦çš„å¸¸ç”¨æ–¹å¼
1. å…è´¹è¯ä¹¦ï¼šLet's Encrypt
2. ä»˜è´¹è¯ä¹¦ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰
3. ä¼ä¸šè¯ä¹¦ï¼šDigiCertã€GlobalSignç­‰
```

**å¼ºåˆ¶HTTPSè®¿é—®**ï¼š
```javascript
// Node.jsç¤ºä¾‹ï¼šé‡å®šå‘HTTPåˆ°HTTPS
app.use((req, res, next) => {
  if (req.headers['x-forwarded-proto'] !== 'https') {
    return res.redirect('https://' + req.headers.host + req.url);
  }
  next();
});
```

---

## 3. ğŸ›¡ï¸ è¾“å…¥éªŒè¯ä¸é˜²æŠ¤


### 3.1 ä»€ä¹ˆæ˜¯è¾“å…¥éªŒè¯


**é€šä¿—ç†è§£**ï¼šå°±åƒé—¨å«æ£€æŸ¥æ¥è®¿è€…ä¸€æ ·ï¼Œè¾“å…¥éªŒè¯æ˜¯æ£€æŸ¥ç”¨æˆ·å‘é€çš„æ•°æ®æ˜¯å¦"æ­£å¸¸"ã€‚

### 3.2 å¸¸è§çš„æ”»å‡»æ–¹å¼


**ğŸ’€ SQLæ³¨å…¥æ”»å‡»**ï¼š
```javascript
// å±é™©çš„ä»£ç ï¼ˆå®¹æ˜“è¢«æ”»å‡»ï¼‰
const sql = `SELECT * FROM users WHERE id = ${userId}`;

// å¦‚æœç”¨æˆ·è¾“å…¥ï¼š1; DROP TABLE users; --
// å°±ä¼šå˜æˆï¼šSELECT * FROM users WHERE id = 1; DROP TABLE users; --
// ç»“æœï¼šæ•´ä¸ªç”¨æˆ·è¡¨è¢«åˆ é™¤ï¼

// å®‰å…¨çš„ä»£ç ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
const sql = 'SELECT * FROM users WHERE id = ?';
db.query(sql, [userId]);
```

**ğŸ•³ï¸ XSSæ”»å‡»**ï¼š
```javascript
// å±é™©ï¼šç›´æ¥æ˜¾ç¤ºç”¨æˆ·è¾“å…¥
const userComment = "<script>alert('ä½ è¢«æ”»å‡»äº†!')</script>";
document.innerHTML = userComment; // ä¼šæ‰§è¡Œæ¶æ„è„šæœ¬

// å®‰å…¨ï¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
const safeComment = escapeHtml(userComment);
// ç»“æœï¼š&lt;script&gt;alert('ä½ è¢«æ”»å‡»äº†!')&lt;/script&gt;
```

### 3.3 è¾“å…¥éªŒè¯çš„å®ç°


**æ•°æ®ç±»å‹éªŒè¯**ï¼š
```javascript
// ç”¨æˆ·å¹´é¾„éªŒè¯
function validateAge(age) {
  // 1. æ£€æŸ¥æ˜¯å¦ä¸ºæ•°å­—
  if (typeof age !== 'number') {
    return { valid: false, message: 'å¹´é¾„å¿…é¡»æ˜¯æ•°å­—' };
  }
  
  // 2. æ£€æŸ¥èŒƒå›´
  if (age < 0 || age > 150) {
    return { valid: false, message: 'å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´' };
  }
  
  return { valid: true };
}
```

**å­—ç¬¦ä¸²é•¿åº¦å’Œæ ¼å¼éªŒè¯**ï¼š
```javascript
// é‚®ç®±æ ¼å¼éªŒè¯
function validateEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
  if (!email || email.length > 100) {
    return false;
  }
  
  return emailRegex.test(email);
}
```

### 3.4 é˜²æŠ¤æªæ–½æ€»ç»“


| éªŒè¯ç±»å‹ | **ç›®çš„** | **å®ç°æ–¹æ³•** |
|---------|---------|-------------|
| ğŸ”¢ **æ•°æ®ç±»å‹** | `ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®` | `typeofæ£€æŸ¥ã€æ­£åˆ™è¡¨è¾¾å¼` |
| ğŸ“ **é•¿åº¦é™åˆ¶** | `é˜²æ­¢è¿‡é•¿è¾“å…¥æ”»å‡»` | `å­—ç¬¦ä¸²lengthæ£€æŸ¥` |
| ğŸ¯ **æ ¼å¼éªŒè¯** | `ç¡®ä¿ç¬¦åˆé¢„æœŸæ ¼å¼` | `æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…` |
| ğŸš« **ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤** | `é˜²æ­¢è„šæœ¬æ³¨å…¥` | `HTMLè½¬ä¹‰ã€SQLå‚æ•°åŒ–` |

---

## 4. ğŸ” æ•æ„Ÿä¿¡æ¯ä¿æŠ¤


### 4.1 ä»€ä¹ˆæ˜¯æ•æ„Ÿä¿¡æ¯


**å¸¸è§æ•æ„Ÿä¿¡æ¯**ï¼š
```
ğŸ‘¤ ä¸ªäººä¿¡æ¯ï¼š
- èº«ä»½è¯å·ã€æŠ¤ç…§å·
- æ‰‹æœºå·ã€é‚®ç®±åœ°å€
- çœŸå®å§“åã€å®¶åº­ä½å€

ğŸ’° è´¢åŠ¡ä¿¡æ¯ï¼š
- é“¶è¡Œå¡å·ã€æ”¯ä»˜å¯†ç 
- äº¤æ˜“è®°å½•ã€è´¦æˆ·ä½™é¢

ğŸ”‘ ç³»ç»Ÿä¿¡æ¯ï¼š
- ç”¨æˆ·å¯†ç ã€APIå¯†é’¥
- æ•°æ®åº“è¿æ¥ä¿¡æ¯
- æœåŠ¡å™¨é…ç½®ä¿¡æ¯
```

### 4.2 å¯†ç å®‰å…¨å¤„ç†


**ğŸš« é”™è¯¯åšæ³•**ï¼š
```javascript
// å±é™©ï¼šæ˜æ–‡å­˜å‚¨å¯†ç 
const user = {
  username: 'admin',
  password: '123456'  // ä»»ä½•äººçœ‹åˆ°æ•°æ®åº“éƒ½çŸ¥é“å¯†ç 
};
```

**âœ… æ­£ç¡®åšæ³•**ï¼š
```javascript
const bcrypt = require('bcrypt');

// æ³¨å†Œæ—¶ï¼šåŠ å¯†å­˜å‚¨
async function registerUser(username, password) {
  const saltRounds = 10;
  const hashedPassword = await bcrypt.hash(password, saltRounds);
  
  const user = {
    username: username,
    password: hashedPassword  // å­˜å‚¨çš„æ˜¯åŠ å¯†åçš„å¯†ç 
  };
  
  // å³ä½¿æ•°æ®åº“æ³„éœ²ï¼Œä¹Ÿçœ‹ä¸å‡ºåŸå§‹å¯†ç 
  return user;
}

// ç™»å½•æ—¶ï¼šéªŒè¯å¯†ç 
async function loginUser(username, inputPassword) {
  const user = await findUserByUsername(username);
  const isValid = await bcrypt.compare(inputPassword, user.password);
  return isValid;
}
```

### 4.3 ä¿¡æ¯è„±æ•æ˜¾ç¤º


**ä»€ä¹ˆæ˜¯è„±æ•**ï¼šå°±åƒç»™æ•æ„Ÿä¿¡æ¯"æ‰“é©¬èµ›å…‹"ï¼Œè®©å®ƒä¸å®Œå…¨æ˜¾ç¤ºå‡ºæ¥ã€‚

```javascript
// æ‰‹æœºå·è„±æ•
function maskPhone(phone) {
  // 138****8888
  return phone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
}

// é‚®ç®±è„±æ•
function maskEmail(email) {
  // user***@example.com
  const [name, domain] = email.split('@');
  const maskedName = name.substring(0, 2) + '***';
  return maskedName + '@' + domain;
}

// é“¶è¡Œå¡å·è„±æ•
function maskCardNumber(cardNumber) {
  // **** **** **** 1234
  return '**** **** **** ' + cardNumber.slice(-4);
}
```

### 4.4 APIå“åº”è„±æ•


```javascript
// ç”¨æˆ·ä¿¡æ¯APIè¿”å›
app.get('/api/user/profile', (req, res) => {
  const user = getUserFromDatabase(req.userId);
  
  // è¿”å›å‰è¿›è¡Œè„±æ•å¤„ç†
  const safeUser = {
    id: user.id,
    username: user.username,
    phone: maskPhone(user.phone),           // è„±æ•æ‰‹æœºå·
    email: maskEmail(user.email),           // è„±æ•é‚®ç®±
    // password: user.password,             // ç»ä¸è¿”å›å¯†ç ï¼
    avatar: user.avatar,
    createTime: user.createTime
  };
  
  res.json(safeUser);
});
```

---

## 5. â±ï¸ é¢‘ç‡é™åˆ¶ä¸é˜²åˆ·


### 5.1 ä»€ä¹ˆæ˜¯é¢‘ç‡é™åˆ¶


**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡ŒATMæœºé™åˆ¶æ¯å¤©å–æ¬¾æ¬¡æ•°ä¸€æ ·ï¼Œé˜²æ­¢æœ‰äººæ— é™åˆ¶åœ°ä½¿ç”¨æœåŠ¡ã€‚

### 5.2 ä¸ºä»€ä¹ˆéœ€è¦é¢‘ç‡é™åˆ¶


**ğŸš¨ æ¶æ„æ”»å‡»åœºæ™¯**ï¼š
```
æš´åŠ›ç ´è§£æ”»å‡»ï¼š
é»‘å®¢å†™ç¨‹åºæ¯ç§’å°è¯•1000æ¬¡ç™»å½•
â†’ å¾ˆå¿«å°±èƒ½è¯•å‡ºå¯†ç 

çˆ¬è™«æ»¥ç”¨ï¼š
æ¶æ„çˆ¬è™«æ¯ç§’è¯·æ±‚10000æ¬¡
â†’ æœåŠ¡å™¨è¢«å‹å®ï¼Œæ­£å¸¸ç”¨æˆ·æ— æ³•ä½¿ç”¨

çŸ­ä¿¡è½°ç‚¸ï¼š
æ¶æ„ç”¨æˆ·æ— é™è¯·æ±‚å‘é€éªŒè¯ç 
â†’ çŸ­ä¿¡è´¹ç”¨æŸå¤±ï¼Œç”¨æˆ·ä½“éªŒå·®
```

### 5.3 é¢‘ç‡é™åˆ¶çš„å®ç°


**åŸºäºæ—¶é—´çª—å£çš„é™åˆ¶**ï¼š
```javascript
// ç®€å•çš„å†…å­˜ç‰ˆæœ¬ï¼ˆé€‚åˆå•æœºï¼‰
class RateLimiter {
  constructor(maxRequests, timeWindow) {
    this.maxRequests = maxRequests;  // æœ€å¤§è¯·æ±‚æ¬¡æ•°
    this.timeWindow = timeWindow;    // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰
    this.requests = new Map();       // å­˜å‚¨ç”¨æˆ·è¯·æ±‚è®°å½•
  }
  
  isAllowed(userId) {
    const now = Date.now();
    const userRequests = this.requests.get(userId) || [];
    
    // æ¸…ç†è¿‡æœŸçš„è¯·æ±‚è®°å½•
    const validRequests = userRequests.filter(
      time => now - time < this.timeWindow
    );
    
    // æ£€æŸ¥æ˜¯å¦è¶…è¿‡é™åˆ¶
    if (validRequests.length >= this.maxRequests) {
      return false;  // è¶…è¿‡é™åˆ¶
    }
    
    // è®°å½•æœ¬æ¬¡è¯·æ±‚
    validRequests.push(now);
    this.requests.set(userId, validRequests);
    
    return true;  // å…è®¸è¯·æ±‚
  }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼šæ¯åˆ†é’Ÿæœ€å¤š10æ¬¡è¯·æ±‚
const limiter = new RateLimiter(10, 60 * 1000);
```

**åœ¨APIä¸­ä½¿ç”¨**ï¼š
```javascript
app.post('/api/login', (req, res) => {
  const userId = req.ip;  // ä½¿ç”¨IPä½œä¸ºæ ‡è¯†
  
  // æ£€æŸ¥é¢‘ç‡é™åˆ¶
  if (!limiter.isAllowed(userId)) {
    return res.status(429).json({
      error: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
      retryAfter: 60  // å»ºè®®60ç§’åé‡è¯•
    });
  }
  
  // æ­£å¸¸å¤„ç†ç™»å½•é€»è¾‘
  // ...
});
```

### 5.4 ä¸åŒåœºæ™¯çš„é™åˆ¶ç­–ç•¥


| æ¥å£ç±»å‹ | **é™åˆ¶ç­–ç•¥** | **åŸå› ** |
|---------|-------------|---------|
| ğŸ” **ç™»å½•æ¥å£** | `æ¯åˆ†é’Ÿ5æ¬¡` | `é˜²æ­¢æš´åŠ›ç ´è§£` |
| ğŸ“± **å‘é€éªŒè¯ç ** | `æ¯åˆ†é’Ÿ1æ¬¡ï¼Œæ¯å¤©10æ¬¡` | `é˜²æ­¢çŸ­ä¿¡è½°ç‚¸` |
| ğŸ“Š **æ•°æ®æŸ¥è¯¢** | `æ¯ç§’10æ¬¡` | `ä¿æŠ¤æ•°æ®åº“æ€§èƒ½` |
| ğŸ“ **å†…å®¹å‘å¸ƒ** | `æ¯åˆ†é’Ÿ3æ¬¡` | `é˜²æ­¢åƒåœ¾å†…å®¹` |
| ğŸ’° **æ”¯ä»˜æ¥å£** | `æ¯åˆ†é’Ÿ2æ¬¡` | `é˜²æ­¢æ¶æ„äº¤æ˜“` |

---

## 6. ğŸ”‡ é”™è¯¯ä¿¡æ¯å®‰å…¨


### 6.1 ä»€ä¹ˆæ˜¯é”™è¯¯ä¿¡æ¯æ³„éœ²


**å±é™©ç¤ºä¾‹**ï¼š
```javascript
// ğŸš¨ å±é™©ï¼šæš´éœ²ç³»ç»Ÿå†…éƒ¨ä¿¡æ¯
app.post('/api/login', (req, res) => {
  try {
    const user = db.query('SELECT * FROM users WHERE username = ?', [username]);
    // ...
  } catch (error) {
    // ç›´æ¥è¿”å›æ•°æ®åº“é”™è¯¯ä¿¡æ¯
    res.status(500).json({
      error: error.message  // å¯èƒ½æš´éœ²ï¼šTable 'myapp.users' doesn't exist
    });
  }
});
```

**é»‘å®¢èƒ½ä»é”™è¯¯ä¿¡æ¯è·å¾—ä»€ä¹ˆ**ï¼š
- æ•°æ®åº“ç±»å‹å’Œç‰ˆæœ¬
- è¡¨åå’Œå­—æ®µå
- æ–‡ä»¶è·¯å¾„ç»“æ„
- æœåŠ¡å™¨é…ç½®ä¿¡æ¯

### 6.2 å®‰å…¨çš„é”™è¯¯å¤„ç†


**âœ… æ­£ç¡®åšæ³•**ï¼š
```javascript
// å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯ç 
const ERROR_CODES = {
  INVALID_CREDENTIALS: 'E001',
  USER_NOT_FOUND: 'E002', 
  SERVER_ERROR: 'E999'
};

// å®šä¹‰ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
const ERROR_MESSAGES = {
  E001: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
  E002: 'ç”¨æˆ·ä¸å­˜åœ¨',
  E999: 'æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åé‡è¯•'
};

app.post('/api/login', (req, res) => {
  try {
    const user = findUser(username, password);
    if (!user) {
      return res.status(401).json({
        code: ERROR_CODES.INVALID_CREDENTIALS,
        message: ERROR_MESSAGES.E001
      });
    }
    // ç™»å½•æˆåŠŸå¤„ç†...
  } catch (error) {
    // è®°å½•è¯¦ç»†é”™è¯¯åˆ°æ—¥å¿—ï¼ˆä¸è¿”å›ç»™ç”¨æˆ·ï¼‰
    logger.error('Login error:', error);
    
    // è¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯
    res.status(500).json({
      code: ERROR_CODES.SERVER_ERROR,
      message: ERROR_MESSAGES.E999
    });
  }
});
```

### 6.3 é”™è¯¯ä¿¡æ¯åˆ†çº§


```
é”™è¯¯ä¿¡æ¯åˆ†çº§å¤„ç†ï¼š

ğŸŸ¢ ç”¨æˆ·çº§åˆ«ï¼ˆå¯ä»¥æ˜¾ç¤ºï¼‰ï¼š
- "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"
- "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
- "éªŒè¯ç å·²è¿‡æœŸ"

ğŸŸ¡ è¿ç»´çº§åˆ«ï¼ˆè®°å½•åˆ°æ—¥å¿—ï¼‰ï¼š
- "æ•°æ®åº“è¿æ¥è¶…æ—¶"
- "ç¬¬ä¸‰æ–¹APIè°ƒç”¨å¤±è´¥"
- "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"

ğŸ”´ å¼€å‘çº§åˆ«ï¼ˆè¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼‰ï¼š
- "SQLè¯­æ³•é”™è¯¯: Table 'users' doesn't exist"
- "NullPointerException at line 234"
- "Stack trace: ..."
```

---

## 7. ğŸ“ æ—¥å¿—è®°å½•ä¸å®¡è®¡


### 7.1 ä»€ä¹ˆæ˜¯æ—¥å¿—å®¡è®¡


**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡Œçš„ç›‘æ§å½•åƒä¸€æ ·ï¼Œè®°å½•ä¸‹æ‰€æœ‰é‡è¦çš„æ“ä½œï¼Œå‡ºé—®é¢˜æ—¶å¯ä»¥è¿½æŸ¥ã€‚

### 7.2 éœ€è¦è®°å½•ä»€ä¹ˆ


**ğŸ”¸ å®‰å…¨ç›¸å…³æ“ä½œ**ï¼š
```javascript
// ç™»å½•å°è¯•è®°å½•
function logLoginAttempt(username, ip, success) {
  logger.info('Login attempt', {
    username: username,
    ip: ip,
    success: success,
    timestamp: new Date().toISOString(),
    userAgent: req.headers['user-agent']
  });
}

// æ•æ„Ÿæ“ä½œè®°å½•
function logSensitiveOperation(userId, operation, details) {
  logger.warn('Sensitive operation', {
    userId: userId,
    operation: operation,  // å¦‚ï¼š'password_change', 'delete_account'
    details: details,
    ip: getClientIP(),
    timestamp: new Date().toISOString()
  });
}
```

**ğŸ”¸ å¼‚å¸¸æƒ…å†µè®°å½•**ï¼š
```javascript
// APIè°ƒç”¨é¢‘ç‡å¼‚å¸¸
function logRateLimitViolation(ip, endpoint) {
  logger.warn('Rate limit exceeded', {
    ip: ip,
    endpoint: endpoint,
    timestamp: new Date().toISOString()
  });
}

// å¯ç–‘è¯·æ±‚è®°å½•
function logSuspiciousRequest(request) {
  logger.error('Suspicious request detected', {
    ip: request.ip,
    url: request.url,
    method: request.method,
    headers: request.headers,
    body: request.body,  // æ³¨æ„ï¼šä¸è¦è®°å½•æ•æ„Ÿä¿¡æ¯
    timestamp: new Date().toISOString()
  });
}
```

### 7.3 æ—¥å¿—è®°å½•æœ€ä½³å®è·µ


**ğŸ“Š æ—¥å¿—çº§åˆ«åˆ’åˆ†**ï¼š
```javascript
const winston = require('winston');

const logger = winston.createLogger({
  levels: {
    error: 0,    // ğŸ”´ é”™è¯¯ï¼šç³»ç»Ÿé”™è¯¯ã€å®‰å…¨äº‹ä»¶
    warn: 1,     // ğŸŸ¡ è­¦å‘Šï¼šå¼‚å¸¸æ“ä½œã€æ€§èƒ½é—®é¢˜
    info: 2,     // ğŸ”µ ä¿¡æ¯ï¼šæ­£å¸¸ä¸šåŠ¡æ“ä½œ
    debug: 3     // ğŸŸ¢ è°ƒè¯•ï¼šè¯¦ç»†æ‰§è¡Œä¿¡æ¯
  }
});

// ä½¿ç”¨ç¤ºä¾‹
logger.error('Failed login attempt', { username, ip });
logger.warn('Password reset requested', { userId });
logger.info('User logged in successfully', { userId });
logger.debug('API response time', { endpoint, responseTime });
```

**ğŸš« ä¸è¦è®°å½•çš„æ•æ„Ÿä¿¡æ¯**ï¼š
```javascript
// âŒ ç»å¯¹ä¸èƒ½è®°å½•
logger.info('User login', {
  username: 'admin',
  password: 'secret123',  // ç»ä¸è®°å½•å¯†ç ï¼
  creditCard: '1234567890'  // ç»ä¸è®°å½•æ•æ„Ÿè´¢åŠ¡ä¿¡æ¯ï¼
});

// âœ… å®‰å…¨çš„è®°å½•æ–¹å¼
logger.info('User login', {
  userId: 'user_123',
  username: 'admin',
  loginTime: new Date(),
  ip: req.ip,
  success: true
});
```

### 7.4 æ—¥å¿—ç›‘æ§å’Œå‘Šè­¦


**å®æ—¶ç›‘æ§åœºæ™¯**ï¼š
```javascript
// æ£€æµ‹å¼‚å¸¸ç™»å½•
function detectAbnormalLogin() {
  // 1åˆ†é’Ÿå†…åŒä¸€IPå¤±è´¥ç™»å½•è¶…è¿‡5æ¬¡
  // åŒä¸€è´¦æˆ·åœ¨ä¸åŒåœ°ç†ä½ç½®å¿«é€Ÿç™»å½•
  // æ·±å¤œæ—¶é—´æ®µçš„å¤§é‡ç™»å½•å°è¯•
}

// æ£€æµ‹APIæ»¥ç”¨
function detectAPIAbuse() {
  // å•ä¸ªIPè¯·æ±‚é‡çªç„¶å¢å¤§
  // å¤§é‡404é”™è¯¯ï¼ˆå¯èƒ½åœ¨æ¢æµ‹æ¥å£ï¼‰
  // éæ­£å¸¸çš„User-Agent
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„å®‰å…¨åŸåˆ™


```
ğŸ”¸ ä¼ è¾“å®‰å…¨ï¼šæ‰€æœ‰APIéƒ½å¿…é¡»ä½¿ç”¨HTTPS
ğŸ”¸ è¾“å…¥éªŒè¯ï¼šæ°¸è¿œä¸è¦ä¿¡ä»»ç”¨æˆ·è¾“å…¥çš„æ•°æ®
ğŸ”¸ ä¿¡æ¯ä¿æŠ¤ï¼šæ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨ã€è„±æ•æ˜¾ç¤º
ğŸ”¸ è®¿é—®æ§åˆ¶ï¼šå®æ–½åˆç†çš„é¢‘ç‡é™åˆ¶å’Œæƒé™æ§åˆ¶
ğŸ”¸ é”™è¯¯å¤„ç†ï¼šä¸æš´éœ²ç³»ç»Ÿå†…éƒ¨ä¿¡æ¯ç»™ç”¨æˆ·
ğŸ”¸ æ—¥å¿—å®¡è®¡ï¼šè®°å½•å…³é”®æ“ä½œç”¨äºå®‰å…¨è¿½è¸ª
```

### 8.2 å®‰å…¨é˜²æŠ¤æ£€æŸ¥æ¸…å•


**âœ… éƒ¨ç½²å‰æ£€æŸ¥**ï¼š
- [ ] æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨HTTPS
- [ ] å®ç°äº†è¾“å…¥å‚æ•°éªŒè¯
- [ ] æ•æ„Ÿä¿¡æ¯å·²ç»åŠ å¯†å­˜å‚¨
- [ ] è®¾ç½®äº†åˆç†çš„é¢‘ç‡é™åˆ¶
- [ ] é”™è¯¯ä¿¡æ¯ä¸æš´éœ²å†…éƒ¨ç»†èŠ‚
- [ ] å…³é”®æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

**âœ… æ—¥å¸¸ç›‘æ§**ï¼š
- [ ] ç›‘æ§å¼‚å¸¸ç™»å½•å°è¯•
- [ ] æ£€æŸ¥APIè°ƒç”¨é¢‘ç‡å¼‚å¸¸
- [ ] å®¡æŸ¥é”™è¯¯æ—¥å¿—
- [ ] å®šæœŸæ£€æŸ¥è®¿é—®æƒé™
- [ ] æ›´æ–°å®‰å…¨è¡¥ä¸

### 8.3 å®‰å…¨é˜²æŠ¤å±‚æ¬¡


```
APIå®‰å…¨é˜²æŠ¤ä½“ç³»ï¼š

ç¬¬ä¸€å±‚ï¼šç½‘ç»œå±‚å®‰å…¨
â”œâ”€â”€ HTTPSä¼ è¾“åŠ å¯†
â”œâ”€â”€ DDoSæ”»å‡»é˜²æŠ¤
â””â”€â”€ ç½‘ç»œè®¿é—®æ§åˆ¶

ç¬¬äºŒå±‚ï¼šåº”ç”¨å±‚å®‰å…¨  
â”œâ”€â”€ èº«ä»½è®¤è¯éªŒè¯
â”œâ”€â”€ æƒé™æ§åˆ¶æ£€æŸ¥
â”œâ”€â”€ è¾“å…¥æ•°æ®éªŒè¯
â””â”€â”€ é¢‘ç‡é™åˆ¶æ§åˆ¶

ç¬¬ä¸‰å±‚ï¼šæ•°æ®å±‚å®‰å…¨
â”œâ”€â”€ æ•æ„Ÿä¿¡æ¯åŠ å¯†
â”œâ”€â”€ æ•°æ®è„±æ•æ˜¾ç¤º
â”œâ”€â”€ æ•°æ®å¤‡ä»½æ¢å¤
â””â”€â”€ æ•°æ®è®¿é—®å®¡è®¡

ç¬¬å››å±‚ï¼šç›‘æ§å“åº”
â”œâ”€â”€ å®æ—¶å®‰å…¨ç›‘æ§
â”œâ”€â”€ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
â”œâ”€â”€ å®‰å…¨äº‹ä»¶å“åº”
â””â”€â”€ æ—¥å¿—åˆ†æå®¡è®¡
```

### 8.4 å¸¸è§å®‰å…¨è¯¯åŒº


**ğŸš« é”™è¯¯è®¤çŸ¥**ï¼š
- "æˆ‘ä»¬æ˜¯å†…éƒ¨ç³»ç»Ÿï¼Œä¸éœ€è¦å¤ªå¤šå®‰å…¨æªæ–½"
- "HTTPSå¤ªå¤æ‚ï¼ŒHTTPå¤Ÿç”¨äº†"
- "ç”¨æˆ·è¾“å…¥çš„æ•°æ®åº”è¯¥æ˜¯å¯ä¿¡çš„"
- "è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯æœ‰åŠ©äºç”¨æˆ·ç†è§£é—®é¢˜"

**âœ… æ­£ç¡®ç†å¿µ**ï¼š
- å†…éƒ¨ç³»ç»ŸåŒæ ·éœ€è¦å®‰å…¨é˜²æŠ¤
- HTTPSæ˜¯ç°ä»£APIçš„åŸºæœ¬è¦æ±‚
- æ°¸è¿œä¸è¦ä¿¡ä»»ä»»ä½•å¤–éƒ¨è¾“å…¥
- å®‰å…¨å’Œç”¨æˆ·ä½“éªŒéœ€è¦å¹³è¡¡è€ƒè™‘

**æ ¸å¿ƒè®°å¿†**ï¼š
- APIå®‰å…¨å¦‚å®ˆåŸé—¨ï¼Œå±‚å±‚æŠŠå…³ä¸æ”¾æ¾
- HTTPSåŠ å¯†æ˜¯åŸºç¡€ï¼Œè¾“å…¥éªŒè¯è¦ä¸¥æ ¼
- æ•æ„Ÿä¿¡æ¯è¦ä¿æŠ¤ï¼Œé”™è¯¯ä¿¡æ¯ä¸å¤–æ³„
- é¢‘ç‡é™åˆ¶é˜²æ¶æ„ï¼Œæ—¥å¿—è®°å½•åŠ©è¿½è¸ª