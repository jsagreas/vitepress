---
title: 8、CRUD操作核心模式
---
## 📚 目录

1. [CRUD操作核心概念](#1-crud操作核心概念)
2. [Create创建操作详解](#2-create创建操作详解)
3. [Read读取操作详解](#3-read读取操作详解)
4. [Update更新操作详解](#4-update更新操作详解)
5. [Delete删除操作详解](#5-delete删除操作详解)
6. [状态码最佳实践](#6-状态码最佳实践)
7. [完整实战示例](#7-完整实战示例)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🎯 CRUD操作核心概念


### 1.1 什么是CRUD

**CRUD**就是我们日常操作数据的四个基本动作，就像你操作手机通讯录一样：

```
📱 手机通讯录操作对比：
C - Create  (创建)  → 添加新联系人
R - Read    (读取)  → 查看联系人信息  
U - Update  (更新)  → 修改联系人资料
D - Delete  (删除)  → 删除联系人
```

> 💡 **通俗理解**：CRUD就是对数据的"增删改查"，这是所有应用程序都离不开的基本操作

### 1.2 RESTful中的CRUD映射

在RESTful API中，我们用HTTP方法来表达这些操作：

```
操作类型     HTTP方法    URL格式                    返回状态码
创建资源  →  POST     →  /api/users              →  201 Created
读取列表  →  GET      →  /api/users              →  200 OK  
读取单个  →  GET      →  /api/users/123          →  200 OK
更新资源  →  PUT      →  /api/users/123          →  200 OK
部分更新  →  PATCH    →  /api/users/123          →  200 OK
删除资源  →  DELETE   →  /api/users/123          →  204 No Content
```

---

## 2. ✨ Create创建操作详解


### 2.1 创建操作的基本模式

**Create操作**就是往系统里添加新数据，比如注册新用户、发布新文章。

```
基本格式：POST /api/资源名称
成功状态码：201 Created
失败状态码：400 Bad Request (数据有问题)
```

### 2.2 实际操作示例


**📝 创建新用户**
```http
POST /api/users
Content-Type: application/json

{
  "name": "张三",
  "email": "zhangsan@example.com",
  "age": 25
}
```

**✅ 成功响应**
```http
HTTP/1.1 201 Created
Location: /api/users/123
Content-Type: application/json

{
  "id": 123,
  "name": "张三", 
  "email": "zhangsan@example.com",
  "age": 25,
  "created_at": "2025-01-08T10:30:00Z"
}
```

> 💡 **关键点**：
> - 用`POST`方法，因为我们要创建新东西
> - 返回`201 Created`表示创建成功
> - `Location`头告诉客户端新资源的位置
> - 响应中包含新创建的完整数据（包括系统生成的ID）

### 2.3 常见错误处理

```http
❌ 数据格式错误
HTTP/1.1 400 Bad Request
{
  "error": "邮箱格式不正确",
  "code": "INVALID_EMAIL"
}

❌ 数据重复
HTTP/1.1 409 Conflict  
{
  "error": "该邮箱已被注册",
  "code": "EMAIL_ALREADY_EXISTS"
}
```

---

## 3. 👀 Read读取操作详解


### 3.1 读取操作的两种情况

**Read操作**就是查看数据，分为两种情况：
- **读取列表**：查看所有用户（像翻通讯录）
- **读取单个**：查看特定用户（查看某个联系人详情）

### 3.2 读取列表示例


**📋 获取用户列表**
```http
GET /api/users
```

**✅ 成功响应**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "data": [
    {
      "id": 123,
      "name": "张三",
      "email": "zhangsan@example.com"
    },
    {
      "id": 124, 
      "name": "李四",
      "email": "lisi@example.com"
    }
  ],
  "total": 2,
  "page": 1
}
```

### 3.3 读取单个资源示例


**👤 获取特定用户**
```http
GET /api/users/123
```

**✅ 成功响应**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 123,
  "name": "张三",
  "email": "zhangsan@example.com", 
  "age": 25,
  "created_at": "2025-01-08T10:30:00Z",
  "updated_at": "2025-01-08T10:30:00Z"
}
```

**❌ 资源不存在**
```http
GET /api/users/999

HTTP/1.1 404 Not Found
{
  "error": "用户不存在",
  "code": "USER_NOT_FOUND"
}
```

> 💡 **关键点**：
> - 用`GET`方法，因为我们只是查看，不修改
> - 成功返回`200 OK`
> - 找不到资源返回`404 Not Found`
> - 列表可以包含分页信息

---

## 4. 🔄 Update更新操作详解


### 4.1 两种更新方式

更新数据有两种方式，就像修改联系人信息：

```
PUT (全量更新)：
就像重新填写整个联系人信息表，所有字段都要提供

PATCH (部分更新)：  
就像只修改电话号码，其他信息保持不变
```

### 4.2 PUT全量更新示例


**🔄 全量更新用户**
```http
PUT /api/users/123
Content-Type: application/json

{
  "name": "张三丰",
  "email": "zhangsanfeng@example.com",
  "age": 26
}
```

**✅ 成功响应**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 123,
  "name": "张三丰",
  "email": "zhangsanfeng@example.com",
  "age": 26,
  "updated_at": "2025-01-08T11:00:00Z"
}
```

> ⚠️ **注意**：PUT要求提供完整的资源数据，如果某个字段没提供，可能会被清空

### 4.3 PATCH部分更新示例


**✏️ 部分更新用户**
```http
PATCH /api/users/123
Content-Type: application/json

{
  "age": 26
}
```

**✅ 成功响应**
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 123,
  "name": "张三",          ← 保持不变
  "email": "zhangsan@example.com",  ← 保持不变  
  "age": 26,             ← 已更新
  "updated_at": "2025-01-08T11:00:00Z"
}
```

> 💡 **推荐做法**：大多数情况下使用PATCH，因为更灵活，用户只需要提供要修改的字段

### 4.4 更新操作的错误处理

```http
❌ 资源不存在
HTTP/1.1 404 Not Found
{
  "error": "用户不存在",
  "code": "USER_NOT_FOUND"
}

❌ 数据验证失败
HTTP/1.1 400 Bad Request
{
  "error": "年龄必须是正整数",
  "code": "INVALID_AGE"
}
```

---

## 5. 🗑️ Delete删除操作详解


### 5.1 删除操作基本模式

**Delete操作**就是从系统中移除数据，像从通讯录删除联系人。

```
基本格式：DELETE /api/资源名称/ID
成功状态码：204 No Content (删除成功，无内容返回)
失败状态码：404 Not Found (资源不存在)
```

### 5.2 删除操作示例


**🗑️ 删除用户**
```http
DELETE /api/users/123
```

**✅ 成功响应**
```http
HTTP/1.1 204 No Content
```

> 💡 **关键点**：
> - 删除成功返回`204 No Content`
> - 响应体为空，因为资源已经不存在了
> - 如果多次删除同一个资源，通常也返回204（幂等性）

### 5.3 删除操作的错误处理

```http
❌ 资源不存在
DELETE /api/users/999

HTTP/1.1 404 Not Found
{
  "error": "用户不存在",
  "code": "USER_NOT_FOUND"
}

❌ 删除权限不足
HTTP/1.1 403 Forbidden
{
  "error": "没有权限删除此用户",
  "code": "PERMISSION_DENIED"
}
```

---

## 6. 📊 状态码最佳实践


### 6.1 CRUD操作状态码速查表


| 操作类型 | HTTP方法 | 成功状态码 | **含义说明** |
|---------|----------|-----------|-------------|
| **创建** | `POST` | `201 Created` | `新资源创建成功` |
| **读取** | `GET` | `200 OK` | `请求成功，返回数据` |
| **更新** | `PUT/PATCH` | `200 OK` | `更新成功，返回新数据` |
| **删除** | `DELETE` | `204 No Content` | `删除成功，无内容返回` |

### 6.2 常见错误状态码


```
🔴 客户端错误 (4xx)
400 Bad Request     → 请求数据格式错误
401 Unauthorized    → 未登录或登录过期
403 Forbidden       → 没有权限执行此操作
404 Not Found       → 请求的资源不存在
409 Conflict        → 资源冲突（如邮箱重复）

🔴 服务器错误 (5xx)  
500 Internal Server Error → 服务器内部错误
503 Service Unavailable   → 服务暂时不可用
```

> 💡 **记忆技巧**：
> - 2xx = 成功 😊
> - 4xx = 客户端问题 😅
> - 5xx = 服务器问题 😱

---

## 7. 🚀 完整实战示例


### 7.1 用户管理系统API设计


```
🏗️ API设计概览：

创建用户：POST   /api/users
用户列表：GET    /api/users  
用户详情：GET    /api/users/{id}
更新用户：PATCH  /api/users/{id}
删除用户：DELETE /api/users/{id}
```

### 7.2 完整操作流程演示


**① 创建新用户**
```http
POST /api/users
{
  "name": "王五",
  "email": "wangwu@example.com", 
  "age": 28
}

→ 201 Created
{
  "id": 125,
  "name": "王五",
  "email": "wangwu@example.com",
  "age": 28
}
```

**② 查看用户详情**
```http
GET /api/users/125

→ 200 OK
{
  "id": 125,
  "name": "王五",
  "email": "wangwu@example.com",
  "age": 28
}
```

**③ 更新用户年龄**
```http
PATCH /api/users/125
{
  "age": 29
}

→ 200 OK
{
  "id": 125,
  "name": "王五",
  "email": "wangwu@example.com",
  "age": 29    ← 已更新
}
```

**④ 删除用户**
```http
DELETE /api/users/125

→ 204 No Content
(无响应体)
```

**⑤ 再次查看（验证删除）**
```http
GET /api/users/125

→ 404 Not Found
{
  "error": "用户不存在"
}
```

---

## 8. 📋 核心要点总结


### 8.1 必须记住的核心模式


```
🔸 Create → POST + 201 Created
🔸 Read   → GET + 200 OK  
🔸 Update → PUT/PATCH + 200 OK
🔸 Delete → DELETE + 204 No Content
🔸 Not Found → 任何操作 + 404 Not Found
```

### 8.2 关键理解要点


**🔹 方法选择原则**
```
创建新东西     → POST（因为要新增）
只是查看      → GET（因为不修改）  
完整替换      → PUT（全量更新）
部分修改      → PATCH（推荐使用）
删除移除      → DELETE（字面意思）
```

**🔹 状态码选择原则**
```
操作成功了吗？
- 是 → 用2xx状态码
- 否 → 是客户端问题用4xx，服务器问题用5xx

具体成功类型：
- 创建成功 → 201 Created
- 普通成功 → 200 OK  
- 删除成功 → 204 No Content
```

### 8.3 实际应用建议


**✅ 最佳实践**
- 优先使用PATCH而非PUT（更灵活）
- 删除操作要考虑软删除（标记为删除而非真删除）
- 所有错误都要返回清晰的错误信息
- 创建操作要返回完整的资源数据（包含ID）

**⚠️ 常见陷阱**
- 不要用GET做删除或修改操作
- 不要忘记在创建操作中返回Location头
- 不要在DELETE成功时返回资源数据
- 不要混淆PUT和PATCH的使用场景

**核心记忆**：
- CRUD就是增删改查，对应POST、GET、PUT/PATCH、DELETE
- 状态码要准确：201创建、200成功、204删除、404没找到
- URL设计要清晰：/api/资源名/ID的格式
- 错误处理要友好：返回清楚的错误信息