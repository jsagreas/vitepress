---
title: 3ã€æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ)
2. [å•æ–‡ä»¶ä¸Šä¼ å®ç°](#2-å•æ–‡ä»¶ä¸Šä¼ å®ç°)
3. [å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†](#3-å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†)
4. [ä¸Šä¼ è¿›åº¦ç›‘æ§](#4-ä¸Šä¼ è¿›åº¦ç›‘æ§)
5. [æ–‡ä»¶éªŒè¯ä¸é™åˆ¶](#5-æ–‡ä»¶éªŒè¯ä¸é™åˆ¶)
6. [æ–‡ä»¶ä¸‹è½½åŠŸèƒ½](#6-æ–‡ä»¶ä¸‹è½½åŠŸèƒ½)
7. [å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ](#7-å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ )
8. [å®é™…åº”ç”¨åœºæ™¯](#8-å®é™…åº”ç”¨åœºæ™¯)
9. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#9-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ 

**ç®€å•ç†è§£**ï¼šå°±æ˜¯æŠŠä½ ç”µè„‘é‡Œçš„æ–‡ä»¶ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ã€è§†é¢‘ç­‰ï¼‰å‘é€åˆ°æœåŠ¡å™¨ä¸Šå­˜å‚¨ã€‚

```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
é€‰æ‹©æ–‡ä»¶ â†’ ç‚¹å‡»ä¸Šä¼  â†’ æ–‡ä»¶ä¼ è¾“ â†’ æœåŠ¡å™¨ä¿å­˜

æŠ€æœ¯å®ç°ï¼š
HTMLé€‰æ‹©æ–‡ä»¶ â†’ JavaScriptå¤„ç† â†’ Axioså‘é€ â†’ åç«¯æ¥æ”¶
```

### 1.2 FormDataæ˜¯ä»€ä¹ˆ

**é€šä¿—è§£é‡Š**ï¼šFormDataå°±åƒä¸€ä¸ª"æ–‡ä»¶åŒ…è£¹"ï¼Œå¯ä»¥æŠŠæ–‡ä»¶å’Œå…¶ä»–æ•°æ®æ‰“åŒ…åœ¨ä¸€èµ·å‘é€ã€‚

```javascript
// åˆ›å»ºä¸€ä¸ª"åŒ…è£¹"
const formData = new FormData();

// å¾€åŒ…è£¹é‡Œæ”¾æ–‡ä»¶
formData.append('file', selectedFile);
// å¾€åŒ…è£¹é‡Œæ”¾å…¶ä»–ä¿¡æ¯
formData.append('description', 'è¿™æ˜¯ä¸€å¼ ç…§ç‰‡');
```

**ä¸ºä»€ä¹ˆéœ€è¦FormData**ï¼š
- ğŸ”¸ **æ–‡ä»¶ä¼ è¾“ä¸“ç”¨**ï¼šæ™®é€šJSONæ— æ³•ä¼ è¾“æ–‡ä»¶
- ğŸ”¸ **è‡ªåŠ¨è®¾ç½®æ ¼å¼**ï¼šæµè§ˆå™¨è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„`Content-Type`
- ğŸ”¸ **æ··åˆæ•°æ®**ï¼šå¯ä»¥åŒæ—¶ä¼ æ–‡ä»¶å’Œæ–‡æœ¬æ•°æ®

### 1.3 Content-Typeè¯¦è§£

**Content-Typeä½œç”¨**ï¼šå‘Šè¯‰æœåŠ¡å™¨"æˆ‘å‘é€çš„æ˜¯ä»€ä¹ˆæ ¼å¼çš„æ•°æ®"

```
å¸¸è§ç±»å‹å¯¹æ¯”ï¼š

æ™®é€šæ–‡æœ¬æ•°æ®ï¼š
Content-Type: application/json
æ•°æ®æ ¼å¼ï¼š{"name": "å¼ ä¸‰"}

æ–‡ä»¶ä¸Šä¼ æ•°æ®ï¼š
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary...
æ•°æ®æ ¼å¼ï¼šäºŒè¿›åˆ¶æ–‡ä»¶æµ
```

**é‡è¦æé†’**ï¼šä½¿ç”¨FormDataæ—¶ï¼Œ**ä¸è¦æ‰‹åŠ¨è®¾ç½®**Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨å¤„ç†ï¼

---

## 2. ğŸ“¤ å•æ–‡ä»¶ä¸Šä¼ å®ç°


### 2.1 åŸºç¡€ä¸Šä¼ æµç¨‹


```
ä¸Šä¼ æ­¥éª¤å›¾è§£ï¼š

[é€‰æ‹©æ–‡ä»¶] â†’ [åˆ›å»ºFormData] â†’ [å‘é€è¯·æ±‚] â†’ [å¤„ç†å“åº”]
     â†“              â†“              â†“              â†“
  æ–‡ä»¶é€‰æ‹©å™¨      åŒ…è£…æ–‡ä»¶æ•°æ®      Axioså‘é€      æˆåŠŸ/å¤±è´¥å¤„ç†
```

### 2.2 å®Œæ•´ä»£ç å®ç°


```javascript
// å•æ–‡ä»¶ä¸Šä¼ å‡½æ•°
async function uploadSingleFile(file) {
  // 1. åˆ›å»ºFormDataï¼ˆæ–‡ä»¶åŒ…è£¹ï¼‰
  const formData = new FormData();
  formData.append('file', file);  // 'file'æ˜¯åç«¯æ¥æ”¶çš„å­—æ®µå
  
  try {
    // 2. å‘é€ä¸Šä¼ è¯·æ±‚
    const response = await axios.post('/api/upload', formData, {
      headers: {
        // æ³¨æ„ï¼šä¸è¦è®¾ç½®Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨å¤„ç†
      }
    });
    
    console.log('ä¸Šä¼ æˆåŠŸ:', response.data);
    return response.data;
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥:', error);
    throw error;
  }
}

// HTMLæ–‡ä»¶é€‰æ‹©
// <input type="file" id="fileInput" />

// ä½¿ç”¨ç¤ºä¾‹
document.getElementById('fileInput').addEventListener('change', async (e) => {
  const file = e.target.files[0];  // è·å–é€‰ä¸­çš„æ–‡ä»¶
  
  if (file) {
    try {
      const result = await uploadSingleFile(file);
      alert('ä¸Šä¼ æˆåŠŸï¼æ–‡ä»¶åœ°å€ï¼š' + result.url);
    } catch (error) {
      alert('ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
    }
  }
});
```

### 2.3 å¤´åƒä¸Šä¼ å®é™…æ¡ˆä¾‹


```javascript
// å¤´åƒä¸Šä¼ ä¸“ç”¨å‡½æ•°
async function uploadAvatar(file) {
  // æ–‡ä»¶ç±»å‹æ£€æŸ¥
  if (!file.type.startsWith('image/')) {
    throw new Error('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶');
  }
  
  // æ–‡ä»¶å¤§å°æ£€æŸ¥ï¼ˆé™åˆ¶2MBï¼‰
  if (file.size > 2 * 1024 * 1024) {
    throw new Error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB');
  }
  
  const formData = new FormData();
  formData.append('avatar', file);
  formData.append('userId', '12345');  // ç”¨æˆ·ID
  
  const response = await axios.post('/api/user/avatar', formData);
  return response.data.avatarUrl;
}
```

---

## 3. ğŸ“¦ å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†


### 3.1 å¤šæ–‡ä»¶ä¸Šä¼ åŸç†

**æ ¸å¿ƒæ€è·¯**ï¼šæŠŠå¤šä¸ªæ–‡ä»¶éƒ½æ”¾åˆ°åŒä¸€ä¸ªFormDataé‡Œï¼Œä¸€æ¬¡æ€§å‘é€ã€‚

```
å¤šæ–‡ä»¶æ‰“åŒ…è¿‡ç¨‹ï¼š

æ–‡ä»¶1(photo1.jpg) â”
æ–‡ä»¶2(photo2.jpg) â”œâ”€â”€ æ‰“åŒ…è¿›FormData â”€â”€â†’ ä¸€æ¬¡ä¸Šä¼ è¯·æ±‚
æ–‡ä»¶3(photo3.jpg) â”˜
```

### 3.2 å¤šæ–‡ä»¶ä¸Šä¼ å®ç°


```javascript
// å¤šæ–‡ä»¶ä¸Šä¼ å‡½æ•°
async function uploadMultipleFiles(files) {
  const formData = new FormData();
  
  // æ–¹å¼1ï¼šä½¿ç”¨åŒä¸€ä¸ªå­—æ®µåï¼ˆæ¨èï¼‰
  for (let i = 0; i < files.length; i++) {
    formData.append('files', files[i]);  // æ³¨æ„ï¼šéƒ½ç”¨'files'
  }
  
  // æ–¹å¼2ï¼šä½¿ç”¨ä¸åŒå­—æ®µå
  // for (let i = 0; i < files.length; i++) {
  //   formData.append(`file${i}`, files[i]);
  // }
  
  try {
    const response = await axios.post('/api/upload/multiple', formData);
    return response.data;
  } catch (error) {
    console.error('æ‰¹é‡ä¸Šä¼ å¤±è´¥:', error);
    throw error;
  }
}

// HTMLå¤šæ–‡ä»¶é€‰æ‹©
// <input type="file" id="multiFileInput" multiple />

// ä½¿ç”¨ç¤ºä¾‹
document.getElementById('multiFileInput').addEventListener('change', async (e) => {
  const files = Array.from(e.target.files);  // è½¬æ¢ä¸ºæ•°ç»„
  
  if (files.length > 0) {
    try {
      const result = await uploadMultipleFiles(files);
      console.log('æ‰¹é‡ä¸Šä¼ æˆåŠŸ:', result);
    } catch (error) {
      alert('æ‰¹é‡ä¸Šä¼ å¤±è´¥');
    }
  }
});
```

### 3.3 æ‹–æ‹½ä¸Šä¼ é›†æˆ


```javascript
// æ‹–æ‹½ä¸Šä¼ åŒºåŸŸ
function setupDragUpload(dropZoneId) {
  const dropZone = document.getElementById(dropZoneId);
  
  // é˜²æ­¢é»˜è®¤è¡Œä¸º
  ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, (e) => {
      e.preventDefault();
      e.stopPropagation();
    });
  });
  
  // æ‹–æ‹½è¿›å…¥æ—¶çš„è§†è§‰åé¦ˆ
  ['dragenter', 'dragover'].forEach(eventName => {
    dropZone.addEventListener(eventName, () => {
      dropZone.classList.add('drag-active');
    });
  });
  
  ['dragleave', 'drop'].forEach(eventName => {
    dropZone.addEventListener(eventName, () => {
      dropZone.classList.remove('drag-active');
    });
  });
  
  // å¤„ç†æ–‡ä»¶æ‹–æ”¾
  dropZone.addEventListener('drop', async (e) => {
    const files = Array.from(e.dataTransfer.files);
    
    if (files.length > 0) {
      try {
        await uploadMultipleFiles(files);
        alert('æ‹–æ‹½ä¸Šä¼ æˆåŠŸï¼');
      } catch (error) {
        alert('æ‹–æ‹½ä¸Šä¼ å¤±è´¥ï¼');
      }
    }
  });
}
```

---

## 4. ğŸ“Š ä¸Šä¼ è¿›åº¦ç›‘æ§


### 4.1 è¿›åº¦ç›‘æ§åŸç†

**ç®€å•ç†è§£**ï¼šå°±åƒå¿«é€’è·Ÿè¸ªä¸€æ ·ï¼Œå®æ—¶çŸ¥é“æ–‡ä»¶ä¸Šä¼ äº†å¤šå°‘ã€‚

```
è¿›åº¦ç›‘æ§æµç¨‹ï¼š

å¼€å§‹ä¸Šä¼  â”€â”€â†’ 10% â”€â”€â†’ 50% â”€â”€â†’ 80% â”€â”€â†’ 100% å®Œæˆ
   â†“         â†“       â†“       â†“        â†“
 æ˜¾ç¤º0%   æ˜¾ç¤º10%  æ˜¾ç¤º50%  æ˜¾ç¤º80%  æ˜¾ç¤ºå®Œæˆ
```

### 4.2 è¿›åº¦æ¡å®ç°


```javascript
// å¸¦è¿›åº¦æ¡çš„æ–‡ä»¶ä¸Šä¼ 
async function uploadWithProgress(file, onProgress) {
  const formData = new FormData();
  formData.append('file', file);
  
  try {
    const response = await axios.post('/api/upload', formData, {
      // å…³é”®é…ç½®ï¼šç›‘å¬ä¸Šä¼ è¿›åº¦
      onUploadProgress: (progressEvent) => {
        // è®¡ç®—ä¸Šä¼ ç™¾åˆ†æ¯”
        const percentCompleted = Math.round(
          (progressEvent.loaded * 100) / progressEvent.total
        );
        
        // è°ƒç”¨è¿›åº¦å›è°ƒå‡½æ•°
        if (onProgress) {
          onProgress(percentCompleted);
        }
      }
    });
    
    return response.data;
  } catch (error) {
    throw error;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function handleFileUpload(file) {
  const progressBar = document.getElementById('progressBar');
  const progressText = document.getElementById('progressText');
  
  uploadWithProgress(file, (percent) => {
    // æ›´æ–°è¿›åº¦æ¡
    progressBar.style.width = percent + '%';
    progressText.textContent = percent + '%';
    
    console.log(`ä¸Šä¼ è¿›åº¦: ${percent}%`);
  }).then(result => {
    console.log('ä¸Šä¼ å®Œæˆ:', result);
    progressText.textContent = 'ä¸Šä¼ æˆåŠŸï¼';
  }).catch(error => {
    console.error('ä¸Šä¼ å¤±è´¥:', error);
    progressText.textContent = 'ä¸Šä¼ å¤±è´¥ï¼';
  });
}
```

### 4.3 å¤šæ–‡ä»¶è¿›åº¦æ˜¾ç¤º


```javascript
// å¤šæ–‡ä»¶å¸¦è¿›åº¦ä¸Šä¼ 
async function uploadMultipleWithProgress(files) {
  const results = [];
  
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    console.log(`æ­£åœ¨ä¸Šä¼ ç¬¬ ${i + 1}/${files.length} ä¸ªæ–‡ä»¶`);
    
    try {
      const result = await uploadWithProgress(file, (percent) => {
        console.log(`æ–‡ä»¶${i + 1}è¿›åº¦: ${percent}%`);
      });
      
      results.push(result);
    } catch (error) {
      console.error(`æ–‡ä»¶${i + 1}ä¸Šä¼ å¤±è´¥:`, error);
    }
  }
  
  return results;
}
```

---

## 5. âœ”ï¸ æ–‡ä»¶éªŒè¯ä¸é™åˆ¶


### 5.1 å¸¸è§éªŒè¯éœ€æ±‚


| éªŒè¯ç±»å‹ | **ä½œç”¨** | **å¸¸è§é™åˆ¶** |
|---------|---------|-------------|
| ğŸ”¸ **æ–‡ä»¶ç±»å‹** | `é˜²æ­¢ä¸Šä¼ å±é™©æ–‡ä»¶` | `å›¾ç‰‡: jpg,png,gif` |
| ğŸ”¸ **æ–‡ä»¶å¤§å°** | `èŠ‚çœæœåŠ¡å™¨ç©ºé—´` | `å¤´åƒ: 2MBä»¥å†…` |
| ğŸ”¸ **æ–‡ä»¶æ•°é‡** | `æ§åˆ¶æ‰¹é‡ä¸Šä¼ ` | `æœ€å¤š10ä¸ªæ–‡ä»¶` |
| ğŸ”¸ **æ–‡ä»¶åç§°** | `é¿å…ç‰¹æ®Šå­—ç¬¦` | `ä¸å«ä¸­æ–‡å’Œç¬¦å·` |

### 5.2 æ–‡ä»¶éªŒè¯å®ç°


```javascript
// æ–‡ä»¶éªŒè¯å·¥å…·å‡½æ•°
class FileValidator {
  // æ£€æŸ¥æ–‡ä»¶ç±»å‹
  static checkFileType(file, allowedTypes) {
    const fileExtension = file.name.split('.').pop().toLowerCase();
    
    if (!allowedTypes.includes(fileExtension)) {
      throw new Error(`åªå…è®¸ä¸Šä¼  ${allowedTypes.join(', ')} æ ¼å¼çš„æ–‡ä»¶`);
    }
    
    return true;
  }
  
  // æ£€æŸ¥æ–‡ä»¶å¤§å°
  static checkFileSize(file, maxSizeMB) {
    const maxSizeBytes = maxSizeMB * 1024 * 1024;
    
    if (file.size > maxSizeBytes) {
      throw new Error(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${maxSizeMB}MB`);
    }
    
    return true;
  }
  
  // æ£€æŸ¥æ–‡ä»¶æ•°é‡
  static checkFileCount(files, maxCount) {
    if (files.length > maxCount) {
      throw new Error(`æœ€å¤šåªèƒ½é€‰æ‹© ${maxCount} ä¸ªæ–‡ä»¶`);
    }
    
    return true;
  }
}

// å¤´åƒä¸Šä¼ éªŒè¯ç¤ºä¾‹
async function uploadAvatarWithValidation(file) {
  try {
    // éªŒè¯æ–‡ä»¶ç±»å‹ï¼ˆåªå…è®¸å›¾ç‰‡ï¼‰
    FileValidator.checkFileType(file, ['jpg', 'jpeg', 'png', 'gif']);
    
    // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§2MBï¼‰
    FileValidator.checkFileSize(file, 2);
    
    // éªŒè¯é€šè¿‡ï¼Œå¼€å§‹ä¸Šä¼ 
    return await uploadWithProgress(file, (percent) => {
      console.log(`å¤´åƒä¸Šä¼ è¿›åº¦: ${percent}%`);
    });
    
  } catch (error) {
    alert('æ–‡ä»¶éªŒè¯å¤±è´¥: ' + error.message);
    throw error;
  }
}
```

### 5.3 å›¾ç‰‡é¢„è§ˆåŠŸèƒ½


```javascript
// å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
function previewImage(file, previewElementId) {
  // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
  if (!file.type.startsWith('image/')) {
    alert('åªèƒ½é¢„è§ˆå›¾ç‰‡æ–‡ä»¶');
    return;
  }
  
  // åˆ›å»ºFileReaderè¯»å–æ–‡ä»¶
  const reader = new FileReader();
  
  reader.onload = function(e) {
    const previewImg = document.getElementById(previewElementId);
    previewImg.src = e.target.result;  // è®¾ç½®å›¾ç‰‡æº
    previewImg.style.display = 'block';
  };
  
  // è¯»å–æ–‡ä»¶ä¸ºæ•°æ®URL
  reader.readAsDataURL(file);
}

// ä½¿ç”¨ç¤ºä¾‹
document.getElementById('avatarInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  
  if (file) {
    // å…ˆæ˜¾ç¤ºé¢„è§ˆ
    previewImage(file, 'avatarPreview');
    
    // ç”¨æˆ·ç¡®è®¤åå†ä¸Šä¼ 
    if (confirm('ç¡®å®šè¦ä¸Šä¼ è¿™å¼ å›¾ç‰‡ä½œä¸ºå¤´åƒå—ï¼Ÿ')) {
      uploadAvatarWithValidation(file);
    }
  }
});
```

---

## 6. ğŸ“¥ æ–‡ä»¶ä¸‹è½½åŠŸèƒ½


### 6.1 æ–‡ä»¶ä¸‹è½½åŸç†

**ç®€å•ç†è§£**ï¼šå°±æ˜¯ä»æœåŠ¡å™¨æŠŠæ–‡ä»¶"æ‹¿å›æ¥"ä¿å­˜åˆ°æœ¬åœ°ã€‚

```
ä¸‹è½½æµç¨‹ï¼š

å‘é€ä¸‹è½½è¯·æ±‚ â†’ æœåŠ¡å™¨è¿”å›æ–‡ä»¶æ•°æ® â†’ æµè§ˆå™¨ä¿å­˜æ–‡ä»¶

æŠ€æœ¯å®ç°ï¼š
axiosè¯·æ±‚ â†’ responseType: 'blob' â†’ åˆ›å»ºä¸‹è½½é“¾æ¥ â†’ è‡ªåŠ¨ä¸‹è½½
```

### 6.2 æ–‡ä»¶ä¸‹è½½å®ç°


```javascript
// æ–‡ä»¶ä¸‹è½½å‡½æ•°
async function downloadFile(url, filename) {
  try {
    // 1. è¯·æ±‚æ–‡ä»¶æ•°æ®ï¼ˆå…³é”®ï¼šè®¾ç½®responseTypeä¸ºblobï¼‰
    const response = await axios.get(url, {
      responseType: 'blob'  // å‘Šè¯‰axiosè¿™æ˜¯æ–‡ä»¶æ•°æ®
    });
    
    // 2. åˆ›å»ºBlobå¯¹è±¡ï¼ˆæ–‡ä»¶æ•°æ®åŒ…ï¼‰
    const blob = new Blob([response.data]);
    
    // 3. åˆ›å»ºä¸‹è½½é“¾æ¥
    const downloadUrl = URL.createObjectURL(blob);
    
    // 4. åˆ›å»ºä¸´æ—¶aæ ‡ç­¾å®ç°ä¸‹è½½
    const link = document.createElement('a');
    link.href = downloadUrl;
    link.download = filename || 'ä¸‹è½½æ–‡ä»¶';  // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
    
    // 5. è§¦å‘ä¸‹è½½
    document.body.appendChild(link);
    link.click();
    
    // 6. æ¸…ç†ä¸´æ—¶å…ƒç´ å’ŒURL
    document.body.removeChild(link);
    URL.revokeObjectURL(downloadUrl);
    
    console.log('æ–‡ä»¶ä¸‹è½½æˆåŠŸ');
    
  } catch (error) {
    console.error('æ–‡ä»¶ä¸‹è½½å¤±è´¥:', error);
    alert('ä¸‹è½½å¤±è´¥ï¼š' + error.message);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
function handleDownload() {
  downloadFile('/api/files/report.pdf', 'æœˆåº¦æŠ¥å‘Š.pdf');
}
```

### 6.3 ExcelæŠ¥è¡¨ä¸‹è½½ç¤ºä¾‹


```javascript
// å¯¼å‡ºExcelæŠ¥è¡¨
async function exportExcelReport() {
  try {
    const response = await axios.post('/api/export/excel', {
      // å¯¼å‡ºå‚æ•°
      startDate: '2024-01-01',
      endDate: '2024-12-31',
      type: 'sales'
    }, {
      responseType: 'blob'  // é‡è¦ï¼šè®¾ç½®ä¸ºblob
    });
    
    // ä»å“åº”å¤´è·å–æ–‡ä»¶å
    const contentDisposition = response.headers['content-disposition'];
    let filename = 'é”€å”®æŠ¥è¡¨.xlsx';
    
    if (contentDisposition) {
      const matches = contentDisposition.match(/filename="(.+)"/);
      if (matches) {
        filename = matches[1];
      }
    }
    
    // åˆ›å»ºä¸‹è½½
    const blob = new Blob([response.data], {
      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    });
    
    const downloadUrl = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = downloadUrl;
    link.download = filename;
    link.click();
    
    URL.revokeObjectURL(downloadUrl);
    
    alert('ExcelæŠ¥è¡¨å¯¼å‡ºæˆåŠŸï¼');
    
  } catch (error) {
    console.error('å¯¼å‡ºå¤±è´¥:', error);
    alert('æŠ¥è¡¨å¯¼å‡ºå¤±è´¥ï¼');
  }
}
```

---

## 7. âœ‚ï¸ å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 


### 7.1 åˆ†ç‰‡ä¸Šä¼ åŸç†

**é€šä¿—è§£é‡Š**ï¼šå°±åƒé‚®å¯„å¤§åŒ…è£¹ï¼Œæ‹†åˆ†æˆå°åŒ…è£¹åˆ†åˆ«å¯„é€ï¼Œæœ€ååœ¨ç›®çš„åœ°ç»„è£…ã€‚

```
åˆ†ç‰‡ä¸Šä¼ æµç¨‹ï¼š

å¤§æ–‡ä»¶(100MB)
     â†“
æ‹†åˆ†æˆå°ç‰‡æ®µ
     â†“
ç‰‡æ®µ1(10MB) â†’ ä¸Šä¼ æˆåŠŸ âœ“
ç‰‡æ®µ2(10MB) â†’ ä¸Šä¼ æˆåŠŸ âœ“
ç‰‡æ®µ3(10MB) â†’ ä¸Šä¼ å¤±è´¥ âœ— â†’ é‡æ–°ä¸Šä¼  âœ“
...
ç‰‡æ®µ10(10MB) â†’ ä¸Šä¼ æˆåŠŸ âœ“
     â†“
æœåŠ¡å™¨åˆå¹¶æ–‡ä»¶
```

### 7.2 åˆ†ç‰‡ä¸Šä¼ å®ç°


```javascript
// å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
class ChunkUploader {
  constructor(file, chunkSize = 1024 * 1024) {  // é»˜è®¤1MBä¸€ç‰‡
    this.file = file;
    this.chunkSize = chunkSize;
    this.totalChunks = Math.ceil(file.size / chunkSize);
  }
  
  // åˆ‡å‰²æ–‡ä»¶
  getChunk(index) {
    const start = index * this.chunkSize;
    const end = Math.min(start + this.chunkSize, this.file.size);
    return this.file.slice(start, end);
  }
  
  // ä¸Šä¼ å•ä¸ªåˆ†ç‰‡
  async uploadChunk(chunkIndex) {
    const chunk = this.getChunk(chunkIndex);
    const formData = new FormData();
    
    formData.append('chunk', chunk);
    formData.append('chunkIndex', chunkIndex);
    formData.append('totalChunks', this.totalChunks);
    formData.append('filename', this.file.name);
    
    const response = await axios.post('/api/upload/chunk', formData);
    return response.data;
  }
  
  // ä¸Šä¼ æ‰€æœ‰åˆ†ç‰‡
  async uploadAll(onProgress) {
    const results = [];
    
    for (let i = 0; i < this.totalChunks; i++) {
      try {
        console.log(`ä¸Šä¼ åˆ†ç‰‡ ${i + 1}/${this.totalChunks}`);
        
        const result = await this.uploadChunk(i);
        results.push(result);
        
        // è®¡ç®—æ€»è¿›åº¦
        const progress = Math.round(((i + 1) / this.totalChunks) * 100);
        if (onProgress) onProgress(progress);
        
      } catch (error) {
        console.error(`åˆ†ç‰‡ ${i + 1} ä¸Šä¼ å¤±è´¥:`, error);
        throw error;
      }
    }
    
    // é€šçŸ¥æœåŠ¡å™¨åˆå¹¶æ–‡ä»¶
    await this.mergeChunks();
    return results;
  }
  
  // åˆå¹¶åˆ†ç‰‡
  async mergeChunks() {
    const response = await axios.post('/api/upload/merge', {
      filename: this.file.name,
      totalChunks: this.totalChunks
    });
    
    return response.data;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function uploadLargeFile(file) {
  if (file.size < 10 * 1024 * 1024) {  // å°äº10MBç›´æ¥ä¸Šä¼ 
    return await uploadSingleFile(file);
  }
  
  // å¤§æ–‡ä»¶ä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ 
  const uploader = new ChunkUploader(file);
  
  try {
    await uploader.uploadAll((progress) => {
      console.log(`å¤§æ–‡ä»¶ä¸Šä¼ è¿›åº¦: ${progress}%`);
    });
    
    console.log('å¤§æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼');
  } catch (error) {
    console.error('å¤§æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
  }
}
```

---

## 8. ğŸ¯ å®é™…åº”ç”¨åœºæ™¯


### 8.1 ç”¨æˆ·å¤´åƒä¸Šä¼ 


```javascript
// å¤´åƒä¸Šä¼ å®Œæ•´æ–¹æ¡ˆ
class AvatarUploader {
  constructor(inputId, previewId) {
    this.input = document.getElementById(inputId);
    this.preview = document.getElementById(previewId);
    this.init();
  }
  
  init() {
    this.input.addEventListener('change', (e) => {
      this.handleFileSelect(e.target.files[0]);
    });
  }
  
  async handleFileSelect(file) {
    if (!file) return;
    
    try {
      // 1. æ–‡ä»¶éªŒè¯
      this.validateFile(file);
      
      // 2. æ˜¾ç¤ºé¢„è§ˆ
      this.showPreview(file);
      
      // 3. ç¡®è®¤ä¸Šä¼ 
      if (confirm('ç¡®å®šè¦æ›´æ¢å¤´åƒå—ï¼Ÿ')) {
        await this.uploadAvatar(file);
      }
      
    } catch (error) {
      alert(error.message);
    }
  }
  
  validateFile(file) {
    // åªå…è®¸å›¾ç‰‡
    if (!file.type.startsWith('image/')) {
      throw new Error('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶');
    }
    
    // å¤§å°é™åˆ¶2MB
    if (file.size > 2 * 1024 * 1024) {
      throw new Error('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB');
    }
  }
  
  showPreview(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      this.preview.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
  
  async uploadAvatar(file) {
    const formData = new FormData();
    formData.append('avatar', file);
    
    try {
      const response = await axios.post('/api/user/avatar', formData, {
        onUploadProgress: (e) => {
          const percent = Math.round((e.loaded * 100) / e.total);
          console.log(`å¤´åƒä¸Šä¼ : ${percent}%`);
        }
      });
      
      alert('å¤´åƒæ›´æ–°æˆåŠŸï¼');
      return response.data;
      
    } catch (error) {
      alert('å¤´åƒä¸Šä¼ å¤±è´¥');
      throw error;
    }
  }
}

// ä½¿ç”¨
const avatarUploader = new AvatarUploader('avatarInput', 'avatarPreview');
```

### 8.2 æ‰¹é‡å›¾ç‰‡ä¸Šä¼ 


```javascript
// ç›¸å†Œæ‰¹é‡ä¸Šä¼ 
async function uploadPhotosToAlbum(files) {
  const maxFiles = 20;  // æœ€å¤š20å¼ 
  const maxSize = 5;    // æœ€å¤§5MB
  
  // éªŒè¯æ–‡ä»¶æ•°é‡
  if (files.length > maxFiles) {
    alert(`æœ€å¤šåªèƒ½é€‰æ‹©${maxFiles}å¼ å›¾ç‰‡`);
    return;
  }
  
  // éªŒè¯æ¯ä¸ªæ–‡ä»¶
  for (let file of files) {
    if (!file.type.startsWith('image/')) {
      alert('åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶');
      return;
    }
    
    if (file.size > maxSize * 1024 * 1024) {
      alert(`å›¾ç‰‡${file.name}è¶…è¿‡${maxSize}MBé™åˆ¶`);
      return;
    }
  }
  
  // æ‰¹é‡ä¸Šä¼ 
  const results = [];
  const total = files.length;
  
  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    
    try {
      console.log(`æ­£åœ¨ä¸Šä¼ ç¬¬${i + 1}/${total}å¼ å›¾ç‰‡`);
      
      const result = await uploadSingleFile(file);
      results.push(result);
      
      // æ›´æ–°è¿›åº¦
      const progress = Math.round(((i + 1) / total) * 100);
      console.log(`æ€»è¿›åº¦: ${progress}%`);
      
    } catch (error) {
      console.error(`å›¾ç‰‡${file.name}ä¸Šä¼ å¤±è´¥:`, error);
    }
  }
  
  alert(`æˆåŠŸä¸Šä¼ ${results.length}/${total}å¼ å›¾ç‰‡`);
  return results;
}
```

---

## 9. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 9.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


```
ğŸ”¸ FormDataï¼šæ–‡ä»¶ä¸Šä¼ çš„"åŒ…è£¹"ï¼Œç”¨æ¥æ‰“åŒ…æ–‡ä»¶å’Œæ•°æ®
ğŸ”¸ Content-Typeï¼šå‘Šè¯‰æœåŠ¡å™¨æ•°æ®æ ¼å¼ï¼Œæ–‡ä»¶ä¸Šä¼ æ—¶è‡ªåŠ¨è®¾ç½®
ğŸ”¸ responseType: 'blob'ï¼šä¸‹è½½æ–‡ä»¶æ—¶å¿…é¡»è®¾ç½®ï¼Œå‘Šè¯‰axiosè¿”å›æ–‡ä»¶æ•°æ®
ğŸ”¸ onUploadProgressï¼šç›‘å¬ä¸Šä¼ è¿›åº¦çš„å›è°ƒå‡½æ•°
ğŸ”¸ URL.createObjectURLï¼šåˆ›å»ºæ–‡ä»¶ä¸‹è½½é“¾æ¥çš„æ–¹æ³•
```

### 9.2 å…³é”®æŠ€æœ¯è¦ç‚¹


**ğŸ”¹ æ–‡ä»¶ä¸Šä¼ æ ¸å¿ƒæµç¨‹**
```
é€‰æ‹©æ–‡ä»¶ â†’ åˆ›å»ºFormData â†’ å‘é€POSTè¯·æ±‚ â†’ å¤„ç†å“åº”

æ³¨æ„äº‹é¡¹ï¼š
- ä½¿ç”¨FormDataåŒ…è£…æ–‡ä»¶
- ä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Type
- å¯ä»¥æ·»åŠ å…¶ä»–å­—æ®µåˆ°FormData
```

**ğŸ”¹ æ–‡ä»¶ä¸‹è½½æ ¸å¿ƒæµç¨‹**
```
å‘é€GETè¯·æ±‚ â†’ è®¾ç½®responseType: 'blob' â†’ åˆ›å»ºBlob â†’ åˆ›å»ºä¸‹è½½é“¾æ¥

æ³¨æ„äº‹é¡¹ï¼š
- å¿…é¡»è®¾ç½®responseTypeä¸ºblob
- ä½¿ç”¨URL.createObjectURLåˆ›å»ºé“¾æ¥
- ä¸‹è½½åè¦æ¸…ç†URLèµ„æº
```

**ğŸ”¹ è¿›åº¦ç›‘æ§å®ç°**
```
é…ç½®onUploadProgresså›è°ƒ â†’ è®¡ç®—ç™¾åˆ†æ¯” â†’ æ›´æ–°ç•Œé¢æ˜¾ç¤º

è®¡ç®—å…¬å¼ï¼š
è¿›åº¦ç™¾åˆ†æ¯” = (å·²ä¸Šä¼ å­—èŠ‚ / æ€»å­—èŠ‚æ•°) Ã— 100
```

### 9.3 å®ç”¨æŠ€å·§æ€»ç»“


**ğŸ“Š æ–‡ä»¶éªŒè¯æœ€ä½³å®è·µ**

| éªŒè¯é¡¹ç›® | **æ¨èåšæ³•** | **ç¤ºä¾‹ä»£ç ** |
|---------|-------------|-------------|
| ğŸ”¸ **æ–‡ä»¶ç±»å‹** | `æ£€æŸ¥æ–‡ä»¶æ‰©å±•å` | `file.name.split('.').pop()` |
| ğŸ”¸ **æ–‡ä»¶å¤§å°** | `è½¬æ¢ä¸ºMBæ¯”è¾ƒ` | `file.size / (1024*1024)` |
| ğŸ”¸ **MIMEç±»å‹** | `æ£€æŸ¥typeå±æ€§` | `file.type.startsWith('image/')` |

**âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®**
```
å•æ–‡ä»¶ä¸Šä¼ ï¼šç›´æ¥ä½¿ç”¨FormData
å¤šæ–‡ä»¶ä¸Šä¼ ï¼šè€ƒè™‘å¹¶å‘æ§åˆ¶ï¼Œé¿å…åŒæ—¶ä¸Šä¼ è¿‡å¤šæ–‡ä»¶
å¤§æ–‡ä»¶ä¸Šä¼ ï¼šä½¿ç”¨åˆ†ç‰‡ä¸Šä¼ ï¼Œæé«˜æˆåŠŸç‡
ä¸‹è½½æ–‡ä»¶ï¼šåˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
```

**ğŸ”§ é”™è¯¯å¤„ç†ç­–ç•¥**
```
ä¸Šä¼ å¤±è´¥ï¼šæä¾›é‡è¯•æœºåˆ¶
ç½‘ç»œä¸­æ–­ï¼šæ”¯æŒæ–­ç‚¹ç»­ä¼ 
æ–‡ä»¶è¿‡å¤§ï¼šæç¤ºå‹ç¼©æˆ–åˆ†ç‰‡
æ ¼å¼é”™è¯¯ï¼šç»™å‡ºæ˜ç¡®æç¤º
```

### 9.4 å®é™…åº”ç”¨æŒ‡å¯¼


**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… **ç”¨æˆ·å¤´åƒä¸Šä¼ **ï¼šå•æ–‡ä»¶ã€å›¾ç‰‡ç±»å‹ã€å¤§å°é™åˆ¶
- âœ… **æ–‡æ¡£é™„ä»¶ä¸Šä¼ **ï¼šå¤šç§æ ¼å¼ã€å¤§å°æ§åˆ¶
- âœ… **ç›¸å†Œæ‰¹é‡ä¸Šä¼ **ï¼šå¤šæ–‡ä»¶ã€è¿›åº¦æ˜¾ç¤º  
- âœ… **å¤§æ–‡ä»¶ä¸Šä¼ **ï¼šè§†é¢‘ã€å‹ç¼©åŒ…ç­‰å¤§æ–‡ä»¶
- âœ… **æŠ¥è¡¨ä¸‹è½½**ï¼šExcelã€PDFç­‰æ–‡ä»¶ä¸‹è½½

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
```
ä¸Šä¼ æ–‡ä»¶ç”¨FormDataï¼ŒContent-Typeåˆ«æ‰‹åŠ¨
ä¸‹è½½æ–‡ä»¶blobç±»å‹ï¼ŒcreateObjectURLç”Ÿæˆé“¾æ¥
è¿›åº¦ç›‘å¬onUploadProgressï¼Œç™¾åˆ†æ¯”è®¡ç®—è¦å‡†ç¡®
æ–‡ä»¶éªŒè¯å¾ˆé‡è¦ï¼Œç±»å‹å¤§å°éƒ½è¦æ£€æŸ¥
```