---
title: 3ã€è¶…æ—¶æ§åˆ¶ä¸é‡è¯•ç­–ç•¥
---
## ğŸ“š ç›®å½•

1. [ä»€ä¹ˆæ˜¯è¶…æ—¶æ§åˆ¶](#1-ä»€ä¹ˆæ˜¯è¶…æ—¶æ§åˆ¶)
2. [axios è¶…æ—¶é…ç½®è¯¦è§£](#2-axios-è¶…æ—¶é…ç½®è¯¦è§£)
3. [è¶…æ—¶é”™è¯¯è¯†åˆ«ä¸å¤„ç†](#3-è¶…æ—¶é”™è¯¯è¯†åˆ«ä¸å¤„ç†)
4. [è‡ªåŠ¨é‡è¯•æœºåˆ¶å®ç°](#4-è‡ªåŠ¨é‡è¯•æœºåˆ¶å®ç°)
5. [é‡è¯•ç­–ç•¥æ·±å…¥é…ç½®](#5-é‡è¯•ç­–ç•¥æ·±å…¥é…ç½®)
6. [ç½‘ç»œçŠ¶æ€æ£€æµ‹](#6-ç½‘ç»œçŠ¶æ€æ£€æµ‹)
7. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#7-ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ• ä»€ä¹ˆæ˜¯è¶…æ—¶æ§åˆ¶


### 1.1 è¶…æ—¶æ§åˆ¶çš„æœ¬è´¨å«ä¹‰


**ç®€å•ç†è§£**ï¼šè¶…æ—¶æ§åˆ¶å°±åƒç»™ç½‘ç»œè¯·æ±‚è®¾å®šä¸€ä¸ª"æœ€é•¿ç­‰å¾…æ—¶é—´"

```
ç”Ÿæ´»ä¸­çš„ä¾‹å­ï¼š
ä½ æ‰“ç”µè¯ç»™æœ‹å‹ï¼Œå¦‚æœ30ç§’æ²¡äººæ¥å¬ï¼Œä½ å°±æŒ‚æ–­ç”µè¯
ç½‘ç»œè¯·æ±‚ä¹Ÿä¸€æ ·ï¼Œå¦‚æœ10ç§’å†…æœåŠ¡å™¨æ²¡å“åº”ï¼Œå°±ä¸»åŠ¨æ–­å¼€è¿æ¥

ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶æ§åˆ¶ï¼Ÿ
âŒ æ²¡æœ‰è¶…æ—¶ï¼šé¡µé¢å¯èƒ½æ°¸è¿œåœ¨è½¬åœˆåœˆï¼Œç”¨æˆ·ä½“éªŒæå·®
âœ… æœ‰äº†è¶…æ—¶ï¼šæœ€å¤šç­‰10ç§’ï¼Œç„¶åç»™ç”¨æˆ·æ˜ç¡®çš„åé¦ˆ
```

### 1.2 è¶…æ—¶çš„å®é™…æ„ä¹‰


**ğŸ¯ æ ¸å¿ƒä½œç”¨**ï¼š
- **é˜²æ­¢é¡µé¢å¡æ­»**ï¼šé¿å…ç”¨æˆ·æ— é™ç­‰å¾…
- **å¿«é€Ÿå¤±è´¥**ï¼šåŠæ—¶å‘ç°ç½‘ç»œé—®é¢˜
- **èµ„æºä¿æŠ¤**ï¼šé‡Šæ”¾æµè§ˆå™¨è¿æ¥èµ„æº
- **ç”¨æˆ·ä½“éªŒ**ï¼šç»™ç”¨æˆ·æ˜ç¡®çš„åé¦ˆ

**ğŸ’¡ ç”Ÿæ´»ç±»æ¯”**ï¼š
```
è¶…æ—¶æ§åˆ¶ = é¤å…ç‚¹é¤çš„ç­‰å¾…æ—¶é—´
- æ­£å¸¸æƒ…å†µï¼š5åˆ†é’Ÿä¸Šèœ âœ…
- ç½‘ç»œæ…¢ï¼š10åˆ†é’Ÿä¸Šèœ âš ï¸ 
- è¶…æ—¶äº†ï¼š15åˆ†é’Ÿè¿˜ä¸ä¸Šèœï¼Œæˆ‘è¦é€€å•ï¼âŒ
```

---

## 2. âš™ï¸ axios è¶…æ—¶é…ç½®è¯¦è§£


### 2.1 åŸºç¡€è¶…æ—¶é…ç½®


**ğŸ”§ æœ€ç®€å•çš„è¶…æ—¶è®¾ç½®**ï¼š
```javascript
// æ–¹å¼1ï¼šåˆ›å»ºè¯·æ±‚æ—¶è®¾ç½®
axios.get('/api/data', {
  timeout: 5000  // 5ç§’è¶…æ—¶ï¼Œå•ä½æ˜¯æ¯«ç§’
})

// æ–¹å¼2ï¼šå…¨å±€é»˜è®¤è¶…æ—¶
axios.defaults.timeout = 10000  // 10ç§’

// æ–¹å¼3ï¼šå®ä¾‹è¶…æ—¶
const api = axios.create({
  timeout: 8000  // 8ç§’
})
```

**ğŸ“ ç†è§£è¦ç‚¹**ï¼š
- `timeout` çš„å€¼æ˜¯æ¯«ç§’ï¼Œ1000 = 1ç§’
- è¶…æ—¶æ—¶é—´ä»**å‘é€è¯·æ±‚å¼€å§‹**è®¡ç®—
- åŒ…æ‹¬**è¿æ¥æ—¶é—´ + æœåŠ¡å™¨å¤„ç†æ—¶é—´ + å“åº”æ—¶é—´**

### 2.2 ä¸åŒåœºæ™¯çš„è¶…æ—¶é…ç½®


**ğŸ¯ è¶…æ—¶æ—¶é—´çš„é€‰æ‹©å»ºè®®**ï¼š

| è¯·æ±‚ç±»å‹ | **æ¨èè¶…æ—¶** | **è¯´æ˜** |
|---------|-------------|---------|
| ğŸ” **æŸ¥è¯¢æ•°æ®** | `3-5ç§’` | `ç”¨æˆ·ç­‰å¾…æŸ¥è¯¢ç»“æœçš„è€å¿ƒæœ‰é™` |
| ğŸ“ **æäº¤è¡¨å•** | `10-15ç§’` | `æ¶‰åŠæ•°æ®å¤„ç†ï¼Œå¯ç¨é•¿ä¸€äº›` |
| ğŸ“¤ **æ–‡ä»¶ä¸Šä¼ ** | `30-60ç§’` | `æ–‡ä»¶å¤§å°ä¸ç¡®å®šï¼Œæ—¶é—´è¦å……è¶³` |
| ğŸ”„ **æ‰¹é‡æ“ä½œ** | `20-30ç§’` | `æœåŠ¡å™¨éœ€è¦æ—¶é—´å¤„ç†å¤šæ¡æ•°æ®` |

```javascript
// å®é™…é…ç½®ç¤ºä¾‹
const config = {
  // å¿«é€ŸæŸ¥è¯¢
  searchTimeout: 3000,
  // è¡¨å•æäº¤  
  submitTimeout: 15000,
  // æ–‡ä»¶ä¸Šä¼ 
  uploadTimeout: 60000
}

// ä½¿ç”¨é…ç½®
axios.get('/search', { timeout: config.searchTimeout })
axios.post('/submit', data, { timeout: config.submitTimeout })
```

### 2.3 åŠ¨æ€è¶…æ—¶é…ç½®


**ğŸ”„ æ ¹æ®ç½‘ç»œçŠ¶å†µè°ƒæ•´è¶…æ—¶**ï¼š
```javascript
// æ£€æµ‹ç½‘ç»œé€Ÿåº¦ï¼ŒåŠ¨æ€è®¾ç½®è¶…æ—¶
function getTimeoutByNetwork() {
  const connection = navigator.connection
  
  if (connection) {
    // 2Gç½‘ç»œï¼šè¶…æ—¶æ—¶é—´é•¿ä¸€äº›
    if (connection.effectiveType === '2g') {
      return 20000  // 20ç§’
    }
    // 4Gç½‘ç»œï¼šè¶…æ—¶æ—¶é—´çŸ­ä¸€äº›
    if (connection.effectiveType === '4g') {
      return 5000   // 5ç§’
    }
  }
  
  return 10000  // é»˜è®¤10ç§’
}

// åº”ç”¨åŠ¨æ€è¶…æ—¶
axios.get('/api/data', {
  timeout: getTimeoutByNetwork()
})
```

---

## 3. âŒ è¶…æ—¶é”™è¯¯è¯†åˆ«ä¸å¤„ç†


### 3.1 å¦‚ä½•è¯†åˆ«è¶…æ—¶é”™è¯¯


**ğŸ” åˆ¤æ–­æ˜¯å¦æ˜¯è¶…æ—¶é”™è¯¯**ï¼š
```javascript
axios.get('/api/data', { timeout: 5000 })
  .catch(error => {
    // åˆ¤æ–­æ˜¯å¦æ˜¯è¶…æ—¶é”™è¯¯
    if (error.code === 'ECONNABORTED' && error.message.includes('timeout')) {
      console.log('è¯·æ±‚è¶…æ—¶äº†ï¼')
      // å¤„ç†è¶…æ—¶æƒ…å†µ
      handleTimeout()
    } else {
      console.log('å…¶ä»–é”™è¯¯ï¼š', error.message)
    }
  })
```

**ğŸ“ ç†è§£è¦ç‚¹**ï¼š
- `error.code === 'ECONNABORTED'` è¡¨ç¤ºè¿æ¥è¢«ä¸­æ–­
- `error.message.includes('timeout')` ç¡®è®¤æ˜¯è¶…æ—¶å¯¼è‡´çš„
- è¿™æ ·å¯ä»¥åŒºåˆ†è¶…æ—¶å’Œå…¶ä»–ç½‘ç»œé”™è¯¯

### 3.2 å‹å¥½çš„è¶…æ—¶å¤„ç†


**ğŸ’¡ ç»™ç”¨æˆ·å‹å¥½çš„æç¤º**ï¼š
```javascript
function handleAxiosError(error) {
  if (error.code === 'ECONNABORTED') {
    return {
      type: 'timeout',
      message: 'ç½‘ç»œå“åº”è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•',
      userTip: 'ç½‘ç»œæœ‰ç‚¹æ…¢ï¼Œè¦ä¸è¦é‡è¯•ä¸€ä¸‹ï¼Ÿ'
    }
  }
  
  // å…¶ä»–é”™è¯¯ç±»å‹...
  return {
    type: 'unknown',
    message: 'è¯·æ±‚å¤±è´¥',
    userTip: 'å‡ºäº†ç‚¹å°é—®é¢˜ï¼Œè¯·ç¨åå†è¯•'
  }
}

// ä½¿ç”¨ç¤ºä¾‹
axios.get('/api/data', { timeout: 5000 })
  .catch(error => {
    const errorInfo = handleAxiosError(error)
    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„æç¤º
    showMessage(errorInfo.userTip)
  })
```

---

## 4. ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶å®ç°


### 4.1 ä»€ä¹ˆæ˜¯è‡ªåŠ¨é‡è¯•


**ğŸ¯ é‡è¯•æœºåˆ¶çš„å«ä¹‰**ï¼š
```
é‡è¯• = å¦‚æœç¬¬ä¸€æ¬¡è¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨å†è¯•å‡ æ¬¡

å°±åƒï¼š
ç¬¬1æ¬¡æ•²é—¨ï¼šæ²¡äººå¼€é—¨
ç¬¬2æ¬¡æ•²é—¨ï¼šè¿˜æ˜¯æ²¡äººå¼€é—¨  
ç¬¬3æ¬¡æ•²é—¨ï¼šç»ˆäºæœ‰äººå¼€é—¨äº†ï¼

ç½‘ç»œè¯·æ±‚ä¹Ÿä¸€æ ·ï¼Œç¬¬ä¸€æ¬¡è¶…æ—¶ä¸ä»£è¡¨æ°¸è¿œéƒ½ä¼šè¶…æ—¶
```

### 4.2 åŸºç¡€é‡è¯•å®ç°


**ğŸ”§ ç®€å•çš„é‡è¯•é€»è¾‘**ï¼š
```javascript
// å¸¦é‡è¯•çš„è¯·æ±‚å‡½æ•°
async function requestWithRetry(url, config = {}, maxRetries = 3) {
  let retries = 0
  
  while (retries < maxRetries) {
    try {
      // å°è¯•å‘é€è¯·æ±‚
      const response = await axios.get(url, config)
      return response  // æˆåŠŸäº†ï¼Œç›´æ¥è¿”å›
    } catch (error) {
      retries++
      
      // å¦‚æœæ˜¯è¶…æ—¶é”™è¯¯ä¸”è¿˜æœ‰é‡è¯•æ¬¡æ•°
      if (error.code === 'ECONNABORTED' && retries < maxRetries) {
        console.log(`ç¬¬${retries}æ¬¡é‡è¯•...`)
        // ç­‰å¾…ä¸€ä¸‹å†é‡è¯•
        await sleep(1000 * retries)  
        continue
      }
      
      // é‡è¯•æ¬¡æ•°ç”¨å®Œæˆ–å…¶ä»–é”™è¯¯ï¼ŒæŠ›å‡ºå¼‚å¸¸
      throw error
    }
  }
}

// è¾…åŠ©å‡½æ•°ï¼šç­‰å¾…æŒ‡å®šæ—¶é—´
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms))
}

// ä½¿ç”¨ç¤ºä¾‹
requestWithRetry('/api/data', { timeout: 5000 }, 3)
  .then(response => {
    console.log('æ•°æ®è·å–æˆåŠŸ:', response.data)
  })
  .catch(error => {
    console.log('é‡è¯•3æ¬¡åä»ç„¶å¤±è´¥:', error.message)
  })
```

### 4.3 æ™ºèƒ½é‡è¯•ç­–ç•¥


**ğŸ§  åªå¯¹ç‰¹å®šé”™è¯¯é‡è¯•**ï¼š
```javascript
// åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡è¯•çš„å‡½æ•°
function shouldRetry(error) {
  // åªå¯¹è¿™äº›æƒ…å†µé‡è¯•
  const retryableErrors = [
    'ECONNABORTED',  // è¶…æ—¶
    'ENOTFOUND',     // DNSè§£æå¤±è´¥
    'ECONNRESET'     // è¿æ¥é‡ç½®
  ]
  
  // åªå¯¹è¿™äº›HTTPçŠ¶æ€ç é‡è¯•
  const retryableStatus = [408, 429, 500, 502, 503, 504]
  
  return retryableErrors.includes(error.code) || 
         retryableStatus.includes(error.response?.status)
}

// æ”¹è¿›çš„é‡è¯•å‡½æ•°
async function smartRetry(requestFn, maxRetries = 3, delay = 1000) {
  let retries = 0
  
  while (retries < maxRetries) {
    try {
      return await requestFn()
    } catch (error) {
      // åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡è¯•
      if (!shouldRetry(error) || retries >= maxRetries - 1) {
        throw error
      }
      
      retries++
      console.log(`æ™ºèƒ½é‡è¯• ${retries}/${maxRetries}`)
      
      // ç­‰å¾…åé‡è¯•
      await sleep(delay * retries)
    }
  }
}
```

---

## 5. ğŸ“Š é‡è¯•ç­–ç•¥æ·±å…¥é…ç½®


### 5.1 é‡è¯•æ¬¡æ•°æ§åˆ¶


**ğŸ¯ ä¸åŒåœºæ™¯çš„é‡è¯•ç­–ç•¥**ï¼š

| åœºæ™¯ç±»å‹ | **é‡è¯•æ¬¡æ•°** | **ç†ç”±** |
|---------|-------------|---------|
| ğŸ” **å®æ—¶æœç´¢** | `1-2æ¬¡` | `ç”¨æˆ·ç­‰å¾…æ—¶é—´çŸ­ï¼Œé‡è¯•è¦å¿«` |
| ğŸ“ **è¡¨å•æäº¤** | `3-5æ¬¡` | `ç”¨æˆ·æ“ä½œæˆæœ¬é«˜ï¼Œå¤šè¯•å‡ æ¬¡` |
| ğŸ“¤ **æ–‡ä»¶ä¸Šä¼ ** | `5-8æ¬¡` | `ä¸Šä¼ å¤±è´¥ç”¨æˆ·å¾ˆfrustrating` |
| ğŸ”„ **åå°åŒæ­¥** | `10æ¬¡+` | `ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¯ä»¥å¤šè¯•` |

```javascript
// é…ç½®ä¸åŒåœºæ™¯çš„é‡è¯•ç­–ç•¥
const retryConfigs = {
  search: { maxRetries: 2, delay: 500 },
  submit: { maxRetries: 5, delay: 1000 },
  upload: { maxRetries: 8, delay: 2000 },
  sync: { maxRetries: 10, delay: 5000 }
}

// ä½¿ç”¨é…ç½®
function createRetryRequest(type) {
  const config = retryConfigs[type]
  
  return async function(requestFn) {
    return smartRetry(requestFn, config.maxRetries, config.delay)
  }
}
```

### 5.2 æŒ‡æ•°é€€é¿ç®—æ³•


**ğŸ“ˆ ä»€ä¹ˆæ˜¯æŒ‡æ•°é€€é¿**ï¼š
```
æŒ‡æ•°é€€é¿ = é‡è¯•é—´éš”æ—¶é—´é€æ¸å¢åŠ 

ç¬¬1æ¬¡é‡è¯•ï¼šç­‰1ç§’
ç¬¬2æ¬¡é‡è¯•ï¼šç­‰2ç§’  
ç¬¬3æ¬¡é‡è¯•ï¼šç­‰4ç§’
ç¬¬4æ¬¡é‡è¯•ï¼šç­‰8ç§’

è¿™æ ·é¿å…ç»™æœåŠ¡å™¨é€ æˆæ›´å¤§å‹åŠ›
```

**ğŸ”§ æŒ‡æ•°é€€é¿å®ç°**ï¼š
```javascript
// æŒ‡æ•°é€€é¿é‡è¯•å‡½æ•°
async function exponentialBackoffRetry(requestFn, maxRetries = 5) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      return await requestFn()
    } catch (error) {
      // æœ€åä¸€æ¬¡å°è¯•å¤±è´¥ï¼Œç›´æ¥æŠ›å‡ºé”™è¯¯
      if (attempt === maxRetries - 1) {
        throw error
      }
      
      if (shouldRetry(error)) {
        // è®¡ç®—ç­‰å¾…æ—¶é—´ï¼š1ç§’ * 2^attempt
        const waitTime = 1000 * Math.pow(2, attempt)
        console.log(`ç­‰å¾… ${waitTime/1000} ç§’åé‡è¯•...`)
        
        await sleep(waitTime)
      } else {
        throw error
      }
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
exponentialBackoffRetry(
  () => axios.get('/api/data', { timeout: 5000 })
)
```

### 5.3 éšæœºæŠ–åŠ¨ä¼˜åŒ–


**ğŸ² æ·»åŠ éšæœºå»¶è¿Ÿ**ï¼š
```javascript
// é¿å…æ‰€æœ‰å®¢æˆ·ç«¯åŒæ—¶é‡è¯•ï¼Œç»™æœåŠ¡å™¨é€ æˆå†²å‡»
function calculateBackoffDelay(attempt, baseDelay = 1000) {
  // æŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨
  const exponentialDelay = baseDelay * Math.pow(2, attempt)
  const jitter = Math.random() * 1000  // 0-1ç§’çš„éšæœºå»¶è¿Ÿ
  
  return exponentialDelay + jitter
}

// æ”¹è¿›çš„é‡è¯•å‡½æ•°
async function advancedRetry(requestFn, maxRetries = 3) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      return await requestFn()
    } catch (error) {
      if (attempt === maxRetries - 1 || !shouldRetry(error)) {
        throw error
      }
      
      const delay = calculateBackoffDelay(attempt)
      console.log(`é‡è¯• ${attempt + 1}/${maxRetries}ï¼Œç­‰å¾… ${Math.round(delay/1000)} ç§’`)
      
      await sleep(delay)
    }
  }
}
```

---

## 6. ğŸŒ ç½‘ç»œçŠ¶æ€æ£€æµ‹


### 6.1 æ£€æµ‹ç½‘ç»œè¿æ¥çŠ¶æ€


**ğŸ“¡ åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨çº¿**ï¼š
```javascript
// æ£€æµ‹ç½‘ç»œçŠ¶æ€çš„å·¥å…·å‡½æ•°
class NetworkMonitor {
  constructor() {
    this.isOnline = navigator.onLine
    this.setupListeners()
  }
  
  setupListeners() {
    // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
    window.addEventListener('online', () => {
      this.isOnline = true
      console.log('ç½‘ç»œå·²è¿æ¥')
      this.onNetworkChange('online')
    })
    
    window.addEventListener('offline', () => {
      this.isOnline = false
      console.log('ç½‘ç»œå·²æ–­å¼€')
      this.onNetworkChange('offline')
    })
  }
  
  onNetworkChange(status) {
    // ç½‘ç»œçŠ¶æ€å˜åŒ–æ—¶çš„å¤„ç†
    if (status === 'online') {
      this.retryFailedRequests()
    }
  }
  
  retryFailedRequests() {
    // ç½‘ç»œæ¢å¤åï¼Œé‡è¯•ä¹‹å‰å¤±è´¥çš„è¯·æ±‚
    console.log('ç½‘ç»œæ¢å¤ï¼Œé‡è¯•å¤±è´¥çš„è¯·æ±‚...')
  }
}

// ä½¿ç”¨ç½‘ç»œç›‘æ§
const networkMonitor = new NetworkMonitor()
```

### 6.2 ç½‘ç»œè´¨é‡æ£€æµ‹


**ğŸš€ æ£€æµ‹ç½‘ç»œé€Ÿåº¦**ï¼š
```javascript
// ç®€å•çš„ç½‘ç»œé€Ÿåº¦æ£€æµ‹
async function checkNetworkSpeed() {
  const startTime = Date.now()
  
  try {
    // è¯·æ±‚ä¸€ä¸ªå°æ–‡ä»¶æµ‹è¯•é€Ÿåº¦
    await axios.get('/api/ping', { timeout: 3000 })
    const duration = Date.now() - startTime
    
    if (duration < 1000) {
      return 'fast'    // å¿«é€Ÿç½‘ç»œ
    } else if (duration < 3000) {
      return 'normal'  // æ­£å¸¸ç½‘ç»œ
    } else {
      return 'slow'    // æ…¢é€Ÿç½‘ç»œ
    }
  } catch (error) {
    return 'offline'   // ç½‘ç»œæ–­å¼€
  }
}

// æ ¹æ®ç½‘ç»œé€Ÿåº¦è°ƒæ•´è¶…æ—¶æ—¶é—´
async function adaptiveRequest(url, data) {
  const networkSpeed = await checkNetworkSpeed()
  
  const timeoutMap = {
    fast: 3000,
    normal: 8000,
    slow: 15000,
    offline: 30000
  }
  
  return axios.post(url, data, {
    timeout: timeoutMap[networkSpeed]
  })
}
```

---

## 7. ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–


### 7.1 Loading çŠ¶æ€ç®¡ç†


**â³ å‹å¥½çš„åŠ è½½æç¤º**ï¼š
```javascript
// Loading çŠ¶æ€ç®¡ç†å™¨
class LoadingManager {
  constructor() {
    this.loadingCount = 0
  }
  
  show(message = 'åŠ è½½ä¸­...') {
    this.loadingCount++
    if (this.loadingCount === 1) {
      // æ˜¾ç¤º loading ç•Œé¢
      this.showLoading(message)
    }
  }
  
  hide() {
    this.loadingCount = Math.max(0, this.loadingCount - 1)
    if (this.loadingCount === 0) {
      // éšè— loading ç•Œé¢
      this.hideLoading()
    }
  }
  
  showLoading(message) {
    // åˆ›å»º loading å…ƒç´ 
    const loading = document.createElement('div')
    loading.id = 'global-loading'
    loading.innerHTML = `
      <div class="loading-content">
        <div class="spinner"></div>
        <p>${message}</p>
      </div>
    `
    document.body.appendChild(loading)
  }
  
  hideLoading() {
    const loading = document.getElementById('global-loading')
    if (loading) {
      loading.remove()
    }
  }
}

const loadingManager = new LoadingManager()
```

### 7.2 è¶…æ—¶é‡è¯•çš„ç”¨æˆ·æç¤º


**ğŸ’¬ ç»™ç”¨æˆ·æ¸…æ™°çš„åé¦ˆ**ï¼š
```javascript
// å¸¦ç”¨æˆ·æç¤ºçš„é‡è¯•è¯·æ±‚
async function userFriendlyRequest(url, config = {}) {
  const maxRetries = 3
  let attempt = 0
  
  loadingManager.show('æ­£åœ¨åŠ è½½æ•°æ®...')
  
  while (attempt < maxRetries) {
    try {
      const response = await axios.get(url, {
        timeout: 8000,
        ...config
      })
      
      loadingManager.hide()
      return response
      
    } catch (error) {
      attempt++
      
      if (error.code === 'ECONNABORTED') {
        if (attempt < maxRetries) {
          // æ›´æ–° loading æç¤º
          loadingManager.hide()
          loadingManager.show(`ç½‘ç»œè¾ƒæ…¢ï¼Œæ­£åœ¨é‡è¯• (${attempt}/${maxRetries})...`)
          
          await sleep(2000)
          continue
        } else {
          // é‡è¯•æ¬¡æ•°ç”¨å®Œ
          loadingManager.hide()
          showErrorMessage('ç½‘ç»œè¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•')
          throw error
        }
      } else {
        loadingManager.hide()
        showErrorMessage('è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•')
        throw error
      }
    }
  }
}

// é”™è¯¯æç¤ºå‡½æ•°
function showErrorMessage(message) {
  // åˆ›å»ºé”™è¯¯æç¤º
  const errorDiv = document.createElement('div')
  errorDiv.className = 'error-message'
  errorDiv.textContent = message
  document.body.appendChild(errorDiv)
  
  // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
  setTimeout(() => {
    errorDiv.remove()
  }, 3000)
}
```

### 7.3 è¿›åº¦åé¦ˆä¼˜åŒ–


**ğŸ“ˆ ç»™ç”¨æˆ·è¿›åº¦æ„ŸçŸ¥**ï¼š
```javascript
// å¸¦è¿›åº¦æç¤ºçš„è¯·æ±‚
async function requestWithProgress(url, config = {}, progressCallback) {
  const startTime = Date.now()
  
  // è®¾ç½®è¶…æ—¶å’Œé‡è¯•
  const requestConfig = {
    timeout: 10000,
    onUploadProgress: progressCallback,
    onDownloadProgress: progressCallback,
    ...config
  }
  
  try {
    const response = await axios.request({
      url,
      method: 'get',
      ...requestConfig
    })
    
    const duration = Date.now() - startTime
    console.log(`è¯·æ±‚å®Œæˆï¼Œè€—æ—¶: ${duration}ms`)
    
    return response
  } catch (error) {
    const duration = Date.now() - startTime
    console.log(`è¯·æ±‚å¤±è´¥ï¼Œè€—æ—¶: ${duration}ms`)
    throw error
  }
}

// ä½¿ç”¨ç¤ºä¾‹
requestWithProgress('/api/large-data', {}, (progress) => {
  const percent = Math.round((progress.loaded * 100) / progress.total)
  loadingManager.show(`åŠ è½½ä¸­... ${percent}%`)
})
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ è¶…æ—¶æ§åˆ¶æœ¬è´¨ï¼šç»™ç½‘ç»œè¯·æ±‚è®¾å®šæœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé˜²æ­¢é¡µé¢å¡æ­»
ğŸ”¸ è¶…æ—¶é…ç½®æ–¹æ³•ï¼štimeout å‚æ•°ï¼Œå•ä½æ¯«ç§’ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚æ—¶é—´
ğŸ”¸ è¶…æ—¶é”™è¯¯è¯†åˆ«ï¼šerror.code === 'ECONNABORTED' ä¸”åŒ…å« timeout
ğŸ”¸ é‡è¯•æœºåˆ¶æ„ä¹‰ï¼šç¬¬ä¸€æ¬¡å¤±è´¥ä¸ä»£è¡¨æ°¸è¿œå¤±è´¥ï¼Œæ™ºèƒ½é‡è¯•æå‡æˆåŠŸç‡
ğŸ”¸ ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼šLoading æç¤ºã€è¿›åº¦åé¦ˆã€å‹å¥½é”™è¯¯æç¤º
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¶…æ—¶æ—¶é—´çš„é€‰æ‹©åŸåˆ™**ï¼š
```
å¿«é€ŸæŸ¥è¯¢ï¼š3-5ç§’   (ç”¨æˆ·æœŸæœ›å¿«é€Ÿå“åº”)
è¡¨å•æäº¤ï¼š10-15ç§’ (æ¶‰åŠæ•°æ®å¤„ç†)
æ–‡ä»¶ä¸Šä¼ ï¼š30-60ç§’ (æ–‡ä»¶å¤§å°ä¸ç¡®å®š)
åå°åŒæ­¥ï¼šå¯ä»¥æ›´é•¿ (ç”¨æˆ·æ— æ„ŸçŸ¥)
```

**ğŸ”¹ é‡è¯•ç­–ç•¥çš„æ ¸å¿ƒæ€æƒ³**ï¼š
```
ä¸æ˜¯æ‰€æœ‰é”™è¯¯éƒ½è¦é‡è¯•ï¼š
âœ… ç½‘ç»œè¶…æ—¶ â†’ é‡è¯•æœ‰æ„ä¹‰
âœ… æœåŠ¡å™¨ä¸´æ—¶æ•…éšœ â†’ é‡è¯•æœ‰æ„ä¹‰  
âŒ å‚æ•°é”™è¯¯ â†’ é‡è¯•æ²¡æ„ä¹‰
âŒ æƒé™ä¸è¶³ â†’ é‡è¯•æ²¡æ„ä¹‰
```

**ğŸ”¹ æŒ‡æ•°é€€é¿çš„ä»·å€¼**ï¼š
```
é¿å…ç»™æœåŠ¡å™¨é€ æˆå‹åŠ›ï¼š
ç¬¬1æ¬¡é‡è¯•ï¼šç­‰1ç§’   (è½»å¾®å»¶è¿Ÿ)
ç¬¬2æ¬¡é‡è¯•ï¼šç­‰2ç§’   (ä¸­ç­‰å»¶è¿Ÿ)  
ç¬¬3æ¬¡é‡è¯•ï¼šç­‰4ç§’   (è¾ƒé•¿å»¶è¿Ÿ)

æ—¢ä¿è¯äº†é‡è¯•æœºä¼šï¼Œåˆä¿æŠ¤äº†æœåŠ¡å™¨
```

### 8.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ¯ å®ç”¨é…ç½®æ¨¡æ¿**ï¼š
```javascript
// æ¨èçš„é…ç½®æ¨¡æ¿
const axiosConfig = {
  // åŸºç¡€è¶…æ—¶ï¼š8ç§’ (è¦†ç›–å¤§éƒ¨åˆ†åœºæ™¯)
  timeout: 8000,
  
  // é‡è¯•é…ç½®
  retry: {
    maxRetries: 3,
    delay: 1000,
    useExponentialBackoff: true
  },
  
  // ç”¨æˆ·ä½“éªŒ
  showLoading: true,
  loadingMessage: 'åŠ è½½ä¸­...',
  errorMessage: 'è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
}
```

**ğŸ”§ å¼€å‘å®è·µè¦ç‚¹**ï¼š
- **æµ‹è¯•ä¸åŒç½‘ç»œç¯å¢ƒ**ï¼šWiFiã€4Gã€å¼±ç½‘ä¸‹çš„è¡¨ç°
- **ç›‘æ§è¶…æ—¶ç‡**ï¼šå¦‚æœè¶…æ—¶ç‡è¿‡é«˜ï¼Œè€ƒè™‘ä¼˜åŒ–æœåŠ¡å™¨æˆ–å¢åŠ è¶…æ—¶æ—¶é—´
- **ç”¨æˆ·åé¦ˆæ”¶é›†**ï¼šäº†è§£ç”¨æˆ·åœ¨ä»€ä¹ˆæƒ…å†µä¸‹é‡åˆ°è¶…æ—¶é—®é¢˜
- **æ¸è¿›å¼é‡è¯•**ï¼šä»ç®€å•é‡è¯•å¼€å§‹ï¼Œé€æ­¥ä¼˜åŒ–ä¸ºæ™ºèƒ½é‡è¯•

**æ ¸å¿ƒè®°å¿†**ï¼š
- è¶…æ—¶æ§åˆ¶é˜²å¡æ­»ï¼Œæ—¶é—´è®¾ç½®è¦åˆç†
- é‡è¯•æœºåˆ¶ææˆåŠŸç‡ï¼ŒæŒ‡æ•°é€€é¿æŠ¤æœåŠ¡å™¨
- ç”¨æˆ·ä½“éªŒæ˜¯å…³é”®ï¼ŒLoading æç¤ºè¦å‹å¥½
- ç½‘ç»œæ£€æµ‹åŠ©å†³ç­–ï¼Œæ™ºèƒ½é€‚é…ç”¨æˆ·çˆ½