---
title: 1、Axios实例创建与管理
---
## 📚 目录

1. [什么是Axios实例](#1-什么是Axios实例)
2. [为什么要创建实例](#2-为什么要创建实例)
3. [创建实例的基本方法](#3-创建实例的基本方法)
4. [实例配置详解](#4-实例配置详解)
5. [多服务场景管理](#5-多服务场景管理)
6. [配置优先级关系](#6-配置优先级关系)
7. [项目中的实例管理](#7-项目中的实例管理)
8. [核心要点总结](#8-核心要点总结)

---

## 1. 🤔 什么是Axios实例


### 1.1 实例的通俗理解


想象一下，你家里有**多把钥匙**：
- 🏠 **家门钥匙** - 只能开家门
- 🚗 **车钥匙** - 只能开车门
- 🏢 **办公室钥匙** - 只能开办公室

**Axios实例就像这些钥匙**，每个实例都有自己专门的"用途"和"配置"。

```
全局axios（万能钥匙）:
  ├─ 所有请求都用同一套配置
  └─ 不够灵活，容易混乱

Axios实例（专用钥匙）:
  ├─ 用户API实例 - 专门处理用户相关请求
  ├─ 后台API实例 - 专门处理管理后台请求  
  └─ 第三方API实例 - 专门处理外部服务请求
```

### 1.2 实例与全局axios的区别


> 💡 **简单理解**：
> - **全局axios** = 一把万能钥匙，什么门都能开，但不够专业
> - **axios实例** = 专门的钥匙，每把钥匙都有自己的特殊功能

```javascript
// 全局axios - 万能钥匙
import axios from 'axios'
axios.get('/api/users')  // 用全局配置

// axios实例 - 专用钥匙  
const userAPI = axios.create({
  baseURL: 'https://api.myapp.com'
})
userAPI.get('/users')  // 用实例专门配置
```

---

## 2. 🎯 为什么要创建实例


### 2.1 现实开发中的问题


假设你在开发一个**电商网站**，需要调用：

```
┌─ 用户相关API ──────────────────┐
│ 地址: https://user.shop.com    │
│ 需要: 用户登录token           │
│ 超时: 5秒                    │
└─────────────────────────────────┘

┌─ 商品相关API ──────────────────┐  
│ 地址: https://product.shop.com │
│ 需要: 商户认证key             │
│ 超时: 10秒                   │
└─────────────────────────────────┘

┌─ 支付相关API ──────────────────┐
│ 地址: https://pay.thirdparty.com │  
│ 需要: 支付平台密钥            │
│ 超时: 30秒                   │
└─────────────────────────────────┘
```

**如果用全局axios**：
```javascript
// 😵 每次请求都要重复配置，很麻烦
axios.get('https://user.shop.com/profile', {
  headers: { 'Authorization': 'Bearer usertoken' },
  timeout: 5000
})

axios.get('https://product.shop.com/list', {
  headers: { 'X-API-Key': 'merchantkey' },
  timeout: 10000  
})
```

### 2.2 使用实例的好处


**🔸 统一配置**：同类请求用相同配置
**🔸 代码简洁**：不用每次重复写配置
**🔸 维护方便**：修改配置只需要改一个地方
**🔸 逻辑清晰**：不同业务分开管理

> 📖 **生活类比**：
> 就像你的衣柜分门别类：**工作服**放一起，**运动服**放一起，**休闲服**放一起。
> 找衣服时一目了然，管理起来也方便。

---

## 3. 🛠️ 创建实例的基本方法


### 3.1 基础语法


```javascript
// 最简单的创建方式
const api = axios.create()

// 带配置的创建方式
const api = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 5000
})
```

### 3.2 创建过程详解


```
创建实例的过程：
┌─────────────────────────────────────┐
│  1. 调用 axios.create()             │
│  2. 传入配置对象 (可选)              │  
│  3. 返回新的axios实例               │
│  4. 实例继承全局默认配置             │
│  5. 实例配置覆盖默认配置             │
└─────────────────────────────────────┘
```

### 3.3 实例创建示例


```javascript
// 📁 api/userAPI.js - 用户API实例
const userAPI = axios.create({
  baseURL: 'https://user.myapp.com',    // 基础地址
  timeout: 5000,                       // 5秒超时
  headers: {                           // 默认请求头
    'Content-Type': 'application/json'
  }
})

// 使用实例发请求
userAPI.get('/profile')           // 实际请求: https://user.myapp.com/profile
userAPI.post('/login', userData)  // 实际请求: https://user.myapp.com/login
```

> 💡 **理解要点**：
> 创建实例就像给axios装上了**专门的配置包**，让它专门服务某个特定场景。

---

## 4. ⚙️ 实例配置详解


### 4.1 基础URL配置 (baseURL)


**baseURL的作用**：为所有请求设置**共同的前缀地址**

```javascript
const api = axios.create({
  baseURL: 'https://api.myapp.com/v1'
})

// 请求会自动拼接baseURL
api.get('/users')        // → https://api.myapp.com/v1/users
api.post('/users')       // → https://api.myapp.com/v1/users  
api.delete('/users/123') // → https://api.myapp.com/v1/users/123
```

**💡 生活类比**：
baseURL就像你的**家庭住址**，比如"北京市朝阳区某某小区"。
当你要寄快递时，只需要说"3号楼501室"，快递员就知道完整地址了。

### 4.2 默认请求头 (headers)


**请求头的作用**：告诉服务器一些**额外信息**

```javascript
const api = axios.create({
  baseURL: 'https://api.myapp.com',
  headers: {
    'Content-Type': 'application/json',      // 告诉服务器：我发的是JSON数据
    'Authorization': 'Bearer your-token',    // 告诉服务器：我是谁，有权限吗
    'Accept': 'application/json'             // 告诉服务器：我希望收到JSON数据
  }
})
```

**常用请求头说明**：

| 请求头 | 作用 | 通俗理解 |
|--------|------|----------|
| `Content-Type` | 说明发送数据的格式 | 📦 "包裹里装的是什么" |
| `Authorization` | 身份认证信息 | 🆔 "我的身份证" |
| `Accept` | 希望接收的数据格式 | 📬 "我希望收到什么格式的回复" |

### 4.3 超时配置 (timeout)


**超时的作用**：设置请求的**最长等待时间**

```javascript
const api = axios.create({
  timeout: 10000  // 10秒超时
})

// 如果服务器10秒内没有响应，就自动取消请求
api.get('/slow-api')  // 最多等10秒
```

> 📞 **生活类比**：
> 就像打电话，如果对方10秒内不接，你就挂断电话。
> 不会一直等下去，避免程序卡死。

### 4.4 完整配置示例


```javascript
// 📁 api/config.js - 完整的实例配置
const apiClient = axios.create({
  baseURL: 'https://api.myapp.com/v1',     // 基础地址
  timeout: 15000,                         // 15秒超时
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'X-Requested-With': 'XMLHttpRequest'   // 标识这是Ajax请求
  },
  validateStatus: (status) => {            // 自定义成功状态码范围
    return status >= 200 && status < 300   // 只有2xx才算成功
  }
})
```

---

## 5. 🏢 多服务场景管理


### 5.1 实际项目架构


现代项目通常需要调用**多个不同的服务**：

```
项目架构图：
┌─ 前端应用 ─────────────────────────┐
│                                   │
│  ┌─ 用户服务API ──────────────────┐ │
│  │ user.api.com                  │ │
│  │ - 登录注册                    │ │  
│  │ - 个人信息                    │ │
│  └───────────────────────────────┘ │
│                                   │
│  ┌─ 业务服务API ──────────────────┐ │
│  │ business.api.com              │ │
│  │ - 商品管理                    │ │
│  │ - 订单处理                    │ │  
│  └───────────────────────────────┘ │
│                                   │
│  ┌─ 第三方服务API ─────────────────┐ │
│  │ external.service.com          │ │
│  │ - 支付接口                    │ │
│  │ - 物流查询                    │ │
│  └───────────────────────────────┘ │
└───────────────────────────────────┘
```

### 5.2 多实例创建策略


```javascript
// 📁 api/instances.js - 多服务实例管理

// 🔸 用户服务实例
export const userAPI = axios.create({
  baseURL: 'https://user.api.com/v1',
  timeout: 5000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 🔸 业务服务实例  
export const businessAPI = axios.create({
  baseURL: 'https://business.api.com/v2',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
    'X-Business-Key': process.env.BUSINESS_API_KEY
  }
})

// 🔸 第三方服务实例
export const externalAPI = axios.create({
  baseURL: 'https://external.service.com',
  timeout: 30000,  // 第三方服务可能较慢，设置30秒
  headers: {
    'Authorization': `Bearer ${process.env.EXTERNAL_TOKEN}`
  }
})
```

### 5.3 实际使用场景


```javascript
// 📁 services/userService.js - 用户相关接口
import { userAPI } from '@/api/instances'

export const userService = {
  // 登录
  login(credentials) {
    return userAPI.post('/auth/login', credentials)
  },
  
  // 获取用户信息
  getProfile() {
    return userAPI.get('/user/profile')
  }
}

// 📁 services/businessService.js - 业务相关接口  
import { businessAPI } from '@/api/instances'

export const businessService = {
  // 获取商品列表
  getProducts() {
    return businessAPI.get('/products')
  },
  
  // 创建订单
  createOrder(orderData) {
    return businessAPI.post('/orders', orderData)
  }
}
```

> 💡 **管理技巧**：
> 把不同服务的实例分开创建，就像把不同的工具放在不同的工具箱里。
> 用的时候直接拿对应的工具箱，既清晰又高效。

---

## 6. 📊 配置优先级关系


### 6.1 配置覆盖规则


Axios的配置有**三个层级**，优先级从高到低：

```
配置优先级（高 → 低）：
┌─ 1. 请求时配置 ─────────────────┐
│   api.get('/users', { timeout: 3000 }) │  ← 最高优先级
└─────────────────────────────────────┘
           ↓ 覆盖
┌─ 2. 实例配置 ───────────────────┐
│   axios.create({ timeout: 5000 })    │  ← 中等优先级  
└─────────────────────────────────────┘
           ↓ 覆盖
┌─ 3. 全局默认配置 ────────────────┐
│   axios.defaults.timeout = 10000     │  ← 最低优先级
└─────────────────────────────────────┘
```

### 6.2 优先级示例


```javascript
// 设置全局默认配置
axios.defaults.timeout = 10000
axios.defaults.baseURL = 'https://global.api.com'

// 创建实例配置
const api = axios.create({
  timeout: 5000,                    // 覆盖全局的10000  
  baseURL: 'https://instance.api.com' // 覆盖全局baseURL
})

// 请求时配置
api.get('/users', {
  timeout: 3000  // 最终使用3000，覆盖实例的5000
})
```

**最终生效的配置**：
- ✅ `timeout: 3000` (请求时配置)
- ✅ `baseURL: 'https://instance.api.com'` (实例配置)

> 📚 **记忆技巧**：
> 就像穿衣服一样，**最外层的最显眼**。
> 请求时配置是最外层，所以优先级最高。

### 6.3 配置合并规则


不同类型的配置有不同的合并方式：

```javascript
// 🔸 简单值：直接覆盖
全局: { timeout: 10000 }
实例: { timeout: 5000 }
结果: { timeout: 5000 }  // 实例覆盖全局

// 🔸 对象值：合并属性
全局: { headers: { 'Accept': 'application/json' } }
实例: { headers: { 'Authorization': 'Bearer token' } }  
结果: { 
  headers: { 
    'Accept': 'application/json',      // 保留全局
    'Authorization': 'Bearer token'    // 添加实例
  } 
}
```

---

## 7. 🗂️ 项目中的实例管理


### 7.1 推荐的文件结构


```
src/
├── api/
│   ├── config.js          # 基础配置和常量
│   ├── instances.js       # 实例创建和配置
│   ├── interceptors.js    # 拦截器配置
│   └── services/          # 具体业务接口
│       ├── userService.js
│       ├── productService.js
│       └── orderService.js
└── utils/
    └── request.js         # 请求工具函数
```

### 7.2 配置文件示例


```javascript
// 📁 api/config.js - 基础配置
export const API_CONFIG = {
  USER_API: {
    baseURL: process.env.VUE_APP_USER_API || 'https://user.api.dev',
    timeout: 5000
  },
  BUSINESS_API: {
    baseURL: process.env.VUE_APP_BUSINESS_API || 'https://business.api.dev', 
    timeout: 10000
  }
}

// 📁 api/instances.js - 实例管理
import { API_CONFIG } from './config'

// 用户API实例
export const userAPI = axios.create(API_CONFIG.USER_API)

// 业务API实例
export const businessAPI = axios.create(API_CONFIG.BUSINESS_API)

// 实例配置后处理
userAPI.interceptors.request.use(config => {
  // 自动添加用户token
  const token = localStorage.getItem('userToken')
  if (token) {
    config.headers.Authorization = `Bearer ${token}`
  }
  return config
})
```

### 7.3 使用最佳实践


**🔸 命名规范**：
```javascript
// ✅ 好的命名 - 一眼就知道用途
const userAPI = axios.create(...)      // 用户相关
const adminAPI = axios.create(...)     // 管理后台
const paymentAPI = axios.create(...)   // 支付相关

// ❌ 不好的命名 - 不知道干什么用的
const api1 = axios.create(...)
const request = axios.create(...)
const http = axios.create(...)
```

**🔸 环境配置**：
```javascript
// 根据环境使用不同的API地址
const baseURL = {
  development: 'https://api-dev.myapp.com',
  testing: 'https://api-test.myapp.com', 
  production: 'https://api.myapp.com'
}[process.env.NODE_ENV]

const api = axios.create({ baseURL })
```

---

## 8. 📋 核心要点总结


### 8.1 必须掌握的核心概念


```
🔸 实例本质：专门配置的axios，就像专用工具
🔸 创建方法：axios.create(config) 
🔸 核心优势：统一配置、代码简洁、维护方便
🔸 配置优先级：请求配置 > 实例配置 > 全局配置
🔸 多实例管理：不同服务用不同实例
```

### 8.2 关键理解要点


> 💡 **为什么要用实例？**
> 
> 想象你是一个**快递员**：
> - 如果每次送快递都要重新查地址、重新确认收件人，会很麻烦
> - 如果给每个**固定路线**准备一套**专门信息**，就高效多了
> 
> axios实例就是这样的**专门信息包**，让相同类型的请求更高效。

**🔹 什么时候创建实例？**
```
✅ 需要调用多个不同的API服务
✅ 不同请求需要不同的基础配置  
✅ 需要统一管理某类请求的配置
✅ 项目规模较大，需要清晰的结构

❌ 只有一个API服务，配置都相同
❌ 项目很小，几个请求而已
❌ 学习阶段，还没搞清楚基础用法
```

**🔹 实例 vs 全局axios选择**
```
实例适合：
- 🏢 企业级项目 - 多服务调用
- 🔧 需要不同配置 - 灵活管理
- 👥 团队开发 - 职责分离

全局axios适合：
- 🏠 个人小项目 - 简单直接
- 📚 学习阶段 - 专注基础
- ⚡ 快速原型 - 不考虑复杂性
```

### 8.3 实际应用指导


**🎯 实例创建建议**：
1. **先理解需求** - 有几个不同的API服务？
2. **分析配置差异** - 不同服务需要什么不同配置？
3. **合理命名** - 让团队一眼就知道实例用途
4. **统一管理** - 把实例集中在一个文件里创建

**🔧 常见使用模式**：
```javascript
// 模式1：按服务类型分实例
const userAPI = axios.create({...})    // 用户服务
const orderAPI = axios.create({...})   // 订单服务

// 模式2：按环境分实例  
const devAPI = axios.create({...})     // 开发环境
const prodAPI = axios.create({...})    // 生产环境

// 模式3：按权限分实例
const publicAPI = axios.create({...})  // 公开接口
const authAPI = axios.create({...})    // 需要认证的接口
```

**核心记忆**：
- 实例就是**专门配置的axios工具**
- **一个服务一个实例**，配置清晰不混乱
- **请求配置优先级最高**，实例配置其次
- **合理命名和组织**，让代码易懂易维护