---
title: 3ã€Ajaxé˜²æŠ–èŠ‚æµä¸é«˜é¢‘ä¼˜åŒ–
---
## ğŸ“š ç›®å½•

1. [é˜²æŠ–ä¸èŠ‚æµçš„åŸºæœ¬æ¦‚å¿µ](#1-é˜²æŠ–ä¸èŠ‚æµçš„åŸºæœ¬æ¦‚å¿µ)
2. [é˜²æŠ–(Debounce)è¯¦è§£](#2-é˜²æŠ–debounceè¯¦è§£)
3. [èŠ‚æµ(Throttle)è¯¦è§£](#3-èŠ‚æµthrottleè¯¦è§£)
4. [Ajaxä¸­çš„å®é™…åº”ç”¨åœºæ™¯](#4-ajaxä¸­çš„å®é™…åº”ç”¨åœºæ™¯)
5. [é«˜é¢‘è¯·æ±‚ä¼˜åŒ–ç­–ç•¥](#5-é«˜é¢‘è¯·æ±‚ä¼˜åŒ–ç­–ç•¥)
6. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#6-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¤” é˜²æŠ–ä¸èŠ‚æµçš„åŸºæœ¬æ¦‚å¿µ


### 1.1 ä¸ºä»€ä¹ˆéœ€è¦é˜²æŠ–å’ŒèŠ‚æµï¼Ÿ


**ç°å®ç”Ÿæ´»ä¸­çš„ç±»æ¯”**ï¼š
```
æƒ³è±¡ä½ åœ¨ç”µæ¢¯é‡ŒæŒ‰æ¥¼å±‚æŒ‰é’®ï¼š

âŒ æ²¡æœ‰é˜²æŠ–ï¼š
æ¯æŒ‰ä¸€æ¬¡æŒ‰é’®ï¼Œç”µæ¢¯å°±æ‰§è¡Œä¸€æ¬¡æ“ä½œ
è¿ç»­æŒ‰5æ¬¡ï¼Œç”µæ¢¯å°±è¦æ‰§è¡Œ5æ¬¡ â†’ æµªè´¹èµ„æº

âœ… æœ‰äº†é˜²æŠ–ï¼š
ç­‰ä½ åœæ­¢æŒ‰æŒ‰é’®ä¸€æ®µæ—¶é—´åï¼Œç”µæ¢¯æ‰æ‰§è¡Œæœ€åä¸€æ¬¡æ“ä½œ
è¿ç»­æŒ‰5æ¬¡ï¼Œæœ€ç»ˆåªæ‰§è¡Œ1æ¬¡ â†’ èŠ‚çœèµ„æº
```

**åœ¨Ajaxä¸­çš„é—®é¢˜**ï¼š
```
ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥"JavaScript"ï¼š

âŒ æ²¡æœ‰ä¼˜åŒ–ï¼š
è¾“å…¥"J" â†’ å‘é€è¯·æ±‚
è¾“å…¥"a" â†’ å‘é€è¯·æ±‚  
è¾“å…¥"v" â†’ å‘é€è¯·æ±‚
...
æ€»å…±å‘é€10æ¬¡è¯·æ±‚ï¼

âœ… æœ‰äº†é˜²æŠ–ï¼š
ç”¨æˆ·åœæ­¢è¾“å…¥500msåï¼Œæ‰å‘é€1æ¬¡è¯·æ±‚
èŠ‚çœäº†9æ¬¡æ— ç”¨çš„ç½‘ç»œè¯·æ±‚
```

### 1.2 é˜²æŠ–ä¸èŠ‚æµçš„æ ¸å¿ƒåŒºåˆ«


```
é˜²æŠ–(Debounce) - "ç­‰ç­‰å†è¯´"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ“ä½œ: â– â– â– â– â–      (åœæ­¢)         â”‚
â”‚ æ‰§è¡Œæƒ…å†µ:           âœ“              â”‚
â”‚ è¯´æ˜: åªåœ¨æœ€åæ‰§è¡Œä¸€æ¬¡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èŠ‚æµ(Throttle) - "å®šæ—¶æ‰§è¡Œ"  
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ“ä½œ: â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–   â”‚
â”‚ æ‰§è¡Œæƒ…å†µ: âœ“     âœ“     âœ“     âœ“     â”‚
â”‚ è¯´æ˜: æ¯éš”å›ºå®šæ—¶é—´æ‰§è¡Œä¸€æ¬¡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç®€å•è®°å¿†**ï¼š
- **é˜²æŠ–**ï¼šç”µæ¢¯é—¨ï¼Œç­‰äººéƒ½è¿›æ¥äº†å†å…³é—¨
- **èŠ‚æµ**ï¼šåœ°é“å‘è½¦ï¼Œæ¯5åˆ†é’Ÿå‘ä¸€ç­ï¼Œä¸ç®¡äººå¤šå°‘

---

## 2. ğŸ›¡ï¸ é˜²æŠ–(Debounce)è¯¦è§£


### 2.1 é˜²æŠ–çš„å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šåœ¨äº‹ä»¶è¢«è§¦å‘åï¼Œå»¶è¿Ÿæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å¦‚æœåœ¨å»¶è¿ŸæœŸé—´äº‹ä»¶å†æ¬¡è¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡ç®—å»¶è¿Ÿæ—¶é—´ã€‚

```
æ—¶é—´è½´ç¤ºä¾‹ï¼š
0ms    100ms   200ms   300ms   500ms   800ms
 |       |       |       |       |       |
è§¦å‘    è§¦å‘    è§¦å‘     ç­‰å¾…     ç­‰å¾…    æ‰§è¡Œâœ“
 â†“       â†“       â†“       â†“       â†“       â†“
å–æ¶ˆ    å–æ¶ˆ    è®¾ç½®     è®¡æ—¶     è®¡æ—¶    è¿è¡Œ
                300ms   ä¸­...    ä¸­...   å‡½æ•°
                å»¶è¿Ÿ
```

### 2.2 ç®€å•çš„é˜²æŠ–å®ç°


```javascript
// ğŸ”§ åŸºç¡€é˜²æŠ–å‡½æ•°
function debounce(func, delay) {
    let timeoutId = null;
    
    return function(...args) {
        // å¦‚æœå·²æœ‰å®šæ—¶å™¨ï¼Œå…ˆæ¸…é™¤
        if (timeoutId) {
            clearTimeout(timeoutId);
        }
        
        // è®¾ç½®æ–°çš„å®šæ—¶å™¨
        timeoutId = setTimeout(() => {
            func.apply(this, args);
        }, delay);
    };
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// åŸå§‹çš„æœç´¢å‡½æ•°
function searchAPI(keyword) {
    console.log('å‘é€Ajaxè¯·æ±‚:', keyword);
    // è¿™é‡Œæ˜¯å®é™…çš„Ajaxè¯·æ±‚
}

// åŒ…è£…æˆé˜²æŠ–ç‰ˆæœ¬
const debouncedSearch = debounce(searchAPI, 300);

// ç»‘å®šåˆ°è¾“å…¥æ¡†
document.getElementById('search').addEventListener('input', function(e) {
    debouncedSearch(e.target.value);
});
```

### 2.3 é˜²æŠ–åœ¨æœç´¢å»ºè®®ä¸­çš„åº”ç”¨


```javascript
// ğŸ” å®é™…çš„æœç´¢å»ºè®®åŠŸèƒ½
function createSearchSuggestion() {
    const searchInput = document.getElementById('search');
    const suggestionList = document.getElementById('suggestions');
    
    // æœç´¢å‡½æ•°
    function fetchSuggestions(keyword) {
        if (!keyword.trim()) {
            suggestionList.innerHTML = '';
            return;
        }
        
        // Ajaxè¯·æ±‚è·å–å»ºè®®
        fetch(`/api/search/suggestions?q=${keyword}`)
            .then(response => response.json())
            .then(data => {
                displaySuggestions(data);
            });
    }
    
    // æ˜¾ç¤ºå»ºè®®åˆ—è¡¨
    function displaySuggestions(suggestions) {
        suggestionList.innerHTML = suggestions
            .map(item => `<li>${item}</li>`)
            .join('');
    }
    
    // ä½¿ç”¨é˜²æŠ–ï¼Œç”¨æˆ·åœæ­¢è¾“å…¥300msåæ‰æœç´¢
    const debouncedFetch = debounce(fetchSuggestions, 300);
    
    searchInput.addEventListener('input', (e) => {
        debouncedFetch(e.target.value);
    });
}
```

**æ•ˆæœå¯¹æ¯”**ï¼š
```
âŒ æ— é˜²æŠ–ï¼šç”¨æˆ·è¾“å…¥"å‰ç«¯"
è¾“å…¥"å‰" â†’ è¯·æ±‚1
è¾“å…¥"ç«¯" â†’ è¯·æ±‚2
æ€»è¯·æ±‚ï¼š2æ¬¡

âœ… æœ‰é˜²æŠ–ï¼šç”¨æˆ·è¾“å…¥"å‰ç«¯"  
è¾“å…¥"å‰" â†’ ç­‰å¾…...
è¾“å…¥"ç«¯" â†’ ç­‰å¾…...
åœæ­¢è¾“å…¥300ms â†’ è¯·æ±‚1
æ€»è¯·æ±‚ï¼š1æ¬¡
```

---

## 3. â±ï¸ èŠ‚æµ(Throttle)è¯¦è§£


### 3.1 èŠ‚æµçš„å·¥ä½œåŸç†


**æ ¸å¿ƒæ€æƒ³**ï¼šé™åˆ¶å‡½æ•°åœ¨æŒ‡å®šæ—¶é—´å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿äº‹ä»¶è¢«é¢‘ç¹è§¦å‘ã€‚

```
æ—¶é—´è½´ç¤ºä¾‹ï¼š
0ms    100ms   200ms   300ms   400ms   500ms
 |       |       |       |       |       |
è§¦å‘    è§¦å‘    è§¦å‘    è§¦å‘    è§¦å‘    è§¦å‘
 â†“       â†“       â†“       â†“       â†“       â†“  
æ‰§è¡Œâœ“   å¿½ç•¥    å¿½ç•¥    æ‰§è¡Œâœ“   å¿½ç•¥    å¿½ç•¥
(è®¾ç½®    (å†·å´   (å†·å´   (è®¾ç½®   (å†·å´   (å†·å´
300ms   æœŸé—´)   æœŸé—´)   300ms   æœŸé—´)   æœŸé—´)
å†·å´)                   å†·å´)
```

### 3.2 ç®€å•çš„èŠ‚æµå®ç°


```javascript
// â° åŸºç¡€èŠ‚æµå‡½æ•°
function throttle(func, delay) {
    let lastTime = 0;
    
    return function(...args) {
        const now = Date.now();
        
        // å¦‚æœè·ç¦»ä¸Šæ¬¡æ‰§è¡Œå·²ç»è¶…è¿‡å»¶è¿Ÿæ—¶é—´
        if (now - lastTime >= delay) {
            lastTime = now;
            func.apply(this, args);
        }
    };
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```javascript
// æ»šåŠ¨åŠ è½½æ•°æ®çš„å‡½æ•°
function loadMoreData() {
    console.log('åŠ è½½æ›´å¤šæ•°æ®...');
    // Ajaxè¯·æ±‚åŠ è½½æ•°æ®
    fetch('/api/data/more')
        .then(response => response.json())
        .then(data => {
            appendData(data);
        });
}

// åŒ…è£…æˆèŠ‚æµç‰ˆæœ¬ - æ¯500msæœ€å¤šæ‰§è¡Œä¸€æ¬¡
const throttledLoad = throttle(loadMoreData, 500);

// ç»‘å®šåˆ°æ»šåŠ¨äº‹ä»¶
window.addEventListener('scroll', function() {
    // æ£€æŸ¥æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
        throttledLoad();
    }
});
```

### 3.3 èŠ‚æµåœ¨æ»šåŠ¨åŠ è½½ä¸­çš„åº”ç”¨


```javascript
// ğŸ“œ å®Œæ•´çš„æ»šåŠ¨åŠ è½½åŠŸèƒ½
class InfiniteScroll {
    constructor() {
        this.loading = false;
        this.hasMore = true;
        this.page = 1;
        
        this.init();
    }
    
    // æ£€æŸ¥æ˜¯å¦éœ€è¦åŠ è½½æ›´å¤š
    checkLoadMore() {
        // å¦‚æœæ­£åœ¨åŠ è½½æˆ–æ²¡æœ‰æ›´å¤šæ•°æ®ï¼Œç›´æ¥è¿”å›
        if (this.loading || !this.hasMore) return;
        
        // è®¡ç®—æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨é™„è¿‘
        const scrollTop = window.pageYOffset;
        const windowHeight = window.innerHeight;
        const docHeight = document.documentElement.scrollHeight;
        
        if (scrollTop + windowHeight >= docHeight - 200) {
            this.loadMore();
        }
    }
    
    // åŠ è½½æ›´å¤šæ•°æ®
    async loadMore() {
        this.loading = true;
        
        try {
            const response = await fetch(`/api/posts?page=${this.page}`);
            const data = await response.json();
            
            if (data.posts.length === 0) {
                this.hasMore = false;
            } else {
                this.appendPosts(data.posts);
                this.page++;
            }
        } catch (error) {
            console.error('åŠ è½½å¤±è´¥:', error);
        } finally {
            this.loading = false;
        }
    }
    
    appendPosts(posts) {
        const container = document.getElementById('posts-container');
        posts.forEach(post => {
            const div = document.createElement('div');
            div.innerHTML = `<h3>${post.title}</h3><p>${post.content}</p>`;
            container.appendChild(div);
        });
    }
    
    init() {
        // ä½¿ç”¨èŠ‚æµï¼Œæ¯200msæœ€å¤šæ£€æŸ¥ä¸€æ¬¡
        const throttledCheck = throttle(() => this.checkLoadMore(), 200);
        window.addEventListener('scroll', throttledCheck);
    }
}

// åˆå§‹åŒ–
new InfiniteScroll();
```

---

## 4. ğŸ¯ Ajaxä¸­çš„å®é™…åº”ç”¨åœºæ™¯


### 4.1 é˜²æŠ–çš„å…¸å‹åº”ç”¨


**ğŸ” 1. æœç´¢å»ºè®®**
```javascript
// ç”¨æˆ·è¾“å…¥æ—¶çš„æœç´¢å»ºè®®
const searchBox = document.getElementById('search');

const getSearchSuggestions = debounce(async (keyword) => {
    if (keyword.length < 2) return; // è‡³å°‘2ä¸ªå­—ç¬¦æ‰æœç´¢
    
    try {
        const response = await fetch(`/api/search?q=${keyword}`);
        const suggestions = await response.json();
        showSuggestions(suggestions);
    } catch (error) {
        console.error('æœç´¢å»ºè®®è·å–å¤±è´¥:', error);
    }
}, 300);

searchBox.addEventListener('input', e => {
    getSearchSuggestions(e.target.value);
});
```

**ğŸ’¾ 2. è‡ªåŠ¨ä¿å­˜**
```javascript
// ç”¨æˆ·ç¼–è¾‘å†…å®¹æ—¶çš„è‡ªåŠ¨ä¿å­˜
const editor = document.getElementById('editor');

const autoSave = debounce(async (content) => {
    try {
        await fetch('/api/save', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content })
        });
        showMessage('å·²è‡ªåŠ¨ä¿å­˜');
    } catch (error) {
        showMessage('ä¿å­˜å¤±è´¥');
    }
}, 2000); // åœæ­¢ç¼–è¾‘2ç§’åä¿å­˜

editor.addEventListener('input', e => {
    autoSave(e.target.value);
});
```

### 4.2 èŠ‚æµçš„å…¸å‹åº”ç”¨


**ğŸ“Š 1. å®æ—¶æ•°æ®æ›´æ–°**
```javascript
// è‚¡ç¥¨ä»·æ ¼å®æ—¶æ›´æ–°
const updateStockPrices = throttle(async () => {
    try {
        const response = await fetch('/api/stocks/prices');
        const prices = await response.json();
        updatePriceDisplay(prices);
    } catch (error) {
        console.error('ä»·æ ¼æ›´æ–°å¤±è´¥:', error);
    }
}, 1000); // æ¯ç§’æœ€å¤šæ›´æ–°ä¸€æ¬¡

// æ¯100mså°è¯•æ›´æ–°ï¼Œä½†å®é™…æ¯1000msæ‰æ‰§è¡Œ
setInterval(updateStockPrices, 100);
```

**ğŸ–±ï¸ 2. é¼ æ ‡ç§»åŠ¨è¿½è¸ª**
```javascript
// é¼ æ ‡ç§»åŠ¨æ—¶å‘é€ä½ç½®æ•°æ®
const trackMouseMove = throttle(async (x, y) => {
    fetch('/api/mouse-tracking', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ x, y, timestamp: Date.now() })
    });
}, 100); // æ¯100msæœ€å¤šå‘é€ä¸€æ¬¡

document.addEventListener('mousemove', e => {
    trackMouseMove(e.clientX, e.clientY);
});
```

### 4.3 é€‰æ‹©é˜²æŠ–è¿˜æ˜¯èŠ‚æµï¼Ÿ


| åœºæ™¯ | é€‰æ‹© | åŸå›  |
|------|------|------|
| **æœç´¢å»ºè®®** | `é˜²æŠ–` | ç”¨æˆ·åœæ­¢è¾“å…¥åæ‰éœ€è¦æœç´¢ç»“æœ |
| **è‡ªåŠ¨ä¿å­˜** | `é˜²æŠ–` | ç”¨æˆ·åœæ­¢ç¼–è¾‘åæ‰ä¿å­˜ï¼Œé¿å…é¢‘ç¹ä¿å­˜ |
| **æ»šåŠ¨åŠ è½½** | `èŠ‚æµ` | éœ€è¦æŒç»­æ£€æµ‹æ»šåŠ¨ä½ç½® |
| **å®æ—¶æ•°æ®** | `èŠ‚æµ` | éœ€è¦å®šæœŸæ›´æ–°ï¼Œä¿æŒæ•°æ®æ–°é²œåº¦ |
| **çª—å£è°ƒæ•´** | `èŠ‚æµ` | è°ƒæ•´è¿‡ç¨‹ä¸­éœ€è¦å“åº”ï¼Œä½†ä¸èƒ½å¤ªé¢‘ç¹ |
| **æŒ‰é’®ç‚¹å‡»** | `é˜²æŠ–` | é˜²æ­¢ç”¨æˆ·è¿ç»­ç‚¹å‡»å¯¼è‡´é‡å¤æäº¤ |

---

## 5. ğŸš€ é«˜é¢‘è¯·æ±‚ä¼˜åŒ–ç­–ç•¥


### 5.1 è¯·æ±‚é˜Ÿåˆ—ç®¡ç†


**é—®é¢˜**ï¼šç”¨æˆ·å¿«é€Ÿæ“ä½œå¯èƒ½äº§ç”Ÿå¤§é‡è¯·æ±‚ï¼Œéœ€è¦åˆç†ç®¡ç†ã€‚

```javascript
// ğŸ”„ è¯·æ±‚é˜Ÿåˆ—ç®¡ç†å™¨
class RequestQueue {
    constructor(maxConcurrent = 3) {
        this.maxConcurrent = maxConcurrent; // æœ€å¤§å¹¶å‘æ•°
        this.running = new Set(); // æ­£åœ¨æ‰§è¡Œçš„è¯·æ±‚
        this.waiting = []; // ç­‰å¾…é˜Ÿåˆ—
    }
    
    // æ·»åŠ è¯·æ±‚åˆ°é˜Ÿåˆ—
    async add(requestFn) {
        return new Promise((resolve, reject) => {
            this.waiting.push({
                request: requestFn,
                resolve,
                reject
            });
            this.process();
        });
    }
    
    // å¤„ç†é˜Ÿåˆ—
    async process() {
        if (this.running.size >= this.maxConcurrent || this.waiting.length === 0) {
            return;
        }
        
        const { request, resolve, reject } = this.waiting.shift();
        const requestPromise = request();
        
        this.running.add(requestPromise);
        
        try {
            const result = await requestPromise;
            resolve(result);
        } catch (error) {
            reject(error);
        } finally {
            this.running.delete(requestPromise);
            this.process(); // å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const queue = new RequestQueue(2); // æœ€å¤šåŒæ—¶2ä¸ªè¯·æ±‚

// æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
async function uploadFiles(files) {
    const uploadPromises = files.map(file => {
        return queue.add(() => uploadSingleFile(file));
    });
    
    try {
        const results = await Promise.all(uploadPromises);
        console.log('æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ:', results);
    } catch (error) {
        console.error('ä¸Šä¼ å¤±è´¥:', error);
    }
}

async function uploadSingleFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    
    const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData
    });
    
    return response.json();
}
```

### 5.2 è¯·æ±‚å»é‡


**é—®é¢˜**ï¼šç›¸åŒçš„è¯·æ±‚å¯èƒ½è¢«é‡å¤å‘é€ï¼Œæµªè´¹èµ„æºã€‚

```javascript
// ğŸ”’ è¯·æ±‚å»é‡ç®¡ç†å™¨
class RequestDeduplicator {
    constructor() {
        this.pendingRequests = new Map(); // å­˜å‚¨è¿›è¡Œä¸­çš„è¯·æ±‚
    }
    
    // ç”Ÿæˆè¯·æ±‚çš„å”¯ä¸€é”®
    generateKey(url, options = {}) {
        const key = url + JSON.stringify({
            method: options.method || 'GET',
            body: options.body || '',
            headers: options.headers || {}
        });
        return btoa(key); // base64ç¼–ç 
    }
    
    // å‘é€è¯·æ±‚ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
    async request(url, options = {}) {
        const key = this.generateKey(url, options);
        
        // å¦‚æœå·²æœ‰ç›¸åŒè¯·æ±‚åœ¨è¿›è¡Œä¸­ï¼Œè¿”å›è¯¥è¯·æ±‚çš„Promise
        if (this.pendingRequests.has(key)) {
            console.log('å¤ç”¨è¿›è¡Œä¸­çš„è¯·æ±‚:', url);
            return this.pendingRequests.get(key);
        }
        
        // åˆ›å»ºæ–°è¯·æ±‚
        const requestPromise = fetch(url, options)
            .then(response => response.json())
            .finally(() => {
                // è¯·æ±‚å®Œæˆåï¼Œä»mapä¸­ç§»é™¤
                this.pendingRequests.delete(key);
            });
        
        // å­˜å‚¨è¯·æ±‚Promise
        this.pendingRequests.set(key, requestPromise);
        
        return requestPromise;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const deduplicator = new RequestDeduplicator();

// å³ä½¿åŒæ—¶è°ƒç”¨å¤šæ¬¡ï¼Œå®é™…åªä¼šå‘é€ä¸€æ¬¡è¯·æ±‚
Promise.all([
    deduplicator.request('/api/user/profile'),
    deduplicator.request('/api/user/profile'),
    deduplicator.request('/api/user/profile')
]).then(results => {
    console.log('æ‰€æœ‰è¯·æ±‚å®Œæˆ:', results);
    // ä¸‰ä¸ªç»“æœéƒ½ç›¸åŒï¼Œä½†åªå‘é€äº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚
});
```

### 5.3 æ‰¹é‡è¯·æ±‚ä¼˜åŒ–


**é—®é¢˜**ï¼šå¤šä¸ªå°è¯·æ±‚å¯ä»¥åˆå¹¶æˆä¸€ä¸ªå¤§è¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚

```javascript
// ğŸ“¦ æ‰¹é‡è¯·æ±‚å¤„ç†å™¨
class BatchRequestProcessor {
    constructor(batchSize = 10, delay = 100) {
        this.batchSize = batchSize; // æ‰¹æ¬¡å¤§å°
        this.delay = delay; // ç­‰å¾…å»¶è¿Ÿ
        this.queue = []; // å¾…å¤„ç†é˜Ÿåˆ—
        this.timeoutId = null;
    }
    
    // æ·»åŠ å•ä¸ªè¯·æ±‚åˆ°æ‰¹æ¬¡
    add(id) {
        return new Promise((resolve, reject) => {
            this.queue.push({ id, resolve, reject });
            
            // å¦‚æœè¾¾åˆ°æ‰¹æ¬¡å¤§å°ï¼Œç«‹å³å¤„ç†
            if (this.queue.length >= this.batchSize) {
                this.processBatch();
            } else {
                // å¦åˆ™ç­‰å¾…ä¸€æ®µæ—¶é—´åå¤„ç†
                this.scheduleProcess();
            }
        });
    }
    
    // å®‰æ’æ‰¹æ¬¡å¤„ç†
    scheduleProcess() {
        if (this.timeoutId) {
            clearTimeout(this.timeoutId);
        }
        
        this.timeoutId = setTimeout(() => {
            this.processBatch();
        }, this.delay);
    }
    
    // å¤„ç†æ‰¹æ¬¡
    async processBatch() {
        if (this.queue.length === 0) return;
        
        const currentBatch = this.queue.splice(0);
        const ids = currentBatch.map(item => item.id);
        
        try {
            // å‘é€æ‰¹é‡è¯·æ±‚
            const response = await fetch('/api/batch/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ids })
            });
            
            const results = await response.json();
            
            // å°†ç»“æœåˆ†å‘ç»™å„ä¸ªPromise
            currentBatch.forEach(({ id, resolve }) => {
                const result = results.find(item => item.id === id);
                resolve(result);
            });
            
        } catch (error) {
            // å¦‚æœæ‰¹é‡è¯·æ±‚å¤±è´¥ï¼Œæ‰€æœ‰Promiseéƒ½reject
            currentBatch.forEach(({ reject }) => {
                reject(error);
            });
        }
        
        if (this.timeoutId) {
            clearTimeout(this.timeoutId);
            this.timeoutId = null;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const batchProcessor = new BatchRequestProcessor(5, 200);

// è·å–ç”¨æˆ·ä¿¡æ¯çš„å‡½æ•°
async function getUserInfo(userId) {
    return batchProcessor.add(userId);
}

// å³ä½¿è°ƒç”¨å¤šæ¬¡ï¼Œä¼šè‡ªåŠ¨åˆå¹¶æˆæ‰¹é‡è¯·æ±‚
async function loadUserProfiles() {
    try {
        const users = await Promise.all([
            getUserInfo(1),
            getUserInfo(2), 
            getUserInfo(3),
            getUserInfo(4),
            getUserInfo(5),
            getUserInfo(6) // è¿™äº›ä¼šè¢«åˆå¹¶æˆ1-2ä¸ªæ‰¹é‡è¯·æ±‚
        ]);
        
        console.log('ç”¨æˆ·ä¿¡æ¯:', users);
    } catch (error) {
        console.error('åŠ è½½å¤±è´¥:', error);
    }
}
```

---

## 6. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 6.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ é˜²æŠ–(Debounce)ï¼šç­‰æœ€åä¸€æ¬¡æ“ä½œç»“æŸåå†æ‰§è¡Œ
ğŸ”¸ èŠ‚æµ(Throttle)ï¼šå›ºå®šæ—¶é—´é—´éš”å†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡  
ğŸ”¸ åº”ç”¨åœºæ™¯ï¼šæœç´¢å»ºè®®ç”¨é˜²æŠ–ï¼Œæ»šåŠ¨äº‹ä»¶ç”¨èŠ‚æµ
ğŸ”¸ æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘æ— æ•ˆè¯·æ±‚ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ é˜Ÿåˆ—ç®¡ç†ï¼šæ§åˆ¶å¹¶å‘æ•°é‡ï¼Œé¿å…æœåŠ¡å™¨å‹åŠ›è¿‡å¤§
```

### 6.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ é˜²æŠ–vsèŠ‚æµçš„é€‰æ‹©æ ‡å‡†**
```
é˜²æŠ–é€‚ç”¨åœºæ™¯ï¼š
â€¢ ç”¨æˆ·åœæ­¢æ“ä½œåæ‰éœ€è¦å“åº”
â€¢ é¿å…ä¸­é—´çŠ¶æ€çš„æ— ç”¨è¯·æ±‚
â€¢ ä¾‹å¦‚ï¼šæœç´¢ã€è‡ªåŠ¨ä¿å­˜ã€æŒ‰é’®é˜²é‡å¤ç‚¹å‡»

èŠ‚æµé€‚ç”¨åœºæ™¯ï¼š  
â€¢ éœ€è¦æŒç»­å“åº”ç”¨æˆ·æ“ä½œ
â€¢ é™åˆ¶å“åº”é¢‘ç‡ä½†ä¸èƒ½å®Œå…¨åœæ­¢
â€¢ ä¾‹å¦‚ï¼šæ»šåŠ¨ç›‘å¬ã€å®æ—¶æ•°æ®æ›´æ–°ã€æ‹–æ‹½æ“ä½œ
```

**ğŸ”¹ é«˜é¢‘è¯·æ±‚ä¼˜åŒ–ç­–ç•¥**
```
è¯·æ±‚é˜Ÿåˆ—ï¼šæ§åˆ¶å¹¶å‘æ•°ï¼Œé¿å…æµè§ˆå™¨é™åˆ¶
è¯·æ±‚å»é‡ï¼šç›¸åŒè¯·æ±‚å¤ç”¨ç»“æœï¼ŒèŠ‚çœèµ„æº
æ‰¹é‡å¤„ç†ï¼šå¤šä¸ªå°è¯·æ±‚åˆå¹¶ï¼Œå‡å°‘ç½‘ç»œå¼€é”€
ç¼“å­˜æœºåˆ¶ï¼šé¿å…é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
```

### 6.3 å®é™…å¼€å‘å»ºè®®


**âš¡ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ**
```javascript
// 1. æœç´¢åŠŸèƒ½çš„å®Œæ•´ä¼˜åŒ–
const optimizedSearch = (() => {
    const cache = new Map();
    const deduplicator = new RequestDeduplicator();
    
    return debounce(async (keyword) => {
        // æ£€æŸ¥ç¼“å­˜
        if (cache.has(keyword)) {
            return cache.get(keyword);
        }
        
        // å»é‡è¯·æ±‚
        const result = await deduplicator.request(`/api/search?q=${keyword}`);
        
        // ç¼“å­˜ç»“æœï¼ˆé™åˆ¶ç¼“å­˜å¤§å°ï¼‰
        if (cache.size > 100) {
            const firstKey = cache.keys().next().value;
            cache.delete(firstKey);
        }
        cache.set(keyword, result);
        
        return result;
    }, 300);
})();

// 2. ç»„åˆä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ
const smartEventHandler = (() => {
    let lastResult = null;
    
    // é˜²æŠ–ï¼šé¿å…é¢‘ç¹è®¡ç®—
    const debouncedCalculate = debounce((data) => {
        lastResult = expensiveCalculation(data);
    }, 200);
    
    // èŠ‚æµï¼šå®šæœŸæ›´æ–°UI
    const throttledUpdate = throttle(() => {
        if (lastResult) {
            updateUI(lastResult);
        }
    }, 100);
    
    return (data) => {
        debouncedCalculate(data);
        throttledUpdate();
    };
})();
```

**ğŸ“Š ç›‘æ§å’Œè°ƒè¯•**
```javascript
// æ€§èƒ½ç›‘æ§è£…é¥°å™¨
function withPerformanceMonitoring(fn, name) {
    return function(...args) {
        const start = performance.now();
        const result = fn.apply(this, args);
        
        if (result instanceof Promise) {
            return result.finally(() => {
                const end = performance.now();
                console.log(`${name} è€—æ—¶: ${end - start}ms`);
            });
        } else {
            const end = performance.now();
            console.log(`${name} è€—æ—¶: ${end - start}ms`);
            return result;
        }
    };
}

// ä½¿ç”¨ç›‘æ§
const monitoredSearch = withPerformanceMonitoring(
    debounce(searchAPI, 300), 
    'æœç´¢API'
);
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- é˜²æŠ–ç­‰ç­‰å†æ‰§è¡Œï¼ŒèŠ‚æµå®šæ—¶æ¥é™åˆ¶
- æœç´¢å»ºè®®é˜²æŠ–å¥½ï¼Œæ»šåŠ¨ç›‘å¬èŠ‚æµä½³  
- é˜Ÿåˆ—ç®¡ç†æ§å¹¶å‘ï¼Œå»é‡ç¼“å­˜çœèµ„æº
- æ‰¹é‡åˆå¹¶å‡è¯·æ±‚ï¼Œæ€§èƒ½ä¼˜åŒ–ç”¨æˆ·çˆ½