---
title: 3ã€Ajaxè¶…æ—¶ä¸å–æ¶ˆè¯·æ±‚
---
## ğŸ“š ç›®å½•

1. [è¶…æ—¶æ§åˆ¶åŸºç¡€æ¦‚å¿µ](#1-è¶…æ—¶æ§åˆ¶åŸºç¡€æ¦‚å¿µ)
2. [è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´](#2-è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´)
3. [å¤„ç†è¶…æ—¶äº‹ä»¶](#3-å¤„ç†è¶…æ—¶äº‹ä»¶)
4. [ä¸»åŠ¨å–æ¶ˆè¯·æ±‚](#4-ä¸»åŠ¨å–æ¶ˆè¯·æ±‚)
5. [è¯·æ±‚é˜Ÿåˆ—ç®¡ç†](#5-è¯·æ±‚é˜Ÿåˆ—ç®¡ç†)
6. [ç”¨æˆ·ä½“éªŒä¼˜åŒ–](#6-ç”¨æˆ·ä½“éªŒä¼˜åŒ–)
7. [å®é™…åº”ç”¨åœºæ™¯](#7-å®é™…åº”ç”¨åœºæ™¯)
8. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#8-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ è¶…æ—¶æ§åˆ¶åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯è¯·æ±‚è¶…æ—¶

**é€šä¿—ç†è§£**ï¼šå°±åƒæ‰“ç”µè¯ç­‰å¾…å¯¹æ–¹æ¥å¬ï¼Œå¦‚æœç­‰å¤ªä¹…æ²¡äººæ¥ï¼Œæˆ‘ä»¬å°±ä¼šæŒ‚æ–­ç”µè¯ã€‚ç½‘ç»œè¯·æ±‚ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”å¤ªæ…¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨ç»“æŸç­‰å¾…ã€‚

```
ç°å®ç”Ÿæ´»ç±»æ¯”ï¼š
è®¢å¤–å– â†’ å‘èµ·Ajaxè¯·æ±‚
ç­‰å¾…é€è¾¾ â†’ ç­‰å¾…æœåŠ¡å™¨å“åº”
è¶…è¿‡é¢„æœŸæ—¶é—´ â†’ è¯·æ±‚è¶…æ—¶
å–æ¶ˆè®¢å• â†’ å–æ¶ˆè¯·æ±‚

ä¸ºä»€ä¹ˆéœ€è¦è¶…æ—¶æ§åˆ¶ï¼š
â€¢ é¿å…ç”¨æˆ·æ— é™ç­‰å¾…
â€¢ èŠ‚çœç³»ç»Ÿèµ„æº
â€¢ æå‡ç”¨æˆ·ä½“éªŒ
â€¢ é˜²æ­¢é¡µé¢å‡æ­»
```

### 1.2 è¶…æ—¶vså–æ¶ˆçš„åŒºåˆ«

**è¶…æ—¶**ï¼šç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œä¸»åŠ¨ç»ˆæ­¢
**å–æ¶ˆ**ï¼šç”¨æˆ·æˆ–ç¨‹åºä¸»åŠ¨å†³å®šä¸å†ç­‰å¾…ï¼Œç«‹å³ç»ˆæ­¢

```
è¶…æ—¶æœºåˆ¶ï¼š
ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ å‘é€è¯·æ±‚ â†’ ç­‰å¾…5ç§’ â†’ è‡ªåŠ¨è¶…æ—¶ â†’ æç¤ºç”¨æˆ·

å–æ¶ˆæœºåˆ¶ï¼š
ç”¨æˆ·ç‚¹å‡»æŒ‰é’® â†’ å‘é€è¯·æ±‚ â†’ ç”¨æˆ·ç‚¹å‡»å–æ¶ˆ â†’ ç«‹å³åœæ­¢ â†’ æç¤ºå–æ¶ˆæˆåŠŸ
```

### 1.3 ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›åŠŸèƒ½

**è§£å†³çš„é—®é¢˜**ï¼š
- âœ… **ç½‘ç»œç¯å¢ƒå·®**ï¼šç§»åŠ¨ç½‘ç»œã€å¼±ç½‘ç¯å¢ƒä¸‹è¯·æ±‚ç¼“æ…¢
- âœ… **æœåŠ¡å™¨ç¹å¿™**ï¼šé«˜å³°æœŸæœåŠ¡å™¨å“åº”æ…¢
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·ä¸æƒ³ç­‰å¾…æ—¶å¯ä»¥å–æ¶ˆ
- âœ… **èµ„æºç®¡ç†**ï¼šé¿å…å¤§é‡ç­‰å¾…ä¸­çš„è¯·æ±‚å ç”¨èµ„æº

---

## 2. â±ï¸ è®¾ç½®è¯·æ±‚è¶…æ—¶æ—¶é—´


### 2.1 timeoutå±æ€§åŸºæœ¬ç”¨æ³•

**æ ¸å¿ƒæ¦‚å¿µ**ï¼štimeoutå±æ€§è®¾ç½®è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’

```javascript
// åŸºç¡€è¯­æ³•
let xhr = new XMLHttpRequest();
xhr.timeout = 5000; // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º5ç§’

// å®Œæ•´ç¤ºä¾‹
function sendRequestWithTimeout() {
    let xhr = new XMLHttpRequest();
    
    // è®¾ç½®5ç§’è¶…æ—¶
    xhr.timeout = 5000;
    
    xhr.open('GET', 'https://api.example.com/data');
    xhr.send();
}
```

### 2.2 è¶…æ—¶æ—¶é—´çš„é€‰æ‹©åŸåˆ™

**ç»éªŒå‚è€ƒ**ï¼š
```
è¯·æ±‚ç±»å‹              å»ºè®®è¶…æ—¶æ—¶é—´    è¯´æ˜
æ™®é€šæ•°æ®è·å–          3-5ç§’          ç”¨æˆ·æœŸæœ›å¿«é€Ÿå“åº”
å›¾ç‰‡ä¸Šä¼               10-15ç§’        æ–‡ä»¶ä¼ è¾“éœ€è¦æ›´å¤šæ—¶é—´
å¤§æ–‡ä»¶ä¸‹è½½            30-60ç§’        æ ¹æ®æ–‡ä»¶å¤§å°è°ƒæ•´
å®æ—¶æ•°æ®              1-2ç§’          é‡‘èã€æ¸¸æˆç­‰å®æ—¶æ€§è¦æ±‚é«˜
```

### 2.3 åŠ¨æ€è®¾ç½®è¶…æ—¶æ—¶é—´

```javascript
// æ ¹æ®ç½‘ç»œçŠ¶å†µåŠ¨æ€è°ƒæ•´
function getTimeoutByConnection() {
    // æ£€æµ‹ç½‘ç»œè¿æ¥ç±»å‹ï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰
    let connection = navigator.connection;
    
    if (connection) {
        switch(connection.effectiveType) {
            case '4g': return 3000;    // 4Gç½‘ç»œ3ç§’
            case '3g': return 8000;    // 3Gç½‘ç»œ8ç§’
            case '2g': return 15000;   // 2Gç½‘ç»œ15ç§’
            default: return 5000;      // é»˜è®¤5ç§’
        }
    }
    
    return 5000; // é»˜è®¤å€¼
}

// ä½¿ç”¨åŠ¨æ€è¶…æ—¶
let xhr = new XMLHttpRequest();
xhr.timeout = getTimeoutByConnection();
```

---

## 3. ğŸš¨ å¤„ç†è¶…æ—¶äº‹ä»¶


### 3.1 ontimeoutäº‹ä»¶åŸºç¡€

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šå½“è¯·æ±‚è¶…è¿‡è®¾å®šæ—¶é—´ä»æœªå®Œæˆæ—¶ï¼Œä¼šè§¦å‘ontimeoutäº‹ä»¶

```javascript
let xhr = new XMLHttpRequest();

// è®¾ç½®è¶…æ—¶å¤„ç†
xhr.ontimeout = function() {
    console.log('è¯·æ±‚è¶…æ—¶äº†ï¼');
    alert('ç½‘ç»œå“åº”è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
};

xhr.timeout = 5000;
xhr.open('GET', 'https://slow-api.example.com/data');
xhr.send();
```

### 3.2 å®Œæ•´çš„è¶…æ—¶å¤„ç†ç¤ºä¾‹

```javascript
function requestWithTimeout(url, timeout = 5000) {
    return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();
        
        // è®¾ç½®è¶…æ—¶æ—¶é—´
        xhr.timeout = timeout;
        
        // æˆåŠŸå¤„ç†
        xhr.onload = function() {
            if (xhr.status === 200) {
                resolve(xhr.responseText);
            } else {
                reject(new Error(`è¯·æ±‚å¤±è´¥: ${xhr.status}`));
            }
        };
        
        // è¶…æ—¶å¤„ç†
        xhr.ontimeout = function() {
            reject(new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•'));
        };
        
        // é”™è¯¯å¤„ç†
        xhr.onerror = function() {
            reject(new Error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥'));
        };
        
        xhr.open('GET', url);
        xhr.send();
    });
}

// ä½¿ç”¨ç¤ºä¾‹
requestWithTimeout('https://api.example.com/data', 3000)
    .then(data => {
        console.log('æ•°æ®è·å–æˆåŠŸ:', data);
    })
    .catch(error => {
        console.log('è¯·æ±‚å¤±è´¥:', error.message);
        // å¯ä»¥åœ¨è¿™é‡Œå®ç°é‡è¯•é€»è¾‘
    });
```

### 3.3 è¶…æ—¶åçš„å¤„ç†ç­–ç•¥

```javascript
// è¶…æ—¶é‡è¯•æœºåˆ¶
function requestWithRetry(url, maxRetries = 3) {
    let retries = 0;
    
    function attemptRequest() {
        return new Promise((resolve, reject) => {
            let xhr = new XMLHttpRequest();
            xhr.timeout = 5000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(`HTTP ${xhr.status}`));
                }
            };
            
            xhr.ontimeout = function() {
                retries++;
                if (retries <= maxRetries) {
                    console.log(`ç¬¬${retries}æ¬¡é‡è¯•...`);
                    // é€’å¢è¶…æ—¶æ—¶é—´ï¼Œç»™æœåŠ¡å™¨æ›´å¤šæ—¶é—´
                    xhr.timeout = 5000 + (retries * 2000);
                    attemptRequest().then(resolve).catch(reject);
                } else {
                    reject(new Error('å¤šæ¬¡é‡è¯•åä»ç„¶è¶…æ—¶'));
                }
            };
            
            xhr.onerror = () => reject(new Error('ç½‘ç»œé”™è¯¯'));
            
            xhr.open('GET', url);
            xhr.send();
        });
    }
    
    return attemptRequest();
}
```

---

## 4. âŒ ä¸»åŠ¨å–æ¶ˆè¯·æ±‚


### 4.1 abort()æ–¹æ³•åŸºç¡€

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šabort()æ–¹æ³•å¯ä»¥ç«‹å³ç»ˆæ­¢æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œé‡Šæ”¾ç›¸å…³èµ„æº

```javascript
let xhr = new XMLHttpRequest();

// å‘èµ·è¯·æ±‚
xhr.open('GET', 'https://api.example.com/large-data');
xhr.send();

// 3ç§’åå–æ¶ˆè¯·æ±‚
setTimeout(() => {
    xhr.abort(); // ç«‹å³å–æ¶ˆè¯·æ±‚
    console.log('è¯·æ±‚å·²å–æ¶ˆ');
}, 3000);
```

### 4.2 ç›‘å¬å–æ¶ˆäº‹ä»¶

```javascript
let xhr = new XMLHttpRequest();

// ç›‘å¬å–æ¶ˆäº‹ä»¶
xhr.onabort = function() {
    console.log('è¯·æ±‚è¢«å–æ¶ˆäº†');
};

xhr.onload = function() {
    console.log('è¯·æ±‚æˆåŠŸå®Œæˆ');
};

xhr.open('GET', 'https://api.example.com/data');
xhr.send();

// ç”¨æˆ·ç‚¹å‡»å–æ¶ˆæŒ‰é’®æ—¶
document.getElementById('cancelBtn').onclick = function() {
    xhr.abort();
};
```

### 4.3 å®ç”¨çš„å–æ¶ˆè¯·æ±‚å°è£…

```javascript
// åˆ›å»ºå¯å–æ¶ˆçš„è¯·æ±‚
function createCancellableRequest(url) {
    let xhr = new XMLHttpRequest();
    let cancelled = false;
    
    const promise = new Promise((resolve, reject) => {
        xhr.onload = function() {
            if (!cancelled) {
                if (xhr.status === 200) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(`HTTP ${xhr.status}`));
                }
            }
        };
        
        xhr.onabort = function() {
            reject(new Error('è¯·æ±‚å·²å–æ¶ˆ'));
        };
        
        xhr.onerror = function() {
            if (!cancelled) {
                reject(new Error('ç½‘ç»œé”™è¯¯'));
            }
        };
        
        xhr.open('GET', url);
        xhr.send();
    });
    
    // è¿”å›promiseå’Œå–æ¶ˆå‡½æ•°
    return {
        promise,
        cancel: function() {
            cancelled = true;
            xhr.abort();
        }
    };
}

// ä½¿ç”¨ç¤ºä¾‹
let request = createCancellableRequest('https://api.example.com/data');

request.promise
    .then(data => console.log('æ•°æ®:', data))
    .catch(error => console.log('é”™è¯¯:', error.message));

// å¦‚æœéœ€è¦å–æ¶ˆ
// request.cancel();
```

---

## 5. ğŸ“‹ è¯·æ±‚é˜Ÿåˆ—ç®¡ç†


### 5.1 ä»€ä¹ˆæ˜¯è¯·æ±‚é˜Ÿåˆ—

**é€šä¿—ç†è§£**ï¼šå°±åƒé“¶è¡Œæ’é˜ŸåŠä¸šåŠ¡ï¼Œå¤šä¸ªè¯·æ±‚æŒ‰é¡ºåºè¿›è¡Œï¼Œé¿å…åŒæ—¶å‘èµ·å¤ªå¤šè¯·æ±‚å¯¼è‡´æµè§ˆå™¨å¡é¡¿æˆ–æœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚

```
è¯·æ±‚é˜Ÿåˆ—çš„ä½œç”¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯·æ±‚1æ’é˜Ÿ   â”‚ â†’ â”‚  è¯·æ±‚2æ’é˜Ÿ   â”‚ â†’ â”‚  è¯·æ±‚3æ’é˜Ÿ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                   â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­£åœ¨å¤„ç†    â”‚    â”‚   ç­‰å¾…ä¸­    â”‚    â”‚   ç­‰å¾…ä¸­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç®€å•çš„è¯·æ±‚é˜Ÿåˆ—å®ç°

```javascript
class RequestQueue {
    constructor(maxConcurrent = 3) {
        this.queue = [];           // ç­‰å¾…é˜Ÿåˆ—
        this.running = [];         // æ­£åœ¨è¿è¡Œçš„è¯·æ±‚
        this.maxConcurrent = maxConcurrent; // æœ€å¤§å¹¶å‘æ•°
    }
    
    // æ·»åŠ è¯·æ±‚åˆ°é˜Ÿåˆ—
    add(url, options = {}) {
        return new Promise((resolve, reject) => {
            this.queue.push({
                url,
                options,
                resolve,
                reject
            });
            
            this.process(); // å°è¯•å¤„ç†é˜Ÿåˆ—
        });
    }
    
    // å¤„ç†é˜Ÿåˆ—
    process() {
        // å¦‚æœæ­£åœ¨è¿è¡Œçš„è¯·æ±‚æ•°å·²è¾¾ä¸Šé™ï¼Œæˆ–é˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿”å›
        if (this.running.length >= this.maxConcurrent || this.queue.length === 0) {
            return;
        }
        
        // ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªè¯·æ±‚
        let requestItem = this.queue.shift();
        
        // åˆ›å»ºè¯·æ±‚
        let xhr = new XMLHttpRequest();
        xhr.timeout = requestItem.options.timeout || 5000;
        
        // å°†è¯·æ±‚æ·»åŠ åˆ°è¿è¡Œåˆ—è¡¨
        this.running.push({
            xhr,
            item: requestItem
        });
        
        xhr.onload = () => {
            this.onRequestComplete(xhr, requestItem);
        };
        
        xhr.onerror = () => {
            requestItem.reject(new Error('ç½‘ç»œé”™è¯¯'));
            this.removeFromRunning(xhr);
        };
        
        xhr.ontimeout = () => {
            requestItem.reject(new Error('è¯·æ±‚è¶…æ—¶'));
            this.removeFromRunning(xhr);
        };
        
        xhr.open('GET', requestItem.url);
        xhr.send();
    }
    
    // è¯·æ±‚å®Œæˆå¤„ç†
    onRequestComplete(xhr, requestItem) {
        if (xhr.status === 200) {
            requestItem.resolve(xhr.responseText);
        } else {
            requestItem.reject(new Error(`HTTP ${xhr.status}`));
        }
        
        this.removeFromRunning(xhr);
    }
    
    // ä»è¿è¡Œåˆ—è¡¨ä¸­ç§»é™¤è¯·æ±‚
    removeFromRunning(xhr) {
        this.running = this.running.filter(item => item.xhr !== xhr);
        this.process(); // ç»§ç»­å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªè¯·æ±‚
    }
    
    // å–æ¶ˆæ‰€æœ‰è¯·æ±‚
    cancelAll() {
        // å–æ¶ˆæ­£åœ¨è¿è¡Œçš„è¯·æ±‚
        this.running.forEach(item => {
            item.xhr.abort();
            item.item.reject(new Error('è¯·æ±‚è¢«å–æ¶ˆ'));
        });
        
        // æ¸…ç©ºé˜Ÿåˆ—
        this.queue.forEach(item => {
            item.reject(new Error('è¯·æ±‚è¢«å–æ¶ˆ'));
        });
        
        this.running = [];
        this.queue = [];
    }
}

// ä½¿ç”¨ç¤ºä¾‹
let requestQueue = new RequestQueue(2); // æœ€å¤šåŒæ—¶2ä¸ªè¯·æ±‚

// æ·»åŠ å¤šä¸ªè¯·æ±‚
requestQueue.add('https://api.example.com/data1')
    .then(data => console.log('æ•°æ®1:', data))
    .catch(error => console.log('é”™è¯¯1:', error.message));

requestQueue.add('https://api.example.com/data2')
    .then(data => console.log('æ•°æ®2:', data))
    .catch(error => console.log('é”™è¯¯2:', error.message));

requestQueue.add('https://api.example.com/data3')
    .then(data => console.log('æ•°æ®3:', data))
    .catch(error => console.log('é”™è¯¯3:', error.message));
```

---

## 6. ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–


### 6.1 LoadingçŠ¶æ€ç®¡ç†

**æ ¸å¿ƒæ€æƒ³**ï¼šè®©ç”¨æˆ·çŸ¥é“ç³»ç»Ÿæ­£åœ¨å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶å–æ¶ˆæ“ä½œ

```html
<!-- HTMLç»“æ„ -->
<div id="requestContainer">
    <button id="loadDataBtn">åŠ è½½æ•°æ®</button>
    <button id="cancelBtn" style="display: none;">å–æ¶ˆ</button>
    <div id="loadingStatus"></div>
    <div id="result"></div>
</div>
```

```javascript
class RequestManager {
    constructor() {
        this.currentRequest = null;
        this.setupUI();
    }
    
    setupUI() {
        const loadBtn = document.getElementById('loadDataBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        
        loadBtn.onclick = () => this.loadData();
        cancelBtn.onclick = () => this.cancelRequest();
    }
    
    loadData() {
        // å¦‚æœå·²æœ‰è¯·æ±‚åœ¨è¿›è¡Œï¼Œå…ˆå–æ¶ˆ
        if (this.currentRequest) {
            this.cancelRequest();
        }
        
        this.showLoading();
        
        // åˆ›å»ºæ–°è¯·æ±‚
        this.currentRequest = this.createRequest('https://api.example.com/data');
        
        this.currentRequest.promise
            .then(data => {
                this.showSuccess(data);
            })
            .catch(error => {
                this.showError(error.message);
            })
            .finally(() => {
                this.hideLoading();
                this.currentRequest = null;
            });
    }
    
    cancelRequest() {
        if (this.currentRequest) {
            this.currentRequest.cancel();
            this.currentRequest = null;
            this.showMessage('è¯·æ±‚å·²å–æ¶ˆ', 'info');
            this.hideLoading();
        }
    }
    
    createRequest(url) {
        let xhr = new XMLHttpRequest();
        let cancelled = false;
        
        const promise = new Promise((resolve, reject) => {
            xhr.timeout = 10000;
            
            xhr.onload = function() {
                if (!cancelled) {
                    if (xhr.status === 200) {
                        resolve(xhr.responseText);
                    } else {
                        reject(new Error(`è¯·æ±‚å¤±è´¥: ${xhr.status}`));
                    }
                }
            };
            
            xhr.ontimeout = function() {
                if (!cancelled) {
                    reject(new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•'));
                }
            };
            
            xhr.onerror = function() {
                if (!cancelled) {
                    reject(new Error('ç½‘ç»œè¿æ¥å¤±è´¥'));
                }
            };
            
            xhr.onabort = function() {
                reject(new Error('è¯·æ±‚è¢«å–æ¶ˆ'));
            };
            
            xhr.open('GET', url);
            xhr.send();
        });
        
        return {
            promise,
            cancel: function() {
                cancelled = true;
                xhr.abort();
            }
        };
    }
    
    showLoading() {
        document.getElementById('loadDataBtn').style.display = 'none';
        document.getElementById('cancelBtn').style.display = 'inline-block';
        document.getElementById('loadingStatus').innerHTML = 'æ­£åœ¨åŠ è½½æ•°æ®...';
    }
    
    hideLoading() {
        document.getElementById('loadDataBtn').style.display = 'inline-block';
        document.getElementById('cancelBtn').style.display = 'none';
        document.getElementById('loadingStatus').innerHTML = '';
    }
    
    showSuccess(data) {
        document.getElementById('result').innerHTML = `<div style="color: green;">æ•°æ®åŠ è½½æˆåŠŸ: ${data}</div>`;
    }
    
    showError(message) {
        document.getElementById('result').innerHTML = `<div style="color: red;">é”™è¯¯: ${message}</div>`;
    }
    
    showMessage(message, type) {
        const color = type === 'info' ? 'blue' : 'black';
        document.getElementById('result').innerHTML = `<div style="color: ${color};">${message}</div>`;
    }
}

// åˆå§‹åŒ–
let requestManager = new RequestManager();
```

### 6.2 è¿›åº¦æ˜¾ç¤º

```javascript
// å¸¦è¿›åº¦çš„æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹
function uploadWithProgress(file) {
    return new Promise((resolve, reject) => {
        let xhr = new XMLHttpRequest();
        
        // ç›‘å¬ä¸Šä¼ è¿›åº¦
        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                let percentComplete = (e.loaded / e.total) * 100;
                updateProgressBar(percentComplete);
            }
        };
        
        xhr.onload = function() {
            if (xhr.status === 200) {
                resolve(xhr.responseText);
            } else {
                reject(new Error(`ä¸Šä¼ å¤±è´¥: ${xhr.status}`));
            }
        };
        
        xhr.onerror = () => reject(new Error('ç½‘ç»œé”™è¯¯'));
        xhr.ontimeout = () => reject(new Error('ä¸Šä¼ è¶…æ—¶'));
        
        // è®¾ç½®è¾ƒé•¿çš„è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºæ–‡ä»¶ä¸Šä¼ å¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´
        xhr.timeout = 30000;
        
        let formData = new FormData();
        formData.append('file', file);
        
        xhr.open('POST', '/upload');
        xhr.send(formData);
    });
}

function updateProgressBar(percent) {
    const progressBar = document.getElementById('progressBar');
    progressBar.style.width = percent + '%';
    progressBar.textContent = Math.round(percent) + '%';
}
```

---

## 7. ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯


### 7.1 æœç´¢å»ºè®®åŠŸèƒ½

```javascript
// æœç´¢è¾“å…¥æ¡†çš„Ajaxå»ºè®®
class SearchSuggestions {
    constructor(inputElement, suggestionContainer) {
        this.input = inputElement;
        this.container = suggestionContainer;
        this.currentRequest = null;
        this.setupEventListeners();
    }
    
    setupEventListeners() {
        let timeout;
        
        this.input.addEventListener('input', (e) => {
            // æ¸…é™¤ä¹‹å‰çš„å»¶æ—¶
            clearTimeout(timeout);
            
            // è®¾ç½®æ–°çš„å»¶æ—¶ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
            timeout = setTimeout(() => {
                this.search(e.target.value);
            }, 300);
        });
    }
    
    search(query) {
        // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
        if (this.currentRequest) {
            this.currentRequest.cancel();
        }
        
        if (query.length < 2) {
            this.container.innerHTML = '';
            return;
        }
        
        this.currentRequest = this.createSearchRequest(query);
        
        this.currentRequest.promise
            .then(suggestions => {
                this.displaySuggestions(suggestions);
            })
            .catch(error => {
                if (error.message !== 'è¯·æ±‚è¢«å–æ¶ˆ') {
                    console.log('æœç´¢å¤±è´¥:', error.message);
                }
            });
    }
    
    createSearchRequest(query) {
        let xhr = new XMLHttpRequest();
        let cancelled = false;
        
        const promise = new Promise((resolve, reject) => {
            xhr.timeout = 3000; // æœç´¢å»ºè®®3ç§’è¶…æ—¶
            
            xhr.onload = function() {
                if (!cancelled && xhr.status === 200) {
                    resolve(JSON.parse(xhr.responseText));
                }
            };
            
            xhr.ontimeout = () => reject(new Error('æœç´¢è¶…æ—¶'));
            xhr.onerror = () => reject(new Error('æœç´¢å¤±è´¥'));
            xhr.onabort = () => reject(new Error('è¯·æ±‚è¢«å–æ¶ˆ'));
            
            xhr.open('GET', `/search/suggestions?q=${encodeURIComponent(query)}`);
            xhr.send();
        });
        
        return {
            promise,
            cancel: () => {
                cancelled = true;
                xhr.abort();
            }
        };
    }
    
    displaySuggestions(suggestions) {
        this.container.innerHTML = suggestions
            .map(item => `<div class="suggestion-item">${item}</div>`)
            .join('');
    }
}
```

### 7.2 æ‰¹é‡æ“ä½œç®¡ç†

```javascript
// æ‰¹é‡åˆ é™¤æ–‡ä»¶çš„ä¾‹å­
class BatchOperationManager {
    constructor() {
        this.operations = [];
        this.activeRequests = new Map();
    }
    
    async batchDelete(fileIds) {
        const results = [];
        
        for (let i = 0; i < fileIds.length; i++) {
            const fileId = fileIds[i];
            
            try {
                // æ˜¾ç¤ºå½“å‰è¿›åº¦
                this.updateProgress(i + 1, fileIds.length, `æ­£åœ¨åˆ é™¤æ–‡ä»¶ ${fileId}...`);
                
                const result = await this.deleteFile(fileId);
                results.push({ fileId, success: true, result });
                
            } catch (error) {
                results.push({ fileId, success: false, error: error.message });
            }
        }
        
        this.showBatchResult(results);
        return results;
    }
    
    deleteFile(fileId) {
        return new Promise((resolve, reject) => {
            let xhr = new XMLHttpRequest();
            xhr.timeout = 5000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    resolve(xhr.responseText);
                } else {
                    reject(new Error(`åˆ é™¤å¤±è´¥: HTTP ${xhr.status}`));
                }
            };
            
            xhr.ontimeout = () => reject(new Error('åˆ é™¤è¶…æ—¶'));
            xhr.onerror = () => reject(new Error('ç½‘ç»œé”™è¯¯'));
            
            // ä¿å­˜è¯·æ±‚å¼•ç”¨ï¼Œä»¥ä¾¿å¯ä»¥å–æ¶ˆ
            this.activeRequests.set(fileId, xhr);
            
            xhr.open('DELETE', `/files/${fileId}`);
            xhr.send();
        });
    }
    
    cancelAll() {
        // å–æ¶ˆæ‰€æœ‰æ­£åœ¨è¿›è¡Œçš„åˆ é™¤æ“ä½œ
        this.activeRequests.forEach((xhr, fileId) => {
            xhr.abort();
            console.log(`å·²å–æ¶ˆåˆ é™¤æ–‡ä»¶ ${fileId}`);
        });
        
        this.activeRequests.clear();
        this.updateProgress(0, 0, 'æ“ä½œå·²å–æ¶ˆ');
    }
    
    updateProgress(current, total, message) {
        console.log(`è¿›åº¦: ${current}/${total} - ${message}`);
        // è¿™é‡Œå¯ä»¥æ›´æ–°UIè¿›åº¦æ¡
    }
    
    showBatchResult(results) {
        const successful = results.filter(r => r.success).length;
        const failed = results.filter(r => !r.success).length;
        
        console.log(`æ‰¹é‡åˆ é™¤å®Œæˆ: æˆåŠŸ ${successful} ä¸ªï¼Œå¤±è´¥ ${failed} ä¸ª`);
    }
}
```

---

## 8. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 8.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ

```
ğŸ”¸ è¶…æ—¶æ§åˆ¶ï¼šé˜²æ­¢è¯·æ±‚æ— é™ç­‰å¾…ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ timeoutå±æ€§ï¼šè®¾ç½®è¯·æ±‚çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
ğŸ”¸ ontimeoutäº‹ä»¶ï¼šå¤„ç†è¶…æ—¶æƒ…å†µçš„å›è°ƒå‡½æ•°
ğŸ”¸ abort()æ–¹æ³•ï¼šä¸»åŠ¨å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚
ğŸ”¸ è¯·æ±‚é˜Ÿåˆ—ï¼šç®¡ç†å¤šä¸ªè¯·æ±‚ï¼Œæ§åˆ¶å¹¶å‘æ•°é‡
ğŸ”¸ ç”¨æˆ·ä½“éªŒï¼šloadingçŠ¶æ€ã€å–æ¶ˆæŒ‰é’®ã€è¿›åº¦æ˜¾ç¤º
```

### 8.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ è¶…æ—¶æ—¶é—´çš„è®¾ç½®åŸåˆ™**
```
ç½‘ç»œç±»å‹        å»ºè®®è¶…æ—¶æ—¶é—´    ä½¿ç”¨åœºæ™¯
å¿«é€Ÿæ•°æ®        2-3ç§’         æœç´¢å»ºè®®ã€ç®€å•æŸ¥è¯¢
æ™®é€šæ¥å£        5-8ç§’         å¸¸è§„æ•°æ®è·å–
æ–‡ä»¶ä¸Šä¼         15-30ç§’       æ ¹æ®æ–‡ä»¶å¤§å°è°ƒæ•´
å¤§æ•°æ®å¤„ç†      30-60ç§’       å¤æ‚è®¡ç®—ã€æŠ¥è¡¨ç”Ÿæˆ
```

**ğŸ”¹ å–æ¶ˆè¯·æ±‚çš„æœ€ä½³å®è·µ**
```
ä½¿ç”¨åœºæ™¯ï¼š
- ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆæ“ä½œ
- å‘èµ·æ–°è¯·æ±‚å‰å–æ¶ˆæ—§è¯·æ±‚
- é¡µé¢å¸è½½æ—¶æ¸…ç†æœªå®Œæˆè¯·æ±‚
- è¶…æ—¶åçš„æ¸…ç†å·¥ä½œ

æ³¨æ„äº‹é¡¹ï¼š
- å–æ¶ˆåè¦æ¸…ç†ç›¸å…³èµ„æº
- ç»™ç”¨æˆ·æ˜ç¡®çš„åé¦ˆ
- å¤„ç†å–æ¶ˆåçš„é”™è¯¯çŠ¶æ€
```

**ğŸ”¹ è¯·æ±‚é˜Ÿåˆ—çš„ä»·å€¼**
```
ä¼˜åŠ¿ï¼š
- æ§åˆ¶å¹¶å‘æ•°ï¼Œé¿å…æµè§ˆå™¨é™åˆ¶
- åˆç†åˆ©ç”¨ç½‘ç»œèµ„æº
- é¿å…æœåŠ¡å™¨å‹åŠ›è¿‡å¤§
- æä¾›ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

é€‚ç”¨åœºæ™¯ï¼š
- æ‰¹é‡æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- å¤§é‡æ•°æ®çš„åˆ†é¡µåŠ è½½
- å›¾ç‰‡æ‡’åŠ è½½
- æœç´¢å»ºè®®çš„é¢‘ç¹è¯·æ±‚
```

### 8.3 å®é™…åº”ç”¨æŒ‡å¯¼

```
å¼€å‘å»ºè®®ï¼š
âœ… æ ¹æ®ç½‘ç»œç¯å¢ƒåŠ¨æ€è°ƒæ•´è¶…æ—¶æ—¶é—´
âœ… æä¾›æ¸…æ™°çš„ç”¨æˆ·åé¦ˆï¼ˆloadingã€è¿›åº¦ï¼‰
âœ… å®ç°è¯·æ±‚çš„ä¼˜é›…å–æ¶ˆæœºåˆ¶
âœ… åœ¨å…³é”®æ“ä½œä¸­æ·»åŠ é‡è¯•é€»è¾‘
âœ… åˆç†ç®¡ç†å¹¶å‘è¯·æ±‚æ•°é‡

å¸¸è§é—®é¢˜é¿å…ï¼š
âŒ ä¸è®¾ç½®è¶…æ—¶æ—¶é—´å¯¼è‡´æ— é™ç­‰å¾…
âŒ å–æ¶ˆè¯·æ±‚åä¸æ¸…ç†ç›¸å…³çŠ¶æ€
âŒ åŒæ—¶å‘èµ·è¿‡å¤šè¯·æ±‚å¯¼è‡´æ€§èƒ½é—®é¢˜
âŒ è¶…æ—¶åä¸ç»™ç”¨æˆ·æ˜ç¡®æç¤º
âŒ å¿˜è®°åœ¨é¡µé¢å¸è½½æ—¶æ¸…ç†è¯·æ±‚
```

### 8.4 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

```
ç½‘ç»œä¼˜åŒ–ï¼š
- åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
- å®ç°è¯·æ±‚å»é‡æœºåˆ¶
- ä½¿ç”¨è¯·æ±‚é˜Ÿåˆ—æ§åˆ¶å¹¶å‘
- åŠæ—¶å–æ¶ˆæ— ç”¨è¯·æ±‚

ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š
- æä¾›å®æ—¶çš„çŠ¶æ€åé¦ˆ
- å…è®¸ç”¨æˆ·ä¸»åŠ¨å–æ¶ˆæ“ä½œ
- æ˜¾ç¤ºæ“ä½œè¿›åº¦
- å¤±è´¥æ—¶æä¾›é‡è¯•é€‰é¡¹

ä»£ç ä¼˜åŒ–ï¼š
- å°è£…é€šç”¨çš„è¯·æ±‚ç®¡ç†ç±»
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- å†…å­˜æ³„æ¼çš„é˜²èŒƒ
- å¼‚å¸¸æƒ…å†µçš„å…œåº•å¤„ç†
```

**æ ¸å¿ƒè®°å¿†å£è¯€**ï¼š
- è¯·æ±‚è¶…æ—¶è¦è®¾é™ï¼Œç”¨æˆ·ç­‰å¾…ä¸èƒ½é•¿
- ä¸»åŠ¨å–æ¶ˆå¾ˆé‡è¦ï¼Œä½“éªŒä¼˜åŒ–ä¸å¯å°‘
- é˜Ÿåˆ—ç®¡ç†æ§å¹¶å‘ï¼Œèµ„æºåˆç†è¦åˆ†é…
- çŠ¶æ€åé¦ˆè¦åŠæ—¶ï¼ŒæˆåŠŸå¤±è´¥éƒ½è¦çŸ¥