---
title: 1ã€Ajaxå®‰å…¨é˜²æŠ¤æªæ–½
---
## ğŸ“š ç›®å½•

1. [Ajaxå®‰å…¨å¨èƒæ¦‚è¿°](#1-Ajaxå®‰å…¨å¨èƒæ¦‚è¿°)
2. [CSRFæ”»å‡»é˜²æŠ¤](#2-CSRFæ”»å‡»é˜²æŠ¤)
3. [XSSæ”»å‡»é˜²æŠ¤](#3-XSSæ”»å‡»é˜²æŠ¤)
4. [æ•°æ®éªŒè¯ä¸è¿‡æ»¤](#4-æ•°æ®éªŒè¯ä¸è¿‡æ»¤)
5. [Tokenè®¤è¯æœºåˆ¶](#5-Tokenè®¤è¯æœºåˆ¶)
6. [HTTPSå®‰å…¨ä¼ è¾“](#6-HTTPSå®‰å…¨ä¼ è¾“)
7. [APIæ¥å£å®‰å…¨](#7-APIæ¥å£å®‰å…¨)
8. [å®‰å…¨æœ€ä½³å®è·µ](#8-å®‰å…¨æœ€ä½³å®è·µ)

---

## 1. ğŸ›¡ï¸ Ajaxå®‰å…¨å¨èƒæ¦‚è¿°


### 1.1 ä¸ºä»€ä¹ˆAjaxéœ€è¦å®‰å…¨é˜²æŠ¤ï¼Ÿ


**ğŸ’¡ é€šä¿—è§£é‡Š**
Ajaxå°±åƒä½ å®¶çš„é—¨çª—ï¼Œèƒ½è®©æ•°æ®è‡ªç”±è¿›å‡ºã€‚ä½†å¦‚æœä¸åŠ é˜²æŠ¤ï¼Œåäººä¹Ÿèƒ½é€šè¿‡è¿™äº›"é—¨çª—"è¿›å…¥ä½ çš„ç³»ç»Ÿå·å–ä¿¡æ¯æˆ–æç ´åã€‚

```
æ™®é€šç½‘é¡µè¯·æ±‚ï¼š
ç”¨æˆ· â†’ ç‚¹å‡»é“¾æ¥ â†’ åˆ·æ–°æ•´é¡µ â†’ æœåŠ¡å™¨å“åº”
ğŸ”’ ç›¸å¯¹å®‰å…¨ï¼Œä½†ä½“éªŒå·®

Ajaxè¯·æ±‚ï¼š
ç”¨æˆ· â†’ JavaScriptå‘è¯·æ±‚ â†’ åå°è·å–æ•°æ® â†’ æ›´æ–°é¡µé¢
âš ï¸ çµæ´»å¼ºå¤§ï¼Œä½†é£é™©æ›´å¤š
```

### 1.2 ä¸»è¦å®‰å…¨å¨èƒç±»å‹


```
ğŸ¯ å¸¸è§Ajaxå®‰å…¨å¨èƒ

â”Œâ”€ CSRFæ”»å‡» â”€â”€â”€â”€â”€â”    â”Œâ”€ XSSæ”»å‡» â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼ªé€ ç”¨æˆ·è¯·æ±‚    â”‚    â”‚ æ³¨å…¥æ¶æ„è„šæœ¬    â”‚
â”‚ ç›—ç”¨ç”¨æˆ·èº«ä»½    â”‚    â”‚ çªƒå–ç”¨æˆ·ä¿¡æ¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€ æ•°æ®æ³„éœ² â”€â”€â”€â”€â”€â”    â”Œâ”€ æ¥å£æ»¥ç”¨ â”€â”€â”€â”€â”€â”€â”
â”‚ æ•æ„Ÿä¿¡æ¯æš´éœ²    â”‚    â”‚ é¢‘ç¹æ¶æ„è¯·æ±‚    â”‚
â”‚ è¶Šæƒè®¿é—®æ•°æ®    â”‚    â”‚ æ¶ˆè€—æœåŠ¡å™¨èµ„æº   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ” CSRFæ”»å‡»é˜²æŠ¤


### 2.1 ä»€ä¹ˆæ˜¯CSRFæ”»å‡»ï¼Ÿ


**ğŸ¯ CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰é€šä¿—è§£é‡Š**
å°±åƒæœ‰äººå†’å……ä½ çš„èº«ä»½å»é“¶è¡Œå–é’±ã€‚æ”»å‡»è€…åˆ©ç”¨ä½ å·²ç»ç™»å½•çš„çŠ¶æ€ï¼Œå·å·å‘é€è¯·æ±‚ï¼Œè®©æœåŠ¡å™¨ä»¥ä¸ºæ˜¯ä½ æœ¬äººæ“ä½œã€‚

### 2.2 CSRFæ”»å‡»åŸç†å›¾è§£


```
CSRFæ”»å‡»æµç¨‹ï¼š

ç”¨æˆ·æµè§ˆå™¨                æ¶æ„ç½‘ç«™              ç›®æ ‡ç½‘ç«™
     â”‚                      â”‚                    â”‚
  1. â”‚ æ­£å¸¸ç™»å½•              â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è·å¾—Cookie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                      â”‚                    â”‚
  2. â”‚ è®¿é—®æ¶æ„ç½‘ç«™          â”‚                    â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚
     â”‚                      â”‚                    â”‚
  3. â”‚â—€â”€â”€ è¿”å›å«æ¶æ„è¯·æ±‚çš„é¡µé¢ â”€â”€â”‚                    â”‚
     â”‚                      â”‚                    â”‚
  4. â”‚ è‡ªåŠ¨å‘é€ä¼ªé€ è¯·æ±‚ï¼ˆå¸¦Cookieï¼‰                 â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                      â”‚                    â”‚
  5. â”‚â—€â”€â”€â”€â”€â”€â”€â”€ æ“ä½œæˆåŠŸï¼ˆä»¥ä¸ºæ˜¯ç”¨æˆ·æœ¬äººï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

### 2.3 CSRFé˜²æŠ¤æ–¹æ³•


**ğŸ”¸ æ–¹æ³•ä¸€ï¼šCSRF TokenéªŒè¯**

```javascript
// âœ… å®‰å…¨çš„Ajaxè¯·æ±‚
function secureAjaxRequest() {
    // 1. ä»é¡µé¢è·å–CSRF Token
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
    
    fetch('/api/transfer', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRF-Token': csrfToken  // æºå¸¦CSRF Token
        },
        body: JSON.stringify({
            amount: 1000,
            account: '12345'
        })
    });
}

// HTMLä¸­é¢„è®¾Token
// <meta name="csrf-token" content="abc123xyz">
```

**ğŸ”¸ æ–¹æ³•äºŒï¼šéªŒè¯è¯·æ±‚æ¥æº**

```javascript
// åç«¯éªŒè¯ï¼ˆNode.jsç¤ºä¾‹ï¼‰
app.post('/api/sensitive', (req, res) => {
    // æ£€æŸ¥è¯·æ±‚æ¥æº
    const origin = req.get('Origin');
    const referer = req.get('Referer');
    
    if (origin !== 'https://mysite.com') {
        return res.status(403).json({ error: 'éæ³•è¯·æ±‚æ¥æº' });
    }
    
    // ç»§ç»­å¤„ç†è¯·æ±‚...
});
```

### 2.4 CSRFé˜²æŠ¤æ£€æŸ¥æ¸…å•


| ğŸ›¡ï¸ é˜²æŠ¤æªæ–½ | âœ… å®æ–½çŠ¶æ€ | ğŸ¯ é˜²æŠ¤æ•ˆæœ |
|-------------|------------|------------|
| CSRF Token | `å¿…é¡»å®æ–½` | â­â­â­â­â­ |
| éªŒè¯Referer | `è¾…åŠ©æªæ–½` | â­â­â­ |
| SameSite Cookie | `æ¨èè®¾ç½®` | â­â­â­â­ |
| è‡ªå®šä¹‰Header | `å¯é€‰å¢å¼º` | â­â­â­ |

---

## 3. ğŸš« XSSæ”»å‡»é˜²æŠ¤


### 3.1 ä»€ä¹ˆæ˜¯XSSæ”»å‡»ï¼Ÿ


**ğŸ’¡ XSSï¼ˆè·¨ç«™è„šæœ¬æ”»å‡»ï¼‰é€šä¿—è§£é‡Š**
å°±åƒæœ‰äººåœ¨ä½ çš„ç½‘é¡µé‡Œå·å·æ”¾äº†ä¸€æ®µæ¶æ„ä»£ç ï¼Œå½“å…¶ä»–ç”¨æˆ·è®¿é—®æ—¶ï¼Œè¿™æ®µä»£ç å°±ä¼šæ‰§è¡Œï¼Œå¯èƒ½çªƒå–ç”¨æˆ·ä¿¡æ¯æˆ–è¿›è¡Œå…¶ä»–æ¶æ„æ“ä½œã€‚

### 3.2 XSSæ”»å‡»ç±»å‹ç¤ºä¾‹


```javascript
// âŒ å±é™©ï¼šç›´æ¥æ’å…¥ç”¨æˆ·è¾“å…¥
function displayUserComment(comment) {
    document.getElementById('comments').innerHTML = comment;
    // å¦‚æœcommentæ˜¯ï¼š<script>alert('XSSæ”»å‡»')</script>
    // è„šæœ¬ä¼šç«‹å³æ‰§è¡Œï¼
}

// âœ… å®‰å…¨ï¼šå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰
function safeDisplayComment(comment) {
    const div = document.createElement('div');
    div.textContent = comment;  // è‡ªåŠ¨è½¬ä¹‰HTML
    document.getElementById('comments').appendChild(div);
}
```

### 3.3 XSSé˜²æŠ¤ç­–ç•¥


**ğŸ”¸ è¾“å…¥è¿‡æ»¤å’Œè½¬ä¹‰**

```javascript
// XSSé˜²æŠ¤å·¥å…·å‡½æ•°
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// æˆ–è€…ä½¿ç”¨æ›¿æ¢æ–¹å¼
function escapeHtmlChars(str) {
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#x27;');
}

// å®‰å…¨çš„Ajaxæ•°æ®å¤„ç†
fetch('/api/comments')
    .then(response => response.json())
    .then(data => {
        data.comments.forEach(comment => {
            const safeComment = escapeHtml(comment.text);
            // ç°åœ¨å¯ä»¥å®‰å…¨åœ°æ’å…¥HTML
        });
    });
```

**ğŸ”¸ å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰**

```html
<!-- åœ¨HTMLå¤´éƒ¨è®¾ç½®CSP -->
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'">
```

---

## 4. âœ… æ•°æ®éªŒè¯ä¸è¿‡æ»¤


### 4.1 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®éªŒè¯ï¼Ÿ


**ğŸ¯ é€šä¿—è§£é‡Š**
å°±åƒé—¨å«æ£€æŸ¥æ¥è®¿è€…èº«ä»½ä¸€æ ·ï¼Œæˆ‘ä»¬è¦æ£€æŸ¥é€šè¿‡Ajaxä¼ è¾“çš„æ¯ä¸€ä¸ªæ•°æ®ï¼Œç¡®ä¿å®ƒä»¬æ˜¯"å¥½äºº"è€Œä¸æ˜¯"åæ•°æ®"ã€‚

### 4.2 å‰ç«¯æ•°æ®éªŒè¯


```javascript
// ç”¨æˆ·æ³¨å†Œè¡¨å•éªŒè¯
function validateUserData(userData) {
    const errors = [];
    
    // é‚®ç®±æ ¼å¼éªŒè¯
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(userData.email)) {
        errors.push('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');
    }
    
    // å¯†ç å¼ºåº¦éªŒè¯
    if (userData.password.length < 6) {
        errors.push('å¯†ç è‡³å°‘6ä½');
    }
    
    // æ‰‹æœºå·éªŒè¯
    const phoneRegex = /^1[3-9]\d{9}$/;
    if (!phoneRegex.test(userData.phone)) {
        errors.push('æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®');
    }
    
    return errors;
}

// å®‰å…¨çš„è¡¨å•æäº¤
function submitForm(formData) {
    // 1. å‰ç«¯éªŒè¯
    const errors = validateUserData(formData);
    if (errors.length > 0) {
        alert('æ•°æ®éªŒè¯å¤±è´¥ï¼š' + errors.join(', '));
        return;
    }
    
    // 2. å‘é€è¯·æ±‚
    fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('æœåŠ¡å™¨éªŒè¯å¤±è´¥');
        }
        return response.json();
    });
}
```

### 4.3 æ•°æ®éªŒè¯è§„åˆ™è¡¨


| ğŸ“‹ æ•°æ®ç±»å‹ | ğŸ” éªŒè¯è§„åˆ™ | âš ï¸ å®‰å…¨é£é™© |
|------------|------------|------------|
| é‚®ç®±åœ°å€ | æ­£åˆ™è¡¨è¾¾å¼éªŒè¯ | åƒåœ¾é‚®ä»¶ã€èº«ä»½ä¼ªé€  |
| å¯†ç  | é•¿åº¦+å¤æ‚åº¦æ£€æŸ¥ | å¼±å¯†ç æ”»å‡» |
| æ–‡ä»¶ä¸Šä¼  | æ ¼å¼+å¤§å°é™åˆ¶ | æ¶æ„æ–‡ä»¶ä¸Šä¼  |
| æ•°å­—è¾“å…¥ | èŒƒå›´+ç±»å‹æ£€æŸ¥ | æ•°æ®æº¢å‡ºæ”»å‡» |
| æ–‡æœ¬å†…å®¹ | é•¿åº¦+å­—ç¬¦è¿‡æ»¤ | XSSæ³¨å…¥æ”»å‡» |

---

## 5. ğŸ”‘ Tokenè®¤è¯æœºåˆ¶


### 5.1 ä»€ä¹ˆæ˜¯Tokenè®¤è¯ï¼Ÿ


**ğŸ’¡ Tokenè®¤è¯é€šä¿—è§£é‡Š**
Tokenå°±åƒæ˜¯ä¸€å¼ ä¸´æ—¶é€šè¡Œè¯ã€‚ä½ ç™»å½•åæœåŠ¡å™¨ç»™ä½ ä¸€å¼ "é€šè¡Œè¯"ï¼Œä¹‹åæ¯æ¬¡è¯·æ±‚éƒ½å¸¦ç€è¿™å¼ è¯ï¼ŒæœåŠ¡å™¨çœ‹åˆ°è¯å°±çŸ¥é“ä½ æ˜¯è°ã€‚

```
ä¼ ç»ŸSessionè®¤è¯ï¼š
ç™»å½• â†’ æœåŠ¡å™¨è®°ä½ä½  â†’ ç»™ä½ ä¸€ä¸ªCookie â†’ ä¸‹æ¬¡å¸¦Cookieæ¥

Tokenè®¤è¯ï¼š
ç™»å½• â†’ æœåŠ¡å™¨ç»™ä½ ä¸€å¼ Token â†’ ä¸‹æ¬¡å¸¦Tokenæ¥ â†’ æœåŠ¡å™¨éªŒè¯Token
```

### 5.2 JWT Tokenå®ç°


```javascript
// JWT Tokenä½¿ç”¨ç¤ºä¾‹
class AuthManager {
    constructor() {
        this.token = localStorage.getItem('authToken');
    }
    
    // ç™»å½•è·å–Token
    async login(username, password) {
        const response = await fetch('/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        });
        
        const data = await response.json();
        if (data.token) {
            this.token = data.token;
            localStorage.setItem('authToken', data.token);
            return true;
        }
        return false;
    }
    
    // å¸¦Tokençš„è¯·æ±‚
    async makeAuthenticatedRequest(url, options = {}) {
        if (!this.token) {
            throw new Error('è¯·å…ˆç™»å½•');
        }
        
        const headers = {
            'Authorization': `Bearer ${this.token}`,
            ...options.headers
        };
        
        const response = await fetch(url, {
            ...options,
            headers
        });
        
        // Tokenè¿‡æœŸå¤„ç†
        if (response.status === 401) {
            this.token = null;
            localStorage.removeItem('authToken');
            throw new Error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
        }
        
        return response;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const auth = new AuthManager();

// ç™»å½•
await auth.login('user123', 'password');

// å‘é€è®¤è¯è¯·æ±‚
const response = await auth.makeAuthenticatedRequest('/api/userinfo');
```

### 5.3 Tokenåˆ·æ–°æœºåˆ¶


```javascript
// Tokenè‡ªåŠ¨åˆ·æ–°
class TokenManager {
    constructor() {
        this.accessToken = localStorage.getItem('accessToken');
        this.refreshToken = localStorage.getItem('refreshToken');
    }
    
    // æ£€æŸ¥Tokenæ˜¯å¦å¿«è¿‡æœŸ
    isTokenExpiringSoon() {
        if (!this.accessToken) return true;
        
        // è§£æJWT Tokençš„è¿‡æœŸæ—¶é—´
        const payload = JSON.parse(atob(this.accessToken.split('.')[1]));
        const expiryTime = payload.exp * 1000;
        const currentTime = Date.now();
        
        // å¦‚æœ5åˆ†é’Ÿå†…è¿‡æœŸï¼Œå°±éœ€è¦åˆ·æ–°
        return (expiryTime - currentTime) < 5 * 60 * 1000;
    }
    
    // åˆ·æ–°Token
    async refreshAccessToken() {
        if (!this.refreshToken) {
            throw new Error('æ²¡æœ‰åˆ·æ–°ä»¤ç‰Œï¼Œè¯·é‡æ–°ç™»å½•');
        }
        
        const response = await fetch('/api/refresh', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ refreshToken: this.refreshToken })
        });
        
        const data = await response.json();
        if (data.accessToken) {
            this.accessToken = data.accessToken;
            localStorage.setItem('accessToken', data.accessToken);
            return data.accessToken;
        }
        
        throw new Error('Tokenåˆ·æ–°å¤±è´¥');
    }
    
    // è‡ªåŠ¨å¤„ç†Tokençš„è¯·æ±‚
    async request(url, options = {}) {
        // æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ·æ–°Token
        if (this.isTokenExpiringSoon()) {
            await this.refreshAccessToken();
        }
        
        return fetch(url, {
            ...options,
            headers: {
                'Authorization': `Bearer ${this.accessToken}`,
                ...options.headers
            }
        });
    }
}
```

---

## 6. ğŸ”’ HTTPSå®‰å…¨ä¼ è¾“


### 6.1 ä¸ºä»€ä¹ˆå¿…é¡»ä½¿ç”¨HTTPSï¼Ÿ


**ğŸ¯ HTTPSé‡è¦æ€§é€šä¿—è§£é‡Š**
HTTPå°±åƒæ˜ä¿¡ç‰‡ï¼Œä»»ä½•äººéƒ½èƒ½çœ‹åˆ°å†…å®¹ï¼›HTTPSå°±åƒå¯†å°ä¿¡å°ï¼Œåªæœ‰æ”¶ä»¶äººèƒ½æ‰“å¼€çœ‹åˆ°å†…å®¹ã€‚

```
HTTPä¼ è¾“ï¼š
ç”¨æˆ·æ•°æ® â†’ æ˜æ–‡ä¼ è¾“ â†’ æœåŠ¡å™¨
       â†‘
   å®¹æ˜“è¢«çªƒå¬

HTTPSä¼ è¾“ï¼š
ç”¨æˆ·æ•°æ® â†’ åŠ å¯†ä¼ è¾“ â†’ æœåŠ¡å™¨
       â†‘
   å®‰å…¨ä¸ä¼šè¢«çªƒå¬
```

### 6.2 å¼ºåˆ¶HTTPSçš„å®ç°


```javascript
// å¼ºåˆ¶è·³è½¬åˆ°HTTPS
if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
    location.replace('https:' + window.location.href.substring(window.location.protocol.length));
}

// æ£€æŸ¥è¿æ¥å®‰å…¨æ€§
function checkSecureConnection() {
    if (location.protocol === 'https:') {
        console.log('âœ… å®‰å…¨è¿æ¥');
        return true;
    } else {
        console.warn('âš ï¸ éå®‰å…¨è¿æ¥ï¼Œæ•°æ®å¯èƒ½è¢«çªƒå¬');
        return false;
    }
}

// åªåœ¨HTTPSä¸‹å‘é€æ•æ„Ÿæ•°æ®
function sendSensitiveData(data) {
    if (!checkSecureConnection()) {
        alert('è¯·ä½¿ç”¨å®‰å…¨è¿æ¥ï¼ˆHTTPSï¼‰');
        return;
    }
    
    fetch('/api/sensitive', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
}
```

---

## 7. ğŸ›¡ï¸ APIæ¥å£å®‰å…¨


### 7.1 APIç­¾åéªŒè¯


**ğŸ’¡ APIç­¾åé€šä¿—è§£é‡Š**
å°±åƒé“¶è¡Œè½¬è´¦éœ€è¦å¯†ç å’Œç­¾åä¸€æ ·ï¼ŒAPIæ¥å£ä¹Ÿéœ€è¦"ç­¾å"æ¥è¯æ˜è¯·æ±‚æ˜¯åˆæ³•çš„ï¼Œé˜²æ­¢è¢«æ¶æ„è°ƒç”¨ã€‚

```javascript
// APIç­¾åç”Ÿæˆ
class APIClient {
    constructor(apiKey, apiSecret) {
        this.apiKey = apiKey;
        this.apiSecret = apiSecret;
    }
    
    // ç”Ÿæˆè¯·æ±‚ç­¾å
    generateSignature(method, url, params, timestamp) {
        // 1. å°†å‚æ•°æ’åº
        const sortedParams = Object.keys(params)
            .sort()
            .map(key => `${key}=${params[key]}`)
            .join('&');
        
        // 2. æ„å»ºç­¾åå­—ç¬¦ä¸²
        const signString = `${method}&${url}&${sortedParams}&${timestamp}`;
        
        // 3. ä½¿ç”¨å¯†é’¥ç”Ÿæˆç­¾åï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
        return btoa(signString + this.apiSecret);
    }
    
    // å®‰å…¨çš„APIè¯·æ±‚
    async secureRequest(url, options = {}) {
        const timestamp = Date.now();
        const method = options.method || 'GET';
        const params = options.body ? JSON.parse(options.body) : {};
        
        // ç”Ÿæˆç­¾å
        const signature = this.generateSignature(method, url, params, timestamp);
        
        // æ·»åŠ å®‰å…¨å¤´
        const headers = {
            'X-API-Key': this.apiKey,
            'X-Timestamp': timestamp,
            'X-Signature': signature,
            ...options.headers
        };
        
        return fetch(url, {
            ...options,
            headers
        });
    }
}
```

### 7.2 è¯·æ±‚é¢‘ç‡é™åˆ¶


```javascript
// è¯·æ±‚é¢‘ç‡æ§åˆ¶
class RateLimiter {
    constructor(maxRequests = 10, timeWindow = 60000) {
        this.maxRequests = maxRequests;  // æœ€å¤§è¯·æ±‚æ•°
        this.timeWindow = timeWindow;    // æ—¶é—´çª—å£ï¼ˆæ¯«ç§’ï¼‰
        this.requests = [];              // è¯·æ±‚è®°å½•
    }
    
    // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘é€è¯·æ±‚
    canMakeRequest() {
        const now = Date.now();
        
        // æ¸…ç†è¿‡æœŸçš„è¯·æ±‚è®°å½•
        this.requests = this.requests.filter(
            time => now - time < this.timeWindow
        );
        
        // æ£€æŸ¥æ˜¯å¦è¶…å‡ºé™åˆ¶
        if (this.requests.length >= this.maxRequests) {
            return false;
        }
        
        // è®°å½•æœ¬æ¬¡è¯·æ±‚
        this.requests.push(now);
        return true;
    }
    
    // é™åˆ¶è¯·æ±‚é¢‘ç‡çš„fetchå°è£…
    async limitedFetch(url, options = {}) {
        if (!this.canMakeRequest()) {
            throw new Error('è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•');
        }
        
        return fetch(url, options);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const limiter = new RateLimiter(5, 60000); // æ¯åˆ†é’Ÿæœ€å¤š5æ¬¡è¯·æ±‚

async function safeApiCall() {
    try {
        const response = await limiter.limitedFetch('/api/data');
        return response.json();
    } catch (error) {
        alert(error.message);
    }
}
```

---

## 8. ğŸ“‹ å®‰å…¨æœ€ä½³å®è·µ


### 8.1 æ•æ„Ÿä¿¡æ¯å¤„ç†è§„èŒƒ


```javascript
// âŒ é”™è¯¯åšæ³•ï¼šæ•æ„Ÿä¿¡æ¯æš´éœ²
const config = {
    apiKey: 'sk-123456789',  // APIå¯†é’¥ä¸åº”è¯¥åœ¨å‰ç«¯
    dbPassword: 'admin123'   // æ•°æ®åº“å¯†ç ç»ä¸èƒ½åœ¨å‰ç«¯
};

// âœ… æ­£ç¡®åšæ³•ï¼šæ•æ„Ÿä¿¡æ¯ä¿æŠ¤
const config = {
    apiEndpoint: '/api/v1',     // åªæš´éœ²å¿…è¦ä¿¡æ¯
    timeout: 5000,              // å…¬å¼€é…ç½®
    retryTimes: 3               // å…¬å¼€é…ç½®
};

// æ•æ„Ÿæ•°æ®å¤„ç†å‡½æ•°
function handleSensitiveData(data) {
    // 1. ä¸åœ¨æ§åˆ¶å°è¾“å‡ºæ•æ„Ÿä¿¡æ¯
    console.log('å¤„ç†ç”¨æˆ·æ•°æ®...'); // è€Œä¸æ˜¯ console.log(data)
    
    // 2. ä¸åœ¨æœ¬åœ°å­˜å‚¨æ•æ„Ÿä¿¡æ¯
    // localStorage.setItem('password', password); // âŒ å±é™©
    
    // 3. åŠæ—¶æ¸…ç†ä¸´æ—¶å˜é‡
    try {
        // å¤„ç†æ•°æ®
        processData(data);
    } finally {
        // æ¸…ç†æ•æ„Ÿæ•°æ®
        data = null;
    }
}
```

### 8.2 å®‰å…¨ç¼–ç æ£€æŸ¥æ¸…å•


<details>
<summary>ğŸ” ç‚¹å‡»æŸ¥çœ‹å®Œæ•´å®‰å…¨æ£€æŸ¥æ¸…å•</summary>

**ğŸ›¡ï¸ è¾“å…¥éªŒè¯**
- [ ] å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯
- [ ] ä½¿ç”¨ç™½åå•è€Œä¸æ˜¯é»‘åå•
- [ ] éªŒè¯æ•°æ®ç±»å‹å’Œæ ¼å¼
- [ ] é™åˆ¶è¾“å…¥é•¿åº¦

**ğŸ” èº«ä»½è®¤è¯**
- [ ] ä½¿ç”¨å¼ºå¯†ç ç­–ç•¥
- [ ] å®æ–½Tokenè®¤è¯
- [ ] è®¾ç½®Tokenè¿‡æœŸæ—¶é—´
- [ ] å®ç°Tokenåˆ·æ–°æœºåˆ¶

**ğŸš« æ”»å‡»é˜²æŠ¤**
- [ ] é˜²æŠ¤CSRFæ”»å‡»
- [ ] é˜²æŠ¤XSSæ”»å‡»
- [ ] å®æ–½è¾“å…¥è½¬ä¹‰
- [ ] è®¾ç½®CSPå¤´éƒ¨

**ğŸ“¡ ä¼ è¾“å®‰å…¨**
- [ ] å¼ºåˆ¶ä½¿ç”¨HTTPS
- [ ] éªŒè¯SSLè¯ä¹¦
- [ ] ç¦ç”¨ä¸å®‰å…¨åè®®
- [ ] åŠ å¯†æ•æ„Ÿæ•°æ®

**ğŸ” ç›‘æ§å’Œæ—¥å¿—**
- [ ] è®°å½•å®‰å…¨äº‹ä»¶
- [ ] ç›‘æ§å¼‚å¸¸è¯·æ±‚
- [ ] è®¾ç½®å‘Šè­¦æœºåˆ¶
- [ ] å®šæœŸå®‰å…¨å®¡è®¡

</details>

### 8.3 å®‰å…¨å¼€å‘æ€»ç»“


> ğŸ§  **å®‰å…¨å¼€å‘è®°å¿†å£è¯€**
> 
> *"è¾“å…¥è¦éªŒè¯ï¼Œè¾“å‡ºè¦è½¬ä¹‰ï¼›Tokenè¦æ›´æ–°ï¼ŒHTTPSæ˜¯å¿…é¡»ï¼›ç­¾åé˜²ä¼ªé€ ï¼Œé™é¢‘é˜²æ”»å‡»"*

**ğŸ¯ æ ¸å¿ƒå®‰å…¨åŸåˆ™**

```
å®‰å…¨ä¸‰è¦ç´ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœºå¯†æ€§     â”‚    â”‚  å®Œæ•´æ€§     â”‚    â”‚  å¯ç”¨æ€§     â”‚
â”‚ ä¿¡æ¯ä¸æ³„éœ²   â”‚ â†â†’ â”‚ æ•°æ®ä¸ç¯¡æ”¹   â”‚ â†â†’ â”‚ æœåŠ¡æ­£å¸¸ç”¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ç°æ–¹æ³•ï¼š
æœºå¯†æ€§ â†’ åŠ å¯†ä¼ è¾“ã€è®¿é—®æ§åˆ¶
å®Œæ•´æ€§ â†’ æ•°å­—ç­¾åã€å“ˆå¸Œæ ¡éªŒ
å¯ç”¨æ€§ â†’ é¢‘ç‡é™åˆ¶ã€è´Ÿè½½å‡è¡¡
```

**âš¡ æ€§èƒ½vså®‰å…¨å¹³è¡¡**

| ğŸ¯ åœºæ™¯ | ğŸ”’ å®‰å…¨ç­‰çº§ | âš¡ æ€§èƒ½å½±å“ | ğŸ’¡ å»ºè®®æ–¹æ¡ˆ |
|---------|------------|------------|------------|
| ç™»å½•é¡µé¢ | ğŸ”´ é«˜ | ä¸­ç­‰ | å®Œæ•´éªŒè¯+åŠ å¯† |
| å…¬å¼€API | ğŸŸ¡ ä¸­ | è¾ƒå° | åŸºç¡€éªŒè¯+é™é¢‘ |
| é™æ€èµ„æº | ğŸŸ¢ ä½ | æœ€å° | åŸºç¡€é˜²æŠ¤ |
| æ”¯ä»˜æ¥å£ | ğŸ”´ æé«˜ | è¾ƒå¤§ | å¤šé‡éªŒè¯+ç›‘æ§ |

---

## ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### å¿…é¡»æŒæ¡çš„å®‰å…¨æ¦‚å¿µ

```
ğŸ”¸ CSRFé˜²æŠ¤ï¼šTokenéªŒè¯æ˜¯æ ¸å¿ƒï¼Œé˜²æ­¢è¯·æ±‚ä¼ªé€ 
ğŸ”¸ XSSé˜²æŠ¤ï¼šè¾“å…¥è½¬ä¹‰æ˜¯å…³é”®ï¼Œé˜²æ­¢è„šæœ¬æ³¨å…¥  
ğŸ”¸ æ•°æ®éªŒè¯ï¼šå‰åç«¯éƒ½è¦éªŒè¯ï¼ŒåŒé‡ä¿é™©
ğŸ”¸ Tokenè®¤è¯ï¼šç°ä»£è®¤è¯æ–¹å¼ï¼Œæ¯”Sessionæ›´çµæ´»
ğŸ”¸ HTTPSä¼ è¾“ï¼šåŠ å¯†é€šä¿¡åŸºç¡€ï¼Œå¿…é¡»ä½¿ç”¨
ğŸ”¸ APIå®‰å…¨ï¼šç­¾å+é™é¢‘ï¼Œé˜²æ­¢æ¥å£æ»¥ç”¨
```

### å®‰å…¨å¼€å‘å®è·µè¦ç‚¹

- **ğŸ¯ é˜²æŠ¤è¦åˆ†å±‚**ï¼šå‰ç«¯+åç«¯+ç½‘ç»œï¼Œå±‚å±‚è®¾é˜²
- **âš¡ æ€§èƒ½è¦å¹³è¡¡**ï¼šå®‰å…¨æªæ–½ä¸èƒ½å½±å“ç”¨æˆ·ä½“éªŒ
- **ğŸ” ç›‘æ§è¦åŠæ—¶**ï¼šå‘ç°é—®é¢˜è¦èƒ½å¿«é€Ÿå“åº”
- **ğŸ“š çŸ¥è¯†è¦æ›´æ–°**ï¼šå®‰å…¨å¨èƒåœ¨ä¸æ–­æ¼”è¿›

**æ ¸å¿ƒè®°å¿†**ï¼š
- Ajaxå®‰å…¨å°±æ˜¯ç»™æ•°æ®ä¼ è¾“åŠ "ä¿æŠ¤ç½©"
- æ°¸è¿œä¸è¦ç›¸ä¿¡å‰ç«¯ä¼ æ¥çš„ä»»ä½•æ•°æ®
- å®‰å…¨æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œéœ€è¦å…¨æ–¹ä½è€ƒè™‘
- å¥½çš„å®‰å…¨è®¾è®¡å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„