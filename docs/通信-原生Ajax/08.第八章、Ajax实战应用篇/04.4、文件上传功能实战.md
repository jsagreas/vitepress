---
title: 4ã€æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®æˆ˜
---
## ğŸ“š ç›®å½•

1. [æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ](#1-æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ)
2. [å•æ–‡ä»¶ä¸Šä¼ å®ç°](#2-å•æ–‡ä»¶ä¸Šä¼ å®ç°)
3. [å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†](#3-å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†)
4. [ä¸Šä¼ è¿›åº¦ç›‘æ§](#4-ä¸Šä¼ è¿›åº¦ç›‘æ§)
5. [æ–‡ä»¶éªŒè¯æœºåˆ¶](#5-æ–‡ä»¶éªŒè¯æœºåˆ¶)
6. [å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ](#6-å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ )
7. [æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½](#7-æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½)
8. [æ–­ç‚¹ç»­ä¼ æŠ€æœ¯](#8-æ–­ç‚¹ç»­ä¼ æŠ€æœ¯)
9. [å›¾ç‰‡å¤„ç†ä¼˜åŒ–](#9-å›¾ç‰‡å¤„ç†ä¼˜åŒ–)
10. [WebWorkerå¤„ç†](#10-webworkerå¤„ç†)
11. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#11-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ“ æ–‡ä»¶ä¸Šä¼ åŸºç¡€æ¦‚å¿µ


### 1.1 ä»€ä¹ˆæ˜¯æ–‡ä»¶ä¸Šä¼ 


**ç®€å•ç†è§£**ï¼šå°±æ˜¯æŠŠç”¨æˆ·ç”µè„‘é‡Œçš„æ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨ä¸Šå»

```
ç”¨æˆ·ç”µè„‘ä¸Šçš„æ–‡ä»¶ â†’ æµè§ˆå™¨ â†’ æœåŠ¡å™¨
              ä¸Šä¼ è¿‡ç¨‹
```

> ğŸ’¡ **é€šä¿—æ¯”å–»**ï¼šå°±åƒå¯„å¿«é€’ä¸€æ ·ï¼Œä½ æŠŠä¸œè¥¿(æ–‡ä»¶)äº¤ç»™å¿«é€’å‘˜(æµè§ˆå™¨)ï¼Œå¿«é€’å‘˜å¸®ä½ é€åˆ°ç›®çš„åœ°(æœåŠ¡å™¨)

### 1.2 æ–‡ä»¶ä¸Šä¼ çš„æ ¸å¿ƒè¦ç´ 


**ğŸ”¸ ä¸‰ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†**
```
1. ğŸ“ æ–‡ä»¶é€‰æ‹©å™¨ - è®©ç”¨æˆ·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶
2. ğŸ“¤ ä¸Šä¼ å¤„ç†å™¨ - è´Ÿè´£æŠŠæ–‡ä»¶å‘é€åˆ°æœåŠ¡å™¨  
3. ğŸ“Š è¿›åº¦åé¦ˆ - å‘Šè¯‰ç”¨æˆ·ä¸Šä¼ äº†å¤šå°‘
```

**åŸºç¡€HTMLç»“æ„**
```html
<!-- æœ€ç®€å•çš„æ–‡ä»¶ä¸Šä¼  -->
<input type="file" id="fileInput">
<button onclick="uploadFile()">ä¸Šä¼ æ–‡ä»¶</button>
<div id="progress"></div>
```

### 1.3 æ–‡ä»¶ä¸Šä¼ çš„å·¥ä½œæµç¨‹


```
ç”¨æˆ·æ“ä½œæµç¨‹ï¼š
1. ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ â†’ æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
2. é€‰ä¸­æ–‡ä»¶ â†’ æ–‡ä»¶ä¿¡æ¯åŠ è½½åˆ°æµè§ˆå™¨
3. ç‚¹å‡»ä¸Šä¼  â†’ å¼€å§‹ä¼ è¾“æ•°æ®
4. æ˜¾ç¤ºè¿›åº¦ â†’ ç”¨æˆ·çœ‹åˆ°ä¸Šä¼ çŠ¶æ€
5. ä¸Šä¼ å®Œæˆ â†’ æœåŠ¡å™¨è¿”å›ç»“æœ
```

---

## 2. ğŸ“„ å•æ–‡ä»¶ä¸Šä¼ å®ç°


### 2.1 åŸºç¡€å•æ–‡ä»¶ä¸Šä¼ 


**æ ¸å¿ƒæ€è·¯**ï¼šç”¨`FormData`æŠŠæ–‡ä»¶åŒ…è£…ä¸€ä¸‹ï¼Œç„¶åç”¨Ajaxå‘é€

```javascript
function uploadSingleFile() {
    // 1. è·å–ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];  // files[0]å°±æ˜¯ç¬¬ä¸€ä¸ªæ–‡ä»¶
    
    // 2. æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–‡ä»¶
    if (!file) {
        alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // 3. åˆ›å»ºFormDataå¯¹è±¡(å°±åƒä¸€ä¸ªåŒ…è£¹ï¼ŒæŠŠæ–‡ä»¶è£…è¿›å»)
    const formData = new FormData();
    formData.append('file', file);  // 'file'æ˜¯å­—æ®µåï¼Œfileæ˜¯æ–‡ä»¶å†…å®¹
    
    // 4. å‘é€åˆ°æœåŠ¡å™¨
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/upload');
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            alert('ä¸Šä¼ æˆåŠŸï¼');
        } else {
            alert('ä¸Šä¼ å¤±è´¥');
        }
    };
    
    xhr.send(formData);  // å‘é€æ–‡ä»¶
}
```

> ğŸ“ **FormDataè§£é‡Š**ï¼šFormDataå°±åƒä¸€ä¸ªè™šæ‹Ÿçš„è¡¨å•ï¼Œå¯ä»¥æŠŠæ–‡ä»¶ã€æ–‡æœ¬ç­‰æ•°æ®éƒ½è£…è¿›å»ï¼Œç„¶åä¸€èµ·å‘é€

### 2.2 å®Œæ•´çš„å•æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹


```html
<!DOCTYPE html>
<html>
<head>
    <title>å•æ–‡ä»¶ä¸Šä¼ </title>
</head>
<body>
    <div>
        <input type="file" id="fileInput" accept="image/*">
        <button onclick="uploadFile()">ä¸Šä¼ å›¾ç‰‡</button>
        <div id="status"></div>
    </div>

    <script>
    function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const file = fileInput.files[0];
        
        if (!file) {
            status.textContent = 'è¯·é€‰æ‹©æ–‡ä»¶';
            return;
        }
        
        status.textContent = 'æ­£åœ¨ä¸Šä¼ ...';
        
        const formData = new FormData();
        formData.append('file', file);
        
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload');
        
        xhr.onload = function() {
            if (xhr.status === 200) {
                status.textContent = 'ä¸Šä¼ æˆåŠŸï¼';
            } else {
                status.textContent = 'ä¸Šä¼ å¤±è´¥';
            }
        };
        
        xhr.onerror = function() {
            status.textContent = 'ç½‘ç»œé”™è¯¯';
        };
        
        xhr.send(formData);
    }
    </script>
</body>
</html>
```

---

## 3. ğŸ“š å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†


### 3.1 å¤šæ–‡ä»¶ä¸Šä¼ çš„åŸºæœ¬æ¦‚å¿µ


**ä»€ä¹ˆæ˜¯å¤šæ–‡ä»¶ä¸Šä¼ **ï¼šç”¨æˆ·ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼Œç„¶åæ‰¹é‡ä¸Šä¼ 

```html
<!-- multipleå±æ€§å…è®¸é€‰æ‹©å¤šä¸ªæ–‡ä»¶ -->
<input type="file" id="multiFileInput" multiple>
```

> ğŸ’¡ **multipleå±æ€§**ï¼šåŠ ä¸Šè¿™ä¸ªå±æ€§åï¼Œç”¨æˆ·æŒ‰ä½Ctrlé”®å°±èƒ½é€‰æ‹©å¤šä¸ªæ–‡ä»¶

### 3.2 å¤šæ–‡ä»¶ä¸Šä¼ çš„ä¸¤ç§æ–¹å¼


**ğŸ”¸ æ–¹å¼ä¸€ï¼šä¸€æ¬¡æ€§ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶**
```javascript
function uploadMultipleFiles() {
    const fileInput = document.getElementById('multiFileInput');
    const files = fileInput.files;  // æ³¨æ„ï¼šè¿™é‡Œæ˜¯filesï¼Œä¸æ˜¯files[0]
    
    if (files.length === 0) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    const formData = new FormData();
    
    // æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½è£…è¿›FormData
    for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]);  // éƒ½ç”¨åŒä¸€ä¸ªå­—æ®µå'files'
    }
    
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/upload-multiple');
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            alert(`æˆåŠŸä¸Šä¼ ${files.length}ä¸ªæ–‡ä»¶`);
        }
    };
    
    xhr.send(formData);
}
```

**ğŸ”¸ æ–¹å¼äºŒï¼šé€ä¸ªä¸Šä¼ æ–‡ä»¶**
```javascript
function uploadFilesOneByOne() {
    const fileInput = document.getElementById('multiFileInput');
    const files = fileInput.files;
    
    if (files.length === 0) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // é€ä¸ªä¸Šä¼ æ–‡ä»¶
    for (let i = 0; i < files.length; i++) {
        uploadSingleFileAsync(files[i], i + 1, files.length);
    }
}

function uploadSingleFileAsync(file, index, total) {
    const formData = new FormData();
    formData.append('file', file);
    
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/upload');
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            console.log(`æ–‡ä»¶${index}/${total}ä¸Šä¼ æˆåŠŸ: ${file.name}`);
        }
    };
    
    xhr.send(formData);
}
```

### 3.3 å¤šæ–‡ä»¶ä¸Šä¼ çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”


| ä¸Šä¼ æ–¹å¼ | **ä¼˜ç‚¹** | **ç¼ºç‚¹** | **é€‚ç”¨åœºæ™¯** |
|---------|---------|---------|-------------|
| **ä¸€æ¬¡æ€§ä¸Šä¼ ** | `ä¸Šä¼ å¿«ï¼ŒæœåŠ¡å™¨å¤„ç†ç®€å•` | `æ–‡ä»¶å¤§æ—¶å®¹æ˜“è¶…æ—¶` | `å°æ–‡ä»¶æ‰¹é‡ä¸Šä¼ ` |
| **é€ä¸ªä¸Šä¼ ** | `å¯æ§æ€§å¼ºï¼Œå¤±è´¥å½±å“å°` | `ä¸Šä¼ æ—¶é—´é•¿` | `å¤§æ–‡ä»¶æˆ–é‡è¦æ–‡ä»¶` |

---

## 4. ğŸ“Š ä¸Šä¼ è¿›åº¦ç›‘æ§


### 4.1 è¿›åº¦ç›‘æ§çš„é‡è¦æ€§


**ä¸ºä»€ä¹ˆéœ€è¦è¿›åº¦ç›‘æ§**ï¼š
- è®©ç”¨æˆ·çŸ¥é“ä¸Šä¼ è¿˜åœ¨è¿›è¡Œä¸­
- é¿å…ç”¨æˆ·ä»¥ä¸ºé¡µé¢å¡æ­»äº†
- æå‡ç”¨æˆ·ä½“éªŒ

### 4.2 å®ç°ä¸Šä¼ è¿›åº¦æ˜¾ç¤º


```javascript
function uploadWithProgress() {
    const fileInput = document.getElementById('fileInput');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    const formData = new FormData();
    formData.append('file', file);
    
    const xhr = new XMLHttpRequest();
    
    // ç›‘å¬ä¸Šä¼ è¿›åº¦
    xhr.upload.onprogress = function(event) {
        if (event.lengthComputable) {
            // è®¡ç®—ä¸Šä¼ ç™¾åˆ†æ¯”
            const percentComplete = (event.loaded / event.total) * 100;
            
            // æ›´æ–°è¿›åº¦æ¡
            progressBar.style.width = percentComplete + '%';
            progressText.textContent = Math.round(percentComplete) + '%';
        }
    };
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            progressText.textContent = 'ä¸Šä¼ å®Œæˆï¼';
        }
    };
    
    xhr.open('POST', '/upload');
    xhr.send(formData);
}
```

**å¯¹åº”çš„HTMLç»“æ„**
```html
<div>
    <input type="file" id="fileInput">
    <button onclick="uploadWithProgress()">ä¸Šä¼ æ–‡ä»¶</button>
    
    <!-- è¿›åº¦æ¡ -->
    <div style="width: 100%; background-color: #f0f0f0; margin: 10px 0;">
        <div id="progressBar" style="width: 0%; height: 20px; background-color: #4CAF50;"></div>
    </div>
    <div id="progressText">0%</div>
</div>
```

### 4.3 è¿›åº¦ç›‘æ§çš„å…³é”®äº‹ä»¶


```javascript
// ä¸Šä¼ è¿›åº¦äº‹ä»¶
xhr.upload.onprogress = function(event) {
    // event.loadedï¼šå·²ä¸Šä¼ çš„å­—èŠ‚æ•°
    // event.totalï¼šæ–‡ä»¶æ€»å­—èŠ‚æ•°
    // event.lengthComputableï¼šæ˜¯å¦å¯ä»¥è®¡ç®—è¿›åº¦
};

// ä¸Šä¼ å¼€å§‹
xhr.upload.onloadstart = function() {
    console.log('å¼€å§‹ä¸Šä¼ ');
};

// ä¸Šä¼ å®Œæˆ
xhr.upload.onload = function() {
    console.log('ä¸Šä¼ æ•°æ®å®Œæˆ');
};

// ä¸Šä¼ é”™è¯¯
xhr.upload.onerror = function() {
    console.log('ä¸Šä¼ å‡ºé”™');
};
```

> âš ï¸ **æ³¨æ„**ï¼š`xhr.upload.onprogress`ç›‘æ§çš„æ˜¯ä¸Šä¼ è¿›åº¦ï¼Œè€Œ`xhr.onprogress`ç›‘æ§çš„æ˜¯ä¸‹è½½è¿›åº¦

---

## 5. âœ… æ–‡ä»¶éªŒè¯æœºåˆ¶


### 5.1 ä¸ºä»€ä¹ˆéœ€è¦æ–‡ä»¶éªŒè¯


**å®‰å…¨è€ƒè™‘**ï¼š
- é˜²æ­¢ç”¨æˆ·ä¸Šä¼ æ¶æ„æ–‡ä»¶
- æ§åˆ¶æœåŠ¡å™¨å­˜å‚¨ç©ºé—´
- æå‡ç”¨æˆ·ä½“éªŒ

**å¸¸è§éªŒè¯é¡¹ç›®**ï¼š
- æ–‡ä»¶ç±»å‹ï¼ˆåªå…è®¸å›¾ç‰‡ã€æ–‡æ¡£ç­‰ï¼‰
- æ–‡ä»¶å¤§å°ï¼ˆä¸èƒ½å¤ªå¤§ï¼‰
- æ–‡ä»¶æ•°é‡ï¼ˆé™åˆ¶ä¸Šä¼ æ•°é‡ï¼‰

### 5.2 æ–‡ä»¶ç±»å‹éªŒè¯


```javascript
function validateFileType(file) {
    // å…è®¸çš„æ–‡ä»¶ç±»å‹
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    
    if (!allowedTypes.includes(file.type)) {
        alert('åªå…è®¸ä¸Šä¼ JPGã€PNGã€GIFæ ¼å¼çš„å›¾ç‰‡');
        return false;
    }
    
    return true;
}

// ä½¿ç”¨ç¤ºä¾‹
function uploadWithValidation() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    // éªŒè¯æ–‡ä»¶ç±»å‹
    if (!validateFileType(file)) {
        return;  // éªŒè¯å¤±è´¥ï¼Œåœæ­¢ä¸Šä¼ 
    }
    
    // éªŒè¯é€šè¿‡ï¼Œç»§ç»­ä¸Šä¼ 
    // ... ä¸Šä¼ ä»£ç 
}
```

### 5.3 æ–‡ä»¶å¤§å°éªŒè¯


```javascript
function validateFileSize(file) {
    const maxSize = 5 * 1024 * 1024;  // 5MB = 5 * 1024 * 1024 å­—èŠ‚
    
    if (file.size > maxSize) {
        alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡5MB');
        return false;
    }
    
    return true;
}

// äººæ€§åŒ–çš„æ–‡ä»¶å¤§å°æ˜¾ç¤º
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ä½¿ç”¨ç¤ºä¾‹
console.log(formatFileSize(1536)); // "1.5 KB"
console.log(formatFileSize(1048576)); // "1 MB"
```

### 5.4 ç»¼åˆéªŒè¯å‡½æ•°


```javascript
function validateFile(file) {
    // æ–‡ä»¶ç±»å‹éªŒè¯
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
    if (!allowedTypes.includes(file.type)) {
        alert('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹');
        return false;
    }
    
    // æ–‡ä»¶å¤§å°éªŒè¯
    const maxSize = 10 * 1024 * 1024;  // 10MB
    if (file.size > maxSize) {
        alert(`æ–‡ä»¶å¤ªå¤§ï¼Œä¸èƒ½è¶…è¿‡${formatFileSize(maxSize)}`);
        return false;
    }
    
    // æ–‡ä»¶åéªŒè¯ï¼ˆå¯é€‰ï¼‰
    if (file.name.length > 100) {
        alert('æ–‡ä»¶åå¤ªé•¿');
        return false;
    }
    
    return true;
}
```

---

## 6. ğŸ”„ å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 


### 6.1 ä»€ä¹ˆæ˜¯åˆ†ç‰‡ä¸Šä¼ 


**åˆ†ç‰‡ä¸Šä¼ çš„æ¦‚å¿µ**ï¼šæŠŠå¤§æ–‡ä»¶åˆ‡æˆå°å—ï¼Œåˆ†åˆ«ä¸Šä¼ ï¼Œæœ€ååœ¨æœåŠ¡å™¨åˆå¹¶

```
å¤§æ–‡ä»¶(100MB) â†’ åˆ†æˆ100ä¸ªå°å—(æ¯å—1MB) â†’ é€ä¸ªä¸Šä¼  â†’ æœåŠ¡å™¨åˆå¹¶
```

> ğŸ’¡ **ä¸ºä»€ä¹ˆè¦åˆ†ç‰‡**ï¼š
> - å¤§æ–‡ä»¶ç›´æ¥ä¸Šä¼ å®¹æ˜“è¶…æ—¶
> - ç½‘ç»œæ–­äº†å¯ä»¥ä»æ–­ç‚¹ç»§ç»­
> - å¯ä»¥å¹¶è¡Œä¸Šä¼ æé«˜é€Ÿåº¦

### 6.2 æ–‡ä»¶åˆ†ç‰‡çš„å®ç°


```javascript
function sliceFile(file, chunkSize = 1024 * 1024) {  // é»˜è®¤1MBä¸€ç‰‡
    const chunks = [];
    let start = 0;
    
    while (start < file.size) {
        const end = Math.min(start + chunkSize, file.size);
        const chunk = file.slice(start, end);  // sliceæ–¹æ³•åˆ‡å‰²æ–‡ä»¶
        chunks.push({
            chunk: chunk,
            index: chunks.length,
            start: start,
            end: end
        });
        start = end;
    }
    
    return chunks;
}

// ä½¿ç”¨ç¤ºä¾‹
const file = document.getElementById('fileInput').files[0];
const chunks = sliceFile(file);
console.log(`æ–‡ä»¶è¢«åˆ†æˆ${chunks.length}ç‰‡`);
```

### 6.3 åˆ†ç‰‡ä¸Šä¼ çš„å®Œæ•´å®ç°


```javascript
function uploadLargeFile() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('è¯·é€‰æ‹©æ–‡ä»¶');
        return;
    }
    
    const chunkSize = 1024 * 1024;  // 1MBæ¯ç‰‡
    const chunks = sliceFile(file, chunkSize);
    const fileId = generateFileId();  // ç”Ÿæˆæ–‡ä»¶å”¯ä¸€æ ‡è¯†
    
    console.log(`å¼€å§‹ä¸Šä¼ æ–‡ä»¶ï¼Œå…±${chunks.length}ç‰‡`);
    
    // é€ä¸ªä¸Šä¼ åˆ†ç‰‡
    uploadChunks(chunks, fileId, file.name);
}

function uploadChunks(chunks, fileId, fileName) {
    let uploadedCount = 0;
    
    chunks.forEach((chunkInfo, index) => {
        const formData = new FormData();
        formData.append('chunk', chunkInfo.chunk);
        formData.append('chunkIndex', index);
        formData.append('totalChunks', chunks.length);
        formData.append('fileId', fileId);
        formData.append('fileName', fileName);
        
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload-chunk');
        
        xhr.onload = function() {
            if (xhr.status === 200) {
                uploadedCount++;
                const progress = (uploadedCount / chunks.length) * 100;
                console.log(`ä¸Šä¼ è¿›åº¦: ${Math.round(progress)}%`);
                
                // æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆ
                if (uploadedCount === chunks.length) {
                    mergeChunks(fileId, fileName);
                }
            }
        };
        
        xhr.send(formData);
    });
}

function mergeChunks(fileId, fileName) {
    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/merge-chunks');
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            console.log('æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼');
        }
    };
    
    xhr.send(JSON.stringify({
        fileId: fileId,
        fileName: fileName
    }));
}

function generateFileId() {
    return Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}
```

---

## 7. ğŸ¯ æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½


### 7.1 ä»€ä¹ˆæ˜¯æ‹–æ‹½ä¸Šä¼ 


**æ‹–æ‹½ä¸Šä¼ **ï¼šç”¨æˆ·ç›´æ¥æŠŠæ–‡ä»¶ä»æ–‡ä»¶å¤¹æ‹–åˆ°ç½‘é¡µä¸Šå°±èƒ½ä¸Šä¼ 

> ğŸ’¡ **ç”¨æˆ·ä½“éªŒ**ï¼šæ¯”ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æ›´æ–¹ä¾¿ï¼Œå°±åƒæ‹–æ–‡ä»¶åˆ°å›æ”¶ç«™ä¸€æ ·ç®€å•

### 7.2 æ‹–æ‹½ä¸Šä¼ çš„å®ç°


```javascript
function setupDragAndDrop() {
    const dropZone = document.getElementById('dropZone');
    
    // é˜²æ­¢æµè§ˆå™¨é»˜è®¤æ‰“å¼€æ–‡ä»¶
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    // æ‹–æ‹½è¿›å…¥æ—¶çš„è§†è§‰åé¦ˆ
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
        dropZone.classList.add('drag-over');
    }
    
    function unhighlight() {
        dropZone.classList.remove('drag-over');
    }
    
    // å¤„ç†æ–‡ä»¶æ‹–æ”¾
    dropZone.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
        const files = e.dataTransfer.files;
        handleFiles(files);
    }
    
    function handleFiles(files) {
        Array.from(files).forEach(uploadFile);
    }
    
    function uploadFile(file) {
        console.log('ä¸Šä¼ æ–‡ä»¶ï¼š', file.name);
        // è¿™é‡Œè°ƒç”¨ä¹‹å‰çš„ä¸Šä¼ å‡½æ•°
    }
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.onload = function() {
    setupDragAndDrop();
};
```

**å¯¹åº”çš„HTMLå’ŒCSS**
```html
<div id="dropZone" class="drop-zone">
    <p>æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ </p>
    <p>æˆ–è€… <button onclick="document.getElementById('fileInput').click()">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</button></p>
    <input type="file" id="fileInput" multiple style="display: none;">
</div>

<style>
.drop-zone {
    width: 400px;
    height: 200px;
    border: 2px dashed #ccc;
    border-radius: 10px;
    text-align: center;
    padding: 50px;
    margin: 20px;
    transition: border-color 0.3s;
}

.drop-zone.drag-over {
    border-color: #4CAF50;
    background-color: #f9f9f9;
}
</style>
```

---

## 8. ğŸ”„ æ–­ç‚¹ç»­ä¼ æŠ€æœ¯


### 8.1 ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ 


**æ–­ç‚¹ç»­ä¼ **ï¼šä¸Šä¼ ä¸­æ–­åï¼Œä¸‹æ¬¡å¯ä»¥ä»ä¸­æ–­çš„åœ°æ–¹ç»§ç»­ä¸Šä¼ ï¼Œè€Œä¸æ˜¯é‡æ–°å¼€å§‹

```
ç¬¬ä¸€æ¬¡ä¸Šä¼ ï¼š0% â†’ 30% â†’ ç½‘ç»œä¸­æ–­
ç¬¬äºŒæ¬¡ä¸Šä¼ ï¼šä»30%å¼€å§‹ â†’ 100%å®Œæˆ
```

> ğŸ’¡ **åº”ç”¨åœºæ™¯**ï¼šä¸Šä¼ å¤§æ–‡ä»¶æ—¶ç½‘ç»œä¸ç¨³å®šï¼Œé¿å…é‡å¤ä¸Šä¼ å·²å®Œæˆçš„éƒ¨åˆ†

### 8.2 æ–­ç‚¹ç»­ä¼ çš„å®ç°æ€è·¯


**æ ¸å¿ƒåŸç†**ï¼š
1. è®°å½•æ¯ä¸ªåˆ†ç‰‡çš„ä¸Šä¼ çŠ¶æ€
2. ä¸Šä¼ å¤±è´¥æ—¶ä¿å­˜å·²å®Œæˆçš„è¿›åº¦
3. é‡æ–°ä¸Šä¼ æ—¶è·³è¿‡å·²å®Œæˆçš„åˆ†ç‰‡

```javascript
class ResumableUploader {
    constructor() {
        this.uploadedChunks = new Set();  // è®°å½•å·²ä¸Šä¼ çš„åˆ†ç‰‡
        this.fileId = null;
        this.chunks = [];
    }
    
    async uploadFile(file) {
        this.fileId = this.generateFileId(file);
        this.chunks = this.sliceFile(file);
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„ä¸Šä¼ 
        await this.checkUploadStatus();
        
        // ä¸Šä¼ å‰©ä½™åˆ†ç‰‡
        this.uploadRemainingChunks();
    }
    
    async checkUploadStatus() {
        try {
            const response = await fetch(`/upload-status/${this.fileId}`);
            const data = await response.json();
            
            if (data.uploadedChunks) {
                // æ¢å¤å·²ä¸Šä¼ çš„åˆ†ç‰‡è®°å½•
                data.uploadedChunks.forEach(index => {
                    this.uploadedChunks.add(index);
                });
                console.log(`å‘ç°æœªå®Œæˆçš„ä¸Šä¼ ï¼Œå·²å®Œæˆ${this.uploadedChunks.size}ç‰‡`);
            }
        } catch (error) {
            console.log('è¿™æ˜¯æ–°çš„ä¸Šä¼ ');
        }
    }
    
    uploadRemainingChunks() {
        this.chunks.forEach((chunk, index) => {
            // è·³è¿‡å·²ä¸Šä¼ çš„åˆ†ç‰‡
            if (this.uploadedChunks.has(index)) {
                return;
            }
            
            this.uploadChunk(chunk, index);
        });
    }
    
    uploadChunk(chunk, index) {
        const formData = new FormData();
        formData.append('chunk', chunk.chunk);
        formData.append('chunkIndex', index);
        formData.append('fileId', this.fileId);
        
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload-chunk');
        
        xhr.onload = () => {
            if (xhr.status === 200) {
                this.uploadedChunks.add(index);
                this.updateProgress();
                
                // æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
                if (this.uploadedChunks.size === this.chunks.length) {
                    this.mergeChunks();
                }
            }
        };
        
        xhr.onerror = () => {
            console.log(`åˆ†ç‰‡${index}ä¸Šä¼ å¤±è´¥ï¼Œå¯ä»¥é‡è¯•`);
        };
        
        xhr.send(formData);
    }
    
    updateProgress() {
        const progress = (this.uploadedChunks.size / this.chunks.length) * 100;
        console.log(`ä¸Šä¼ è¿›åº¦: ${Math.round(progress)}%`);
    }
    
    generateFileId(file) {
        // æ ¹æ®æ–‡ä»¶å†…å®¹ç”Ÿæˆå”¯ä¸€IDï¼Œç¡®ä¿åŒä¸€æ–‡ä»¶IDç›¸åŒ
        return file.name + '_' + file.size + '_' + file.lastModified;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
const uploader = new ResumableUploader();
uploader.uploadFile(file);
```

---

## 9. ğŸ–¼ï¸ å›¾ç‰‡å¤„ç†ä¼˜åŒ–


### 9.1 å›¾ç‰‡é¢„è§ˆåŠŸèƒ½


**å›¾ç‰‡é¢„è§ˆ**ï¼šç”¨æˆ·é€‰æ‹©å›¾ç‰‡åï¼Œç«‹å³æ˜¾ç¤ºç¼©ç•¥å›¾

```javascript
function previewImage(file) {
    // æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡
    if (!file.type.startsWith('image/')) {
        alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
        return;
    }
    
    const reader = new FileReader();
    
    reader.onload = function(e) {
        const preview = document.getElementById('imagePreview');
        preview.src = e.target.result;  // e.target.resultå°±æ˜¯å›¾ç‰‡çš„base64æ•°æ®
        preview.style.display = 'block';
    };
    
    reader.readAsDataURL(file);  // è¯»å–æ–‡ä»¶ä¸ºbase64æ ¼å¼
}

// HTMLç»“æ„
// <input type="file" onchange="previewImage(this.files[0])" accept="image/*">
// <img id="imagePreview" style="display: none; max-width: 200px;">
```

> ğŸ“ **FileReaderè§£é‡Š**ï¼šFileReaderå¯ä»¥è¯»å–æ–‡ä»¶å†…å®¹ï¼Œ`readAsDataURL`ä¼šæŠŠæ–‡ä»¶è½¬æˆbase64æ ¼å¼ï¼Œå¯ä»¥ç›´æ¥æ˜¾ç¤ºåœ¨imgæ ‡ç­¾é‡Œ

### 9.2 å›¾ç‰‡å‹ç¼©å¤„ç†


**ä¸ºä»€ä¹ˆè¦å‹ç¼©å›¾ç‰‡**ï¼š
- å‡å°‘ä¸Šä¼ æ—¶é—´
- èŠ‚çœæœåŠ¡å™¨å­˜å‚¨ç©ºé—´
- æå‡ç”¨æˆ·ä½“éªŒ

```javascript
function compressImage(file, quality = 0.8) {
    return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        
        img.onload = function() {
            // è®¾ç½®å‹ç¼©åçš„å°ºå¯¸
            const maxWidth = 800;
            const maxHeight = 600;
            
            let { width, height } = img;
            
            // æŒ‰æ¯”ä¾‹ç¼©æ”¾
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            // ç»˜åˆ¶å‹ç¼©åçš„å›¾ç‰‡
            ctx.drawImage(img, 0, 0, width, height);
            
            // è½¬æ¢ä¸ºblobå¯¹è±¡
            canvas.toBlob(resolve, 'image/jpeg', quality);
        };
        
        img.src = URL.createObjectURL(file);
    });
}

// ä½¿ç”¨ç¤ºä¾‹
async function uploadCompressedImage() {
    const fileInput = document.getElementById('fileInput');
    const originalFile = fileInput.files[0];
    
    if (!originalFile) {
        alert('è¯·é€‰æ‹©å›¾ç‰‡');
        return;
    }
    
    console.log(`åŸå§‹æ–‡ä»¶å¤§å°: ${formatFileSize(originalFile.size)}`);
    
    // å‹ç¼©å›¾ç‰‡
    const compressedFile = await compressImage(originalFile, 0.7);
    console.log(`å‹ç¼©åå¤§å°: ${formatFileSize(compressedFile.size)}`);
    
    // ä¸Šä¼ å‹ç¼©åçš„æ–‡ä»¶
    uploadFile(compressedFile);
}
```

---

## 10. âš¡ WebWorkerå¤„ç†


### 10.1 ä»€ä¹ˆæ˜¯WebWorker


**WebWorker**ï¼šåœ¨åå°è¿è¡Œçš„JavaScriptï¼Œä¸ä¼šé˜»å¡é¡µé¢

> ğŸ’¡ **é€šä¿—ç†è§£**ï¼šå°±åƒé›‡äº†ä¸ªåŠ©æ‰‹ï¼Œä¸“é—¨å¤„ç†é‡æ´»ç´¯æ´»ï¼Œä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­å“åº”ç”¨æˆ·æ“ä½œ

**é€‚ç”¨åœºæ™¯**ï¼š
- å¤§æ–‡ä»¶çš„MD5è®¡ç®—
- å›¾ç‰‡å‹ç¼©å¤„ç†
- æ•°æ®åŠ å¯†ç­‰è€—æ—¶æ“ä½œ

### 10.2 ä½¿ç”¨WebWorkerå¤„ç†æ–‡ä»¶


**ä¸»çº¿ç¨‹ä»£ç **
```javascript
function processFileWithWorker(file) {
    // åˆ›å»ºWebWorker
    const worker = new Worker('file-processor.js');
    
    // å‘é€æ–‡ä»¶ç»™Workerå¤„ç†
    worker.postMessage({
        type: 'PROCESS_FILE',
        file: file
    });
    
    // ç›‘å¬Workerçš„è¿”å›ç»“æœ
    worker.onmessage = function(e) {
        const { type, result } = e.data;
        
        if (type === 'FILE_PROCESSED') {
            console.log('æ–‡ä»¶å¤„ç†å®Œæˆ:', result);
            // ç»§ç»­ä¸Šä¼ å¤„ç†
        } else if (type === 'PROGRESS') {
            console.log('å¤„ç†è¿›åº¦:', result.progress + '%');
        }
    };
    
    worker.onerror = function(error) {
        console.error('Workerå‡ºé”™:', error);
    };
}
```

**Workeræ–‡ä»¶ (file-processor.js)**
```javascript
// file-processor.js
self.onmessage = function(e) {
    const { type, file } = e.data;
    
    if (type === 'PROCESS_FILE') {
        processFile(file);
    }
};

function processFile(file) {
    // æ¨¡æ‹Ÿè€—æ—¶å¤„ç†ï¼ˆæ¯”å¦‚è®¡ç®—MD5ï¼‰
    const chunkSize = 1024 * 1024; // 1MB
    let processed = 0;
    
    const reader = new FileReader();
    
    function readNextChunk() {
        const start = processed;
        const end = Math.min(start + chunkSize, file.size);
        const chunk = file.slice(start, end);
        
        reader.readAsArrayBuffer(chunk);
    }
    
    reader.onload = function(e) {
        // å¤„ç†æ•°æ®å—
        processed += e.target.result.byteLength;
        
        // æŠ¥å‘Šè¿›åº¦
        const progress = (processed / file.size) * 100;
        self.postMessage({
            type: 'PROGRESS',
            result: { progress: Math.round(progress) }
        });
        
        if (processed < file.size) {
            readNextChunk(); // ç»§ç»­å¤„ç†ä¸‹ä¸€å—
        } else {
            // å¤„ç†å®Œæˆ
            self.postMessage({
                type: 'FILE_PROCESSED',
                result: { 
                    fileName: file.name,
                    fileSize: file.size,
                    processedAt: new Date().toISOString()
                }
            });
        }
    };
    
    readNextChunk(); // å¼€å§‹å¤„ç†
}
```

---

## 11. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 11.1 å¿…é¡»æŒæ¡çš„æ ¸å¿ƒæ¦‚å¿µ


```
ğŸ”¸ æ–‡ä»¶ä¸Šä¼ æœ¬è´¨ï¼šæŠŠç”¨æˆ·æ–‡ä»¶ä¼ åˆ°æœåŠ¡å™¨ï¼Œæ ¸å¿ƒæ˜¯FormData + Ajax
ğŸ”¸ å•æ–‡ä»¶ä¸Šä¼ ï¼šé€‰æ‹©æ–‡ä»¶ â†’ FormDataåŒ…è£… â†’ Ajaxå‘é€
ğŸ”¸ å¤šæ–‡ä»¶ä¸Šä¼ ï¼šmultipleå±æ€§ â†’ æ‰¹é‡å¤„ç† â†’ ä¸€æ¬¡æ€§æˆ–é€ä¸ªä¸Šä¼ 
ğŸ”¸ è¿›åº¦ç›‘æ§ï¼šxhr.upload.onprogressäº‹ä»¶ç›‘å¬ä¸Šä¼ è¿›åº¦
ğŸ”¸ æ–‡ä»¶éªŒè¯ï¼šç±»å‹ã€å¤§å°ã€æ•°é‡é™åˆ¶ï¼Œæå‡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ
ğŸ”¸ åˆ†ç‰‡ä¸Šä¼ ï¼šå¤§æ–‡ä»¶åˆ‡å°å—ï¼Œé¿å…è¶…æ—¶ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
ğŸ”¸ æ‹–æ‹½ä¸Šä¼ ï¼šç›‘å¬dragäº‹ä»¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
ğŸ”¸ æ–­ç‚¹ç»­ä¼ ï¼šè®°å½•ä¸Šä¼ çŠ¶æ€ï¼Œä»ä¸­æ–­å¤„ç»§ç»­
ğŸ”¸ å›¾ç‰‡å¤„ç†ï¼šé¢„è§ˆã€å‹ç¼©ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’ŒæœåŠ¡å™¨èµ„æº
ğŸ”¸ WebWorkerï¼šåå°å¤„ç†è€—æ—¶æ“ä½œï¼Œä¸é˜»å¡é¡µé¢
```

### 11.2 å…³é”®ç†è§£è¦ç‚¹


**ğŸ”¹ FormDataçš„ä½œç”¨**
```
FormDataå°±åƒä¸€ä¸ªè™šæ‹Ÿè¡¨å•ï¼š
- å¯ä»¥è£…æ–‡ä»¶ã€æ–‡æœ¬ç­‰å„ç§æ•°æ®
- æµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„Content-Type
- æœåŠ¡å™¨ç«¯å¯ä»¥åƒå¤„ç†æ™®é€šè¡¨å•ä¸€æ ·å¤„ç†
```

**ğŸ”¹ è¿›åº¦ç›‘æ§çš„åŸç†**
```
xhr.upload.onprogressäº‹ä»¶ï¼š
- event.loadedï¼šå·²ä¸Šä¼ å­—èŠ‚æ•°
- event.totalï¼šæ€»å­—èŠ‚æ•°
- è®¡ç®—ç™¾åˆ†æ¯”ï¼š(loaded/total) * 100
```

**ğŸ”¹ åˆ†ç‰‡ä¸Šä¼ çš„ä¼˜åŠ¿**
```
è§£å†³å¤§æ–‡ä»¶ä¸Šä¼ é—®é¢˜ï¼š
- é¿å…è¯·æ±‚è¶…æ—¶
- æ”¯æŒå¹¶è¡Œä¸Šä¼ 
- å®ç°æ–­ç‚¹ç»­ä¼ 
- æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
```

### 11.3 å®é™…åº”ç”¨å»ºè®®


**ğŸ“Š æ ¹æ®åœºæ™¯é€‰æ‹©æ–¹æ¡ˆ**

| æ–‡ä»¶å¤§å° | **æ¨èæ–¹æ¡ˆ** | **ç‰¹ç‚¹** |
|---------|-------------|---------|
| `< 5MB` | `æ™®é€šä¸Šä¼  + è¿›åº¦æ¡` | `ç®€å•å¿«é€Ÿ` |
| `5MB - 50MB` | `åˆ†ç‰‡ä¸Šä¼ ` | `ç¨³å®šå¯é ` |
| `> 50MB` | `åˆ†ç‰‡ + æ–­ç‚¹ç»­ä¼ ` | `ç”¨æˆ·ä½“éªŒå¥½` |

**âš ï¸ å¸¸è§æ³¨æ„äº‹é¡¹**
```
å®‰å…¨è€ƒè™‘ï¼š
- å‰ç«¯éªŒè¯åªæ˜¯ç”¨æˆ·ä½“éªŒï¼Œåç«¯å¿…é¡»å†æ¬¡éªŒè¯
- æ–‡ä»¶ç±»å‹ä¸èƒ½åªçœ‹æ‰©å±•åï¼Œè¦æ£€æŸ¥æ–‡ä»¶å¤´
- è®¾ç½®åˆç†çš„æ–‡ä»¶å¤§å°å’Œæ•°é‡é™åˆ¶

æ€§èƒ½ä¼˜åŒ–ï¼š
- å›¾ç‰‡æ–‡ä»¶å»ºè®®å‹ç¼©åä¸Šä¼ 
- å¤§æ–‡ä»¶ä½¿ç”¨åˆ†ç‰‡å’Œå¹¶è¡Œä¸Šä¼ 
- åˆç†è®¾ç½®åˆ†ç‰‡å¤§å°(1-5MB)

ç”¨æˆ·ä½“éªŒï¼š
- æä¾›æ¸…æ™°çš„è¿›åº¦åé¦ˆ
- æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- é”™è¯¯æ—¶ç»™å‡ºæ˜ç¡®æç¤º
- æ”¯æŒå–æ¶ˆä¸Šä¼ æ“ä½œ
```

**æ ¸å¿ƒè®°å¿†**ï¼š
- æ–‡ä»¶ä¸Šä¼  = æ–‡ä»¶é€‰æ‹© + FormDataåŒ…è£… + Ajaxå‘é€
- å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œå°æ–‡ä»¶ç›´æ¥ä¸Šä¼ 
- è¿›åº¦ç›‘æ§æå‡ä½“éªŒï¼Œæ–‡ä»¶éªŒè¯ä¿è¯å®‰å…¨
- æ‹–æ‹½ã€é¢„è§ˆã€å‹ç¼©è®©åŠŸèƒ½æ›´å®Œå–„