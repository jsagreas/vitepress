---
title: 3ã€å¼‚æ­¥å‡½æ•°ä¸Promiseç±»å‹
---
## ğŸ“š ç›®å½•

1. [Promiseç±»å‹åŸºç¡€](#1-Promiseç±»å‹åŸºç¡€)
2. [async/awaitç±»å‹å¤„ç†](#2-asyncawaitç±»å‹å¤„ç†)
3. [Promiseé“¾å¼è°ƒç”¨ç±»å‹](#3-Promiseé“¾å¼è°ƒç”¨ç±»å‹)
4. [å¼‚æ­¥å‡½æ•°é‡è½½](#4-å¼‚æ­¥å‡½æ•°é‡è½½)
5. [æ ¸å¿ƒè¦ç‚¹æ€»ç»“](#5-æ ¸å¿ƒè¦ç‚¹æ€»ç»“)

---

## 1. ğŸ¯ Promiseç±»å‹åŸºç¡€


### 1.1 ä»€ä¹ˆæ˜¯Promiseç±»å‹


**ğŸ”¸ ç®€å•ç†è§£**
Promiseå°±åƒä¸€ä¸ª"æ‰¿è¯ºä¹¦"ï¼Œå‘Šè¯‰ä½ "æˆ‘ä¼šç»™ä½ ä¸€ä¸ªç»“æœï¼Œä½†éœ€è¦ç­‰ä¸€ä¸‹"ã€‚åœ¨TypeScriptä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®è¿™ä¸ªæ‰¿è¯ºæœ€ç»ˆä¼šç»™ä½ ä»€ä¹ˆç±»å‹çš„ç»“æœã€‚

```typescript
// åŸºç¡€è¯­æ³•ï¼šPromise<T> 
// Tå°±æ˜¯æœ€ç»ˆç»“æœçš„ç±»å‹
Promise<string>   // æ‰¿è¯ºç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²
Promise<number>   // æ‰¿è¯ºç»™ä½ ä¸€ä¸ªæ•°å­—
Promise<User>     // æ‰¿è¯ºç»™ä½ ä¸€ä¸ªUserå¯¹è±¡
```

### 1.2 åˆ›å»ºPromiseçš„ç±»å‹æ³¨è§£


**ğŸ”¸ æ‰‹åŠ¨åˆ›å»ºPromise**
```typescript
// æ‰¿è¯ºè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
const fetchName = (): Promise<string> => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve("å¼ ä¸‰");  // å¿…é¡»æ˜¯stringç±»å‹
    }, 1000);
  });
};

// æ‰¿è¯ºè¿”å›ç”¨æˆ·ä¿¡æ¯
interface User {
  id: number;
  name: string;
}

const fetchUser = (): Promise<User> => {
  return new Promise((resolve) => {
    resolve({ id: 1, name: "æå››" });
  });
};
```

### 1.3 Promiseçš„çŠ¶æ€ç±»å‹


```
Promiseçš„ä¸‰ç§çŠ¶æ€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æˆåŠŸ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pending   â”‚ ---------> â”‚  fulfilled  â”‚
â”‚   (ç­‰å¾…ä¸­)   â”‚            â”‚   (æˆåŠŸ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                           â”‚
       â”‚         å¤±è´¥               â–¼
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   rejected  â”‚
                          â”‚   (å¤±è´¥)    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ’¡ å®é™…åº”ç”¨ç¤ºä¾‹**
```typescript
// æ¨¡æ‹ŸAPIè°ƒç”¨
const getUserById = (id: number): Promise<User | null> => {
  return new Promise((resolve, reject) => {
    if (id > 0) {
      resolve({ id, name: "ç”¨æˆ·" + id });
    } else {
      reject(new Error("ç”¨æˆ·IDæ— æ•ˆ"));
    }
  });
};
```

---

## 2. âš¡ async/awaitç±»å‹å¤„ç†


### 2.1 asyncå‡½æ•°çš„è¿”å›ç±»å‹


**ğŸ”¸ æ ¸å¿ƒç†è§£**
- **asyncå‡½æ•°æ€»æ˜¯è¿”å›Promise**
- **ä¸ç®¡ä½ å†™ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«åŒ…è£…æˆPromise**

```typescript
// çœ‹èµ·æ¥è¿”å›stringï¼Œå®é™…è¿”å›Promise<string>
async function getName(): Promise<string> {
  return "å¼ ä¸‰";  // è‡ªåŠ¨åŒ…è£…æˆ Promise.resolve("å¼ ä¸‰")
}

// TypeScriptè‡ªåŠ¨æ¨æ–­è¿”å›ç±»å‹ä¸ºPromise<string>
async function getAge() {
  return 25;  // æ¨æ–­ä¸ºPromise<number>
}
```

### 2.2 awaitçš„ç±»å‹å¤„ç†


**ğŸ”¸ awaitä¼š"æ‹†å¼€"PromiseåŒ…è£…**
```typescript
async function example() {
  // fetchName()è¿”å›Promise<string>
  // awaitä¼šæ‹†å¼€Promiseï¼Œå¾—åˆ°string
  const name: string = await fetchName();
  
  // fetchUser()è¿”å›Promise<User>
  // awaitæ‹†å¼€åå¾—åˆ°Userç±»å‹
  const user: User = await fetchUser();
  
  return `ç”¨æˆ·ï¼š${user.name}`;  // è¿”å›Promise<string>
}
```

### 2.3 é”™è¯¯å¤„ç†çš„ç±»å‹


**ğŸ”¸ try/catchä¸­çš„ç±»å‹å¤„ç†**
```typescript
async function safeGetUser(id: number): Promise<User | null> {
  try {
    const user = await getUserById(id);
    return user;  // User | null
  } catch (error) {
    // erroré»˜è®¤æ˜¯unknownç±»å‹
    console.log("è·å–ç”¨æˆ·å¤±è´¥:", error);
    return null;
  }
}

// æ›´å¥½çš„é”™è¯¯å¤„ç†
async function betterGetUser(id: number): Promise<User | null> {
  try {
    return await getUserById(id);
  } catch (error) {
    if (error instanceof Error) {
      console.log("é”™è¯¯ä¿¡æ¯:", error.message);
    }
    return null;
  }
}
```

### 2.4 asyncå‡½æ•°çš„å‚æ•°ç±»å‹


```typescript
// å‚æ•°ç±»å‹ç…§å¸¸å®šä¹‰
async function updateUser(
  id: number, 
  updates: Partial<User>
): Promise<User> {
  // æ¨¡æ‹Ÿæ•°æ®åº“æ›´æ–°
  const user = await getUserById(id);
  if (!user) {
    throw new Error("ç”¨æˆ·ä¸å­˜åœ¨");
  }
  
  return { ...user, ...updates };
}

// è°ƒç”¨ç¤ºä¾‹
async function main() {
  const updatedUser = await updateUser(1, { name: "æ–°åå­—" });
  console.log(updatedUser.name);  // TypeScriptçŸ¥é“è¿™æ˜¯string
}
```

---

## 3. ğŸ”— Promiseé“¾å¼è°ƒç”¨ç±»å‹


### 3.1 thenæ–¹æ³•çš„ç±»å‹å¤„ç†


**ğŸ”¸ thenä¼šä¼ é€’å’Œè½¬æ¢ç±»å‹**
```typescript
// æ¯ä¸ªthenéƒ½ä¼šè¿”å›æ–°çš„Promise
getUserById(1)
  .then((user: User | null) => {
    if (!user) throw new Error("ç”¨æˆ·ä¸å­˜åœ¨");
    return user.name;  // è¿”å›string
  })
  .then((name: string) => {
    return name.toUpperCase();  // è¿”å›string
  })
  .then((upperName: string) => {
    console.log(upperName);
  });
```

### 3.2 catchæ–¹æ³•çš„ç±»å‹å¤„ç†


**ğŸ”¸ catchå¤„ç†é”™è¯¯å¹¶å¯ä»¥æ¢å¤ç±»å‹**
```typescript
getUserById(-1)  // è¿™ä¼šå¤±è´¥
  .then((user: User | null) => {
    return user!.name;  // è¿™é‡Œä¼šå‡ºé”™
  })
  .catch((error: unknown) => {
    console.log("å‡ºé”™äº†:", error);
    return "é»˜è®¤ç”¨æˆ·";  // è¿”å›stringï¼Œæ¢å¤åˆ°æ­£å¸¸æµç¨‹
  })
  .then((name: string) => {
    console.log("æœ€ç»ˆåå­—:", name);  // å¯èƒ½æ˜¯çœŸå®åå­—æˆ–"é»˜è®¤ç”¨æˆ·"
  });
```

### 3.3 Promise.allçš„ç±»å‹å¤„ç†


**ğŸ”¸ å¹¶è¡Œå¤„ç†å¤šä¸ªPromise**
```typescript
async function getAllUsers(): Promise<User[]> {
  // Promise.allä¼šæ¨æ–­å…ƒç»„ç±»å‹
  const [user1, user2, user3] = await Promise.all([
    getUserById(1),   // Promise<User | null>
    getUserById(2),   // Promise<User | null>
    getUserById(3)    // Promise<User | null>
  ]);
  
  // è¿‡æ»¤æ‰nullå€¼
  return [user1, user2, user3].filter((user): user is User => user !== null);
}
```

### 3.4 å®ç”¨çš„Promiseå·¥å…·å‡½æ•°


```typescript
// å¸¦è¶…æ—¶çš„Promise
function withTimeout<T>(
  promise: Promise<T>, 
  ms: number
): Promise<T> {
  return Promise.race([
    promise,
    new Promise<never>((_, reject) => 
      setTimeout(() => reject(new Error("è¶…æ—¶")), ms)
    )
  ]);
}

// ä½¿ç”¨ç¤ºä¾‹
async function quickGetUser(id: number): Promise<User | null> {
  try {
    return await withTimeout(getUserById(id), 3000);
  } catch (error) {
    console.log("è·å–ç”¨æˆ·è¶…æ—¶æˆ–å¤±è´¥");
    return null;
  }
}
```

---

## 4. ğŸ”„ å¼‚æ­¥å‡½æ•°é‡è½½


### 4.1 åŸºç¡€é‡è½½è¯­æ³•


**ğŸ”¸ ä¸ºä»€ä¹ˆéœ€è¦é‡è½½**
æœ‰æ—¶å€™åŒä¸€ä¸ªå‡½æ•°æ ¹æ®å‚æ•°ä¸åŒï¼Œè¿”å›çš„Promiseç±»å‹ä¹Ÿä¸åŒã€‚

```typescript
// é‡è½½å£°æ˜
function fetchData(type: "user"): Promise<User>;
function fetchData(type: "users"): Promise<User[]>;
function fetchData(type: "count"): Promise<number>;

// å®ç°
function fetchData(type: string): Promise<User | User[] | number> {
  switch (type) {
    case "user":
      return Promise.resolve({ id: 1, name: "ç”¨æˆ·" });
    case "users":
      return Promise.resolve([{ id: 1, name: "ç”¨æˆ·1" }]);
    case "count":
      return Promise.resolve(10);
    default:
      throw new Error("æœªçŸ¥ç±»å‹");
  }
}

// ä½¿ç”¨æ—¶TypeScriptä¼šç²¾ç¡®æ¨æ–­ç±»å‹
async function example() {
  const user = await fetchData("user");     // ç±»å‹ï¼šUser
  const users = await fetchData("users");   // ç±»å‹ï¼šUser[]
  const count = await fetchData("count");   // ç±»å‹ï¼šnumber
}
```

### 4.2 å¯é€‰å‚æ•°çš„å¼‚æ­¥é‡è½½


```typescript
// é‡è½½ï¼šæ ¹æ®æ˜¯å¦æä¾›callbackå†³å®šè¿”å›ç±»å‹
function getData(id: number): Promise<string>;
function getData(id: number, callback: (data: string) => void): void;

function getData(
  id: number, 
  callback?: (data: string) => void
): Promise<string> | void {
  const data = `æ•°æ®${id}`;
  
  if (callback) {
    // æœ‰å›è°ƒå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨
    setTimeout(() => callback(data), 100);
    return;
  }
  
  // æ²¡æœ‰å›è°ƒå‡½æ•°ï¼Œè¿”å›Promise
  return Promise.resolve(data);
}

// ä½¿ç”¨ç¤ºä¾‹
async function useGetData() {
  // æ–¹å¼1ï¼šPromiseæ–¹å¼
  const data1 = await getData(1);  // è¿”å›Promise<string>
  
  // æ–¹å¼2ï¼šå›è°ƒæ–¹å¼
  getData(2, (data) => {           // è¿”å›void
    console.log(data);
  });
}
```

### 4.3 æ³›å‹ä¸é‡è½½ç»“åˆ


```typescript
// é€šç”¨çš„APIè°ƒç”¨å‡½æ•°
interface ApiResponse<T> {
  data: T;
  message: string;
}

function apiCall<T>(url: string): Promise<ApiResponse<T>>;
function apiCall<T>(url: string, data: any): Promise<ApiResponse<T>>;

function apiCall<T>(
  url: string, 
  data?: any
): Promise<ApiResponse<T>> {
  // æ¨¡æ‹ŸAPIè°ƒç”¨
  if (data) {
    // POSTè¯·æ±‚
    return Promise.resolve({
      data: data as T,
      message: "åˆ›å»ºæˆåŠŸ"
    });
  } else {
    // GETè¯·æ±‚
    return Promise.resolve({
      data: {} as T,
      message: "è·å–æˆåŠŸ"
    });
  }
}

// ä½¿ç”¨ç¤ºä¾‹
async function useApi() {
  // GETè¯·æ±‚
  const response1 = await apiCall<User>("/api/user/1");
  
  // POSTè¯·æ±‚
  const response2 = await apiCall<User>("/api/users", { name: "æ–°ç”¨æˆ·" });
}
```

---

## 5. ğŸ“‹ æ ¸å¿ƒè¦ç‚¹æ€»ç»“


### 5.1 å¿…é¡»æŒæ¡çš„åŸºæœ¬æ¦‚å¿µ


**ğŸ”¸ Promiseç±»å‹çš„æœ¬è´¨**
```
Promise<T> = æ‰¿è¯ºå°†æ¥ç»™ä½ ä¸€ä¸ªTç±»å‹çš„ç»“æœ
- Tæ˜¯æˆåŠŸæ—¶çš„ç»“æœç±»å‹
- å¤±è´¥æ—¶æŠ›å‡ºErrorï¼ˆé€šå¸¸ä¸éœ€è¦åœ¨ç±»å‹ä¸­ä½“ç°ï¼‰
```

**ğŸ”¸ async/awaitçš„ç±»å‹è§„å¾‹**
```
async function() {
  return value;  // è‡ªåŠ¨åŒ…è£…æˆPromise<typeof value>
}

await promise;   // è‡ªåŠ¨æ‹†å¼€Promise<T>ï¼Œå¾—åˆ°T
```

### 5.2 å®ç”¨å¼€å‘æŠ€å·§


**ğŸ”¹ ç±»å‹å®‰å…¨çš„å¼‚æ­¥æ¨¡å¼**
```typescript
// âœ… æ¨èï¼šæ˜ç¡®è¿”å›ç±»å‹
async function getUser(id: number): Promise<User | null> {
  try {
    return await fetchUser(id);
  } catch {
    return null;  // æ˜ç¡®å¤„ç†é”™è¯¯æƒ…å†µ
  }
}

// âœ… æ¨èï¼šä½¿ç”¨ç±»å‹å®ˆå«
function isUser(data: unknown): data is User {
  return typeof data === 'object' && 
         data !== null && 
         'id' in data && 
         'name' in data;
}
```

**ğŸ”¹ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ**
```typescript
// âœ… å…·ä½“çš„é”™è¯¯ç±»å‹
type ApiError = {
  code: number;
  message: string;
};

async function safeApiCall(): Promise<User | ApiError> {
  try {
    return await fetchUser(1);
  } catch (error) {
    return {
      code: 500,
      message: error instanceof Error ? error.message : "æœªçŸ¥é”™è¯¯"
    };
  }
}
```

### 5.3 å¸¸è§é—®é¢˜ä¸è§£å†³


| é—®é¢˜åœºæ™¯ | **è§£å†³æ–¹æ¡ˆ** | **ä»£ç ç¤ºä¾‹** |
|---------|------------|-------------|
| **å¿˜è®°await** | `å¼‚æ­¥å‡½æ•°ç»“æœæ˜¯Promise` | `const user = await getUser()` |
| **é”™è¯¯ç±»å‹æ˜¯unknown** | `ä½¿ç”¨ç±»å‹å®ˆå«æ£€æŸ¥` | `if (error instanceof Error)` |
| **Promiseç±»å‹ä¸åŒ¹é…** | `æ˜ç¡®æŒ‡å®šæ³›å‹å‚æ•°` | `Promise<User | null>` |
| **é‡è½½ç±»å‹æ¨æ–­é”™è¯¯** | `æ£€æŸ¥å‚æ•°ç±»å‹åŒ¹é…` | `ç¡®ä¿é‡è½½å£°æ˜é¡ºåºæ­£ç¡®` |

### 5.4 è®°å¿†è¦ç‚¹


> **ğŸ’¡ æ ¸å¿ƒç†è§£**  
> - asyncå‡½æ•° = è‡ªåŠ¨è¿”å›Promiseçš„å‡½æ•°
> - await = Promiseçš„"æ‹†ç®±å™¨"
> - Promiseé“¾ = ç±»å‹çš„ä¼ é€’å’Œè½¬æ¢
> - é‡è½½ = æ ¹æ®å‚æ•°æä¾›ç²¾ç¡®çš„è¿”å›ç±»å‹

**ğŸ¯ å®ç”¨å»ºè®®**ï¼š
1. **æ€»æ˜¯æ˜ç¡®asyncå‡½æ•°çš„è¿”å›ç±»å‹**
2. **åˆç†å¤„ç†nullå’Œé”™è¯¯æƒ…å†µ**  
3. **ä½¿ç”¨Promise.allå¤„ç†å¹¶è¡Œä»»åŠ¡**
4. **é‡è½½æ—¶æ³¨æ„å‚æ•°ç±»å‹çš„åŒºåˆ†åº¦**

**æ ¸å¿ƒè®°å¿†**ï¼š
- PromiseåŒ…è£…ç»“æœï¼Œasyncè‡ªåŠ¨åŒ…è£…ï¼Œawaitè‡ªåŠ¨æ‹†å¼€
- é“¾å¼è°ƒç”¨ä¼ é€’ç±»å‹ï¼Œé”™è¯¯å¤„ç†è¦å¾—å½“
- é‡è½½æä¾›ç²¾ç¡®ç±»å‹ï¼Œæ³›å‹å¢åŠ çµæ´»æ€§